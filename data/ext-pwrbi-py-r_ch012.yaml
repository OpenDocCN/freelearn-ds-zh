- en: '11 Adding Statistics Insights: Associations'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 11 添加统计洞察：关联
- en: As you saw in the previous chapter, enriching your data can be done through
    the application of complex algorithms. In addition to distances and linear programming,
    statistics can often be the ultimate weapon for data analysis. We will explain
    the basic concepts of some statistical procedures that aim to extract relevant
    insights about the associations between variables from your data.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 如你在上一章所见，通过应用复杂算法可以丰富你的数据。除了距离和线性规划之外，统计学通常可以成为数据分析的终极武器。我们将解释一些旨在从你的数据中提取关于变量之间关联的相关洞察的统计程序的基本概念。
- en: 'In this chapter, you will learn about the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章，你将学习以下主题：
- en: Exploring associations between variables
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索变量之间的关联
- en: Correlation between numeric variables
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数值变量之间的相关性
- en: Correlation between categorical and numeric variables
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类别变量和数值变量之间的相关性
- en: Technical requirements
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术要求
- en: This chapter requires you to have a working internet connection and **Power
    BI Desktop** already installed on your machine. You must have properly configured
    the R and Python engines and IDEs as outlined in *Chapter 2*, *Configuring R with
    Power BI*, and *Chapter 3*, *Configuring Python with Power BI*.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求你拥有一个正常工作的互联网连接，并且**Power BI Desktop**已经安装在你的机器上。你必须已经按照*第 2 章*、*配置 Power
    BI 中的 R*和*第 3 章*、*配置 Power BI 中的 Python*中概述的方式正确配置了 R 和 Python 引擎和 IDE。
- en: Exploring associations between variables
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索变量之间的关联
- en: At first glance, you might wonder what the point of finding relationships between
    variables is. Being able to understand the behavior of a pair of variables and
    identify a pattern in their behavior helps business owners identify key factors
    to divert certain indicators of company health to their benefit. Knowing the pattern
    that binds the trend of two variables gives you the power to predict with some
    certainty one of them by knowing the other. So, knowing the tools to uncover these
    patterns gives you a kind of analytical superpower that is always appealing to
    business owners.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 初看之下，你可能会想知道寻找变量之间关系的目的何在。能够理解一对变量的行为并识别它们行为中的模式，有助于企业主识别关键因素，将公司健康指标转向对其有利的方向。了解绑定两个变量趋势的模式，让你能够通过了解其中一个来以某种确定性预测另一个。因此，了解揭示这些模式的方法，赋予你一种对商业主总是有吸引力的分析超级能力。
- en: In general, two variables are **associated** with each other when the values
    of one of them are in some way related to the values of the other. When you can
    somehow measure the extent of the association of two variables, it is called **correlation**.
    The concept of correlation is immediately applicable in a case where the two variables
    are numerical. Let's see how.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，当其中一个变量的值以某种方式与另一个变量的值相关时，两个变量是**相关的**。当你能够以某种方式测量两个变量关联的程度时，这被称为**相关性**。当两个变量是数值时，相关性概念立即适用。让我们看看如何。
- en: Correlation between numeric variables
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数值变量之间的相关性
- en: 'The first thing we generally do to understand whether there is an association
    between two numeric variables is to represent them on the two Cartesian axes in
    order to obtain a **scatterplot**:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常做的第一件事是理解两个数值变量之间是否存在关联，就是将它们表示在两个笛卡尔轴上，以获得一个**散点图**：
- en: '![Figure 11.1 – A simple scatterplot](img/file266.png)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.1 – 一个简单的散点图](img/file266.png)'
- en: Figure 11.1 – A simple scatterplot
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.1 – 一个简单的散点图
- en: 'Using a scatterplot, it is possible to identify three important characteristics
    of a possible association:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 使用散点图，可以识别可能的关联的三个重要特征：
- en: '**Direction**: It can be *positive* (increasing), *negative* (decreasing),
    or *not defined* (no association found or increasing and decreasing). If the increment
    of a variable corresponds to the increment of the other, the direction is positive;
    otherwise, it is negative:'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方向**：它可以是*正的*（增加），*负的*（减少），或者*未定义的*（未找到关联或增加和减少）。如果一个变量的增量与另一个变量的增量相对应，则方向为正；否则，为负：'
- en: '![Figure 11.2 – Direction types of the association](img/file267.png)'
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 11.2 – 关联的方向类型](img/file267.png)'
- en: Figure 11.2 – Direction types of the association
  id: totrans-18
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 11.2 – 关联的方向类型
- en: '**Form**: It describes the general form that association takes in its simplest
    sense. Obviously, there are many possible forms, but there are some that are more
    common, such as *linear* and *curvilinear* (nonlinear) forms:'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**形式**：它描述了关联在其最简单意义上的一般形式。显然，有许多可能的形式，但有一些更常见，例如*线性*和*曲线*（非线性）形式：'
- en: '![Figure 11.3 – Shapes of the association](img/file268.png)'
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 11.3 – 关联的形状](img/file268.png)'
- en: Figure 11.3 – Shapes of the association
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 11.3 – 关联的形状
- en: '**Strength**: The strength of an association is determined by how close the
    points in the scatterplot follow the line that draws the generic shape of the
    association.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**强度**：关联的强度取决于散点图中点如何接近描绘关联通用形状的线。'
- en: '![Figure 11.4 – Strength of the association](img/file269.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.4 – 关联的强度](img/file269.png)'
- en: Figure 11.4 – Strength of the association
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.4 – 关联的强度
- en: As these visual patterns become measurable through the application of mathematical
    concepts, we can define different types of correlations between numeric variables.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 随着这些视觉模式通过应用数学概念变得可测量，我们可以定义数值变量之间不同类型的关联。
- en: Karl Pearson’s correlation coefficient
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 卡尔·皮尔逊的相关系数
- en: '**Pearson’s correlation coefficient** (**r**) measures the degree of linearity
    of the association between the variables under analysis. This means that if *r
    = 1* or *r = -1*, then the two variables are in a *perfect linear relationship*.
    The sign of the coefficient determines the direction of the association. If instead
    *r is close to 0* indifferently on the negative or positive side, it means that
    the association between the variables is *very weak*. The coefficient cannot take
    values outside the range [-1, 1].'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '**皮尔逊相关系数**（**r**）衡量分析变量之间关联的线性程度。这意味着如果 *r = 1* 或 *r = -1*，那么两个变量处于**完美的线性关系**中。系数的符号确定关联的方向。如果
    *r* 在负或正方向上接近 0，则意味着变量之间的关联**非常弱**。系数的值不能超出 [-1, 1] 的范围。'
- en: The square of Pearson's coefficient (*R²*) is called the **coefficient of determination**
    and measures the percentage of **variance** (which measures the dispersion of
    observations from their mean value) in one variable due to the variance of the
    other variable, assuming the association is linear. For example, if the correlation
    coefficient *r* between a person's weight and height variables measures 0.45,
    it can be said that about 20% (0.45 x 0.45) of the change (variance) in a person's
    weight is due to the change in their height.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 皮尔逊相关系数的平方（*R²*）被称为**确定系数**，它衡量一个变量的**方差**（衡量观测值与其平均值之间的分散程度）中有多少百分比是由于另一个变量的方差，假设关联是线性的。例如，如果一个人的体重和身高变量之间的相关系数
    *r* 为 0.45，那么可以说大约 20%（0.45 x 0.45）的体重变化（方差）是由于身高变化引起的。
- en: 'Calculating the correlation coefficient r is rarely done by hand, as any data
    management platform provides a function that easily calculates it. If you are
    curious, given a dataset of *n* entities, identify the variables *x* and *y* for
    which you want to calculate the correlation coefficient – this is the formula
    that allows you to calculate it:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 计算相关系数 r 很少用手动完成，因为任何数据管理平台都提供了一个易于计算它的函数。如果你好奇，给定一个包含 *n* 个实体的数据集，确定你想要计算相关系数的变量
    *x* 和 *y* – 这是计算它的公式：
- en: '![Figure 11.5 – Formula for the Pearson correlation coefficient](img/file270.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.5 – 皮尔逊相关系数的公式](img/file270.png)'
- en: Figure 11.5 – Formula for the Pearson correlation coefficient
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.5 – 皮尔逊相关系数的公式
- en: The *x̄* and *ȳ* values correspond to the mean values of the homonymous variables
    in the dataset. Keep in mind that Pearson’s correlation function is **symmetric**,
    meaning that the order of the columns for which it is calculated does not matter.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '*x̄* 和 *ȳ* 的值对应于数据集中同义变量的平均值。请注意，皮尔逊相关函数是**对称的**，这意味着计算时列的顺序并不重要。'
- en: 'Examples of the correlation coefficient *r* calculated for some specific associations
    (**Boigelot distributions**) are shown in *Figure 11.6*:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11.6* 中展示了为一些特定关联（**Boigelot 分布**）计算的相关系数 *r* 的示例：'
- en: '![Figure 11.6 – Pearson’s correlation calculated over Boigelot distributions](img/file271.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.6 – 在 Boigelot 分布上计算的皮尔逊相关系数](img/file271.png)'
- en: Figure 11.6 – Pearson’s correlation calculated over Boigelot distributions
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.6 – 在 Boigelot 分布上计算的皮尔逊相关系数
- en: The first row of scatterplots in *Figure 11.6* gives an idea of how the magnitude
    of the correlation measures the strength of the association tending toward a linear
    relationship.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11.6* 中散点图的第一行给出了关联强度如何通过相关性的大小来衡量，趋向于线性关系。'
- en: The second row shows that, regardless of the angle of the linear relationship,
    the correlation coefficient *r* is always equal to 1 in absolute value, that is,
    it always correctly identifies the linear relationship and its direction. The
    only exception is the case of the horizontal linear relationship at the center,
    for which the coefficient *r* is undefined, since for all values of *x* there
    is a single value of *y*.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 第二行显示，无论线性关系的角度如何，相关系数 *r* 的绝对值总是等于 1，也就是说，它总是正确地识别线性关系及其方向。唯一的例外是中心水平线性关系的情况，对于这种情况，系数
    *r* 是未定义的，因为对于所有 *x* 的值，都有一个唯一的 *y* 值。
- en: 'The third row shows one of the most important limitations of the correlation
    coefficient:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 第三行显示了相关系数的一个最重要的局限性：
- en: '**Important Note**'
  id: totrans-39
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Pearson's correlation coefficient is not capable of detecting a pattern in an
    association between two variables as much as the latter are nonlinear.
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 皮尔逊相关系数在检测两个变量之间的非线性关联模式方面不如后者。
- en: 'These are the other limitations:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是其他局限性：
- en: With a very small dataset size (say, 3-6 observations), it might appear that
    an association is present even though it does not exist.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在一个非常小的数据集大小（比如说，3-6 个观测值）的情况下，可能会出现关联存在的情况，尽管实际上并不存在。
- en: 'The correlation coefficient is very sensitive to outliers (observations located
    far from most others). It can also happen that outliers give a false idea of the
    existence of association:'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相关系数对异常值（位于大多数其他值较远处的观测值）非常敏感。也可能发生异常值给出关于存在关联的虚假印象：
- en: '![Figure 11.7 – Wrong correlation values due to outliers](img/file272.png)'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 11.7 – 由于异常值导致的错误相关值](img/file272.png)'
- en: Figure 11.7 – Wrong correlation values due to outliers
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 11.7 – 由于异常值导致的错误相关值
- en: We will cover outliers in more detail in *Chapter 12*, *Adding Statistics Insights,
    Outliers, and Missing Values*.
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们将在*第 12 章*中更详细地介绍异常值，*添加统计洞察、异常值和缺失值*。
- en: 'If the observations in the dataset are divided into different clusters, this
    may induce a false sense of association:'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果数据集中的观测值被分为不同的聚类，这可能会产生虚假的关联感：
- en: '![Figure 11.8 – Wrong correlation value due to clusters](img/file273.png)'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 11.8 – 由于聚类导致的错误相关值](img/file273.png)'
- en: Figure 11.8 – Wrong correlation value due to clusters
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 11.8 – 由于聚类导致的错误相关值
- en: The variables used in the calculation of the correlation coefficient must be
    defined on a continuous scale. For variables based on a discrete scale, such as
    the 1-10 rating of a service, you must use Spearman's rank correlation, which
    we will look at in the next section.
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于计算相关系数的变量必须在连续尺度上定义。对于基于离散尺度的变量，例如服务的 1-10 级评分，您必须使用斯皮尔曼秩相关系数，我们将在下一节中探讨。
- en: 'If in an association there is a variable that has unequal variability with
    a range of values of a second variable, we are faced with a case of **heteroscedasticity**.
    The scatterplot assumes the typical shape of a cone, like the one in *Figure 11.1*.
    In this case, the correlation coefficient could identify an incorrect linear relationship
    (more than one linear relationship would satisfy the conic form of the scatterplot):'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果在一个关联中存在一个变量与第二个变量的值域具有不等的变异性，我们就面临了**异方差性**的情况。散点图假设典型的锥形形状，就像*图 11.1*中的那样。在这种情况下，相关系数可能会识别出错误线性关系（多个线性关系都可能满足散点图的锥形形式）：
- en: '![Figure 11.9 – Wrong correlation value due to heteroscedasticity](img/file274.png)'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 11.9 – 由于异方差性导致的错误相关值](img/file274.png)'
- en: Figure 11.9 – Wrong correlation value due to heteroscedasticity
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 11.9 – 由于异方差性导致的错误相关值
- en: 'The variables involved in calculating the Pearson correlation coefficient should
    not be highly **skewed**, that is, the distribution of the variables must not
    be distorted or asymmetrical with respect to a symmetrical bell curve (normal
    distribution, where the mean, median, and mode are equal), otherwise a reduction
    in the true size of the correlation magnitude could occur:'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算皮尔逊相关系数涉及的变量不应高度**偏斜**，也就是说，变量的分布必须不相对于对称的钟形曲线（正态分布，其中均值、中位数和众数相等）扭曲或不对称，否则可能会发生相关程度真实大小的减少：
- en: '![Figure 11.10 – Distribution skewness types](img/file275.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.10 – 分布偏态类型](img/file275.png)'
- en: Figure 11.10 – Distribution skewness types
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.10 – 分布偏态类型
- en: 'Having clarified these limitations, the first question that comes up is: how
    can I calculate the correlation between two numeric variables when the association
    is nonlinear, when the variables are based on an ordinal scale, or when they have
    a skewed distribution? One of the possible solutions to this problem was provided
    by Charles Spearman.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在明确了这些限制之后，首先出现的问题是：当关联是非线性的，变量基于顺序尺度，或者它们具有偏斜分布时，我该如何计算两个数值变量之间的相关系数？这个问题的一个可能解决方案是由查尔斯·斯皮尔曼提供的。
- en: Charles Spearman’s correlation coefficient
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查尔斯·斯皮尔曼的相关系数
- en: 'Charles Spearman introduced a nonparametric alternative to Pearson''s correlation.
    A **nonparametric statistical method** refers to the fact that it does not assume
    that the data on which it is calculated follows specific models described by a
    handful of parameters. This method is summarized in a new correlation coefficient
    called **Spearman’s rank-order correlation coefficient** (denoted by **ρ**, *rho*).
    Spearman''s coefficient measures the strength and direction of the association
    between two variables once their observations have been ranked according to their
    value. The formula that calculates it is as follows:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 查尔斯·斯皮尔曼引入了皮尔逊相关系数的非参数替代方案。**非参数统计方法**指的是它不假设其计算的数据遵循由少量参数描述的特定模型。这种方法总结在一个新的相关系数中，称为**斯皮尔曼等级相关系数**（用**ρ**，*rho*表示）。斯皮尔曼系数衡量两个变量之间关联的强度和方向，一旦它们的观测值根据其值进行排序。计算它的公式如下：
- en: '![Figure 11.11 – Spearman’s rank-order correlation coefficient formula](img/file276.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![图11.11 – 斯皮尔曼等级相关系数公式](img/file276.png)'
- en: Figure 11.11 – Spearman’s rank-order correlation coefficient formula
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.11 – 斯皮尔曼等级相关系数公式
- en: The value *D* is the difference between the two ranks of each observation. To
    learn more details about the calculation, take a look at the references. Keep
    in mind that Spearman’s correlation function is also symmetric.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 值**D**是每个观测值的两个等级之间的差值。要了解更多计算细节，请查看参考文献。请注意，斯皮尔曼的相关函数也是对称的。
- en: Spearman's correlation coefficient ranges from -1 to +1\. The sign of the coefficient
    indicates whether it is a positive or negative monotone association.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 斯皮尔曼相关系数的范围从-1到+1。系数的符号表示它是正单调关联还是负单调关联。
- en: '**Important Features of Spearman''s Correlation**'
  id: totrans-65
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**斯皮尔曼相关系数的重要特征**'
- en: ''
  id: totrans-66
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Because Spearman's correlation applies to ranks, it provides a measure of a
    **monotonic association** between two continuous random variables and is the best-fitting
    correlation coefficient for ordinal variables. Because of the way it is calculated,
    as opposed to Pearson's, Spearman's correlation is *robust to outliers*.
  id: totrans-67
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 因为斯皮尔曼相关系数适用于等级，它提供了两个连续随机变量之间**单调关联**的度量，并且是顺序变量的最佳拟合相关系数。由于其计算方式与皮尔逊相关系数不同，斯皮尔曼相关系数对异常值**稳健**。
- en: 'Remember that an association is said to be monotonic if it is increasing over
    its entire domain or decreasing over its entire domain (not a combination of the
    two):'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，如果一个关联在其整个定义域内是增加的或减少的（而不是两者的组合），则称其为**单调关联**：
- en: '![Figure 11.12 – Monotonic and non-monotonic associations](img/file277.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![图11.12 – 单调和非单调关联](img/file277.png)'
- en: Figure 11.12 – Monotonic and non-monotonic associations
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.12 – 单调和非单调关联
- en: '**Important Note**'
  id: totrans-71
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-72
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: It’s important to check the monotonicity of the association, since in general
    the
  id: totrans-73
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 检查关联的单调性很重要，因为一般来说，
- en: ''
  id: totrans-74
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: correlation coefficients are not able to accurately describe non-monotonic relationships.
  id: totrans-75
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 相关系数无法准确描述非单调关系。
- en: 'Calculating the Spearman correlation coefficient for the Boigelot distributions,
    we get this:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 计算Boigelot分布的斯皮尔曼相关系数，我们得到以下结果：
- en: '![Figure 11.13 – Spearman’s correlation calculated over Boigelot distributions](img/file278.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![图11.13 – 在Boigelot分布上计算的斯皮尔曼相关系数](img/file278.png)'
- en: Figure 11.13 – Spearman’s correlation calculated over Boigelot distributions
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.13 – 在Boigelot分布上计算的斯皮尔曼相关系数
- en: 'Even Spearman''s correlation fails to capture the nonlinear patterns you observe
    in the third row of distributions in *Figure 11.13*. And this is due not to the
    nonlinearity of the above associations, but to their non-monotonicity. In contrast,
    for monotonic nonlinear associations, Spearman''s correlation is better suited
    than Pearson''s:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 即使斯皮尔曼相关系数也无法捕捉到你在*图11.13*第三行分布中观察到的非线性模式。这并不是由于上述关联的非线性，而是由于它们的非单调性。相比之下，对于单调非线性关联，斯皮尔曼相关系数比皮尔逊相关系数更适合：
- en: '![Figure 11.14 – Pearson’s and Spearman’s correlation over a nonlinear monotonic
    association](img/file279.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![图11.14 – 非线性单调关联中的皮尔逊和斯皮尔曼相关系数](img/file279.png)'
- en: Figure 11.14 – Pearson’s and Spearman’s correlation over a nonlinear monotonic
    association
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.14 – 非线性单调关联中的皮尔逊和斯皮尔曼相关系数
- en: Spearman's correlation is not the only one that uses data ranking in its calculation.
    Kendall's also uses this strategy. Let's take a look at its features.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 斯皮尔曼相关系数并不是唯一使用数据排序进行计算的。肯德尔也使用这种策略。让我们来看看它的特点。
- en: Maurice Kendall’s correlation coefficient
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 莫里斯·肯德尔的相关系数
- en: '**Kendall’s rank correlation coefficient** (**τ**, tau) is also a nonparametric
    method of detecting associations between two variables. Its calculation is based
    on the concept of **concordant pairs** and **discordant pairs** (check the *References*
    section for more details). The formula useful in calculating Kendall''s correlation
    coefficient is as follows:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '**肯德尔秩相关系数**（τ，tau）也是一种检测两个变量之间关联的非参数方法。其计算基于**一致对**和**不一致对**的概念（更多细节请参阅*参考文献*部分）。用于计算肯德尔相关系数的公式如下：'
- en: '![Figure 11.15 – Kendall’s correlation coefficient formula](img/file280.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![图11.15 – 肯德尔相关系数公式](img/file280.png)'
- en: Figure 11.15 – Kendall’s correlation coefficient formula
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.15 – 肯德尔相关系数公式
- en: The *n[c]* value represents the number of concordant pairs, and the *n[d]* value
    represents the number of discordant pairs. Like the other correlation functions,
    Kendall’s is symmetric too.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '*n[c]*值表示一致对的数量，而*n[d]*值表示不一致对的数量。与其他相关函数一样，肯德尔的相关性也是对称的。'
- en: 'All of the assumptions made for Spearman''s correlation also apply to Kendall''s.
    Here is a comparison between the two correlations:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 为斯皮尔曼相关系数所做的所有假设也适用于肯德尔。以下是两种相关系数的比较：
- en: Both correlations handle ordinal data and nonlinear continuous monotonic data
    very well.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这两种相关系数都能很好地处理有序数据和非线性连续单调数据。
- en: Both correlations are robust to outliers.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这两种相关系数对异常值都具有鲁棒性。
- en: Kendall correlation is preferred to Spearman correlation when the sample size
    is small and when it has many tied ranks.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当样本量小且存在许多相同等级时，肯德尔相关系数比斯皮尔曼相关系数更受欢迎。
- en: Kendall’s coefficient is usually smaller than Spearman’s.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 肯德尔的系数通常比斯皮尔曼的小。
- en: Kendall's correlation has more computational complexity than Spearman's.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 肯德尔相关系数的计算复杂度比斯皮尔曼的相关系数更高。
- en: That said, let's use all three correlation coefficients in a real case.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，让我们在一个实际案例中使用这三个相关系数。
- en: Description of a real case
  id: totrans-95
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 实际案例的描述
- en: Your boss has asked you to carry out a world population analysis requested by
    a client. Specifically, you need to understand whether there is a relationship
    and of what magnitude between life expectancy and per capita gross domestic product
    (GDP) over the years.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 您的老板要求您执行一个客户要求的全球人口分析。具体来说，您需要了解在过去的年份中，预期寿命和人均国内生产总值（GDP）之间是否存在关系以及关系的程度。
- en: Looking around the web for useful data for the purpose, you realize that there
    is a portal that can help your case named **Gapminder** ([https://www.gapminder.org/](https://www.gapminder.org/)).
    It fights devastating misconceptions and promotes a fact-based worldview everyone
    can understand combining data from multiple sources into unique coherent time
    series that can’t be found elsewhere. The portal precisely exposes data on life
    expectancy ([http://bit.ly/life-expectancy-data](http://bit.ly/life-expectancy-data))
    and data on GDP per capita ([http://bit.ly/gdp-per-capita-data](http://bit.ly/gdp-per-capita-data)).
    In addition, there is someone who has transformed the data to collect it in a
    more suitable form for our purposes and has shared his work with the community
    in a CSV file ([http://bit.ly/gdp-life-expect-data](http://bit.ly/gdp-life-expect-data)).
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在网上寻找有用的数据时，您意识到有一个名为 **Gapminder** 的网站可以帮助您（[https://www.gapminder.org/](https://www.gapminder.org/)）。它对抗毁灭性的误解，并推广一个基于事实的世界观，每个人都可以理解，通过将来自多个来源的数据结合成独特的时间序列，这些时间序列在其他地方找不到。该网站精确地揭示了关于预期寿命的数据（[http://bit.ly/life-expectancy-data](http://bit.ly/life-expectancy-data)）和关于人均
    GDP 的数据（[http://bit.ly/gdp-per-capita-data](http://bit.ly/gdp-per-capita-data)）。此外，还有一个人已经将数据转换成更适合我们目的的形式，并在
    CSV 文件中与社区分享了他的工作（[http://bit.ly/gdp-life-expect-data](http://bit.ly/gdp-life-expect-data)）。
- en: Awesome! You have everything you need to start your analysis in Python.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！您已经拥有了开始 Python 分析所需的一切。
- en: Implementing correlation coefficients in Python
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Python 中实现相关系数
- en: 'To run the code in this section, you need to install the Seaborn module in
    your `pbi_powerquery_env` environment. As you''ve probably learned by now, proceed
    as follows:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行本节中的代码，您需要在您的 `pbi_powerquery_env` 环境中安装 Seaborn 模块。如您现在可能已经学到的，请按以下步骤操作：
- en: Open the Anaconda prompt.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Anaconda 提示符。
- en: Enter the command `conda activate pbi_powerquery_env`.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令 `conda activate pbi_powerquery_env`。
- en: Enter the command `pip install seaborn`.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令 `pip install seaborn`。
- en: The code you'll find in this section is available in the file `01-gdp-life-expectancy-analysis-in-python.py`
    in the `Chapter11\Python` folder.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中提供的代码可在 `Chapter11\Python` 文件夹中的 `01-gdp-life-expectancy-analysis-in-python.py`
    文件中找到。
- en: 'At this point, let''s take a quick look at the data in the above CSV file,
    while also importing the forms needed for the rest of the operations:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，让我们快速查看上述 CSV 文件中的数据，同时导入后续操作所需的表单：
- en: '[PRE0]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You''ll see something like this:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 您会看到类似这样的：
- en: '![Figure 11.16 – A sample of the dataset about GDP and life expectancy](img/file281.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.16 – GDP 和预期寿命数据集的样本](img/file281.png)'
- en: Figure 11.16 – A sample of the dataset about GDP and life expectancy
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.16 – GDP 和预期寿命数据集的样本
- en: 'The variables we are interested in are `lifeExp` and `gdpPercap`. Before drawing
    a scatterplot of the two, let''s also take a look at the distribution of each
    of them. So let''s define the functions we will use for the plots and draw the
    distributions:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们感兴趣的变量是 `lifeExp` 和 `gdpPercap`。在绘制这两个变量的散点图之前，让我们也看一下每个变量的分布。因此，让我们定义我们将用于绘图的函数并绘制分布图：
- en: '[PRE1]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The plots created are as follows:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 创建的图表如下：
- en: '![Figure 11.17 – Distributions of life expectancy and GDP variables](img/file282.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.17 – 预期寿命和 GDP 变量的分布](img/file282.png)'
- en: Figure 11.17 – Distributions of life expectancy and GDP variables
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.17 – 预期寿命和 GDP 变量的分布
- en: 'As you can see, while the life expectancy distribution more or less approximates
    the normal distribution, the GDP distribution is totally positive-skewed. Should
    there be a significant association between the two variables, you should then
    expect a likely non-linear scatter plot. Let''s check it out:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，预期寿命的分布大致符合正态分布，而 GDP 的分布则是完全正偏斜。如果这两个变量之间存在显著的关联，那么您应该预期散点图可能是非线性的。让我们来看看：
- en: '[PRE2]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'You get this:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 您会得到这个：
- en: '![Figure 11.18 – Scatterplot between life expectancy and GDP per capita](img/file283.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.18 – 预期寿命与人均 GDP 的散点图](img/file283.png)'
- en: Figure 11.18 – Scatterplot between life expectancy and GDP per capita
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.18 – 预期寿命与人均 GDP 的散点图
- en: From *Figure 11.18*, you can see that the association between the two variables
    is obvious and, as expected, is nonlinear (background arrow). What is more, outliers
    are present that are highlighted at the top. You are therefore faced with two
    assumptions that invalidate Pearson's correlation. Fortunately, the association
    is monotonically increasing, so the Spearman and Kendall correlations should detect
    the pattern more accurately.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 从*图11.18*中，您可以清楚地看到两个变量之间的关联性，并且正如预期的那样，是非线性的（背景箭头）。更重要的是，存在一些异常值，它们在顶部被突出显示。因此，您面临两个使皮尔逊相关系数无效的假设。幸运的是，这种关联是单调递增的，因此斯皮尔曼和肯德尔相关系数应该能更准确地检测到模式。
- en: 'The Python implementation of the three correlation coefficients is already
    made available by pandas. Therefore, correlation analysis is straightforward:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: pandas已经提供了三种相关系数的Python实现。因此，相关性分析非常直接：
- en: '[PRE3]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The `corr()` function of a pandas dataframe returns the correlation calculation
    for each pair of its numeric columns. Since the correlation functions are symmetric
    (that is, the order of the columns for which it is computed does not matter),
    the three calls return three dataframes each having all the numeric features as
    rows and columns, and the correlations between the features as values:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: pandas数据框的`corr()`函数返回其数值列的每一对的相关计算。由于相关函数是对称的（即，计算时列的顺序无关紧要），这三个调用返回三个数据框，每个数据框都将所有数值特征作为行和列，并将特征之间的相关系数作为值：
- en: '![Figure 11.19 – Correlations between life expectancy and GDP per capita](img/file284.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![图11.19 – 人均寿命与人均GDP的相关性](img/file284.png)'
- en: Figure 11.19 – Correlations between life expectancy and GDP per capita
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.19 – 人均寿命与人均GDP的相关性
- en: As you can see, all three correlations identify a positive association between
    the two variables. As expected, the strength detected by Pearson's correlation
    is the weakest (*r = 0.58*). In contrast, the Spearman and Kendall correlations
    have a higher magnitude, *ρ = 0.83* and *τ = 0.64*, respectively. Especially from
    Spearman's correlation, it is evident that the two variables are strongly correlated.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，所有三个相关系数都表明两个变量之间存在正相关关系。正如预期的那样，皮尔逊相关系数检测到的强度最弱（*r = 0.58*）。相比之下，斯皮尔曼和肯德尔相关系数的幅度更高，分别为*ρ
    = 0.83*和*τ = 0.64*。特别是从斯皮尔曼相关系数来看，两个变量之间存在强烈的关联性。
- en: 'It often happens that in a data science project, you have to select the most
    predictive variables towards a target variable to predict when you have a large
    number of columns. The technique of correlation can certainly help us in this:
    assuming that the target variable is GDP per capita, we could decide to keep all
    those variables as predictors that have a correlation with the target variable
    greater than 0.7\. You understand that in this case, it is important to consider
    the right correlation method, otherwise, you would risk rejecting a variable that
    is strongly correlated to the target one.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据科学项目中，通常需要选择最具有预测性的变量来预测目标变量，尤其是在有大量列的情况下。相关性技术当然可以帮助我们做到这一点：假设目标变量是人均GDP，我们可以决定保留所有与目标变量相关系数大于0.7的变量作为预测变量。您理解在这种情况下，考虑正确的相关性方法非常重要，否则，您可能会拒绝与目标变量强相关的变量。
- en: Great! Let's see how to replicate this analysis using R as well.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 太好了！让我们看看如何使用R复制这个分析。
- en: Implementing correlation coefficients in R
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在R中实现相关系数
- en: 'One of the packages we recommend using in R for calculating correlation coefficients
    is **corrr** ([https://github.com/tidymodels/corrr](https://github.com/tidymodels/corrr)).
    It allows you to explore and rearrange the tibbles returned by the `correlate()`
    function very easily according to the practices suggested by Tidyverse. Therefore,
    you need to install the `corrr` package in the most recent version of CRAN R you
    have:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在R中推荐使用的用于计算相关系数的包之一是**corrr** ([https://github.com/tidymodels/corrr](https://github.com/tidymodels/corrr))。它允许你根据Tidyverse建议的实践非常容易地探索和重新排列`correlate()`函数返回的tibbles。
- en: Open RStudio and make sure it is referencing your latest CRAN R (version 4.0.2
    in our case).
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开RStudio并确保它引用的是您最新的CRAN R（在我们的例子中是版本4.0.2）。
- en: 'Click on the **Console** window and enter this command: `install.packages(''corrr'')`.
    Then press *Enter*.'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**控制台**窗口，输入以下命令：`install.packages('corrr')`。然后按*Enter*键。
- en: The code you'll find in this section is available in the file `01-gdp-life-expectancy-analysis-in-r.R`
    in the `Chapter11\R` folder.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在本节中找到的代码可在`Chapter11\R`文件夹中的`01-gdp-life-expectancy-analysis-in-r.R`文件中找到。
- en: 'So let''s proceed to import the necessary libraries, load the data from the
    CSV file on the web into a tibble, and display the first few lines:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，让我们继续导入必要的库，从网络上的CSV文件中加载数据到tibble中，并显示前几行：
- en: '[PRE4]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You will see this in the console:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在控制台中看到以下内容：
- en: '![Figure 11.20 – First rows of the population tibble](img/file285.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![图11.20 – 人口tibble的前几行](img/file285.png)'
- en: Figure 11.20 – First rows of the population tibble
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.20 – 人口tibble的前几行
- en: 'Also, in this case, we define the functions necessary to draw a distribution
    plot and a scatterplot and use them to generate the plots of the distributions
    of the variables `lifeExp` and `gdpPercap`:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，在这种情况下，我们定义了绘制分布图和散点图所需的函数，并使用它们生成变量`lifeExp`和`gdpPercap`的分布图：
- en: '[PRE5]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'These are the plots you get:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 这是您得到的图表：
- en: '![Figure 11.21 – Distribution plots of Life Expectancy and GDP per capita](img/file286.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![图11.21 – 生命预期和人均GDP的分布图](img/file286.png)'
- en: Figure 11.21 – Distribution plots of Life Expectancy and GDP per capita
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.21 – 生命预期和人均GDP的分布图
- en: 'You can get the scatterplot between the two variables as follows:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过以下方式获取两个变量之间的散点图：
- en: '[PRE6]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This is the graph you get:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这是您得到的图形：
- en: '![Figure 11.22 – Scatterplot between Life Expectancy and GDP per capita](img/file287.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![图11.22 – 生命预期与人均GDP之间的散点图](img/file287.png)'
- en: Figure 11.22 – Scatterplot between Life Expectancy and GDP per capita
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.22 – 生命预期与人均GDP之间的散点图
- en: 'Correlation matrices (persisted in tibbles) are obtained straightforwardly
    via the `corrr` package’s `correlate()` function as follows:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 通过`corrr`包的`correlate()`函数，可以简单地获得（持久化在tibbles中的）相关矩阵，如下所示：
- en: '[PRE7]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'These are the console results:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这是控制台的结果：
- en: '![Figure 11.23 – Correlation coefficients in tibbles](img/file288.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![图11.23 – tibbles中的相关系数](img/file288.png)'
- en: Figure 11.23 – Correlation coefficients in tibbles
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.23 – tibbles中的相关系数
- en: Pretty simple, right!? Now that you know how to get correlation coefficients
    in both Python and R, let's implement what you learned in Power BI.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 简单易懂，对吧？现在您知道了如何在Python和R中获取相关系数，让我们在Power BI中实现您所学的知识。
- en: Implementing correlation coefficients in Power BI with Python and R
  id: totrans-155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用Python和R在Power BI中实现相关系数
- en: 'Power BI has the ability to introduce a minimum of statistical analysis for
    the data that has been loaded into the data model thanks to DAX. You can find
    a list of statistical functions you can use at this link: `http://bit.ly/dax-stats-func`.
    As for the simple *Pearson correlation*, you can use it for columns in an already
    loaded table thanks to the predefined quick measures, which behind the scenes
    add some sometimes non-trivial DAX code for you. For more details, you can click
    on this link: [http://bit.ly/power-bi-corr-coef](http://bit.ly/power-bi-corr-coef).
    However, there is no easy way to implement the Spearman and Kendall correlation
    coefficients.'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: Power BI凭借DAX功能，能够为已加载到数据模型中的数据引入最少量的统计分析。您可以在以下链接中找到您可以使用的一系列统计函数：`http://bit.ly/dax-stats-func`。至于简单的**皮尔逊相关系数**，您可以通过预定义的快速度量来使用它，这些度量在幕后为您添加了一些有时非平凡的DAX代码。更多详情，您可以点击此链接：[http://bit.ly/power-bi-corr-coef](http://bit.ly/power-bi-corr-coef)。然而，没有简单的方法来实现斯皮尔曼和肯德尔相关系数。
- en: Also, you have probably heard of the **correlation plot** available in Microsoft's
    AppSource ([https://bit.ly/power-bi-corr-plot](https://bit.ly/power-bi-corr-plot)).
    You might think it would be possible to use that to get the correlation coefficients.
    First of all, the plot only displays Pearson correlation coefficients and not
    Spearman and Kendall ones. Also, you cannot extract coefficients from a visual
    or custom visual to persist them in a table in order to use them for later calculations
    (for example, feature selection). So the correlation plot idea is totally off
    the mark in this case.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您可能已经听说过在Microsoft的AppSource中可用的**相关系数图**([https://bit.ly/power-bi-corr-plot](https://bit.ly/power-bi-corr-plot))。您可能会认为可以使用它来获取相关系数。首先，该图仅显示皮尔逊相关系数，而不显示斯皮尔曼和肯德尔系数。此外，您无法从视觉或自定义视觉中提取系数以持久化它们，以便在表中使用它们进行后续计算（例如，特征选择）。因此，在这种情况下，相关系数图的想法完全偏离了目标。
- en: The only way to proceed is to use Python or R. Let's see how to do that.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 唯一的方法是使用Python或R。让我们看看如何做到这一点。
- en: In this case, due to the simplicity of the code, we will implement the correlation
    coefficients in both Python and R in one project.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，由于代码的简单性，我们将在一个项目中实现Python和R中的相关系数。
- en: 'First, make sure that Power BI Desktop references the correct versions of Python
    and R in **Options**. Then follow these steps:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，请确保Power BI Desktop在**选项**中引用了正确的Python和R版本。然后按照以下步骤操作：
- en: 'Click on **Get Data**, select **Web**, and click on **Connect**:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**获取数据**，选择**网络**，然后点击**连接**：
- en: '![Figure 11.24 – Get data from the web](img/file289.png)'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图11.24 – 从网络获取数据](img/file289.png)'
- en: Figure 11.24 – Get data from the web
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图11.24 – 从网络获取数据
- en: Enter the `http://bit.ly/gdp-life-expect-data` string into the **URL** textbox
    and click **OK**.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`http://bit.ly/gdp-life-expect-data`字符串输入到**URL**文本框中，然后点击**确定**。
- en: You’ll see a preview of the data. Then click **Transform Data**.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到数据预览。然后点击**转换数据**。
- en: Click **Transform** on the ribbon and then **Run Python script**.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**转换**，然后点击**运行Python脚本**。
- en: 'Enter the following Python script and then click **OK**:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下Python脚本，然后点击**确定**：
- en: '[PRE8]'
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: You can find this code in the file `02-gdp-life-expectancy-analysis-in-power-bi-with-python.py`
    in the `Chapter11\Python` folder.
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以在`Chapter11\Python`文件夹中的文件`02-gdp-life-expectancy-analysis-in-power-bi-with-python.py`中找到此代码。
- en: We are only interested in the data in `corr_df`. So, click on its **Table**
    value.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们只对`corr_df`中的数据感兴趣。因此，点击其**表**值。
- en: You’ll see the preview of the Pearson correlation coefficients between all the
    numeric columns of the dataset.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到数据集中所有数值列的皮尔逊相关系数预览。
- en: Click **Home** on the ribbon and then click **Close & Apply**.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**主页**，然后点击**关闭并应用**。
- en: Repeat steps 1 to 3.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复步骤1到3。
- en: Click **Transform** on the ribbon and then **Run R script**.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**转换**，然后点击**运行R脚本**。
- en: 'Enter the following R script and then click **OK**:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下R脚本，然后点击**确定**：
- en: '[PRE9]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: You can find this code in the file `02-gdp-life-expectancy-analysis-in-power-bi-with-r.R`
    in the `Chapter11\R` folder.
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以在`Chapter11\R`文件夹中的文件`02-gdp-life-expectancy-analysis-in-power-bi-with-r.R`中找到此代码。
- en: We are only interested in the data in `corr_tbl`. So, click its **Table** value.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们只对`corr_tbl`中的数据感兴趣。因此，点击其**表**值。
- en: You’ll see the preview of the Spearman correlation coefficients between all
    the numeric columns of the dataset.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到数据集中所有数值列的斯皮尔曼相关系数预览。
- en: Click **Home** on the ribbon and then click **Close & Apply**.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**主页**，然后点击**关闭并应用**。
- en: Awesome! You have just calculated the correlation coefficients according to
    Pearson and Spearman for the numeric columns of a source dataset in Power BI with
    Python and R. Simple, isn't it?
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！您刚刚使用Python和R在Power BI中计算了源数据集数值列的皮尔逊和斯皮尔曼相关系数。简单，不是吗？
- en: You're probably wondering, *Okay, all clear on the numeric variables. What if
    I had categorical (non-numeric) variables? How can I calculate the correlation
    between them? And what about the correlation between a numeric variable and a
    categorical one?* Let's take a look at how to approach this type of analysis.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能想知道，“好吧，关于数值变量我都很清楚。如果我有分类（非数值）变量怎么办？我如何计算它们之间的相关性？那么数值变量和分类变量之间的相关性又是如何呢？”让我们看看如何进行这类分析。
- en: Correlation between categorical and numeric variables
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分类变量与数值变量之间的相关性
- en: We have shown that, in the case of two numeric variables, you can get a sense
    of the association between them by taking a look at their scatterplot. Clearly,
    this strategy cannot be used when one or both variables are categorical. Note
    that a variable is **categorical** (or qualitative, or nominal) when it takes
    on values that are names or labels. For example, smartphone operating systems
    (iOS, Android, Linux, and so on).
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经展示了，在两个数值变量的情况下，通过查看它们的散点图，您可以了解它们之间的关联。显然，当其中一个或两个变量是分类变量时，这种策略不能使用。请注意，当变量取值为名称或标签时，该变量是**分类的**（或定性的，或名义的）。例如，智能手机操作系统（iOS、Android、Linux等）。
- en: Let's see how to analyze the case of two categorical variables.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何分析两个分类变量的情况。
- en: Considering both variables categorical
  id: totrans-186
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 考虑两个变量都是分类的
- en: 'So, is there a graphical representation that helps us understand whether there
    is a significant association between two categorical variables? The answer is
    yes and its name is a **mosaic plot**. In this section, we will take the Titanic
    disaster dataset as a reference dataset. In order to have an idea of what a mosaic
    plot looks like, let''s take into consideration the variables `Survived` (which
    takes values `1` and `0`) and `Pclass` (*passenger class*, which takes values
    `1`, `2`, and `3`). Since we want to study the association between these two variables,
    we consider the following mosaic plot generated by them:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '那么，是否存在一种图形表示法可以帮助我们理解两个分类变量之间是否存在显著的关联？答案是肯定的，它的名字就是 **mosaic plot**。在本节中，我们将以泰坦尼克号灾难数据集作为参考数据集。为了了解
    mosaic plot 的外观，让我们考虑变量 `Survived`（取值为 `1` 和 `0`）和 `Pclass`（*乘客舱位*，取值为 `1`、`2`
    和 `3`）。由于我们想要研究这两个变量之间的关联，我们考虑由它们生成的以下 mosaic plot： '
- en: '![Figure 11.25 – Mosaic plot of the variables Survived and Pclass](img/file290.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图11.25 – Survived 和 Pclass 变量的 mosaic plot](img/file290.png)'
- en: Figure 11.25 – Mosaic plot of the variables Survived and Pclass
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.25 – Survived 和 Pclass 变量的 mosaic plot
- en: In short, the objective of the mosaic plot is to provide, at a glance, the strength
    of the association between the individual elements of each variable through the
    color of the tiles that represent the pairs of elements in question.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，mosaic plot 的目标是，通过表示所讨论元素对的瓷砖颜色，一眼就能看出每个变量各个元素之间的关联强度。
- en: '**Important Note**'
  id: totrans-191
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-192
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Basically, the more the color of the tile tends toward *dark blue*, the more
    there are observations represented by that tile compared to the expected quantity
    in the case of variables independent of each other.
  id: totrans-193
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 基本上，当瓷砖的颜色趋向于 *深蓝色* 时，与变量相互独立时预期的数量相比，该瓷砖所代表的观察值就越多。
- en: ''
  id: totrans-194
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: On the other hand, the more the color of the tile tends toward *dark red*, the
    less there are observations represented by that tile compared to the expected
    quantity in the case of variables independent of each other.
  id: totrans-195
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 另一方面，当瓷砖的颜色趋向于 *深红色* 时，与变量相互独立时预期的数量相比，该瓷砖所代表的观察值就越少。
- en: Looking at the top row of tiles in *Figure 11.25* associated with *Survived
    = 0*, we can say that, among the non-survivors, more than 50% of the people belong
    to the third class and the number is larger than expected if there was no association
    between survivors and classes. So, in general, we can say that there is a *positive
    association* of medium strength between the non-survivors and the third-class
    people. In other words, it is quite likely to find third-class people among non-survivors.
    In contrast, the number of first-class people among non-survivors is far lower
    than would be expected if there were no association between survivors and classes.
    So there is a strong negative association between the non-survivors and the first-class
    people. Thus, it is very likely that first-class people are not present among
    non-survivors.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 *图11.25* 中与 *Survived = 0* 相关的顶部一行瓷砖，我们可以说，在非幸存者中，超过50%的人属于三等舱，并且这个数字比没有幸存者与舱位之间关联时预期的数字要大。因此，总的来说，我们可以这样说，非幸存者与三等舱之间存在中等强度的
    *正相关*。换句话说，在非幸存者中找到三等舱的人的可能性相当高。相比之下，非幸存者中头等舱的人数远低于没有幸存者与舱位之间关联时预期的数字。因此，非幸存者与头等舱之间存在强烈的负相关。因此，头等舱的人很可能不在非幸存者中。
- en: 'Focusing instead on the bottom row of tiles in *Figure 11.25*, we have confirmation
    of what we have already said: it is very likely to find first-class people among
    the survivors and very unlikely to find third-class people.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，关注 *图11.25* 中瓷砖的底部一行，我们证实了我们之前所说的：在幸存者中找到头等舱的人的可能性非常高，而在三等舱的人中找到的可能性非常低。
- en: 'The numbers behind the plot in *Figure 11.25* are based on conditional probabilities
    and can be found by calculating the **contingency table** (also called **crosstab**)
    generated by the various elements of each of the categorical variables under analysis:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11.25* 中图表后面的数字基于条件概率，可以通过计算由分析中每个分类变量的各个元素生成的 **列联表**（也称为 **交叉表**）来找到：'
- en: '![Figure 11.26 – Mosaic plot of the variables Survived and Pclass](img/file291.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图11.26 – Survived 和 Pclass 变量的 mosaic plot](img/file291.png)'
- en: Figure 11.26 – Mosaic plot of the variables Survived and Pclass
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.26 – Survived 和 Pclass 变量的 mosaic plot
- en: See the *Reference* section for more details about contingency tables and mosaic
    plots.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅*参考*部分以获取关于列联表和马赛克图的更多详细信息。
- en: But in a nutshell, how do we numerically determine the global strength of the
    association between two categorical variables? The answer lies in the coefficient
    highlighted in *Figure 11.26*, namely *Cramér's V*. Let's see what this is all
    about.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 但总的来说，我们如何数值地确定两个分类变量之间关联的全局强度？答案在于*图11.26*中突出显示的系数，即*Cramér的V*。让我们看看这是怎么回事。
- en: Harald Cramér’s correlation coefficient
  id: totrans-203
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Harald Cramér的相关系数
- en: '**Cramér’s correlation coefficient** (**V**) measures the strength of the association
    between two categorical variables and it ranges from 0 to +1 (it doesn’t admit
    negative values, contrary to the coefficients seen until now). This coefficient
    is based on **Pearson''s chi-square (χ2) statistic**, which is used to test whether
    two categorical variables are independent. Cramér''s V formula is as follows:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '**Cramér的相关系数**（**V**）衡量两个分类变量之间关联的强度，其范围从0到+1（与之前看到的系数不同，它不接受负值）。这个系数基于**Pearson的卡方(χ2)统计量**，用于测试两个分类变量是否独立。Cramér的V公式如下：'
- en: '![Figure 11.27 – Cramér’s V formula](img/file292.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![图11.27 – Cramér的V公式](img/file292.png)'
- en: Figure 11.27 – Cramér’s V formula
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.27 – Cramér的V公式
- en: In the formula of *Figure 11.27*, the value *N* is the sample size and *k* is
    the smallest number of distinct elements among those of each categorical variable
    in the association.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图11.27*的公式中，值*N*是样本大小，*k*是关联中每个分类变量中不同元素的最小数量。
- en: 'Cramér’s V coefficient is a symmetric function and the guidelines of *Figure
    11.28* can be used to determine the magnitude of its effect size:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: Cramér的V系数是一个对称函数，可以使用*图11.28*的指南来确定其效应大小的范围：
- en: '![Figure 11.28 – Cramér’s V effect size ranges](img/file293.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![图11.28 – Cramér的V效应大小范围](img/file293.png)'
- en: Figure 11.28 – Cramér’s V effect size ranges
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.28 – Cramér的V效应大小范围
- en: The fact that *V* is a symmetric function leads to an important loss of information.
    Let's see why.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '*V*是一个对称函数的事实导致重要信息丢失。让我们看看为什么。'
- en: Henri Theil’s uncertainty coefficient
  id: totrans-212
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Henri Theil的不确定性系数
- en: 'Suppose you have the two categorical variables `IsFraudster` and `Hobby` in
    the following dataset:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你在以下数据集中有两个分类变量`IsFraudster`和`Hobby`：
- en: '![Figure 11.29 – Sample dataset of categorical variables](img/file294.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![图11.29 – 分类变量的样本数据集](img/file294.png)'
- en: Figure 11.29 – Sample dataset of categorical variables
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.29 – 分类变量的样本数据集
- en: Each value of the `Hobby` variable can be associated with a unique value of
    the `IsFraudster` variable (for example, *Chess → Fraudster*). However, the reverse
    is not true (for example, *Fraudster → [Chess, Body building]*). Therefore, the
    strength of the *Hobby → Fraudster* association (I know `Hobby` and need to determine
    `IsFraudster`) is of higher magnitude than the *Fraudster → Hobby* association
    (I know `IsFraudster` and need to determine `Hobby`). Unfortunately, the use of
    Cramér's coefficient *V* causes this distinction to be lost, since it is a symmetric
    function. To maintain the asymmetric nature of the relation, we must introduce
    Theil's uncertainty coefficient.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '`Hobby`变量的每个值都可以与`IsFraudster`变量的唯一值相关联（例如，*Chess → Fraudster*）。然而，反之则不成立（例如，*Fraudster
    → [Chess, Body building]*）。因此，`Hobby → Fraudster`关联的强度（我知道`Hobby`并需要确定`IsFraudster`）比`Fraudster
    → Hobby`关联的强度（我知道`IsFraudster`并需要确定`Hobby`）更大。不幸的是，使用Cramér的系数*V*会导致这种区别消失，因为它是一个对称函数。为了保持关系的非对称性，我们必须引入Theil的不确定性系数。'
- en: '**Theil''s uncertainty coefficient**, also called the **entropy coefficient**,
    between two variables, *X* and *Y*, has a range of [0, 1] and it is defined as
    follows:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '**Theil的不确定性系数**，也称为**熵系数**，在两个变量*X*和*Y*之间，其范围为[0, 1]，定义为以下：'
- en: '![Figure 11.30 – Theil''s uncertainty coefficient formula](img/file295.png)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![图11.30 – Theil的不确定性系数公式](img/file295.png)'
- en: Figure 11.30 – Theil's uncertainty coefficient formula
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.30 – Theil的不确定性系数公式
- en: It is based on the concept of **entropy**, which provides information about
    the variation or diversity (and therefore uncertainty) of the information contained
    in one variable, given by *H(X)*. Then it’s also based on the **conditional entropy**
    (or **joint entropy**) *H(X|Y)*, which measures data diversity associated with
    the two variables *X* and *Y*.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 它基于**熵**的概念，它提供了关于一个变量中包含的信息的变异或多样性（因此是不确定性）的信息，由*H(X)*给出。然后它还基于**条件熵**（或**联合熵**）*H(X|Y)*，它衡量与两个变量*X*和*Y*相关的数据多样性。
- en: For example, always considering the Titanic disaster dataset, the coefficient
    *U(Survived|Pcalss)* is 0.06; conversely, *U(Pcalss|Survived)* is 0.09.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，始终考虑泰坦尼克号灾难数据集，系数*U(Survived|Pclass)*是0.06；相反，*U(Pclass|Survived)*是0.09。
- en: Let's see which coefficient to consider when dealing with associations in which
    one variable is numeric and the other is categorical.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看在处理一个变量是数值的另一个变量是分类的关联时应该考虑哪个系数。
- en: Considering a numeric variable and a categorical one
  id: totrans-223
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 考虑一个数值变量和一个分类变量
- en: 'If you want to graphically represent an association between a numeric variable
    and a categorical variable, the boxplot or the violin plot are the types of graphic
    representation for you. If you have already come across the problem of having
    to represent the distribution of a variable by highlighting key statistics, then
    you should be familiar with a **boxplot**:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要图形化地表示一个数值变量和一个分类变量之间的关联，箱线图或小提琴图就是适合的图形表示类型。如果你已经遇到过需要通过突出显示关键统计量来表示变量分布的问题，那么你应该熟悉**箱线图**：
- en: '![Figure 11.31 – Graphical explanation of a boxplot](img/file296.png)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![图11.31 – 箱线图的图形解释](img/file296.png)'
- en: Figure 11.31 – Graphical explanation of a boxplot
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.31 – 箱线图的图形解释
- en: 'A **violin plot** is nothing but a combination of a histogram/distribution
    plot and a boxplot for the same variable:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '**小提琴图**不过是同一变量的直方图/分布图和箱线图的组合：'
- en: '![Figure 11.32 – Graphical explanation of a violin plot](img/file297.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![图11.32 – 小提琴图的图形解释](img/file297.png)'
- en: Figure 11.32 – Graphical explanation of a violin plot
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.32 – 小提琴图的图形解释
- en: You will find more details about boxplots and violin plots in the references.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在参考文献中找到更多关于箱线图和小提琴图的信息。
- en: 'When you need to relate a numeric variable to a categorical one, you can build
    a violin plot for each element of the categorical variable. To go back to the
    Titanic disaster dataset example, taking the `Pclass` (categorical) and `Age`
    (numeric) variables into account, you get this multiple violin plot:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 当你需要将一个数值变量与一个分类变量相关联时，你可以为分类变量的每个元素构建一个小提琴图。回到泰坦尼克号灾难数据集的例子，考虑到`Pclass`（分类）和`Age`（数值）变量，你得到这个多小提琴图：
- en: '![Figure 11.33 – Graphical explanation of a violin plot](img/file298.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![图11.33 – 小提琴图的图形解释](img/file298.png)'
- en: Figure 11.33 – Graphical explanation of a violin plot
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.33 – 小提琴图的图形解释
- en: If you look carefully inside each violin plot, you will see a white dot for
    each thin black boxplot plotted within it. Those dots represent the mean of each
    distribution of the `Age` variable for each element of the `Pclass` variable.
    Since they are arranged at fairly distinct heights from each other, it is possible
    that the `Pclass` variable is a good predictor for the `Age` variable. But how
    do we measure the strength of the association between numeric and categorical
    variables? The answer is given to us by the *correlation ratio*.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你仔细观察每个小提琴图内部，你会看到每个黑色箱线图内部都有一个白色点。这些点代表`Pclass`变量每个元素中`Age`变量分布的平均值。由于它们彼此之间的高度相当不同，`Pclass`变量可能是`Age`变量的良好预测因子。但我们如何衡量数值和分类变量之间关联的强度呢？答案是*相关比*给出的。
- en: Karl Pearson’s correlation ratio
  id: totrans-235
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 卡尔·皮尔逊的相关比
- en: It’s again thanks to Karl Pearson that we have a tool to calculate the degree
    of nonlinear association between a categorical and a numerical variable. This
    is the **correlation ratio** (**η**, eta), which was introduced during the study
    of analysis of variance (**ANOVA**), and it ranges from 0 to +1.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 再次感谢卡尔·皮尔逊，我们有了计算分类变量和数值变量之间非线性关联程度的工具。这就是**相关比**（**η**，eta），它在方差分析（ANOVA）的研究中引入，其范围从0到+1。
- en: Just as *r²* can be interpreted as the percentage of variance in one variable
    explained linearly by the other, *η²* (also called the **intraclass correlation
    coefficient**) represents the percentage of variance in the dependent (target)
    variable explained *linearly or nonlinearly* by the independent (predictor) variable.
    For this interpretation to be valid, it requires that the dependent variable be
    numeric and the independent variable be categorical.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 正如*r²*可以解释为另一个变量线性解释的一个变量的方差百分比，*η²*（也称为**类内相关系数**）表示由独立（预测）变量线性或非线性解释的因变量（目标）变量的方差百分比。为了使这种解释有效，需要因变量是数值的，而独立变量是分类的。
- en: 'The correlation ratio is an asymmetric function only if the categorical variable
    is an ordinal one (that is, days of week can be transformed into integers), otherwise,
    it only makes sense in one way. The interclass correlation coefficient formula
    (from which we immediately derive the correlation ratio by applying the square
    root) is as follows:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 当分类变量是序数变量（即星期几可以转换为整数）时，相关比才是一个非对称函数；否则，它只有一个方向上的意义。从类内相关系数公式（通过应用平方根我们可以立即得到相关比）如下：
- en: '![Figure 11.34 – Correlation ratio’s formula](img/file299.png)'
  id: totrans-239
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.34 – 相关比公式](img/file299.png)'
- en: Figure 11.34 – Correlation ratio’s formula
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.34 – 相关比公式
- en: The value is the mean of *y* broken down by category *x* and is the mean of
    the whole *y* (cross-category). Since *σ* represents the *variance* of a variable,
    we can read *η²* as the ratio of the dispersion of the variable *y* weighted for
    each category of *x* to the full dispersion of *y*.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 该值是按类别 *x* 分解的 *y* 的平均值，也是整个 *y*（跨类别）的平均值。由于 *σ* 代表变量的 *方差*，我们可以将 *η²* 读作变量
    *y* 的分散度与每个 *x* 类别加权的比率的比值，与 *y* 的总分散度。
- en: '**Important Note**'
  id: totrans-242
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-243
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The more *η²* tends to 1, the less the observations disperse around their mean
    value for each individual category. Therefore, the total dispersion of the numerical
    variable is all due to the breakdown in categories, and not to the individual
    dispersions for each category. That is why in this case we can say that there
    is a strong association between the numerical variable and the categorical variable.
  id: totrans-244
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 当 *η²* 趋近于 1 时，每个个体类别围绕其平均值分散的观察值就越少。因此，数值变量的总分散度完全归因于类别的分解，而不是每个类别的个体分散度。这就是为什么在这种情况下我们可以说数值变量和分类变量之间存在强烈的关联。
- en: 'To better understand the concept laid out above, consider analyzing the grades
    taken in three subjects. If the grades are dispersed for each subject, you have
    a certain eta. If, on the other hand, the grades coincide for each subject, then
    eta equals 1\. This statement is represented in *Figure 11.35*, where each observation
    is plotted as a point in the violin plots:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解上述概念，考虑分析三个科目所取得的分数。如果每个科目的分数都分散，你有一个确定的 eta。另一方面，如果每个科目的分数都一致，那么 eta
    等于 1。这个陈述在 *图 11.35* 中表示，其中每个观察值都作为小提琴图中的一个点来绘制：
- en: '![Figure 11.35 – Differences in η after changing grade distributions per topic](img/file300.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.35 – 改变每个主题的等级分布后 η 的差异](img/file300.png)'
- en: Figure 11.35 – Differences in η after changing grade distributions per topic
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.35 – 改变每个主题的等级分布后 η 的差异
- en: So, let's now implement the correlation coefficients described in this section
    in Python.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，现在让我们在 Python 中实现本节中描述的相关系数。
- en: Implementing correlation coefficients in Python
  id: totrans-249
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Python 中实现相关系数
- en: 'The Python community is very lucky because Shaked Zychlinski developed a library
    with many data analysis tools, including a function that takes into account the
    data type of the columns of a pandas dataframe and generates a dataframe with
    the appropriate correlations. This library is **Dython** ([http://shakedzy.xyz/dython/](http://shakedzy.xyz/dython/))
    and can be installed via `pip`. Moreover, if you want to create mosaic plots,
    you must also install **statsmodels** ([https://www.statsmodels.org/](https://www.statsmodels.org/))
    in your `pbi_powerquery_env` environment. As you''ve probably learned by now,
    proceed as follows:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: Python 社区非常幸运，因为 Shaked Zychlinski 开发了一个包含许多数据分析工具的库，其中包括一个考虑 pandas dataframe
    列的数据类型并生成具有适当相关性的 dataframe 的函数。这个库是 **Dython** ([http://shakedzy.xyz/dython/](http://shakedzy.xyz/dython/))，可以通过
    `pip` 安装。此外，如果你想要创建马赛克图，还必须在你的 `pbi_powerquery_env` 环境中安装 **statsmodels** ([https://www.statsmodels.org/](https://www.statsmodels.org/))。正如你可能已经学到的，按照以下步骤操作：
- en: Open the Anaconda prompt.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Anaconda 提示符。
- en: Enter the command `conda activate pbi_powerquery_env`.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令 `conda activate pbi_powerquery_env`。
- en: Enter the command `pip install dython`.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令 `pip install dython`。
- en: Enter the command `pip install statsmodels`.
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令 `pip install statsmodels`。
- en: The code you'll find in this section is available in the file `03-titanic-disaster-analysis-in-python.py`
    in the `Chapter11\Python` folder.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中提供的代码可在 `Chapter11\Python` 文件夹中的 `03-titanic-disaster-analysis-in-python.py`
    文件中找到。
- en: Of all the utilities in Dython, we need the ones in the `nominal` module. After
    loading the main libraries, we also create a helper function to draw a violin
    plot.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Dython 的所有实用工具中，我们需要 `nominal` 模块中的那些。在加载主要库之后，我们还创建了一个辅助函数来绘制小提琴图。
- en: 'At this point, you can load the Titanic disaster data from a CSV file exposed
    on the web and transform the numerical columns `Survived` and `Pclass` (passenger
    class) into strings, since they are categorical variables:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你可以从网络上公开的CSV文件中加载泰坦尼克号灾难数据，并将数值列`Survived`和`Pclass`（乘客等级）转换为字符串，因为它们是分类变量：
- en: '[PRE10]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'It is then possible to calculate *Cramér''s V* coefficient between the above
    two categorical variables:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 然后可以计算上述两个分类变量之间的*Cramér's V*系数：
- en: '[PRE11]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: It returns a value of `0.34`, indicating a medium association strength.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 它返回一个值为`0.34`，表示中等的相关强度。
- en: 'You can also calculate *Theil''s U* uncertainty coefficient of the `Survived`
    variable given the `Pclass` variable:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以计算给定`Pclass`变量的`Survived`变量的*Theil's U*不确定性系数：
- en: '[PRE12]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The returned value is `0.087`. Conversely, you can calculate the same coefficient
    for the `Pclass` variable given the `Survived` one, in order to show the asymmetry
    of the function:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 返回值是`0.087`。反过来，你可以计算给定`Survived`变量的`Pclass`变量的相同系数，以展示函数的不对称性：
- en: '[PRE13]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This one returns `0.058`. So it’s clear that the association *Pclass → Survived*
    is stronger than the opposite one.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 这个函数返回`0.058`。所以很明显，关联*Pclass → Survived*比相反的关联更强。
- en: 'How about calculating the *correlation ratio η* between the variables `Age`
    (passenger age) and `Pclass`? Let''s do that:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 我们来计算变量`Age`（乘客年龄）和`Pclass`之间的*相关性比率η*如何？让我们来试试：
- en: '[PRE14]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The result is `0.366`. Now, what if you want to get a correlation value for
    each couple of columns regardless of their data type? In this case, the `associations()`
    function is our friend. You just have to specify whether you want to use Theil’s
    U coefficient (`nom_nom_assoc = ''theil''`) or Cramér’s V one (`nom_nom_assoc
    = ''cramer''`) for categorical variables and that’s it:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是`0.366`。现在，如果你想要得到每个列对的相关值，而不考虑它们的数据类型，那么`associations()`函数就是我们的好朋友。你只需指定是否想要使用Theil的U系数（`nom_nom_assoc
    = 'theil'`）或Cramér的V系数（`nom_nom_assoc = 'cramer'`）来处理分类变量，然后就可以了：
- en: '[PRE15]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'As a result, you''ll get a beautiful heatmap that helps you understand at a
    glance which columns have the strongest correlation:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 结果，你会得到一个美丽的热图，帮助你一眼看出哪些列具有最强的相关性：
- en: '![Figure 11.36 – Correlation heatmap](img/file301.png)'
  id: totrans-272
  prefs: []
  type: TYPE_IMG
  zh: '![图11.36 – 相关性热图](img/file301.png)'
- en: Figure 11.36 – Correlation heatmap
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.36 – 相关性热图
- en: As you may have noticed, you can also select the type of correlation to be used
    between numeric variables (Pearson, Spearman, Kendall) via the `num_num_assoc`
    parameter. Moreover, you can access the coefficient dataframe using the code `ass['corr']`.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所注意到的，你也可以通过`num_num_assoc`参数选择在数值变量之间使用哪种类型的相关性（皮尔逊、斯皮尔曼、肯德尔）。此外，你可以使用代码`ass['corr']`访问系数数据框。
- en: Let's now see how to implement the same things in R.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看如何在R中实现相同的事情。
- en: Implementing correlation coefficients in R
  id: totrans-276
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在R中实现相关性系数
- en: There is no R package on CRAN similar to Dython that allows you to calculate
    correlations between columns in a tibble regardless of their data type. Nor is
    there a package in which the correlation ratio as previously defined is defined.
    Therefore, based on the source code of the Dython package, we created them from
    scratch.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在CRAN上没有与Dython类似的R包允许你在不考虑数据类型的情况下计算tibble中列之间的相关性。也没有一个包定义了之前定义的相关性比率。因此，基于Dython包的源代码，我们从头开始创建了它们。
- en: 'Instead, we used some CRAN packages that expose some of the correlation functions
    introduced in the previous sections. In particular, these packages are as follows:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们使用了CRAN包，这些包公开了之前章节中介绍的一些相关性函数。特别是，这些包如下：
- en: '**rstatix** ([https://github.com/kassambara/rstatix](https://github.com/kassambara/rstatix)),
    an intuitive pipe-friendly framework for basic statistical tests. We used it for
    the `cramer_v()` function.'
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rstatix** ([https://github.com/kassambara/rstatix](https://github.com/kassambara/rstatix))，一个直观且易于管道操作的框架，用于基本统计测试。我们用它来使用`cramer_v()`函数。'
- en: '**DescTools** ([https://andrisignorell.github.io/DescTools/](https://andrisignorell.github.io/DescTools/)),
    a collection of miscellaneous basic statistics functions. We used it for the `UncertCoef()`
    function.'
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DescTools** ([https://andrisignorell.github.io/DescTools/](https://andrisignorell.github.io/DescTools/))，一个包含各种基本统计函数的集合。我们用它来使用`UncertCoef()`函数。'
- en: '**vcd** ([https://cran.r-project.org/web/packages/vcd/index.html](https://cran.r-project.org/web/packages/vcd/index.html)),
    a collection of visualization techniques and tools for categorical data.'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**vcd** ([https://cran.r-project.org/web/packages/vcd/index.html](https://cran.r-project.org/web/packages/vcd/index.html))，一个用于分类数据的可视化技术和工具集合。'
- en: '**sjPlot** ([https://strengejacke.github.io/sjPlot/](https://strengejacke.github.io/sjPlot/)),
    a collection of plotting and table output functions for data visualization.'
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sjPlot** ([https://strengejacke.github.io/sjPlot/](https://strengejacke.github.io/sjPlot/))，一组用于数据可视化的绘图和表格输出函数。'
- en: 'So, you need to install these packages in the most recent version of CRAN R
    you have:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你需要在你拥有的最新版本的 CRAN R 中安装这些包：
- en: Open RStudio and make sure it is referencing your latest CRAN R (version 4.0.2
    in our case).
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 RStudio 并确保它引用的是你最新的 CRAN R（在我们的例子中是版本 4.0.2）。
- en: 'Click on the **Console** window and enter this command: `install.packages(''rstatix'')`.
    Then press *Enter*.'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **控制台** 窗口并输入以下命令：`install.packages('rstatix')`。然后按 *Enter*。
- en: 'Click on the **Console** window and enter this command: `install.packages(''DescTools'')`.
    Then press *Enter*.'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **控制台** 窗口并输入以下命令：`install.packages('DescTools')`。然后按 *Enter*。
- en: 'Click on the **Console** window and enter this command: `install.packages(''vcd'')`.
    Then press *Enter*.'
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **控制台** 窗口并输入以下命令：`install.packages('vcd')`。然后按 *Enter*。
- en: 'Click on the **Console** window and enter this command: `install.packages(''sjPlot'')`.
    Then press *Enter*.'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **控制台** 窗口并输入以下命令：`install.packages('sjPlot')`。然后按 *Enter*。
- en: The code you'll find in this section is available in the file `03-titanic-survive-class-analysis-in-r.R`
    in the `Chapter11\R` folder.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中提供的代码可在 `Chapter11\R` 文件夹中的文件 `03-titanic-survive-class-analysis-in-r.R`
    中找到。
- en: After loading the most important libraries, again we created a helper function
    to graph a violin plot. After that, we defined the functions `correlation_ratio()`
    to calculate eta and `calc_corr()` to calculate the correlation of a tibble regardless
    of the data type of the given columns.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 在加载最重要的库之后，我们再次创建了一个辅助函数来绘制小提琴图。之后，我们定义了 `correlation_ratio()` 函数来计算 η 和 `calc_corr()`
    函数来计算 tibble 的关联度，无论给定列的数据类型如何。
- en: 'At this point, you can load the Titanic disaster data from a CSV file exposed
    on the web and transform the numerical columns `Survived` and `Pclass` (passenger
    class) into factors, since they are categorical variables:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，你可以从网络上公开的 CSV 文件中加载泰坦尼克号灾难数据，并将数值列 `Survived` 和 `Pclass`（乘客等级）转换为因子，因为它们是分类变量：
- en: '[PRE16]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'It is then possible to calculate *Cramér''s V* coefficient between the above
    two categorical variables:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 然后可以计算上述两个分类变量之间的 *Cramér 的 V* 系数：
- en: '[PRE17]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: It returns a value of `0.34`, indicating a medium association strength.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 它返回一个值为 `0.34`，表示中等关联强度。
- en: 'You can also calculate *Theil''s U* uncertainty coefficient of the `Survived`
    variable given the `Pclass` variable:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以计算给定 `Pclass` 变量的 `Survived` 变量的 *Theil 的 U* 不确定性系数：
- en: '[PRE18]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The returned value is `0.087`. Also, in this case, we can calculate the *correlation
    ratio η* between the numeric variable `Age` and the categorical `Pclass` one:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 返回值是 `0.087`。在这种情况下，我们还可以计算数值变量 `Age` 和分类变量 `Pclass` 之间的 *关联比 η*：
- en: '[PRE19]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The result is `0.366`. Now you can get the correlation value for each couple
    of columns regardless of their data type. We implemented the `calc_corr()` function
    for this purpose. You just have to specify whether you want to use Theil’s U coefficient
    (`theil_uncert=True`) or Cramér’s V one (`theil_uncert=False`) for categorical
    variables and that’s it:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是 `0.366`。现在你可以获取每对列的关联值，无论它们的数据类型如何。我们实现了 `calc_corr()` 函数来达到这个目的。你只需指定是否想使用
    Theil 的 U 系数（`theil_uncert=True`）或 Cramér 的 V 系数（`theil_uncert=False`）来处理分类变量即可：
- en: '[PRE20]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You''ll see something like this as a result:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到如下结果：
- en: '![Figure 11.37 – Correlation tibble you get from the Titanic one](img/file302.png)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.37 – 从泰坦尼克号数据中得到的关联 tibble](img/file302.png)'
- en: Figure 11.37 – Correlation tibble you get from the Titanic one
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.37 – 从泰坦尼克号数据中得到的关联 tibble
- en: 'You can also plot a heatmap of the correlation tibble just created using the
    following code:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用以下代码绘制刚刚创建的关联 tibble 的热图：
- en: '[PRE21]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Here is the result:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是结果：
- en: '![Figure 11.38 – Heatmap of the correlation tibble](img/file303.png)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.38 – 关联 tibble 的热图](img/file303.png)'
- en: Figure 11.38 – Heatmap of the correlation tibble
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.38 – 关联 tibble 的热图
- en: Awesome! You have just implemented all of the correlation coefficients studied
    in this chapter in R as well. Let's now see how to implement them in Power BI,
    both with Python and with R.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！你已经在 R 中实现了本章研究的所有相关系数。现在让我们看看如何在 Power BI 中实现它们，无论是使用 Python 还是 R。
- en: Implementing correlation coefficients in Power BI with Python and R
  id: totrans-311
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Power BI 中使用 Python 和 R 实现相关系数
- en: Obviously, Power BI was not born as an advanced statistical analysis tool, so
    you will not find, for example, all you need to implement all the correlation
    coefficients seen in the previous sections. In this case, the support given by
    Python and R is of fundamental importance for this purpose.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，Power BI并非作为高级统计分析工具而诞生，因此你不会找到例如实现前几节中看到的所有相关系数所需的所有功能。在这种情况下，Python和R提供的支持对于此目的至关重要。
- en: Also, in this case, due to the simplicity of the code, we will implement the
    correlation coefficients in both Python and R in one project.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，在这种情况下，由于代码的简单性，我们将在一个项目中实现Python和R中的相关系数。
- en: 'First, make sure that Power BI Desktop references the correct versions of Python
    and R in **Options**. Then follow these steps:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，确保Power BI Desktop在**选项**中引用了Python和R的正确版本。然后按照以下步骤操作：
- en: Click on **Get Data**, select **Web**, and click on **Connect**.
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**获取数据**，选择**网页**，然后点击**连接**。
- en: Enter the `http://bit.ly/titanic-dataset-csv` URL into the **URL** textbox and
    click **OK**.
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`http://bit.ly/titanic-dataset-csv` URL输入到**URL**文本框中，然后点击**确定**。
- en: You’ll see a preview of the data. Then click **Transform Data**.
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到数据的预览。然后点击**转换数据**。
- en: Click **Transform** on the ribbon and then **Run Python script**.
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**转换**，然后**运行Python脚本**。
- en: Enter the script you can find in the file `04-correlation-analysis-in-power-bi-with-python.py`
    into the `Chapter11\Python` folder.
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将你可以在文件`04-correlation-analysis-in-power-bi-with-python.py`中找到的脚本输入到`Chapter11\Python`文件夹中。
- en: We are only interested in the data in `result_df`. So, click its **Table** value.
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们只对`result_df`中的数据感兴趣。因此，点击其**表格**值。
- en: You’ll see the preview of all correlation coefficients between all the columns
    of the dataset.
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到数据集中所有列之间的所有相关系数的预览。
- en: Click **Home** on the ribbon and then click **Close & Apply**.
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**主页**，然后点击**关闭并应用**。
- en: Repeat steps 1 to 3.
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复步骤1到3。
- en: Click **Transform** on the ribbon and then **Run R script**.
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**转换**，然后**运行R脚本**。
- en: Enter the script you can find in the file `04-correlation-analysis-in-power-bi-with-r.R`
    in the `Chapter11\R` folder.
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将你可以在`Chapter11\R`文件夹中找到的文件`04-correlation-analysis-in-power-bi-with-r.R`中的脚本输入。
- en: We are only interested in the data in `corr_tbl`. So, click its **Table** value.
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们只对`corr_tbl`中的数据感兴趣。因此，点击其**表格**值。
- en: You’ll see the preview of all correlation coefficients between all the columns
    of the dataset.
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到数据集中所有列之间的所有相关系数的预览。
- en: Click **Home** on the ribbon and then click **Close & Apply**.
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在功能区点击**主页**，然后点击**关闭并应用**。
- en: Amazing! You have just calculated the correlation coefficients for all the numeric
    columns of a source dataset in Power BI with both Python and R!
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！你刚刚使用Python和R在Power BI中计算了源数据集中所有数值列的相关系数！
- en: Summary
  id: totrans-330
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned how to calculate the correlation coefficient for
    two numerical variables according to Pearson, Spearman, and Kendall. Then you
    also learned how to calculate it for two categorical variables thanks to Cramér's
    V and Theil's uncertainty coefficient. Finally, you also learned how to calculate
    it for one numeric and one categorical variable thanks to the correlation ratio.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了如何根据皮尔逊、斯皮尔曼和肯德尔计算两个数值变量的相关系数。然后你还学习了如何通过卡方和泰尔不确定性系数计算两个分类变量的相关系数。最后，你还学习了如何通过相关比计算一个数值变量和一个分类变量的相关系数。
- en: In the next chapter, you will see how statistics are really important for determining
    outliers and imputing missing values in your dataset.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，你将看到统计在确定数据集中的异常值和填补缺失值中的真正重要性。
- en: References
  id: totrans-333
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'For additional reading, check out the following books and articles:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 对于进一步阅读，请参阅以下书籍和文章：
- en: '*Spearman''s Rank-Order Correlation* ([https://statistics.laerd.com/statistical-guides/spearmans-rank-order-correlation-statistical-guide.php](https://statistics.laerd.com/statistical-guides/spearmans-rank-order-correlation-statistical-guide.php))'
  id: totrans-335
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*斯皮尔曼秩相关系数* ([https://statistics.laerd.com/statistical-guides/spearmans-rank-order-correlation-statistical-guide.php](https://statistics.laerd.com/statistical-guides/spearmans-rank-order-correlation-statistical-guide.php))'
- en: '*Concordant Pairs and Discordant Pairs* ([https://www.statisticshowto.com/concordant-pairs-discordant-pairs/](https://www.statisticshowto.com/concordant-pairs-discordant-pairs/))'
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*一致对和矛盾对* ([https://www.statisticshowto.com/concordant-pairs-discordant-pairs/](https://www.statisticshowto.com/concordant-pairs-discordant-pairs/))'
- en: '*Mosaic Plot and Chi-Square Test* ([https://towardsdatascience.com/mosaic-plot-and-chi-square-test-c41b1a527ce4](https://towardsdatascience.com/mosaic-plot-and-chi-square-test-c41b1a527ce4))'
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*马赛克图和卡方检验* ([https://towardsdatascience.com/mosaic-plot-and-chi-square-test-c41b1a527ce4](https://towardsdatascience.com/mosaic-plot-and-chi-square-test-c41b1a527ce4))'
- en: '*Understanding Boxplots* ([https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51](https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51))'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*理解箱线图* ([https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51](https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51))'
- en: '*Violin plots explained* ([https://towardsdatascience.com/violin-plots-explained-fb1d115e023d](https://towardsdatascience.com/violin-plots-explained-fb1d115e023d))'
  id: totrans-339
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*小提琴图解析* ([https://towardsdatascience.com/violin-plots-explained-fb1d115e023d](https://towardsdatascience.com/violin-plots-explained-fb1d115e023d))'
- en: '*The Search for Categorical Correlation* ([https://towardsdatascience.com/the-search-for-categorical-correlation-a1cf7f1888c9](https://towardsdatascience.com/the-search-for-categorical-correlation-a1cf7f1888c9))'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*寻找分类相关性* ([https://towardsdatascience.com/the-search-for-categorical-correlation-a1cf7f1888c9](https://towardsdatascience.com/the-search-for-categorical-correlation-a1cf7f1888c9))'
