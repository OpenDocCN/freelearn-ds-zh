- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Using Historical Markdown Data to Predict Sales
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用历史降价数据预测销售
- en: Many retailers have no choice but to follow the industry trend of increased
    use of discounts and special marketing to maintain a competitive edge in today’s
    oversaturated market. This is because most of the new customers are more price-sensitive
    and will check prices across websites to discover the bests offers for specific
    products.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 许多零售商别无选择，只能跟随行业趋势，增加折扣和特别促销活动，以维持在当今过度饱和市场中的竞争优势。这是因为大多数新客户更加敏感价格，会在多个网站上比价，寻找特定商品的最佳优惠。
- en: Discounting, however, has its drawbacks. While promotions can speed up sales,
    businesses also run the danger of further profit loss when offering discounts
    without conducting adequate research. One challenge of modeling retail data is
    the need to make decisions based on limited history. If Christmas comes but once
    a year, so does the chance to see how strategic decisions impacted the bottom
    line.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，折扣也有其弊端。虽然促销活动能加速销售，但企业在没有进行充分研究的情况下提供折扣，也面临着进一步利润损失的风险。零售数据建模的一大挑战是需要根据有限的历史数据做出决策。如果圣诞节一年只有一次，那么看到战略决策对底线的影响的机会也只有一次。
- en: In this chapter, we delve deeper into the most recent markdown and discount
    marketing tactics used by industry leaders and show you how to implement them
    while maintaining profit margins. We will use historical sales information from
    45 supermarkets spread across several areas. Although it is well recognized that
    these markdowns have an influence on sales, it can be difficult to foresee which
    departments will be impacted and how much, so our goal will be to forecast the
    sales for each department in each store, which has multiple departments. Selected
    holiday markdown events are included in the dataset to increase the difficulty.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将深入研究行业领先者最新的降价和折扣营销策略，并展示如何在保持利润率的同时实施这些策略。我们将使用来自 45 家超市的历史销售信息，这些超市分布在多个区域。虽然普遍认为这些降价对销售有影响，但很难预见到哪些部门会受到影响，以及影响的程度。因此，我们的目标是预测每个商店中各个部门的销售情况，这些商店有多个部门。选定的假期降价事件也被纳入数据集，以增加难度。
- en: 'In this chapter, we will learn how to do the following:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中，我们将学习以下内容：
- en: Determine sales performance considering all the factors that impact it
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 考虑所有影响销售的因素，确定销售表现
- en: Explore the sales data to determine factors that affect sales
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索销售数据，确定影响销售的因素
- en: Study the effect of promotional markdown on sales during holidays
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 研究促销降价在假期期间对销售的影响
- en: Predict the sales given specific markdowns applied
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在特定降价应用下预测销售
- en: We will be using data that reflects actual real data to try to get as close
    as possible to real-life situations.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用反映实际真实数据的数据，尽量接近现实情况。
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To be able to follow the steps in this chapter, you will need to meet the next
    requirements:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够跟随本章中的步骤，你需要满足以下要求：
- en: A Jupyter notebook instance running Python 3.7 and above. You can use the Google
    Colab notebook to run the steps as well if you have a Google Drive account.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个运行 Python 3.7 及以上版本的 Jupyter notebook 实例。如果你有 Google Drive 账户，你也可以使用 Google
    Colab notebook 来运行这些步骤。
- en: An understanding of basic math and statistical concepts.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解基本的数学和统计概念
- en: Creating effective markdowns
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建有效的降价策略
- en: A markdown is a devaluation of a product because it cannot be sold at the original
    selling price. An example of a discount would be if you have an item that after
    a month of slow sales you decide to discount by 20%. Even if you just lost revenue,
    it also invites more people to buy it at a lower price. Since the item didn’t
    originally sell well, offering a good discounted price can often lead to sales
    that otherwise wouldn’t have happened. However, you will often find that you need
    to pursue your markdown strategies based on slow sales, moving products from 20%
    to 30%, 40%, and more as needed. Timing is particularly important because you
    want to sell the product while it is still relevant to the season, trends, and
    more.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 降价是指产品因未能以原定售价售出而进行的降价处理。一个折扣的例子是，如果你有一件商品，经过一个月的销售低迷后，你决定降价 20%。即使你只是失去了收入，这也会吸引更多人以更低的价格购买它。由于该商品原本销售不佳，提供一个合适的折扣价格通常会导致原本不会发生的销售。然而，你会发现，通常需要根据销售低迷来调整你的降价策略，可能会将折扣从
    20% 调整到 30%、40% 等等。时机尤其重要，因为你希望在商品仍然符合季节、趋势等背景时卖出它。
- en: Markdowns need to be differentiated from discounts. In retail, a discount is
    a reduction in the price of an item or transaction based on the type of customer
    who is buying. The employee discount, senior discount, and frequent shopper discount
    are a few examples. Because of the discounts they receive, many retailers believe
    that this makes the customers more likely to return to their store than to one
    of their competitors.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: Markdown 与折扣需要区分。在零售中，折扣是根据购买者的客户类型对商品或交易价格的降低。例如员工折扣、老年人折扣和常客折扣就是几种例子。由于获得折扣，许多零售商认为这使得顾客更有可能回到他们的商店，而不是去竞争对手的店。
- en: In this chapter, we will use historical sales information from stores located
    in various locations in the US. Each store has a range of departments, and we
    will forecast the department-wide sales. Additionally, the company hosts a number
    of promotional markdown sales all year round, out of which the Super Bowl, Labor
    Day, Thanksgiving, and Christmas are the four biggest holidays.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用位于美国不同地点的商店的历史销售数据。每个商店有多个部门，我们将预测整个部门的销售情况。此外，公司全年举办多次促销 markdown
    销售活动，其中超级碗、劳动节、感恩节和圣诞节是四个最大节假日。
- en: In addition, Walmart runs several promotional markdown events throughout the
    year. These markdowns precede prominent holidays, the four largest of which are
    the Super Bowl, Labor Day, Thanksgiving, and Christmas. The weeks including these
    holidays are weighted five times higher in the evaluation than non-holiday weeks.
    Part of the challenge presented by this competition is modeling the effects of
    markdowns on these holiday weeks in the absence of complete/ideal historical data.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，沃尔玛全年会举行几次促销性 markdown 活动。这些 markdown 活动通常会在重要节假日前进行，其中四个最大的节假日分别是超级碗、劳动节、感恩节和圣诞节。包括这些假期的周数在评估中比非假期周数的权重高五倍。此竞赛面临的挑战之一是，在没有完整/理想的历史数据的情况下，如何建模假期周数中
    markdown 对销售的影响。
- en: In the next section, we will analyze the data to understand the variables, its
    distribution, and we will structure it for better visualization and for use in
    machine learning.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将分析数据以理解变量及其分布，并将其结构化以便于可视化和用于机器学习。
- en: Analyzing the data
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据分析
- en: We are provided with 3 files, which contain anonymized information about the
    45 stores, indicating the type and size of the store, historical training data,
    which covers 2010-02-05 to 2012-11-01, and a file that contains additional data
    related to the store, department, and regional activity for the given dates.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们提供了 3 个文件，分别包含关于 45 家商店的匿名信息，指出商店的类型和规模、涵盖 2010-02-05 至 2012-11-01 的历史训练数据，以及一个包含与给定日期的商店、部门和区域活动相关的附加数据的文件。
- en: 'In the next example, the following Python modules were used:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个示例中，使用了以下 Python 模块：
- en: 'pandas: A Python package for data analysis and data manipulation'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pandas：一个用于数据分析和数据处理的 Python 包
- en: 'NumPy: This is a library that adds support for large, multi-dimensional arrays
    and matrices, along with an ample collection of high-level mathematical functions
    to operate on these arrays'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NumPy：这是一个库，支持大规模的多维数组和矩阵，并提供丰富的高阶数学函数用于对这些数组进行操作。
- en: 'Seaborn and Matplotlib: Python packages for effective data visualization'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Seaborn 和 Matplotlib：用于有效数据可视化的 Python 包
- en: 'We will start the analysis by importing the libraries, and we will start to
    analyze the data by reading all the files and parsing the `Date` column using
    the `parse_date` option of the `read_csv` pandas function:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将通过导入库开始分析，并通过读取所有文件并使用`read_csv` pandas 函数的 `parse_date` 选项解析 `Date` 列来开始分析数据：
- en: '[PRE0]'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '[PRE1]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[PRE3]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '[PRE5]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now that all the files are loaded, we can start by looking at the first rows
    of the train file:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在所有文件已加载完毕，我们可以通过查看训练文件的前几行开始：
- en: '[PRE8]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![Figure 9.1: Train file with weekly sales for the store, day, and department
    ](img/B19026_09_1.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.1：商店、日期和部门的每周销售训练文件](img/B19026_09_1.jpg)'
- en: 'Figure 9.1: Train file with weekly sales for the store, day, and department'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.1：商店、日期和部门的每周销售训练文件
- en: The file contains weekly sales data for each store and department, flagging
    also whether this day is a holiday or not.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件包含每个商店和部门的每周销售数据，并标明该日是否为假期。
- en: 'We will also introduce some date variables to make the analysis easier:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将引入一些日期变量，以便使分析更为简便：
- en: '[PRE9]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The next file we will look at contains information about each story in terms
    of type and size. We can use this information later to assess if the effects of
    markdown vary depending on the store characteristics:'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将要查看的下一个文件包含关于每家商店类型和规模的信息。我们可以稍后使用这些信息来评估降价的效果是否会根据商店特征的不同而有所变化：
- en: '[PRE10]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![Figure 9.2: Store type and size data ](img/B19026_09_2.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.2：商店类型和规模数据](img/B19026_09_2.jpg)'
- en: 'Figure 9.2: Store type and size data'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.2：商店类型和规模数据
- en: 'We can start to visualize the data by looking at the distribution of sales
    types and sizes using the boxplot from Seaborn. In the next block of code, we
    create a subset of data concatenating the **Type** and **Size** columns of the
    store’s data. Then, we create a figure, using Matplotlib, of 8x6 inches, which
    will contain the seaborn figure:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过使用 Seaborn 的箱形图，开始可视化销售类型和规模的分布。在接下来的代码块中，我们将创建一个数据子集，将商店数据的**类型**和**规模**列进行拼接。然后，我们使用
    Matplotlib 创建一个 8x6 英寸的图形，图形中将包含 Seaborn 图：
- en: '[PRE11]'
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '[PRE13]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The code will show us the distribution of the store size.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 代码将展示商店规模的分布情况。
- en: '![Figure 9.3: Store type and size data ](img/B19026_09_3.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.3：商店类型和规模数据](img/B19026_09_3.jpg)'
- en: 'Figure 9.3: Store type and size data'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.3：商店类型和规模数据
- en: Within size, we can see that there are three types of stores, out of which type
    A is the biggest. It is interesting to see the variation between the quantiles
    as well as the outliers.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在规模方面，我们可以看到有三种类型的商店，其中 A 类型是最大的。看到分位数之间的变化以及异常值是很有趣的。
- en: 'Finally, the next file contains more contextual data about each day and store.
    This information is about temperature, fuel price, and the different markdowns
    applied divided into five types, consumer price index, unemployment, and information
    about whether the day was a holiday or not:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，接下来的文件包含更多关于每一天和商店的上下文数据。这些信息包括温度、燃料价格、应用的不同降价类型，分为五种类型，还有消费者物价指数、失业率，以及关于该天是否是节假日的信息：
- en: '[PRE14]'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![Figure 9.4: Contextual data by store ](img/B19026_09_4.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.4：按商店分类的上下文数据](img/B19026_09_4.jpg)'
- en: 'Figure 9.4: Contextual data by store'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.4：按商店分类的上下文数据
- en: 'We will use the `merge` method in the `train` pandas DataFrame to attach information
    about the day, the size of the store, and the type contained in the store’s DataFrame:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在 `train` 的 pandas DataFrame 中使用 `merge` 方法，来附加关于日期、商店规模和类型的信息，这些数据来源于商店的
    DataFrame：
- en: '[PRE15]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The previous code will merge the data and show the first few lines.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的代码将合并数据并显示前几行。
- en: '![Figure 9.5: Weekly sales data with information about holidays, store type,
    and size ](img/B19026_09_5.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.5：带有节假日、商店类型和规模信息的每周销售数据](img/B19026_09_5.jpg)'
- en: 'Figure 9.5: Weekly sales data with information about holidays, store type,
    and size'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.5：带有节假日、商店类型和规模信息的每周销售数据
- en: 'We can now visualize the distribution of weekly sales by type of store. We
    will create a subset of data using the **Type** and **Weekly_Sales** column, creating
    a Matplotlib figure of 8x6 inches, which then is filled with a seaborn boxplot:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以通过商店类型的分布来可视化每周销售数据。我们将创建一个包含**类型**和**每周销售**列的数据子集，创建一个 8x6 英寸的 Matplotlib
    图形，然后填充一个 Seaborn 箱形图：
- en: '[PRE16]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: This will generate boxplot visualizations by type of store.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 这将根据商店类型生成箱形图的可视化。
- en: '![Figure 9.6: Boxplot of weekly sales by type ](img/B19026_09_6.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.6：按类型的每周销售数据箱形图](img/B19026_09_6.jpg)'
- en: 'Figure 9.6: Boxplot of weekly sales by type'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.6：按类型的每周销售数据箱形图
- en: In relation to the type of store, we can see that although the A is the smallest
    one, it is the one with the highest median sales.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 关于商店的类型，我们可以看到，尽管 A 类型是最小的，但它的销售中位数却是最高的。
- en: 'We will now create a boxplot of the distribution of sales data by store ID.
    We create a subset of data with the columns **Store** and **Weekly_Sales** from
    the train data, create a Matplotlib figure of 25x8 inches, and show a seaborn
    boxplot where the x-axis is the store ID and a color differentiation by type:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在将创建一个按商店 ID 分布的销售数据箱形图。我们从训练数据中提取**商店**和**每周销售**列，创建一个 25x8 英寸的 Matplotlib
    图形，然后显示一个 Seaborn 箱形图，x 轴为商店 ID，按类型进行颜色区分：
- en: '[PRE17]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The code will generate boxplots of the weekly sales by store.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 该代码将生成每周按商店分布的箱形图。
- en: '![Figure 9.7: Weekly sales data by store ID and type ](img/B19026_09_7.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.7：按商店 ID 和类型的每周销售数据](img/B19026_09_7.jpg)'
- en: 'Figure 9.7: Weekly sales data by store ID and type'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.7：按商店 ID 和类型的每周销售数据
- en: From the boxplot, we can see that store can be the variable giving information
    on sales, as there is a consistent pattern of high upper boundaries sales in all
    types. This is an indication that there are moments in which the demand increases
    in a short amount of time. Also, there are no indications of having moments in
    which the demand falls drastically under the median.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 从箱线图中，我们可以看出，门店可能是提供销售信息的变量，因为在所有类型中，销售的上边界有一致的高值模式。这表明在某些时刻，需求在短时间内增加。此外，数据中没有出现需求在中位数以下大幅下降的情况。
- en: Much intrinsic information on type, size, and department is included in the
    store data. Therefore, we will look at how the holidays impact sales.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 门店数据中包含了许多关于类型、规模和部门的内在信息。因此，我们将探讨节假日如何影响销售。
- en: 'We repeat the same pattern of creating a subset of data, a Matplotlib figure,
    and a seaborn boxplot, but now the hue variable is set to the **IsHoliday** column:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们重复相同的步骤：创建数据子集、绘制 Matplotlib 图形和 seaborn 箱线图，但现在的 hue 变量设置为**IsHoliday**列：
- en: '[PRE20]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '[PRE21]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[PRE22]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: This code will show us the distribution of sales with even more levels of information.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码将展示更多层次的销售信息分布。
- en: '![Figure 9.8: Weekly sales data by store ID during and excluding holidays ](img/B19026_09_8.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.8：按门店 ID 划分的每周销售数据，包括节假日与不包括节假日](img/B19026_09_8.jpg)'
- en: 'Figure 9.8: Weekly sales data by store ID during and excluding holidays'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.8：按门店 ID 划分的每周销售数据，包括节假日与不包括节假日
- en: We can see from the data that **Holiday** and **Store** do not show significant
    relations except for a small higher sales soaring during the holiday day. This
    may imply that most of the sales are done days before the holiday itself.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 从数据中可以看出，**Holiday** 和 **Store** 之间没有显著的关系，除了在节假日当天销售略有上升。这可能意味着大部分销售是在节假日前几天完成的。
- en: 'Now, let us dive into the difference in sales by type of department. To do
    this, we will create a subset of data as the grouping of the weekly sales per
    department, then apply the mean, and reset the index. We show the data using a
    bar plot because otherwise, it would be impossible to see at glance any difference
    in a boxplot because of the number of departments:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们深入探讨按部门类型划分的销售差异。为此，我们将创建一个数据子集，作为每个部门每周销售的分组，然后计算均值并重置索引。我们使用条形图展示数据，因为如果使用箱线图，难以一眼看出部门之间的差异，原因是部门数量太多：
- en: '[PRE23]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[PRE24]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '[PRE25]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: This visualization will give us a perspective of sales by department.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 这项可视化将为我们提供按部门划分的销售视角。
- en: '![Figure 9.9: Weekly median sale by department ](img/B19026_09_9.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.9：按部门划分的每周中位销售额](img/B19026_09_9.jpg)'
- en: 'Figure 9.9: Weekly median sale by department'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.9：按部门划分的每周中位销售额
- en: We can see that there is variation between the sales of different departments.
    We have a high concentration of revenue in some of them, which could lead us to
    consider excluding the ones with smaller sales. This may not be appropriate as
    these departments may allow customers that just look for those items to go to
    that store and then buy other items. You could study this further using analysis
    such as the Apriori algorithm.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到不同部门的销售存在差异。某些部门的收入高度集中，这可能促使我们考虑排除那些销售较小的部门。但这可能并不合适，因为这些部门可能吸引那些只需要特定商品的顾客前来，并最终购买其他商品。你可以使用如
    Apriori 算法等方法进一步研究这一点。
- en: 'Next, we will visualize the weekly sales by month to glimpse at the seasonality
    of the data. We create a subset of data with the columns and visualize the data
    with a boxplot:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将可视化按月份划分的每周销售，以窥探数据的季节性。我们创建包含相关列的数据子集，并使用箱线图可视化数据：
- en: '[PRE26]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '[PRE28]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: The following is the distribution of monthly sales.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是月度销售的分布情况。
- en: '![Figure 9.10: Weekly sales by month ](img/B19026_09_10.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.10：按月份划分的每周销售数据](img/B19026_09_10.jpg)'
- en: 'Figure 9.10: Weekly sales by month'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.10：按月份划分的每周销售数据
- en: 'We can explore the monthly sales further by visualizing the behavior of the
    holidays in the sales by month. We do this by setting the hue value of the boxplot
    to `IsHoliday`:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过可视化节假日在月度销售中的表现，进一步探索月度销售数据。我们通过将箱线图的 hue 值设置为`IsHoliday`来实现这一点：
- en: '[PRE29]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The following plot is the distribution of sales by month and holidays.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表展示了按月份和节假日划分的销售分布。
- en: '![Figure 9.11: Weekly sales by month differentiating holidays ](img/B19026_09_11.jpg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.11：按月份区分节假日的每周销售数据](img/B19026_09_11.jpg)'
- en: 'Figure 9.11: Weekly sales by month differentiating holidays'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.11：按月份区分节假日的每周销售数据
- en: For most of the holidays, the sales on the day of the holiday are slightly higher
    than on regular days, apart from Christmas, which is in December.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大多数节假日，假期当天的销售稍高于常规日，圣诞节除外，圣诞节是在 12 月。
- en: 'Now, we can create a seaborn relplot to visualize the data per week:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以创建一个 seaborn 的 relplot 来按周可视化数据：
- en: '[PRE30]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: This plot shows us the median and the confidence intervals.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 这个图表显示了中位数和置信区间。
- en: '![Figure 9.12: Weekly sales through time ](img/B19026_09_12.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.12: 随时间变化的每周销售](img/B19026_09_12.jpg)'
- en: 'Figure 9.12: Weekly sales through time'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.12: 随时间变化的每周销售'
- en: By looking at the relplot, we can see the sharp increase in sales between weeks
    40 and 50.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看 relplot，我们可以看到第 40 周到第 50 周之间销售的急剧增长。
- en: 'We can visualize the weekly sales data by using a boxplot with `Week` on the
    x-axis and the `Weekly_Sales` column on the y-axis :'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用箱线图来可视化每周销售数据，将 `Week` 放在 x 轴，将 `Weekly_Sales` 列放在 y 轴：
- en: '[PRE31]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '[PRE32]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '[PRE33]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: This plot shows us the median and the confidence intervals by week of the year.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 该图表显示了每年按周的中位数和置信区间。
- en: '![Figure 9.13: Weekly sales by the week of the year ](img/B19026_09_13.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.13: 每年按周的销售](img/B19026_09_13.jpg)'
- en: 'Figure 9.13: Weekly sales by the week of the year'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.13: 每年按周的销售'
- en: We can see now that the holiday in the first month of the year produces a minor
    increase, while the ones in the last part of the year have the biggest increase
    in sales, including a sudden drop in the week after.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以看到，年初的假期带来了小幅增长，而年末的假期则带来了最大的销售增长，包括随后的一个星期的急剧下降。
- en: 'We can plot the data now using a seaborn relplot using the dates and the weekly
    sales as well as making a differentiation by type of store with the hue parameter:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以使用 seaborn 的 relplot 绘制数据，使用日期和每周销售数据，并通过 hue 参数按商店类型进行区分：
- en: '[PRE34]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '[PRE35]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: The preceding code plots the data with a confidence band.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码绘制了带有置信带的数据。
- en: '![Figure 9.14: Weekly sales through time ](img/B19026_09_14.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.14: 随时间变化的每周销售](img/B19026_09_14.jpg)'
- en: 'Figure 9.14: Weekly sales through time'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.14: 随时间变化的每周销售'
- en: We can observe that the same patterns repeat in the two years of data contained,
    which could be further explained if we would look at the seasonality of the data,
    which are the recurring patterns that happen every certain period of time. The
    cycles of buying patterns repeat during the last part of the year, showing a sharp
    increase during the weeks before Christmas.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以观察到，两个年份中的数据呈现出相同的模式，这可以通过进一步分析数据的季节性来解释。季节性是指在某些时间段内反复出现的模式。购买模式的周期在每年末重复，并在圣诞节前几周出现急剧增长。
- en: 'Our next step will be to analyze the mean values of weekly sales, making a
    differentiation by week and markdown applied. To do this, first, we will group
    the weekly sales by week and apply the mean, and we print the shape as a sanity
    test:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的下一步将是分析每周销售的均值，按周和应用的降价进行区分。为此，首先我们将每周销售按周进行分组并计算均值，然后打印形状进行合理性测试：
- en: '[PRE37]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '[PRE38]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '[PRE39]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Then, we can get the information from the features DataFrame about markdowns
    applied in that specific week and apply the mean as well:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以从特征数据框中获取有关该特定周应用的降价信息，并计算均值：
- en: '[PRE40]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'We can now merge both DataFrames and obtain information about the median sale
    per week as well as the type of markdown applied:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以合并两个数据框，并获得每周的中位销售信息以及所应用的降价类型：
- en: '[PRE41]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '[PRE42]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '[PRE43]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '[PRE44]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '![Figure 9.15: Median weekly sales and markdowns per week ](img/B19026_09_15.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.15: 每周中位数销售和每周降价](img/B19026_09_15.jpg)'
- en: 'Figure 9.15: Median weekly sales and markdowns per week'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.15: 每周中位数销售和每周降价'
- en: 'Using this information, we can now plot the data to see the impact of discounts
    in comparison with the weekly sales:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这些信息，我们现在可以绘制数据，查看折扣与每周销售之间的影响：
- en: '[PRE45]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '![Figure 9.16: Median weekly sales and markdowns per week ](img/B19026_09_16.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.16: 每周中位数销售和每周降价](img/B19026_09_16.jpg)'
- en: 'Figure 9.16: Median weekly sales and markdowns per week'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.16: 每周中位数销售和每周降价'
- en: We can see from the data that many markdowns are applied immediately before
    Christmas and then in the weeks that follow it. The answer may be that these markdowns
    are applied to reduce the stock of products that were not bought during the holiday
    period.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 从数据中我们可以看到，许多降价是在圣诞节前立即实施的，然后在接下来的几周内继续进行。其原因可能是，这些降价是为了减少在假期期间未售出的库存。
- en: 'Now, we will look at the relationship between sales and the features describing
    the conditions for each day and store. To do this, we group the sales data by
    week and apply the mean. We then do the same for the features data and finally
    merge both DataFrames:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将查看销售与描述每一天和每个商店条件的特征之间的关系。为此，我们按周对销售数据进行分组并计算均值。然后，我们对特征数据执行相同操作，最后将两个
    DataFrame 合并：
- en: '[PRE46]'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '[PRE47]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '[PRE48]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '[PRE49]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: '[PRE50]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: The previous code will show us the merged data.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的代码将展示我们合并后的数据。
- en: '![Figure 9.17: Median weekly contextual data ](img/B19026_09_17.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.17：每周中位数上下文数据](img/B19026_09_17.jpg)'
- en: 'Figure 9.17: Median weekly contextual data'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.17：每周中位数上下文数据
- en: 'We can now use the information to construct a seaborn pair plot to visualize
    any relationship. We exclude the `Week` and `IsHoliday` variables, the latter
    because categorical variables are difficult to visualize with this type of plot:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以利用这些信息构建一个 seaborn 配对图来可视化任何关系。我们排除了`Week`和`IsHoliday`变量，后者是因为类别变量难以通过这种类型的图进行可视化：
- en: '[PRE51]'
  id: totrans-158
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: The code will create a plot with the relationship between the numerical variables.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 代码将创建一个显示数值变量之间关系的图表。
- en: '![Figure 9.18: Feature pair plot ](img/B19026_09_18.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.18：特征配对图](img/B19026_09_18.jpg)'
- en: 'Figure 9.18: Feature pair plot'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.18：特征配对图
- en: We can see that although we would be able to better appreciate the relationships,
    most of the weekly sales have a similar mean per week, making it difficult to
    differentiate meaningful relationships with CPI, unemployment, or fuel price.
    We should repeat the exercise without grouping the data, which would consequently
    give us more information but would take a bit more processing time.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，尽管我们能够更好地理解这些关系，但大部分每周销售的均值每周相似，这使得与 CPI、失业率或油价之间的有意义关系难以区分。我们应该不对数据进行分组，重新进行此操作，这样会得到更多信息，但需要更多的处理时间。
- en: To predict the sales, first, we need to manipulate the data and make some decisions.
    The first is at which level we want to make the predictions in terms of time.
    In our case, we will use `predict` for weekly sales. We will group all the data
    into a single DataFrame in which each data point is enriched with information
    about both the store as well as the conditions of that day.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了预测销售，首先，我们需要处理数据并做出一些决策。第一个决策是我们希望在哪个时间层级进行预测。在我们的案例中，我们将使用`predict`进行每周销售的预测。我们会将所有数据合并到一个
    DataFrame 中，在该 DataFrame 中，每个数据点都附加了关于商店以及那天条件的信息。
- en: 'We also transform the Type column into a one-hot vector representation using
    the `pd.get_dummies` function:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将 Type 列转换为一-hot 向量表示，使用 `pd.get_dummies` 函数：
- en: '[PRE52]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: We can see the created columns in the DataFrame.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到 DataFrame 中创建的列。
- en: '![Figure 9.19: Dataset with no encoded variable ](img/B19026_09_19.jpg)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.19：没有编码变量的数据集](img/B19026_09_19.jpg)'
- en: 'Figure 9.19: Dataset with no encoded variable'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.19：没有编码变量的数据集
- en: This configuration of data allows us to extend the exploration to the analysis
    of correlations between the variables, which in turn sets the stage to start using
    the data to predict sales.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 这种数据配置使我们能够扩展探索，分析变量之间的相关性，进而为使用数据预测销售奠定基础。
- en: 'The next block of code will use the `corr()` method of the `pandas` DataFrame
    to analyze the correlation between variables, and we will use the `numpy` package
    to mask the redundant values and finally plot the data using the seaborn `heatmap`
    visualization:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 下一段代码将使用 `pandas` DataFrame 的 `corr()` 方法分析变量之间的相关性，我们将使用 `numpy` 包来屏蔽冗余的值，最后使用
    seaborn 的 `heatmap` 可视化工具绘制数据：
- en: '[PRE53]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: The preceding code will create the correlation plot of the variables.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将创建变量相关性的可视化图。
- en: '![Figure 9.20: Variables correlation ](img/B19026_09_20.jpg)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.20：变量相关性](img/B19026_09_20.jpg)'
- en: 'Figure 9.20: Variables correlation'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.20：变量相关性
- en: We can see some interesting correlations, for example, the positive correlation
    between the size of markdown 2 and 3 and the size of the store, and the positive
    correlation between the size of markdown 1 and 4.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到一些有趣的相关性，例如，折扣 2 和 3 的大小与商店大小之间的正相关性，以及折扣 1 和 4 的大小之间的正相关性。
- en: 'Finally, we can show the degree of correlation between the variables and the
    weekly sales:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们可以展示变量与每周销售之间的相关性程度：
- en: '[PRE54]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '[PRE55]'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: '[PRE56]'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: The following barplot will show us the most correlated variables.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 以下条形图将展示我们最相关的变量。
- en: '![Figure 9.21: Variables correlation sorted ](img/B19026_09_21.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.21：排序后的变量相关性](img/B19026_09_21.jpg)'
- en: 'Figure 9.21: Variables correlation sorted'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.21：排序后的变量相关性
- en: We can see that the weekly sales are highly influenced by the size of the store
    positively, followed by markdowns 5 and 1\. It is negatively correlated with unemployment
    and **Consumer Price Index** (**CPI**), which makes sense.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到每周销售受商店大小的正向影响最大，其次是 markdowns 5 和 1。它与失业率和**消费者价格指数**（**CPI**）呈负相关，这也是合理的。
- en: Now that we have a better understanding of the data, we will start the process
    of making predictions on weekly sales.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对数据有了更好的理解，我们将开始进行每周销售预测的过程。
- en: Predicting sales with Prophet
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Prophet 预测销售
- en: 'Forecasting a time series can be a challenging task if there are many different
    methods you can use and many different hyperparameters for each method. The Prophet
    library is an open source library designed to make predictions for univariate
    time series data sets. It is easy to use and designed to automatically find a
    good set of hyperparameters for the model to make competent predictions for data
    with standard trends and seasonal structure. We will learn how to use the Facebook
    Prophet package to predict the weekly sales time series:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 预测时间序列可能是一个具有挑战性的任务，因为你可以使用许多不同的方法，并且每种方法都有许多不同的超参数。Prophet 库是一个开源库，旨在为单变量时间序列数据集进行预测。它易于使用，并设计为自动找到一组良好的超参数，使模型能够为具有标准趋势和季节性结构的数据做出有竞争力的预测。我们将学习如何使用
    Facebook Prophet 包来预测每周销售时间序列：
- en: 'First, we will import the library and create a dataset that contains all the
    features described as either continuous variables or one-hot representations:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将导入库并创建一个包含所有描述为连续变量或独热表示的特征的数据集：
- en: '[PRE57]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '[PRE58]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '[PRE59]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: '[PRE60]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: '[PRE61]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Filter results for Store 1, as we will train a model that learns the behavior
    of each specific store:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 过滤 Store 1 的结果，因为我们将训练一个能够学习每个特定商店行为的模型：
- en: '[PRE62]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'For the Prophet package, we need to prepare some expected column names with
    a specific data type. In this case, we need to pass `ds` and `y` variables, the
    first being a `datetime` type of column:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于 Prophet 包，我们需要准备一些具有特定数据类型的预期列名。在这种情况下，我们需要传递 `ds` 和 `y` 变量，第一个是 `datetime`
    类型的列：
- en: '[PRE63]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: '[PRE64]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Now that we have created the columns with the proper data types, we can drop
    the redundant columns and show the first lines:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经创建了具有正确数据类型的列，我们可以删除冗余列并显示前几行：
- en: '[PRE66]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '![Figure 9.22: Data to be used for model training ](img/B19026_09_22.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.22：用于模型训练的数据](img/B19026_09_22.jpg)'
- en: 'Figure 9.22: Data to be used for model training'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.22：用于模型训练的数据
- en: We can now split the data into train and test data sets.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以将数据分为训练数据集和测试数据集。
- en: '[PRE67]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Finally, we can define the model that we will use. In this case, we need to
    establish linear growth with multiplicative seasonality. In this case, we have
    also included weekly seasonality:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们可以定义将使用的模型。在这种情况下，我们需要建立线性增长和乘法季节性。在这种情况下，我们还包括了每周季节性：
- en: '[PRE68]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '[PRE69]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: '[PRE70]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: '[PRE71]'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: '[PRE72]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: '[PRE73]'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: Before training the forecaster, we can add regressors that use the additional
    variables.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在训练预测模型之前，我们可以添加使用附加变量的回归器。
- en: 'Here, the `add_regressor` argument is the column name of the additional variable
    in the training DataFrame:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`add_regressor` 参数是训练数据框中附加变量的列名：
- en: '[PRE74]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: Note that here we are adding additional variables as regressors to the model.
    These variables should have values for your future (test) data. One key factor
    is that we are using the same parameters for all of the variables, while fine-tuning
    these parameters for each one of the variables is advised instead of this method.
    Although, the selection of each one of these parameters in consideration of the
    specifics of each variable is beyond the scope of this analysis.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这里我们正在将附加变量作为回归器添加到模型中。这些变量应具有未来（测试）数据的值。一个关键因素是，我们对所有变量使用相同的参数，而建议的做法是对每个变量单独进行调优，尽管根据每个变量的具体情况来选择这些参数超出了本分析的范围。
- en: 'Finally, we can fit the model:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以拟合模型：
- en: '[PRE75]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'After the model has been trained, we can use it to make forecasts on the test
    data to evaluate the performance of the prediction:'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 模型训练完成后，我们可以使用它对测试数据进行预测，以评估预测的表现：
- en: '[PRE76]'
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: '[PRE77]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '[PRE78]'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'We can access the resulting forecast that shows us the predicted values for
    each date, along with the upper and lower boundaries:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以访问结果预测，展示每个日期的预测值，以及上下边界：
- en: '[PRE79]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: '![Figure 9.23: Forecasted data ](img/B19026_09_23.jpg)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.23：预测数据](img/B19026_09_23.jpg)'
- en: 'Figure 9.23: Forecasted data'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.23：预测数据
- en: 'Now, we can concatenate these results with the actual values for y in the test
    data to visualize the results. The resulting curves are softened using a rolling
    average with a window of seven lags for visualization purposes:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以将这些结果与测试数据中y的实际值连接起来，以可视化结果。为便于可视化，生成的曲线采用七天滞后的滚动平均进行平滑处理：
- en: '[PRE80]'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: '[PRE81]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: '[PRE82]'
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: '[PRE83]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: The preceding code will generate a visualization where we can see the actual
    sales versus the actual results.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将生成一个可视化图，我们可以看到实际销售与实际结果的对比。
- en: '![Figure 9.24: Forecasted data against actual values ](img/B19026_09_24.jpg)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.24：预测数据与实际值对比](img/B19026_09_24.jpg)'
- en: 'Figure 9.24: Forecasted data against actual values'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.24：预测数据与实际值对比
- en: We can see that, apart from certain cases, most of the time the predicted value
    has been close to the actual values, in rare times surpassing the upper boundary
    but never the lower.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，除了个别情况外，大多数情况下，预测值与实际值接近，极少出现超出上限的情况，但从未低于下限。
- en: Summary
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have dived into the details of sales analysis and markdown
    applications. As discussed, there is a trade-off between reducing the price of
    items to increase sales and reduce stock-related costs and the amount of revenue
    that is lost due to that decrease in price. In the case of retail, these outcomes
    are impacted by multiple factors, among which are the location of a given store,
    the environmental and economic conditions, and seasonality, as we saw with the
    analysis of sales during different holiday seasons.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们已深入探讨了销售分析和降价应用的细节。如前所述，降低商品价格以增加销售和减少库存相关成本之间存在一定的权衡，而这种降价会导致一定的收入损失。在零售的情况下，这些结果受到多个因素的影响，其中包括某个店铺的位置、环境和经济条件，以及季节性因素，正如我们通过不同节假日销售分析所看到的那样。
- en: The analysis and prediction of sales and markdowns can be applied to fine-tune
    the price reductions applied to maintain the equilibrium between profitability
    and sales, as well as to have a deep understanding of the variables involved and
    their relative impact that can lead to the design of better markdown strategies.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 销售和降价的分析与预测可以帮助微调应用的降价策略，从而维持盈利性和销售之间的平衡，并深入理解涉及的变量及其相对影响，这有助于设计更好的降价策略。
- en: In the next chapter, we will dive into the specifics of learning the consumer
    behavior at e-commerce retailers, understanding consumer segmentation, predicting
    consumer lifetime value, and predicting which users will eventually buy.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将深入探讨电子商务零售商如何学习消费者行为、理解消费者细分、预测消费者生命周期价值，以及预测哪些用户最终会购买。
