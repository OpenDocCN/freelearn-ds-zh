- en: '15'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '15'
- en: Taming Data with Tableau Prep
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Tableau Prep整理数据
- en: 'We considered some options for structuring data in Tableau Desktop in the previous
    chapter. Many of the concepts around well-structured data will apply here as we
    now turn our attention to another product from Tableau: **Tableau Prep**. Tableau
    Prep extends the Tableau platform with robust options for cleaning and structuring
    data for analysis in Tableau. In the same way that Tableau Desktop provides a
    hands-on, visual experience for visualizing and analyzing data, Tableau Prep provides
    a hands-on, visual experience for cleaning and shaping data.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一章中，我们考虑了在Tableau Desktop中构建数据结构的几种选项。有关结构良好的数据的许多概念将在此处应用，因为我们现在将注意力转向Tableau的另一款产品：**Tableau
    Prep**。Tableau Prep扩展了Tableau平台，提供了强大的数据清理和结构化选项，便于在Tableau中进行分析。正如Tableau Desktop为数据可视化和分析提供了一个直观、交互的体验，Tableau
    Prep则为数据清理和整形提供了一个直观、交互的体验。
- en: Tableau Prep is on an accelerated, monthly release cycle and while the platform
    continues to grow and expand, there is an underlying paradigm that sets a foundation
    for cleaning and shaping data. We'll cover a lot of ground in this chapter, but
    our goal is not to cover every possible feature—and indeed, we won't. Instead,
    we will seek to understand the underlying paradigm and flow of thought that will
    enable you to tackle a multitude of data challenges in Tableau Prep.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep处于加速的每月发布周期中，虽然该平台不断增长和扩展，但其背后有一个基本的范式，为数据清理和整形奠定了基础。我们将在本章中覆盖大量内容，但我们的目标不是覆盖每一个可能的功能——实际上，我们不会。相反，我们将寻求理解那个基础范式和思考流程，这将帮助您在Tableau
    Prep中应对多种数据挑战。
- en: In this chapter, we'll work through a couple of practical examples as we explore
    the paradigm of Tableau Prep, understand the fundamental transformations, and
    see many of the features and functions of Tableau Prep.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将通过几个实际的示例来探讨Tableau Prep的范式，理解基本的转换操作，并了解Tableau Prep的许多功能和特性。
- en: 'We''ll cover quite a few topics in this chapter, including the following:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖多个主题，包括以下内容：
- en: Getting ready to explore Tableau Prep
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备好探索Tableau Prep
- en: Understanding the Tableau Prep Builder interface
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解Tableau Prep Builder界面
- en: Flowing with the fundamental paradigm
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按照基本范式进行数据流动
- en: Connecting to data
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接数据
- en: Cleaning the data
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 清理数据
- en: Calculations and aggregations in Tableau Prep
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tableau Prep中的计算和聚合
- en: Filtering data in Tableau Prep
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Tableau Prep中过滤数据
- en: Transforming the data for analysis
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为分析转化数据
- en: Options for automating flows
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动化数据流的选项
- en: 'In this chapter, we''ll use the term Tableau Prep broadly to speak of the entire
    platform that Tableau has developed for data prep and sometimes as shorthand for
    Tableau Prep Builder, the client application that''s used to connect to data,
    create data flows, and define output. Where needed for clarity, we''ll use these
    specific names:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将广泛使用“Tableau Prep”这一术语，指代Tableau为数据准备开发的整个平台，有时也作为Tableau Prep Builder的简称，后者是用于连接数据、创建数据流和定义输出的客户端应用程序。在需要明确时，我们将使用这些具体名称：
- en: '**Tableau Prep Builder**: The client application that''s used to design data
    flows, run them locally, and publish them'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Tableau Prep Builder**：用于设计数据流、在本地运行它们并发布的客户端应用程序'
- en: '**Tableau Prep Conductor**: An add-on to Tableau Server that allows the scheduling
    and automation of published data flows'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Tableau Prep Conductor**：这是Tableau Server的一个附加组件，允许对已发布的数据流进行调度和自动化处理。'
- en: Let's start by understanding how to get started with Tableau Prep.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从了解如何开始使用Tableau Prep开始。
- en: Getting ready to explore Tableau Prep
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备好开始探索Tableau Prep
- en: Tableau Prep Builder is available for Windows and Mac. If you do not currently
    have Tableau Prep Builder installed on your machine, please take a moment to download
    the application from [https://www.tableau.com/products/prep/download](https://www.tableau.com/products/prep/download).
    Licenses for Tableau Prep Builder are included with Tableau Creator licensing.
    If you do not currently have a license, you may trial the application for 14 days.
    Please speak with your Tableau representative to confirm licensing and trial periods.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep Builder适用于Windows和Mac。如果您当前没有在机器上安装Tableau Prep Builder，请花点时间从[https://www.tableau.com/products/prep/download](https://www.tableau.com/products/prep/download)下载该应用程序。Tableau
    Prep Builder的许可证包含在Tableau Creator许可中。如果您当前没有许可证，您可以免费试用该应用程序14天。请与您的Tableau代表联系，以确认许可和试用期。
- en: The examples in this chapter use files located in the `\Learning Tableau\Chapter
    15` directory. Specific instructions will guide you on when and how to use the
    various files.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的示例使用的文件位于 `\Learning Tableau\Chapter 15` 目录下。具体说明将指导你何时以及如何使用这些文件。
- en: Once you've downloaded and installed Tableau Prep Builder, you will be able
    to launch the application. Once you do, you'll find a welcome screen that we'll
    detail as we cover the interface in the next section.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你下载并安装了 Tableau Prep Builder，你将能够启动应用程序。启动后，你将看到一个欢迎屏幕，我们将在下一节中详细介绍该界面。
- en: Understanding the Tableau Prep Builder interface
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解 Tableau Prep Builder 界面
- en: 'You''ll find a lot of similarities in the interfaces of Tableau Prep Builder
    and Tableau Desktop. The home screen of Tableau Prep Builder will look similar
    to this:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 你会发现 Tableau Prep Builder 和 Tableau Desktop 的界面有很多相似之处。Tableau Prep Builder
    的主屏幕看起来将类似于以下内容：
- en: '![](img/B16021_15_01.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_01.png)'
- en: 'Figure 15.1: The Tableau Prep Builder welcome screen with numbering to identify
    key components of the UI'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.1：Tableau Prep Builder 欢迎屏幕，数字标注用以识别界面中的关键组件
- en: 'The following components have been numbered in *Figure 15.1*:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 以下组件在*图 15.1*中已被编号：
- en: The menu includes options for opening files, editing and running flows, signing
    into Tableau Server, and various **Help** functions. Also notice the **Connections**
    Pane to the left, immediately beneath the **File** menu. It is collapsed initially,
    but will contain a list of data connections as you create them.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 菜单包括打开文件、编辑和运行流、登录 Tableau Server 以及各种**帮助**功能的选项。还可以注意到左侧紧挨着**文件**菜单的**连接**面板。初始时它是折叠的，但随着你创建数据连接，它将包含一个数据连接列表。
- en: The two large buttons at the top give you the option to **Open a Flow**, which
    opens an existing Tableau Prep flow file, or **Connect to Data**, to start a new
    flow with an initial data connection. We'll define a flow in the next section.
    For now, think of a flow in terms of Tableau Prep's equivalent of a Tableau Desktop
    workbook.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 屏幕顶部的两个大按钮为你提供了**打开一个流**的选项，用于打开一个现有的 Tableau Prep 流文件，或**连接数据**，用于通过初始数据连接开始一个新流。在下一节中我们会定义什么是流。现在，你可以把流看作是
    Tableau Prep 相当于 Tableau Desktop 工作簿的东西。
- en: '**Recent Flows** shows the Tableau Prep data flows that you have recently saved.
    You may click on one of these to open the flow and edit or run it. A toggle button
    on the right allows you to switch between thumbnails and a list.'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**最近的流**显示了你最近保存的 Tableau Prep 数据流。你可以点击其中一个打开流并进行编辑或运行。右侧的切换按钮允许你在缩略图和列表视图之间切换。'
- en: '**Sample Flows** allows you to open some prebuilt examples.'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**示例流**允许你打开一些预构建的示例。'
- en: The **Discover** pane gives you options for training and resources as you learn
    more about Tableau Prep. A notification to upgrade will also appear if there is
    a newer version available.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**发现**面板为你提供了在学习 Tableau Prep 时的培训和资源选项。如果有新版本可用，通知升级也会出现在此。'
- en: 'Once you have opened or started a new flow, the home screen will be replaced
    with a new interface, which will facilitate the designing and running of flows:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你打开或开始一个新流，主屏幕将被一个新界面替代，这将有助于流的设计和运行：
- en: '![](img/B16021_15_02.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_02.png)'
- en: 'Figure 15.2: When designing a flow, you''ll find an interface like this one.
    The major components are numbered and described as follows'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.2：在设计流时，你会看到类似于此的界面。主要组件已按数字标注，具体描述如下：
- en: 'This interface consists of the following, which are numbered in the preceding
    screenshot:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 这个界面由以下部分组成，这些部分在前面的截图中已编号：
- en: The flow pane, where you will logically build the flow of data with steps that
    will do anything from cleaning to calculation, to transformation and reshaping.
    Selecting any single step will reveal the interface on the bottom half of the
    screen. This interface will vary slightly, depending on the type of step you have
    selected.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 流面板，你将在其中逻辑地构建数据流，步骤包括从清洗到计算，再到转换和重塑。选择任何一个单独的步骤，将在屏幕下半部分显示相应的界面。这个界面会有所不同，具体取决于你选择的步骤类型。
- en: The settings, or changes pane lists settings for the step and also a list of
    all changes that are made in the step, from calculations to renaming or removing
    fields, to changing data types or grouping values. You can click on individual
    changes to edit them or see how they alter the data.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置面板或更改面板列出了该步骤的设置，还包括该步骤中所做的所有更改，从计算、重命名或删除字段，到更改数据类型或分组值。你可以点击单个更改进行编辑，或者查看这些更改如何影响数据。
- en: The profile pane gives you a profile of each field in the data as it exists
    for the selected step. You can see the type and distribution of values for each
    field. Clicking on a field will highlight the lineage in the flow pane and clicking
    one or more values of a field will highlight the related values of other fields.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置面板显示了所选步骤中每个字段的配置情况。你可以看到每个字段的类型和数值分布。点击某个字段将突出显示流程面板中的数据流，点击字段的一个或多个数值将突出显示与之相关的其他字段值。
- en: The data grid shows individual records of data as they exist in that step. Selecting
    a change in the changes grid will show the data based on changes up to and including
    the selected change. Selecting a value in the profile pane will filter the data
    grid to only show records containing that value. For example, selecting the first
    row of the `Order Date` field in the profile pane will filter the data grid to
    show only records represented by that bar. This allows you to explore the data,
    but doesn't alter the data until you perform a specific action that does result
    in a change.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据网格显示了该步骤中存在的每条数据记录。选择变化网格中的某个变化，将显示根据该变化（包括该变化）后的数据。选择配置面板中某个字段的值，将筛选数据网格，仅显示包含该值的记录。例如，选择配置面板中`订单日期`字段的第一行，将使数据网格仅显示由该条记录表示的数据。这允许你浏览数据，但在你执行某个会产生变化的操作之前，数据不会被更改。
- en: You will also notice the toolbar that allows you to undo or redo actions, refresh
    data, or run the flow. Additionally, there will be other options or controls that
    appear based on the type of step or field that's selected. We'll consider those
    details as we dive into the paradigm of Tableau Prep, and a practical example
    later in the chapter.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 你还会注意到工具栏，它允许你撤销或重做操作、刷新数据或运行流程。此外，还会根据所选步骤或字段的类型显示其他选项或控件。我们将在深入探讨Tableau Prep的工作原理及本章稍后的实际示例时，详细说明这些内容。
- en: Flowing with the fundamental paradigm
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 跟随基本理念的流动
- en: The overall paradigm of Tableau Prep is a hands-on, visual experience of discovering,
    cleaning, and shaping data through a flow. A flow (sometimes also called a data
    flow) is a logical series of steps and changes that are applied to data from input(s)
    to output(s).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep的整体理念是通过一个流程，以实践和可视化的方式发现、清理和塑造数据。一个流程（有时也叫做数据流程）是应用于数据的逻辑步骤和变化的系列，从输入（或多个输入）到输出（或多个输出）。
- en: 'Here is an example of what a flow looks like in the flow pane of Tableau Prep:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是Tableau Prep中流程面板中的一个流程示例：
- en: '![](img/B16021_15_03.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_03.png)'
- en: 'Figure 15.3: An example flow in Tableau Prep'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.3：Tableau Prep中的流程示例
- en: Each of the individual components of the flow are called steps, which are connected
    by lines that indicate the logical flow of data from left to right. The lines
    are sometimes called connectors or branches of the flow. Notice that the **Aggregate
    Step** here has one line coming in from the left and three branches extending
    to the right. Any step can have multiple output branches that represent logical
    copies of the data at that point in the flow.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 每个流程的独立组件称为步骤，这些步骤通过连接线相互连接，表示数据从左到右的逻辑流动。连接线有时也被称为流程的连接器或分支。请注意，**聚合步骤**这里有一条从左边进入的线和三条向右延伸的分支。任何步骤都可以有多个输出分支，表示流程中该点的数据逻辑副本。
- en: One important thing to notice is that four of the step types represent the four
    major transformations of data we discussed in *Chapter 14*, *Structuring Messy
    Data to Work Well in Tableau*. The step types of **Pivot**, **Union**, **Join**,
    and **Aggregate** exactly match those transformations, while the **Clean Step**
    allows various other operations involved in cleaning and calculating. You may
    wish to refresh your memory on the basic transformations in the previous chapter.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的一个重要点是，四种步骤类型代表了我们在*第14章*《将凌乱数据结构化以便在Tableau中顺利工作》中讨论的四大数据转换。这些步骤类型分别是**透视**、**联合**、**连接**和**聚合**，它们与这些转换完全对应，而**清理步骤**则允许进行各种清理和计算操作。你可能希望回顾一下上一章中提到的基本数据转换。
- en: 'As we work through an example of a flow throughout this chapter, we''ll examine
    each type of step more closely. For now, consider these preliminary definitions
    of the primary steps in Tableau Prep:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章我们通过一个流程示例进行讲解时，将更详细地考察每种类型的步骤。现在，先考虑一下Tableau Prep中主要步骤的初步定义：
- en: '**Input**: An input step starts the flow with data from a source such as a
    file, table, view, or custom SQL. It gives options for defining file delimiters,
    unions of multiple tables or files, and how much data to sample (for larger record
    sets).'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输入**：输入步骤通过数据源（例如文件、表格、视图或自定义 SQL）开始流程。它提供了定义文件分隔符、多个表或文件的联合以及如何抽样数据量（对于较大的记录集）的选项。'
- en: '**Clean Step**: A clean step allows you to perform a wide variety of functions
    on the data, including calculations, filtering, adjusting data types, removing
    and merging fields, grouping and cleaning, and much more.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**清理步骤**：清理步骤允许你对数据执行各种功能，包括计算、过滤、调整数据类型、移除和合并字段、分组和清理等。'
- en: '**Aggregate Step**: An aggregate step allows you to aggregate values (for example,
    get `MIN`, `MAX`, `SUM`, `AVG`) at a level of detail you specify.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**聚合步骤**：聚合步骤允许你在指定的详细级别上聚合值（例如，获取`MIN`、`MAX`、`SUM`、`AVG`等）。'
- en: '**Join Step**: A join step allows you to bring together two branches of the
    flow and match data row by row based on the fields you select and the type of
    join.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连接步骤**：连接步骤允许你将流程中的两个分支汇聚在一起，并基于你选择的字段以及连接类型逐行匹配数据。'
- en: '**Union Step**: A union step allows you to bring together two or more branches
    representing sets of data to be unioned together. You will have options for merging
    or removing mismatched fields.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**联合步骤**：联合步骤允许你将两个或更多代表数据集的分支合并在一起。你将有选项合并或移除不匹配的字段。'
- en: Both the **Union Step** and **Join Step** in this example have an error icon,
    indicating that something has not been configured correctly in the flow. Hovering
    over the icon gives a tooltip description of the error. In this case, the error
    is due to only having one input connection, while both the union and join require
    at least two inputs. Often, selecting a step with an error icon may reveal details
    about the error in the changes pane or elsewhere in the configuration steps.
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个示例中的**联合步骤**和**连接步骤**都有一个错误图标，表示流程中某些配置不正确。将鼠标悬停在图标上会显示错误的工具提示描述。在这种情况下，错误是由于只有一个输入连接，而联合和连接都需要至少两个输入。通常，选择带有错误图标的步骤可能会在更改窗格或配置步骤的其他地方显示错误的详细信息。
- en: '**Pivot Step**: A pivot step allows you to transform columns of data into rows
    or rows of data into columns. You''ll have options to select the type of pivot
    as well as the fields themselves. The term *transpose* is sometimes also used
    to describe this operation.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**透视步骤**：透视步骤允许你将数据列转换为行，或将数据行转换为列。你将有选项选择透视类型以及字段本身。有时也会使用术语*转置*来描述此操作。'
- en: '**Output**: The output step defines the ultimate destination for the cleaned
    and transformed data. This could be a text file (`.csv`), extract (`.hyper` or
    `.tde`), or published extracted data source to Tableau Server. The ability to
    output to a database has been announced, although is not available at the time
    of writing. You''ll have options to select the type of output, along with the
    path and filename or Tableau Server and project.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输出**：输出步骤定义了清理和转换后的数据的最终目的地。这可以是文本文件（`.csv`）、提取文件（`.hyper` 或 `.tde`），或发布到
    Tableau Server 的提取数据源。虽然输出到数据库的功能已经宣布，但在撰写时尚不可用。你将有选项选择输出类型、路径和文件名，或选择 Tableau
    Server 和项目。'
- en: Right-clicking a step or connector reveals various options. You may also drag
    and drop steps onto other steps to reveal options such as joining or unioning
    the steps together. If you want to replace an early part of the flow to swap out
    an input step, you can right-click the connector and select **Remove**, and then
    drag the new input step over the desired next step in the flow to add it as the
    new input.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 右键单击步骤或连接器会显示各种选项。你也可以将步骤拖放到其他步骤上，以显示连接或联合步骤的选项。如果你想替换流程的早期部分并交换输入步骤，可以右键单击连接器并选择**删除**，然后将新的输入步骤拖动到流程中所需的下一个步骤上，以将其添加为新的输入。
- en: In addition to using the term *flow* to refer to the steps and connections that
    define the logical flow and transformation of the data, we'll also use the term
    flow to refer to the file that Tableau Prep uses to store the definition of the
    steps and changes of a flow. Tableau Prep flow files have the `.tfl` (unpackaged
    flow) or `.tflx` (packaged flow) extension.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用术语*流程*来指代定义数据逻辑流程和转换的步骤与连接，我们还会使用流程一词来指代 Tableau Prep 用于存储步骤定义和流程更改的文件。Tableau
    Prep 流程文件的扩展名为 `.tfl`（未打包流程）或 `.tflx`（打包流程）。
- en: The paradigm of Tableau Prep goes far beyond the features and capabilities of
    any single step. As you build and modify flows, you'll receive instant feedback
    so that you can see the impact of each step and change. This makes it relatively
    easy (and fun!) to iteratively discover your data and make the necessary changes.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep 的范式远远超出了任何单一步骤的功能和特点。当你构建和修改数据流时，你会立即收到反馈，这样你就能看到每个步骤和变化的影响。这使得你可以相对轻松（而且有趣！）地逐步发现数据，并进行必要的更改。
- en: When you are building flows, adding steps, making changes, and interacting with
    data, you are in **design mode**. Tableau Prep uses a combination of the Hyper
    engine's cache, along with direct queries of the database, to provide near-instant
    feedback as you make changes. When you run a flow, you are using **batch mode**
    or **execution mode**. Tableau Prep will run optimized queries and operations
    that may be slightly different than the queries that are run in design mode.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 当你构建数据流、添加步骤、做出更改并与数据互动时，你处于 **设计模式**。Tableau Prep 结合了 Hyper 引擎的缓存和直接查询数据库的方式，在你做出更改时提供近乎即时的反馈。当你运行数据流时，你使用的是
    **批处理模式** 或 **执行模式**。Tableau Prep 将运行优化过的查询和操作，这些查询与设计模式下运行的查询可能略有不同。
- en: We'll consider an example in the remainder of this chapter to aid in our discussion
    of the Tableau Prep paradigm and highlight some important features and considerations.
    The example will unfold organically, which will allow us to see how Tableau Prep
    gives you incredible flexibility to address data challenges as they arise and
    make changes as you discover new aspects of your data.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的其余部分，我们将通过一个示例来帮助讨论 Tableau Prep 的范式，并突出一些重要的功能和注意事项。这个示例将自然展开，使我们能够看到 Tableau
    Prep 如何提供令人难以置信的灵活性，以应对数据挑战并随着你发现数据的新方面进行更改。
- en: We'll put you in the role of an analyst at your organization, with the task
    of analyzing employee air travel. This will include ticket prices, airlines, and
    even a bit of geospatial analysis of the trips themselves. The data needs to be
    consolidated from multiple systems and will require some cleaning and shaping
    to enable the analysis.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将把你置于一个分析师的角色，任务是分析员工的航空旅行。这将包括票价、航空公司，甚至对旅行本身进行一些地理空间分析。数据需要从多个系统中整合，并且需要清洗和整理才能进行分析。
- en: To follow along, open Tableau Prep Builder, which will start on the home screen
    (there is not a starter flow for this chapter). The sample data is in the `Chapter
    15` directory, along with the `Complete` flow if you want to check your work.
    The `Complete (clean)` flow contains a sample of how a flow might be self-documented—it
    will not match screenshots precisely.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 为了跟随操作，打开 Tableau Prep Builder，它会直接显示在主屏幕（本章没有启动数据流）。示例数据位于 `Chapter 15` 目录中，如果你想检查你的工作，可以找到
    `Complete` 流程。`Complete (clean)` 流程包含了一个自我记录数据流的示例——它不会精确匹配截图。
- en: When you open the `Complete` flow file, you'll likely receive errors and warnings
    that input paths and output paths are not valid. This is expected because your
    machine will almost certainly have a different drive and directory structure than
    the one on which the examples were prepared. You'll also run into this behavior
    when you share flow files with others. To resolve the issues, simply work through
    the connections in the **Connections** pane (expanded in *Figure 15.4*) on the
    left to reconnect to the files and set output steps to appropriate directories
    on your machine.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 当你打开 `Complete` 流程文件时，你可能会收到错误和警告，提示输入路径和输出路径无效。这是预期中的情况，因为你的计算机几乎肯定会有不同的驱动器和目录结构，和准备示例时所用的系统不同。当你与他人共享数据流文件时，也会遇到这种情况。要解决这些问题，只需在左侧的
    **连接** 窗格（在 *图 15.4* 中展开）中处理连接，重新连接文件并将输出步骤设置为适合你计算机的目录。
- en: We'll start by connecting to some data!
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从连接数据开始！
- en: Connecting to data
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连接数据
- en: 'Connecting to data in Tableau Prep is very similar to connecting to data in
    Tableau Desktop. From the home screen, you may click either **Connect to Data**
    or the **+** button on the expanded **Connections** pane:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Tableau Prep 中连接数据非常类似于在 Tableau Desktop 中连接数据。从主屏幕上，你可以点击“**连接到数据**”或在展开的“**连接**”窗格中点击
    **+** 按钮：
- en: '![](img/B16021_15_04.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_04.png)'
- en: 'Figure 15.4: You can make a new data connection by clicking the + button or
    the Connect to Data button'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.4：你可以通过点击 + 按钮或“连接到数据”按钮来创建新的数据连接。
- en: Either UI element will bring up a list of data source types to select.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 无论哪种 UI 元素都会弹出一个数据源类型的选择列表。
- en: As with Tableau Desktop, for file-based data sources, you may drag the file
    from **Windows Explorer** or **Finder** onto the Tableau Prep window to quickly
    create a connection.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Tableau Desktop 类似，对于基于文件的数据源，你可以将文件从**Windows 资源管理器**或**Finder**拖动到 Tableau
    Prep 窗口，以快速创建连接。
- en: Tableau Prep supports dozens of file types and databases, and the list continues
    to grow. You'll recognize many of the same types of connection possibilities that
    exist in Tableau Desktop. However, at the time of writing this book, Tableau Prep
    does not support all the connections that are available in Tableau Desktop.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep 支持多种文件类型和数据库，且支持的类型仍在不断增加。你会识别出许多与 Tableau Desktop 相同的连接类型。不过，在撰写本书时，Tableau
    Prep 尚不支持 Tableau Desktop 中所有可用的连接类型。
- en: You may create as many connections as you like and the **Connections** pane
    will list each connection separately with any associated files, tables, views,
    and stored procedures, or other options that are applicable to that data source.
    You will be able to use any combination of data sources in the flow.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以创建任意数量的连接，**连接**窗格会分别列出每个连接，并显示相关的文件、表、视图、存储过程或适用于该数据源的其他选项。你可以在流中使用任何组合的数据源。
- en: 'For now, let''s start our example with the following steps:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们从以下步骤开始示例：
- en: Starting from the window shown in *Figure 15.4*, click **Connect to Data**.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从图 *15.4* 所示的窗口开始，点击**连接数据**。
- en: From the expanded list of possible connections that appears, select **Microsoft Excel**.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从出现的扩展连接列表中，选择**Microsoft Excel**。
- en: You'll see a main table called **Employee Flights** and a sub-table named **Employee
    Flights Table 1**. Drag the **Employee Flights** table to the flow canvas. An
    input step will be created, giving you a preview of the data and other options.
    The input preview pane will initially look like this:![](img/B16021_15_05.png)
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到一个名为**员工航班**的主表和一个名为**员工航班表 1**的子表。将**员工航班**表拖动到流画布中，将创建一个输入步骤，并显示数据预览和其他选项。输入预览窗格最初会像这样：![](img/B16021_15_05.png)
- en: 'Figure 15.5: The input preview allows you to select input fields to include
    in the flow, rename fields, and change data types'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.5：输入预览允许你选择要包含在流中的输入字段，重命名字段，并更改数据类型。
- en: 'The input step displays a grid of fields and options for those fields. You''ll
    notice that many of the fields in the **Employee Flights** table are named `F2`,
    `F3`, `F4`, and so on. This is due to the format of the Excel file, which has
    merged cells and a summary sub-table. Continue the exercise with the following
    steps:'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输入步骤显示字段网格和这些字段的选项。你会注意到，**员工航班**表中的许多字段被命名为`F2`、`F3`、`F4`，依此类推。这是由于 Excel 文件的格式问题，其中包含合并单元格和汇总子表。请继续按照以下步骤进行操作：
- en: Check the **Use Data Interpreter** option on the **Connections** pane and Tableau
    Prep will correctly parse the file as shown here:![](img/B16021_15_06.png)
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**连接**窗格中选中**使用数据解释器**选项，Tableau Prep 将正确解析文件，如下所示：![](img/B16021_15_06.png)
- en: 'Figure 15.6: The data interpreter parses the file to fix common issues such
    as merged cells, empty headers, and sub-total lines'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.6：数据解释器解析文件，以修复常见问题，例如合并单元格、空标题和小计行。
- en: When you select an input step, Tableau Prep will display a grid of fields in
    the data. You may use the grid to uncheck any fields you do not wish to include,
    edit the **Type** of data by clicking the associated symbol (for example, change
    a string to a date), and edit the **Field Name** itself by double-clicking the
    field name value.
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当你选择一个输入步骤时，Tableau Prep 会显示数据字段的网格。你可以使用该网格取消勾选不想包含的字段，点击相关符号编辑数据的**类型**（例如，将字符串改为日期），并通过双击字段名值来编辑**字段名称**。
- en: If Tableau Prep Builder detects that the data source contains a large number
    of records, it may turn on data sampling. **Data Sampling** uses a smaller subset
    of records for giving rapid feedback and profiling in design mode. However, it
    will use the full set of data when you run the entire flow in batch mode. You
    can control the data sampling options by clicking **Data Sample** on the input
    pane. While you can set the sample size for the source, subsequent steps, such
    as joins, that result in large numbers of records may turn on sampling that cannot
    be disabled. You'll receive an indicator of **Data Sampling** if it occurs anywhere
    in the flow.
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果 Tableau Prep Builder 检测到数据源包含大量记录，它可能会启用数据采样。**数据采样**使用较小的记录子集来提供快速反馈和设计模式下的分析。然而，在你以批处理模式运行整个流程时，它将使用完整的数据集。你可以通过点击输入窗格中的**数据样本**来控制数据采样选项。虽然你可以为源设置样本大小，但后续步骤（如联接）如果生成大量记录，可能会启用无法禁用的采样。如果在流程中发生数据采样，你会收到**数据采样**的指示。
- en: Now, we'll continue to explore the data and fix some issues along the way. Click
    the **+** button that appears when you hover over the **Employee Flights** input
    step. This allows you to extend the flow by adding additional step types. In this
    case, we'll add a **Clean Step**. This will extend the flow by adding a clean
    step called **Clean 1**:![](img/B16021_15_07.png)
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将继续探索数据并在过程中解决一些问题。点击鼠标悬停在**员工航班**输入步骤上时出现的**+**按钮。这将允许你通过添加额外的步骤类型来扩展流程。在这种情况下，我们将添加一个**清理步骤**。这将通过添加名为**Clean
    1**的清理步骤来扩展流程：![](img/B16021_15_07.png)
- en: 'Figure 15.7: Adding a step extends the flow. Here, adding a clean step adds
    Clean 1'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.7：添加一个步骤扩展了流程。在这里，添加一个清理步骤会添加 Clean 1
- en: With the **Clean 1** step selected, take a moment to explore the data using
    the profile pane. Observe how selecting individual values for fields in the profile
    pane highlights portions of related values for other fields. This can give you
    great insight into your data, such as seeing the different price ranges based
    on `Ticket` `Type`:![](img/B16021_15_08.png)
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**Clean 1**步骤后，花一点时间使用配置文件窗格来探索数据。观察在配置文件窗格中选择字段的单个值时，如何突出显示与其他字段相关的部分值。这能让你深入了解数据，比如根据`机票`
    `类型`看到不同的价格区间：![](img/B16021_15_08.png)
- en: 'Figure 15.8: Selecting a value for a field in the profile pane highlights which
    values (and what proportion of those values) relate to the selected value'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.8：在配置文件窗格中选择字段值时，会突出显示与所选值相关的值（以及这些值的比例）
- en: Highlighting the bar segments across fields in the profile pane, which results
    from selecting a field value, is called brushing. You can also take action on
    selected values via the toolbar at the top of the profile pane or by right-clicking
    a field value. These actions include filtering, editing values, or replacing with
    `NULL`. However, before making any changes or cleaning any of the data, let's
    connect to some additional data.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置文件窗格中突出显示字段间的条形图段，通常是通过选择字段值实现的，这叫做“刷选”。你还可以通过配置文件窗格顶部的工具栏或右键点击字段值来对选中的值采取操作。这些操作包括过滤、编辑值或用
    `NULL` 替换。然而，在对数据进行任何更改或清理之前，让我们连接一些额外的数据。
- en: It turns out that most of the airline ticket booking data is in one database
    that's represented by the Excel file, but another airline's booking data is stored
    in files that are periodically added to a directory. These files are in the `\Learning
    Tableau\Chapter 15\` directory. The files are named with the convention `Southwest
    YYYY.csv` (where `YYYY` represents the `year`).
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 事实证明，大部分航空公司机票预订数据存储在一个由 Excel 文件表示的数据库中，但另一家航空公司的预订数据存储在定期添加到目录中的文件中。这些文件位于
    `\Learning Tableau\Chapter 15\` 目录中。文件名遵循 `Southwest YYYY.csv` 的命名规范（其中 `YYYY`
    代表 `年份`）。
- en: 'We''ll connect to all the existing files and ensure that we are prepared for
    additional future files:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将连接所有现有文件，并确保为未来可能添加的文件做好准备：
- en: Click the **+** icon on the **connections** pane to add a new connection to
    a **Text File**.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**连接**窗格中的**+**图标，添加一个新的**文本文件**连接。
- en: Navigate to the `\Learning Tableau\Chapter 15\` directory and select any of
    the `Southwest YYYY.csv` files to start the connection. Looking at the **Input**
    settings, you should see that Tableau Prep correctly identifies the field separators,
    field names, and types:![](img/B16021_15_09.png)
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 `\Learning Tableau\Chapter 15\` 目录并选择任何一个 `Southwest YYYY.csv` 文件来开始连接。查看**输入**设置，你应该会看到
    Tableau Prep 正确识别了字段分隔符、字段名称和类型：![](img/B16021_15_09.png)
- en: 'Figure 15.9: A text file includes options for headers, field separators, text
    qualifiers, character sets, and more. Notice also the tabs such as Multiple Files
    and Data Sample giving other options for the text input'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.9：一个文本文件包含了头部、字段分隔符、文本限定符、字符集等选项。还可以注意到诸如“多个文件”和“数据示例”等标签，提供了其他文本输入的选项。
- en: 'In the **Input** pane, select the **Multiple Files** tab and switch from **Single
    table** to **Wildcard union**. Set **Matching Pattern** to `Southwest*` and click
    **Apply**. This tells Tableau Prep to union all of the text files in the directory
    that begin with `Southwest` together:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入**面板中，选择**多个文件**标签，并从**单一表格**切换到**通配符联合**。将**匹配模式**设置为`Southwest*`，然后点击**应用**。这告诉
    Tableau Prep 将目录中所有以`Southwest`开头的文本文件联合起来：
- en: '![](img/B16021_15_10.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_10.png)'
- en: 'Figure 15.10: Using Matching Pattern tells Tableau Prep which files to union
    together. That way, when Southwest 2020.txt and future files are dropped into
    the directory, they will be automatically included'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.10：使用匹配模式告诉 Tableau Prep 应该将哪些文件联合在一起。这样，当`Southwest 2020.txt`和未来的文件被放入目录时，它们将自动被包括在内。
- en: Use the **+** icon on the **Southwest** input step in the flow pane to add a
    new clean step. This step will be named **Clean 2** by default. Once again, explore
    the data, but don't take any action until you've brought the two sources together
    in the flow. You may notice a new field in the **Clean 2** step called **File
    Paths**, which indicates which file in the union is associated with each record.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用流程面板中**西南**输入步骤上的**+**图标来添加一个新的清理步骤。这个步骤默认命名为**清理 2**。再次检查数据，但在将两个数据源在流程中结合之前，不要采取任何操作。你可能会注意到在**清理
    2**步骤中有一个名为**文件路径**的新字段，表示联合中每条记录对应的文件。
- en: With our input steps defined, let's move on to consider how to clean up some
    of the data to get it ready for analysis.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义了输入步骤之后，接下来我们考虑如何清理一些数据，为分析做好准备。
- en: Cleaning the data
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据清理
- en: The process of building out the flow is quite iterative, and you'll often make
    discoveries about the data that will aid you in cleaning and transforming it.
    We'll break this example into sections for the sake of reference, but don't let
    this detract from the idea that building a flow should be a flow of thought. The
    example is meant to be seamless!
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 构建流程的过程是相当迭代的，你会经常发现有关数据的新信息，这有助于你清理和转换数据。为了方便参考，我们将此示例分成几个部分，但不要因此忽视构建流程本应是一种思维流的想法。这个示例旨在做到无缝衔接！
- en: We'll take a look at quite a few possibilities for prepping the data in this
    section, including merging and grouping. Let's start with seeing how to union
    together branches in the flow.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨一些数据预处理的可能性，包括合并和分组。让我们从查看如何在流程中联合各个分支开始。
- en: Unioning, merging mismatched fields, and removing unnecessary fields
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 联合、合并不匹配的字段并删除不必要的字段
- en: 'We know that we want to bring together the booking data for all the airlines,
    so we''ll union together the two paths in the flow:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道我们想要将所有航空公司的预订数据合并在一起，因此我们将在流程中联合这两个路径：
- en: Drag the **Clean 2** step onto the **Clean 1** step and drop it onto the **Union**
    box that appears. This will create a new **Union** step with input connections
    from both of the clean steps:![](img/B16021_15_11.png)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**清理 2**步骤拖到**清理 1**步骤上，并将其放到出现的**联合**框中。这将创建一个新的**联合**步骤，输入连接来自两个清理步骤：![](img/B16021_15_11.png)
- en: 'Figure 15.11: Dragging one step onto another in the flow reveals options for
    bringing the datasets together in the flow. Here, for example, there are options
    for creating a Union or Join'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.11：在流程中将一个步骤拖到另一个步骤上，显示出将数据集合并到流程中的选项。例如，这里有创建联合或连接的选项。
- en: The **Union** pane that shows up when the **Union** step is selected will show
    you the mismatched fields, indicate the associated input, and give you options
    for removing or merging the fields. For example, `Fare` `Type` and `Ticket``Type`
    are named differently between the Excel file and the text files, but in fact represent
    the same data. Hold down the *Ctrl* key and select both fields. Then, select **Merge
    Fields** from the toolbar at the top of the pane or from the right-click menu:![](img/B16021_15_12.png)
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当选择**联合**步骤时，出现的**联合**面板会显示不匹配的字段，指示相关输入，并提供删除或合并字段的选项。例如，`Fare`、`Type`和`Ticket
    Type`在 Excel 文件和文本文件中的命名不同，但实际上代表的是相同的数据。按住*Ctrl*键并选择两个字段，然后从面板顶部的工具栏或右键菜单中选择**合并字段**：![](img/B16021_15_12.png)
- en: 'Figure 15.12: When you select a single field, Tableau Prep will highlight fields
    that are potentially the same data. Selecting both reveals the Merge Fields option'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.12：当你选择单一字段时，Tableau Prep会高亮显示可能为相同数据的字段。选择这两个字段后会显示“合并字段”选项。
- en: Also, merge `Row``ID` and `Row_ID`.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同样，合并`Row``ID`和`Row_ID`。
- en: '**File Paths** applies only to the `Southwest` files, which were unioned together
    in the **Input** step. While this auto-generated field can be very useful at times,
    it does not add anything to the data in this example. Select the field, then click
    the ellipses menu button and select **Remove Field**.'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**文件路径**仅适用于`Southwest`文件，这些文件在**输入**步骤中被联合在一起。虽然这个自动生成的字段在某些情况下非常有用，但在这个例子中并没有为数据增加任何价值。选择该字段，然后点击省略号菜单按钮，选择**移除字段**。'
- en: Similarly, `Travel``Insurance?` and `Passenger``ID` apply to only one of the
    inputs and will be of little use in our analysis. Remove those fields as well.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 类似地，`Travel``Insurance?`和`Passenger``ID`仅适用于一个输入字段，在我们的分析中用处不大。也请移除这些字段。
- en: The single remaining mismatched field, `Airline`, is useful. Leave it for now
    and click the **+** icon on the **Union 1** step in the flow pane and extend the
    flow by selecting **Clean Step**. At this point, your flow should look like this:![](img/B16021_15_13.png)
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 唯一剩下的字段`Airline`是有用的。暂时保留它，然后点击流面板中**Union 1**步骤的**+**图标，选择**清理步骤**来扩展流程。此时，您的流程应该如下所示：![](img/B16021_15_13.png)
- en: 'Figure 15.13: Your flow should look similar to this. You may notice some variation
    in the exact location of steps or color (you can change a step''s color by right-clicking
    a step)'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.13：你的流程应该类似于这个。你可能会注意到步骤的确切位置或颜色有所不同（你可以通过右键点击步骤来更改步骤的颜色）。
- en: There is an icon above the **Union 1** step in the flow, indicating changes
    that were made within this step. In this case, the changes are the removal of
    several of the fields. Each step with changes will have similar icons, which will
    reveal tooltip details when you hover over them and also allow you to interact
    with the changes. You can see a complete list of changes, edit them, reorder them,
    and remove them by clicking the step and opening the changes pane. Depending on
    the step type, this is available by either expanding it or selecting the changes
    tab.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在流中的**Union 1**步骤上方有一个图标，表示在此步骤内做出的更改。在这种情况下，更改是移除了几个字段。每个有更改的步骤都会有类似的图标，鼠标悬停时会显示工具提示的详细信息，还可以与更改进行交互。你可以通过点击步骤并打开更改面板，查看更改的完整列表，编辑它们、重新排序或移除它们。根据步骤类型，可以通过展开步骤或选择“更改”选项卡来查看此内容。
- en: Next, we'll continue building the flow and consider some options for grouping
    and cleaning.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将继续构建流程并考虑一些分组与清理的选项。
- en: Grouping and cleaning
  id: totrans-116
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分组与清理
- en: 'Now, we''ll spend some time cleaning up the data that came from both input
    sources. With the **Clean 3** step selected, use the profile pane to examine the
    data and continue our flow. The first two fields indicate some issues that need
    to be addressed:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将花些时间清理来自两个输入源的数据。选中**Clean 3**步骤后，使用配置面板检查数据并继续我们的流程。前两个字段显示了一些需要处理的问题：
- en: '![](img/B16021_15_14.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_14.png)'
- en: 'Figure 15.14: Every null value in the Airline field comes from the Southwest
    files. Fortunately, in this case, the source of the data indicates the airline'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.14：所有`Airline`字段中的空值来自于Southwest文件。幸运的是，在这个案例中，数据源明确指示了航空公司。
- en: 'The `Table``Names` field was generated by Tableau Prep as part of **Union 1**
    to indicate the source of the records. The `Airline` field came only from the
    Excel files (you can confirm this by selecting it in the profile pane and observing
    the highlighted path of the field in the flow pane). Click the **null** value
    for `Airline` and observe the brushing: this is proof that the `null` values in
    `Airline` all come from the Southwest files since those files did not contain
    a field to indicate the airline. We''ll address the `null` values and do some
    additional cleanup:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '`Table``Names`字段是由Tableau Prep在**Union 1**步骤中生成的，用以指示记录的来源。`Airline`字段仅来自Excel文件（你可以通过在配置面板中选择它并观察流面板中该字段的高亮路径来确认这一点）。点击`Airline`字段的**空值**，并观察数据刷选：这是证明`Airline`中的空值全部来自Southwest文件的证据，因为这些文件没有包含用来指示航空公司的字段。我们将处理这些`空值`并进行一些额外的清理：'
- en: Double-click the **null** value and then type `Southwest` to replace `NULL`
    with the value you know represents the correct airline. Tableau Prep will indicate
    that a **Group** and **Replace** operation has occurred with a paperclip icon.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击**null**值，然后输入`Southwest`，将`NULL`替换为你知道代表正确航空公司的值。Tableau Prep将通过一个回形针图标指示发生了**分组**和**替换**操作。
- en: We'll do an additional grouping to clean up the variations of **American**.
    Using the **Options** button on the `Airline` field, select **Group Values** |
    **Pronunciation**:![](img/B16021_15_15.png)
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将进行额外的分组，以清理**American**的变体。使用`Airline`字段上的**选项**按钮，选择**分组值** | **按发音分组**：![](img/B16021_15_15.png)
- en: 'Figure 15.15: The ellipses button on a field will reveal a plethora of options,
    from cleaning to filtering, to grouping, to creating calculations'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.15：字段上的省略号按钮将显示大量选项，从清理到过滤，再到分组和创建计算。
- en: Nearly all the variations are grouped into the **American** value. Only **AA**
    remains.
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 几乎所有变体都被分组到**American**值中。只有**AA**还剩下。
- en: In the **Group Values by Pronunciation** pane that has appeared, select the
    **American Airlines** group and manually add **AA** by checking it in the list
    that appears to the right:![](img/B16021_15_16.png)
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在弹出的**按发音分组值**窗格中，选择**American Airlines**组，并通过选中右侧列表中的**AA**手动添加它：![](img/B16021_15_16.png)
- en: 'Figure 15.16: When grouping by pronunciation, you''ll notice a slider allowing
    you control over the sensitivity of the grouping. You can also manually adjust
    groupings by selecting a field'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.16：当按发音分组时，你会注意到一个滑块，允许你控制分组的灵敏度。你也可以通过选择一个字段手动调整分组。
- en: Click **Done** on the **Group Values by Pronunciation** pane.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**按发音分组值**窗格中点击**完成**。
- en: Next, select the `Table``Names` field, which is no longer needed. Using either
    the toolbar option, the menu from a right-click for the field, or the options
    button, select **Remove Field.**
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择不再需要的`Table``Names`字段。使用工具栏选项、字段右键菜单或选项按钮，选择**删除字段**。
- en: Some fields in the profile pane have a **Recommendations** icon (which resembles
    a lightbulb) in the upper-right corner. Click this icon on the `Passenger``Email`
    field and then **Apply** the recommendation to assign a data role of **Email**:![](img/B16021_15_17.png)
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在资料窗格中的一些字段上，有一个**建议**图标（类似灯泡的图标）位于右上角。点击`Passenger``Email`字段上的此图标，然后点击**应用**建议，为其分配**Email**数据角色：![](img/B16021_15_17.png)
- en: 'Figure 15.17: Recommendations will show when Tableau Prep has suggestions for
    cleaning a field'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.17：当Tableau Prep有清理字段的建议时，建议将会显示。
- en: '**Data Roles** allow you to quickly identify valid or invalid values according
    to what pattern or domain of values is expected. Once you have assigned a data
    role, you may receive additional recommendations to either filter or replace invalid
    values.'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**数据角色**允许你根据预期的模式或值域快速识别有效或无效的值。一旦分配了数据角色，你可能会收到额外的建议，提示你过滤或替换无效值。'
- en: After applying the recommendation, you'll see an indication in the profile pane
    for invalid values. As you continue following the example, we'll consider some
    options for quickly dealing with those invalid values.
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 应用建议后，你会看到资料窗格中标记无效值的指示。当你继续跟随示例时，我们将考虑一些快速处理无效值的选项。
- en: Click the **Recommendations** button on the `Passenger``Email` field again.
    You'll see two new options presented. **Apply** the option to **Group** and **Replace**
    invalid values with `null`:![](img/B16021_15_18.png)
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次点击`Passenger``Email`字段上的**建议**按钮。你将看到呈现出两个新的选项。**应用**该选项以**分组**并将无效值替换为`null`：![](img/B16021_15_18.png)
- en: 'Figure 15.18: Here, Tableau Prep suggests either filtering out records with
    invalid values or replacing the invalid values with null. In this case, we don''t
    want to filter out the entire record, but the invalid values themselves are useless
    and are best represented by null'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.18：在这里，Tableau Prep建议要么过滤掉具有无效值的记录，要么将无效值替换为null。在这种情况下，我们不想过滤掉整个记录，但无效值本身没有意义，最好用null来表示。
- en: 'Most of the remaining fields look fine, except for `Fare``Type` (or possibly
    `Ticket``Type`, depending on which name was kept when merging the fields previously).
    This field contains the values **1st Class** and **First Class**. Select both
    of these values by clicking each while holding down the *Ctrl* key and then **Group**
    them together with the **First Class** value. Two interface options for grouping
    the values are indicated here:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除了`Fare``Type`（或者可能是`Ticket``Type`，具体取决于之前合并字段时保留了哪个名称）之外，大部分剩余字段看起来都没问题。这个字段包含了**1st
    Class**和**First Class**的值。按住*Ctrl*键点击这两个值，然后将它们与**First Class**值一起**分组**。这里有两种分组值的界面选项：
- en: '![](img/B16021_15_19.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_19.png)'
- en: 'Figure 15.19: After selecting two or more values, you can group them together
    with the toolbar option or the right-click menu'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.19：选择两个或多个值后，可以通过工具栏选项或右键菜单将它们分组
- en: At this point, we have a clean dataset that contains all our primary data. There's
    already a lot of analysis we could do. In fact, let's take a moment to preview
    the data. Right-click the **Clean 3** step and select **Preview in Tableau Desktop**:![](img/B16021_15_20.png)
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经有了一个干净的数据集，包含了所有的主要数据。事实上，我们已经可以进行很多分析了。不如现在先预览一下数据。右键点击**Clean 3**步骤并选择**在
    Tableau Desktop 中预览**：![](img/B16021_15_20.png)
- en: 'Figure 15.20: You may preview the data represented by any step in Tableau Desktop
    by selecting the option from the right-click menu for that step'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.20：你可以通过右键菜单选项在 Tableau Desktop 中预览任何步骤表示的数据
- en: A new data connection will be made and opened in Tableau Desktop. You can preview
    the data for any step in the flow. Take a few moments to explore the data in Tableau
    Desktop and then return to Tableau Prep. Now, we'll turn our attention to extending
    the dataset with some calculations, supplemental data, and a little restructuring.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 将建立一个新的数据连接，并在 Tableau Desktop 中打开。你可以预览流中任何步骤的数据。花些时间在 Tableau Desktop 中探索数据，然后返回
    Tableau Prep。现在，我们将把注意力转向通过一些计算、补充数据和小范围重构来扩展数据集。
- en: Calculations and aggregations in Tableau Prep
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Tableau Prep 中的计算和聚合
- en: Let's look at how to create calculations and some options for aggregations in
    Tableau Prep.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何在 Tableau Prep 中创建计算和聚合选项。
- en: Row-level calculations
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 行级计算
- en: Calculations in Tableau Prep follow a syntax that's nearly identical to Tableau
    Desktop. However, you'll notice that only row-level and `FIXED` level of detail
    functions are available. This is because all calculations in Tableau Prep will
    apply to the row level. Aggregations are performed using an **Aggregate** **Step**,
    which we'll consider shortly.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep 中的计算语法几乎与 Tableau Desktop 相同。不过，你会注意到，只有行级和`FIXED`详细级别的函数是可用的。这是因为
    Tableau Prep 中的所有计算都将应用于行级别。聚合操作则通过**聚合****步骤**来执行，我们稍后会讨论这一点。
- en: 'Calculations and aggregations can greatly extend our analytic capabilities.
    In our current example, there is an opportunity to analyze the length of time
    between ticket purchase and actual travel. We may also want to mark each record
    with an indicator of how frequently a passenger travels overall. Let''s dive into
    these calculations as we continue our example with the following steps:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 计算和聚合可以大大扩展我们的分析能力。在当前的示例中，我们有机会分析从购票到实际旅行之间的时间间隔。我们还可能希望为每条记录标注一个乘客的整体旅行频率指标。接下来，跟随以下步骤深入了解这些计算：
- en: We'll start with a calculation to determine the length of time between the purchasing
    of tickets and the day of travel. Select the **Clean 3** step and then click **Create
    Calculated Field**. Name the calculation **Days from Purchase to Travel** and
    enter `DATEDIFF('day', [Purchase Date], [Travel Date])`.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将从一个计算开始，确定从购票到旅行的时间间隔。选择**Clean 3**步骤，然后点击**创建计算字段**。将计算命名为**从购买到旅行的天数**，并输入`DATEDIFF('day',
    [Purchase Date], [Travel Date])`。
- en: Examine the results in the profile pane. The new field should look like this:![](img/B16021_15_21.png)
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查个人资料面板中的结果。新字段应该如下所示：![](img/B16021_15_21.png)
- en: 'Figure 15.21: The calculated field shows up in the profile pane'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.21：计算字段显示在个人资料面板中
- en: 'The default view here (as in many cases with numeric fields) is a summary binned
    histogram. You can change the view to see its details by selecting the ellipses
    button in the upper right of the field and switching to **Detail**, which will
    show every value of the field:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的默认视图（与许多数值字段的情况一样）是一个汇总的分箱直方图。你可以通过选择字段右上角的省略号按钮并切换到**详细信息**视图，查看字段的每一个值：
- en: '![](img/B16021_15_22.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_22.png)'
- en: 'Figure 15.22: Numeric and date fields can be viewed in Summary or in Detail'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.22：数值和日期字段可以在摘要或详细信息中查看。
- en: The shape of the data that's indicated by the default summary histogram is close
    to what we might have expected with most people purchasing tickets closer (but
    not immediately prior) to the date of travel. There might be some opportunity
    for getting better deals by purchasing farther in advance, so identifying this
    pattern (and then exploring it more fully in Tableau Desktop) will be key for
    this kind of analysis.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 默认汇总直方图显示的数据形态接近我们预期的，大多数人会在靠近（但不是立即）出行日期时购买票。提前购买可能会有更好的优惠，所以识别这一模式（并在 Tableau
    Desktop 中进一步探索）对于此类分析至关重要。
- en: Level of detail calculations
  id: totrans-153
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 细节级别计算
- en: There are a few other types of analysis we may wish to pursue. Let's consider
    how we might create segments of passengers based on how often they travel.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可能希望进行其他几种类型的分析。让我们考虑如何根据乘客的旅行频率创建乘客细分。
- en: 'We''ll accomplish this using a `FIXED` **level of detail** (**LOD**) expression.
    We could create the calculation from scratch, matching the syntax we learned for
    Tableau Desktop to write the calculation like this:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 `FIXED` **细节级别**（**LOD**）表达式来完成这一任务。我们可以从头开始创建计算，匹配我们在 Tableau Desktop
    中学习的语法，像这样编写计算：
- en: '[PRE0]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The preceding calculation would count the distinct rows per person. Knowing
    that each row represents a trip, we could alternately use the code `{FIXED [Person]
    : SUM(1)}`, which would potentially be more performant, depending on the exact
    data source.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '上述计算会对每个人进行不同的行计数。考虑到每一行代表一次旅行，我们也可以使用代码 `{FIXED [Person] : SUM(1)}`，根据具体的数据源，这可能会具有更好的性能。'
- en: 'In this example, though, we''ll leverage the interface to visually create the
    calculation:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在这个例子中，我们将利用界面来可视化地创建计算：
- en: Click the ellipses button on the `Person` field and select **Create Calculated
    Field** | **Fixed LOD**:![](img/B16021_15_23.png)
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 `Person` 字段上的省略号按钮，并选择**创建计算字段** | **固定 LOD**：![](img/B16021_15_23.png)
- en: 'Figure 15.23: To create a Fixed LOD calculation, use the menu and select Create
    Calculated Field | Fixed LOD'
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.23：要创建固定 LOD 计算，请使用菜单选择“创建计算字段” | “固定 LOD”。
- en: Notice also the options to create **Custom Calculation** (to write code) and
    **Rank** (to compute rank for the selected field).
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 还可以注意到创建 **自定义计算**（编写代码）和 **排名**（计算选定字段的排名）的选项。
- en: This will bring up a **Fixed LOD** pane allowing us to configure the LOD expression.
    The **Group by** field is already set to `Person` (as we started the calculation
    from that field), but we'll need to configure **Compute using** to perform the
    distinct count of rows and rename the field as `Trips``per``Person`, as shown
    here:![](img/B16021_15_24.png)
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将弹出一个 **固定 LOD** 面板，允许我们配置 LOD 表达式。**按组计算**字段已设置为 `Person`（因为我们从该字段开始计算），但我们需要配置
    **按...计算** 以执行行的不同计数，并将字段重命名为 `Trips``per``Person`，如图所示：![](img/B16021_15_24.png)
- en: 'Figure 15.24: The Fixed LOD pane allows you to configure the LOD expression
    visually and get instant visual feedback concerning results'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.24：固定 LOD 面板允许您可视化地配置 LOD 表达式，并即时获得关于结果的可视化反馈。
- en: Click **Done** when you have finished configuring the **Fixed LOD**.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置完 **固定 LOD** 后，点击**完成**。
- en: 'We''ll use the `Trips per Person` field to create segments of customers. We''ll
    accomplish this with another calculated field, so click **Create Calculated Field…**
    to bring up the code editor. Name the field `Frequency Segment` and enter the
    following code:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用 `Trips per Person` 字段来创建客户细分。我们将通过另一个计算字段来实现此目的，因此点击**创建计算字段...**以打开代码编辑器。命名该字段为
    `Frequency Segment`，并输入以下代码：
- en: '[PRE1]'
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The code uses the `Trips per Person` field in an `If` `Then` `Else` construction
    to create three segments. You can visually see the correspondence between the
    fields in the preview pane:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 该代码使用 `Trips per Person` 字段在 `If` `Then` `Else` 结构中创建三个细分。您可以在预览面板中直观地看到字段之间的对应关系：
- en: '![](img/B16021_15_25.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_25.png)'
- en: 'Figure 15.25: You can easily visualize how calculations relate to each other
    and other fields using the Profile pane'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.25：您可以轻松地通过概况面板可视化计算与其他字段之间的关系。
- en: The `Frequency``Segment` field can be used to accomplish all kinds of useful
    analysis. For example, you might want to understand whether frequent travelers
    typically get better ticket prices.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '`Frequency``Segment` 字段可用于完成各种有用的分析。例如，您可能想了解频繁旅行者是否通常能获得更好的票价。'
- en: We've seen row-level and FIXED LOD calculations, and noted the option for **Rank**.
    Let's now turn our attention to aggregations.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经了解了行级别和 FIXED LOD 计算，并注意到了**排名**选项。现在让我们将注意力转向聚合。
- en: Aggregations
  id: totrans-172
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 聚合
- en: 'Aggregations in Tableau Prep are accomplished using an aggregate step. We''ll
    continue our flow with the idea that we want to better understand our frequency
    of travel segment:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Tableau Prep 中，聚合是通过聚合步骤实现的。我们将继续我们的流程，假设我们希望更好地理解我们的旅行频率分段：
- en: 'Click the **+** symbol on **Clean 3** and add an **Aggregate** step. The new
    step will be named **Aggregate 1** by default:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**Clean 3**上的**+**符号并添加一个**聚合**步骤。默认情况下，新步骤将被命名为**聚合 1**：
- en: '![](img/B16021_15_26.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_26.png)'
- en: 'Figure 15.26: Adding an Aggregate step to the flow using the + symbol'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.26：使用 + 符号将聚合步骤添加到流程中
- en: Double-click the text **Aggregate 1** under the new step. This allows you to
    edit the name. Change the name from **Aggregate 1** to **Frequency** **Segment**.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击新步骤下的文本**聚合 1**，这样你就可以编辑名称。将名称从**聚合 1**更改为**频率** **分段**。
- en: Give steps meaningful names to self-document the flow. This will greatly help
    you and others when you return to edit the flow in the future. Additionally, when
    you are editing the name of a step, the **Add a description** text will appear
    below the name, as shown in *Figure 15.27*.
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 给步骤起有意义的名字，以便自我记录流程。这将大大帮助你和其他人在将来返回编辑流程时。此外，当你编辑步骤的名称时，**添加描述**的文本会出现在名称下方，如*图
    15.27*所示。
- en: '![](img/B16021_15_27.png)'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B16021_15_27.png)'
- en: 'Figure 15.27: When editing the name of a step, you may also add a more verbose
    description to help document the steps purpose'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.27：在编辑步骤名称时，你还可以添加更详细的描述，帮助记录步骤的目的。
- en: 'Selecting the aggregate step reveals a pane with options for grouping and aggregating
    fields in the flow:'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 选择聚合步骤会显示一个面板，提供在流程中对字段进行分组和聚合的选项：
- en: '![](img/B16021_15_28.png)'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B16021_15_28.png)'
- en: 'Figure 15.28: Adding an Aggregate step to the flow using the + symbol'
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.28：使用 + 符号将聚合步骤添加到流程中
- en: 'You may drag and drop fields from the left to the **Grouped Fields** or **Aggregated
    Fields** sections and you may change the type of aggregation by clicking on the
    aggregation text (examples indicated by arrows in *Figure 15.28*: `SUM` next to
    `Trips` `per` `Person` or `AVG` above `Ticket``Price`) and selecting a different
    aggregation from the resulting dropdown.'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以将左侧的字段拖放到**分组字段**或**聚合字段**部分，并且你可以通过点击聚合文本（*图 15.28*中的箭头指示的示例：`SUM`位于`每人旅行`旁，或者`AVG`位于`票价`上方）并从下拉菜单中选择不同的聚合类型来更改聚合方式。
- en: In *Figure 15.28*, notice that we've added **Frequency** **Segment** to the
    **GROUP** and`Ticket``Price` to the **Aggregated Fields** as an `AVG`. Notice
    also the `Number``of``Rows` **(Aggregated)** that appears at the bottom of the
    list of fields on the left. This is a special field that's available in the aggregation
    step.
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在*图 15.28*中，注意我们将**频率** **分段**添加到**分组**中，并将`票价`字段作为`AVG`添加到**聚合字段**中。还注意到，`行数`
    **(聚合)**出现在左侧字段列表的底部。这是一个在聚合步骤中可用的特殊字段。
- en: Conclude the example by clicking the **+** icon that appears when you hover
    over the **Frequency Segment** aggregate step and adding an **Output** step:![](img/B16021_15_29.png)
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击当你悬停在**频率分段**聚合步骤上时出现的**+**图标，添加一个**输出**步骤来结束本示例：![](img/B16021_15_29.png)
- en: Figure 15.29 Adding an Output step to the flow using the + symbol
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.29 使用 + 符号将输出步骤添加到流程中
- en: 'When you select the **Output** step, the **Output** pane shows options for
    saving the output and a preview of what the output will look like. In this case,
    we''ve configured the output to save to a **Comma Separated Values (.csv)** file
    named **Frequency Segment**:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你选择**输出**步骤时，**输出**面板会显示保存输出的选项，并预览输出将是什么样子。在这种情况下，我们已配置输出将保存到名为**频率分段**的**逗号分隔值（.csv）**文件中：
- en: '![](img/B16021_15_30.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_30.png)'
- en: 'Figure 15.30: This output will contain exactly three rows of data'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.30：此输出将包含确切的三行数据
- en: The **Output** pane also gives options for setting the output type, performing
    a full refresh of the data, or appending to existing data, and running the flow.
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**输出**面板还提供了设置输出类型、执行数据完全刷新或将数据追加到现有数据中以及运行流程的选项。'
- en: We'll extend our flow in the next few sections to additionally output detailed
    data. The detailed data as well as the output file of aggregate data gives us
    some nice options for leveraging Tableau's Data Model in Tableau Desktop to accomplish
    some complex analysis.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的几个部分，我们将扩展我们的流程，额外输出详细数据。详细数据以及聚合数据的输出文件为我们提供了一些很好的选项，可以在Tableau Desktop中利用Tableau的数据模型进行复杂分析。
- en: Let's continue by thinking about filtering data in Tableau Prep.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续思考如何在Tableau Prep中过滤数据。
- en: Filtering data in Tableau Prep
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Tableau Prep中过滤数据
- en: 'There are a couple of ways to filter data in Tableau Prep:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 在Tableau Prep中有几种方法可以过滤数据：
- en: Filter an input
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过滤输入
- en: Filter within the flow
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流程中的过滤
- en: 'Filtering an input can be efficient because the query that''s sent to the data
    source will return fewer records. To filter an input, select the input step and
    then click the **Filter Values...** button on the input pane:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤输入可以提高效率，因为发送到数据源的查询将返回更少的记录。要过滤输入，选择输入步骤，然后点击输入面板上的**过滤值...**按钮：
- en: '![](img/B16021_15_31.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_31.png)'
- en: 'Figure 15.31: The Filter Values... option allows you to filter values on the
    input step. This could improve performance on large datasets or relational databases'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.31：**过滤值...**选项允许你在输入步骤中过滤值。这可能会提高在大数据集或关系型数据库上的性能。
- en: The **Add Filter** dialog that pops up allows you to write a calculation with
    a `Boolean` (true/false) result. Only true values will be retained.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 弹出的**添加过滤器**对话框允许你写出一个`Boolean`（布尔值，真/假）结果的计算式。只有为真值的记录将被保留。
- en: 'Filtering may also be done within a clean step anywhere in the flow. There
    are several ways to apply a filter:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤操作也可以在流程中的清洗步骤内进行。有多种方式可以应用过滤器：
- en: Select one or more values for a given field and then use the **Keep Only** or
    **Exclude** options.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择一个或多个给定字段的值，然后使用**仅保留**或**排除**选项。
- en: 'Use the **Option** button on a field to reveal multiple filter options based
    on the field type. For example, dates may be filtered by **Calculation…**, **Range
    of Dates**, **Relative Dates**, or **Null Values**:'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用字段上的**选项**按钮，根据字段类型显示多个过滤选项。例如，日期可以通过**计算...**、**日期范围**、**相对日期**或**空值**来过滤：
- en: '![](img/B16021_15_32.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_32.png)'
- en: 'Figure 15.32: Filter options for a field include filtering by Calculation,
    Range of Dates, and Relative Dates, and keeping or excluding Null Values'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.32：字段的过滤选项包括按计算、日期范围、相对日期进行过滤，以及保留或排除空值
- en: 'Select a field and then **Filter Values** from the toolbar. Similar to the
    way filters work in the input pane, you will be prompted to write code that returns
    true for records you wish to keep. If, for example, you wanted to keep records
    for trips scheduled after January 1, 2016, you could write code such as the following:'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择一个字段，然后从工具栏中选择**过滤值**。与输入面板中的过滤器工作方式类似，你将被提示编写代码，以返回你希望保留的记录的真值。例如，如果你希望保留2016年1月1日之后的旅行记录，可以编写如下代码：
- en: '[PRE2]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: While no filtering is required for the dataset in our example, you may wish
    to experiment with various filtering techniques.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在我们示例中的数据集无需过滤，但你可能希望尝试不同的过滤技巧。
- en: 'At this point, your flow should look something like this:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 到此为止，你的流程应该像这样：
- en: '![](img/B16021_15_33.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_33.png)'
- en: 'Figure 15.33: Your flow should look similar to this (exact placement and colors
    of steps may vary)'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.33：你的流程应该看起来像这样（步骤的具体位置和颜色可能有所不同）
- en: Let's conclude the Tableau Prep flow with some final transformations to make
    the data even easier to use in Tableau.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过一些最终的转换来结束Tableau Prep流程，使数据在Tableau中更容易使用。
- en: Transforming the data for analysis
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 转换数据以进行分析
- en: 'Let''s create a new branch in the flow to work once again with the detailed
    data. Click on the **Clean 3** step and examine the preview pane. In particular,
    consider the `Route` field:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在流程中创建一个新的分支，再次处理详细数据。点击**清洗 3**步骤并检查预览面板。特别是，考虑一下`Route`字段：
- en: '![](img/B16021_15_34.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_34.png)'
- en: 'Figure 15.34: Route uses airport codes for origin and destination separated
    by a dash'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.34：Route字段使用机场代码表示起点和终点，用破折号分隔
- en: Tableau Desktop (and Server) contain built-in geocoding for airport codes. But
    to accomplish our specific analysis goal (and open other possibilities for geospatial
    functions in Tableau Desktop), we'll supplement our data with our own geocoding.
    We'll also need to consider the shape of the data. Origins and destinations will
    be most useful split into separate fields, and if we want to connect them visually,
    we'll also want to consider splitting them into separate rows (a row for the origin
    and another row for the destination).
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Desktop（和 Server）内置了机场代码的地理编码功能。但为了实现我们的具体分析目标（并为 Tableau Desktop 中的其他地理空间功能开辟新的可能性），我们将通过自己的地理编码来补充数据。我们还需要考虑数据的形态。将起点和终点拆分成单独的字段最为有用，如果我们想要将它们在视觉上连接，我们还需要考虑将它们拆分成单独的行（一个用于起点，另一个用于终点）。
- en: There are quite a few possibilities for visualizing this data. For example,
    we could keep origin and destination on the same row and use a dual-axis map.
    If we want to connect origins with destinations with a line, we could keep them
    in the same row of data and use Tableau's `MAKELINE()` function. The example you'll
    follow here will direct you to split the data into separate rows.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多种可视化数据的方法。例如，我们可以将起点和终点保留在同一行，并使用双轴图。如果我们想通过线条将起点和终点连接起来，我们可以将它们保留在同一数据行中，并使用
    Tableau 的 `MAKELINE()` 函数。这里你将跟随的示例将指导你将数据拆分成单独的行。
- en: 'If you are following along, here are the steps we''ll take:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在跟随本教程，以下是我们将采取的步骤：
- en: Use the **+** button that appears when you hover over the **Clean 3** step.
    Use that to add a new clean step, which will be automatically named **Clean 4**:![](img/B16021_15_35.png)
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用当你悬停在 **Clean 3** 步骤时出现的 **+** 按钮。点击该按钮添加一个新的清理步骤，自动命名为 **Clean 4**：![](img/B16021_15_35.png)
- en: 'Figure 15.35: Adding to a step that already has an output adds a new branch
    to the flow'
  id: totrans-222
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.35：向已有输出的步骤中添加内容会在流程中添加一个新的分支
- en: In the **Clean 4** step, use the ellipses button on the `Route` field and select
    **Split Values** | **Automatic Split**:![](img/B16021_15_36.png)
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Clean 4** 步骤中，点击 `Route` 字段的省略号按钮，选择 **拆分值** | **自动拆分**：![](img/B16021_15_36.png)
- en: 'Figure 15.36: Split Values allows you to divide delimited strings into separate
    fields. Automatic Split attempts to determine the delimiter, while Custom Split…
    allows you greater options and flexibility'
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.36：拆分值允许你将分隔的字符串拆分成单独的字段。自动拆分会尝试确定分隔符，而自定义拆分...则提供更多选项和灵活性
- en: 'You''ll now see two new fields added to the step:'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在你会看到两个新的字段已添加到该步骤：
- en: '![](img/B16021_15_37.png)'
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B16021_15_37.png)'
- en: 'Figure 15.37: The results of the split will be new fields in the flow'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.37：拆分结果将在流程中生成新的字段
- en: '**Route - Split 1** is the origin and **Route - Split 2** is the destination.
    Double-click the field name in the profile pane (or use the option from the ellipses
    button) to rename the fields to `Origin` and `Destination`.'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Route - Split 1** 是起点，**Route - Split 2** 是终点。在配置面板中双击字段名（或使用省略号按钮的选项）将字段重命名为
    `Origin` 和 `Destination`。'
- en: Locate the `US Airports.hyper` file in the `Chapter 15` directory. This file
    contains each `Airport``Code` along with the `Airport``Name` and `Latitude` and
    `Longitude`:![](img/B16021_15_38.png)
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `Chapter 15` 目录下找到 `US Airports.hyper` 文件。该文件包含每个 `Airport` `Code`，以及 `Airport`
    `Name`、`Latitude` 和 `Longitude`：![](img/B16021_15_38.png)
- en: 'Figure 15.38: The hyper extract contains the data we''ll need to supplement
    the flow with our own geospatial data'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.38：超提取文件包含了我们需要补充流程的地理空间数据
- en: Make a connection to this file in Tableau Prep. You may choose to drag and drop
    the file onto the Tableau Prep canvas or use the **Add Connection** button from
    the interface. Tableau will automatically insert an input step named **Extract
    (Extract.Extract)**. Feel free to change the name of the input step to **Airport
    Codes**:![](img/B16021_15_39.png)
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Tableau Prep 中连接此文件。你可以选择将文件拖放到 Tableau Prep 画布上，或使用界面上的 **添加连接** 按钮。Tableau
    会自动插入一个名为 **Extract (Extract.Extract)** 的输入步骤。你可以自由地将输入步骤的名称更改为 **机场代码**：![](img/B16021_15_39.png)
- en: 'Figure 15.39: The input pane for the Airport Codes file'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 15.39：机场代码文件的输入面板
- en: We'll want to join the **Airport Codes** into our flow to look up `Latitude`
    and `Longitude`, but before we do, we'll need to account for the fact that `Origin`
    and `Destination` in **Clean 4** are currently both on the same row of data. One
    option is to pivot the data. Use the **+** button on the **Clean 4** step to add
    a **Pivot** step:![](img/B16021_15_40.png)
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们希望将**机场代码**加入我们的流程中，以便查找`纬度`和`经度`，但在执行之前，我们需要考虑到**Clean 4**中的`起点`和`终点`目前都在同一行数据中。一种选择是透视数据。使用**Clean
    4**步骤中的**+**按钮添加一个**透视**步骤：![](img/B16021_15_40.png)
- en: 'Figure 15.40: Adding a Pivot step from Clean 4'
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图15.40：从Clean 4添加透视步骤
- en: The pivot pane gives you options for transforming rows into columns or columns
    into rows. We'll keep the default option of **Columns to Rows**. Drag both the
    `Origin` and `Destination` fields into the **Pivot1 Values** area of the pane:![](img/B16021_15_41.png)
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 透视窗格提供了将行转换为列或将列转换为行的选项。我们将保留默认选项**列转行**。将`起点`和`终点`字段拖入窗格中的**Pivot1值**区域：![](img/B16021_15_41.png)
- en: 'Figure 15.41: Pivot1 Names keeps values from the original column names, while
    Pivot1 Values contains the actual values from Origin and Destination'
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图15.41：Pivot1名称保持原始列名的值，而Pivot1值则包含来自起点和终点的实际值
- en: 'As a shortcut, instead of *steps 6* and *7*, you could have selected both the
    `Origin` and `Destination` fields in the **Clean 4** step, and selected **Pivot
    Columns to Rows**:'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为快捷方式，代替*步骤6*和*步骤7*，你可以在**Clean 4**步骤中选择`起点`和`终点`字段，并选择**透视列转行**：
- en: '![](img/B16021_15_42.png)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_42.png)'
- en: 'Figure 15.42: A shortcut for pivoting columns to rows'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.42：透视列转行的快捷方式
- en: 'Continue with the following steps:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤继续操作：
- en: Double-click the text for **Pivot1 Values** and rename the field `Airport Code`.
    This field will contain all the airport codes for both the origin and destination
    records.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击**Pivot1值**的文本并将字段重命名为`机场代码`。该字段将包含起点和终点记录的所有机场代码。
- en: Double-click the text for **Pivot1 Names** and rename the field `Route Point`.
    This field will label each record as either an **Origin** or **Destination**.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击**Pivot1名称**的文本并将字段重命名为`路线点`。该字段将标记每条记录为**起点**或**终点**。
- en: At this point, we have a dataset that contains a single record for each endpoint
    of the trip (either an origin or destination).
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此时，我们拥有一个数据集，其中包含每个旅行终点（无论是起点还是终点）的单条记录。
- en: Notice that the pivot resulted in duplicate data. What was once one row (origin
    and destination together) is now two rows. The record count has doubled, so we
    can no longer count the number of records to determine the number of trips. We
    also cannot `SUM` the cost of a ticket as it will double count the ticket. We'll
    need to use `MIN`/`MAX`/`AVG` or some kind of level of detail expression or filter
    to look at only origins or destinations. While many transformations allow us to
    accomplish certain goals, we have to be aware that they may introduce other complications.
  id: totrans-244
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意，透视操作导致了重复数据。曾经是一行（起点和终点合并在一起）的数据现在变成了两行。记录数已翻倍，因此我们不能再通过记录数来确定旅行的数量。我们也不能对票价使用`SUM`，因为它会重复计算票价。我们需要使用`MIN`/`MAX`/`AVG`或某种详细级别的表达式或筛选器，以便仅查看起点或终点。虽然许多转换可以帮助我们实现特定目标，但我们必须意识到它们可能引入其他复杂情况。
- en: The only location information we currently have in our main flow is the airport
    code. However, we already made a connection to `Airports.hyper` and renamed the
    input step as **Airport** **Codes**.
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们当前在主流程中所拥有的唯一位置信息是机场代码。然而，我们已经与`Airports.hyper`建立了连接，并将输入步骤重命名为**机场代码**。
- en: Locate the **Airport Codes** input step and drag it over the **Pivot** step.
    Drop it onto the **Join** area:![](img/B16021_15_43.png)
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定位到**机场代码**输入步骤，并将其拖到**透视**步骤上。将其放置到**连接**区域：![](img/B16021_15_43.png)
- en: 'Figure 15.43: Dragging Airport Codes to the Join area of the Pivot step'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图15.43：将机场代码拖到透视步骤的连接区域
- en: 'After dropping the **Airport Codes** input step onto the **Join** area, a new
    join step will be created, named **Join 1**. Take a moment to examine the join
    pane:'
  id: totrans-248
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在将**机场代码**输入步骤拖到**连接**区域后，将创建一个新的连接步骤，命名为**连接 1**。稍作停顿，查看连接窗格：
- en: '![](img/B16021_15_44.png)'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B16021_15_44.png)'
- en: 'Figure 15.44: The join pane gives a lot of information and options for configuring
    the join and understanding the results. Important sections of the interface are
    numbered with descriptions below'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图15.44：连接窗格提供了大量信息和选项，用于配置连接和理解结果。界面中的重要部分已编号，并附有说明
- en: 'You''ll notice the following features in *Figure 15.44*:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 你会在*图15.44*中注意到以下特征：
- en: '**Applied Join Clauses**: Here, you have the option to add conditions to the
    join clause, deciding which fields should be used as keys to define the join.
    You may add as many clauses as you need.'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**应用的连接子句**：在此，您可以选择向连接子句添加条件，决定哪些字段应作为关键字来定义连接。您可以根据需要添加任意数量的子句。'
- en: '**Join Type**: Here, you may define the type of join (inner, left, left inner,
    right, right inner, outer). Accomplish this by clicking sections of the Venn diagram.'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**连接类型**：在此，您可以定义连接的类型（内部连接、左连接、左内部连接、右连接、右内部连接、外连接）。通过单击Venn图的各个部分来完成此操作。'
- en: '**Summary of Join Results**: The bar chart here indicates how many records
    come from each input of the flow and how many matched or did not match. You may
    click a bar segment to see filtered results in the data grid.'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**连接结果摘要**：这里的条形图显示了来自每个输入的记录数量，以及匹配或未匹配的记录数量。您可以单击条形图的某个部分来查看数据网格中的过滤结果。'
- en: '**Join Clause Recommendations**: If applicable, Tableau Prep will display probable
    join clauses that you can add with a single click.'
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**连接子句建议**：如果适用，Tableau Prep将显示可能的连接子句，您可以通过单击轻松添加。'
- en: '**Join Clauses**: Here, Tableau Prep displays the fields used in the join clauses
    and the corresponding values. Any unmatched values will have a red font color.
    You may edit values by double-clicking them. This enables you to fix individual
    mismatched values as needed.'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**连接子句**：在此，Tableau Prep显示了用于连接子句的字段及其对应的值。任何未匹配的值将以红色字体显示。您可以通过双击它们来编辑值。这使您能够根据需要修复个别不匹配的值。'
- en: 'We do not need to configure anything in this example. The default of an **Inner**
    join on the `Airport Code` fields works well. We can confirm that all `9,158`
    records from the **Pivot** step are kept. Only `32` records from the **Airport
    Codes** hyper file are actual matches (`1,301` records didn''t match). That is
    not concerning. It just means we had a lot of extra codes that could have possibly
    supplemented our data but weren''t actually needed. Now, continuing from our previous
    example:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们不需要配置任何内容。`Airport Code`字段上的**内部连接**默认设置非常有效。我们可以确认来自**Pivot**步骤的所有`9,158`条记录都被保留。只有`32`条来自**Airport
    Codes**超文件的记录是实际匹配的（`1,301`条记录未匹配）。这不需要担心。这仅仅意味着我们有很多多余的代码，这些代码本来可能为数据提供补充，但实际上并不需要。现在，继续我们之前的例子：
- en: From **Join 1**, add a final output step and configure it to output to a `.csv`
    file named `Airline Travel.csv`.
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**连接 1**开始，添加一个最终输出步骤，并将其配置为输出到名为`Airline Travel.csv`的`.csv`文件。
- en: Run the flow by using the run button at the top of the toolbar or by clicking
    the run button on the output step.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用工具栏顶部的运行按钮或点击输出步骤中的运行按钮来运行流程。
- en: '![](img/B16021_15_45.png)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_45.png)'
- en: 'Figure 15.45: The toolbar allows you to run the flow for all outputs or a single
    output, while the button on the output step will run the flow only for that output'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.45：工具栏允许您运行所有输出的流程或单个输出，而输出步骤上的按钮将仅运行该输出的流程
- en: 'Your final flow will look something like this:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 您的最终流程看起来大致如下：
- en: '![](img/B16021_15_46.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_46.png)'
- en: 'Figure 15.46: Your final flow will resemble this, but may be slightly different
    in appearance'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.46：您的最终流程将类似于此，但外观可能略有不同
- en: 'The `Chapter 15 Complete (clean).tfl` file is a bit cleaned up with appropriate
    step labels and descriptions. As a good practice, try to rename your steps and
    include descriptions so that your flow is easier to understand. Here is how the
    cleaned version looks:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '`Chapter 15 Complete (clean).tfl`文件经过了一些清理，添加了适当的步骤标签和描述。作为一种良好的做法，请尝试重命名您的步骤并添加描述，以便使流程更易于理解。以下是清理后的版本：'
- en: '![](img/B16021_15_47.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_47.png)'
- en: 'Figure 15.47: This flow is cleaned up and contains "self-documentation"'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.47：此流程已被清理并包含“自我文档化”
- en: 'Once the flow has been executed, open the `Airline Travel.twb` workbook in
    the `\Learning Tableau\Chapter 15` directory to see how the data might be used
    and to explore it on your own:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦流程执行完毕，打开`Airline Travel.twb`工作簿，该文件位于`\Learning Tableau\Chapter 15`目录中，以查看数据如何使用并自行探索：
- en: '![](img/B16021_15_48.png)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_15_48.png)'
- en: 'Figure 15.48: Exploring the data in the Airline Travel.twb workbook'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.48：在`Airline Travel.twb`工作簿中探索数据
- en: Unlike `.tde` or `.hyper` files, `.csv` files may be written to, even if they
    are open as a data source in Tableau Desktop. You will receive an error if you
    run a flow that attempts to overwrite a `.tde` or `.hyper` file that is in use.
    Additionally, you may rearrange the field order for a `.csv` file by dragging
    and dropping fields into the profile pane of a clean step prior to the output.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 与 `.tde` 或 `.hyper` 文件不同，`.csv` 文件可以被写入，即使它们作为数据源在 Tableau Desktop 中打开。如果你运行一个流程试图覆盖正在使用中的
    `.tde` 或 `.hyper` 文件，你将收到错误提示。此外，你可以通过将字段拖放到清洁步骤的配置文件面板中来重新排列 `.csv` 文件的字段顺序，然后再输出。
- en: With our example concluded, let's wrap up by considering some options for automating
    Tableau Prep flows.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们的示例结束，让我们通过考虑一些自动化 Tableau Prep 流程的选项来总结。
- en: Options for automating flows
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化流程的选项
- en: 'Tableau Prep Builder allows you to design and run flows using the application.
    Sometimes, data cleansing and prepping will be a one-time operation to support
    an ad hoc analysis. However, you will often want to run a flow subsequently to
    capture new or changed data and to cleanse and shape it according to the same
    pattern. In these cases, you''ll want to consider some options for automating
    the flow:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep Builder 允许你使用该应用程序设计和运行流程。有时，数据清洗和准备是一次性的操作，用于支持临时分析。然而，你通常希望随后运行流程，以捕获新数据或更改后的数据，并根据相同的模式清洗和调整它。在这些情况下，你需要考虑一些自动化流程的选项：
- en: '**Tableau Prep Builder** may be run via a command line. You may supply JSON
    files to define credentials for input or output data connections. This enables
    you to use scripting and scheduling utilities to run the flow without manually
    opening and running the Tableau Prep interface. Details on this option are available
    from Tableau Help: [https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line](https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line).'
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Tableau Prep Builder** 可以通过命令行运行。你可以提供 JSON 文件来定义输入或输出数据连接的凭证。这使你能够使用脚本和调度工具运行流程，而无需手动打开并运行
    Tableau Prep 界面。有关此选项的详细信息，请参阅 Tableau 帮助：[https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line](https://onlinehelp.tableau.com/current/prep/en-us/prep_save_share.htm#refresh-output-files-from-the-command-line)。'
- en: '**Tableau Prep Conductor**, an add-on to Tableau Server, gives you the ability
    to publish entire flows from Tableau Prep Builder to Tableau Server and then either
    run them on demand or on a custom schedule. It also provides monitoring and troubleshooting
    capabilities.'
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Tableau Prep Conductor** 是 Tableau Server 的附加组件，允许你将整个流程从 Tableau Prep Builder
    发布到 Tableau Server，然后根据需求或自定义时间表运行这些流程。它还提供了监控和故障排除功能。'
- en: Summary
  id: totrans-277
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Tableau Prep's innovative paradigm of hands-on data cleansing and shaping with
    instant feedback greatly extends the Tableau platform and gives you incredible
    control over your data. In this chapter, we considered the overall interface and
    how it allows you to iteratively and rapidly build out a logical flow to clean
    and shape data for the desired analysis or visualization.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau Prep 通过即时反馈的动手数据清洗和调整的创新范式，极大地扩展了 Tableau 平台，并使你对数据拥有了令人难以置信的控制力。在本章中，我们考虑了整体界面以及它如何使你能够迭代和快速构建一个逻辑流程，用于清洗和调整数据，以便进行所需的分析或可视化。
- en: Through a detailed, yet practical, example that was woven throughout this chapter,
    we explored every major transformation in Tableau Prep, from inputs to unions,
    joins, aggregates and pivots, to outputs. Along the way, we also examined other
    transformations and capabilities, including calculations, splits, merges, and
    the grouping of values. This gives you a foundation for molding and shaping data
    in any way you need.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本章中贯穿始终的详细而实用的示例，我们探索了 Tableau Prep 中的每个主要转换，从输入到联合、连接、聚合和透视，再到输出。在此过程中，我们还考察了其他转换和功能，包括计算、拆分、合并以及值的分组。这为你提供了在任何需要的方式下塑造和调整数据的基础。
- en: In the next chapter, we'll conclude with some final thoughts on how you can
    leverage Tableau's platform to share your analysis and data stories!
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将总结一些关于如何利用 Tableau 平台分享你的分析和数据故事的最终思考！
