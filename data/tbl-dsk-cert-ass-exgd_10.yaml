- en: Level of Detail Expressions
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 细节级别表达式
- en: In the previous chapter, we covered table calculations, which are extremely
    useful when we want to aggregate information using exactly the data that is in
    the view, but sometimes we want to use more (or less) than the information that
    can be seen on the screen. For instance, if you want to show the average spend
    by customer, you don't want to show all customers and their value to compute an
    average. This is where **Level of Detail** **(LOD)** calculations, which we will
    introduce in this chapter, can be used, because they help us change the level
    of aggregation.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了表计算，当我们需要使用视图中的确切数据聚合信息时，它们非常有用，但有时我们想要使用比屏幕上可以看到的信息更多（或更少）。例如，如果您想显示客户的平均消费，您不想显示所有客户及其价值来计算平均值。这就是我们将在本章介绍的**细节级别**（**LOD**）计算可以发挥作用的地方，因为它们帮助我们改变聚合级别。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Tableau's order of operations
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tableau 的操作顺序
- en: '`FIXED` LOD calculations'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FIXED` LOD 计算'
- en: '`INCLUDE` LOD calculations'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`INCLUDE` LOD 计算'
- en: '`EXCLUDE` LOD calculations'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`EXCLUDE` LOD 计算'
- en: Data source constraints for LOD
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LOD 的数据源约束
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: This chapter uses the Global Superstore dataset, which can be found at [http://www.tableau.com/sites/default/files/training/global_superstore.zip](http://www.tableau.com/sites/default/files/training/global_superstore.zip).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本章使用 Global Superstore 数据集，可以在 [http://www.tableau.com/sites/default/files/training/global_superstore.zip](http://www.tableau.com/sites/default/files/training/global_superstore.zip)
    找到。
- en: Tableau's order of operations
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Tableau 的操作顺序
- en: Before delving deeper into LOD calculations, it is first important to understand
    Tableau's order of operations, as this will guide our conversation, seeing where
    this new topic fits in.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入研究 LOD 计算之前，首先重要的是理解 Tableau 的操作顺序，因为这将指导我们的讨论，了解这个新主题的适用位置。
- en: Surprising results
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 意想不到的结果
- en: Especially when coming to Tableau from Excel or other BI tools, one is sometimes
    at a loss when dealing with Tableau's order of operations. What can seem intuitive
    is not always what is reflected. Applying the wrong type of filter, or not using
    the proper calculation, will result in meaningless results.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 尤其是从 Excel 或其他 BI 工具转向 Tableau 时，有时在处理 Tableau 的操作顺序时，人们会感到困惑。看似直观的并不总是反映出来。应用错误的过滤器类型或未使用适当的计算将导致无意义的结果。
- en: The following is one such scenario. In the Global Superstore dataset, we create
    a data source filter for `Country` to show United Kingdom orders only, a dimension
    filter for `State` Wales and a **Top 10 Customer Names by Sales** filter.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个这样的场景。在 Global Superstore 数据集中，我们为 `Country` 创建了一个数据源过滤器，仅显示英国订单，为 `State`
    Wales 创建了一个维度过滤器，以及一个**按销售额排序的前 10 名客户名称**过滤器。
- en: As a reminder, you can set up a **Top** filter by using the Top option of the
    Filter window, and in this case selecting By Field, Top 10, Sales, and Sum.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 提醒一下，您可以通过使用过滤器窗口的**Top**选项来设置**Top**过滤器，在这种情况下选择按字段、Top 10、销售额和总和。
- en: Why should there be only one customer in the results when we have set a filter
    for the top 10?
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么当我们设置了 Top 10 过滤器时，结果中只有一个客户？
- en: '![](img/efaf9963-a6ad-4416-a791-42bd79ca7e13.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/efaf9963-a6ad-4416-a791-42bd79ca7e13.png)'
- en: We will determine why we're not seeing the desired top 10 customers using the
    order of operations in the next section.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在下一节中确定为什么我们没有看到期望的前 10 名客户，使用操作顺序。
- en: The order
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 顺序
- en: 'In order to interpret this, let''s look at the infamous order of operations
    with the elements that we are already familiar with at this point in the book:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解释这一点，让我们看看我们在这个书中的这个阶段已经熟悉的著名操作顺序的元素：
- en: Extract filters
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取过滤器
- en: Data source filters
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据源过滤器
- en: Context filters
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上下文过滤器
- en: Sets, conditional, and top N filters
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 集合、条件和 Top N 过滤器
- en: Dimension filters
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 维度过滤器
- en: Data blending
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据混合
- en: Measure filters
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 度量过滤器
- en: Totals
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总计
- en: Table calculations
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 表计算
- en: Operations in Tableau are performed in this order, starting from the top and
    making their way down.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 中的操作按照从上到下的顺序执行。
- en: First, we have **data source** or **extract** filters (depending on the type
    of connection used, whether Live or Extract), as described in Chapter 1, *Building
    Your Data Model*. These affect the entirety of your dataset at workbook level,
    before any specific filters that can be applied at worksheet level. As far as
    Tableau computation is concerned in the workbook, the filtered-out data doesn't
    even exist.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们有**数据源**或**提取**过滤器（根据使用的连接类型，是实时还是提取），如第一章*构建您的数据模型*中所述。这些影响工作簿级别的整个数据集，在可以应用于工作表级别的任何特定过滤器之前。就工作簿中的Tableau计算而言，过滤掉的数据甚至不存在。
- en: '*Context* filters are similar to data source or extract filters, but are view-specific.
    They are generally used to speed up processing, because they can further reduce
    the scope of data, as if creating a temporary subset of it before generating the
    view. These are mainly useful to improve the performance of a view that will be
    category-specific (for example, sales of Copiers only), within a very large dataset
    that can''t be filtered at workbook level.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '*上下文*过滤器类似于数据源或提取过滤器，但它们是视图特定的。它们通常用于加快处理速度，因为它们可以进一步缩小数据范围，就像在生成视图之前创建它的临时子集一样。这些主要适用于提高在非常大的数据集中（无法在工作簿级别进行筛选）将特定于类别（例如，仅复印机销售）的视图的性能。'
- en: Context filters can be created by selecting an existing dimension filter in
    the filters pane, and clicking the Add to context option. The blue pill will turn
    gray to signify that the filter is now a context filter.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过在过滤器面板中选择现有的维度过滤器，并点击“添加到上下文”选项来创建上下文过滤器。蓝色药丸将变成灰色，以表示该过滤器现在是一个上下文过滤器。
- en: '*Sets*, *dimension*, and *measure* filters (including *conditional* and *top
    N* filters) have been described at length in Chapter 1, *Building Your Data Model*,
    and [Chapter 2](6ebf2184-6a4e-42de-8741-4c9f71f652d3.xhtml), *Working with Worksheets*,
    as is the case for *data blending* in [Chapter 1](786fd5d5-eb79-4216-bd9a-96d0a59374ea.xhtml),
    *Building Your Data Model*. Please refer to these chapters to clear up any remaining
    doubts on these subjects.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '*集合*、*维度*和*度量*过滤器（包括*条件*和*顶级N*过滤器）在第一章*构建您的数据模型*和第二章*使用工作表*中进行了详细描述，正如第一章*构建您的数据模型*中描述的*数据混合*一样。请参考这些章节以解决对这些主题的任何剩余疑问。'
- en: With the order of operations as it currently stands, it's worth realizing that
    table calculations (as described in the previous chapter) come last in the order,
    after totals (which represent the usual calculations used in Tableau). For example,
    if we are using a rank table calculation on **Customer Name** in a given **State**,
    the rank will include orders in that state and that state only, as table calculations
    come after dimension filters. The biggest customer in the dataset might just be
    the 10th customer in a particular region.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 根据当前的操作顺序，值得意识到的是，表格计算（如前一章所述）在顺序中排在最后，在总计（代表Tableau中使用的常规计算）之后。例如，如果我们在一个特定的**State**中对**Customer
    Name**使用排名表格计算，排名将包括该州及其订单，因为表格计算在维度过滤器之后。数据集中最大的客户可能只是特定地区的第10位客户。
- en: Now that we know about the order, let's go back to our previous example.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了顺序，让我们回到之前的例子。
- en: Explaining the surprising results
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 解释令人惊讶的结果
- en: 'We now hold the tools to understand why only one customer shows up:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在有了理解为什么只有一个客户出现的原因的工具：
- en: '![](img/d069bfb3-4bf5-44f2-8831-7cbeb38f4e2a.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d069bfb3-4bf5-44f2-8831-7cbeb38f4e2a.png)'
- en: If we take a look at the order of operations, the top N filter comes before
    the dimension filter (in this case, for `State` Wales), but after the data Source
    filters (here, `Country` United Kingdom).
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们看一下操作顺序，顶级N过滤器在维度过滤器（在这种情况下，对于`State`威尔士）之前，但在数据源过滤器（这里，`Country`英国）之后。
- en: The sales shown in the results are therefore sales in Wales for customers that
    are in the top 10 *UK-wide*, not just in Wales. Nine of those customers have no
    sales in Wales, just in the other parts of the UK, and don't appear in our results.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 结果中显示的销售因此是威尔士地区前10名*全国性*客户（而不仅仅是威尔士地区的客户）的销售。其中九位客户在威尔士没有销售，只是在英国的其他地区，并且不出现在我们的结果中。
- en: 'If one wanted to see the top 10 customers in Wales for sales occurring there
    only, it is possible to promote the filter on `State` to be a context filter,
    moving it back up in the order of operations:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 如果想查看仅在威尔士发生销售的顶级10名客户，可以将`State`过滤器提升为上下文过滤器，将其在操作顺序中向上移动：
- en: '![](img/c936ff6e-faa0-4b31-93bd-692953d44b09.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c936ff6e-faa0-4b31-93bd-692953d44b09.png)'
- en: Now that we've covered the order of operations, let's dive into LOD functions,
    which are going to allow us to change levels of aggregation.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经涵盖了运算顺序，让我们深入了解 LOD 函数，这将允许我们更改聚合级别。
- en: FIXED LOD calculations
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: FIXED LOD 计算
- en: '`FIXED` is the first of three LOD calculations we will study in this chapter.
    It is used to make a calculation regardless of any dimension or measure filters
    that are applied in the workbook. The syntax of `FIXED` is the following: `{FIXED
    [dim1[, dim2]…] : aggregate-expression}`, with `[dim1[, dim2]…]` a list of dimensions
    along which the aggregation is to be calculated.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '`FIXED` 是本章我们将要研究的三个 LOD 计算中的第一个。它用于在电子表格中应用任何维度或测量过滤器的情况下进行计算。`FIXED` 的语法如下：`{FIXED
    [dim1[, dim2]…] : 聚合表达式}`，其中 `[dim1[, dim2]…]` 是要计算的聚合维度的列表。'
- en: Please note the use of curly brackets. The syntax will be the same for all three
    LOD expressions we describe in this chapter.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意大括号的使用。本章中我们将描述的所有三个 LOD 表达式的语法都将相同。
- en: 'For instance, let''s look at the date of first order for a given customer.
    While a `MIN([Date])` calculation will give the first date *in the filtered dataset*
    with **Customer Name** used as a row or column, `{FIXED [Customer ID] :MIN([Date])}`
    will give the first date for a customer *in the entire dataset*, filters notwithstanding,
    for each `Customer ID`. As a result, if we look at orders in 2013 in the Global
    Superstore dataset, we notice that the `First Order Date` can be in 2011:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '例如，让我们看看给定客户的首次订单日期。虽然 `MIN([Date])` 计算将给出使用 **客户名称** 作为行或列的筛选数据集中的第一个日期，但
    `{FIXED [Customer ID] : MIN([Date])}` 将给出每个 `Customer ID` 在整个数据集中的第一个日期，不考虑筛选器，对于每个客户。因此，如果我们查看
    2013 年在 Global Superstore 数据集中的订单，我们会注意到 `First Order Date` 可以是 2011 年：'
- en: '![](img/10c22e96-0244-42e5-8b47-39ca89ec2437.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/10c22e96-0244-42e5-8b47-39ca89ec2437.png)'
- en: Let's now take a look at how this will be affected by the order of operations.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们现在看看这将如何受到运算顺序的影响。
- en: Order of operations
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 运算顺序
- en: 'The place of this calculation in the order of operations is therefore the following:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，这个计算在运算顺序中的位置如下：
- en: Extract/data source filters
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取/数据源筛选器
- en: Context filters
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上下文筛选器
- en: Sets, conditional, and top N Filters, `FIXED` LOD calculations
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 集合、条件和高 N 过滤器，`FIXED` LOD 计算
- en: Dimension filters
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 维度筛选器
- en: Data blending
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据混合
- en: Measure filters
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测量过滤器
- en: Totals
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总计
- en: Table calculations
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 表计算
- en: Let's consider three examples to understand how to use this calculation.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们考虑三个示例来了解如何使用这个计算。
- en: Example 1 – lifetime sales value
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例 1 – 终身销售价值
- en: Using the Global Superstore dataset, we want to represent the lifetime sales
    value of our low-profit subcategories in 2013.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Global Superstore 数据集，我们想要表示 2013 年我们低利润子类别的终身销售价值。
- en: 'We define a new calculated field, `Lifetime Sales Value`, as `{FIXED [Subcategories]
    : SUM([Sales])}`. This will calculate the total sales by subcategory, regardless
    of any dimension filters set. Therefore, if we filter for orders placed in 2013
    as a dimension filter, and compute `Profit Ratio` (defined as `SUM([Profit]) /
    SUM([Sales])`), `Sales`, and `Lifetime Sales Value`, we have the following:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '我们定义一个新的计算字段，`Lifetime Sales Value`，为 `{FIXED [Subcategories] : SUM([Sales])}`。这将计算子类别的总销售额，不考虑任何设置的维度筛选器。因此，如果我们以
    2013 年的订单作为维度筛选器进行筛选，并计算 `Profit Ratio`（定义为 `SUM([Profit]) / SUM([Sales])`）、`Sales`
    和 `Lifetime Sales Value`，我们将得到以下结果：'
- en: '![](img/154b0b59-5bac-46d8-8b5d-89054162cd48.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/154b0b59-5bac-46d8-8b5d-89054162cd48.png)'
- en: While the Tables subcategory is not profitable in 2013, with sales of $202,364,
    it generated $757,042 in sales across the whole dataset.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 Tables 子类别在 2013 年没有盈利，销售额为 202,364 美元，但它在整个数据集中产生了 757,042 美元的销售额。
- en: Example 2 – contributions
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例 2 – 贡献
- en: Using the Global Superstore dataset, we want to see the contribution of units
    ordered by country in the LATAM market, against both that region only and the
    whole company.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Global Superstore 数据集，我们想要看到在拉丁美洲市场按国家订购的单位对整个区域和整个公司的贡献。
- en: The list of dimensions in the `FIXED` syntax is optional. We can therefore define
    `Total Quantity` as `{FIXED:SUM([Quantity])}`. This will be the equivalent of
    having a quantity that is equal to the total units for each calculation. This
    will be a value that will never change regardless of the level of aggregation
    of our view.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '`FIXED` 语法中的维度列表是可选的。因此，我们可以将 `Total Quantity` 定义为 `{FIXED:SUM([Quantity])}`。这将等同于每个计算的总单位数。这将是一个不会因我们视图的聚合级别而改变的值。'
- en: We can then define `Worldwide Qty Contribution` as `SUM([Quantity]) / ATTR([Total
    Quantity])` (as `Total Quantity` needs no aggregation).
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以将“全球数量贡献”定义为`SUM([Quantity]) / ATTR([Total Quantity])`（因为“总数量”不需要聚合）。
- en: Here, we use `ATTR`, because otherwise we would get an error due to mixing aggregates
    and non-aggregates.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，我们使用`ATTR`，因为否则我们会因为混合聚合和非聚合而得到错误。
- en: 'Showing `Quantity`, a window calculation for Percent of Total for `Quantity` that
    we can call `Region Qty Contribution` (along Table (down)) and the newly defined
    `Worldwide Qty Contribution`, and filtering for market LATAM, we get the following:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 显示“数量”，一个针对“数量”的百分比总量的窗口计算，我们可以称之为“区域数量贡献”（沿表（向下））和刚刚定义的“全球数量贡献”，并筛选市场“LATAM”，我们得到以下结果：
- en: '![](img/6a2f90c0-5ad7-454a-92d0-405707b176e7.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/6a2f90c0-5ad7-454a-92d0-405707b176e7.png)'
- en: The results are different between the last two columns here because the table
    calculation only considers data in LATAM (because it comes after dimension filters
    in the order of operations), while the LOD calculation considers the entire dataset.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 这里最后两列的结果不同，因为表格计算只考虑了LATAM（因为它在操作顺序中位于维度过滤器之后）的数据，而LOD计算则考虑了整个数据集。
- en: 'If we want to go a level further, we can make this a map view: remove the first
    two measures to keep only `Worldwide Qty Contribution`, click on Show Me > Maps, and
    finally choose the Analysis > Show Mark Labels options:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想进一步深入，我们可以将其变成一个地图视图：移除前两个度量以仅保留“全球数量贡献”，点击“显示我”>“地图”，最后选择“分析”>“显示标记标签”选项：
- en: '![](img/7d7aebde-4933-44fa-940f-2b978ec83bdd.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/7d7aebde-4933-44fa-940f-2b978ec83bdd.png)'
- en: If we further filter the countries, we will still see their contribution to
    the worldwide market, contrary to a table calculation, which will consider only
    the filtered dataset.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们进一步筛选国家，我们仍然会看到他们对全球市场的贡献，这与表格计算不同，表格计算只会考虑筛选后的数据集。
- en: Example 3 – cohorts
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例3 – cohort分析
- en: Using the Global Superstore dataset, we want to see how many sales were generated
    in 2012 for customers (`Customer ID`) making their first purchase (`Order Date`)
    in that year. This is what is usually called a **cohort analysis**, and is often
    seen in the exam.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 使用“全球超市”数据集，我们想看看2012年有多少销售额是由当年首次购买（订单日期）的客户（客户ID）产生的。这通常被称为** cohort analysis**，在考试中经常出现。
- en: 'For each customer, we first have to define their earliest date of purchase.
    To do so, we create a calculated `First Order Date` field as `{FIXED [Customer
    ID] : MIN([Order Date])}`. This will take the earliest `Order Date` in the entire
    dataset for each `Customer ID`.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '对于每个客户，我们首先必须定义他们最早的购买日期。为此，我们创建一个计算出的“首次订单日期”字段`{FIXED [Customer ID] : MIN([Order
    Date])}`。这将取整个数据集中每个`Customer ID`的最早`Order Date`。'
- en: 'We can then create a visualization with `Year([Order Date])` as columns, `Year([First
    Order Date])` as rows, and `SUM([Sales])` as measures. This gives the following:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以创建一个以`Year([Order Date])`为列，`Year([First Order Date])`为行，`SUM([Sales])`为度量的可视化。这给出了以下结果：
- en: '![](img/72c7aad7-b21c-4e55-b893-19c75da124c4.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/72c7aad7-b21c-4e55-b893-19c75da124c4.png)'
- en: Customers making their first order in 2012 have therefore spent $128,828 in
    that year.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在2012年首次下单的客户在该年花费了$128,828。
- en: To summarize, we use the `FIXED` LOD to make a calculation regardless of any
    dimension or measure filters that are applied in the workbook, which is helpful
    for contributions, cohorts, or any calculation that has to take the entire dataset
    into account. Let's carry on with the second LOD calculation.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 总结一下，我们使用`FIXED` LOD来做出不受工作簿中应用的任何维度或度量过滤器影响的计算，这对于贡献、cohort分析或任何需要考虑整个数据集的计算非常有用。让我们继续进行第二个LOD计算。
- en: INCLUDE LOD calculations
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '`INCLUDE` LOD计算'
- en: The `INCLUDE` LOD calculation is used to add a layer of aggregation that will
    not be used as part of the dimensions. For instance, you might want to see the
    average customer's lifetime value in different markets. Under normal circumstances,
    you would need to first aggregate at customer level, and then use the results
    of that aggregation to compute an average. In the SQL world, we would use a subquery.
    Simply averaging all sales will not yield the same results, as it will be computed
    at the line item level and will therefore give the average value of a line item.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`INCLUDE` LOD计算用于添加一层聚合，它不会作为维度的一部分使用。例如，你可能想查看不同市场的平均客户终身价值。在正常情况下，你需要首先在客户级别进行聚合，然后使用该聚合的结果来计算平均值。在SQL世界中，我们会使用子查询。简单地平均所有销售额不会得到相同的结果，因为它将在行项目级别进行计算，因此会给出行项目的平均价值。'
- en: We can understand this by saying that we want to aggregate at a level that includes
    both the dimensions already in the view and another set of additional dimensions.
    This means that we have data that is more granular than what will be shown in
    the view, and therefore that we will need to further aggregate the results of
    that calculation to show them in the view. While the results of a `FIXED` calculation
    don't need to be aggregated, the results of an `INCLUDE` statement do.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过说我们想要在包含视图中的维度和另一组额外维度级别的层面上进行聚合来理解这一点。这意味着我们拥有比视图将显示的更细粒度的数据，因此我们需要进一步聚合该计算的成果以在视图中显示。虽然`固定`计算的结果不需要聚合，但`包含`语句的结果需要。
- en: 'As a reminder, the syntax is similar to `FIXED` statements: `{INCLUDE [dim1[,
    dim 2]…] : aggregate-expression}`. While the dimensions are technically optional
    parameters, there is no gain in using an `INCLUDE` function in that case, it is
    just computing the usual aggregation with no added granularity.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '作为提醒，语法类似于`固定`语句：`{INCLUDE [dim1[, dim 2]…] : aggregate-expression}`。虽然维度在技术上是可以省略的参数，但在那种情况下使用`包含`函数没有好处，它只是计算通常的聚合，没有增加粒度。'
- en: As for `FIXED`, it's important to see where this sits in the order of operations
    to optimize its use, before we carry on with examples.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`固定`，在继续举例之前，了解它在运算顺序中的位置以优化其使用是很重要的。
- en: Order of operations
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 运算顺序
- en: 'This particular LOD function, as well as the `EXCLUDE` LOD calculation that
    will shortly follow, comes between data blending and measure filters. They are
    thus computed later than the `FIXED` calculation:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 这个特定的LOD函数，以及随后将出现的`排除`LOD计算，位于数据混合和度量过滤器之间。因此，它们的计算晚于`固定`计算：
- en: Extract/data source filters
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取/数据源过滤器
- en: Context filters
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上下文过滤器
- en: Sets, conditional, and top N filters, `FIXED` LOD calculations
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 集合、条件、Top N过滤器，`固定`LOD计算
- en: Dimension filters
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 维度过滤器
- en: Data blending
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据混合
- en: '`INCLUDE` and`EXCLUDE` LOD calculations'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`包含`和`排除`LOD计算'
- en: Measure filters
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 度量过滤器
- en: Totals
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总计
- en: Table calculations
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 表计算
- en: Example 1 – average customer lifetime value
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例 1 – 客户平均终身价值
- en: Using the Global Superstore dataset, for the Technology category, we want to
    see the average lifetime sales value of customers, split by `Segment` and `Market`.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 使用全球超市数据集，对于技术类别，我们想查看按`Segment`和`Market`拆分的客户平均终身销售价值。
- en: 'If we just calculate a straight `AVG([Sales])`, we get the following:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们只计算直接的`AVG([Sales])`，我们会得到以下结果：
- en: '![](img/872d070a-456b-4720-8baf-1140ad17d7ed.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/872d070a-456b-4720-8baf-1140ad17d7ed.png)'
- en: However, that is representing the average sales to customers *at the line item
    level*, not the lifetime value. If customer A has two orders for $100 and $200
    and customer B has a sale for $300, the average sale is $200, but the average
    lifetime sales value is $300, as both customers have a lifetime value of $300\.
    Here, we need to first compute the sales at customer level, and then average the
    results.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这代表的是客户在行项目级别的平均销售额，而不是终身价值。如果客户A有两个订单，金额分别是100美元和200美元，而客户B有一个300美元的销售，平均销售额是200美元，但平均终身销售价值是300美元，因为两位客户的终身价值都是300美元。在这里，我们首先需要在客户级别计算销售额，然后对结果进行平均。
- en: 'The dimension we''re missing in the view is `Customer Name`. We will therefore
    create an `INCLUDE` statement as `{INCLUDE [Customer Name]:SUM([Sales])}`, which
    will create an intermediary calculation at customer level. The results of that
    calculation can then be aggregated using an `AVG` to yield the correct results:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 视图中缺少的维度是`客户名称`。因此，我们将创建一个`包含`语句`{INCLUDE [Customer Name]:SUM([Sales])}`，这将创建一个客户级别的中间计算。然后可以使用`AVG`对这些计算结果进行聚合，以得到正确的结果：
- en: '![](img/7a8a4b55-dbc1-4a6a-b9a7-3fdc930aefd8.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/7a8a4b55-dbc1-4a6a-b9a7-3fdc930aefd8.png)'
- en: It is worth noting that if we are always going to average the lifetime sales
    value of a customer, we can enclose the `INCLUDE` statement in an `AVG` inside
    the **Calculated field**, and Tableau will recognize how to aggregate this without
    needing to specify it every time: `AVG({INCLUDE [Customer Name]:SUM([Sales])})`.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，如果我们总是要计算客户的终身销售价值平均值，我们可以在**计算字段**内的`AVG`中包含`包含`语句，Tableau将识别如何进行聚合，而无需每次都指定它：`AVG({INCLUDE
    [Customer Name]:SUM([Sales])})`。
- en: Example 2 – median of average days to ship by customer
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例 2 – 客户平均发货天数的中位数
- en: The Global Superstore company is worried that some orders are being shipped
    late, and about the impact it might have on its customers. Let's look at `Average
    Days to Ship` by `Customer Name` for late orders.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 全球超市公司担心一些订单发货延迟，以及这可能会对其客户产生的影响。让我们看看 `平均发货天数` 通过 `客户名称` 对延迟订单的分析。
- en: If not already defined in the workbook, `Average Days to Ship` is calculated
    as `DATEDIFF('day',[Order Date],[Ship Date])`, and `Ship Status` as `IF [Days
    to Ship (Actual)] > [Days to Ship (Scheduled)] THEN "Shipped Late"`
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在工作簿中尚未定义，`平均发货天数` 计算为 `DATEDIFF('day',[订单日期],[发货日期])`，而 `发货状态` 为 `IF [实际发货天数]
    > [计划发货天数] THEN "发货延迟"`
- en: '`ELSEIF [Days to Ship (Actual)] = [Days to Ship (Scheduled)] THEN "Shipped
    On Time"`'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`ELSEIF [实际发货天数] = [计划发货天数] THEN "按时发货"`'
- en: '`ELSE "Shipped Early" END`.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`ELSE "提前发货" END`.'
- en: 'As seen in previous chapters, we can create a quick distribution plot by `Segment`
    and `Market`, using `Customer Name` as a Detail mark to see each individual customer,
    filtering for orders where `Ship Status` is Shipped Late:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如前几章所见，我们可以通过 `细分` 和 `市场` 创建一个快速分布图，使用 `客户名称` 作为详细标记以查看每个客户，并筛选出 `发货状态` 为发货延迟的订单：
- en: '![](img/e35f5ab8-6e3d-4002-b648-87b9faf55ecf.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/e35f5ab8-6e3d-4002-b648-87b9faf55ecf.png)'
- en: While it is sometimes worthwhile to see each customer, a top-line number for
    each quadrant can be a good indicator of performance. Let's choose the median
    as one such indicator. We now need to remove `Customer Name` as a dimension, but
    still keep it in the calculation to find the median.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然有时查看每个客户是有价值的，但每个象限的概览数字可以是一个良好的性能指标。让我们选择中间值作为这样一个指标。我们现在需要移除 `客户名称` 作为维度，但仍然在计算中保留它以找到中间值。
- en: 'Here, we can define `MEDIAN({INCLUDE [Customer Name] : AVG([Days to Ship (Actual)])})`.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '在这里，我们可以定义 `MEDIAN({INCLUDE [客户名称] : AVG([实际发货天数])})`.'
- en: 'Let''s deconstruct this, starting from the right. Look at average days to ship.
    The view includes **Segment** and **Region**, so the aggregation would normally
    be performed at that level. However, we want to calculate this at customer level,
    so we create the `INCLUDE` statement, specifying that we want to add `Customer
    Name` to the list of dimensions even though it is not part of our view. Having
    results that are now too granular to be shown in the view, we choose to finally
    aggregate by taking the median of those results. If we create a quick view of
    that measure by `Segment` and `Market`, using the Measure Values as Color and
    the Analysis > Show Mark Labels option, we get the following:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从右边开始分解这个公式。看看平均发货天数。视图包括 **细分** 和 **地区**，所以通常的聚合会在那个级别进行。然而，我们希望在客户级别进行计算，因此我们创建了一个
    `INCLUDE` 语句，指定我们想要将 `客户名称` 添加到维度列表中，即使它不是我们视图的一部分。由于现在结果过于详细，无法在视图中显示，我们选择最终通过取这些结果的中间值来进行聚合。如果我们通过
    `细分` 和 `市场` 创建一个快速视图来查看这个度量，使用度量值作为颜色和分析 > 显示标记标签选项，我们得到以下结果：
- en: '![](img/65b4f7db-4d7d-440b-9fdf-168abced73be.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/65b4f7db-4d7d-440b-9fdf-168abced73be.png)'
- en: To summarize, we can use the `INCLUDE` LOD to first aggregate a level that is
    higher than the view, including some dimensions that are not present in it, that
    we can then aggregate back to the view level. This is useful when trying to extract
    and summarize order-level data from a dataset of item-level data. Let's study
    one last LOD calculation before closing off this chapter.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，我们可以使用 `INCLUDE` LOD 首先聚合一个高于视图级别的级别，包括一些不在其中但我们可以将其聚合回视图级别的维度。这在尝试从项目级别数据的集合中提取和总结订单级别数据时很有用。在结束这一章之前，让我们研究一个最后的
    LOD 计算示例。
- en: EXCLUDE LOD calculations
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: EXCLUDE LOD 计算示例
- en: While `INCLUDE` LOD calculations enabled us to calculate along the view dimensions
    and the further dimensions specified, `EXCLUDE` LOD calculations enable users
    to make calculations omitting one of the dimensions that have been used in the
    view. For instance, we can use `EXCLUDE` to calculate the total sum of profits
    for one category across regions, even if `Region` is used as a row. This is especially
    useful when dealing with contributions to a total.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 `INCLUDE` LOD 计算使我们能够沿着视图维度和指定的进一步维度进行计算，但 `EXCLUDE` LOD 计算允许用户在计算时省略视图中使用的一个维度。例如，我们可以使用
    `EXCLUDE` 来计算一个类别在各个地区的总利润，即使 `地区` 被用作行。这在处理对总量的贡献时特别有用。
- en: Example 1 – contribution to total
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例 1 – 对总量的贡献
- en: Using the Global Superstore dataset, we want to show contributions to total
    profit for the South region of the EU market, slicing by country, category, and
    subcategory. What is the contribution of the **Fasteners** subcategory in **Italy**
    to the overall Fasteners business in the South?
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Global Superstore数据集，我们希望显示欧盟市场南部地区的总利润贡献，按国家、类别和子类别切割。**意大利**的**紧固件**子类别对南部整体紧固件业务的贡献是什么？
- en: 'We can first plot profit by `Country` and `Sub-category` in the South, adding
    totals:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以先在南方按`Country`和`Sub-category`绘制利润，并添加总计：
- en: '![](img/a6d928b5-cfb4-4dd5-8dd8-5a06c88c2132.png)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/a6d928b5-cfb4-4dd5-8dd8-5a06c88c2132.png)'
- en: In the case of **Fasteners** in Italy, we want to see that it represents $578/$898
    = 64% of the profit.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在意大利的**紧固件**情况下，我们希望看到它代表了利润的 $578/$898 = 64%。
- en: We have two ways of calculating that contribution. We can add a quick table
    calculation for Percent of Total for `SUM(Profit)`, with computation along Table
    (across).
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有两种计算这种贡献的方法。我们可以为`SUM(Profit)`添加一个快速表格计算，计算总百分比，计算沿表（跨）进行。
- en: 'We can also use an LOD, calculating the overall profit for a subcategory as
    `{EXCLUDE [Country]: Sum([Profit])}`, which will remove the dependency on `Country`,
    but not on `Sub-category`. As a result, we can further define `SUM([Profit]) /
    ATTR({EXCLUDE [Country]: Sum([Profit])})` as the contribution of one country to
    the overall region:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '我们还可以使用一个LOD，计算子类别的总利润为`{EXCLUDE [Country]: Sum([Profit])}`，这将消除对`Country`的依赖，但不会对`Sub-category`产生影响。因此，我们可以进一步定义`SUM([Profit])
    / ATTR({EXCLUDE [Country]: Sum([Profit])})`为一个国家对整个地区的贡献：'
- en: '![](img/991a2016-c825-4728-80e8-2f624602d43f.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/991a2016-c825-4728-80e8-2f624602d43f.png)'
- en: As expected, both calculations yield the same results. We can also roll up to
    category or drill down to product name without having to redefine the field. Regardless
    of how we slice the data, we will always show contributions to the overall region.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期的那样，这两个计算产生了相同的结果。我们也可以向上汇总到类别或向下钻取到产品名称，而无需重新定义字段。无论我们如何切割数据，我们都会始终显示对整个地区的贡献。
- en: The only difference between those two calculations resides in the order of operations.
    While `EXCLUDE` LOD calculations come before measure filters, table calculations
    come after. As a result, if we filter on measures, the table calculations will
    reflect only the values in the table, while the `EXCLUDE` LOD calculation will
    continue to show the same results.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个计算之间的唯一区别在于运算顺序。虽然`EXCLUDE` LOD计算在度量过滤器之前，但表格计算在之后。因此，如果我们根据度量进行筛选，表格计算将仅反映表中的值，而`EXCLUDE`
    LOD计算将继续显示相同的结果。
- en: 'For instance, if we filter on `SUM(Profit)` to show only profitable quadrants
    (that is, `SUM(Profit) > 0`), we get the following:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果我们根据`SUM(Profit)`筛选，只显示盈利的四象限（即`SUM(Profit) > 0`），我们得到以下结果：
- en: '![](img/57d97620-ce5a-4045-a37e-7357c394573c.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/57d97620-ce5a-4045-a37e-7357c394573c.png)'
- en: We can see that the `EXCLUDE` LOD calculations have not changed, while `Table
    Calc` now reflects only the data shown on the screen.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，`EXCLUDE` LOD计算没有变化，而`Table Calc`现在仅反映屏幕上显示的数据。
- en: Example 2 – difference in average profit
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 示例 2 – 平均利润差异
- en: Using the Global Superstore dataset, for profitable orders, we want to know
    the difference between the average profit per line by category and market, compared
    to the average for the entire category. For example, what is the difference between
    the average profit for Office Supplies orders in Africa and the average profit
    for any order in Africa?
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Global Superstore数据集，对于盈利订单，我们想知道按类别和市场划分的平均每行利润与整个类别的平均利润之间的差异。例如，非洲的办公用品订单的平均利润与非洲任何订单的平均利润之间的差异是多少？
- en: We can first define `Order Profitable?` as `IF {FIXED [Order ID]:SUM([Profit])}
    > 0 THEN 'Profitable' ELSE 'Not Profitable' END`, which will calculate the overall
    profit for each Order ID and make for a quick filter.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先定义`Order Profitable?`为`IF {FIXED [Order ID]:SUM([Profit])} > 0 THEN 'Profitable'
    ELSE 'Not Profitable' END`，这将计算每个Order ID的整体利润，并快速筛选。
- en: 'We can then plot the average `Profit`, slicing by `Category` and `Market`,
    filtering for profitable orders, turning on Grand Total for rows:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以按`Category`和`Market`切割平均`Profit`，筛选盈利订单，开启行的大总计：
- en: '![](img/cdc7f423-6cfb-48fb-a89a-24d072aeb8dd.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/cdc7f423-6cfb-48fb-a89a-24d072aeb8dd.png)'
- en: In this case, we want to compare the $25 average profit in Office Supplies to
    the $50 average profit for orders in Africa.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们希望比较办公用品的$25平均利润与非洲订单的$50平均利润。
- en: 'Thus, we can define `{Exclude [Category]: AVG([Profit])}` as the average profit
    omitting the `Category` dimension (which is equal in this view to the **Grand
    Total** for a given market), and a further calculation for `AVG([Profit]) - ATTR({EXCLUDE
    [Category]: AVG([Profit])})` will show us the required difference:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '因此，我们可以定义 `{Exclude [Category]: AVG([Profit])}` 为排除 `Category` 维度的平均利润（在这个视图中等于给定市场的
    **总计**），以及进一步的计算 `AVG([Profit]) - ATTR({EXCLUDE [Category]: AVG([Profit])})` 将显示所需差异：'
- en: '![](img/80fdf08e-eea3-4829-9f64-b2e8524a7193.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/80fdf08e-eea3-4829-9f64-b2e8524a7193.png)'
- en: 'In this case, we can see that orders for Office Supplies in Africa are $25
    less profitable than the average order line in this market. Again, we can change
    the dimensions without having to change the definition of our field, for instance
    by `Segment`, as long as we keep slicing by `Category`:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们可以看到非洲办公用品的订单比这个市场的平均订单行利润低 $25。再次强调，我们可以更改维度，而无需更改我们字段的定义，例如通过 `Segment`，只要我们继续按
    `Category` 进行切片：
- en: '![](img/97b876a7-ee7e-4a47-ba10-6ddcb62143c5.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](img/97b876a7-ee7e-4a47-ba10-6ddcb62143c5.png)'
- en: However, if we were to remove **Category** altogether, this calculation would
    be no different to a simple `AVG([Profit])`, and would lose its value.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果我们完全删除 **Category**，这个计算将与简单的 `AVG([Profit])` 没有区别，并且会失去其价值。
- en: Data source constraints for LOD
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: LOD 的数据源限制
- en: 'While LOD calculations are in general supported in Tableau, there are a few
    constraints on certain data source types. At the time of writing, here are the
    most notable exceptions to the rule:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在 Tableau 中通常支持 LOD 计算，但某些数据源类型有一些限制。在撰写本文时，以下是一些最显著的例外：
- en: '| **Data source** | **Support** |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| **数据源** | **支持** |'
- en: '| Google Big Query | Supported for standard SQL, not supported for legacy SQL
    |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| Google Big Query | 支持标准 SQL，不支持旧版 SQL |'
- en: '| Microsoft Access | Not supported |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| Microsoft Access | 不支持 |'
- en: '| Microsoft Jet-based connections (legacy connectors for Microsoft Excel, Microsoft
    Access, and text) | Not supported |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| 基于 Microsoft Jet 的连接（Microsoft Excel、Microsoft Access 和文本的旧版连接器） | 不支持 |'
- en: '| Microsoft SQL Server | SQL Server 2005 and later |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| Microsoft SQL Server | SQL Server 2005 及以上 |'
- en: '| Mongo DB | Not supported |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| Mongo DB | 不支持 |'
- en: '| Oracle | Supported version 9i and later |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| Oracle | 支持版本 9i 及以上 |'
- en: '| PostgreSQL | Supported version 7 and later |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| PostgreSQL | 支持版本 7 及以上 |'
- en: A complete and up-to-date version of this list can be found at [https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm](https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 完整且最新的版本列表可以在 [https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm](https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm)
    找到。
- en: Summary
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we covered the three types of LOD expressions available in
    Tableau (`FIXED`, `INCLUDE`, and `EXCLUDE`) and studied how we can use them to
    aggregate data at a level that is either more granular (in the case of `INCLUDE`)
    or less granular than the dimensions already in the view. We also looked at the
    order of operations to explain the differences between these calculations and
    the ones seen previously (such as table calculations). For instance, we now hold
    the tools to calculate contributions to a total, create cohorts based on first
    order date, and aggregate customer-level information starting from item-level
    data.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了 Tableau 中可用的三种 LOD 表达式类型（`FIXED`、`INCLUDE` 和 `EXCLUDE`），并研究了如何使用它们在比视图中的维度更细粒度（在
    `INCLUDE` 的情况下）或更粗粒度（在 `EXCLUDE` 的情况下）的级别上聚合数据。我们还探讨了运算顺序，以解释这些计算与之前看到的计算（如表计算）之间的差异。例如，我们现在拥有计算对总贡献的工具、基于首次订单日期创建队列的工具，以及从项目级数据开始聚合客户级信息的工具。
- en: 'Here is a quick reminder:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一个快速提醒：
- en: '|  | **FIXED** | **INCLUDE** | **EXCLUDE** |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '|  | **FIXED** | **INCLUDE** | **EXCLUDE** |'
- en: '| Order of operations | Before dimension filters | After dimension filters
    | After dimension filters |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| 运算顺序 | 在维度过滤器之前 | 在维度过滤器之后 | 在维度过滤器之后 |'
- en: '| Purpose | Calculate across the dataset along selected dimensions | Calculate
    results using a dimension that is not part of the view | Calculate results excluding
    one of the dimensions that is part of the view |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| 目的 | 沿选定的维度在整个数据集上计算 | 使用不属于视图的维度计算结果 | 排除视图中的一个维度计算结果 |'
- en: This chapter closes a three-chapter journey into the different calculations
    that we can use in Tableau, and we are now ready to use some of the analytical
    tools to add some insights to our worksheets.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 本章结束了我们对Tableau中可以使用的不同计算的三个章节的探索之旅，我们现在准备使用一些分析工具来为我们的工作表添加一些见解。
- en: Questions
  id: totrans-165
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Answer the following questions to test your knowledge of the information in
    this chapter.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 回答以下问题以测试你对本章信息的了解。
- en: 'Q: If I''m not using any dimension filters, is there a difference between using
    a Percent of Total table calculation and using `FIXED`/`EXCLUDE` calculations?'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 'Q: 如果我没有使用任何维度过滤器，使用“总百分比”表格计算和使用`FIXED`/`EXCLUDE`计算之间有区别吗？'
- en: 'A: While they will, in general, yield the same results, there a few exceptions
    that we have discussed in this chapter, and the main reason for the differences
    is the order of operations. `FIXED` calculations will remain unchanged by dimension
    and measure filters, `EXCLUDE` calculations will remain unchanged by measure filters
    (but not by dimension filters), and table calculations will be affected by both
    dimension and measure filters.'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 'A: 虽然它们在一般情况下会产生相同的结果，但本章中我们讨论了一些例外情况，差异的主要原因是操作顺序。`FIXED`计算将不受维度和度量过滤器的影响而保持不变，`EXCLUDE`计算将不受度量过滤器的影响（但不受维度过滤器的影响），而表格计算将受维度和度量过滤器的影响。'
- en: 'Q: Do LOD calculations have to use fields that are already included in the
    view? Can LOD calculations aggregate at a different level than the one determined
    by the fields chosen in the view?'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 'Q: LOD计算必须使用视图中已经包含的字段吗？LOD计算能否在视图中选择字段确定的级别之外进行聚合？'
- en: 'A: As seen in the example of `INCLUDE` calculations, LOD calculations can be
    used to aggregate on fields that are not present in the view.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 'A: 如`INCLUDE`计算的示例所示，LOD计算可以用于对视图中不存在的字段进行聚合。'
- en: 'Q: Do LOD calculations always yield measures?'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 'Q: LOD计算总是产生度量值吗？'
- en: 'A: Not necessarily. In the example of cohorts in the second part of this chapter,
    we can use a `FIXED` LOD calculation to create a first purchase date, which will
    be treated as a dimension.'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 'A: 不一定。在本章第二部分的群体示例中，我们可以使用`FIXED` LOD计算来创建一个首次购买日期，这将被视为一个维度。'
- en: Further reading
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'You can check out the following links for more information about the topics
    that were covered in this chapter:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以查看以下链接以获取有关本章涵盖主题的更多信息：
- en: '*Top 15 Tableau LOD Expressions*: [https://www.tableau.com/about/blog/LOD-expressions](https://www.tableau.com/about/blog/LOD-expressions)'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Top 15 Tableau LOD Expressions*: [https://www.tableau.com/about/blog/LOD-expressions](https://www.tableau.com/about/blog/LOD-expressions)'
- en: '*Data Source Constraints for Level of Detail Expressions*: [https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm](https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm)'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*数据源约束对于细节级别表达式*: [https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm](https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm)'
- en: '*Which calculation is right for your analysis: simple, table, or LOD?* [https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_understand_which.htm](https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_understand_which.htm)'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*哪种计算适合你的分析：简单、表格还是LOD？* [https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_understand_which.htm](https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_understand_which.htm)'
