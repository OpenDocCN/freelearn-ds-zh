- en: Practicing Level of Detail Calculations
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 练习细节级别计算
- en: 'When we talk about **Level of Detail** (**LOD**) calculations in Tableau, we
    mean three expressions: `FIXED`, `INCLUDE`, and `EXCLUDE`. These three expressions
    open up a world of options by providing the ability to create calculations that
    target specific levels of granularity. In older versions of Tableau, data granularity
    for a worksheet was established by the dimensions in a view. If the view contained
    dimensions for, for example, **Region**, **State**, and **Postal Code**, but the
    author wanted to create a **City**-level calculation, the **City** dimension would
    need to be included on the view. Furthermore, there was no mechanism for excluding
    or ignoring a given **dimension** on a view. Admittedly, the desired results could
    normally be obtained through some complex and sometimes convoluted use of table
    calculations, data blends, and so on. Fortunately, LODs greatly simplify these
    use case scenarios and, in some cases, enable what was previously impossible.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们在 Tableau 中谈论**细节级别**（**LOD**）计算时，我们指的是三种表达式：`FIXED`、`INCLUDE` 和 `EXCLUDE`。这三种表达式通过提供创建针对特定粒度级别的计算的能力，打开了无限可能性。在旧版本的
    Tableau 中，工作表的数据粒度是通过视图中的维度来确定的。如果视图中包含了例如**地区**、**州**和**邮政编码**等维度，但作者想要创建一个**城市**级别的计算，那么**城市**维度就必须包含在视图中。此外，视图中没有排除或忽略给定**维度**的机制。诚然，通常可以通过一些复杂且有时晦涩的表计算、数据混合等方法获得所需结果。幸运的是，LOD
    极大地简化了这些使用场景，并且在某些情况下，能够实现之前不可能实现的功能。
- en: 'In this chapter, we will discuss the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下主题：
- en: Introducing LODs
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍 LOD
- en: '`FIXED` and `EXCLUDE`'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FIXED` 和 `EXCLUDE`'
- en: '`INCLUDE`'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`INCLUDE`'
- en: Building practical applications with LODs
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 LOD 构建实用应用
- en: The early sections of this chapter are more theory-based, but don’t worry –
    you’ll get to explore these concepts in a practical way in the *Building practical
    applications with LODs* section. Let’s begin by introducing LODs and how they
    are used.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的前几部分更偏向理论，但别担心 —— 你将在*使用 LOD 构建实用应用*部分以实践的方式探索这些概念。让我们从介绍 LOD 和它的使用方法开始。
- en: Introducing LODs
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍 LOD
- en: Tableau’s default is to show measures in a view based on the dimensions also
    present in the view. If you have a dashboard with `Sales` data and dimensions
    like `State` and `City`, and you drag the `State` and `Sales` data onto the view,
    the `Sales` data will be divided by `State`, showing you `Sales` per `State`.
    If you want to divide the `Sales` data further into smaller chunks, you might
    add the `City` field, resulting in `Sales` data per `City`, per `State`. LODs
    can manipulate this default behavior.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 的默认设置是根据视图中存在的维度显示度量。如果你有一个包含 `销售` 数据的仪表板，并且有像 `州` 和 `城市` 这样的维度，假设你将
    `州` 和 `销售` 数据拖入视图中，那么 `销售` 数据会按 `州` 分割，显示每个 `州` 的 `销售` 数据。如果你希望进一步将 `销售` 数据划分成更小的部分，可以添加
    `城市` 字段，结果将是每个 `州` 下的每个 `城市` 的 `销售` 数据。LOD 可以操作这个默认行为。
- en: After completing this chapter, you will be able to divide or partition measures
    by dimensions that are not in the view and show measures using fewer dimensions
    than are visible in the view.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本章后，你将能够按视图中不存在的维度划分或分区度量，并使用视图中少于显示维度的方式展示度量。
- en: To do this, we will build and use two **playgrounds**. Delivering reports as
    required by one’s job duties may lead to a thorough knowledge of a limited set
    of capabilities; that is, a deep but narrow understanding. It can be difficult
    to set aside time (and justify that time) to explore the capabilities of Tableau
    that, on the surface, may seem to have no direct correlation to job duties. Playground
    environments can help overcome any difficulties and objections by providing efficient
    avenues of exploration. In this chapter, we’ll build two playground environments
    specifically for LODs, to help make the task of deep and broad understanding easier
    by providing an efficient avenue for exploration and understanding. You can always
    come back to the workbook accompanying this chapter and test functionality related
    to LODs.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现这一点，我们将构建并使用两个**操作环境**。按照工作要求交付报告可能会导致对一组有限功能的深入了解；也就是说，深入但狭窄的理解。花时间（并证明这些时间的必要性）去探索
    Tableau 的某些功能，可能会因为这些功能表面上看似与工作职责没有直接关系而变得困难。操作环境可以通过提供高效的探索途径，帮助克服任何困难和反对。在本章中，我们将专门为
    LOD 构建两个操作环境，以帮助通过提供高效的探索和理解途径，使得深入和广泛理解变得更容易。你可以随时回到本章附带的工作簿，测试与 LOD 相关的功能。
- en: FIXED and EXCLUDE
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: FIXED 和 EXCLUDE
- en: 'The first playground we will build will be for the purpose of exploring two
    of the three LOD functions: `FIXED` and `EXCLUDE`. We will use a set of parameters
    and associated calculated fields to efficiently explore how these functions work.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将构建的第一个工作区将用于探索三种LOD函数中的两个：`FIXED`和`EXCLUDE`。我们将使用一组参数和相关的计算字段来高效地探索这些函数的工作原理。
- en: Setting up the workbook
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置工作簿
- en: Much of the groundwork for this exercise has already been completed in the workbook
    associated with this chapter. The following steps will simply require you to open
    different calculations and parameters to see how they have been set up and why
    this works. Explanations are given along the way. If you do not have ready access
    to the workbook, you should be able to construct a similar one by referencing
    the following steps.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 本练习的大部分基础工作已经在与本章节相关的工作簿中完成。以下步骤仅要求您打开不同的计算和参数，查看它们是如何设置的，以及为什么这样做有效。在此过程中会给出解释。如果您没有直接访问该工作簿的权限，您应该能够通过参考以下步骤构建一个类似的工作簿。
- en: 'To complete the initial setup of a worksheet, take the following steps:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 完成工作表的初始设置，请按照以下步骤操作：
- en: Navigate to [https://public.tableau.com/profile/marleen.meier](https://public.tableau.com/profile/marleen.meier)
    to locate and download the workbook associated with this chapter.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问[https://public.tableau.com/profile/marleen.meier](https://public.tableau.com/profile/marleen.meier)来定位并下载与本章节相关的工作簿。
- en: 'Open the workbook associated with this chapter and navigate to the `Fixed and
    Exclude` worksheet. The worksheet should look as follows:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开与本章节相关的工作簿，并导航到`Fixed and Exclude`工作表。该工作表应如下所示：
- en: '![](img/B18435_07_01.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_01.png)'
- en: 'Figure 7.1: The worksheet'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1：工作表
- en: Select the `Superstore` data source and inspect the parameter named **1st Dim**
    by right-clicking and selecting **Edit**:![](img/B18435_07_02.png)
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`Superstore`数据源，并通过右键点击选择**编辑**来检查名为**1st Dim**的参数：![](img/B18435_07_02.png)
- en: 'Figure 7.2: Parameter I'
  id: totrans-22
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图7.2：参数 I
- en: The parameters named **2nd Dim**, **3rd Dim**, and **4th Dim** are identical
    to **1st Dim**.
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 名为**2nd Dim**、**3rd Dim**和**4th Dim**的参数与**1st Dim**相同。
- en: Note that except for **Order Date** and **Ship Date**, every dimension in the
    dataset is included in the list of values (see *Figure 7.2*). For the purposes
    of this exercise, **Category**, **Region**, **Segment**, **Ship Mode**, and **Sub-Category**
    are particularly important because these are dimensions with fewer members. Dimensions
    with many members are more difficult to use in this context.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意，除了**Order Date**和**Ship Date**，数据集中的每个维度都包含在值列表中（见*图7.2*）。为了本练习的目的，**Category**、**Region**、**Segment**、**Ship
    Mode**和**Sub-Category**尤其重要，因为这些维度的成员较少。具有大量成员的维度在此上下文中较难使用。
- en: 'Inspect the **Choose Fixed Dims**, **Choose Excluded Dims 1**, and **Choose
    Excluded Dims 2** parameters included in the workbook and note that we defined
    several integers under the **Value** column, each of which will later be visible
    as a string specified under the **Displays As** column in the parameter dropdown.
    The **Value** and **Display As** configurations for **Choose Fixed Dims** are
    as follows:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查工作簿中包含的**选择固定维度**、**选择排除维度 1**和**选择排除维度 2**参数，并注意我们在**值**列下定义了多个整数，每个整数将在参数下拉框中作为**显示为**列中指定的字符串显示。**选择固定维度**的**值**和**显示为**配置如下：
- en: '![](img/B18435_07_03.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_03.png)'
- en: 'Figure 7.3: Parameter II'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.3：参数 II
- en: 'Inspect the calculated field named **1st Dim** (it is located under the **Practical:
    All** folder in the **Data** pane); this calculation makes use of the `1st Dim`
    parameter and will cause a field to be displayed depending on the selection of
    the parameter. If the user selects **Category** in the **1st Dim** parameter**,**
    value `1` will be activated (according to the values specified in*Figure 7.2*).
    Value `1` then translates to the **Category** field in the calculated **1st Dim**
    field, as shown in the following screenshot:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '检查名为**1st Dim**的计算字段（它位于**数据**窗格中的**Practical: All**文件夹下）；此计算使用了`1st Dim`参数，并根据选择的参数显示相应的字段。如果用户在**1st
    Dim**参数中选择了**Category**，则值`1`将被激活（根据*图7.2*中指定的值）。然后，值`1`将对应到计算字段**1st Dim**中的**Category**字段，如下截图所示：'
- en: '![](img/B18435_07_04.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_04.png)'
- en: 'Figure 7.4: Calculated 1st Dim field'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.4：计算的1st Dim字段
- en: The calculated fields named **2nd Dim**, **3rd Dim**, and **4th Dim** are identical
    to **1st Dim** except that each references the parameter bearing its name; for
    example, the **2nd Dim** calculated field utilizes `[Parameters].[2nd Dim]`.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算字段**2nd Dim**、**3rd Dim**和**4th Dim**与**1st Dim**相同，区别在于每个字段引用了对应名称的参数；例如，**2nd
    Dim**计算字段使用了`[Parameters].[2nd Dim]`。
- en: These `Case` statements, in conjunction with the associated parameters, will
    allow you to choose which dimensions to view from a dropdown in the view as described
    in *step 5*.
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这些`Case`语句与相关参数结合使用，将允许你从视图中的下拉菜单中选择要查看的维度，如*第 5 步*所述。
- en: Inspect the following calculated fields, which enable you to choose which LODs
    to employ and thus to compare and contrast differences and similarities:![](img/B18435_07_05.png)
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查以下计算字段，它们使你能够选择使用哪些LOD，从而比较和对比差异和相似性：![](img/B18435_07_05.png)
- en: 'Figure 7.5: Case Fixed'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.5：Case Fixed
- en: 'The **Case Fixed** calculation shows that if the user selects `1` in the **Choose
    Fixed Dims** parameter (which is being displayed as **1st**), **1st Dim** will
    be fixed—no matter what the dashboard setup. That means that **SUM(Sales)** will
    be partitioned over **1st Dim**, no matter if it is part of the dashboard:'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Case Fixed**计算表明，如果用户在**Choose Fixed Dims**参数中选择`1`（显示为**1st**），**1st Dim**将被固定——无论仪表板的设置如何。这意味着**SUM(Sales)**将按照**1st
    Dim**进行分区，无论它是否是仪表板的一部分：'
- en: '![](img/B18435_07_06.png)'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B18435_07_06.png)'
- en: 'Figure 7.6: Case Exclude 1'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.6：Case Exclude 1
- en: The **Case** **Exclude 1** calculation shows that if the user selects `1` in
    the **Choose Excluded Dims 1** parameter (which will be displayed as **1st**),
    **1st Dim** will be excluded from the calculation in the view.
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Case Exclude 1**计算表明，如果用户在**Choose Excluded Dims 1**参数中选择`1`（显示为**1st**），**1st
    Dim**将从视图中的计算中排除。'
- en: 'That means that **SUM(Sales)** won’t be partitioned over **1st Dim**, even
    if it is part of the view:'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这意味着**SUM(Sales)**不会按照**1st Dim**进行分区，即使它是视图的一部分：
- en: '![](img/B18435_07_07.png)'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B18435_07_07.png)'
- en: 'Figure 7.7: Case Exclude 2'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.7：Case Exclude 2
- en: The **Case** **Exclude 2** calculation shows that if the user selects `1` in
    the **Choose Excluded Dims 2** parameter (which will be displayed as **1st**),
    **1st Dim** will be excluded from the calculation in the view. That means that
    **SUM(Sales)** won’t be partitioned over **1st Dim**, even if it is part of the
    view.
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**Case Exclude 2**计算表明，如果用户在**Choose Excluded Dims 2**参数中选择`1`（显示为**1st**），**1st
    Dim**将从视图中的计算中排除。这意味着**SUM(Sales)**不会按照**1st Dim**进行分区，即使它是视图的一部分。'
- en: 'Now, right-click and open the context filter on **Product Name** for inspection.
    In the resulting dialog box, click the **Wildcard** tab and note the settings,
    as shown in the following screenshot. The filter has been set to show only product
    names that start with `S` (**Match value** is not case-sensitive.):'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，右键单击**Product Name**，并打开上下文过滤器进行检查。在弹出的对话框中，点击**Wildcard**标签，并注意设置，如下图所示。该过滤器已设置为仅显示以`S`开头的产品名称（**Match
    value**不区分大小写）：
- en: '![](img/B18435_07_08.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_08.png)'
- en: 'Figure 7.8: Wildcard filter'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.8：通配符过滤器
- en: 'After clicking **OK**, right-click on the filter and click **Add to Context**.
    Note that context filters are denoted in gray:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**OK**后，右键点击过滤器并选择**Add to Context**。注意，上下文过滤器会以灰色标示：
- en: '![](img/B18435_07_09.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_09.png)'
- en: 'Figure 7.9: Gray context filter'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.9：灰色上下文过滤器
- en: 'Place the following dimensions on the **Rows** shelf: **1st Dim**, **2nd Dim**,
    **3rd Dim**, and **4th Dim**.'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下维度放置到**Rows**架上：**1st Dim**、**2nd Dim**、**3rd Dim**和**4th Dim**。
- en: Drag **Measure Names** onto the **Filters** shelf and select **Sales**, **Case
    Fixed**, **Case Exclude 1**, and **Case Exclude 2**.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Measure Names**拖动到**Filters**架上，选择**Sales**、**Case Fixed**、**Case Exclude
    1**和**Case Exclude 2**。
- en: 'Add **Measure Values** to **Text** and **Measure Names** to **Columns**:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Measure Values**添加到**Text**，并将**Measure Names**添加到**Columns**：
- en: '![](img/B18435_07_10.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_10.png)'
- en: 'Figure 7.10: Measure Values'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.10：度量值
- en: 'Display every parameter by right-clicking each one and selecting **Show Parameter
    Control**. Order the parameter controls as follows:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过右键单击每个参数并选择**Show Parameter Control**来显示每个参数。按如下顺序排列参数控制：
- en: '![](img/B18435_07_11.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_11.png)'
- en: 'Figure 7.11: Final playground'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.11：最终的操作区
- en: By following the previous steps, we are now ready to build various tables to
    compare the different LODs because the parameters will allow us to select different
    dimensions and the calculated fields that incorporate the `FIXED` and `EXCLUDE`
    functions from Tableau. We will now continue using the playground and explain
    how LODs change calculated fields.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 通过遵循之前的步骤，我们现在可以构建各种表格来比较不同的 LOD，因为这些参数将允许我们选择不同的维度和包含 Tableau 中 `FIXED` 和 `EXCLUDE`
    函数的计算字段。接下来，我们将继续使用沙盒环境并解释 LOD 如何改变计算字段。
- en: Understanding FIXED
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解 FIXED
- en: Now that the playground environment is complete, let’s build scenarios to better
    understand the `FIXED` and `EXCLUDE` functions. We’ll begin with `FIXED`. The
    `FIXED` LOD considers only the dimensions to which it is directed. Thus, when
    fixed on a dimension, all other (if any) dimensions in the view are ignored. When
    the `FIXED` LOD is used without defining any dimension, the result will be a calculation
    ignoring all (if any) dimensions in the view.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 现在沙盒环境已完成，让我们构建场景来更好地理解 `FIXED` 和 `EXCLUDE` 函数。我们将从 `FIXED` 开始。`FIXED` LOD 只考虑它所指向的维度。因此，当固定在某个维度时，视图中的所有其他维度（如果有）将被忽略。当
    `FIXED` LOD 未定义任何维度时，结果将是一个忽略视图中所有维度（如果有）的计算。
- en: 'Let’s jump into the exercise and see this for ourselves:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们跳入练习，亲自查看一下：
- en: Using the worksheet described previously, set the parameters as shown here:![](img/B18435_07_12.png)
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用之前描述的工作表，设置如下所示的参数：![](img/B18435_07_12.png)
- en: 'Figure 7.12: First example'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.12：第一个例子
- en: What we achieve with the different parameters is that we show the **SUM(Sales)**
    per **Region** and each **Region** per **Category**, but we also fixed the **SUM(Sales)**
    calculation for the **Category** dimension in the **Case Fixed** column.
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过不同的参数，我们实现了展示每个 **Region** 和每个 **Category** 的 **SUM(Sales)**，同时我们还在 **Case
    Fixed** 列中固定了 **Category** 维度的 **SUM(Sales)** 计算。
- en: The **Case Fixed** column now displays the totals for each **Category** and
    ignores **Region** because we told the calculation to fix the **2nd Dim** (**Region**)
    and ignore the dimensions in the view itself.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Case Fixed** 列现在显示每个 **Category** 的总和，并忽略 **Region**，因为我们告诉计算要固定 **2nd Dim**（**Region**），并忽略视图中的维度。'
- en: 'The effect of this is visible by comparing the **Sales** column and the **Case
    Fixed** column:'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过比较 **Sales** 列和 **Case Fixed** 列，我们可以看到这一效果：
- en: '![](img/B18435_07_13.png)'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B18435_07_13.png)'
- en: 'Figure 7.13: Case Fixed I'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.13：Case Fixed I
- en: 'Check for yourself and do the math for **Furniture**:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请自己检查，并计算 **Furniture** 的值：
- en: 10,072 + 14,249 + 4,494 + 18,564 = 47,379.
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 10,072 + 14,249 + 4,494 + 18,564 = 47,379。
- en: Even though the **Region** is visible in the view, the **SUM(Sales)** in the
    **Case Fixed** column ignores the **Region** and shows the results as if the **Category**
    dimension is the only dimension in the view. We manipulated the granularity of
    the data. In the **Case Fixed** column, **Region** is there for informative purposes
    only but does not affect the calculation of **SUM(Sales)**.
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 尽管 **Region** 在视图中可见，但 **Case Fixed** 列中的 **SUM(Sales)** 会忽略 **Region**，并显示结果，仿佛
    **Category** 维度是视图中的唯一维度。我们改变了数据的粒度。在 **Case Fixed** 列中，**Region** 只是用于提供信息，不会影响
    **SUM(Sales)** 的计算。
- en: 'Now change the **Choose Fixed Dims** parameter to **1st** and note that **Case
    Fixed** now displays the totals for each **Region**:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，将 **Choose Fixed Dims** 参数更改为 **1st**，并注意 **Case Fixed** 现在显示每个 **Region**
    的总和：
- en: '![](img/B18435_07_14.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_14.png)'
- en: 'Figure 7.14: Case Fixed II'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.14：Case Fixed II
- en: 'This time, we fix the calculation in the **Case Fixed** column to only take
    the **Region** into account but ignore the **Category**. Check for yourself and
    do the math for **Central**: 10,072 + 16,340 + 13,995 = 40,406.'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这一次，我们将 **Case Fixed** 列中的计算固定为仅考虑 **Region**，而忽略 **Category**。请自己检查，并计算 **Central**
    的值：10,072 + 16,340 + 13,995 = 40,406。
- en: 'Change the **Choose Fixed Dims** parameter to **Fixed: Nothing** and note that
    the amount reflects the total **SUM(Sales)**:'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '将 **Choose Fixed Dims** 参数更改为 **Fixed: Nothing**，并注意该金额反映了 **SUM(Sales)** 的总和：'
- en: '![](img/B18435_07_15.png)'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B18435_07_15.png)'
- en: 'Figure 7.15: Fixed: Nothing'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.15：已固定：无
- en: This time, we fixed the calculation to nothing, meaning that we ignore every
    dimension in the view. Check for yourself and do the math by summing the **Sales**
    values; the sum will be 194,776.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 这一次，我们将计算固定为空，意味着我们忽略视图中的所有维度。请自己检查，并通过求和 **Sales** 值来做数学计算；总和为 194,776。
- en: 'As is evident, the `FIXED` LOD considers only the dimensions to which it is
    directed. Thus, when fixed on **Category**, **Region** is ignored. And, as demonstrated,
    when fixed on **Region**, **Category** is ignored. Lastly, when **Choose Fixed
    Dims** is set to **Fixed: Nothing**, the entire dataset that is not restricted
    by the context filter on **Product Name** is displayed.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 正如显而易见的，`FIXED` LOD 只考虑它所指向的维度。因此，当固定在 **类别** 上时，**地区** 会被忽略。正如演示所示，当固定在 **地区**
    上时，**类别** 会被忽略。最后，当 **选择固定维度** 设置为 **固定：无** 时，未受 **产品名称** 上的上下文过滤器限制的整个数据集将被显示。
- en: Next, let’s look at a couple of new features introduced with Tableau 2021.1
    that pertain to `FIXED` LODs.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们看一下 Tableau 2021.1 中引入的与 `FIXED` LOD 相关的一些新功能。
- en: Table-scoped expressions
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 表格范围的表达式
- en: 'A quick way to write a `FIXED` LOD expression when using a whole table as the
    scope is using code like the following:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用整个表格作为范围时，编写 `FIXED` LOD 表达式的快捷方式是使用如下代码：
- en: '[PRE0]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If you use this calculation on the `Superstore` dataset, you will achieve the
    exact same as writing:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在 `Superstore` 数据集上使用此计算，结果将与编写以下内容完全相同：
- en: '[PRE1]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: No matter what you show in the view, this field will always retrieve the latest
    data from the whole table. Cool, right?
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你在视图中显示什么，该字段将始终从整个表格中检索最新数据。酷吧？
- en: Quick LODs
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 快速 LOD
- en: Tableau 2021.1 allows us to create `FIXED` LODs faster. Simply drag the desired
    measure on top of a dimension and press *Ctrl* (or *Cmd* on macOS).
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 2021.1 允许我们更快地创建 `FIXED` LOD。只需将所需的度量值拖动到维度上方，然后按下 *Ctrl*（在 macOS 上是
    *Cmd*）。
- en: Now you will see the dimension highlighted in blue (see **Region** in *Figure
    7.16*). Then drop the measure there and a new measure field (in this case, **Sales
    (Region)**) will be created.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你会看到维度以蓝色高亮显示（参见 **地区** 在 *图 7.16* 中）。然后将度量值拖放到那里，一个新的度量字段（在此情况下为 **销售（地区）**）将被创建。
- en: '![](img/B18435_07_16.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_16.png)'
- en: 'Figure 7.16: Quick LOD'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.16：快速 LOD
- en: 'Right-click on **Sales (Region)** and note that a `FIXED` LOD has been created:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 右键点击 **销售（地区）**，注意到已经创建了一个 `FIXED` LOD：
- en: '![](img/B18435_07_17.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_17.png)'
- en: 'Figure 7.17: Quick LOD II'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.17：快速 LOD II
- en: If you’re working with Tableau 2021.1 or higher, you can use this shortcut for
    `FIXED` LODs.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是 Tableau 2021.1 或更高版本，可以使用此快捷键来进行 `FIXED` LOD 计算。
- en: The playground we built was not only meant for `FIXED` but also for `EXCLUDE`.
    Let us have a look at `EXCLUDE` next.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 我们构建的游乐场不仅仅用于 `FIXED`，还用于 `EXCLUDE`。接下来让我们看一下 `EXCLUDE`。
- en: Understanding EXCLUDE
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解 EXCLUDE
- en: 'Let’s start understanding the `EXCLUDE` LOD. The `EXCLUDE` LOD will exclude
    any dimension to which it is directed. If your view contains **Region** and **Category**
    and you write an `EXCLUDE` LOD on **Category**, only **Region** will be considered
    in the calculations. The following example will make this clearer—our goal in
    this exercise is to calculate `SUM(Sales)` by using fewer dimensions than in the
    view. We want to exclude visible dimensions only from the calculation but still
    show the dimension values in the dashboard:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始理解 `EXCLUDE` LOD。`EXCLUDE` LOD 会排除任何指向的维度。如果你的视图包含 **地区** 和 **类别**，并且你在
    **类别** 上编写一个 `EXCLUDE` LOD，那么计算中只会考虑 **地区**。以下示例将更清楚地说明这一点——我们在本练习中的目标是通过使用比视图中更少的维度来计算
    `SUM(销售)`。我们只想从计算中排除可见的维度，但仍然在仪表板中显示维度值：
- en: 'Set the parameters as shown in the following screenshot:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置如下截图所示的参数：
- en: '![](img/B18435_07_18.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_18.png)'
- en: 'Figure 7.18: Fixed: Nothing'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.18：固定：无
- en: You can observe the following results:![](img/B18435_07_19.png)
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以观察到以下结果：![](img/B18435_07_19.png)
- en: 'Figure 7.19: Exclude I'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.19：排除 I
- en: '**Case Exclude 1** displays the total of each **Category** and **Segment**
    and ignores **Region**. For example, the total of the segment **Consumer** within
    the category **Furniture** is $26,738\. That total is repeated for each **Region**.
    The relevant code that is generating these results is'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**案例排除 1** 显示每个 **类别** 和 **细分** 的总计，并忽略 **地区**。例如，**家具** 类别下的 **消费者** 细分的总额为
    $26,738\. 该总额会为每个 **地区** 重复。生成这些结果的相关代码是：'
- en: '[PRE2]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Make the following changes to the parameters:![](img/B18435_07_20.png)
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对参数进行以下更改：![](img/B18435_07_20.png)
- en: 'Figure 7.20: Exclude II'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.20：排除 II
- en: 'Any LOD calculation can be used with multiple dimensions in a view. In this
    case, **Case Exclude 2** ignores two dimensions: **1st Dim** and **2nd Dim**,
    which are associated with **Region** and **Category**. The associated code for
    **Case Exclude 2** is therefore:'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 任何 LOD 计算都可以与视图中的多个维度一起使用。在这种情况下，**案例排除 2** 忽略了两个维度：**第 1 维度** 和 **第 2 维度**，它们与
    **地区** 和 **类别** 相关。因此，**案例排除 2** 的相关代码是：
- en: '[PRE3]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The associated code for **Case Fixed** is:'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**案例固定** 的相关代码是：'
- en: '[PRE4]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '**Case Exclude 2** and **Case Fixed** now have identical results. This is because
    excluding the first two dimensions is the same as fixing on the third dimension.
    Only the third dimension **Segment** is considered in both cases.'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**案例排除2** 和 **案例固定** 现在的结果是相同的。这是因为排除前两维度与固定在第三维度是相同的，两个案例中只考虑了第三维度 **细分**。'
- en: 'You can observe the results in the following screenshot:'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以在以下截图中观察结果：
- en: '![](img/B18435_07_21.png)'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B18435_07_21.png)'
- en: 'Figure 7.21: Exclude II table'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.21：排除 II 表
- en: 'Make the following changes to the parameters:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对参数做出以下更改：
- en: '![](img/B18435_07_22.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_22.png)'
- en: 'Figure 7.22: Change 4th dimension'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.22：更改第4维度
- en: 'You can observe the results as follows:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以如下观察结果：
- en: '![](img/B18435_07_23.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_23.png)'
- en: 'Figure 7.23: Exclude III'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.23：排除 III
- en: Note that **Case Exclude 2** and **Case Fixed** no longer have identical results.
    This is because **Ship Mode** was introduced and **Case Exclude 2** considers
    **Ship Mode** whereas **Case Fixed** does not.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意，**案例排除2** 和 **案例固定** 不再有相同的结果。这是因为引入了 **运输方式**，而 **案例排除2** 考虑了 **运输方式**，而
    **案例固定** 没有。
- en: Experiment with other settings to further enhance your understanding of the
    `FIXED` and `EXCLUDE` LODs.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 试验其他设置，进一步增强你对 `FIXED` 和 `EXCLUDE` LOD 的理解。
- en: '`EXCLUDE` will cause any dimension addressed in the LOD calculation to be removed
    from the calculation. Multiple dimensions can be part of an `EXCLUDE` LOD and
    common use cases include the direct comparison of values at a lower level of aggregation
    (fields that are in the view) to a higher aggregate (as if dimensions would be
    removed from the view). Let us assume you want to visualize the sales of categories
    in different regions as well as the total sales in each region. You might also
    want to calculate the difference from a single category in a region to the region
    overall. Isn’t it so cool that LODs can solve this seemingly impossible scenario?
    I hope that the preceding exercise gave you a better feel for the `EXCLUDE`LOD.'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`EXCLUDE` 会导致在 LOD 计算中涉及的任何维度从计算中移除。多个维度可以是 `EXCLUDE` LOD 的一部分，常见的使用案例包括将较低层次聚合（视图中的字段）与较高聚合进行直接比较（就像维度从视图中移除一样）。假设你想要可视化不同区域的类别销售情况以及每个区域的总销售额。你可能还想计算某个区域中单个类别与该区域整体之间的差异。难道这不是很酷吗，LOD
    可以解决这个看似不可能的场景？希望之前的练习让你更好地理解了 `EXCLUDE` LOD。'
- en: As a quick interlude after those exercises on `FIXED` and `EXCLUDE`, let us
    take a closer look at Tableau’s order of operations. As you now know, getting
    the same result for `FIXED` and `EXCLUDE` is not always the case – the order of
    operations will help us understand why.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 作为对 `FIXED` 和 `EXCLUDE` 练习后的快速过渡，让我们更仔细地了解一下 Tableau 的操作顺序。正如你现在所知，`FIXED` 和
    `EXCLUDE` 获得相同结果并不总是如此——操作顺序将帮助我们理解为什么。
- en: Understanding Tableau’s order of operations
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解 Tableau 的操作顺序
- en: The previous exercise led us to believe that the same results for `FIXED` and
    `EXCLUDE` can be achieved by fixing the dimensions that are not excluded and vice
    versa. However, the order in which Tableau executes a `FIXED` and an `EXCLUDE`
    LOD differs and can hence cause unexpected results. To avoid this, I will show
    you what to consider when using either `FIXED` or `EXCLUDE` LODs.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的练习让我们相信，`FIXED` 和 `EXCLUDE` 得到相同结果的方法是通过固定未排除的维度，反之亦然。然而，Tableau 执行 `FIXED`
    和 `EXCLUDE` LOD 的顺序是不同的，这可能导致意外的结果。为了避免这种情况，我将向你展示使用 `FIXED` 或 `EXCLUDE` LOD 时需要注意的事项。
- en: 'Let us have a look at the order of filtering:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看过滤的顺序：
- en: 'Set the parameters as follows:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按如下方式设置参数：
- en: '![](img/B18435_07_24.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_24.png)'
- en: 'Figure 7.24: Set parameters'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.24：设置参数
- en: Observe the results:![](img/B18435_07_25.png)
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 观察结果：![](img/B18435_07_25.png)
- en: 'Figure 7.25: Same results'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 7.25：相同结果
- en: Note that, as seen in the previous exercise, **Case Exclude 2** and **Case Fixed**
    are identical.
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，正如在之前的练习中所见，**案例排除2** 和 **案例固定** 是相同的。
- en: 'Right-click on the **Product Name** filter and select **Remove from Context**:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击 **产品名称** 过滤器，选择 **从上下文中移除**：
- en: '![](img/B18435_07_26.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_26.png)'
- en: 'Figure 7.26: Remove from Context'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.26：从上下文中移除
- en: 'Observe the results in the following screenshot:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在以下截图中观察结果：
- en: '![](img/B18435_07_27.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_27.png)'
- en: 'Figure 7.27: Without context filter'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.27：没有上下文过滤器
- en: '**Case Exclude 2** and **Case Fixed** are no longer identical. **Case Fixed**
    is no longer impacted by the **Product Name** filter because the context was removed.'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**案例 Exclude 2** 和 **案例 Fixed** 不再相同。**案例 Fixed** 不再受**产品名称**筛选器的影响，因为上下文已被移除。'
- en: The behavior difference observed between `EXCLUDE` and `FIXED` in the preceding
    exercise reflects the underlying filter order of operations. As shown in *Figure
    7.27*, **Context Filters** will impact `FIXED`, `EXCLUDE`, and `INCLUDE` calculations
    because the **Context** **Filter** is being applied first to the dataset, then
    the LOD. **Dimension Filters**, however, will only impact `EXCLUDE` and `INCLUDE`
    LODs because the `FIXED` LOD will be applied to the dataset first and then the
    dimension filter, followed by the `EXCLUDE` and `INCLUDE` LODs.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一个练习中观察到的 `EXCLUDE` 和 `FIXED` 之间的行为差异反映了基础筛选器操作顺序。如*图 7.27*所示，**上下文筛选器**会影响
    `FIXED`、`EXCLUDE` 和 `INCLUDE` 计算，因为**上下文** **筛选器**首先应用于数据集，然后是 LOD。然而，**维度筛选器**只会影响
    `EXCLUDE` 和 `INCLUDE` LOD，因为 `FIXED` LOD 会首先应用于数据集，然后是维度筛选器，接着是 `EXCLUDE` 和 `INCLUDE`
    LOD。
- en: 'See the following diagram, a schematic representation of the order of operations
    in Tableau:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 请参见下图，这是 Tableau 操作顺序的示意图：
- en: '![](img/B18435_07_28.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_28.png)'
- en: 'Figure 7.28: Order of operations'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.28：操作顺序
- en: '*Figure 7.28* is sourced from Tableau’s help pages, here: [https://help.tableau.com/current/pro/desktop/en-us/order_of_operations.htm](https://help.tableau.com/current/pro/desktop/en-us/order_of_operations.htm).'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 7.28* 来自 Tableau 的帮助页面，链接如下：[https://help.tableau.com/current/pro/desktop/en-us/order_of_operations.htm](https://help.tableau.com/current/pro/desktop/en-us/order_of_operations.htm)。'
- en: This page also contains more information on Tableau’s order of operations.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 本页面还包含更多有关 Tableau 操作顺序的信息。
- en: 'We just saw that when using a context filter, `EXCLUDE` and `FIXED` LODs can
    result in the same numbers, whereas a dimension filter will cause the results
    to differ. This happens because Tableau executes the different requests after
    one another. As can be seen in the preceding diagram, the order of operations
    is:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚才看到，当使用上下文筛选器时，`EXCLUDE` 和 `FIXED` LOD 可能得到相同的数字，而维度筛选器会导致结果不同。这是因为 Tableau
    会依次执行不同的请求。如前面的示意图所示，操作顺序为：
- en: Context filters
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上下文筛选器
- en: '`FIXED` LOD'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`FIXED` LOD'
- en: Dimension filters
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 维度筛选器
- en: '`INCLUDE` and `EXCLUDE` LODs'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`INCLUDE` 和 `EXCLUDE` LOD'
- en: This is important for you to know to choose the correct filter or LOD for your
    purpose.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 了解这一点对于您选择正确的筛选器或 LOD 非常重要。
- en: Next, we will use a new playground, this time to show how `INCLUDE` LODs work.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将使用一个新的练习场地，这次展示 `INCLUDE` LOD 如何工作。
- en: INCLUDE
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: INCLUDE
- en: The second playground is mostly set up for you when using the accompanying workbook
    ([https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/tree/main/Chapter07](https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/tree/main/Chapter07)).
    We will, however, add some calculated fields for the purpose of effective exploration.
    If you do not have ready access to the workbook, you should be able to construct
    a similar one by referencing the following information.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个练习场地在使用附带工作簿时已为您大部分设置好（[https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/tree/main/Chapter07](https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/tree/main/Chapter07)）。不过，我们将为有效探索添加一些计算字段。如果您无法直接访问该工作簿，您应该能够通过参考以下信息构建一个类似的工作簿。
- en: Setting up the workbook
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置工作簿
- en: 'In the following, we will set up a worksheet with which we can practice the
    `INCLUDE` LODs:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的内容中，我们将设置一个工作表，以便练习`INCLUDE` LOD：
- en: Open the workbook associated with this chapter and navigate to the `Exploring
    Include` worksheet.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开与本章相关的工作簿，导航到 `探索 Include` 工作表。
- en: The parameters and calculated fields named **1st Dim**, **2nd Dim**, **3rd Dim**,
    and **4th Dim** created in the previous exercises are also utilized for this worksheet.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前面练习中创建的参数和计算字段 **1st Dim**、**2nd Dim**、**3rd Dim** 和 **4th Dim** 也会在这个工作表中使用。
- en: Right-click on the **1st Dim** parameter and choose **Duplicate**.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击**第1维**参数并选择**复制**。
- en: Rename the duplicate `Choose` `Included Dims`.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将复制的 `Choose` 重命名为 `Included Dims`。
- en: 'Create a new calculated field named `Case``Include` with the following code:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的计算字段，命名为 `Case``Include`，并使用以下代码：
- en: '[PRE5]'
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Place **Case Include** on the **Detail** shelf.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**案例 Include**放到**细节**架上。
- en: 'Place the following measures and dimensions on their respective shelves:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下度量和维度放到相应的架上：
- en: '![](img/B18435_07_29.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_29.png)'
- en: 'Figure 7.29: Exploring INCLUDE'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.29：探索 INCLUDE
- en: 'Display each of the following parameters by right-clicking each one and selecting
    **Show Parameter Control**:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过右键单击每个参数并选择**显示参数控制**来显示以下每个参数：
- en: '![](img/B18435_07_30.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_30.png)'
- en: 'Figure 7.30: Parameters'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.30：参数
- en: After you have finished the initial setup, we can finally start to investigate
    the `INCLUDE` LOD.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 完成初始设置后，我们终于可以开始调查`INCLUDE` LOD。
- en: Understanding INCLUDE
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解 INCLUDE
- en: Now that the playground environment is complete, let’s build a scenario to better
    understand `INCLUDE`. By now, you can probably imagine that if the `FIXED` and
    `EXCLUDE` LODs remove dimensions from a calculation, `INCLUDE` adds dimensions.
    Correct! It might happen that you want to include one or more dimensions in a
    calculation even though the view doesn’t show them. The next example will make
    use of this functionality to show an average per sub-category without showing
    the sub-category. One would want to do this because the sub-category has so many
    additional values that the dashboard will be harder to read, and it will take
    longer to draw quick conclusions. Nevertheless, it is of interest to know the
    average per sub-category because the number of sub-categories might differ per
    **Region** and other dimensions, and thus including it will give insights into
    the real average sales.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 现在环境已设置完毕，我们来构建一个场景，更好地理解`INCLUDE`。现在你大概能想象，如果`FIXED`和`EXCLUDE` LOD从计算中移除维度，那么`INCLUDE`会添加维度。没错！可能会发生这样的情况，你想在计算中包括一个或多个维度，即使视图中并没有显示它们。下一个例子将利用这个功能，在不显示子类别的情况下展示每个子类别的平均值。之所以这样做，是因为子类别包含大量额外的值，这使得仪表板难以阅读，并且需要更长时间才能得出快速结论。然而，了解每个子类别的平均值仍然是很有意义的，因为子类别的数量可能因**区域**和其他维度而异，包含它将有助于揭示实际的平均销售额。
- en: 'Let’s see it in action:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一下实际操作：
- en: 'Set the parameters on the right-hand side as shown here:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照右侧所示设置参数：
- en: '![](img/B18435_07_31.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_31.png)'
- en: 'Figure 7.31: Initial layout'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.31：初始布局
- en: 'Add two reference linesby clicking on **Analytics** and edit them using the
    following settings:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击**分析**添加两条参考线，并使用以下设置进行编辑：
- en: '![](img/B18435_07_32.png)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_32.png)'
- en: 'Figure 7.32: Reference line settings'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.32：参考线设置
- en: 'Look at the following screenshot for the result. Note that both reference lines
    are equal:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看以下截图以查看结果。请注意，两个参考线是相等的：
- en: '![](img/B18435_07_33.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_33.png)'
- en: 'Figure 7.33: Sales per region and reference lines'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.33：按区域销售和参考线
- en: 'If the reference lines are overlapping with each other, edit the formatting
    and set **Alignment** to **Top**. To access the formatting, click on the reference
    line in the view:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果参考线彼此重叠，请编辑格式并将**对齐方式**设置为**顶部**。要访问格式设置，请单击视图中的参考线：
- en: '![](img/B18435_07_34.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_34.png)'
- en: 'Figure 7.34: Format Reference Line'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.34：格式参考线
- en: 'Now, set the parameters as shown here:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，按此方式设置参数：
- en: '![](img/B18435_07_35.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_35.png)'
- en: 'Figure 7.35: Format Reference Line'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.35：格式参考线
- en: 'In Tableau Desktop, you should now see the following. As before, both **Reference
    Lines** are equal:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Tableau Desktop 中，您现在应该看到如下内容。与之前一样，两个**参考线**是相等的：
- en: '![](img/B18435_07_36.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_36.png)'
- en: 'Figure 7.36: Reference Lines'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.36：参考线
- en: Change the **Choose Included Dims** parameter to **Category**, **Ship Mode**,
    and **Segment**.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**选择包含的维度**参数更改为**类别**、**运输模式**和**细分**。
- en: Note that the **Reference Lines** equal one another for each of these settings.
    This is because **Choose Included Dims** is only introducing dimensions already
    represented in the view.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意，在每个设置下，**参考线**是相等的。这是因为**选择包含的维度**仅介绍已经在视图中表示的维度。
- en: 'Change the **Choose Included Dims** parameter to **Sub-Category** to see the
    additional reference line in its intended place:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**选择包含的维度**参数更改为**子类别**，以便在预期的位置查看额外的参考线：
- en: '![](img/B18435_07_37.png)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_37.png)'
- en: 'Figure 7.37: Showing an additional Reference Line'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.37：显示额外的参考线
- en: The **Include Dim Avg** reference line now includes **Sub-Category** in the
    average and therefore differs from the **Overall Avg** reference line. The average
    is smaller because the total **Sales** amount is being divided over more points
    than are visible in the view. Adding **Sub-Category** to the LOD leads to more
    rows, which leads to a smaller average per row. Furthermore, note that the **Sub-Category**
    dimension is not used in the view. LODs do not require a calculation to reside
    in the view.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '**Include Dim Avg**参考线现在将**子类别**包括在平均值内，因此与**整体平均**参考线不同。平均值较小，因为总**销售额**被分配到比视图中可见的更多点上。将**子类别**添加到LOD后，行数增多，每行的平均值也变小。此外，注意到**子类别**维度并未在视图中使用。LOD计算不要求计算字段必须出现在视图中。'
- en: 'To summarize, the `INCLUDE` LOD can manipulate a visualization in a way that
    partitions can be added that are not used in the view itself. Also, the naming
    convention for all three LODs will be your best mnemonic in understanding them:
    `Fixed` to fix the fields used, `Include` to add “missing” fields, and `Exclude`
    to remove unwanted fields from the calculations that are already present.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 总结一下，`INCLUDE` LOD可以以一种方式操作可视化，添加一些在视图中未使用的分区。此外，所有三种LOD的命名约定将成为你理解它们的最佳记忆法：“Fixed”固定已使用的字段，“Include”添加“缺失”的字段，和“Exclude”从已存在的计算中删除不需要的字段。
- en: To get more hands-on training, we will continue with a few practical applications.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 为了获得更多的实操训练，我们将继续进行一些实际应用。
- en: Building practical applications with LODs
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用LOD构建实际应用
- en: The first portion of this chapter was designed to demonstrate how LODs work.
    The remainder will be dedicated to practical applications. Specifically, we will
    consider three typical challenges that previously were solved using other Tableau
    capabilities, such as table calculations and data blending.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的第一部分旨在演示LOD的工作原理，其余部分将专注于实际应用。具体来说，我们将考虑三个典型挑战，这些挑战之前通过其他Tableau功能（如表格计算和数据融合）解决。
- en: This exercise will look at a problem that occurs when mixing a table calculation
    that calculates the percentage of the total with a dimension filter. We will consider
    the problem, a solution using a LOD calculation, and finish with a commentary
    section on the germane points of the solution.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 本练习将探讨一个问题，该问题出现在将计算总百分比的表格计算与维度过滤器结合使用时。我们将考虑这个问题，并使用LOD计算提供解决方案，最后进行与解决方案相关的点评。
- en: Using the LOD FIXED calculation
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用LOD FIXED计算
- en: 'Did you ever encounter a situation where you wanted to calculate the **Percent
    of Total** while only showing a subset of the **Total** dimension in your view?
    Well, you are not alone. But thanks to LODs, you will soon know how to solve this
    problem. The following steps will guide you through the exercise:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 你是否曾遇到过这样一种情况：你只在视图中显示了**总数**维度的子集，却又想计算**总百分比**？别担心，你并不孤单。不过，感谢LOD（层次化计算），你很快就会学会如何解决这个问题。以下步骤将引导你完成这项练习：
- en: Open the workbook associated with this chapter and navigate to the worksheet
    entitled `The Problem`.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开与本章相关的工作簿，并导航到名为`The Problem`的工作表。
- en: Select the `2012_World_Pop` dataset.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`2012_World_Pop`数据集。
- en: 'Create a calculated field named `Percent of Total` with the following code:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`Percent of Total`的计算字段，使用以下代码：
- en: '[PRE6]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Right-click on **Percent of Total** and select **Default Properties** | **Number
    Format** | **Percentage**.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击**Percent of Total**并选择**默认属性** | **数字格式** | **百分比**。
- en: Place **Country** on the **Columns** shelf, **Measure Names** on the **Rows**
    shelf, and **Measure Values** on the **Text** shelf.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**国家**放置在**列**货架上，将**度量名称**放置在**行**货架上，将**度量值**放置在**文本**货架上。
- en: Remove **Number of Records** from the **Measure Values** shelf.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**度量值**货架中移除**记录数量**。
- en: Right-click on **Percent of Total** and set it to **Compute Using** | **Country**.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击**Percent of Total**并设置为**使用计算** | **国家**。
- en: 'Create a filter on **Country** such that only **Afghanistan** displays:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**国家**上创建一个过滤器，使其只显示**阿富汗**：
- en: '![](img/B18435_07_38.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_38.png)'
- en: 'Figure 7.38: Population of Afghanistan'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.38：阿富汗人口
- en: '**Afghanistan** displays the percentage of the total as 100%. Obviously, this
    does not represent Afghanistan’s percentage of the total population of the world.
    Let’s investigate a possible solution—to solve the issue with a LOD, follow along
    with the exercise steps:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '**阿富汗**显示的总百分比为100%。显然，这并不代表阿富汗在全球总人口中的百分比。让我们来探讨可能的解决方案——要通过LOD解决此问题，请按照练习步骤进行操作：'
- en: Duplicate the worksheet entitled `The Problem` and rename it `Solution LOD`.
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制名为`问题`的工作表并重命名为`解决方案 LOD`。
- en: 'Create a calculated field named `Percent of Total LOD` with the following code:'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`总百分比 LOD`的计算字段，代码如下：
- en: '[PRE7]'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Place **Percent of Total LOD** on the **Measure Values** shelf and note that
    the displayed percentage equals **0.43%**. If **0** displays, change the number
    formatting to percentage:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**总百分比 LOD**放置到**度量值**货架，并注意显示的百分比为**0.43%**。如果显示为**0**，请将数字格式更改为百分比：
- en: '![](img/B18435_07_39.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_39.png)'
- en: 'Figure 7.39: Percent of total'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.39：总百分比
- en: 'Remove the **Percent of Total** table calculation that was previously created
    from the **Measure Values** shelf:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**度量值**货架中删除之前创建的**总百分比**表计算：
- en: '![](img/B18435_07_40.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_40.png)'
- en: 'Figure 7.40: Percent of total LOD'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.40：总百分比 LOD
- en: As you can see, problem solved! To better understand what is happening in the
    background, let’s look at a query that Tableau generates for the worksheet entitled
    `The Problem`. Generated queries can be viewed by clicking **Help** | **Settings
    and Performance** | **Start Performance Recording**. (See *Chapter 11*, *Designing
    Dashboards and Best Practices for Visualizations*, for additional information
    regarding viewing Tableau’s generated queries.)
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，问题解决了！为了更好地理解后台发生了什么，我们来看看 Tableau 为名为`问题`的工作表生成的查询。生成的查询可以通过点击**帮助** |
    **设置与性能** | **开始性能记录**来查看。（有关查看 Tableau 生成查询的更多信息，请参阅*第11章*，*仪表板设计与可视化最佳实践*。）
- en: 'The SQL statement is as follows:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: SQL 语句如下：
- en: '[PRE8]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Note that the `WHERE` clause in the query is limiting the returned dataset to
    only those rows that have `Afghanistan` as **Country**. This `WHERE` clause was
    generated because of placing **Country** on the **Filters** shelf. By limiting
    the returned data, the processing requirements are shifted from Tableau to the
    underlying data source engine. In other words, the data source engine does the
    work of executing the query, and Tableau thus works with a smaller dataset. The
    reasoning behind this design is that data source engines are specifically engineered
    to efficiently query large datasets and typically have underlying hardware to
    support such activities. Furthermore, limiting the rows of data returned to Tableau
    can reduce inefficiencies due to latency.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，查询中的`WHERE`子句将返回的数据集限制为只有那些**国家**为`阿富汗`的行。这个`WHERE`子句是因为将**国家**放置在**筛选器**货架上所生成的。通过限制返回的数据，处理要求从
    Tableau 转移到底层数据源引擎。换句话说，数据源引擎负责执行查询，因此 Tableau 使用的是较小的数据集。这个设计的理由是，数据源引擎专门设计用于高效查询大数据集，并且通常具备支持此类活动的硬件。此外，限制返回给
    Tableau 的数据行数可以减少由于延迟带来的低效问题。
- en: Inefficiencies are further reduced because Tableau works from the cache whenever
    possible. Often, a user can perform various operations without generating a call
    to the underlying data source. However, in the preceding case, if a user were
    to select a different **Country** from the filter, Tableau would generate a new
    query to the data source. For example, if a user interacts with the filter and
    deselects `Afghanistan` and selects `Albania`, a new query with a corresponding
    `WHERE` clause is generated. Although the logic of Tableau’s reliance on the data
    source engine is demonstrable, the problem proposed in the preceding example remains.
    What can a Tableau author do to calculate the percent of the whole regardless
    of filtering?
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Tableau 尽可能从缓存中工作，低效问题进一步减少。通常，用户可以执行各种操作而无需生成对底层数据源的调用。然而，在前述情况下，如果用户选择了一个不同的**国家**作为筛选条件，Tableau
    将生成一个新的查询到数据源。例如，如果用户与筛选器交互，取消选择`阿富汗`并选择`阿尔巴尼亚`，则会生成一个带有相应`WHERE`子句的新查询。尽管 Tableau
    依赖于数据源引擎的逻辑是可以证明的，但在前述例子中提出的问题依然存在。Tableau 作者可以做什么来计算整个数据的百分比，而不受筛选的影响呢？
- en: A solution is to create a table calculation that can also be used as a filter.
    The difference is that unlike in the worksheet `The Problem`, the query generated
    by Tableau to the data source returns the entire dataset. When a table calculation
    is used in a filter, the filtering does not take place until the underlying data
    is returned. In other words, Tableau performs the filtering. This preserves a
    percent of the total percentages regardless of which country population totals
    the user chooses to view. But a potential issue with table calculations is that
    the returned dataset may be quite large, which may cause performance challenges.
    Latency may be experienced due to the increased time required to return a large
    dataset, and Tableau may perform more slowly because of additional processing
    responsibilities to filter the dataset.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 一种解决方案是创建一个表计算，也可以用作过滤器。不同之处在于，与工作表`The Problem`不同，Tableau生成的查询会返回整个数据集。当表计算用于过滤器时，过滤操作直到底层数据返回后才会发生。换句话说，Tableau执行过滤操作。这可以保留总百分比的百分比，而不管用户选择查看哪个国家的人口总数。但表计算可能会带来潜在问题，因为返回的数据集可能非常庞大，这可能会导致性能挑战。由于返回大数据集所需的时间增加，可能会遇到延迟，且由于增加的处理责任，Tableau可能会更慢地执行。
- en: 'Our proposed solution, an LOD calculation, can address these challenges. Let’s
    look at the SQL queries created by the `Percent of Total LOD` calculated field
    in the `Solution LOD` worksheet:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 我们提出的解决方案——LOD计算，能够解决这些挑战。让我们来看看在`Solution LOD`工作表中，`Percent of Total LOD`计算字段创建的SQL查询：
- en: '[PRE9]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Note the term `CROSS JOIN`; the LOD calculation generates a query that instructs
    the underlying data source engine to return data in such a way as to allow Tableau
    to divide the population values of one or more countries by the world population
    total, thus returning the correct percentage of the total.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意术语`CROSS JOIN`；LOD计算生成的查询指示底层数据源引擎以一种方式返回数据，允许Tableau将一个或多个国家的人口值除以世界总人口，从而返回正确的总百分比。
- en: Using the LOD INCLUDE calculation
  id: totrans-237
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用LOD INCLUDE计算
- en: 'Next, we will practice the `INCLUDE` LOD calculation. In this exercise, we
    will create a worksheet that displays the following:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将练习`INCLUDE` LOD计算。在本练习中，我们将创建一个工作表，显示以下内容：
- en: Total sales per region
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个区域的总销售额
- en: The average of total sales across all regions
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有区域的总销售额的平均值
- en: The average of total sales across all states in each region
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个区域中所有州的总销售额的平均值
- en: 'Using a LOD calculation to display these values is straightforward. Let’s explore.
    Follow along with the exercise steps:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 使用LOD计算来显示这些值非常简单。让我们一起探索。请按照练习步骤操作：
- en: Select the `Practical Include` worksheet.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`Practical Include`工作表。
- en: Select the `Superstore` dataset.
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`Superstore`数据集。
- en: 'Create a calculated field named `Per State INCLUDE` with the following code:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`Per State INCLUDE`的计算字段，使用以下代码：
- en: '[PRE10]'
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Drag **Region** to the **Columns** shelf, **SUM(Sales)** to the **Rows** shelf,
    and **AVG(Per State INCLUDE)** to the **Details** shelf. Be sure to change **Per
    State INCLUDE** to an average aggregation.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**区域**拖到**列**架上，**SUM(Sales)**拖到**行**架上，**AVG(Per State INCLUDE)**拖到**详细信息**架上。确保将**Per
    State INCLUDE**更改为平均值聚合。
- en: 'Add two **Reference Lines** by right-clicking on the **Sales** axis and selecting
    **Add Reference Line**. Use the following settings:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过右键单击**销售额**轴并选择**添加参考线**来添加两条**参考线**。使用以下设置：
- en: '![](img/B18435_07_41.png)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_41.png)'
- en: 'Figure 7.41: Reference lines'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.41：参考线
- en: 'Complete the worksheet by formatting it as desired:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照所需的格式完成工作表：
- en: '![](img/B18435_07_42.png)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_42.png)'
- en: 'Figure 7.42: Average per Region and State'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.42：每个区域和州的平均值
- en: As you can see, thanks to the LOD, we can display a line chart per **Region**,
    as well as one for the whole dataset. This is possible because we included the
    **State** dimension in our **Per State INCLUDE** calculation. Using this calculated
    field to create a reference line allows Tableau to show not only the average per
    (visible) **Region** but also the average per **State** (invisible) per **Region**.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，得益于LOD，我们可以按**区域**显示折线图，同时也可以显示整个数据集的图表。这之所以可能，是因为我们在**Per State INCLUDE**计算中包含了**州**维度。使用此计算字段创建参考线，可以让Tableau显示不仅是每个（可见）**区域**的平均值，还有每个**区域**的（不可见）**州**的平均值。
- en: Using the LOD EXCLUDE calculation
  id: totrans-255
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用LOD EXCLUDE计算
- en: In this exercise, we will create a worksheet using the `Superstore` dataset,
    which will calculate the percentage of sales generated by each city in a region.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将使用`超级市场`数据集创建一个工作表，用于计算每个城市在地区中产生的销售百分比。
- en: 'Follow along with the exercise steps:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 按照练习步骤操作：
- en: Select the `Practical Exclude` worksheet.
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`实际排除`工作表。
- en: Select the `Superstore` dataset.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`超级市场`数据集。
- en: 'Create the following calculated fields:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建以下计算字段：
- en: '![](img/B18435_07_43.png)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_43.png)'
- en: 'Figure 7.43: Region Values and % Per Region LODs'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.43：地区值和每地区LOD百分比
- en: Place **Region** and **City** on the **Rows** shelf.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**地区**和**城市**放置在**行**架子上。
- en: Place **Measure Names** on the **Columns** shelf and **Measure Values** on the
    **Text** shelf.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**度量名称**放置在**列**架子上，并将**度量值**放置在**文本**架子上。
- en: Remove all instances of measures from the **Measure Values** shelf except **Sales**,
    **Region Values**, and **% Per Region LOD.**
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**度量值**架子上移除所有度量，除了**销售额**、**地区值**和**每地区LOD百分比**。
- en: 'In order for **% Per Region LOD** to display as a percentage, the number formatting
    must be adjusted. Simply right-click on the calculation in the **Data** pane and
    select **Default Properties** | **Number Format** | **Percentage**:'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了让**每地区LOD百分比**以百分比形式显示，必须调整数字格式。只需右键点击**数据**窗格中的计算，选择**默认属性** | **数字格式** |
    **百分比**：
- en: '![](img/B18435_07_44.png)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_44.png)'
- en: 'Figure 7.44: Change Number Format'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.44：更改数字格式
- en: 'Place an instance of **AGG(% Per Region LOD)** on the **Filter** shelf and
    adjust to display at least `0.1` (or 10%):'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**AGG（每地区LOD百分比）**放置在**过滤器**架子上，并调整显示至少`0.1`（即10%）：
- en: '![](img/B18435_07_45.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_45.png)'
- en: 'Figure 7.45: % filter'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.45：百分比过滤器
- en: 'Observe the current view, with **Region** and **City** on the **Rows** shelf:'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看当前视图，其中**地区**和**城市**位于**行**架子上：
- en: '![](img/B18435_07_46.png)'
  id: totrans-273
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_46.png)'
- en: 'Figure 7.46: Jacksonville still visible'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.46：杰克逊维尔仍然可见
- en: 'Now, place **State** on the **Rows** shelf between **Region** and **City**.
    Note that **Jacksonville** disappears:'
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，将**州**放置在**行**架子上，位于**地区**和**城市**之间。请注意，**杰克逊维尔**消失了：
- en: '![](img/B18435_07_47.png)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_47.png)'
- en: 'Figure 7.47: Jacksonville disappears when Region is added to Rows'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.47：当地区添加到行时，杰克逊维尔消失
- en: 'This is happening because **Jacksonville** exists in two states of the **South**
    region, in **Florida** as well as in **North Carolina**. You can see this replacing
    the **% Per Region LOD** filter with **City**: **Jacksonville**:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为**杰克逊维尔**位于**南部**地区的两个州：**佛罗里达州**和**北卡罗来纳州**。你可以看到这将**每地区LOD百分比**过滤器替换为**城市**：**杰克逊维尔**：
- en: '![](img/B18435_07_48.png)'
  id: totrans-279
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18435_07_48.png)'
- en: 'Figure 7.48: Jacksonville existing within two states'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.48：杰克逊维尔存在于两个州之间
- en: Our **Region Values** calculation excluded **City** and **State**, and so the
    **% Per Region LOD** will consider the **SUM(Sales)** for whatever is visible
    in the view, divided by the **Region Values**. With **Region** and **City** in
    the view only, the **SUM(Sales)** for Jacksonville is **44,713** (see *Figure
    7.48*). That number divided by the **Region Values** of **391,722** (see *Figure
    7.46*) is > 10%. But then we added **State** to the view, changing the **SUM(Sales)**
    to **39,133** for **Jacksonville** in **Florida** and **5,580** for **Jacksonville**
    in **North Carolina** (see *Figure 7.50*). Neither one of them, when divided by
    **391,722** for the **Region Values**, is above 10% and will therefore drop from
    the view due to our filter.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的**地区值**计算排除了**城市**和**州**，因此**每地区LOD百分比**将计算视图中可见内容的**销售总和**，然后除以**地区值**。当视图中仅有**地区**和**城市**时，杰克逊维尔的**销售总和**为**44,713**（见*图
    7.48*）。将这个数字除以**地区值**的**391,722**（见*图 7.46*），结果超过10%。但是，随后我们将**州**添加到视图中，将**杰克逊维尔**在**佛罗里达州**的**销售总和**改为**39,133**，在**北卡罗来纳州**的**销售总和**为**5,580**（见*图
    7.50*）。这两者在除以**地区值**的**391,722**后，结果都没有超过10%，因此将由于过滤器的作用而从视图中删除。
- en: 'LODs are one of the more advanced topics when using Tableau, but they are very
    powerful and worth spending the time to understand. For more practical examples,
    I would recommend you check out the following website: [https://www.tableau.com/about/blog/LOD-expressions](https://www.tableau.com/about/blog/LOD-expressions).
    I remember that when I first started using Tableau, I did not think that I would
    ever want to show data based on dimensions that were not in my view or that I
    would want to exclude dimensions. But I needed to do that so many times, for example,
    when adding a calculation of the distance to the average of total rows to my dashboard
    or when a dimension had multiple max dates and you wanted to show the measure
    of each individual max date only. I have gone back to the documentation on LODs
    more often than you can imagine, and I can only encourage you to do the same;
    the more you read about LODs, the easier it will be to grasp the concept and use
    them naturally. The added flexibility LODs bring to your dashboard is incredible.'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: LOD是使用Tableau时相对高级的话题之一，但它们非常强大，值得花时间去理解。为了获得更多实际的例子，我建议你查看以下网站：[https://www.tableau.com/about/blog/LOD-expressions](https://www.tableau.com/about/blog/LOD-expressions)。我记得刚开始使用Tableau时，我从没想过会需要基于不在视图中的维度来展示数据，或者想要排除某些维度。但事实上，我很多时候都需要这么做，比如，在仪表板上添加距离总行平均值的计算，或者当某个维度有多个最大日期时，只想显示每个最大日期的度量。我比你想象的还要频繁地查阅LOD的文档，只能鼓励你也这样做；你读得越多，理解这个概念并自如使用它就会变得越容易。LOD为你的仪表板带来的灵活性简直令人难以置信。
- en: Summary
  id: totrans-283
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: We began this chapter by exploring why LODs are so impactful and why their inclusion
    in Tableau was so lauded. Next, we built two playgrounds to explore how the three
    LODs—`FIXED`, `EXCLUDE`, and `INCLUDE`—work. Tableau’s default is to base calculations
    on the dimensions visible in the view. For example, if you have states in your
    view, the sales amount will be presented by state. If you are adding cities, the
    sales amount will be adjusted by state, by city. But, if you want to manipulate
    this default logic, you can use LODs. They allow you to calculate measures based
    on any dimension, no matter whether that dimension is represented in the view
    or not. We also saw that `FIXED` LODs are higher in the order of operations in
    Tableau than `EXCLUDE` and `INCLUDE` LODs. This is important to remember so that
    you use the correct LOD and/or filter in your dashboard.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过探索为什么LOD（层次级别计算）如此具有影响力，以及它们在Tableau中为何如此受到赞誉，开始了本章。接下来，我们构建了两个实验场来探索三种LOD——`FIXED`、`EXCLUDE`和`INCLUDE`——的工作原理。Tableau的默认设置是基于视图中可见的维度来进行计算。例如，如果你的视图中有州，销售额将按州展示。如果你添加了城市，销售额将按州和城市进行调整。但是，如果你想修改这种默认逻辑，你可以使用LOD。它们允许你根据任何维度来计算度量，无论该维度是否在视图中呈现。我们还看到，`FIXED`
    LOD的优先级高于`EXCLUDE`和`INCLUDE` LOD，这在Tableau的操作顺序中非常重要。记住这一点，以便在仪表板中使用正确的LOD和/或过滤器。
- en: In the next chapter, we’ll turn our attention to the visual side of Tableau
    and explore different chart types and less common but very useful visualizations.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将关注Tableau的视觉部分，探索不同的图表类型以及一些不太常见但非常实用的可视化方法。
- en: Learn more on Discord
  id: totrans-286
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Discord上了解更多
- en: 'To join the Discord community for this book – where you can share feedback,
    ask questions to the author, and learn about new releases – follow the QR code
    below:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 要加入本书的Discord社区——你可以在这里分享反馈、向作者提问并了解新版本——请扫描下面的二维码：
- en: '[https://packt.link/tableau](https://packt.link/tableau)'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/tableau](https://packt.link/tableau)'
- en: '![](img/QR_Code2044012316175764640.png)'
  id: totrans-289
  prefs: []
  type: TYPE_IMG
  zh: '![](img/QR_Code2044012316175764640.png)'
