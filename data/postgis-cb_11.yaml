- en: Using Desktop Clients
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用桌面客户端
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Adding PostGIS layers – QGIS
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – QGIS
- en: Using the Database Manager plugin – QGIS
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用数据库管理器插件 – QGIS
- en: Adding PostGIS layers – OpenJUMP GIS
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – OpenJUMP GIS
- en: Running database queries – OpenJUMP GIS
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行数据库查询 – OpenJUMP GIS
- en: Adding PostGIS layers – gvSIG
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – gvSIG
- en: Adding PostGIS layers – uDig
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – uDig
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: At a minimum, desktop GIS programs allow you to visualize data from a PostGIS
    database. This relationship gets more interesting with the ability to edit and
    manipulate data outside of the database and in a dynamic *play* environment.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 至少，桌面GIS程序允许你从PostGIS数据库中可视化数据。这种关系随着在数据库外和在动态*播放*环境中编辑和操作数据的能力而变得更加有趣。
- en: Make a change, see a change! For this reason, visualizing the data stored in
    PostGIS is often critical for effective spatial database management—or at least
    as a now-and-again sanity check. This chapter will demonstrate both dynamic and
    static relationships between your database and desktop clients.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 做一个改变，看到改变！因此，可视化存储在PostGIS中的数据对于有效的空间数据库管理通常是至关重要的——至少作为一个不时进行的理智检查。本章将演示数据库和桌面客户端之间的动态和静态关系。
- en: Regardless of your experience level or role in the geospatial community, you
    should find at least one of the four GIS programs serviceable as a potential intermediate
    staging environment between your PostGIS database and end product.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你在地理空间社区中的经验水平或角色如何，你应该至少找到一个四个GIS程序作为你PostGIS数据库和最终产品之间潜在的中间阶段环境。
- en: 'In this chapter, we will connect to PostGIS using the following desktop GIS
    programs: **QGIS**, **OpenJUMP GIS**, **gvSIG**, and **uDig**.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用以下桌面GIS程序连接到PostGIS：**QGIS**、**OpenJUMP GIS**、**gvSIG**和**uDig**。
- en: Once connected to PostGIS, extra emphasis will be placed on some of the more
    sophisticated functionalities offered by `QGIS` and `OpenJUMP GIS` using the **Database
    Manager** (**DB Manager**) plugin and data store queries, respectively.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦连接到PostGIS，将特别强调使用**数据库管理器**（**DB Manager**）插件和数据存储查询分别提供的`QGIS`和`OpenJUMP
    GIS`的一些更高级的功能。
- en: Adding PostGIS layers – QGIS
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – QGIS
- en: In this recipe, we will establish a connection to our PostGIS database in order
    to add a table as a layer in **QGIS** (formerly known as **Quantum GIS**). Viewing
    tables as layers is great for creating maps or simply working on a copy of the
    database outside the database.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将建立与我们的PostGIS数据库的连接，以便将一个表作为**QGIS**（以前称为**Quantum GIS**）中的图层添加。将表格作为图层查看对于创建地图或简单地在外部数据库中工作副本非常有用。
- en: 'Please navigate to the following site to install the latest version LTR of
    QGIS (2.18 – Las Palmas at the time of writing):'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 请导航到以下网站以安装QGIS（2.18 – Las Palmas，撰写本文时）的最新版本LTR：
- en: '[http://qgis.org/en/site/](http://qgis.org/en/site/)'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://qgis.org/en/site/](http://qgis.org/en/site/)'
- en: On this page, click on Download Now and you will be able to choose a suitable
    operating system and the relevant settings. QGIS is available for Android, Linux,
    macOS X, and Windows. You might also be inclined to click on Discover QGIS to
    get an overview of basic information about the program along with features, screenshots,
    and case studies.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在此页面上，点击下载现在，你将能够选择合适的操作系统和相关设置。QGIS适用于Android、Linux、macOS X和Windows。你也可能倾向于点击探索QGIS，以获取有关程序的基本信息，包括功能、截图和案例研究。
- en: Getting ready
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'To begin, create the schema for this chapter as `chp11`; then, download data
    from the U.S. Census Bureau''s FTP site:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，为这一章创建名为`chp11`的模式；然后，从美国人口普查局的FTP网站下载数据：
- en: '[http://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip](http://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip)'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip](http://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip)'
- en: The shapefile is `All Lines` for Cuyahoga county in Ohio, which consist of roads
    and streams among other line features.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 该shapefile是俄亥俄州库亚霍加县的`All Lines`，其中包括道路和其他线要素。
- en: 'Extract the ZIP file to your working directory and then load it into your database
    using `shp2pgsql`. Be sure to specify the spatial reference system, EPSG/SRID:
    4269\. When in doubt about using projections, use the service provided by the
    folks at OpenGeo at the following website:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 将ZIP文件解压到你的工作目录，然后使用`shp2pgsql`将其加载到你的数据库中。务必指定空间参考系统，EPSG/SRID：4269。如果你对使用投影有疑问，请使用以下网站提供的OpenGeo服务：
- en: '[http://prj2epsg.org/search](http://prj2epsg.org/search)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://prj2epsg.org/search](http://prj2epsg.org/search)'
- en: 'Use the following command to generate the SQL to load the shapefile in a table
    of the `chp11` schema:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令生成加载`chp11`模式中表的shapefile的SQL：
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: How to do it...
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'Now it''s time to give the data we downloaded a look using QGIS. We must first
    create a connection to the database in order to access the table. Get connected
    and add the table as a layer by following the ensuing steps:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候使用QGIS查看我们下载的数据了。我们必须首先创建到数据库的连接，以便访问表。连接并按照以下步骤将表添加为图层：
- en: 'Click on the Add PostGIS Layers icon:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击添加PostGIS图层图标：
- en: '![](img/b26071bf-5890-4d16-8b5b-b3b19495070a.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/b26071bf-5890-4d16-8b5b-b3b19495070a.png)'
- en: Click on the New button below the Connections drop-down menu.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击下拉菜单下方的新建按钮。
- en: 'Create a new PostGIS connection. After the Add PostGIS Table(s) window opens,
    create a name for the connection and fill in a few parameters for your database,
    including Host, Port, Database, Username, and Password:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的PostGIS连接。在添加PostGIS表（s）窗口打开后，为连接创建一个名称，并填写数据库的一些参数，包括主机、端口、数据库名称、用户名和密码：
- en: '![](img/831f624c-973a-413d-baf5-803c1d3e7aca.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/831f624c-973a-413d-baf5-803c1d3e7aca.png)'
- en: Once you have entered all of the pertinent information for your database, click
    on the Test Connection button to verify that the connection is successful. If
    the connection is not successful, double-check for typos and errors. Additionally,
    make sure you are attempting to connect to a PostGIS-enabled database.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您已输入数据库的所有相关信息，请点击测试连接按钮以验证连接是否成功。如果连接不成功，请仔细检查是否有拼写错误和错误。此外，请确保您正在尝试连接到启用了PostGIS的数据库。
- en: If the connection is successful, go ahead and check the Save Username and Save
    Password checkboxes. This will prevent you from having to enter your login information
    multiple times throughout the exercise.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果连接成功，请继续勾选保存用户名和保存密码复选框。这将防止您在整个练习过程中多次输入登录信息。
- en: Click on OK at the bottom of the menu to apply the connection settings. Now
    you can connect!
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击菜单底部的OK按钮以应用连接设置。现在您可以连接了！
- en: Make sure the name of your PostGIS connection appears in the drop-down menu
    and then click on the Connect button. If you choose not to store your username
    and password, you will be asked to submit this information every time you try
    to access the database.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您的PostGIS连接名称出现在下拉菜单中，然后点击连接按钮。如果您选择不存储用户名和密码，每次尝试访问数据库时都会要求您提交此信息。
- en: Once connected, all schemas within the database will be shown and the tables
    will be made visible by expanding the target schema.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 连接后，数据库中的所有模式都将显示，通过展开目标模式，表将变得可见。
- en: 'Select the table(s) to be added as a layer by simply clicking on the table
    name or anywhere along its row. Selection(s) will be highlighted in blue. To deselect
    a table, click on it a second time and it will no longer be highlighted. Select
    the `tl_2012_39035_edges` table that was downloaded at the beginning of the chapter
    and click on the Add button, as shown in the following screenshot:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过单击表名或其行上的任何位置来选择要添加为图层的表（s）。选定的内容将以蓝色突出显示。要取消选择一个表，请再次单击它，它将不再突出显示。选择在章节开头下载的`tl_2012_39035_edges`表，然后点击添加按钮，如图所示：
- en: '![](img/6a7a27fd-eafb-4886-9a54-78dc4ad9434c.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/6a7a27fd-eafb-4886-9a54-78dc4ad9434c.png)'
- en: A subset of the table can also be added as a layer. This is accomplished by
    double-clicking on the desired table name.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 表的一个子集也可以作为一个图层添加。这通过双击所需的表名来完成。
- en: 'The Query Builder window will open, which aids in creating simple SQL `WHERE`
    clause statements. Add the roads by selecting the records where `roadflg = Y`.
    This can be done by typing a query or using the buttons within Query Builder:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查询构建器窗口将打开，它有助于创建简单的SQL `WHERE`子句语句。通过选择`roadflg = Y`的记录来添加道路。这可以通过输入查询或使用查询构建器中的按钮来完成：
- en: '![](img/c48c8e0a-9196-4fc7-8869-33b2db5b8a1f.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/c48c8e0a-9196-4fc7-8869-33b2db5b8a1f.png)'
- en: Click on the OK button followed by the Add button. A subset of the table is
    now loaded into QGIS as a layer. The layer is strictly a static, temporary copy
    of your database. You can make whatever changes you like to the layer and not
    affect the database table.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击OK按钮，然后点击添加按钮。现在，表的子集已作为图层加载到QGIS中。该图层严格是数据库的静态、临时副本。您可以对该图层进行任何更改，而不会影响数据库表。
- en: The same holds true the other way around. Changes to the table in the database
    will have no effect on the layer in QGIS.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，反过来也是如此。对数据库中表的更改将对QGIS中的图层没有影响。
- en: If needed, you can save the temporary layer in a variety of formats, such as
    DXF, GeoJSON, KML, or SHP. Simply right-click on the layer name in the Layers
    panel and click on Save As. This will then create a file, which you can recall
    at a later time or share with others.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，你可以将临时图层保存为多种格式，如DXF、GeoJSON、KML或SHP。只需在图层面板中右键单击图层名称，然后单击“另存为”。这将创建一个文件，你可以在以后回忆或与他人分享。
- en: 'The following screenshot shows the Cuyahoga county road network:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了Cuyahoga县的道路网络：
- en: '![](img/89438422-74c2-4263-b088-2eb5b2e3f8d9.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/89438422-74c2-4263-b088-2eb5b2e3f8d9.png)'
- en: 'You may also use the QGIS Browser Panel to navigate through the now connected
    PostGIS database and list the schemas and tables. This panel allows you to double-click
    to add spatial layers to the current project, providing a better user experience
    not only of connected databases, but on any directory of your machine:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以使用QGIS浏览器面板在现在已连接的PostGIS数据库中导航，并列出模式和表。此面板允许你双击以将空间图层添加到当前项目，不仅为连接的数据库，而且为你的机器上的任何目录提供更好的用户体验：
- en: '![](img/db0b2deb-982a-4532-bca1-d8b3863eb625.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/db0b2deb-982a-4532-bca1-d8b3863eb625.png)'
- en: How it works...
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: You have added a PostGIS layer into QGIS using the built-in Add PostGIS Table
    GUI. This was achieved by creating a new connection and entering your database
    parameters.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经使用内置的添加PostGIS表GUI将PostGIS图层添加到QGIS中。这是通过创建一个新的连接并输入你的数据库参数来实现的。
- en: Any number of database connections can be set up simultaneously. If working
    with multiple databases is more common for your workflows, saving all of the connections
    into one XML file (see the tip in the preceding section) would save time and energy
    when returning to these projects in QGIS.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 可以同时设置任意数量的数据库连接。如果你的工作流程中更常见地使用多个数据库，将所有连接保存到一个XML文件中（参见上一节中的提示）会在返回QGIS中的这些项目时节省时间和精力。
- en: Using the Database Manager plugin – QGIS
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用数据库管理器插件 – QGIS
- en: '**Database Manager** (**DB Manager**) allows for a more sophisticated relationship
    with PostGIS by allowing users to interact with the database in a variety of ways.
    The plugin mimics some of the core functionality of pgAdmin with the added benefit
    of data visualization.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据库管理器**（**DB Manager**）通过允许用户以多种方式与数据库交互，允许用户与PostGIS建立更复杂的关系。该插件模仿了pgAdmin的一些核心功能，并增加了数据可视化的好处。'
- en: 'In this recipe, we will use DB Manager to create, modify, and delete items
    within the database and then tinker with the SQL window. By the end of this section,
    you will be able to do the following:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将使用DB Manager在数据库中创建、修改和删除项目，然后对SQL窗口进行操作。在本节结束时，你将能够做到以下几件事情：
- en: Navigate to the DB Manager menu
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导航到DB Manager菜单
- en: Create, modify, and delete database schemas and tables
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建、修改和删除数据库模式和表
- en: Run SQL queries to add new QGIS layers or create new tables in the database
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行SQL查询以添加新的QGIS图层或在数据库中创建新表
- en: QGIS needs to be installed for this recipe. Please refer to the first recipe
    in this chapter for information on where to download the installer.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 需要安装QGIS才能使用此配方。请参考本章的第一个配方以获取有关下载安装程序的信息。
- en: Getting ready
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Let's make sure the plugin is enabled and connected to the database.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保插件已启用并连接到数据库。
- en: 'Click on the Plugins menu located on the QGIS menu bar and select Manage and Install Plugins
    from the drop-down menu, as shown in the following screenshot:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击QGIS菜单栏上的插件菜单，然后从下拉菜单中选择“管理插件”和“安装插件”，如图所示：
- en: '![](img/626a2bfb-e4c1-4f20-9def-3f62101c2c0d.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/626a2bfb-e4c1-4f20-9def-3f62101c2c0d.png)'
- en: 'The QGIS Plugin Manager window will open. Search for DB Manager in the list
    of plugins and make sure it is checked (enabled), as shown in the following screenshot:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: QGIS插件管理器窗口将打开。在插件列表中搜索DB Manager，并确保它被勾选（已启用），如图所示：
- en: '![](img/ed24d00a-75b3-4bb7-97b4-235340cfbcad.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ed24d00a-75b3-4bb7-97b4-235340cfbcad.png)'
- en: 'Now that DB Manager is enabled, let us open the plugin and check the status
    of the database connection. Open DB Manager by navigating to Database | DB Manager
    from the QGIS menu bar, as shown in the following screenshot:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在DB Manager已启用，让我们打开插件并检查数据库连接的状态。通过导航到QGIS菜单栏上的数据库 | DB Manager打开DB Manager，如图所示：
- en: '![](img/b911de78-2e8c-4c98-97a3-473be68c91d6.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b911de78-2e8c-4c98-97a3-473be68c91d6.png)'
- en: Expand the PostGIS directory within the Tree window of DB Manager. The PostGIS
    connection created in the last recipe will appear. Expand the connection to view
    your schema(s) and table(s). You will be asked for a username and password if
    you opted not to save your credentials.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据库管理器的树窗口中展开PostGIS目录。在上一个菜谱中创建的PostGIS连接将出现。展开连接以查看您的模式（s）和表（s）。如果您选择不保存凭据，您将需要输入用户名和密码。
- en: 'On the Info tab above the main window, you can view information about the data,
    such as spatial reference, geometry type, field names, field types, and much more,
    as in the following screenshot:'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在主窗口上方的“信息”标签页中，您可以查看有关数据的信息，例如空间参考、几何类型、字段名称、字段类型等等，如下面的截图所示：
- en: '![](img/92bc79fe-2f35-44e1-876b-ba67f076a342.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/92bc79fe-2f35-44e1-876b-ba67f076a342.png)'
- en: A PostGIS connection is not in place if you are unable to expand the PostGIS
    menu. If you need to establish a connection, refer to *steps 1* to *4* in the
    *Adding **PostGIS **layers – QGIS* recipe. The connection must be established
    before using DB Manager.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您无法展开PostGIS菜单，则PostGIS连接尚未设置。如果您需要建立连接，请参阅*添加**PostGIS**图层 – QGIS*菜谱中的*步骤
    1*到*4*。在使用数据库管理器之前必须建立连接。
- en: How to do it...
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Navigate to the DB Manager menu and carry out the following steps:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 导航到数据库管理器菜单并执行以下步骤：
- en: Select the `tl_2012_39035_edges` table in the Tree window.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在树窗口中选择`tl_2012_39035_edges`表。
- en: 'Next, click on the Table tab to view the actual data table, as shown in the
    following screenshot:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，点击“表”标签以查看实际的数据表，如下面的截图所示：
- en: '![](img/b3ad86db-2f95-47d5-9047-9a16165d967f.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/b3ad86db-2f95-47d5-9047-9a16165d967f.png)'
- en: 'The final tab, Preview, is for visualizing the data, as shown in the following
    screenshot:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一个标签页“预览”用于可视化数据，如下面的截图所示：
- en: '![](img/4cdf1aec-89e7-4189-8cb5-079dc27871f8.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/4cdf1aec-89e7-4189-8cb5-079dc27871f8.png)'
- en: 'To create, modify, and delete database schemas and tables, follow the ensuing
    steps:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建、修改和删除数据库模式和表，请按照以下步骤操作：
- en: 'First, create a new schema in the database to store data for this chapter.
    Select Schema | Create schema from the menu bar, as shown in the following screenshot:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，在数据库中创建一个新的模式以存储本章的数据。从菜单栏中选择“模式”|“创建模式”，如下面的截图所示：
- en: '![](img/eafbf5f7-0ea6-4509-9f66-d2c7f33f8bb5.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/eafbf5f7-0ea6-4509-9f66-d2c7f33f8bb5.png)'
- en: 'Enter `new_schema` as the schema name and then click on OK. If you do not see
    the `new_schema` in the list, you may need to select the database connection in
    the Tree window and click on the Refresh button or press *F5* (see the following
    screenshot):'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将模式名称输入为`new_schema`，然后点击确定。如果您在列表中看不到`new_schema`，您可能需要在树窗口中选择数据库连接并点击刷新按钮或按*F5*（见以下截图）：
- en: '![](img/af0a05bd-3fc5-406e-8799-0f978720e04f.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/af0a05bd-3fc5-406e-8799-0f978720e04f.png)'
- en: 'Your new, empty schema will now be visible in the Tree window:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您的新空模式现在将在“树”窗口中可见：
- en: '![](img/e1de2df4-8281-44ee-b186-00bd860f1cc0.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/e1de2df4-8281-44ee-b186-00bd860f1cc0.png)'
- en: Now let's continue to work with our chp11 schema containing the `tl_2012_39035_edges`
    table. Let's modify the table name to something more generic. How about `lines`?
    You can change the table name by clicking on the table in the Tree window. As
    soon as the text is highlighted and the cursor flashes, you can delete the existing
    name and enter the new name, `lines`.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们继续使用包含`tl_2012_39035_edges`表的chp11模式。让我们将表名修改为更通用的名称。如何？`lines`？您可以通过在树窗口中点击表来更改表名。一旦文本被高亮显示并且光标闪烁，您就可以删除现有的名称并输入新名称，`lines`。
- en: 'Right now, our `lines` table''s data is using degrees as the unit of measurement
    for its current projection (*EPSG: 4269*). Let''s add a new geometry column using
    EPSG: 3734, which is a State Plane Coordinate system that measures projections
    in feet. To run SQL queries, follow the ensuing steps:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '目前，我们的`lines`表的数据正在使用度作为当前投影的测量单位（*EPSG: 4269*）。让我们添加一个新的几何列，使用EPSG: 3734，这是一个以英尺为单位的州平面坐标系。要运行SQL查询，请按照以下步骤操作：'
- en: 'Click on the SQL window button in the DB Manager or press *F2*, as shown in
    the following screenshot:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据库管理器中点击SQL窗口按钮或按*F2*，如下面的截图所示：
- en: '![](img/04652e6b-8dfe-4956-8172-ff3b8c54486e.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/04652e6b-8dfe-4956-8172-ff3b8c54486e.png)'
- en: 'Copy the following query into the SQL window and then click on Execute:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下查询复制到SQL窗口中，然后点击执行：
- en: '[PRE1]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The query creates a new geometry column named `geom_sp` and then updates the
    geometry information by transforming the original geometry (`geom`) from EPSG
    4269 to 3734, as shown in the following screenshot:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 查询创建了一个名为 `geom_sp` 的新几何列，然后通过将原始几何形状（`geom`）从 EPSG 4269 转换为 3734 来更新几何信息，如下截图所示：
- en: '![](img/d2b1a29e-7fb7-40c7-9209-0d0592283342.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/d2b1a29e-7fb7-40c7-9209-0d0592283342.png)'
- en: 'Refresh the `chp11` schema and you''ll notice that the table in the database
    now has two geometry columns that are treated independently in the Tree window:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 刷新 `chp11` 架构，你会注意到数据库中的表现在有两个几何列，在树窗口中独立处理：
- en: '![](img/03963bf6-a3ae-4ad9-bdb6-9cebb91af65c.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/03963bf6-a3ae-4ad9-bdb6-9cebb91af65c.png)'
- en: 'The preceding screenshot shows the original geometry. The following screenshot
    shows the created geometry:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 上一张截图显示了原始几何形状。下一张截图显示了创建的几何形状：
- en: '![](img/512da5fb-a351-433f-8031-a1c2aa6cb010.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/512da5fb-a351-433f-8031-a1c2aa6cb010.png)'
- en: 'For our next query, let us take a subset of the `lines` table. Similar to what
    we did in the preceding section, we will only look at the data about roads. However,
    this time, we can limit the columns that we want to load with the layer, as well
    as perform more complicated spatial queries. We''ll apply a buffer of 10 feet
    using the new geometry column (`geom_sp`) by executing the following command:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于我们的下一个查询，让我们从 `lines` 表中取一个子集。类似于上一节中我们所做的，我们只查看关于道路的数据。然而，这次，我们可以限制我们想要加载到图层中的列，以及执行更复杂的空间查询。我们将通过执行以下命令使用新的几何列（`geom_sp`）应用
    10 英尺的缓冲区：
- en: '[PRE2]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Check the Load as new layer checkbox and then select gid as the unique ID and
    geom as the geometry. Create a name for the layer and then click on Load Now!,
    and what you''ll see is shown in the following screenshot:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 选择“加载为新图层”复选框，然后选择 gid 作为唯一 ID，geom 作为几何形状。为图层创建一个名称，然后点击“立即加载！”，你将看到以下截图所示的内容：
- en: '![](img/afd51f5d-8b22-476e-a114-b635509c5f7c.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/afd51f5d-8b22-476e-a114-b635509c5f7c.png)'
- en: The query adds the result in QGIS as a temporary layer.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 查询将结果作为临时图层添加到 QGIS 中。
- en: 'Now let us modify the query to create a table in the database, rather than
    load the query as a layer, by executing the following command:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将修改查询，通过执行以下命令在数据库中创建一个表，而不是将查询作为图层加载：
- en: '[PRE3]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The following screenshot shows the Cuyahoga county road network:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了 Cuyahoga 县的道路网络：
- en: '![](img/9524b601-f99f-4484-a7cb-03fea31b84a1.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/9524b601-f99f-4484-a7cb-03fea31b84a1.png)'
- en: How it works...
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Connecting to a PostGIS database (see the *Adding PostGIS layers – QGIS* recipe
    in this chapter) allows you to utilize the DB Manager plugin. Once DB Manager
    was enabled, we were able to toggle between the Info, Table, and Preview tabs
    to efficiently view metadata, tabular data, and data visualization.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 连接到 PostGIS 数据库（参见本章中的 *添加 PostGIS 图层 – QGIS* 菜谱）允许你使用 DB Manager 插件。一旦启用 DB
    Manager，我们就可以在信息、表和预览选项卡之间切换，以有效地查看元数据、表格数据和数据可视化。
- en: Next, we made changes to the database through the query window, running on the
    table lines of schema `chp11` in order to transform the projection. Note the autocomplete
    feature in the SQL Window, which makes writing queries a breeze.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们通过查询窗口对数据库进行了更改，在架构 `chp11` 的表 lines 上运行，以转换投影。注意 SQL 窗口中的自动完成功能，这使得编写查询变得轻而易举。
- en: Changes to the database were made visible in DB Manager by refreshing the database
    connection.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 通过刷新数据库连接，在 DB Manager 中可以看到对数据库的更改。
- en: Adding PostGIS layers – OpenJUMP GIS
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加 PostGIS 图层 – OpenJUMP GIS
- en: In this section, we will connect to PostGIS with OpenJUMP GIS (OpenJUMP) in
    order to add spatial tables as layers. Next, we will edit the temporary layer
    and update it in a new table in the database.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用 OpenJUMP GIS（OpenJUMP）连接到 PostGIS，以便将空间表作为图层添加。接下来，我们将编辑临时图层并在数据库的新表中更新它。
- en: 'The **JUMP** in OpenJUMP stands for **Java Unified Mapping Platform**. To learn
    more about the program, or if you need to install the latest version, go to:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: OpenJUMP 中的 **JUMP** 代表 **Java Unified Mapping Platform**。要了解更多关于该程序的信息，或需要安装最新版本，请访问：
- en: '[http://www.openjump.org/](http://www.openjump.org/)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.openjump.org/](http://www.openjump.org/)'
- en: 'Click on the Download latest version link ([http://sourceforge.net/projects/jump-pilot/files/OpenJUMP/1.12/](http://sourceforge.net/projects/jump-pilot/files/OpenJUMP/1.12/))
    on the page to view the list of installers. Select the version that suits your
    operating system (`.exe` for Windows and `.jar` for Linux and mac OS). Detailed
    directions for installing OpenJUMP along with other documentation and information
    can be found on the OpenJUMP Wiki page at the following link:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 点击页面上的“下载最新版本”链接 ([http://sourceforge.net/projects/jump-pilot/files/OpenJUMP/1.12/](http://sourceforge.net/projects/jump-pilot/files/OpenJUMP/1.12/))
    以查看安装程序列表。选择适合您操作系统的版本（Windows的`.exe`和Linux及mac OS的`.jar`）。有关安装OpenJUMP的详细说明以及其他文档和信息，可以在以下链接的OpenJUMP
    Wiki页面上找到：
- en: '[http://ojwiki.soldin.de/index.php?title=Main_Page](http://ojwiki.soldin.de/index.php?title=Main_Page)'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://ojwiki.soldin.de/index.php?title=Main_Page](http://ojwiki.soldin.de/index.php?title=Main_Page)'
- en: Getting ready
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'We will be reusing and building upon data used in the *Adding PostGIS layers
    – QGIS* recipe. If you skipped over this recipe, you will want to do the following:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将重用和构建在*添加PostGIS图层 – QGIS*菜谱中使用的数据。如果您跳过了这个菜谱，您需要执行以下操作：
- en: 'Download the following ZIP file from the U.S. Census Bureau''s FTP site:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从美国人口普查局的FTP站点下载以下ZIP文件：
- en: '[ftp://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip](ftp://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip)'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '[ftp://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip](ftp://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip)'
- en: The shapefile is `All Lines` for Cuyahoga county in Ohio, which consist of roads
    and streams, among other line features.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 形状文件是俄亥俄州库耶霍加县的“所有线路”，包括道路和其他线状特征。
- en: 'Extract the ZIP file to your working directory and then load it into your database
    using `shp2pgsql`. Be sure to specify the spatial reference system, which is *EPSG:
    4269*, and name the table `lines`.'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '将ZIP文件解压到您的工作目录，然后使用`shp2pgsql`将其加载到数据库中。请确保指定空间参考系统，即*EPSG: 4269*，并将表命名为`lines`。'
- en: How to do it...
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The data source layer can be added by performing the following steps:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下步骤添加数据源图层：
- en: Click on the Open (folder) icon or go to File | Open.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击打开（文件夹）图标或转到文件 | 打开。
- en: 'Select Data Store Layer from the left-hand-side menu, as shown in the following
    screenshot:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧菜单选择数据存储图层，如下截图所示：
- en: '![](img/029250d9-fbdc-4950-bc8d-aaf2aa7904d7.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/029250d9-fbdc-4950-bc8d-aaf2aa7904d7.png)'
- en: Click on the icon to the right of the Connection dropdown to open the connection
    manager.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击连接下拉列表右侧的图标以打开连接管理器。
- en: 'Click on the Add button. This will prompt a new window to appear in which you
    must enter your database parameters:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击添加按钮。这将弹出一个新窗口，您必须在其中输入数据库参数：
- en: '![](img/686b004e-4f57-4ed4-a6f0-4df78ebe5d33.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/686b004e-4f57-4ed4-a6f0-4df78ebe5d33.png)'
- en: 'Enter a name for the connection and then enter values for the following database
    parameters:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为连接输入一个名称，然后输入以下数据库参数的值：
- en: Server/Host
  id: totrans-133
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器/主机
- en: Port
  id: totrans-134
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口
- en: Database
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据库
- en: Username
  id: totrans-136
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户名
- en: Password
  id: totrans-137
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码
- en: Then click on OK. You are now connected to the database.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后点击“确定”。现在您已连接到数据库。
- en: Check for typos and errors if a connection error message appears. If the connection
    is successful, select the connection and click on OK.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果出现连接错误消息，请检查拼写错误和错误。如果连接成功，选择连接并点击“确定”。
- en: 'Now you can select the lines table to add, as shown in the following screenshot:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您可以选择要添加的线条表，如下截图所示：
- en: '![](img/abf16c6d-9278-49e7-aa68-52a750e30f60.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/abf16c6d-9278-49e7-aa68-52a750e30f60.png)'
- en: If multiple geometry columns exist, you may choose the one you want to use.
    Add the data's state plane coordinator geometry (`geom_sp`), as shown in the *Using
    the Database Manager plugin – QGIS* recipe.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 如果存在多个几何列，您可以选择您想要使用的列。添加数据的状态平面协调几何（`geom_sp`），如*使用数据库管理器插件 – QGIS*菜谱中所示。
- en: Simple SQL `WHERE` clause statements can be used if only a subset of a table
    is needed.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 如果只需要表的一个子集，可以使用简单的SQL `WHERE`子句。
- en: 'Click on Finish to load the dataset into the main window, as shown in the following
    screenshot:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“完成”以将数据集加载到主窗口中，如下截图所示：
- en: '![](img/6dee57d2-c618-4dc4-ba0f-1c71a6072fe6.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![截图](img/6dee57d2-c618-4dc4-ba0f-1c71a6072fe6.png)'
- en: 'Now make a quick edit to the temporary layer and save it back to the database.
    Select the Editing Toolbox button. When the toolbox is loaded, click on the Select Features Tool
    button (to the top-left corner of the screen), as shown in the following screenshot:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在快速编辑临时图层并将其保存回数据库。选择编辑工具箱按钮。当工具箱加载后，点击屏幕左上角的“选择特征工具”按钮，如下截图所示：
- en: '![](img/55fcbe8d-3b95-43a2-81a8-4a3ff96e8c2d.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/55fcbe8d-3b95-43a2-81a8-4a3ff96e8c2d.png)'
- en: 'Select some of the lines, as shown in the following screenshot, that look out
    of place on the map. In particular, the lines to the North of the county; these
    actually jet out into Lake Erie. You can select multiple lines by clicking and
    dragging a rectangle with the cursor or by holding *Shift* while clicking on line
    segments. Hit the *Delete* key (or *Fn* + *Delete* on macOS) once you have selected
    some lines to remove them from the data:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一些看起来在地图上不合适的线条，如图下所示。特别是县北部的线条；这些线条实际上延伸到了伊利湖。您可以通过点击并拖动光标矩形或按住*Shift*键同时点击线段来选择多个线条。选择一些线条后，按*Delete*键（或在macOS上按*Fn*
    + *Delete*）将它们从数据中删除：
- en: '![](img/9efc1ef2-1b6c-420d-b097-328f0f90b6c9.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/9efc1ef2-1b6c-420d-b097-328f0f90b6c9.png)'
- en: Save the changes made to the layer and replace the existing table in the database
    with the edited copy. Right-click on the layer name on the left panel and then
    select Save Dataset As.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存对图层所做的更改，并将数据库中现有的表替换为编辑后的副本。在左侧面板上右键单击图层名称，然后选择“另存为数据集”。
- en: 'Select your PostGIS connection with the Connection drop-down menu, choose the
    appropriate table name, and then make sure that the Create new or replace existing table
    option is selected, as shown in the following screenshot:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用连接下拉菜单选择您的PostGIS连接，选择适当的表名，然后确保选中了“创建新表或替换现有表”选项，如图下所示：
- en: '![](img/62a54645-3a02-468e-b6bf-7d247383a221.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/62a54645-3a02-468e-b6bf-7d247383a221.png)'
- en: Click on OK; you have now successfully edited a PostGIS table in OpenJUMP.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“确定”；你现在已成功在OpenJUMP中编辑了PostGIS表。
- en: How it works...
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We added a PostGIS layer in OpenJUMP using the Open Data Store Layer menu. This
    was achieved after creating a new connection and entering our database parameters.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在OpenJUMP中使用“开放数据存储图层”菜单添加了PostGIS图层。这是在创建新连接并输入我们的数据库参数后实现的。
- en: In the example, census data was added which included the boundary of Cuyahoga
    county. Part of the boundary advances into Lake Erie to the International Boundary
    with Canada. While technically correct, the water boundary is typically not used
    for practical mapping purposes. In this case, it's easy to visualize which data
    needs to be removed.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，添加了人口普查数据，其中包括库耶霍加县的边界。边界的一部分延伸到伊利湖，与加拿大的国际边界相交。虽然技术上正确，但水边界通常不用于实际制图目的。在这种情况下，很容易可视化需要删除哪些数据。
- en: OpenJUMP allows us to easily see and delete records that should be deleted from
    the table. The selected lines were deleted, and the table was saved to the database.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: OpenJUMP使我们能够轻松地查看和删除应从表中删除的记录。选定的线条已被删除，并将表保存到数据库中。
- en: Running database queries – OpenJUMP GIS
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 运行数据库查询 – OpenJUMP GIS
- en: Executing ad hoc queries in OpenJUMP is simple and offers a couple of unique
    features. Queries can be run on specific data selections, allowing for the manual
    control of the queried area without considering the attribution. Similarly, temporary
    fences (areas) can be drawn on the fly and the geometry of the surface can be
    used in queries. In this recipe, we will explore each of those cases.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在OpenJUMP中执行即席查询简单且提供了一些独特功能。可以在特定的数据选择上运行查询，允许手动控制查询区域而不考虑属性。同样，可以即时绘制临时围栏（区域），并在查询中使用表面的几何形状。在本食谱中，我们将探索这些情况中的每一个。
- en: Getting ready
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: Refer to the preceding recipe if you need to install OpenJUMP or require assistance
    connecting to a database.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要安装OpenJUMP或需要连接到数据库的帮助，请参考前面的食谱。
- en: How to do it...
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Carry out the following steps to run the data store query:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以运行数据存储查询：
- en: Navigate to File | Run Datastore Query. Choose the PostGIS connection from the
    Connection drop-down menu or use the Connection Manager utility if you are not
    linked to the database.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到文件 | 运行数据存储查询。从连接下拉菜单中选择PostGIS连接，或者如果您未连接到数据库，请使用连接管理器实用程序。
- en: 'We''ll create and name a polygon layer of the main streams in the region by
    executing the following query:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将通过执行以下查询创建并命名该地区主要河流的多边形图层：
- en: '[PRE4]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The preceding query is shown in the following screenshot:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的查询如下截图所示：
- en: '![](img/36774018-4013-4df8-9048-67eff2866ea8.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/36774018-4013-4df8-9048-67eff2866ea8.png)'
- en: 'The preceding query selects the lines on the map that represent hydrology units
    such as `"hydroflg" = ''Y''` and streams. The selected stream lines (which use
    the State Plane geometry) are buffered by 75 feet, which should yield a result
    like that shown in the following screenshot:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 上述查询选择了地图上代表水文单元，如`"hydroflg" = 'Y'`和河流的线条。选定的河流线条（使用州平面几何）被缓冲了75英尺，应该会产生如下截图所示的结果：
- en: '![](img/4c7f1a46-5c72-4472-a90f-ac11ae8cf4b5.png)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/4c7f1a46-5c72-4472-a90f-ac11ae8cf4b5.png)'
- en: 'The `ST_Buffer` function uses the units of the data projection for buffering.
    So, if your data still has the original spatial reference *EPSG: 4269*, you will
    be buffering the lines by 75 degrees, and this will lead to very strange results
    indeed! Modify the following SQL query to transform your geometry:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`ST_Buffer`函数使用数据投影的单位进行缓冲。因此，如果你的数据仍然具有原始的空间参考*EPSG: 4269*，你将通过75度来缓冲线条，这确实会导致非常奇怪的结果！修改以下SQL查询以转换你的几何形状：'
- en: '[PRE5]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You'll then want to go back to *step 2* in order to create the buffer measured
    in feet.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你需要回到*步骤2*以创建以英尺为单位的缓冲区。
- en: Next, pan and zoom on the map and find two, separate polygons that are near
    each other.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在地图上平移和缩放，找到两个彼此靠近的独立多边形。
- en: 'Select the Fence icon on the main menu, as shown in the following screenshot:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主菜单上选择围栏图标，如下截图所示：
- en: '![](img/6c0f9e38-2199-4436-8527-70881ad927c2.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/6c0f9e38-2199-4436-8527-70881ad927c2.png)'
- en: Draw a connection (overlapping a connection is fine) between the two unconnected
    polygons using the Fence tool. Click once on the Fence button to create a vertex
    and double-click on it once your polygon is complete.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用围栏工具在两个未连接的多边形之间绘制一个连接（重叠连接是可以的）。点击一次围栏按钮来创建一个顶点，并在你的多边形完成时双击它。
- en: 'Switch over to the Select Features Tool, as shown in the following screenshot,
    and select the polygons that you drew on either side of the Fence bridge; select
    multiple features by holding down the *Shift* key:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到选择特征工具，如下截图所示，并选择你在围栏桥两侧绘制的多边形；通过按住*Shift*键选择多个特征：
- en: '![](img/ead4d152-0d8a-460b-b7b8-3e5bbbb2d13c.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/ead4d152-0d8a-460b-b7b8-3e5bbbb2d13c.png)'
- en: 'You should now have a fence junction between the selected polygons. You should
    see something similar to the following screenshot:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该在所选多边形之间有一个围栏接点。你应该看到如下截图所示的内容：
- en: '![](img/079369ca-f78e-4fc4-975d-a8aa575db4c2.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/079369ca-f78e-4fc4-975d-a8aa575db4c2.png)'
- en: Navigate to File | Run Datastore Query again.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到文件 | 再次运行数据存储查询。
- en: This time, we will utilize the buttons to the right-hand side of the window
    to connect.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这次，我们将使用窗口右侧的按钮来连接。
- en: 'Run `ST_UNION` on the selection and fence together so that the gap is filled.
    We do this with the following query:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择和围栏上一起运行`ST_UNION`以填充间隙。我们使用以下查询来完成此操作：
- en: '[PRE6]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Use the Selection and Fence buttons in place of `geom1` and `geom2` so that
    your query looks as shown in the following screenshot:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 使用选择和围栏按钮代替`geom1`和`geom2`，以便你的查询看起来如下截图所示：
- en: '![](img/8f03cb87-d1d6-4789-aefd-738e015f0c59.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8f03cb87-d1d6-4789-aefd-738e015f0c59.png)'
- en: 'Click on OK and view the query result by turning off the Main Streams and Fence
    layers, as shown in the following screenshot:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击确定，通过关闭主河流和围栏图层来查看查询结果，如下截图所示：
- en: '![](img/44d5f8e8-b118-49f1-864a-e615dc3f6166.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/44d5f8e8-b118-49f1-864a-e615dc3f6166.png)'
- en: How it works...
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We added a buffered subset of a PostGIS layer in OpenJUMP using the Run Datastore
    Query menu. We took lines from a database table and converted them to polygons
    to view them in OpenJUMP.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用运行数据存储查询菜单在OpenJUMP中添加了PostGIS图层的缓冲子集。我们从数据库表中提取了线条并将它们转换为多边形，以便在OpenJUMP中查看。
- en: We then manually selected an area of interest that had two representative stream
    polygons disjointed from one another, the idea being that the streams would be,
    or are, connected in a natural state.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们手动选择了一个感兴趣的区域，该区域有两个相互分离的代表河流多边形，其想法是河流在自然状态下是相连的，或者现在是相连的。
- en: The Fence tool was used to draw a freehand polygon between the streams. A `union`
    query was then performed to combine the two stream polygons and the fences. Fences
    allow us to create temporary tables for use in spatial queries executed against
    a database table.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 使用围栏工具在河流之间绘制了一个自由多边形。然后执行了一个`union`查询，将两个河流多边形和围栏结合起来。围栏允许我们在对数据库表执行空间查询时创建临时表。
- en: Adding PostGIS layers – gvSIG
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – gvSIG
- en: gvSIG is a GIS package developed for the **Generalitat Valenciana** (**gv**)
    in Spain. SIG is the Spanish equivalent of GIS. Intended for use all over the
    world, gvSIG is available in more than a dozen languages.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: gvSIG是为西班牙的**瓦伦西亚自治区**（**gv**）开发的GIS软件包。SIG是GIS在西班牙的对应词。适用于全球使用，gvSIG提供十多种语言的版本。
- en: Getting ready
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Installers, documentation, and more details for gvSIG can be found at the following
    website:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下网站上可以找到gvSIG的安装程序、文档以及更多详细信息：
- en: '[http://www.gvsig.org/web/](http://www.gvsig.org/web/)'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.gvsig.org/web/](http://www.gvsig.org/web/)'
- en: To download gvSIG, click on the latest version (gvSIG 2.0 at the time of writing).
    The all-included version is recommended on the gvSIG site. Be careful while selecting
    the `.exe` or `.bin` versions; otherwise, you may download the program in a language
    that you don't understand.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 要下载gvSIG，点击最新版本（撰写本文时为gvSIG 2.0）。gvSIG网站上的全包含版本推荐使用。在选择`.exe`或`.bin`版本时要小心；否则，你可能会下载到你不懂语言的程序。
- en: How to do it...
  id: totrans-200
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The GeoDB layer can be added by following the ensuing steps:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 可以按照以下步骤添加GeoDB图层：
- en: Select View as the document type in the Project manager section and then click
    on the New button. A blank view (canvas) will open.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在项目管理器部分选择文档类型为“视图”，然后点击“新建”按钮。将打开一个空白视图（画布）。
- en: 'Click on the Add Layer button on the menu bar, as shown in the following screenshot:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击菜单栏上的“添加图层”按钮，如图所示：
- en: '![](img/a5e2c537-3cae-46dd-a336-acd3587bf4f7.png)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a5e2c537-3cae-46dd-a336-acd3587bf4f7.png)'
- en: Next, select the GeoDB tab and click on the button to the right of the Choose connection
    drop-down menu.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择GeoDB选项卡，并点击“选择连接”下拉菜单右侧的按钮。
- en: 'Enter the values in Connection parameters and make sure to select PostgreSQLExplorer
    as the value for Driver, as shown in the following screenshot:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在连接参数中输入值，并确保选择“驱动程序”为PostgreSQLExplorer，如图所示：
- en: '![](img/1d20a043-6a48-4c94-94e0-fb83260c2083.png)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1d20a043-6a48-4c94-94e0-fb83260c2083.png)'
- en: 'Click on OK. All of your tables should appear in Choose table. One or many
    tables can be added at a time. You can also do the following:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“确定”。所有表格都应出现在“选择表”中。一次可以添加一个或多个表格。你还可以执行以下操作：
- en: Choose the columns you want to add in each layer
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择你想要在每个图层中添加的列
- en: Select the geometry column to be used in the event of multiple geometries being
    present
  id: totrans-210
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择在存在多个几何图形时使用的几何列
- en: Give each layer a unique name
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 给每个图层一个独特的名称
- en: Perform SQL `WHERE` clause queries to load a subset of a dataset
  id: totrans-212
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行SQL `WHERE`子句查询以加载数据集的子集
- en: 'You can see these steps performed in the following screenshot:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在以下屏幕截图中看到这些步骤的执行：
- en: '![](img/305fb5c1-1470-4063-9a0c-7a302b824ead.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![](img/305fb5c1-1470-4063-9a0c-7a302b824ead.png)'
- en: 'Click on OK when you''re ready. The data will load in the new view that was
    created, as shown in the following screenshot:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你准备好时，点击“确定”。数据将加载到新创建的视图中，如图所示：
- en: '![](img/44f295be-29df-4a8e-a4a5-200d9857c26e.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![](img/44f295be-29df-4a8e-a4a5-200d9857c26e.png)'
- en: How it works...
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 工作原理...
- en: PostGIS layers were added to gvSIG using the Add Layer menu. The GeoDB tab allowed
    us to set the PostGIS connection. After choosing a table, many options are afforded
    with gvSIG. The layer name can be aliased to something more meaningful and unnecessary
    columns can be omitted from the table.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 使用添加图层菜单将PostGIS图层添加到gvSIG。GeoDB选项卡允许我们设置PostGIS连接。选择一个表后，gvSIG提供了许多选项。图层名称可以被重命名为更有意义的内容，并且可以从表中省略不必要的列。
- en: Adding PostGIS layers – uDig
  id: totrans-219
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加PostGIS图层 – uDig
- en: 'A hallmark of the **User-friendly Desktop Internet GIS** (**uDig**) program
    built with **Eclipse** is that it can be used as a standalone application or a
    plugin for existing applications. Details on the uDig project as well as installers
    can be found at the following website:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**Eclipse**构建的**用户友好的桌面互联网GIS**（**uDig**）程序的一个特点是它可以作为一个独立的应用程序或现有应用程序的插件使用。有关uDig项目的详细信息以及安装程序，可以在以下网站上找到：
- en: '[http://udig.refractions.net/](http://udig.refractions.net/)'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://udig.refractions.net/](http://udig.refractions.net/)'
- en: Click on Downloads at the preceding website to view the list of versions and
    installers. At the time of writing, 2.0.0.RC1 is the latest stable version. uDig
    is supported by Windows, macOS X, and Linux.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 点击前述网站上的“下载”以查看版本和安装程序的列表。撰写本文时，2.0.0.RC1是最新稳定版本。uDig支持Windows、macOS X和Linux。
- en: In this recipe, we will quickly connect to a PostGIS database and then add a
    layer to uDig.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在本菜谱中，我们将快速连接到PostGIS数据库，然后向uDig添加一个图层。
- en: How to do it...
  id: totrans-224
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Carry out the following steps:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤：
- en: 'Navigate to File | New Layer from the main menu, as shown in the following
    screenshot:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主菜单导航到文件 | 新图层，如下截图所示：
- en: '![](img/813d5203-fb25-40e6-81ae-8f1217d1d59f.png)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![](img/813d5203-fb25-40e6-81ae-8f1217d1d59f.png)'
- en: 'Select PostGIS as the data source and click on the Next button to continue,
    as shown in the following screenshot:'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择PostGIS作为数据源并点击下一步按钮继续，如下截图所示：
- en: '![](img/b59fcf07-0181-4a1a-bc28-4ceb0dd852d0.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b59fcf07-0181-4a1a-bc28-4ceb0dd852d0.png)'
- en: 'Fill in your PostGIS connection parameters and then click on the Next button,
    as shown in the following screenshot:'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写您的PostGIS连接参数，然后点击下一步按钮，如下截图所示：
- en: '![](img/ab3814b1-b945-4942-a94a-c67388985bfc.png)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ab3814b1-b945-4942-a94a-c67388985bfc.png)'
- en: 'Select the target database in the Database drop-down menu. Click on the List
    button to view all of the tables from the database that have valid geometries.
    Then, check the checkboxes for one or more tables to add them as layers, as shown
    in the following screenshot:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据库下拉菜单中选择目标数据库。点击列表按钮查看数据库中所有具有有效几何形状的表。然后，勾选一个或多个表的复选框以将它们添加为图层，如下截图所示：
- en: '![](img/3a716ed5-9842-4fbe-9384-85f423e66fa4.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3a716ed5-9842-4fbe-9384-85f423e66fa4.png)'
- en: Click on Finish and your data will be loaded in the Map window.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击完成，您的数据将被加载到地图窗口中。
- en: '![](img/6607cb6b-ae14-45c9-955c-8210a672a2ef.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6607cb6b-ae14-45c9-955c-8210a672a2ef.png)'
- en: How it works...
  id: totrans-236
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The New Layer menu in uDig generates a hefty list of possible sources that can
    be added. PostGIS was set as the database and your database parameters were entered.
    uDig was then connected to the database. Clicking on List displays the total number
    of tables available in the connected database. Any number of tables can be added
    at once.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: uDig中的新图层菜单生成了一长串可能的源列表，可以添加。PostGIS被设置为数据库，并输入了您的数据库参数。随后，uDig连接到了数据库。点击列表会显示连接数据库中可用的总表数。可以一次性添加任意数量的表。
