- en: '19'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '19'
- en: Evaluating Forecast Errors—A Survey of Forecast Metrics
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估预测误差——预测度量的调查
- en: We started getting into the nuances of forecasting in the previous chapter where
    we saw how to generate multi-step forecasts. While that covers one of the aspects,
    there is another aspect of forecasting that is as important as it is confusing—*how
    to evaluate forecasts*.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一章开始探讨预测的细微差别，学习了如何生成多步预测。虽然那涵盖了一个方面，但预测的另一个方面同样重要且令人困惑——*如何评估预测*。
- en: In the real world, we generate forecasts to enable some downstream processes
    to plan better and take relevant actions. For instance, the operations manager
    at a bike rental company should decide how many bikes he should make available
    at the metro station the next day at 4 p.m. However, instead of using the forecasts
    blindly, he may want to know which forecasts he should trust and which ones he
    shouldn’t. This can only be done by measuring how good a forecast is.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在现实世界中，我们生成预测是为了让一些下游过程能够更好地规划并采取相关行动。例如，一家自行车租赁公司运营经理应决定第二天下午4点在地铁站应该提供多少辆自行车。然而，他可能并不只是盲目使用这些预测，而是希望了解哪些预测他应该相信，哪些预测不应该相信。这只能通过衡量预测的准确性来实现。
- en: We have been using a few metrics throughout the book and it is now time to get
    down into the details to understand those metrics, when to use them, and when
    to not use them. We will also elucidate a few aspects of these metrics experimentally.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在整本书中已经使用了一些度量，现在是时候深入了解这些度量，了解何时使用它们，何时不使用它们。我们还将通过实验阐明这些度量的一些方面。
- en: 'In this chapter, we will be covering these main topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下几个主要内容：
- en: Taxonomy of forecast error measures
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测误差度量的分类
- en: Investigating error measures
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 研究误差度量
- en: Experimental study of error measures
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 误差度量的实验研究
- en: Guidelines for choosing a metric
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择度量的指南
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: You will need to set up the Anaconda environment following the instructions
    in the *Preface* of the book to get a working environment with all the packages
    and datasets required for the code in this book.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要按照本书*前言*中的说明，设置 Anaconda 环境，以便获得包含本书所需的所有软件包和数据集的工作环境。
- en: 'The associated code for the chapter can be found here: [https://github.com/PacktPublishing/Modern-Time-Series-Forecasting-with-Python/tree/main/notebooks/Chapter19](https://github.com/PacktPublishing/Modern-Time-Series-Forecasting-with-Python/tree/main/notebooks/Chapter19).'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章相关的代码可以在这里找到：[https://github.com/PacktPublishing/Modern-Time-Series-Forecasting-with-Python/tree/main/notebooks/Chapter19](https://github.com/PacktPublishing/Modern-Time-Series-Forecasting-with-Python/tree/main/notebooks/Chapter19)。
- en: For this chapter, you need to run the notebooks in the `Chapters02` and `Chapter04`
    folders from the book’s GitHub repository.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，你需要运行本书 GitHub 仓库中 `Chapters02` 和 `Chapter04` 文件夹里的笔记本。
- en: Taxonomy of forecast error measures
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测误差度量的分类
- en: Measurement is the first step that leads to control and eventually improvement.
  id: totrans-15
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 测量是通向控制和最终改进的第一步。
- en: ''
  id: totrans-16
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – H. James Harrington
  id: totrans-17
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: – H. James Harrington
- en: Traditionally, in regression problems, we have very few general loss functions,
    such as the mean squared error or the mean absolute error, but when you step into
    the world of time series forecasting, you will be hit with a myriad of different
    metrics.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，在回归问题中，我们有非常少的通用损失函数，例如均方误差或平均绝对误差，但当你进入时间序列预测的领域时，你会遇到各种各样的不同度量。
- en: Since the focus of the book is on point predictions (and not probabilistic predictions),
    we will stick to reviewing point forecast metrics.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 由于本书的重点是点预测（而非概率预测），我们将专注于回顾点预测度量。
- en: 'There are a few key factors that distinguish the metrics in time series forecasting:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些关键因素区分了时间序列预测中的度量：
- en: '**Temporal relevance**: The temporal aspect of the prediction we make is an
    essential aspect of a forecasting paradigm. Metrics such as Forecast Bias and
    the tracking signal take this aspect into account.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**时间相关性**：我们所做的预测的时间维度是预测范式中的一个重要方面。像预测偏差和跟踪信号这样的度量会考虑到这一方面。'
- en: '**Aggregate metrics**: In most business use cases, we would not be forecasting
    a single time series but, rather, a set of time series, related or unrelated.
    In these situations, looking at the metrics of individual time series becomes
    infeasible. Therefore, there should be metrics that capture the idiosyncrasies
    of this mix of time series.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**聚合指标**：在大多数商业用例中，我们通常不是预测单一的时间序列，而是一组时间序列，这些序列可能相关也可能无关。在这种情况下，查看单个时间序列的指标变得不可行。因此，应该有能够捕捉这些时间序列组合特征的指标。'
- en: '**Over- or under-forecasting**: Another key concept in time series forecasting
    is over- and under-forecasting. In a traditional regression problem, we do not
    really worry whether the predictions are more than or less than expected, but
    in the forecasting paradigm, we must be careful about structural biases that always
    over- or under-forecast. This, when combined with the temporal aspect of time
    series, accumulates errors and leads to problems in downstream planning.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**过度预测或低估预测**：时间序列预测中的另一个关键概念是过度预测和低估预测。在传统的回归问题中，我们不太关心预测结果是否大于或小于预期，但在预测范式中，我们必须小心那些总是过度或低估预测的结构性偏差。当这些偏差与时间序列的时间维度相结合时，会积累错误，导致下游规划出现问题。'
- en: 'These aforementioned factors, along with a few others, have led to an explosion
    in the number of forecast metrics. In a recent survey paper by Hewamalage et al.
    (Reference *1*), the number of metrics that were covered stood at *38*. Let’s
    try and unify these metrics under some structure. *Figure 19.1* depicts a taxonomy
    of forecast error measures:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 上述因素以及其他一些因素导致了预测指标数量的爆炸性增长。在Hewamalage等人（参考文献*1*）最近的一篇调查论文中，涵盖的指标数量达到了*38*。让我们尝试将这些指标统一到某个结构下。*图19.1*展示了预测误差度量的分类法：
- en: '![Figure 18.1 – Taxonomy of forecast error measures ](img/B22389_19_01.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![图18.1 – 预测误差度量的分类法](img/B22389_19_01.png)'
- en: 'Figure 19.1: Taxonomy of forecast error measures'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.1：预测误差度量的分类法
- en: We can semantically separate the different forecast metrics into two buckets—**intrinsic**
    and **extrinsic**. *Intrinsic* metrics measure the generated forecast using nothing
    but the generated forecast and the corresponding actuals. As the name suggests,
    it is a very inward-looking metric. *Extrinsic* metrics, on the other hand, use
    an external reference or benchmark in addition to the generated forecast and ground
    truth to measure the quality of the forecast.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以语义上将不同的预测指标分为两类——**内在**和**外在**。*内在*指标仅使用生成的预测和对应的实际值来度量预测的准确性。顾名思义，这是一种非常向内看的指标。而*外在*指标则除了使用生成的预测和实际数据外，还使用外部参考或基准来衡量预测质量。
- en: Before we start with the metrics, let’s establish some notation to help us understand.
    *y*[t] and ![](img/B22389_17_033.png) are the actual observation and the forecast
    at time *t*, respectively. The forecast horizon is denoted by *H*. In cases where
    we have a dataset of time series, we assume there are *M* time series, indexed
    by *m*, and finally, ![](img/B22389_19_002.png) denotes the error at timestep
    *t*. Now, let’s start with the intrinsic metrics.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始讨论指标之前，先建立一些符号来帮助我们理解。*y*[t] 和 ![](img/B22389_17_033.png) 分别表示时间 *t* 的实际观测值和预测值。预测的时间范围用
    *H* 表示。在拥有时间序列数据集的情况下，我们假设有 *M* 个时间序列，通过 *m* 索引，最后，![](img/B22389_19_002.png)
    表示时间步 *t* 的误差。现在，让我们从内在指标开始。
- en: Intrinsic metrics
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 内在指标
- en: Intrinsic metrics are used to assess a forecast without any external information.
    These are ideal candidates for model development, hyperparameter tuning, and so
    on. That doesn’t mean we cannot use this type of metric to report performances
    to non-technical people, but it’ll have to be qualified with some other benchmark
    to show how well we are doing.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 内在指标用于评估没有任何外部信息的预测。这些是模型开发、超参数调优等的理想选择。这并不意味着我们不能使用这种类型的指标向非技术人员报告性能，但它必须通过其他基准来进行限定，以展示我们做得如何。
- en: There are four major base errors—absolute error, squared error, percent error,
    and symmetric error—that are aggregated or summarized in different ways in a variety
    of metrics. Therefore, any property of these base errors also applies to the aggregate
    ones, so let’s look at these base errors first.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 有四种主要的基础误差——绝对误差、平方误差、百分比误差和对称误差——它们以不同的方式在各种指标中被聚合或总结。因此，这些基础误差的任何属性也适用于聚合的误差，因此我们先来看看这些基础误差。
- en: Absolute error
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 绝对误差
- en: The error, *e*[t], can be positive or negative, depending on whether ![](img/B22389_19_003.png)
    or not, but then when we are calculating and adding this error over the horizon,
    the positive and negative errors may cancel each other out and that paints a rosier
    picture. Therefore, we include a function on top of *e*[t] to ensure that the
    errors do not cancel each other out.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 误差，*e*[t]，可以是正数或负数，这取决于是否 ![](img/B22389_19_003.png)，但是当我们计算并在时间范围内累加这个误差时，正负误差可能会相互抵消，从而描绘出一个过于乐观的画面。因此，我们在
    *e*[t] 上加一个函数，以确保误差不会相互抵消。
- en: 'The absolute function is one of these functions: *Absolute Error* (*AE*) =
    |*e*[t]|. The absolute error is a scale-dependent error. This means that the magnitude
    of the error depends on the scale of the time series. For instance, if you have
    an *AE* of 10, it doesn’t mean anything until you put it in context. For a time
    series with values of around 500 to 1,000, an *AE* of 10 may be a very good number,
    but if the time series has values around 50 to 70, then it is bad.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 绝对函数是以下这些函数之一：*绝对误差* (*AE*) = |*e*[t]|。绝对误差是尺度依赖性误差。这意味着误差的大小取决于时间序列的尺度。例如，如果你有一个
    *AE* 值为 10，它本身并不意味着什么，直到你把它放到上下文中来看。对于一个值在 500 到 1,000 之间的时间序列，*AE* 值为 10 可能是一个非常好的数字，但如果时间序列的值在
    50 到 70 之间，那么它就是差的。
- en: Scale dependence is not a deal breaker when we are looking at individual time
    series, but when we are aggregating or comparing across multiple time series,
    scale-dependent errors skew the metric in favor of the large-scale time series.
    The interesting thing to note here is that this is not necessarily bad. Sometimes,
    the scale in the time series is meaningful and it makes sense from the business
    perspective to focus more on the large-scale time series than the smaller ones.
    For instance, in a retail scenario, one would be more interested in getting the
    high-selling product forecast right than those of the low-selling ones. In these
    cases, using a scale-dependent error automatically favors the high-selling products.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们查看单个时间序列时，尺度依赖性并不是一个致命的问题，但当我们聚合或比较多个时间序列时，尺度依赖性误差会倾向于大规模时间序列，扭曲指标。这里需要注意的有趣一点是，这不一定是坏事。有时候，时间序列中的尺度是有意义的，从业务角度看，更关注大规模时间序列而非小规模时间序列是合理的。例如，在零售场景中，人们更愿意准确预测热销产品的销售，而不是低销量产品。在这些情况下，使用尺度依赖性误差自然会偏向于热销产品。
- en: You can see this by carrying out an experiment on your own. Generate a random
    time series, *A*. Now, similarly, generate a random forecast for the time series,
    *F*. Now, we multiply the forecast, *F*, and time series, *A*, by 100 to get two
    new time series and their forecasts, *A*[scaled] and *F*[scaled], respectively.
    If we calculate the forecast metric for both these sets of time series and forecasts,
    the scaled-dependent metrics will give very different values, whereas the scale-independent
    ones will give the same values.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过自己进行实验来验证这一点。生成一个随机时间序列，*A*。然后，同样地，生成这个时间序列的随机预测，*F*。现在，我们将预测值 *F* 和时间序列
    *A* 乘以 100，得到两个新的时间序列及其预测值，分别为 *A*[scaled] 和 *F*[scaled]。如果我们计算这两组时间序列和预测的预测指标，依赖尺度的指标会给出非常不同的值，而不依赖尺度的指标则会给出相同的值。
- en: 'Many metrics are based on this error:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 许多指标都是基于这种误差的：
- en: '![](img/B22389_19_004.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_004.png)'
- en: '**Mean Absolute Error** (**MAE**):'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均绝对误差** (**MAE**):'
- en: '**Median Absolute Error**: *MdAE* = *median*(|*e*[t]|)'
  id: totrans-40
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**中位绝对误差**：*MdAE* = *median*(|*e*[t]|)'
- en: '**Geometric Mean Absolute Error**: ![](img/B22389_19_005.png)'
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**几何平均绝对误差**：![](img/B22389_19_005.png)'
- en: '**Weighted Mean Absolute Error**: This is a more esoteric method that lets
    you put more weight on a particular timestep in the horizon:'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**加权平均绝对误差**：这是一种更为深奥的方法，允许你在时间范围内对特定的时间步加大权重：'
- en: '![](img/B22389_19_006.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_006.png)'
- en: Here, *w*[t] is the weight of a particular timestep. This can be used to assign
    more weight to special days (such as weekends or promotion days).
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*w*[t] 是特定时间步的权重。这可以用来为特殊的日子（如周末或促销日）分配更多的权重。
- en: '**Normalized Deviation** (**ND**): This is a metric that is strictly used to
    calculate aggregate measures across a dataset of time series. This is also one
    of the popular metrics used in the industry to measure aggregate performance across
    different time series. This is not scale-free and will be skewed toward large-scale
    time series. This metric has strong connections with another metric called the
    **Weighted Average Percent Error** (**WAPE**). We will discuss these connections
    when we talk about the WAPE in the following sections.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准化偏差** (**ND**)：这是一个严格用于计算时间序列数据集上聚合指标的指标。它也是行业中用于衡量不同时间序列聚合性能的流行指标之一。这个指标不是无量纲的，会倾向于较大规模的时间序列。这个指标与另一个指标——**加权平均百分比误差**
    (**WAPE**) 有着密切的联系。我们将在后续章节讨论这些联系。'
- en: 'To calculate ND, we just sum all the absolute errors across the horizons and
    time series and scale it by the actual observations across the horizons and time
    series:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 为了计算ND，我们只需将所有时间序列和时间范围内的绝对误差相加，然后通过实际观测值进行缩放：
- en: '![](img/B22389_19_007.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_007.png)'
- en: Squared error
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 平方误差
- en: 'Squaring is another function that makes the error positive and thereby prevents
    the errors from canceling each other out:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 平方是另一种将误差变为正数的函数，从而防止误差相互抵消：
- en: '![](img/B22389_19_008.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_008.png)'
- en: 'There are many metrics that are based on this error:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多基于此误差的指标：
- en: '![](img/B22389_19_009.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_009.png)'
- en: '**Mean Squared Error**:'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**均方误差**：'
- en: '**Root Mean Squared Error** (**RMSE**):'
  id: totrans-54
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**均方根误差** (**RMSE**):'
- en: '![](img/B22389_19_010.png)'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B22389_19_010.png)'
- en: '**Root Median Squared Error**:'
  id: totrans-56
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**根中位数平方误差**：'
- en: '![](img/B22389_19_011.png)'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B22389_19_011.png)'
- en: '**Geometric Root Mean Squared Error**:'
  id: totrans-58
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**几何均方根误差**：'
- en: '![](img/B22389_19_012.png)'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](img/B22389_19_012.png)'
- en: '**Normalized Root Mean Squared Error** (**NRMSE**): This is a metric that is
    very similar to ND in spirit. The only difference is that we take the square root
    of the squared errors in the numerator rather than the absolute error:'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准化均方根误差** (**NRMSE**)：这个指标与ND在本质上非常相似。唯一的区别在于，我们取的是分子中平方误差的平方根，而不是绝对误差：'
- en: '![](img/B22389_19_013.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_013.png)'
- en: Percent error
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 百分比误差
- en: 'While absolute error and squared error are scale-dependent, percent error is
    a scale-free error measure. In percent error, we scale the error using the actual
    time series observations: ![](img/B22389_19_014.png). Some of the metrics that
    use percent error are as follows:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然绝对误差和平方误差是与尺度相关的，但百分比误差是无量纲的误差度量。在百分比误差中，我们使用实际时间序列的观测值来对误差进行缩放：![](img/B22389_19_014.png)。一些使用百分比误差的指标如下：
- en: '**Mean Absolute Percent Error** (**MAPE**):'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**均值绝对百分比误差** (**MAPE**):'
- en: '![](img/B22389_19_015.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_015.png)'
- en: '**Median Absolute Percent Error**:'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**中位数绝对百分比误差**：'
- en: '![](img/B22389_19_016.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_016.png)'
- en: '**WAPE**: WAPE is a metric that embraces scale dependency and explicitly weights
    the errors with the scale of the timestep. If we want to give more focus to high
    values on the horizon, we can weigh those timesteps more than the others. Instead
    of taking a simple mean, we use a weighted mean on the absolute percent error.
    We can choose the weight to be anything but, more often than not, it is chosen
    as the quantity of the observation itself. And, in that special case, the math
    (with some assumptions) works out to be a simple formula that reminds us of ND.
    The difference is that ND is a metric that aggregates across multiple time series,
    and WAPE is a metric that weighs across timesteps:'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**WAPE**：WAPE是一个承认尺度依赖性的指标，并显式地根据时间步长的尺度加权误差。如果我们希望对时间范围内的高值给予更多关注，可以对这些时间步进行更高的加权。我们不是简单地取平均值，而是使用加权平均来计算绝对百分比误差。权重可以是任何值，但通常情况下，它会选择为观测值的数量。而在这种特殊情况下，数学运算（在某些假设下）会变成一个简单的公式，这个公式与ND类似。不同之处在于，ND是一个在多个时间序列上聚合的指标，而WAPE则是一个在时间步长上加权的指标：'
- en: '![](img/B22389_19_017.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_017.png)'
- en: Symmetric error
  id: totrans-70
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 对称误差
- en: 'Percent error has a few problems—it is asymmetrical (we will see this in detail
    later in the chapter), and it breaks down when the actual observation is zero
    (due to division by zero). Symmetric error was proposed as an alternative to avoid
    this asymmetry, but as it turns out, symmetric error is itself asymmetric—more
    on that later, but for now, let’s see what symmetric error is:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 百分比误差存在一些问题——它是不对称的（我们稍后会在本章中详细讨论），而且当实际观测值为零时，它会崩溃（因为会发生除零错误）。对称误差被提出作为一种替代方法，以避免这种不对称性，但事实证明，对称误差本身也是不对称的——稍后我们会进一步讨论这一点，但现在，让我们先了解什么是对称误差：
- en: '![](img/B22389_19_018.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_018.png)'
- en: 'There are only two metrics that are popularly used under this base error:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个基础误差下，只有两种指标是常用的：
- en: '**Symmetric Mean Absolute Percent Error** (**sMAPE**):'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对称平均绝对百分比误差** (**sMAPE**):'
- en: '![](img/B22389_19_019.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_019.png)'
- en: '**Symmetric Median Absolute Percent Error**:'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对称中位绝对百分比误差**：'
- en: '![](img/B22389_19_020.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_020.png)'
- en: Other intrinsic metrics
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 其他内在指标
- en: 'There are a few other metrics that are intrinsic in nature but don’t conform
    to the other metrics. Notable among those are three metrics that measure the over-
    or under-forecasting aspect of forecasts:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一些其他指标是内在的，但不符合其他指标的标准。最为显著的是三种衡量预测过度或不足预测的指标：
- en: '**Cumulative Forecast Error** (**CFE**): CFE is simply the sum of all the errors,
    including the sign of the error. Here, we want the positives and negatives to
    cancel each other out so that we understand whether a forecast is consistently
    over- or under-forecasting in a given horizon. A CFE close to zero means the forecasting
    model is neither over- nor under-forecasting:'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**累积预测误差** (**CFE**)：CFE 只是所有误差的总和，包括误差的符号。在这里，我们希望正负误差相互抵消，以便我们理解在给定的预测区间内，预测是持续过度预测还是不足预测。接近零的
    CFE 表示预测模型既没有过度预测，也没有不足预测：'
- en: '![](img/B22389_19_021.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_021.png)'
- en: '**Forecast Bias** (**FB**): While CFE measures the degree of over- and under-forecasting,
    it is still scale-dependent. When we want to compare across time series or have
    an intuitive understanding of the degree of over- or under-forecasting, we can
    scale CFE by the actual observations. This is called Forecast Bias:'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预测偏差** (**FB**)：虽然 CFE 衡量的是过度和不足预测的程度，但它仍然依赖于规模。当我们想要跨时间序列进行比较或直观理解过度或不足预测的程度时，可以通过实际观测值来缩放
    CFE。这就是所谓的预测偏差：'
- en: '![](img/B22389_19_022.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_022.png)'
- en: '**Tracking Signal** (**TS**): The Tracking Signal is another metric that is
    used to measure the same over- and under-forecasting in forecasts. While CFE and
    Forecast Bias are used more offline, the Tracking Signal finds its place in an
    online setting where we are tracking over- and under-forecasting over periodic
    time intervals, such as every hour or every week. It helps us detect structural
    biases in the forecasting model. Typically, the Tracking Signal is used along
    with a threshold value so that going above or below it throws a warning. Although
    a thumb rule is to use ![](img/B22389_19_023.png), it is totally up to you to
    decide the right threshold for your problem. The value 3.75 has its roots in the
    properties of normal distribution where it corresponds to a 99% confidence interval,
    which means this value is sensitive enough to trigger when there is a structural
    bias while avoiding false positives.'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**跟踪信号** (**TS**)：跟踪信号是另一个用于衡量预测中过度和不足预测的指标。虽然 CFE 和预测偏差更多地用于离线处理，但跟踪信号则适用于在线环境，在这种环境下，我们会按周期性时间间隔（如每小时或每周）跟踪过度和不足预测。它帮助我们检测预测模型中的结构性偏差。通常，跟踪信号会与一个阈值一起使用，当超过或低于该阈值时，会触发警告。虽然经验法则是使用
    ![](img/B22389_19_023.png)，但完全由你决定为你的问题选择合适的阈值。值 3.75 源自正态分布的性质，对应于 99% 的置信区间，这意味着该值足够灵敏，当存在结构性偏差时会触发警报，同时避免了假阳性。'
- en: 'But at the end of the day, this value should just be a starting point to start
    backdated tests to figure out what is the threshold that raises the right kind
    of alarms in your data:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 但归根结底，这个值应该只是一个起点，用于启动回溯测试，以找出在你的数据中引发正确警报的阈值：
- en: '![](img/B22389_19_024.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_024.png)'
- en: Here, *w* is the past window over which *TS* is calculated.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，*w* 是计算 *TS* 的过去窗口。
- en: Now, let’s turn our attention to a few extrinsic metrics.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们将注意力转向一些外部指标。
- en: Extrinsic metrics
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 外部指标
- en: Extrinsic metrics evaluate the forecast quality by comparing it not only to
    the actuals but also to some external reference or benchmark. This could be a
    baseline model, an industry standard, or a competitor’s forecast. These metrics
    are more suitable for reporting the performance of the model to non-technical
    people who can instantly get a sense of how good the model is doing. Suppose you
    have an existing forecast that you are trying to improve; using that forecast
    as a reference will instantly make your metrics interpretable.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 外部度量通过将预测结果与实际结果进行比较，并且与一些外部参考或基准进行对比来评估预测质量。这可以是一个基准模型、行业标准或竞争对手的预测。这些度量更适合向非技术人员报告模型的表现，因为他们可以立即了解模型的效果。如果你有一个现有的预测，并试图改进它，将该预测作为参考会立即让你的度量变得可解释。
- en: There are two major buckets of metrics under the extrinsic umbrella—relative
    error and scaled error.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 外部度量下有两大类度量——相对误差和缩放误差。
- en: Relative error
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 相对误差
- en: One of the problems of intrinsic metrics is that they don’t mean a lot unless
    a benchmark score exists. For instance, if we hear that the MAPE is 5%, it doesn’t
    mean a lot because we don’t know how forecastable that time series is. Maybe 5%
    is a bad error rate. Relative error solves this by including a benchmark forecast
    in the calculation so that the errors of the forecast we are measuring are measured
    against the benchmark and thus show the relative gains of the forecast. Therefore,
    in addition to the notation that we have established, we need to add some more.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 内在度量的一个问题是，除非存在基准得分，否则它们的意义不大。例如，如果我们听到 MAPE 为 5%，它的意义不大，因为我们不知道该时间序列的可预测性。也许
    5% 是一个较差的误差率。相对误差通过在计算中加入基准预测来解决这个问题，这样我们衡量的预测误差就可以与基准进行比较，从而展示预测的相对增益。因此，除了我们已经建立的符号外，我们还需要添加一些内容。
- en: 'Let ![](img/B22389_19_025.png) be the forecast from the benchmark and ![](img/B22389_19_026.png)
    be the benchmark error. There are two ways we can include the benchmark in the
    metric:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 让 ![](img/B22389_19_025.png) 为基准的预测，![](img/B22389_19_026.png) 为基准误差。我们可以通过两种方式将基准纳入度量中：
- en: Using errors from the benchmark forecast to scale the error of the forecast
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用来自基准预测的误差来缩放预测的误差
- en: Using forecast measures from the benchmark forecast to scale the forecast measure
    of the forecast we are measuring
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用来自基准预测的预测度量来缩放我们正在衡量的预测的度量
- en: 'Let’s look at a few relative errors:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一些相对误差：
- en: '**Mean Relative Absolute Error** (**MRAE**):'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均相对绝对误差**（**MRAE**）：'
- en: '![](img/B22389_19_027.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_027.png)'
- en: '**Median Relative Absolute Error**:'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**中位数相对绝对误差**：'
- en: '![](img/B22389_19_028.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_028.png)'
- en: '**Geometric Mean Relative Absolute Error**:'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**几何平均相对绝对误差**：'
- en: '![](img/B22389_19_029.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_029.png)'
- en: '**Relative Mean Absolute Error** (**RelMAE**):'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**相对平均绝对误差**（**RelMAE**）：'
- en: '![](img/B22389_19_030.png), where ![](img/B22389_19_031.png) is the MAE of
    the benchmark forecast.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B22389_19_030.png)，其中 ![](img/B22389_19_031.png) 是基准预测的 MAE。'
- en: '**Relative Root Mean Squared Error** (**RelRMSE**):'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**相对均方根误差**（**RelRMSE**）：'
- en: '![](img/B22389_19_032.png), where ![](img/B22389_19_033.png) is the RMSE of
    the benchmark forecast.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B22389_19_032.png)，其中 ![](img/B22389_19_033.png) 是基准预测的 RMSE。'
- en: '**Average Relative Mean Absolute Error**: Davydenko and Fildes (Reference *2*)
    proposed another metric that is strictly for calculating aggregate scores across
    time series. They argued that using a geometric mean over the RelMAEs of individual
    time series is better than an arithmetic mean, so they defined the Average Relative
    Mean Absolute Error as follows:'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均相对绝对误差**：Davydenko 和 Fildes（参考文献 *2*）提出了另一个度量指标，专门用于计算时间序列的汇总得分。他们认为，使用个别时间序列的相对绝对误差（RelMAE）的几何平均值比算术平均值更好，因此他们定义了平均相对绝对误差如下：'
- en: '![](img/B22389_19_034.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_034.png)'
- en: Scaled error
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 缩放误差
- en: Hyndman and Koehler introduced the idea of scaled error in 2006\. This was an
    alternative to relative error and measures and tries to get over some of the drawbacks
    and subjectivity of choosing the benchmark forecast. Scaled error scales the forecast
    error using an in-sample MAE of a benchmark method such as naïve forecasting.
    Let the entire training history be of *T* timesteps, indexed by *i*.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: Hyndman 和 Koehler 在 2006 年引入了缩放误差的概念。这是相对误差的替代方法，旨在克服选择基准预测时的一些缺点和主观性。缩放误差使用基准方法的样本内
    MAE（如天真预测）来缩放预测误差。设整个训练历史为 *T* 时间步，由 *i* 索引。
- en: 'So, the scaled error is defined as follows:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，缩放误差定义如下：
- en: '![](img/B22389_19_035.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_035.png)'
- en: 'There are a couple of metrics that adopt this principle:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 有几个度量采用了这一原则：
- en: '**Mean Absolute Scaled Error** (**MASE**):'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**均值绝对标准化误差**（**MASE**）：'
- en: '![](img/B22389_19_036.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_036.png)'
- en: '**Root Mean Squared Scaled Error** (**RMSSE**): A similar scaled error was
    developed for the squared error and was used in the M5 Forecasting Competition
    in 2020:'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**均方根标准化误差**（**RMSSE**）：为平方误差开发了一种类似的标准化误差，并在2020年的M5预测竞赛中使用：'
- en: '![](img/B22389_19_037.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_037.png)'
- en: Other extrinsic metrics
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 其他外部度量
- en: There are other extrinsic metrics that don’t fall into the categorization of
    errors we have made. One such error measure is the following.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一些不属于我们所做的误差分类的外部度量。一个这样的误差度量如下。
- en: '**Percent Better** (**PB**) is a method that is based on counts and can be
    applied to individual time series as well as a dataset of time series. The idea
    here is to use a benchmark method and count how many times a given method is better
    than the benchmark and report it as a percentage. Formally, we can define it using
    MAE as the reference error, as follows:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '**百分比改进**（**PB**）是一种基于计数的方法，可以应用于单个时间序列以及时间序列数据集。其思路是使用基准方法，并统计给定方法优于基准的次数，结果以百分比的形式报告。正式地，我们可以使用MAE作为参考误差来定义它，公式如下：'
- en: '![](img/B22389_19_038.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B22389_19_038.png)'
- en: Here, ![](img/B22389_19_039.png) is an indicator function that returns 1 if
    the condition is true and 0 otherwise.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，![](img/B22389_19_039.png)是一个指示函数，如果条件为真，则返回1，否则返回0。
- en: We have seen a lot of metrics in the previous sections, but now it’s time to
    understand a bit more about the way they work and what they are suited for.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在前面的章节中看到了很多度量，现在是时候进一步理解它们的工作原理以及它们适用的场景了。
- en: Investigating the error measures
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调查误差度量
- en: It’s not enough to just know the different metrics; we also need to understand
    how these work, what are they good for, and what are they not good for. We can
    start with the basic errors and work our way up because understanding the properties
    of basic errors such as *absolute error*, *squared error*, *percent error*, and
    *symmetric error* will help us understand the others as well, as most of the other
    metrics are derivatives of these primary errors, either aggregating them or using
    relative benchmarks.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 仅仅知道不同的度量是不够的；我们还需要理解它们是如何工作的，适用于什么场景，哪些不适用。我们可以从基本误差开始，逐步了解，因为理解*绝对误差*、*平方误差*、*百分比误差*和*对称误差*等基本误差的性质，也有助于我们理解其他度量，因为大多数其他度量都是这些基础误差的派生，或者是通过聚合它们或使用相对基准来计算的。
- en: Let’s do this investigation using a few experiments and understand them through
    the results.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过一些实验来进行调查，并通过结果来理解它们。
- en: '**Notebook alert:**'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '**笔记本警告：**'
- en: The notebook for running these experiments on your own is `01-Loss_Curves_and_Symmetry.ipynb`
    in the `Chapter19` folder.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 用于自行运行这些实验的笔记本是`01-Loss_Curves_and_Symmetry.ipynb`，位于`Chapter19`文件夹中。
- en: Loss curves and complementarity
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 损失曲线和互补性
- en: All these base errors depend on two factors—forecasts and actual observations.
    We can examine the behavior of these metrics if we fix one and alter the other
    in a symmetric range of potential errors. The expectation is that the metric will
    behave the same way on both sides because deviation from the actual observation
    on either side should be equally penalized in an unbiased metric. We can also
    swap the forecasts and actual observations; that also should not affect the metric.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些基础误差都依赖于两个因素——预测值和实际观测值。我们可以通过固定一个并改变另一个，在对称的潜在误差范围内检查这些度量的行为。预期是度量在两侧的表现应该相同，因为在任何一侧偏离实际观测值都应该在无偏度量中受到同样的惩罚。我们还可以交换预测值和实际观测值；这同样不应影响度量。
- en: In the notebook, we did exactly these experiments—loss curves and complementary
    pairs.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在笔记本中，我们进行了这些实验——损失曲线和互补对。
- en: Absolute error
  id: totrans-133
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 绝对误差
- en: 'When we plot these for absolute error, we get *Figure 19.2*:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们绘制这些绝对误差时，得到的图形是*图 19.2*：
- en: '![A graph of error and error  Description automatically generated with medium
    confidence](img/B22389_19_02.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![A graph of error and error  Description automatically generated with medium
    confidence](img/B22389_19_02.png)'
- en: 'Figure 19.2: The loss curves and complementary pairs for absolute error'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.2：绝对误差的损失曲线和互补对
- en: The first chart plots the signed error against the absolute error and the second
    one plots the absolute error with all the combinations of actuals and forecast,
    which add up to 10\. The two charts are obviously symmetrical, which means that
    an equal deviation from the actual observed on either side is penalized equally,
    and if we swap the actual observation and the forecast, the metric remains unchanged.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 第一张图将带符号的误差与绝对误差进行了绘制，第二张图则将绝对误差与所有实际值和预测值的组合绘制出来，这些组合加起来为 10。两张图显然是对称的，这意味着偏离实际值的误差在两侧受到相同的惩罚，如果我们交换实际观察值和预测值，指标保持不变。
- en: Squared error
  id: totrans-138
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 平方误差
- en: 'Now, let’s look at the squared error:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来看一下平方误差：
- en: '![Figure 18.3 – The loss curves and complementary pairs for squared error ](img/B22389_19_03.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.3 – 平方误差的损失曲线和互补对](img/B22389_19_03.png)'
- en: 'Figure 19.3: The loss curves and complementary pairs for squared error'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.3：平方误差的损失曲线和互补对
- en: These charts also look symmetrical, so the squared error also doesn’t have an
    issue with asymmetric error distribution—but we can notice one thing here. The
    squared error increases exponentially as the error increases. This points to a
    property of the squared error—it gives undue weightage to outliers. If there are
    a few timesteps for which the forecast is really bad and excellent at all other
    points, the squared error inflates the impact of those outlying errors.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 这些图表看起来也有对称性，因此平方误差也不存在不对称的误差分布问题——但我们在这里注意到一件事。平方误差随着误差增大而呈指数增长。这揭示了平方误差的一个特性——它对离群值赋予了过高的权重。如果有一些时间步长的预测非常差，而其他所有时间点的预测都非常好，平方误差就会膨胀这些离群误差的影响。
- en: Percent error
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 百分比误差
- en: 'Now, let’s look at the percent error:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来看一下百分比误差：
- en: '![Figure 18.4 – The loss curves and complementary pairs for percent error ](img/B22389_19_04.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.4 – 百分比误差的损失曲线和互补对](img/B22389_19_04.png)'
- en: 'Figure 19.4: The loss curves and complementary pairs for percent error'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.4：百分比误差的损失曲线和互补对
- en: There goes our symmetry. The percent error is symmetrical when you move away
    from the actuals on both sides (mostly because we are keeping the actuals constant),
    but the complementary pairs tell us a whole different story. When the actual is
    1 and the forecast is 9, the percent error is 8, but when we swap them, the percent
    error drops to 1\. This kind of asymmetry can cause the metric to favor under-forecasting.
    The right half of the second chart in *Figure 19.4* are all cases where we are
    under-forecasting and we can see that the error is very low there when compared
    to the left half.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的对称性就这样消失了。当你从实际值向两侧偏移时，百分比误差是对称的（主要是因为我们保持实际值不变），但互补对给我们讲述了完全不同的故事。当实际值是
    1 而预测值是 9 时，百分比误差为 8，但当我们交换它们时，百分比误差降至 1。这样的不对称性可能导致指标偏向低估预测。在*图 19.4*的第二张图的右半部分，都是低估预测的情况，我们可以看到，与左半部分相比，那里的误差非常小。
- en: We will look at under- and over-forecasting in detail in another experiment.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在另一个实验中详细查看低估和高估预测。
- en: Symmetric error
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 对称误差
- en: 'For now, let’s move on and look at the last error we had—the symmetric error:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们继续，看看我们遇到的最后一种误差——对称误差：
- en: '![Figure 18.5 – The loss curves and complementary pairs for symmetric error
    ](img/B22389_19_05.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.5 – 对称误差的损失曲线和互补对](img/B22389_19_05.png)'
- en: 'Figure 19.5: The loss curves and complementary pairs for symmetric error'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.5：对称误差的损失曲线和互补对
- en: Symmetric error was proposed mainly because of the asymmetry we saw in the percent
    error. MAPE, which uses percent error, is one of the most popular metrics used,
    and sMAPE was proposed to directly challenge and replace MAPE. True to its claim,
    it did resolve the asymmetry that was present in percent error. However, it introduced
    its own asymmetry. In the first chart, we can see that for a particular actual
    value, if the forecast moves on either side, it is penalized differently, so in
    effect, this metric favors over-forecasting (which is in direct contrast to percent
    error, which favors under-forecasting).
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 提出对称误差主要是因为我们在百分比误差中看到的不对称性。使用百分比误差的 MAPE 是最流行的指标之一，而 sMAPE 的提出就是为了直接挑战并取代 MAPE。正如它所声称的那样，它确实解决了百分比误差中存在的不对称性。然而，它也引入了自身的不对称性。在第一张图中，我们可以看到，对于特定的实际值，如果预测值在两侧移动，受到的惩罚是不同的，因此，实际上，这个指标偏向高估预测（这与百分比误差偏向低估预测正好相反）。
- en: Extrinsic errors
  id: totrans-154
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 外部误差
- en: 'With all the intrinsic measures done, we can also take a look at the extrinsic
    ones. With extrinsic measures, plotting the loss curves and checking symmetry
    is not as easy. Instead of two variables, we now have three—the actual observation,
    the forecast, and the reference forecast. The value of the measure can vary with
    any of these. We can use a contour plot for this, as shown in *Figure 19.6*:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 完成所有内在度量之后，我们也可以看看外在度量。对于外在度量，绘制损失曲线并检查对称性并不容易。我们不再仅有两个变量，而是有三个——实际观测值、预测值和参考预测值。度量的值可以随着这些变量中的任何一个变化。我们可以使用等高线图来展示这一点，如*图19.6*所示：
- en: '![Figure 18.6 – Contour plot of the loss surface – relative absolute error
    and absolute scaled error ](img/B22389_19_06.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![图18.6 – 损失表面的等高线图 – 相对绝对误差和绝对缩放误差](img/B22389_19_06.png)'
- en: 'Figure 19.6: Contour plot of the loss surface—relative absolute error and absolute
    scaled error'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.6：损失表面的等高线图—相对绝对误差和绝对缩放误差
- en: The contour plot enables us to plot three dimensions in a 2D plot. The two dimensions
    (error and reference forecast) are on the *x*- and *y*-axes. The third dimension
    (the relative absolute error and absolute scaled error values) is represented
    as color (refer to the color images file:[https://packt.link/gbp/9781835883181](https://packt.link/gbp/9781835883181)),
    with contour lines bordering same-colored areas. The errors are symmetric around
    the error (horizontal) axis. This means that if we keep the reference forecast
    constant and vary the error, both measures vary equally on both sides of the errors.
    This is not surprising since both these errors have their base in absolute error,
    which we know was symmetric.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 等高线图使我们能够在2D图中绘制三维数据。两个维度（误差和参考预测）位于*X*轴和*Y*轴上。第三个维度（相对绝对误差和绝对缩放误差值）则通过颜色表示（参考颜色图像文件：[https://packt.link/gbp/9781835883181](https://packt.link/gbp/9781835883181)），等高线将同色区域分开。误差围绕误差（水平）轴对称。这意味着，如果我们保持参考预测不变并改变误差，两个度量在误差两侧变化的幅度是一样的。这并不令人惊讶，因为这两个误差都源于绝对误差，而我们知道绝对误差是对称的。
- en: The interesting observation is the dependency on the reference forecast. We
    can see that for the same error, a *relative absolute error* has different values
    for different reference forecasts, but the *scaled error* doesn’t have this problem.
    This is because it is not directly dependent on the reference forecast and rather
    uses the MAE of a naïve forecast. This value is fixed for a time series and eliminates
    the task of choosing a reference forecast. Therefore, scaled error has good symmetry
    for absolute error and very little or fixed dependency on the reference forecast.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣的观察是对参考预测的依赖性。我们可以看到，对于相同的误差，*相对绝对误差*在不同的参考预测下具有不同的值，但*缩放误差*则没有这个问题。这是因为它不直接依赖于参考预测，而是使用了天真的预测的MAE（平均绝对误差）。这个值对于一个时间序列是固定的，消除了选择参考预测的任务。因此，缩放误差对于绝对误差具有良好的对称性，并且对参考预测的依赖性很小或是固定的。
- en: Bias toward over- or under-forecasting
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 偏向于过度预测或不足预测
- en: We have seen indications of bias toward over- or under-forecasting in a few
    metrics that we looked at. In fact, it looked like the popular metric, MAPE, favors
    under-forecasting. To finally put that to the test, we can perform another experiment
    with synthetically generated time series; we included a lot more metrics in this
    experiment so that we know which are safe to use and which need to be looked at
    carefully.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在查看的一些指标中看到了偏向过度预测或不足预测的迹象。事实上，看起来流行的指标MAPE倾向于不足预测。为了最终验证这一点，我们可以用合成生成的时间序列进行另一个实验；在这个实验中，我们包含了更多的指标，这样我们就能知道哪些指标是安全的，哪些需要仔细查看。
- en: '**Notebook alert:**'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '**笔记本警告：**'
- en: The notebook to run these experiments on your own is `02-Over_and_Under_Forecasting.ipynb`
    in the `Chapter19` folder.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在`Chapter19`文件夹中的`02-Over_and_Under_Forecasting.ipynb`笔记本上运行这些实验。
- en: 'The experiment is simple and detailed as follows:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 实验简单且详细，步骤如下：
- en: 'We randomly sample a count time series of integers with a length of 100 from
    a uniform distribution between `2` and `5`:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们从一个均匀分布中随机抽取一个长度为100的整数计数时间序列，范围在`2`到`5`之间：
- en: '[PRE0]'
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'We use the same process to generate a forecast, which is also drawn from a
    uniform distribution between `2` and `5`:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们使用相同的过程生成预测值，该值也是从`2`到`5`之间的均匀分布中抽取的：
- en: '[PRE1]'
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, we generate two additional forecasts, one from the uniform distribution
    between `0` to `4` and another between `3` and `7`. The former predominantly under-forecasts
    and the latter over-forecasts:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们生成两个额外的预测，一个是从`0`到`4`的均匀分布，另一个是从`3`到`7`的均匀分布。前者主要低估预测，后者则是过度预测：
- en: '[PRE2]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We calculate all the measures we want to investigate using all three forecasts.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们使用所有三种预测计算我们要调查的所有度量。
- en: We repeat it 10,000 times to average out the effect of random draws.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们重复实验10,000次，以平衡随机抽样的影响。
- en: 'After the experiment is done, we can plot a box plot of different metrics so
    that it shows the distribution of each metric for each of those three forecasts
    over these 10,000 runs of the experiment. Let’s see the box plot in *Figure 19.7*:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 实验完成后，我们可以绘制不同度量的箱型图，展示每个度量在这三种预测中，经过10,000次实验运行后的分布情况。让我们看看*图19.7*中的箱型图：
- en: '![Figure 18.7 – Over- and under-forecasting experiment ](img/B22389_19_07.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![图18.7 – 过度预测与低估预测实验](img/B22389_19_07.png)'
- en: 'Figure 19.7: Over- and under-forecasting experiment'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图19.7：过度预测与低估预测实验
- en: Let’s go over what we would expect from this experiment first. The over- (green)
    and under- (red) forecasted forecasts would have a higher error than the baseline
    (blue). The over- and under-forecasted errors would be similar.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先讨论一下我们期望从这个实验中得到的结果。过度预测（绿色）和低估预测（红色）的误差将大于基线（蓝色）。过度预测和低估预测的误差应该是相似的。
- en: 'With that, let’s summarize our major findings:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 总结一下我们的主要发现：
- en: MAPE clearly favors the under-forecasted with a lower MAPE than the over-forecasted.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MAPE明显偏向低估预测，其MAPE值低于过度预测的MAPE值。
- en: WAPE, although based on percent error, managed to get over the problem by having
    explicit weighting. This may be counteracting the bias that percent error has.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WAPE，尽管基于百分比误差，但通过明确的加权方式克服了这一问题。这可能抵消了百分比误差所带来的偏差。
- en: sMAPE, in its attempt to fix MAPE, does a worse job in the opposite direction.
    sMAPE highly favors over-forecasting.
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: sMAPE在尝试修正MAPE时，反而在相反方向上表现得更差。sMAPE强烈偏向于过度预测。
- en: Metrics such as MAE and RMSE, which are based on absolute error and squared
    error, respectively, don’t show any preference for either over- or under-forecasting.
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于绝对误差和平方误差的度量（如MAE和RMSE）不会偏向过度预测或低估预测。
- en: MASE and RMSSE (both using versions of scaled error) are also fine.
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MASE和RMSSE（都使用了尺度误差的版本）也表现良好。
- en: MRAE, in spite of some asymmetry regarding the reference forecast, turns out
    to be unbiased from the over- and under-forecasting perspective.
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MRAE，尽管在参考预测方面存在一些不对称性，但从过度预测和低估预测的角度来看，结果是无偏的。
- en: The relative measures with absolute and squared error bases (RelMAE and RelRMSE)
    also do not have any bias toward over- or under-forecasting.
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于绝对误差和平方误差的相对度量（RelMAE和RelRMSE）也没有对过度预测或低估预测产生偏向。
- en: The relative measure of mean absolute percentage error, RelMAPE, carries MAPE’s
    bias toward under-forecasting.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均绝对百分比误差的相对度量RelMAPE，继承了MAPE对低估预测的偏向。
- en: We have investigated a few properties of different error measures and understood
    the basic properties of some of them. To further that understanding and move closer
    to helping us select the right measure for our problem, let’s do one more experiment
    using the London Smart Meters dataset we have been using through this book.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经调查了不同错误度量的几个特性，并理解了其中一些度量的基本特性。为了进一步理解并帮助我们选择适合我们问题的度量，让我们做一个使用本书中一直使用的伦敦智能电表数据集的实验。
- en: Experimental study of the error measures
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 错误度量的实验研究
- en: As we discussed earlier, there are a lot of metrics for forecasting that people
    have come up with over the years. Although there are many different formulations
    of these metrics, there can be similarities in what they are measuring. Therefore,
    if we are going to choose a primary and secondary metric while modeling, we should
    pick some metrics that are diverse and measure different aspects of the forecast.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前讨论的那样，过去几年里，许多人提出了许多不同的预测度量。尽管这些度量有许多不同的公式，但它们所衡量的内容可能是相似的。因此，如果我们在建模时要选择一个主要和次要度量，我们应当选择一些多样的度量，涵盖预测的不同方面。
- en: 'Through this experiment, we are going to try and figure out which of these
    metrics are similar to each other. We are going to use the subset of the *London
    Smart Meters* dataset we have been using all through the book and generate some
    forecasts for each household. I chose to do this exercise with the `darts` library
    because I wanted multi-step forecasting. I used five different forecasting methods—seasonal
    naïve, exponential smoothing, Theta, FFT, and LightGBM (local)—and generated forecasts.
    On top of that, I also calculated the following metrics on all of these forecasts:
    MAPE, WAPE, sMAPE, MAE, MdAE, MSE, RMSE, MRAE, MASE, RMSSE, RelMAE, RelRMSE, RelMAPE,
    CFE, Forecast Bias, and PB(MAE). In addition to this, we also calculated a few
    aggregate metrics: meanMASE, meanRMSSE, meanWAPE, meanMRAE, AvgRelRMSE, ND, and
    NRMSE.'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这个实验，我们将尝试找出这些指标之间的相似性。我们将使用本书中一直使用的*伦敦智能电表*数据集的一个子集，并为每个家庭生成一些预测。我选择使用 `darts`
    库进行这个练习，因为我想进行多步预测。我使用了五种不同的预测方法——季节性朴素法、指数平滑法、Theta、FFT 和 LightGBM（本地）——并生成了预测。除此之外，我还对所有这些预测计算了以下指标：MAPE、WAPE、sMAPE、MAE、MdAE、MSE、RMSE、MRAE、MASE、RMSSE、RelMAE、RelRMSE、RelMAPE、CFE、预测偏差和
    PB(MAE)。除了这些，我们还计算了几个汇总指标：meanMASE、meanRMSSE、meanWAPE、meanMRAE、AvgRelRMSE、ND 和
    NRMSE。
- en: Using Spearman’s rank correlation
  id: totrans-190
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Spearman 等级相关性
- en: The basis of the experiment is that if different metrics measure the same underlying
    factor, then they will also rank forecasts on different households similarly.
    For instance, if we say that MAE and MASE are measuring one latent property of
    the forecast, then those two metrics would give similar rankings to different
    households. At the aggregated level, there are five different models and aggregate
    metrics that measure the same underlying latent factor and should also rank them
    in similar ways.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 实验的基础是，如果不同的指标度量相同的潜在因子，那么它们也会在不同的家庭中对预测进行相似的排名。例如，如果我们说 MAE 和 MASE 测量的是预测的一个潜在属性，那么这两个指标会对不同家庭给出相似的排名。在汇总层面上，有五个不同的模型和汇总指标，它们度量相同的潜在因子，也应该以相似的方式对它们进行排名。
- en: 'Let’s look at the aggregate metrics first. We ranked the different forecast
    methods at the aggregate level using each of the metrics and then we calculated
    the Pearson correlation of the ranks. This gives us Spearman’s rank correlation
    between the forecasting methods and metrics. The heatmap (refer to the color images
    file:[https://packt.link/gbp/9781835883181](https://packt.link/gbp/9781835883181))
    of the correlation matrix is in *Figure 19.8*:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先看看汇总指标。我们使用每个指标在汇总层面上对不同的预测方法进行了排名，然后计算了排名的 Pearson 相关性。这给我们提供了预测方法和指标之间的
    Spearman 等级相关性。相关性矩阵的热图（请参见彩色图片文件：[https://packt.link/gbp/9781835883181](https://packt.link/gbp/9781835883181)）在*图
    19.8*中：
- en: '![Figure 18.8 – Spearman’s rank correlation between the forecast methods and
    aggregate metrics ](img/B22389_19_08.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.8 – 预测方法与汇总指标之间的 Spearman 等级相关性](img/B22389_19_08.png)'
- en: 'Figure 19.8: Spearman’s rank correlation between the forecast methods and aggregate
    metrics'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.8：预测方法与汇总指标之间的 Spearman 等级相关性
- en: 'These are the major observations:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 主要的观察结论如下：
- en: We can see that *meanMASE*, *meanWAPE,* and *ND* (all based on absolute error)
    are highly correlated, indicating that they might be measuring similar latent
    factors of the forecast.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以看到，*meanMASE*、*meanWAPE* 和 *ND*（都基于绝对误差）高度相关，表明它们可能在测量预测的相似潜在因子。
- en: The other pair that is highly correlated is *meanRMSSE* and *NRMSE*, which are
    both based on squared error.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 另一个高度相关的指标对是*meanRMSSE*和*NRMSE*，它们都基于平方误差。
- en: There is a weak correlation between *meanMASE* and *meanRMSSE*, maybe because
    they are both using scaled error.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*meanMASE* 和 *meanRMSSE* 之间有弱相关性，可能是因为它们都使用了缩放误差。'
- en: '*meanMRAE* and *Forecast Bias* seem to be highly correlated, although there
    is no strong basis for that shared behavior. Some correlations can be because
    of chance and this needs to be validated further on more datasets.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*meanMRAE* 和 *预测偏差* 似乎高度相关，尽管没有强有力的依据表明它们有共同的行为。这些相关性可能是偶然的，需要在更多数据集上进一步验证。'
- en: '*meanMRAE* and *AvgRelRMSE* seem to be measuring very different latent factors
    from the rest of the metrics and each other.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*meanMRAE* 和 *AvgRelRMSE* 似乎测量的是与其他指标和彼此非常不同的潜在因子。'
- en: 'Similarly, we calculated Spearman’s rank correlation between the forecast methods
    and metrics across all the households (*Figure 19.9*). This enables us to have
    the same kind of comparison as before at the item level:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，我们计算了所有家庭之间预测方法与度量标准的斯皮尔曼秩相关系数（*图 19.9*）。这使我们能够在项目级别进行与之前相同的比较：
- en: '![Figure 18.9 – Spearman’s rank correlation between the forecast methods and
    item-level metrics ](img/B22389_19_09.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.9 – 预测方法与项目级度量标准之间的斯皮尔曼秩相关系数](img/B22389_19_09.png)'
- en: 'Figure 19.9: Spearman’s rank correlation between the forecast methods and item-level
    metrics'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19.9：预测方法与项目级度量标准之间的斯皮尔曼秩相关系数
- en: 'The major observations are as follows:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 主要观察结果如下：
- en: We can see there are five clusters of highly correlated metrics (the five darker
    green boxes).
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以看到，有五个高度相关的度量标准簇（五个较深的绿色框）。
- en: The first group is *MASE* and *RMSSE*, which are highly correlated. This can
    be because of the scaled error formulation of both metrics.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一组是 *MASE* 和 *RMSSE*，它们高度相关。这可能是因为这两个度量标准都采用了比例误差公式。
- en: '*WAPE*, *MAPE*, and *sMAPE* are the second group. Frankly, this is a bit confusing
    because I would have expected *MAPE* and *sMAPE* to have less correlated results.
    They do behave in the opposite way from an over- and under-forecasting perspective.
    Maybe all the forecasts we have used to check this correlation don’t over- or
    under-forecast and, therefore, the similarity came out through the shared percent
    error base. This needs to be investigated further.'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*WAPE*、*MAPE* 和 *sMAPE* 是第二组。坦白说，这有点让人困惑，因为我本以为 *MAPE* 和 *sMAPE* 的相关性较低。它们确实从过度预测和欠预测的角度表现得相反。也许我们用来检查这个相关性的所有预测都没有出现过度或欠预测，因此相似性通过共享的百分比误差基础显现出来。这需要进一步调查。'
- en: '*MAE*, *MdAE*, *MSE*, and *RMSE* form the third group of highly similar metrics.
    *MAE* and *MdAE* are both absolute error metrics and *MSE* and *RMSE* are both
    squared error metrics. The similarity between these two could be because of the
    lack of outlying errors in the forecasts. The only difference between these two
    base errors is that the squared error puts a much greater weight on outlying errors.'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*MAE*、*MdAE*、*MSE* 和 *RMSE* 形成了第三组高度相似的度量标准。*MAE* 和 *MdAE* 都是绝对误差度量，而 *MSE*
    和 *RMSE* 都是平方误差度量。它们之间的相似性可能是因为预测中没有异常误差。这两种基本误差的唯一区别在于，平方误差对异常误差赋予了更大的权重。'
- en: The next group of similar metrics is the motley crew of relative measures—*MRAE,*
    *RelMAE*, *RelRMSE*, *RelMAPE*, and *PB(MAE)*—but the intercorrelation among this
    group is not as strong as the other groups. The pairs of metrics that stand out
    in terms of having low inter-correlations are *MRAE* and *RelRMSE* and *RelMAPE*
    and *RelRMSE*.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下一个类似度量标准的组合是各种相对度量——*MRAE*、*RelMAE*、*RelRMSE*、*RelMAPE* 和 *PB(MAE)*——但该组之间的相关性不如其他组强。相关性较低的度量标准对是
    *MRAE* 和 *RelRMSE* 以及 *RelMAPE* 和 *RelRMSE*。
- en: The last group that stands totally apart with much less correlation with any
    other metric but a higher correlation with each other is *Forecast Bias* and *CFE*.
    Both are calculated on unsigned errors and measure the amount of over- or under-forecasting.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后一组与其他任何度量标准的相关性较低，但彼此之间的相关性较高的是 *预测偏差* 和 *CFE*。这两个度量标准都是基于无符号误差计算的，衡量的是过度预测或欠预测的程度。
- en: If we look at intergroup similarities, the only thing that stands out is the
    similarity between the scaled error group and absolute error and squared error
    group.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们查看组间相似性，唯一突出的是比例误差组与绝对误差和平方误差组之间的相似性。
- en: Spearman’s rank correlation on aggregate metrics is done using a single dataset
    and has to be taken with a grain of salt. The item-level correlation has a bit
    more significance because it is made across many households, but there are still
    a few things in there that warrant further investigation. I urge you to repeat
    this experiment on some other datasets and check whether you see the same patterns
    repeated before adopting them as rules.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在聚合度量上的斯皮尔曼秩相关性是使用单一数据集计算的，需要谨慎对待。项目级别的相关性具有更大的意义，因为它是基于多个家庭的数据进行计算的，但其中仍有一些内容值得进一步调查。我建议你在其他数据集上重复这个实验，检查是否看到相同的模式再将其作为规则采用。
- en: Now that we have explored the different metrics, it is time to summarize and
    leave you with a few guidelines for choosing a metric.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经探讨了不同的度量标准，是时候总结一下，并给出一些选择度量标准的指南了。
- en: Guidelines for choosing a metric
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 选择度量标准的指南
- en: Throughout this chapter, we have come to understand that it is difficult to
    choose one forecast metric and apply it universally. There are advantages and
    disadvantages for each metric, and being cognizant of these while selecting a
    metric is the only rational way to go about it.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们逐渐认识到，选择一个预测指标并普遍适用是困难的。每个指标都有其优缺点，选择指标时意识到这些优缺点才是唯一理性的做法。
- en: 'Let’s summarize and note a few points we have seen through different experiments
    in the chapter:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们总结一下，并记录在本章中通过不同实验得出的一些要点：
- en: Absolute error and squared error are both symmetric losses and are unbiased
    from the under- or over-forecasting perspective.
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绝对误差和平方误差都是对称损失，且在低估或高估的角度上是无偏的。
- en: Squared error does have a tendency to magnify the outlying error because of
    the square term in it. Therefore, if we use a squared-error-based metric, we will
    be penalizing high errors much more than small errors.
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平方误差确实有放大离群误差的倾向，因为其中包含平方项。因此，如果我们使用基于平方误差的指标，我们将比小误差更大幅度地惩罚高误差。
- en: RMSE is generally preferred over MSE because RMSE is on the same scale as the
    original input and, therefore, is a bit more interpretable.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RMSE 通常优于 MSE，因为 RMSE 与原始输入在同一尺度上，因此它的解释性更强。
- en: Percent error and symmetric error are not symmetric in the complete sense and
    favor under-forecasting and over-forecasting, respectively. MAPE, which is a very
    popular metric, is plagued by this shortcoming. For instance, if we are forecasting
    demand, optimizing for MAPE will lead you to select a forecast that is conservative
    and, therefore, under-forecast. This will lead to an inventory shortage and out-of-stock
    situations. sMAPE, with all its shortcomings, has fallen out of favor with practitioners.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 百分比误差和对称误差并非在完整意义上是对称的，分别偏向低估和高估。MAPE，作为一种非常流行的指标，存在这一缺点。例如，如果我们在进行需求预测，优化 MAPE
    会导致你选择一个保守的预测，从而低估预测值。这将导致库存短缺和缺货情况。尽管存在各种缺点，sMAPE 目前已不再受到实践者的青睐。
- en: Relative measures are a good alternative to percent-error-based metrics because
    they are also inherently interpretable, but relative measures depend on the quality
    of the benchmark method. If the benchmark method performs poorly, the relative
    measures will tend to dampen the impact of errors from the model under evaluation.
    On the other hand, if the benchmark forecast is close to an oracle forecast with
    close to zero errors, the relative measure will exaggerate the errors of the model.
    Therefore, you have to be careful when choosing the benchmark forecast, which
    is an additional thing to worry about.
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相对度量是一个很好的替代百分比误差基础的指标，因为它们也本质上是可解释的，但相对度量依赖于基准方法的质量。如果基准方法表现不佳，相对度量将倾向于减弱模型的误差影响。另一方面，如果基准预测接近近乎零误差的
    oracle 预测，相对度量将夸大模型的误差。因此，在选择基准预测时必须小心，这是一个额外的考虑因素。
- en: Although a geometric mean offers a few advantages over an arithmetic mean (such
    as resistance to outliers and better approximation when there is high variation
    in data), it is not without its own problems. Geometric mean-based measures mean
    that even if a single series (when aggregating across time series) or a single
    timestep (when aggregating across timesteps) performs really well, it will make
    the overall error come down drastically due to the multiplication.
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽管几何平均数相较于算术平均数有一些优点（例如对离群值的抵抗力和在数据变化剧烈时的更好近似），它也并非没有自身的问题。基于几何平均数的度量意味着，即使单一系列（在聚合时间序列时）或单一时间步（在聚合时间步时）表现得非常好，由于乘法效应，整体误差将大幅下降。
- en: PB, although an intuitive metric, has one disadvantage. We are simply counting
    the instances in which we perform better. However, it doesn’t assess how well
    or poorly we are doing. The effect on the PB score is the same, whether our error
    is 50% less than the reference error or 1% less.
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PB，尽管是一个直观的指标，但有一个缺点。我们仅仅是在计算我们表现更好的实例次数。然而，它并没有评估我们做得好或不好的程度。无论我们的误差比参考误差低
    50% 还是 1%，对 PB 得分的影响是一样的。
- en: 'Hewamalage et al. (Reference *1*) have proposed a very detailed flowchart to
    aid in decision-making, but that is also more of a guideline as to what not to
    use. The selection of a single metric is a very debatable task. There are a lot
    of conflicting opinions out there and I’m just adding another to that noise. Here
    are a few guidelines I propose to help you pick a forecasting metric:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: Hewamalage等人（参考文献*1*）提出了一张非常详细的流程图，帮助决策，但这也更像是一个关于什么不应该使用的指南。选择单一的指标是一个非常有争议的任务。关于这一点有很多相互矛盾的观点，我仅仅是其中的一个声音。以下是我提出的几条建议，帮助你选择合适的预测指标：
- en: Avoid *MAPE*. In any situation, there is always a better metric to measure what
    you want. At the very least, stick to *WAPE* for single time series datasets.
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免使用*MAPE*。无论在哪种情况下，总有更好的指标来衡量你想要的结果。至少，单一时间序列数据集要坚持使用*WAPE*。
- en: For a single time series dataset, the best metrics to choose are *MAE* or *RMSE*
    (depending on whether you want to penalize large errors more or not).
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于单一时间序列数据集，最佳的选择指标是*MAE*或*RMSE*（取决于你是否希望更多地惩罚较大的误差）。
- en: For multiple time series datasets, use *ND* or *NRMSSE* (depending on whether
    you want to penalize large errors more or not). As a second choice, *meanMASE*
    or *meanRMSSE* can also be used.
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于多个时间序列数据集，使用*ND*或*NRMSSE*（取决于你是否希望更多地惩罚较大的误差）。作为第二选择，*meanMASE*或*meanRMSSE*也可以使用。
- en: If there are large changes in the time series (in the horizon we are measuring,
    there is a huge shift in time series levels), then something such as *PB* or *MRAE*
    can be used.
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果时间序列中发生了较大变化（在我们测量的时间范围内，时间序列水平发生了巨大变化），可以使用*PB*或*MRAE*等指标。
- en: Whichever metric you choose, always make sure to use *Forecast Bias*, *CFE*,
    or Tracking Signal to keep an eye on structural over- or under-forecasting problems.
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无论你选择哪种指标，始终确保使用*预测偏差*、*CFE*或跟踪信号来关注结构性过度或不足预测的问题。
- en: If the time series you are forecasting is intermittent (as in, has a lot of
    time steps with zero values), use *RMSE* and avoid *MAE*. *MAE* favors forecasts
    that generate all zeros. Avoid all percent-error-based metrics because intermittency
    brings to light another one of their shortcomings—it is undefined when actual
    observations are zero (the *Further reading* section has a link to a blog that
    explores other metrics for intermittent series).
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你要预测的时间序列是间歇性的（即，具有很多值为零的时间步），使用*RMSE*并避免使用*MAE*。*MAE*倾向于偏好生成全零的预测结果。避免使用基于百分比误差的所有指标，因为间歇性揭示了这些指标的另一个缺点——当实际观测值为零时，它们是未定义的（*进一步阅读*部分有一个链接，探讨了间歇性序列的其他指标）。
- en: Congratulations on finishing a chapter full of new terms and metrics. I hope
    you have gained the necessary intuition to intelligently select the metric to
    focus on for your next forecasting assignment!
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜你完成了这一章，里面有许多新的术语和指标。希望你已经获得了必要的直觉，能够智能地选择下一个预测任务中应该专注的指标！
- en: Summary
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we looked at the thickly populated and highly controversial
    area of forecast metrics. We started with a basic taxonomy of forecast measures
    to help you categorize and organize all the metrics in the field.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了一个人口密集且争议颇多的预测指标领域。我们从预测度量的基本分类法开始，帮助你对这一领域的所有指标进行分类和整理。
- en: Then, we launched a few experiments through which we learned about the different
    properties of these metrics, slowly approaching a better understanding of what
    these metrics are measuring; looking at synthetic time series experiments, we
    learned how *MAPE* and *sMAPE* favor under- and over-forecasting, respectively.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们通过一些实验，了解了这些指标的不同特性，逐渐接近对这些指标测量内容的更好理解；通过查看合成时间序列实验，我们了解到*MAPE*和*sMAPE*分别偏向于低估和高估预测。
- en: We also analyzed the rank correlations between these metrics on real data to
    see how similar the different metrics are, and finally, rounded off by laying
    out a few guidelines that can help you pick a forecasting metric for your problem.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还分析了这些指标在真实数据上的排名相关性，看看不同指标之间的相似性，最后通过列出一些指南来帮助你为你的问题选择一个合适的预测指标。
- en: In the next chapter (our last chapter), we will look at cross-validation strategies
    for time series.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章（我们的最后一章），我们将讨论时间序列的交叉验证策略。
- en: References
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'The following are the references that we used throughout the chapter:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是我们在本章中使用的参考文献：
- en: 'Hewamalage, Hansika; Ackermann, Klaus; and Bergmeir, Christoph. (2022). *Forecast
    Evaluation for Data Scientists: Common Pitfalls and Best Practices*. arXiv preprint
    arXiv: Arxiv-2203.10716: [https://arxiv.org/abs/2203.10716v2](https://arxiv.org/abs/2203.10716v2).'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Hewamalage, Hansika; Ackermann, Klaus; 和 Bergmeir, Christoph. (2022). *数据科学家的预测评估：常见陷阱与最佳实践*。arXiv预印本
    arXiv: Arxiv-2203.10716：[https://arxiv.org/abs/2203.10716v2](https://arxiv.org/abs/2203.10716v2)。'
- en: 'Davydenko, Andrey and Fildes, Robert. (2013). *Measuring forecasting accuracy:
    the case of judgmental adjustments to SKU-level demand forecasts*. In *International
    Journal of Forecasting*. Vol. 29, No. 3., 2013, pp. 510-522: [https://doi.org/10.1016/j.ijforecast.2012.09.002](https://doi.org/10.1016/j.ijforecast.2012.09.002).'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Davydenko, Andrey 和 Fildes, Robert. (2013). *衡量预测准确性：对SKU级需求预测的判断性调整案例研究*。发表于
    *国际预测学期刊*。第29卷，第3期，2013年，页码510-522：[https://doi.org/10.1016/j.ijforecast.2012.09.002](https://doi.org/10.1016/j.ijforecast.2012.09.002)。
- en: 'Hyndman, Rob J. and Koehler, Anne B. (2006). *Another look at measures of forecast
    accuracy*. In *International Journal of Forecasting*, Vol. 22, Issue 4, 2006,
    pp. 679-688: [https://robjhyndman.com/publications/another-look-at-measures-of-forecast-accuracy/](https://robjhyndman.com/publications/another-look-at-measures-of-forecast-accuracy/).'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Hyndman, Rob J. 和 Koehler, Anne B. (2006). *重新审视预测准确性度量*。发表于 *国际预测学期刊*，第22卷，第4期，2006年，页码679-688：[https://robjhyndman.com/publications/another-look-at-measures-of-forecast-accuracy/](https://robjhyndman.com/publications/another-look-at-measures-of-forecast-accuracy/)。
- en: Further reading
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'If you wish to read further about forecast metrics, you can check out the blog
    post *Forecast Error Measures: Intermittent Demand* by Manu Joseph: [https://deep-and-shallow.com/2020/10/07/forecast-error-measures-intermittent-demand/](https://deep-and-shallow.com/2020/10/07/forecast-error-measures-intermittent-demand/)'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您想进一步阅读有关预测指标的内容，可以查看Manu Joseph的博客文章 *预测误差度量：间歇性需求*：[https://deep-and-shallow.com/2020/10/07/forecast-error-measures-intermittent-demand/](https://deep-and-shallow.com/2020/10/07/forecast-error-measures-intermittent-demand/)
- en: Join our community on Discord
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加入我们的Discord社区
- en: 'Join our community’s Discord space for discussions with authors and other readers:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 加入我们社区的Discord空间，与作者和其他读者进行讨论：
- en: '[https://packt.link/mts](https://packt.link/mts)'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/mts](https://packt.link/mts)'
- en: '![](img/QR_Code15080603222089750.png)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![](img/QR_Code15080603222089750.png)'
- en: Leave a Review!
  id: totrans-248
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 留下评论！
- en: Thank you for purchasing this book from Packt Publishing—we hope you enjoy it!
    Your feedback is invaluable and helps us improve and grow. Once you’ve completed
    reading it, please take a moment to leave an Amazon review; it will only take
    a minute, but it makes a big difference for readers like you.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 感谢您从Packt出版社购买本书——我们希望您喜欢它！您的反馈非常宝贵，帮助我们改进和成长。读完本书后，请花点时间在亚马逊上留下评论；这只需要一分钟，但对像您这样的读者来说意义重大。
- en: Scan the QR or visit the link to receive a free ebook of your choice.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描二维码或访问链接以获得您选择的免费电子书。
- en: '[https://packt.link/NzOWQ](https://packt.link/NzOWQ)'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/NzOWQ](https://packt.link/NzOWQ)'
- en: '![A qr code with black squares  Description automatically generated](img/review.png)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![一个带有黑色方块的二维码，描述自动生成](img/review.png)'
