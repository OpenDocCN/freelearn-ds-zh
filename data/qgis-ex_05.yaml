- en: Chapter 5. Answering Questions with Density Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章：使用密度分析回答问题
- en: We often need to work with large and dense datasets in which there is a lot
    of overplotting and features experience significant overlap. Such datasets may
    be very slow at rendering because they contain thousands, or even millions, of
    features, and very difficult to interpret because overlaps make it difficult to
    detect any clusters or distribution patterns. In this chapter, you will learn
    the techniques that allow you to visualize such datasets in a more readable and
    faster way by displaying feature density instead of the features themselves. By
    the end of this chapter, you will be able to perform density analysis of your
    data and extract information from density maps.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们经常需要处理大型且密集的数据集，其中存在大量重叠，并且特征之间存在显著的重叠。这些数据集在渲染时可能非常缓慢，因为它们包含数千甚至数百万个特征，并且由于重叠使得检测任何集群或分布模式变得非常困难。在本章中，你将学习到允许你通过显示特征密度而不是特征本身来以更易读和更快的速度可视化此类数据集的技术。在本章结束时，你将能够对你的数据进行密度分析并从密度图中提取信息。
- en: 'In this chapter, we will go through the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨以下主题：
- en: Density analysis and heat maps
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密度分析和热力图
- en: Creating heat maps with the Heatmap plugin
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Heatmap插件创建热力图
- en: Mapping density with a hexagonal grid
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用六边形网格映射密度
- en: Density analysis and heatmaps
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 密度分析和热力图
- en: Density maps allow visual estimation of object or event concentration over the
    study area. Such maps are very useful for assessment of the distribution patterns
    of the features over the study area. When we simply add locations of the features
    or events (for example, as points) to the map, we cannot see the changes in their
    concentration in different areas. Density analysis gives us such functionality
    by using uniform area characteristics, such as feature count per acre or square
    kilometer.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 密度图允许对研究区域内对象或事件浓度的视觉估计。此类地图对于评估研究区域内特征分布模式非常有用。当我们简单地将特征或事件的位置（例如，作为点）添加到地图上时，我们无法看到它们在不同区域的浓度变化。密度分析通过使用均匀的区域特征，如每英亩或每平方公里的特征计数，为我们提供了这种功能。
- en: A density map gives us the ability to estimate the concentration of some features
    within an area. This helps us find areas where an urgent reaction is required
    or which match your criteria. Heatmaps also help control conditions and their
    changes.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 密度图使我们能够估计区域内某些特征的浓度。这有助于我们找到需要紧急反应或符合您标准的区域。热力图也有助于控制条件和它们的变化。
- en: Density maps are also extremely useful when mapped regions (for example, districts)
    have different sizes. For example, if we want to know how many people live in
    each district, we just need an ordinal map with the population data. According
    to this map, a large district may have a higher population than a smaller district.
    But if we want to identify the districts with a higher concentration of population,
    then we need a density map to see the number of people per square kilometer. And
    a density map will show us that, in fact, small regions with a high population
    density may have more people per square kilometer than larger districts.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 当映射的区域（例如，区域）具有不同大小时，密度图也非常有用。例如，如果我们想知道每个区域有多少人居住，我们只需要一个包含人口数据的序数图。根据此图，一个大的区域可能比一个小的区域人口更多。但如果我们想识别人口密度较高的区域，那么我们需要一个密度图来查看每平方公里的居民人数。而密度图将显示，实际上，人口密度高的较小区域可能比较大的区域每平方公里的居民人数更多。
- en: Generally, we can show on a map the density distributions of the features themselves
    (for example, schools), as well as distributions of some numerical characteristics
    of these features (for example, the number of pupils in schools). The results
    will be completely different in these cases. A density map of schools can help
    an education department find areas where more schools are needed, while a density
    map created from information about the number of pupils in each school may help
    a transportation company to plan bus routes and to decide where to place bus stops.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，我们可以在地图上显示特征本身的密度分布（例如，学校），以及这些特征的某些数值特征的分布（例如，学校中的学生人数）。在这些情况下，结果将完全不同。学校的热力图可以帮助教育部门找到需要更多学校的地方，而来自每所学校学生人数信息的密度图可能有助于运输公司规划公交线路并决定在哪里设置公交车站。
- en: The most common use case is the creation of density maps to display the density
    of point features. Such maps are often called **heat maps**. What is a heat map?
    It is a raster layer. Each cell of it contains a representation of the density
    of features in its vicinity (for example, the number of people per square kilometer),
    which depends on the number of features within some area.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 最常见的用例是创建密度图以显示点要素的密度。此类地图通常被称为**热力图**。什么是热力图？它是一个栅格层。它的每个单元格都包含其附近要素密度的表示（例如，每平方公里的居民数），这取决于某个区域内要素的数量。
- en: 'To create a heat map, in the simplest case, GIS looks at the features around
    a cell center, using a given search radius. Then the number of features that fall
    within the given radius is calculated and divided by the area of the region. This
    value will be a cell value. Then next cell will be analyzed, and so on. As a result,
    we will get a combination of values, which creates a smooth surface. To understand
    this better, refer to the following diagram:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建热力图，在最简单的情况下，GIS会查看单元格中心周围的要素，使用给定的搜索半径。然后计算给定半径内的要素数量，并将其除以该区域的面积。这个值将是单元格值。然后分析下一个单元格，依此类推。结果，我们将得到一系列值，这些值组合在一起形成平滑的表面。为了更好地理解，请参考以下图表：
- en: '![Density analysis and heatmaps](img/image00420.jpeg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![密度分析和热力图](img/image00420.jpeg)'
- en: This diagram shows the general principle of creating heat maps. The green dots
    depict the features used for density map generation, the blue square is a current
    raster cell, and the red dotted circle marks the search radius, for example, 1
    km. In this case, the area covered will be about 3.14 sq. km. As we can see in
    the diagram to the left, four features are within the search radius. So, the raster
    cell will get a value of *4/3.14 = 1.27*. On the right side, we notice that the
    next cell will get a value of 1.59 because now there are five features inside
    the search radius.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 此图表展示了创建热力图的一般原理。绿色圆点表示用于生成密度图的要素，蓝色方块是当前栅格单元格，红色虚线圆圈标记搜索半径，例如，1公里。在这种情况下，覆盖的面积约为3.14平方公里。如图表左侧所示，有四个要素位于搜索半径内。因此，栅格单元格将获得*4/3.14
    = 1.27*的值。在右侧，我们注意到下一个单元格将获得1.59的值，因为现在搜索半径内有五个要素。
- en: This is the simplest approach. In real-world applications, more complex algorithms
    are used, where each point has some impact on the values of the neighboring cells,
    depending on its distance from those cells.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这是最简单的方法。在实际应用中，使用更复杂的算法，其中每个点根据其与相邻单元格的距离对其值产生影响。
- en: Creating heat maps with the Heatmap plugin
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用热力图插件创建热力图
- en: With the help of the QGIS core plugin called Heatmap, we can easily create heat
    maps from vector point data and use it for further analysis. First, we need to
    activate this plugin, if it has not yet been activated. After activation, it creates
    a submenu under the **Raster** menu and places its button on the **Raster** toolbar.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在QGIS核心插件Heatmap的帮助下，我们可以轻松地从矢量点数据创建热力图，并用于进一步分析。首先，我们需要激活此插件，如果尚未激活。激活后，它将在**栅格**菜单下创建一个子菜单，并将按钮放置在**栅格**工具栏上。
- en: Let's create a density map for the `noise` layer, which contains information
    about complaints regarding high noise levels. This layer contains 44,397 features,
    and it is difficult to know which places are noisy.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们为包含关于高噪音水平投诉信息的`noise`图层创建一个密度图。此图层包含44,397个要素，很难知道哪些地方是噪音源。
- en: 'Information about such places may be useful for a police department or other
    agencies to plan some activities for noise reduction, or for those who are looking
    for apartments and don''t want neighbors who like playing loud music:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 对于警察部门或其他机构计划降低噪音的活动，或者对于寻找公寓且不想与喜欢大声播放音乐的邻居为邻的人来说，此类地点的信息可能很有用：
- en: Start the plugin by clicking on the **Heatmap** button on the **Raster** panel,
    or by navigating to **Raster** | **Heatmap** | **Heatmap...**.![Creating heat
    maps with the Heatmap plugin](img/image00421.jpeg)
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击**热力图**按钮或导航到**栅格** | **热力图** | **热力图...**，开始使用插件。![使用热力图插件创建热力图](img/image00421.jpeg)
- en: Select the `noise` layer from the **Input point layer** combobox.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**输入点层**组合框中选择`noise`图层。
- en: Using the **…** button on the right side of the **Output raster** field, specify
    the location in which the resulting heat map needs to be saved. Note that there
    is no need to specify the file extension; it will be picked up automatically,
    based on the output file format.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**输出栅格**字段右侧的**…**按钮，指定结果热力图需要保存的位置。请注意，无需指定文件扩展名；它将根据输出文件格式自动选择。
- en: Use the **Output format** combobox to select the desired format for the heat
    map. The most common choice here is **GeoTIFF**, but for very large maps, it is
    better to use something different, for example, **Erdas Imagine**.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**输出格式**下拉框选择热力图所需的格式。这里最常见的选项是**GeoTIFF**，但对于非常大的地图，最好使用不同的格式，例如**Erdas Imagine**。
- en: The last thing we need to specify is **Radius**. This value defines the distance
    from each cell up to which QGIS will look for neighbor features and take their
    presence into account. Generally, a bigger search radius gives a more generalized
    result, as the number of features found will be divided by a bigger area. A smaller
    radius gives more precise results, but if this value is too small, we may not
    find any distribution patterns. The search radius can be defined in meters or
    map units.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们最后需要指定的是**半径**。此值定义了QGIS将搜索邻居特征并考虑其存在的距离。通常，较大的搜索半径会给出更一般化的结果，因为找到的特征数量将除以更大的面积。较小的半径会给出更精确的结果，但如果此值太小，我们可能找不到任何分布模式。搜索半径可以用米或地图单位定义。
- en: 'To determine the search radius from a known area, we can use a very simple
    formula derived from formula for the area of a circle:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 要从已知区域确定搜索半径，我们可以使用从圆面积公式推导出的一个非常简单的公式：
- en: '![Creating heat maps with the Heatmap plugin](img/image00422.jpeg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热力图](img/image00422.jpeg)'
- en: 'For example, if we need to calculate density per square kilometer, then the
    search radius will be as follows:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果我们需要计算每平方千米的密度，那么搜索半径将如下所示：
- en: '![Creating heat maps with the Heatmap plugin](img/image00423.jpeg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热力图](img/image00423.jpeg)'
- en: 'For more fine-grained control over the result, we can check the **Advanced**
    box and define some additional parameters:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 为了对结果有更精细的控制，我们可以勾选**高级**复选框并定义一些额外的参数：
- en: '**Rows** and **Columns**: These allow us to define dimensions of the output
    raster. Larger dimensions will result in a bigger output file size, while smaller
    dimensions will result in a rough and pixelated output. Input fields are linked
    to each other, so changing the value in the **Rows** field (for example, halving
    it) will also cause the corresponding change to the value in the **Columns** field,
    and vice versa. Furthermore, these values have a direct influence on the raster
    cell size (see the next point). It is worth mentioning that the extent of the
    raster preserved when changing raster dimensions.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**行**和**列**：这些允许我们定义输出栅格的尺寸。较大的尺寸将导致更大的输出文件大小，而较小的尺寸将导致粗糙和像素化的输出。输入字段是相互链接的，因此更改**行**字段中的值（例如，将其减半）也会导致**列**字段中的相应值发生变化，反之亦然。此外，这些值直接影响栅格单元格大小（参见下一点）。值得注意的是，在更改栅格维度时保留的栅格范围。'
- en: '**Cell size X** and **Cell size Y**: The raster cell size determines how coarse
    or detailed the display of the distribution patterns will be. A smaller cell size
    will give smoother results, but the processing time and memory required for the
    analysis will increase. Large cells will be processed faster, but the resulting
    raster will be pixelated. If the cells are really big, some patterns will become
    invisible, so you may need to run the analysis several times, trying different
    cell sizes to get results that satisfy your requirements.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**单元格大小X** 和 **单元格大小Y**：栅格单元格大小决定了分布模式的显示将有多粗糙或多详细。较小的单元格大小将给出更平滑的结果，但分析所需的处理时间和内存将增加。较大的单元格将更快地处理，但生成的栅格将出现像素化。如果单元格真的很大，某些模式将变得不可见，因此您可能需要多次运行分析，尝试不同的单元格大小以获得满足您要求的结果。'
- en: The cell size depends on and is linked to the raster dimensions. Increasing
    it will decrease the number of rows and columns, and vice versa.
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 单元格大小取决于并链接到栅格维度。增加它将减少行数和列数，反之亦然。
- en: '**Kernel shape**: This controls how the point influence changes with changes
    in distance from this point. The QGIS Heatmap plugin currently supports the following
    kernels:'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**核形状**：这控制了从该点距离的变化如何影响点的影响。QGIS Heatmap插件目前支持以下核：'
- en: quartic (also known as biweight)
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 四次方（也称为双权重）
- en: triangular
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 三角形
- en: uniform
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均匀
- en: triweight
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 三重权重
- en: Epanechnikov
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Epanechnikov
- en: 'The following diagram shows the distribution of the point influence for different
    kernels:'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下图表显示了不同核函数的点影响分布：
- en: '![Creating heat maps with the Heatmap plugin](img/image00424.jpeg)'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热图](img/image00424.jpeg)'
- en: Note
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For more details about kernel shapes, refer to the Wikipedia article at [http://en.wikipedia.org/wiki/Kernel_(statistics)#Kernel_functions_in_common_use](http://en.wikipedia.org/wiki/Kernel_(statistics)#Kernel_functions_in_common_use),
    and books about statistics, for example, *Density Estimation for Statistics* and
    *Data Analysis* by B. W. Silverman.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 关于核形状的更多详细信息，请参阅维基百科上的文章[http://en.wikipedia.org/wiki/Kernel_(statistics)#Kernel_functions_in_common_use](http://en.wikipedia.org/wiki/Kernel_(statistics)#Kernel_functions_in_common_use)，以及关于统计学的书籍，例如B.
    W. Silverman的《统计密度估计》和《数据分析》。
- en: Depending on the kernel shape, we will get a smoother heat map, or more clearly
    exposed hotspots. For example, the triweight kernel will give clearer, sharper
    hotspots than the Epanechnikov kernel, because the Epanechnikov kernel has lower
    influence near the hotspot center. Also, in different scientific fields, different
    kernels are preferred; for example, in crime analysis, the quartic kernel is typically
    used.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 根据核形状，我们将得到更平滑的热图，或者更清晰地显示热点。例如，三重权重核将比Epanechnikov核给出更清晰、更尖锐的热点，因为Epanechnikov核在热点中心附近的影响较低。此外，在不同的科学领域，人们通常偏好不同的核函数；例如，在犯罪分析中，通常使用四次核函数。
- en: It is also possible to use a variable search radius for each point by selecting
    the **Use radius from field** checkbox and selecting the attribute field with
    radius value from the combobox. If you need to weight points (in other words,
    increase or decrease their influence) by some numeric attribute, activate the
    **Use weight from field** checkbox and select the corresponding field. In our
    example, we will not use this functionality, but you can try it yourself.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 还可以通过选择**使用半径字段**复选框并从下拉菜单中选择具有半径值的属性字段来为每个点使用可变搜索半径。如果您需要通过某些数值属性对点进行加权（换句话说，增加或减少它们的影响），请激活**使用权重字段**复选框并选择相应的字段。在我们的例子中，我们不会使用此功能，但您可以自己尝试。
- en: As we said before, cell size has a direct influence on the quality of the resulting
    heat map, so it is important to select it carefully. In most cases, the cell size
    is chosen in such a way that we get 10 to 100 cells per unit area (which in turn
    is defined by the search radius). To calculate the cell size, we need to align
    area units with distance units; for example, if we calculate the density using
    square kilometers and define the search radius in meters, then it is necessary
    to convert the square kilometers to square meters. The next step is to divide
    the area by the desired number of cells. Finally, as the cell size is defined
    by its width or height (because raster cells usually have a square shape), we
    need to extract the square root of this value.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前所说的，单元格大小直接影响最终热图的质量，因此选择它非常重要。在大多数情况下，单元格大小被选择为每单位面积10到100个单元格（这反过来又由搜索半径定义）。为了计算单元格大小，我们需要将面积单位与距离单位对齐；例如，如果我们使用平方公里计算密度并定义搜索半径为米，那么将平方公里转换为平方米是必要的。下一步是将面积除以所需的单元格数。最后，由于单元格大小由其宽度或高度定义（因为栅格单元格通常呈方形），我们需要提取这个值的平方根。
- en: 'In our example, we will create a heat map with a search radius of 1000 m, so
    the lookup area will be approximately 3.14 square kilometers. When expressed in
    meters, this will be as follows:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，我们将创建一个搜索半径为1000米的热图，因此查找区域将大约是3.14平方公里。以米为单位表示如下：
- en: '![Creating heat maps with the Heatmap plugin](img/image00425.jpeg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热图](img/image00425.jpeg)'
- en: 'As we want a smooth heat map, we will use a relatively large number of cells
    per unit area; let''s say 100 cells per 3.14 square kilometers. So, we divide
    the area in square meters by the desired cell count:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们希望热图平滑，我们将使用每单位面积相对较多的单元格数；比如说每3.14平方公里100个单元格。因此，我们将面积（平方米）除以所需的单元格数：
- en: '![Creating heat maps with the Heatmap plugin](img/image00426.jpeg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热图](img/image00426.jpeg)'
- en: 'Finally, we calculate the square root of this value to get the cell size that
    allows us to have 100 cells per 3.14 square kilometers:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们计算这个值的平方根以得到允许我们在3.14平方公里内有100个单元格的单元格大小：
- en: '![Creating heat maps with the Heatmap plugin](img/image00427.jpeg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热图](img/image00427.jpeg)'
- en: Of course this is not a strict rule but just a recommendation. You can safely
    use another cell size, depending on your data and the desired results. Just remember
    that smaller values lead to smoother heat maps, but at the same time increase
    the analysis time and output raster size.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这并不是一个严格的规则，而只是一个建议。您可以根据您的数据和期望的结果安全地使用另一个单元格大小。只需记住，较小的值会导致热力图更平滑，但同时也增加了分析时间和输出栅格的大小。
- en: When all the inputs and parameters are set, press the **OK** button to start
    the process of the heat map generation. The progress of the heat map formation
    will be displayed in a small progress dialog. If this process is taking too long
    time to complete, you can interrupt it by pressing the **Abort** button. Note
    that after aborting heat map generation, you still get the output, but it will
    be incomplete and not useful for further analysis.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有输入和参数都设置好后，按下**确定**按钮以启动热力图生成过程。热力图形成的过程将在一个小进度对话框中显示。如果这个过程完成时间过长，您可以按**中止**按钮中断它。请注意，在终止热力图生成后，您仍然会得到输出，但它将是不完整且不适用于进一步分析的。
- en: 'When the process completes, the generated heat map will be added to QGIS as
    a grayscale raster, where lighter regions correspond to higher density values
    and darker regions correspond to lower density values, like this:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 当过程完成后，生成的热力图将以灰度栅格的形式添加到QGIS中，其中较亮的区域对应于较高的密度值，较暗的区域对应于较低的密度值，如下所示：
- en: '![Creating heat maps with the Heatmap plugin](img/image00428.jpeg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热力图](img/image00428.jpeg)'
- en: 'To improve readability and make it look like real heat map, we need to change
    its style. To do this, follow the next steps. For more detailed information about
    styling raster layers, refer to the *Developing styles for raster layers* section
    of [Chapter 2](part0021.xhtml#aid-K0RQ1 "Chapter 2. Visualizing and Styling the
    Data"), *Visualizing and Styling the Data*:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高可读性并使其看起来像真正的热力图，我们需要更改其样式。为此，请按照以下步骤操作。有关样式栅格层的更详细信息，请参阅[第2章](part0021.xhtml#aid-K0RQ1
    "第2章。可视化与样式化数据")的*为栅格层开发样式*部分，*可视化与样式化数据*：
- en: Right-click on the `heatmap` layer in the QGIS layer tree. In the context menu,
    select **Properties**.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在QGIS图层树中右键点击`热力图`层。在上下文菜单中，选择**属性**。
- en: Go to the **Style** tab and select **Singleband pseudocolor** as **Render type**.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**样式**选项卡，并将**渲染类型**选择为**单波段伪彩色**。
- en: In the **Load min/max values** group, activate the **Min/max** options. Set
    **Extent** to **Full** and **Accuracy** to **Actual (slower)**. Press the **Load**
    button to get raster statistics. This will be used for further classification.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**加载最小/最大值**组中，激活**最小/最大**选项。将**范围**设置为**全部**，将**精度**设置为**实际（较慢）**。按下**加载**按钮以获取栅格统计信息。这将用于进一步的分类。
- en: Select a suitable color ramp in the **Generate new color map** group, for example,
    `YlOrBr` (which changes colors from yellow to orange and then brown), or `Reds`
    (which uses different shades of red). If necessary, change the number of classes
    and click on the **Classify** button.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**生成新颜色图**组中选择合适的颜色渐变，例如`YlOrBr`（颜色从黄色变为橙色，然后变为棕色），或`Reds`（使用不同深度的红色）。如有必要，更改类别数量并点击**分类**按钮。
- en: Click on **OK** to apply the changes and close the properties dialog.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**确定**以应用更改并关闭属性对话框。
- en: 'Now we can easily locate the hottest points (displayed in colors closer to
    red if the `Reds` color map is used), and even recognize some distribution patterns
    that were not visible when we looked at the original point layer:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以轻松地定位最热点（如果使用`Reds`颜色图，则颜色接近红色），甚至可以识别出在我们查看原始点层时不可见的某些分布模式：
- en: '![Creating heat maps with the Heatmap plugin](img/image00429.jpeg)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![使用Heatmap插件创建热力图](img/image00429.jpeg)'
- en: Now we can easily locate the hottest points (displayed in colors closer to red
    if the `Reds` color map is used), and even recognize some distribution patterns
    that were not visible when we looked at the original point layer. Also, our heatmap
    layer showed up much faster than the vector which is used to create this heat
    map.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以轻松地定位最热点（如果使用`Reds`颜色图，则颜色接近红色），甚至可以识别出在我们查看原始点层时不可见的某些分布模式。此外，我们的热力图层显示得比用于创建此热力图的矢量图层要快得多。
- en: Detecting the "hottest" regions
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检测“最热点”
- en: Sometimes, you don't need the heat map itself, but just want to find the hotspots—areas
    with the highest density—and use them in further analysis. It is pretty easy to
    find such regions in QGIS and extract them in the vector form.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，您可能不需要热图本身，而只是想找到热点——密度最高的区域——并在进一步的分析中使用它们。在QGIS中找到这样的区域并将其提取为矢量形式非常容易。
- en: First, we should define threshold value, which will be used to recognize the
    hotspots. As a starting value, we can use the maximum pixel value in our heat
    map and then adjust it as per our needs.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们应该定义阈值值，这将用于识别热点。作为一个起始值，我们可以使用我们热图中的最大像素值，然后根据我们的需求进行调整。
- en: The simplest way to find the maximum pixel value is to use the **Identify Features**
    tool. Select a layer in the QGIS layer tree, activate the **Identify Features**
    tool, click on the most visually "hottest" regions, and look at the reported value.
    With our heat map, this will be `540.32`.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 找到最大像素值的最简单方法是使用**识别特征**工具。在QGIS图层树中选择一个图层，激活**识别特征**工具，点击最直观的“最热”区域，并查看报告的值。在我们的热图中，这个值将是`540.32`。
- en: If we will use this value as is, we cannot find all the important clusters,
    so this value should be reduced first. The smaller the selected value (in comparison
    with the maximum value), the larger the number of clusters found. The area of
    separate clusters will also grow. For our example, we choose a value of `200`.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们直接使用这个值，我们无法找到所有重要的簇，因此这个值应该首先减小。所选值（与最大值相比）越小，找到的簇数量就越多。单独簇的面积也会增大。对于我们的示例，我们选择了一个`200`的值。
- en: 'Now, open **Raster Calculator** from the **Raster** menu, specify a path where
    the output file should be saved in the **Output layer** field, and enter the `"heatmap@1">=200`
    formula in the **Raster calculator expression** field, like this:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，从**栅格**菜单打开**栅格计算器**，在**输出图层**字段中指定输出文件应保存的路径，并在**栅格计算器表达式**字段中输入`"heatmap@1">=200`公式，如下所示：
- en: '![Detecting the "hottest" regions](img/image00430.jpeg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![检测“最热”区域](img/image00430.jpeg)'
- en: This formula is used to create a so-called mask. If the pixel value of the input
    layer is greater or equal to our threshold value of `200`, then the output pixel
    value will be `1`. Otherwise, it will be `0`. So, our output raster will be a
    binary raster, with only two pixel values—`0` and `1`—which is very easy to convert
    to a vector.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 这个公式用于创建所谓的掩码。如果输入层的像素值大于或等于我们的阈值`200`，则输出像素值将为`1`。否则，它将为`0`。因此，我们的输出栅格将是一个二进制栅格，只有两个像素值——`0`和`1`——这非常容易转换为矢量。
- en: 'Leave all other values unchanged so that the resulting raster will have exactly
    the same dimensions and cell size as the input one. Press the **OK** button to
    start the calculation. When it is done, a new black-and-white raster layer will
    be added to the QGIS canvas, as shown here:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 保持所有其他值不变，以便生成的栅格将具有与输入相同的精确尺寸和单元格大小。按下**确定**按钮开始计算。完成后，将在QGIS画布中添加一个新的黑白栅格图层，如图所示：
- en: '![Detecting the "hottest" regions](img/image00431.jpeg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![检测“最热”区域](img/image00431.jpeg)'
- en: 'To convert the mask raster into vector format, we need to create polygons from
    all connected pixels with the same value. This is where the **Polygonize** tool
    comes to help. In the **Processing** toolbox, you can find the **Polygonize**
    algorithm by typing its name in the filter field at the top of the toolbox. Double-click
    on the algorithm name to open its dialog, and you will see something like this:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 要将掩码栅格转换为矢量格式，我们需要从所有具有相同值的连接像素创建多边形。这就是**多边形化**工具发挥作用的地方。在**处理**工具箱中，您可以通过在工具箱顶部的过滤器字段中输入其名称来找到**多边形化**算法。双击算法名称以打开其对话框，您将看到如下内容：
- en: '![Detecting the "hottest" regions](img/image00432.jpeg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![检测“最热”区域](img/image00432.jpeg)'
- en: Select the mask layer that was previously created as **Input layer**, specify
    the path where the result will be saved using the **Output layer** field, and
    click on the **Run** button to start the algorithm. When it is done, a new vector
    layer will be added to QGIS. This layer has an attribute called `DN` (if you did
    not change it) that indicates the pixel value of each polygon in the layer. So,
    all we need to do is remove all the features that have the attribute value equal
    to zero. The remaining features will be the hotspots.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 选择之前创建的掩膜图层作为**输入层**，使用**输出层**字段指定结果保存的路径，然后点击**运行**按钮开始算法。完成后，将在QGIS中添加一个新的矢量图层。这个图层有一个名为`DN`（如果你没有更改它）的属性，表示图层中每个多边形的像素值。因此，我们只需要删除所有属性值等于零的要素。剩余的要素将是热点。
- en: To delete unnecessary features from the hotspots layer, select it in the QGIS
    layer tree, right-click to open the context menu, and select **Open Attribute
    Table**. Click on the **Select features using an expression** button. In the **Select
    by expression** dialog, enter `"DN" = 0` (if necessary, replace `DN` with your
    field name), click on the **Select** button, and close the dialog. Start editing
    by clicking on the **Toggle editing mode** button, or press *Ctrl* + *E*. To remove
    the selected features, press the *Delete* key or click on **Delete selected features**.
    Finally, turn editing mode off by pressing *Ctrl* + *E* or clicking on **Toggle
    editing mode** again.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 要从热点图层中删除不必要的特征，在QGIS图层树中选择它，右键点击打开上下文菜单，然后选择**打开属性表**。点击**使用表达式选择要素**按钮。在**选择表达式**对话框中，输入`"DN"
    = 0`（如果需要，将`DN`替换为你的字段名），点击**选择**按钮，并关闭对话框。通过点击**切换编辑模式**按钮或按*Ctrl* + *E*开始编辑。要删除选定的要素，按*Delete*键或点击**删除选定要素**。最后，通过按*Ctrl*
    + *E*或再次点击**切换编辑模式**来关闭编辑模式。
- en: '![Detecting the "hottest" regions](img/image00433.jpeg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![检测“最热”区域](img/image00433.jpeg)'
- en: Now, the hotspots layer contains only hotspot polygons, which can be used for
    further analysis. For example, we can combine this cluster with information about
    the nearest buildings and noise types to find dependencies and develop some suggestions
    for reducing the noise levels there.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，热点图层只包含热点多边形，可用于进一步分析。例如，我们可以将这个簇与最近建筑物的信息和噪音类型的信息结合起来，以找到依赖关系并为此处降低噪音水平提出一些建议。
- en: Looking for distribution patterns with contour lines
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用等高线寻找分布模式
- en: Apart from detecting hotspots, heat maps can also be used to detect intensity
    changes or visualize the direction of value changes. The most common way to do
    both of these tasks is contour lines generation.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 除了检测热点外，热图还可以用于检测强度变化或可视化值变化的方向。完成这两项任务最常见的方法是生成等高线。
- en: 'Fortunately, QGIS has all the necessary tools for this. We will use processing
    again, but contour lines generation is also available in the **GDALTools** plugin
    (which can be found in the **Raster** menu). In the **Processing** toolbox, you
    can find the **Contour** algorithm by typing its name in the filter field at the
    top of the toolbox. Double-click on the algorithm name to open its dialog, which
    looks like this:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，QGIS拥有完成这项任务所需的所有工具。我们将再次使用处理工具，但等高线生成也可在**GDALTools**插件（可在**栅格**菜单中找到）中找到。在**处理**工具箱中，你可以通过在工具箱顶部的过滤器字段中输入其名称来找到**Contour**算法。双击算法名称以打开其对话框，其外观如下：
- en: '![Looking for distribution patterns with contour lines](img/image00434.jpeg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![使用等高线寻找分布模式](img/image00434.jpeg)'
- en: Select the `heatmap` raster layer as **Input layer**. In the **Output file**
    field, specify the path where the results will be saved. Also, it is necessary
    to define **Interval between contour lines**. There are no strict principles about
    determining this interval. The general rule is to select such an interval that
    detects patterns in the areas with smooth density changes. We will select an interval
    of `10`.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 选择**输入层**为`heatmap`栅格图层。在**输出文件**字段中，指定结果保存的路径。同时，需要定义**等高线之间的间隔**。确定这个间隔没有严格的原则。一般规则是选择一个能够检测到密度变化平滑区域模式的间隔。我们将选择`10`的间隔。
- en: When all of the necessary information has been defined, click on **Run** to
    start the contour line generation. After some time, a new polygonal vector layer
    will be added to QGIS, and we can start analyzing it. First, if necessary, move
    the contours layer to the top of the heat map in the QGIS layer tree. Also, it
    is better to adjust contours' symbology to make them more recognizable against
    the background of the heat map.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有必要的信息都已定义后，点击**运行**以开始生成等高线。经过一段时间，一个新的多边形矢量层将被添加到QGIS中，我们可以开始分析它。首先，如果需要，将等高线层移动到QGIS图层树中热图的顶部。此外，调整等高线的符号以使其在热图背景中更易于识别也是更好的选择。
- en: '![Looking for distribution patterns with contour lines](img/image00435.jpeg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![使用等高线寻找分布模式](img/image00435.jpeg)'
- en: More dense contours correspond to more intense density changes. Also, we can
    identify the direction of changes in noise. For example, in the preceding screenshot,
    we can see that in some places, the noise distribution around the center is not
    equal; the intensity reduces more quickly in the southeast than in the northwest.
    So, we may assume that there are some obstacles to noise there.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 更密集的等高线对应着更强烈的密度变化。此外，我们还可以识别噪声变化的方向。例如，在先前的屏幕截图中，我们可以看到在某些地方，围绕中心的噪声分布并不均匀；东南部的强度比西北部更快地降低。因此，我们可能假设那里有一些噪声障碍物。
- en: Mapping density with a hexagonal grid
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用六边形网格映射密度
- en: There is also another approach of mapping density, called binning. Generally
    speaking, binning is a technique of grouping *N* values/features into *M* groups,
    where *M < N*. The result of such an operation can be interpreted as a two-dimensional
    histogram.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 还有另一种映射密度的方法，称为分箱。一般来说，分箱是将*N*个值/特征分组到*M*个组中的技术，其中*M < N*。这种操作的成果可以解释为二维直方图。
- en: Binning is an alternative to heat maps, not a replacement. The choice of the
    method depends on the requirements and further usage of the results. It is, however,
    worth mentioning that binning produces a vector output, while a heat map produces
    a raster output.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 分箱是热图的替代方案，而不是替代品。方法的选择取决于结果的要求和进一步的使用。然而，值得注意的是，分箱产生矢量输出，而热图产生栅格输出。
- en: 'In general, binning can be described in two simple steps:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，分箱可以描述为两个简单的步骤：
- en: Create a hexagonal grid on top of the point layer.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在点层之上创建一个六边形网格。
- en: Count the number of points in each grid cell.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每个网格单元格中的点数。
- en: In this section, you will learn how to use this technique in QGIS in the example
    of hexbinning, in other words, mapping density with a hexagonal grid.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，您将学习如何在QGIS中通过六边形分箱的示例使用这项技术，换句话说，就是使用六边形网格映射密度。
- en: Note
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: In fact, for binning, we can use not only hexagons but also other shapes that
    allow regular tessellation of a 2D surface—triangles and rectangles.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，对于分箱，我们不仅可以使用六边形，还可以使用其他允许对二维表面进行规则镶嵌的形状——三角形和矩形。
- en: Why do we choose hexagons? Well, because a hexagon is closest to a circle among
    all shapes that tessellate. As a result, they represent curves more naturally.
    Another advantage of hexagons is a more compact structure, so the distance between
    cell centers in a hexagonal grid is lower than in a rectangular grid. So data
    aggregation around the cell center is more efficient.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么我们选择六边形？因为六边形是所有镶嵌形状中最接近圆形的。因此，它们更自然地表示曲线。六边形的另一个优点是结构更紧凑，因此六边形网格中单元格中心之间的距离比矩形网格中的距离更短。因此，围绕单元格中心的数据聚合更有效率。
- en: Note
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'In [Chapter 8](part0062.xhtml#aid-1R42S1 "Chapter 8. Automating Analysis with
    Processing Models"), *Automating Analysis with Processing Models*, we will create
    a model that produces two density maps: hexagonal and rectangular, so that you
    can compare them side by side and better understand their differences and use
    cases.'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第8章](part0062.xhtml#aid-1R42S1 "第8章。使用处理模型自动化分析")中，我们将创建一个模型，该模型生成两个密度图：六边形和矩形，以便您可以并排比较它们，更好地理解它们的不同用途和用例。
- en: In the upcoming sections, we will create a density map using this approach.
    For this exercise, we will use data from Brooklyn's street tree census. This is
    the `trees` layer in our map.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将使用这种方法创建一个密度图。为此练习，我们将使用布鲁克林街道树木普查的数据。这是我们地图中的`trees`层。
- en: Creating a hexagonal grid
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建六边形网格
- en: 'To create a hexagonal grid, we will use the QGIS Processing framework and its
    algorithm called **Create grid**:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建六边形网格，我们将使用QGIS处理框架及其名为**创建网格**的算法：
- en: In the **Processing** toolbox, find the **Create grid** algorithm by typing
    its name in the filter field at the top of the toolbox. Double-click on the algorithm
    name to open its dialog, which looks like this:![Creating a hexagonal grid](img/image00436.jpeg)
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**处理**工具箱中，通过在工具箱顶部的过滤器字段中输入其名称来找到**创建网格**算法。双击算法名称以打开其对话框，其外观如下：![创建六边形网格](img/image00436.jpeg)
- en: In the **Grid type** combobox, select **Hexagon (polygon)**.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**网格类型**组合框中，选择**六边形（多边形）**。
- en: To specify grid extent press the **…** button on the right side of the **Grid
    extent** field and choose **Use layer/canvas extent** from the menu.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要指定网格范围，请按**…**按钮，该按钮位于**网格范围**字段的右侧，并从菜单中选择**使用图层/画布范围**。
- en: The **Select extent** dialog will pop up. Use it to select the `trees` layer
    from the combobox, and click on **OK**. The coordinates of the `layer` extent
    will be added to the field.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**选择范围**对话框将弹出。使用它从组合框中选择`trees`图层，然后点击**确定**。`layer`范围坐标将被添加到字段中。'
- en: Set `1000` as the horizontal and vertical spacing. These values have the same
    meaning as the search radius in the case of heat maps. Grid spacing determines
    how many cells will be in a grid and how smooth the resulting map will be. A smaller
    spacing produces smoother results, but very small values prevent us from identifying
    any distribution patterns. Note that the spacing should be specified in the same
    units as used by layer; for example, if a layer CRS uses feet as units, then the
    spacing should be in feet too.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将水平间距和垂直间距设置为`1000`。这些值与热图中的搜索半径具有相同的意义。网格间距决定了网格中会有多少个单元格以及生成的地图将有多平滑。较小的间距会产生更平滑的结果，但非常小的值会阻止我们识别任何分布模式。请注意，间距应与图层使用的单位相同；例如，如果图层CRS使用英尺作为单位，则间距也应为英尺。
- en: Finally, in the **Output** field, specify the path where the resulting grid
    will be saved and click on **Run** to create the grid. When the algorithm execution
    completes, a new polygonal layer will be added to QGIS.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，在**输出**字段中指定结果网格的保存路径，并点击**运行**以创建网格。当算法执行完成后，一个新的多边形图层将被添加到QGIS中。
- en: Counting points in grid cells
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在网格单元格中计数点
- en: To calculate the number of features inside each grid cell, we can use fTools
    or Processing core plugins. The latter is more flexible and allows us to automate
    tasks, as described in [Chapter 8](part0062.xhtml#aid-1R42S1 "Chapter 8. Automating
    Analysis with Processing Models"), *Automating Analysis with Processing Models*.
    We will use the **Count points in polygon** algorithm from the Processing framework.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要计算每个网格单元格内的要素数量，我们可以使用fTools或处理核心插件。后者更灵活，允许我们自动化任务，如第8章所述，*使用处理模型自动化分析*。我们将使用处理框架中的**计数多边形中的点**算法。
- en: Tip
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: There is also a **Count unique points** algorithm in Processing that lets us
    count only points with unique attributes in the selected field. This may be useful
    when a more precise analysis is needed, for example, for mapping diversity.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理中还有一个**计数唯一点**算法，它允许我们只计算所选字段中具有唯一属性的点。当需要更精确的分析时，这可能很有用，例如，用于绘制多样性地图。
- en: 'In the Processing toolbox, find the **Count points in polygon** algorithm by
    typing its name in filter field at the top of the toolbox. Double-click on the
    algorithm name to open its dialog, and you will see this:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理工具箱中，通过在工具箱顶部的过滤器字段中输入其名称来找到**计数多边形中的点**算法。双击算法名称以打开其对话框，您将看到如下内容：
- en: '![Counting points in grid cells](img/image00437.jpeg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![在网格单元格中计数点](img/image00437.jpeg)'
- en: Select the grid layer created in the previous section as **Polygons** and the
    `trees` layer as **Points**. Enter **Count field name** or leave it unchanged.
    Don't forget the 10-character limitation for the shapefile field names! Finally,
    in the **Result** field, specify the location where the resulting layer will be
    stored, and click on the **Run** button to start the analysis. Keep in mind that
    this may take some time, as the `tree` layer contains many features and the grid
    size is relatively small.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 选择上一节创建的网格图层作为**多边形**，并将`trees`图层作为**点**。输入**计数字段名称**或保持不变。不要忘记形状文件字段名称的10个字符限制！最后，在**结果**字段中指定结果图层将存储的位置，并点击**运行**按钮以开始分析。请记住，这可能需要一些时间，因为`tree`图层包含许多要素，而网格大小相对较小。
- en: When an algorithm execution completes, a new grid layer, containing the field
    with the number of points in each cell, will be added to QGIS. We can safely remove
    the original grid layer from QGIS and from the filesystem, as it is no longer
    needed.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 当算法执行完成后，一个新的网格层将被添加到QGIS中，其中包含每个单元格中点的数量字段。我们可以安全地从QGIS和文件系统中删除原始网格层，因为它不再需要。
- en: 'For better visual representation of our data, we apply a graduated renderer
    to style cells according to the number of features in them. If necessary, go back
    to the *Developing styles for vector layers* section of [Chapter 2](part0021.xhtml#aid-K0RQ1
    "Chapter 2. Visualizing and Styling the Data"), *Visualizing and Styling the Data*.
    The result may look like this:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地展示我们的数据，我们根据单元格中的要素数量应用渐变渲染器来样式化单元格。如果需要，请回到[第2章](part0021.xhtml#aid-K0RQ1
    "第2章。可视化和样式化数据")的*为矢量图层开发样式*部分，*可视化和样式化数据*。结果可能看起来像这样：
- en: '![Counting points in grid cells](img/image00438.jpeg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![计算网格单元格中的点数](img/image00438.jpeg)'
- en: Removing redundant data
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 删除冗余数据
- en: If we look carefully at our grid layer and its attribute table, we will see
    that some grid cells are empty; there are no points in them. Such cells displayed
    with a very light green color in the preceding screenshot. It is clear that the
    empty cells are much more than the nonempty cells. Of course, we can simply hide
    such empty cells by assigning to them the same color as the map background, or
    by removing them from the renderer (assigning an empty style). But, is it better
    to remove them completely and reduce the file size?
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们仔细观察我们的网格层及其属性表，我们会发现一些网格单元是空的；它们里面没有点。这些单元在前面的截图中被显示为非常浅的绿色。很明显，空单元的数量远多于非空单元。当然，我们可以简单地通过将它们分配与地图背景相同的颜色或从渲染器中移除它们（分配一个空样式）来隐藏这些空单元。但是，完全移除它们并减小文件大小是否更好？
- en: 'There are two possible ways to remove empty cells: manually or by using one
    of the existing tools from the Processing toolbox. Each method has own advantages.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种可能的删除空单元的方法：手动或使用处理工具箱中的现有工具。每种方法都有其自身的优点。
- en: 'First, you will learn how to remove redundant data manually. This method can
    be used when you need to process only one layer and don''t want to create any
    temporary intermediate files. Also, it allows you to easily examine the features
    that will be removed. Let''s do it:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你将学习如何手动删除冗余数据。当您只需要处理一个图层且不想创建任何临时中间文件时，可以使用此方法。此外，它允许您轻松检查将要删除的要素。让我们来做：
- en: Select the `LAYER` layer from the QGIS layer tree. Then, click on the **Select
    features using an expression** button in the **Attributes** toolbar to open the
    **Select by expression** dialog.![Removing redundant data](img/image00439.jpeg)
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从QGIS图层树中选择`LAYER`图层。然后，点击**属性**工具栏中的**使用表达式选择要素**按钮以打开**按表达式选择**对话框。![删除冗余数据](img/image00439.jpeg)
- en: In the functions tree, under the **Fields and Values** group, find the `NUMPOINTS`
    field and double-click on it to add its name to the expression.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在函数树中，在**字段和值**组下，找到`NUMPOINTS`字段，并双击它以将其名称添加到表达式中。
- en: Then, click on **=** to add the equal to operator to the expression, and type
    `0` after it. The final expression will look like **"NUMPOINTS" = 0**.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击**=**以将等于运算符添加到表达式中，并在其后输入`0`。最终的表达式将看起来像**"NUMPOINTS" = 0**。
- en: Click on **Select** to select all the features that match your condition. The
    selected features will be highlighted in yellow so that you can check whether
    they are what you want.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**选择**以选择所有符合您条件的要素。选定的要素将以黄色突出显示，以便您可以检查它们是否是您想要的。
- en: Now, close the **Select by expression** dialog and open the layer attribute
    table by clicking on the **Open Attribute Table** button in the **Attributes**
    toolbar.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，关闭**按表达式选择**对话框，通过点击**属性**工具栏中的**打开属性表**按钮来打开图层属性表。
- en: Toggle editing mode by clicking on the corresponding button in the attribute
    table dialog, or by simply pressing *Ctrl* + *E*.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过在属性表对话框中点击相应的按钮或简单地按*Ctrl* + *E*来切换编辑模式。
- en: To remove the selected features, just press the *Delete* key or click on the
    **Delete selected features** button.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要删除选定的要素，只需按*Delete*键或点击**删除选定要素**按钮。
- en: Finally, turn editing mode off by pressing *Ctrl* + *E* again. Now our layer
    contains only nonempty cells and is much smaller in size.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，再次按*Ctrl* + *E*来关闭编辑模式。现在我们的图层只包含非空单元，并且大小大大减小。
- en: Deleting redundant data with Processing requires fewer steps than removing redundant
    data manually, but instead of updating the existing layer, it creates another
    file. The Processing framework is useful when you need to process many layers
    at once or want to automate some operations. To remove empty cells, we can use
    the **Extract by attribute** algorithm.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 使用处理移除冗余数据比手动移除冗余数据需要更少的步骤，但它不会更新现有图层，而是创建另一个文件。当你需要一次性处理多个图层或想要自动化某些操作时，处理框架非常有用。为了移除空单元格，我们可以使用**按属性提取**算法。
- en: Tip
  id: totrans-133
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: In our case, the comparison condition is very simple, so we use the **Extract
    by attribute** algorithm. When a more complex comparison condition that includes
    several attributes or some calculations is needed, it is better to use the **Select
    by expression** algorithm in combination with **Save selected features**.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，比较条件非常简单，所以我们使用**按属性提取**算法。当需要更复杂的比较条件，包括多个属性或某些计算时，最好使用**按表达式选择**算法并结合**保存所选要素**。
- en: '![Removing redundant data](img/image00440.jpeg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![移除冗余数据](img/image00440.jpeg)'
- en: 'Here are the necessary steps:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是必要的步骤：
- en: Find the **Extract by attribute** algorithm by typing its name in the filter
    field, and double-click on its name to open its dialog.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过在过滤器字段中输入其名称来查找**按属性提取**算法，并双击其名称以打开其对话框。
- en: In the **Input layer** combobox, select `LAYER`.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入图层**组合框中，选择`LAYER`。
- en: In the **Selection attribute** combobox, select the `NUMPOINTS` field, which
    stores the point count in each cell.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择属性**组合框中，选择`NUMPOINTS`字段，该字段存储每个单元格中的点数。
- en: In the **Operator** combobox select the not equal operator !`=`.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**运算符**组合框中选择不等于运算符 !`=`.
- en: Enter `0` in the **Value** field.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**值**字段中输入`0`。
- en: Specify the name of the output file in the **Output** field.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输出**字段中指定输出文件的名称。
- en: Now, we can press the **Run** button to start processing. When it is done, the
    new layer, with empty cells removed, will be added to QGIS, and we can remove
    the original layer. The new layer is much smaller, but still contains all of the
    information. Also, we can now set up styles more precisely and identify some distribution
    patterns that were not visible earlier.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以按下**运行**按钮开始处理。完成后，新的图层（移除了空单元格）将被添加到QGIS中，我们可以移除原始图层。新的图层要小得多，但仍然包含所有信息。此外，我们现在可以更精确地设置样式，并识别出之前不可见的某些分布模式。
- en: '![Removing redundant data](img/image00441.jpeg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![移除冗余数据](img/image00441.jpeg)'
- en: If we overlay a layer that has a street network with this density map, we can
    easily identify that the greenest street is the Ocean Parkway.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将具有这种密度的街道网络图层叠加到这个密度图上，我们可以轻松地识别出最绿色的街道是Ocean Parkway。
- en: The result looks great, but performing all of these steps manually is not very
    comfortable. Also, there are a number of intermediate layers that can, and should,
    be removed. Fortunately, QGIS allows us to automate such operations with the Processing
    Graphical Modeler. Refer to [Chapter 8](part0062.xhtml#aid-1R42S1 "Chapter 8. Automating
    Analysis with Processing Models"), *Automating Analysis with Processing Models*,
    to learn how to create models and use them.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 结果看起来很棒，但手动执行所有这些步骤并不舒服。此外，还有许多中间图层可以，也应该被移除。幸运的是，QGIS允许我们通过处理图形模型器自动化此类操作。请参阅[第8章](part0062.xhtml#aid-1R42S1
    "第8章。使用处理模型自动化分析")，*使用处理模型自动化分析*，了解如何创建模型并使用它们。
- en: Summary
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we covered the analysis of dense-point datasets. You learned
    how to create raster heat maps with the help of the QGIS Heatmap plugin. Then,
    we covered analysis of heat maps and data extraction from them.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了密集点数据集的分析。你学习了如何借助QGIS热图插件创建栅格热图。然后，我们介绍了热图分析和从其中提取数据。
- en: You also familiarized yourself with an alternative and popular technique for
    displaying dense datasets, called binning, and you learned how to perform hexbinning
    (a kind of binning technique) in QGIS using the Processing framework.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 你还熟悉了一种用于显示密集数据集的替代且流行的技术，称为分箱，并学习了如何在QGIS中使用处理框架执行六分箱（一种分箱技术）。
