- en: Making Predictive Models in Healthcare
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在医疗领域构建预测模型
- en: This chapter is intended for all audiences and is an integral part of this book.
    We will demonstrate how to build predictive models for healthcare using example
    data and an example machine learning problem. We will preprocess the data one
    feature at a time. By the end of this chapter, you will understand how to prepare
    and fit a machine learning model to a clinical dataset.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章面向所有读者，是本书的核心内容之一。我们将通过示例数据和机器学习问题，演示如何为医疗领域构建预测模型。我们将一次处理一个特征的数据预处理。到本章结束时，你将理解如何准备并拟合一个机器学习模型到临床数据集。
- en: Introduction to predictive analytics in healthcare
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 医疗预测分析简介
- en: 'In [Chapter 1](b15b2b73-d2bb-410f-ab55-5f0f1e91730e.xhtml), *Introduction to
    Healthcare Analytics,* we discussed the three subcomponents of analytics: descriptive
    analytics, predictive analytics, and prescriptive analytics. Predictive and prescriptive
    analytics form the heart of healthcare''s mission to improve care, cost, and outcomes.
    That is because if we can predict that an adverse event is likely in the future,
    we can divert our scarce resources toward preventing the adverse event from occurring.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第1章](b15b2b73-d2bb-410f-ab55-5f0f1e91730e.xhtml)《*医疗分析简介*》中，我们讨论了分析的三个子组成部分：描述性分析、预测性分析和规范性分析。预测性分析和规范性分析是医疗领域提升护理质量、降低成本和改善结果的核心。这是因为如果我们能够预测未来可能发生的不良事件，我们就可以将我们有限的资源转向预防这些不良事件的发生。
- en: What are some of the adverse events we can predict (and then prevent) in healthcare?
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以预测（并且随后预防）的医疗领域中的一些不良事件有哪些？
- en: '**Deaths**: Obviously, any death that is preventable or foreseeable should
    be avoided. Once a death is predicted to occur, preventative actions may include
    directing more nurses toward that patient, hiring more consultants for the case,
    or speaking to the family about options earlier rather than later.'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**死亡**：显然，任何可以预防或预测的死亡都应该避免。一旦预测到死亡的发生，预防措施可能包括将更多护士指派给该患者、为该案例聘请更多顾问，或尽早与家属沟通可选方案，而不是等到最后一刻。'
- en: '**Adverse clinical events**: These are events that are not synonymous with
    deaths, but highly increase the chances of morbidity and mortality. Morbidity
    refers to complications, while mortality refers to death. Examples of adverse
    clinical events include heart attacks, heart failure exacerbations, COPD exacerbations,
    pneumonia, and falls. Patients in which adverse events are likely could be candidates
    for more nursing care or for prophylactic therapies.'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不良临床事件**：这些事件并不等同于死亡，但会大大增加发病率和死亡率的可能性。发病率指的是并发症，而死亡率则指死亡。不良临床事件的例子包括心脏病发作、心力衰竭加重、慢性阻塞性肺病（COPD）加重、肺炎和跌倒。那些可能发生不良事件的患者，可能是需要更多护理或预防性治疗的候选人。'
- en: '**Readmissions**: Readmissions don''t present an obvious danger to patients;
    however, they are costly, so preventable readmissions should, therefore, be avoided.
    Furthermore, readmission reduction is highly incentivized by the Centers for Medicare
    and Medicaid Services, as we saw in [Chapter 6](023c1d7e-f3f0-42e6-a2be-64bd5ba4ab80.xhtml), *Measuring
    Healthcare Quality*. Preventative actions include assigning social workers and
    case managers to high-risk patients to assure that they are following up with
    outpatient providers and buying needed prescriptions.'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**再入院**：再入院并不会直接对患者构成明显的威胁，但它们是昂贵的，因此应尽量避免可预防的再入院。此外，减少再入院是美国医疗保险和医疗补助服务中心（CMS）的一个重要激励目标，正如我们在[第6章](023c1d7e-f3f0-42e6-a2be-64bd5ba4ab80.xhtml)《*衡量医疗质量*》中看到的那样。预防性措施包括为高风险患者安排社会工作者和个案管理人员，确保他们在门诊提供者那里跟进，并购买所需的处方。'
- en: '**High utilization**: Predicting patients who are likely to incur high amounts
    of medical spending again could potentially reduce costs by assigning more care
    members to their team and ensuring frequent outpatient check-ins and follow-ups.'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高利用率**：预测那些可能再次发生大量医疗支出的患者，可能通过为他们的团队分配更多护理成员并确保频繁的门诊检查和随访，从而降低成本。'
- en: Now that we've answered the "What?" question, the next question is, "How?" In
    other words, how do we make predictions about which care providers can act?
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经回答了“是什么？”的问题，下一个问题是，“怎么做？”换句话说，我们如何预测哪些护理提供者可以采取行动？
- en: '**First, we need data**: The provider should send you their historical patient
    data. The data can be claims data, clinical transcripts, a dump of EHR records,
    or some combination of these. Whatever the type of data, it should eventually
    be able to be molded into a tabular format, in which each row represents a patient/encounter
    and each column represents a particular feature of that patient/encounter.'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**首先，我们需要数据**：医疗服务提供者应当将其历史患者数据发送给你。数据可以是索赔数据、临床记录、电子健康记录（EHR）记录的导出，或这些数据的某种组合。无论数据类型如何，它最终应该能够转化为表格格式，其中每一行代表一个患者/就诊，每一列代表该患者/就诊的某个特征。'
- en: '**Using some of the data, we train a predictive model**: In [Chapter 3](46c83498-cb6e-45b4-ac39-6875a8d32400.xhtml),
    *Machine Learning Foundations*, we learned about what exactly we are doing when
    we train predictive models, and how the general modeling pipeline works.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用部分数据，我们训练一个预测模型**：在[第3章](46c83498-cb6e-45b4-ac39-6875a8d32400.xhtml)《机器学习基础》中，我们学习了在训练预测模型时到底在做什么，以及整个建模流程如何运作。'
- en: '**Using some of the data, we test our model''s performance**: Assessing the
    performance of our model is important for setting the expectations of the provider
    as to how accurate the model is.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用部分数据，我们测试模型的表现**：评估我们模型的性能对于设定医疗服务提供者对模型准确性的预期非常重要。'
- en: '**We then deploy the model into a production environment and provide live predictions
    for patients on a routine basis**: At this stage, there should be a periodic flow
    of data from the provider to the analytics firm. The firm then responds with regularly
    scheduled predictions on those patients.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**然后，我们将模型部署到生产环境中，并为患者提供定期的实时预测**：在这一阶段，应当有来自医疗服务提供者的数据定期流入到分析公司。公司随后会定期提供这些患者的预测结果。'
- en: In the remainder of the chapter, we will go through the "How?" of building a
    predictive model for healthcare. First, we will describe our mock modeling task.
    Then, we will describe and obtain the publicly available dataset. After that,
    we will preprocess the dataset and train predictive models using different machine
    learning algorithms. Finally, we will assess the performance of our model. While
    we will not be using our models to make actual predictions on live data, we will
    describe the steps necessary for doing so.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的剩余部分，我们将介绍如何构建医疗健康预测模型。首先，我们将描述我们的模拟建模任务。接着，我们将描述并获取公开可用的数据集。然后，我们将对数据集进行预处理，并使用不同的机器学习算法训练预测模型。最后，我们将评估我们模型的表现。虽然我们不会使用我们的模型对实时数据进行实际预测，但我们会描述实现这一目标所需的步骤。
- en: Our modeling task – predicting discharge statuses for ED patients
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 我们的建模任务——预测急诊室患者的出院状态
- en: Every year, millions of patients use emergency department facilities across
    the nation. The resources of these facilities have to be managed properly—if there
    is a large influx of patients at any given time, the staff and the available rooms
    should be increased accordingly. The mismatch between resources and patient influx
    could lead to wasted money and suboptimal care.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 每年，全国有数百万患者使用急诊科设施。这些设施的资源必须得到妥善管理——如果在某个时间点出现大量患者涌入，医院的工作人员和可用病房应当相应增加。资源与患者涌入之间的不匹配可能会导致浪费资金和提供不理想的护理。
- en: In this context, we introduce our example modeling task —predicting discharge
    statuses for patients presenting to the emergency room. The discharge status refers
    to whether patients are admitted to the hospital or sent home. Usually, the more
    serious cases are admitted to the hospital. Therefore, we are attempting to predict
    the outcome of the ED visit early on in the patient stay.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个背景下，我们介绍了我们的示例建模任务——预测急诊室就诊患者的出院状态。出院状态指的是患者是被住院还是被送回家。通常，更严重的病例会被住院。因此，我们试图在患者住院期间尽早预测急诊就诊的结果。
- en: With such a model, the workflow of the hospital could be greatly improved, as
    well as resource flow. Many previous academic studies have looked at this problem
    (for an example, see Cameron et al., 2015).
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这样的模型，医院的工作流程和资源流动都可以得到极大改善。许多先前的学术研究已经探讨了这个问题（例如，见Cameron等人，2015年）。
- en: You may be wondering why we didn't pick a different modeling task, such as readmission
    modeling or predicting CHF exacerbations. For one thing, the publicly available
    clinical data is very limited. The dataset that we chose is an ED dataset; there
    are no publicly available inpatient datasets available that are free to download
    without registering. Nevertheless, the task that we have chosen will serve our
    purposes in demonstrating how predictive healthcare models can be built.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会想，为什么我们没有选择其他建模任务，比如再入院建模或预测充血性心力衰竭（CHF）加重。首先，公开可用的临床数据非常有限。我们选择的数据集是急诊科（ED）数据集；目前没有可以免费下载安装的住院数据集。尽管如此，我们选择的任务仍然能够展示如何构建预测性医疗模型。
- en: Obtaining the dataset
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取数据集
- en: In this section, we will provide step-by-step instructions for obtaining the
    data and its associated documentation.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将提供逐步的说明，教你如何获取数据及其相关文档。
- en: The NHAMCS dataset at a glance
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: NHAMCS 数据集概览
- en: The dataset we have chosen for this book is part of the **National Hospital
    Ambulatory Medical Care Survey** (**NHAMCS**) public use data. It is survey data
    published and maintained by the US **Center for Disease Control and Prevention**
    (**CDC**). The home page for this data set is [https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为本书选择的数据集是 **国家医院门诊医疗护理调查**（**NHAMCS**）公开使用数据的一部分。该数据集由美国 **疾病控制与预防中心**（**CDC**）发布并维护。该数据集的主页是
    [https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm)。
- en: The NHAMCS data is survey-based data; it is populated by surveys sent to patients
    and healthcare providers that were seen in the hospital for encounters.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NHAMCS 数据是基于调查的数据；它通过向曾在医院就诊的病人和医疗服务提供者发送调查问卷进行收集。
- en: The data files are in fixed-width format. In other words, they are text files
    in which each row is on a distinct line, and columns are each a set number of
    characters long. Information about the character length of each feature is available
    in the corresponding NHAMCS documentation.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据文件为定宽格式。换句话说，它们是文本文件，每行在一个独立的行上，每列的字符数是固定的。每个特征的字符长度信息可以在相应的 NHAMCS 文档中找到。
- en: There are different sets of files depending on whether the data is from outpatient
    encounters or emergency department visits. We will be using the ED format in this
    chapter.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据文件分为不同的集，具体取决于数据是否来自门诊就诊或急诊科就诊。我们将在本章中使用急诊科格式。
- en: The data comes with detailed documentation about the content of each feature.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据附带了有关每个特征内容的详细文档。
- en: Each row of the data represents a distinct ED patient encounter.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每一行数据代表一次独立的急诊科病人就诊。
- en: 'See the following table for a summary of the emergency department data files
    from NHAMCS that we will be using throughout this book:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅以下表格，了解我们将在本书中使用的 NHAMCS 急诊科数据文件的概要：
- en: '| **Filename** | **Data type and year** | **Number of rows (encounters)** |
    **Number of columns (features)** | **Broad feature categories** |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| **文件名** | **数据类型和年份** | **行数（就诊次数）** | **列数（特征数量）** | **广泛特征类别** |'
- en: '| ED2013 | ED Encounters; 2013 | 24,777 | 579 | Visit date and information,
    Demographics, Tobacco, Arrival means, Payment, Vital signs, Triage, ED relationship,
    Reason for visit, Injury, Diagnoses, Chronic conditions, Services performed, Providers
    seen, Disposition, Hospital admission, Imputed data, ED information, Socioeconomic
    data |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| ED2013 | 急诊科就诊；2013 | 24,777 | 579 | 就诊日期和信息、人口统计学、烟草使用、到达方式、支付方式、生命体征、分诊、急诊科关系、就诊原因、伤害、诊断、慢性病、执行的服务、见诊的医务人员、处置、住院、插补数据、急诊科信息、社会经济数据
    |'
- en: Downloading the NHAMCS data
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载 NHAMCS 数据
- en: 'The raw data files and supporting documentation are accessible from the CDC
    NHAMCS home page: [https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm)
    (the following screenshot). We recommend downloading all of the files into a directory
    dedicated to this book and its associated files. Also, remember which directories
    where they are downloaded to:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 原始数据文件和相关文档可以通过 CDC NHAMCS 主页访问：[https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm)（如下截图）。我们建议将所有文件下载到一个专门用于本书及其相关文件的目录中。此外，请记住文件下载到的目录位置：
- en: '![](img/e9ddefe9-bdc0-4a36-970d-4274b7783b58.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e9ddefe9-bdc0-4a36-970d-4274b7783b58.png)'
- en: Downloading the ED2013 file
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载 ED2013 文件
- en: 'The ED2013 file contains the raw data.  To download it:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ED2013 文件包含原始数据。要下载它：
- en: Navigate to the CDC NHAMCS homepage: [https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm).
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问CDC NHAMCS主页：[https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm)。
- en: 'Scroll to the middle of the page, to the Public-use Data Files: Downloadable
    Data Files heading.'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动页面，找到《公共数据文件：可下载数据文件》标题。
- en: Click on the link for NHAMCS. It should take you to the CDC's FTP website ([ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHAMCS](ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHAMCS)).
    This website is pictured in the following screenshot.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击NHAMCS链接。它将把您带到CDC的FTP网站([ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHAMCS](ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHAMCS))。该网站如下图所示。
- en: Find the file named `ED2013.zip`. Click on it. The file will start to download.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到名为`ED2013.zip`的文件。点击它，文件将开始下载。
- en: Navigate to the file in your File Explorer and unzip it. In the unzipped directory,
    you should see a file named `ED2013` with no extension. This is the data file.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件资源管理器中找到该文件并解压。解压后的目录中，您应看到一个名为`ED2013`的无扩展名文件。这就是数据文件。
- en: 'Move the ED2013 data file to the directory associated with the book-related
    files:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将ED2013数据文件移动到与书本相关的文件目录中：
- en: '![](img/d5e8aec1-9f4a-443b-8e4f-9fe145de903b.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d5e8aec1-9f4a-443b-8e4f-9fe145de903b.png)'
- en: Downloading the list of survey items – body_namcsopd.pdf
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载调查项目列表 – body_namcsopd.pdf
- en: 'Navigate to the CDC NHAMCS home page: [https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm).'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问CDC NHAMCS主页：[https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm)。
- en: Scroll to the middle of the page, to the List of Survey Items, 1973-2012 heading.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动页面，找到《调查项目列表，1973-2012》标题。
- en: Click on the link labeled NAMCS and NHAMCS Survey Content Brochure [Revised
    11/2012].
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击标签为NAMCS和NHAMCS调查内容手册[修订版11/2012]的链接。
- en: The link should take you to a PDF page at the [https://www.cdc.gov/nchs/data/ahcd/body_namcsopd.pdf](https://www.cdc.gov/nchs/data/ahcd/body_namcsopd.pdf) URL.
    This is the list of survey items.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 链接应将您带到位于[https://www.cdc.gov/nchs/data/ahcd/body_namcsopd.pdf](https://www.cdc.gov/nchs/data/ahcd/body_namcsopd.pdf)的PDF页面。这是调查项目的列表。
- en: Use your browser to download the file. Then use your File Explorer to move it
    to the desired directory.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用浏览器下载文件。然后使用文件资源管理器将其移动到目标目录。
- en: Downloading the documentation file – doc13_ed.pdf
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载文档文件 – doc13_ed.pdf
- en: 'Navigate to the CDC NHAMCS home page: [https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm).'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问CDC NHAMCS主页：[https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm](https://www.cdc.gov/nchs/ahcd/ahcd_questionnaires.htm)。
- en: Scroll to the middle of the page, to the Downloadable Documentation heading.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动页面，找到《可下载文档》标题。
- en: Click on the link for NHAMCS (1992-2014). It should take you to the CDC's documentation
    FTP website ([ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/NHAMCS](ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/NHAMCS)).
    This website is pictured in the following screenshot.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击NHAMCS（1992-2014）链接。它将把您带到CDC的文档FTP网站([ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/NHAMCS](ftp://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/NHAMCS))。该网站如下图所示。
- en: Find the file named `doc13_ed.pdf`. Click on it. A PDF should open in your browser.
    This PDF file contains the documentation for the ED2013 data file.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到名为`doc13_ed.pdf`的文件。点击它，PDF将在浏览器中打开。此PDF文件包含ED2013数据文件的文档。
- en: 'Use your browser to download the file. Then use your File Explorer to move
    it to the desired directory:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用浏览器下载文件。然后使用文件资源管理器将其移动到目标目录：
- en: '![](img/afd9e727-52c1-4415-8ffa-4cdd7004fb3d.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/afd9e727-52c1-4415-8ffa-4cdd7004fb3d.png)'
- en: Starting a Jupyter session
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动Jupyter会话
- en: 'Next, we will start a Jupyter session so that we can import our data into Python
    and make a machine learning model. A detailed example of creating a new Jupyter
    Notebook was presented in [Chapter 1](b15b2b73-d2bb-410f-ab55-5f0f1e91730e.xhtml),
    *Introduction to Healthcare Analytics*. Here are the steps:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将启动一个Jupyter会话，以便将数据导入Python并构建一个机器学习模型。[第1章](b15b2b73-d2bb-410f-ab55-5f0f1e91730e.xhtml)《*医疗分析入门*》中提供了创建新的Jupyter
    Notebook的详细示例。以下是步骤：
- en: Locate the Jupyter application on your computer and start it.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的计算机上找到Jupyter应用程序并启动它。
- en: In the new Jupyter tab that was opened in your default browser, navigate to
    the directory where you wish to save the notebook.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在默认浏览器中新打开的Jupyter标签页中，导航到您希望保存Notebook的目录。
- en: Locate the New drop-down menu on the upper right of the console, click it, and
    select Python 3.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在控制台的右上角找到“New”下拉菜单，点击它并选择 Python 3。
- en: You should see a new notebook, named Untitled.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该看到一个名为 Untitled 的新笔记本。
- en: To rename your notebook, click on the name of the notebook in the upper left.
    A cursor should appear. Type in the desired name. We have named our notebook `ED_predict`.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要重命名笔记本，请点击左上角笔记本的名称。一个光标应该会出现，输入所需的名称。我们将笔记本命名为 `ED_predict`。
- en: You are now ready to import the dataset into Jupyter.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在可以将数据集导入到 Jupyter 中了。
- en: Importing the dataset
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导入数据集
- en: 'Before we load the dataset, there are some important facts about the data that
    must be acknowledged:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在加载数据集之前，有一些关于数据的重要事实需要确认：
- en: The data is in a fixed-width format, meaning that there is no delimiter. Column
    widths will have to be specified manually.
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据是固定宽度格式，这意味着没有分隔符。列宽需要手动指定。
- en: There is no header row that has column names.
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有包含列名的标题行。
- en: If you were to open the data file using a text editor, you would see rows of
    data simply containing numbers.
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你使用文本编辑器打开数据文件，你会看到包含数字的行。
- en: Because column widths are necessary for importing `.fwf` files, we must import
    those *first* into our session. We have therefore made a helper `.csv` file, titled
    `ED_metadata.csv`, that contains the width, name, and variable type of each column.
    Our data only has 579 columns, so making such a file only took a couple of hours.
    If you have a bigger dataset, you may have to rely on automated width detection
    methods and/or more team members to do the grunt work of creating a schema for
    your data.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 因为导入 `.fwf` 文件需要列宽，我们必须先将这些列宽导入到我们的会话中。因此，我们创建了一个名为 `ED_metadata.csv` 的辅助 `.csv`
    文件，包含每列的宽度、名称和变量类型。我们的数据只有 579 列，所以创建这样的文件只花了几个小时。如果你的数据集更大，可能需要依赖自动宽度检测方法和/或更多团队成员来完成创建数据架构的繁重工作。
- en: Loading the metadata
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加载元数据
- en: 'With our first cell, let''s import the metadata and print a small preview of
    it:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个单元格中，让我们导入元数据并打印一个小的预览：
- en: '[PRE0]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'You should see the following output:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该看到以下输出：
- en: '[PRE1]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: So the `ED_metadata.csv` file simply is a comma-separated values file containing
    the width, column name, and variable type as specified in the documentation. This
    file can be downloaded from the code repository for this book.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，`ED_metadata.csv` 文件仅仅是一个包含宽度、列名和变量类型的逗号分隔值文件，具体细节可参考文档。此文件可以从本书的代码仓库下载。
- en: 'In the next cell, we convert the columns of the pandas DataFrame we imported
    into separate lists:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个单元格中，我们将导入的 pandas DataFrame 的列转换为单独的列表：
- en: '[PRE2]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Loading the ED dataset
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加载 ED 数据集
- en: 'Next, we import the contents of the fixed-width data file into Python as a
    pandas DataFrame composed of string columns, using the `widths` list created in
    the previous cell. We then name the columns using the `col_names` list:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将固定宽度数据文件的内容导入 Python，作为由字符串列组成的 pandas DataFrame，使用前一个单元格中创建的 `widths`
    列表。然后，我们使用 `col_names` 列表命名列：
- en: '[PRE3]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Let''s print a preview of our dataset to confirm it was imported correctly:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们打印数据集的预览，以确认它已正确导入：
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The output should look similar to the following:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 输出应类似于以下内容：
- en: '[PRE5]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Looking at the column values and their meanings in the documentation confirm
    that the data has been imported correctly. The `nan` values correspond to blank
    spaces in the data file.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 查看文档中列值及其含义，确认数据已正确导入。`nan` 值对应数据文件中的空白空间。
- en: 'Finally, as another check, let''s count the dimensions of the data file and
    confirm that there are 24,777 rows and 579 columns:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，作为另一个检查，让我们统计数据文件的维度，并确认有 24,777 行和 579 列：
- en: '[PRE7]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The output should look similar to the following:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 输出应类似于以下内容：
- en: '[PRE8]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Now that the data has been imported correctly, let's set up our response variable.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 现在数据已正确导入，让我们设置响应变量。
- en: Making the response variable
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建响应变量
- en: In some cases, the response variable that we are trying to predict may already
    be a separate well-defined column. In those cases, simply converting the response
    from a string to a numeric type before splitting the data into train and test
    sets will suffice.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，我们尝试预测的响应变量可能已经是一个单独且定义明确的列。在这些情况下，在将数据拆分为训练集和测试集之前，只需将响应变量从字符串转换为数字类型即可。
- en: 'In our specific modeling task, we are trying to predict which patients presenting
    to the ED will eventually be hospitalized. In our case, hospitalization encompasses:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的特定建模任务中，我们试图预测哪些前来急诊科的患者最终会住院。在我们的案例中，住院包括：
- en: Those admitted to an inpatient ward for further evaluation and treatment
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 那些被接收进住院病房以便进一步评估和治疗的人
- en: Those transferred to a different hospital (either psychiatric or non-psychiatric)
    for further treatment
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 那些被转送到其他医院（无论是精神病医院还是非精神病医院）以便进一步治疗的人
- en: Those admitted to the observation unit for further evaluation (whether they
    are eventually admitted or discharged after their observation unit stay)
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 那些被接收进入观察单元以进一步评估的人（无论他们最终是被接收还是在观察单元停留后被出院）
- en: 'Accordingly, we must do some data wrangling to assemble all of these various
    outcomes into a single response variable:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们必须进行一些数据处理，将所有这些不同的结果汇总成一个单一的响应变量：
- en: '[PRE9]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Let''s discuss the previous code example in detail:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细讨论一下之前的代码示例：
- en: The first line identifies the columns we would like to include in our final
    target variable by name. The target should equal `1` if the values for any of
    those columns is `1`.
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一行通过名称标识我们希望包含在最终目标变量中的列。如果这些列中的任何一列的值为 `1`，那么目标值应为 `1`。
- en: In Line 2, we convert the columns from the string to the numeric type.
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第2行，我们将列从字符串类型转换为数值类型。
- en: In Lines 3-5, we create a column called `ADMITTEMP` that contains the row-wise
    sum of the five target columns. We then create our final target column, `ADMITFINAL`,
    and set it equal to `1` when `ADMITTEMP` is `>= 1`.
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第3到第5行，我们创建了一个名为 `ADMITTEMP` 的列，它包含了五个目标列的逐行求和。然后我们创建了最终的目标列 `ADMITFINAL`，当
    `ADMITTEMP` 大于或等于 `1` 时，将其设置为 `1`。
- en: In Lines 6-7, we drop the five original response columns as well as the `ADMITTEMP`
    column since we now have our final response column.
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第6到第7行，我们删除了五个原始响应列以及 `ADMITTEMP` 列，因为我们现在已经有了最终的响应列。
- en: Splitting the data into train and test sets
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将数据拆分为训练集和测试集
- en: Now that we have our response variable, the next step is to split the dataset
    into train and test sets. In data science, the **training set** is the data that
    is used to determine the model coefficients. In the training phase, the model
    takes into account the predictor variable values together with the response value
    to "discover" the rules and the weights that will guide the prediction of new
    data. The **testing set** is then used to measure our model performance, as we
    discussed in [Chapter 3](46c83498-cb6e-45b4-ac39-6875a8d32400.xhtml), *Machine
    Learning Foundations*. Typical splits use 70-80% for the training data and 20-30%
    for the testing data (unless the dataset is very large, in which case a smaller
    percentage can be allotted toward the testing set).
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有了响应变量，下一步是将数据集分为训练集和测试集。在数据科学中，**训练集**是用来确定模型系数的数据。在训练阶段，模型会将预测变量的值与响应值一起考虑，以“发现”指导预测新数据的规则和权重。然后使用**测试集**来衡量我们模型的表现，正如我们在[第3章](46c83498-cb6e-45b4-ac39-6875a8d32400.xhtml)中讨论的，*机器学习基础*。典型的拆分比例是70%-80%用于训练数据，20%-30%用于测试数据（除非数据集非常大，在这种情况下可以分配较小比例的数据用于测试集）。
- en: Some practitioners also have a validation set that is used to train model parameters,
    such as the tree size in the random forest model or the lasso parameter in regularized
    logistic regression.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 一些实践者还会有一个验证集，用于训练模型参数，例如随机森林模型中的树大小或正则化逻辑回归中的套索参数。
- en: 'Fortunately, the `scikit-learn` library has a handy function called `train_test_split()`
    that takes care of the random splitting for us, when given the test set percentage.
    To use this function, we must first separate the target variable from the rest
    of the data, we do so as follows:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，`scikit-learn` 库提供了一个非常方便的函数 `train_test_split()`，它在给定测试集百分比时会自动处理随机拆分。要使用这个函数，我们必须首先将目标变量从其他数据中分离出来，具体做法如下：
- en: '[PRE10]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'After running the preceding code, `y` holds our response variable and `X` holds
    our dataset. We feed these two variables to the `train_test_split()` function,
    along with `0.25` for the `test_size` and a random state for reproducibility:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 运行前面的代码后，`y` 保存了我们的响应变量，`X` 保存了我们的数据集。我们将这两个变量传递给 `train_test_split()` 函数，同时设置
    `test_size` 为 `0.25`，并指定一个随机状态以确保结果可重现：
- en: '[PRE11]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The result is a 2 x 2 split: `X_train`, `X_test`, `y_train`, and `y_test`.
    We can now use `X_train` and `y_train` to train the model, and `X_test` and `y_test`
    to test the model performance.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个 2 x 2 的拆分：`X_train`、`X_test`、`y_train` 和 `y_test`。我们现在可以使用 `X_train` 和
    `y_train` 来训练模型，使用 `X_test` 和 `y_test` 来测试模型的性能。
- en: An important thing to remember is that during the preprocessing phase, any transformation
    made to the training set must also be performed on the testing set at test time,
    or otherwise, the model's output for the new data will be incorrect.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 一个重要的事情是要记住，在预处理阶段，任何对训练集所做的变换，在测试时也必须对测试集执行，否则模型对新数据的输出将是错误的。
- en: 'As a sanity check and also to detect any target variable imbalance, let''s
    check the number of positive and negative responses in the response variable:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个简单检查，并且为了检测目标变量的不平衡情况，让我们检查响应变量中的正负响应数量：
- en: '[PRE12]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The output is as follows:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE13]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Our result indicates that approximately 1 out of 7 observations in the test
    set have a positive response. While it is not a perfectly balanced dataset (in
    which case the ratio would be 1 out of 2), it is not so imbalanced that we need
    to do any upsampling or downsampling of the data. Let's proceed with preprocessing
    the predictors.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的结果表明，测试集中的大约1/7的观测值具有正响应。虽然这不是一个完美平衡的数据集（在这种情况下，比例应该是1/2），但它也不至于不平衡到需要进行任何上采样或下采样的数据处理。我们继续进行预测变量的预处理。
- en: Preprocessing the predictor variables
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测变量的预处理
- en: Let's take a look at specific groups of predictor variables that commonly pop
    up in healthcare data.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看在医疗数据中常见的一些特定的预测变量组。
- en: Visit information
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问信息
- en: The first feature category in the ED2013 dataset contains information about
    the timing of the visit. Variables such as month, day of week, and arrival time
    are included here. Also included are the waiting time and length of visit variables
    (both in minutes).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: ED2013数据集中的第一个特征类别包含有关就诊时间的信息。包括月份、星期几和到达时间等变量。还包括等待时间和就诊时长变量（均以分钟为单位）。
- en: Month
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 月份
- en: 'Let''s analyze the `VMONTH` predictor in more detail. The following code prints
    all the values in the training set and their counts:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更详细地分析`VMONTH`预测变量。以下代码打印出训练集中的所有值及其计数：
- en: '[PRE14]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The output is as follows:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE15]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: We can now see that the months are numbered from `01` to `12`, as it says in
    the documentation, and that each month has representation.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以看到，月份被编号为`01`到`12`，正如文档中所说的，每个月都有代表。
- en: 'One part of preprocessing the data is performing **feature engineering **– that
    is, combining or transforming the features in some way to come up with new features
    that are more predictive than the previous ones. For example, suppose we had a
    hypothesis that ED visitors tend to be admitted more often during the winter months.
    We could make a predictor called `WINTER` that is a combination of the `VMONTH`
    predictor such that the value is `1` only if the patient came during December,
    January, February, or March. We have done that in the following cell. Later on,
    we can test this hypothesis when we assess variable importance while making our
    machine learning models:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 数据预处理的一部分是进行**特征工程**——也就是说，以某种方式组合或转化特征，生成比之前更具预测性的新的特征。例如，假设我们有一个假设，急诊科患者在冬季月份的住院率较高。我们可以创建一个名为`WINTER`的预测变量，它是`VMONTH`预测变量的组合，只有当患者是在12月、1月、2月或3月就诊时，值为`1`。我们在下面的单元中做到了这一点。稍后，我们可以在评估变量重要性时检验这个假设，进行机器学习建模时：
- en: '[PRE16]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'As an informal test, let''s print out the distribution of the `WINTER` variable
    and confirm that it is the sum of the preceding four winter months:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个非正式的测试，让我们打印出`WINTER`变量的分布，并确认它是前四个月冬季月份的总和：
- en: '[PRE17]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The output is as follows:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE18]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Sure enough, we get `6113 = 1551 + 1757 + 1396 + 1409`, confirming that we engineered
    the feature correctly. We will see other examples of feature engineering throughout
    this chapter.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 果然，我们得到了`6113 = 1551 + 1757 + 1396 + 1409`，确认我们正确地做了特征工程。在本章中，我们将看到其他特征工程的例子。
- en: Day of the week
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 星期几
- en: 'As a sanity check that the data was imported correctly, let''s also explore
    the `VDAYR` variable, which indicates the day of the week that the patient visit
    occurred:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 作为数据导入正确性的一个简单检查，让我们还探讨一下`VDAYR`变量，它表示患者就诊发生的星期几：
- en: '[PRE19]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The output is as follows:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE20]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: As we would expect, there are seven possible values, and the observations are
    relatively uniformly distributed across the possible values. We could get fancy
    and engineer a `WEEKEND` feature, but engineering additional features can be very
    time-consuming and memory-consuming, often for minimal gain. We'll leave that
    exercise up to the reader.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们预期的那样，存在七个可能的值，且这些观察值相对均匀地分布在所有可能值中。我们可以尝试制作一个`WEEKEND`特征，但特征工程可能非常耗时和占用内存，且通常收益甚微。这个练习我们留给读者去做。
- en: Arrival time
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 到达时间
- en: 'The arrival time is another visit information variable included in the data.
    However, in its raw form, it will probably be unhelpful, since it can be an integer
    between 0 and 2,359\. Let''s make a `NIGHT` variable that is only positive when
    the patient comes in between 8 PM and 8 AM. Our reasoning behind creating this
    variable is the hypothesis that patients arriving at the ED outside of regular
    hours have more serious illnesses and will, therefore, be admitted more often
    to the hospital. We can use the following code to make the `NIGHT` variable:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 到达时间是数据中另一个包含的就诊信息变量。然而，在原始形式下，它可能没有什么用处，因为它是一个介于0到2,359之间的整数。让我们创建一个`NIGHT`变量，只有当患者在晚上8点到早上8点之间到达时，才为正。我们创建这个变量的原因是假设那些在非正常时间到达急诊科的患者病情更严重，因此更有可能被收治入院。我们可以使用以下代码来创建`NIGHT`变量：
- en: '[PRE21]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: In the preceding example, we first code a function that returns `1` if the patient
    has arrived between 8 PM and 8 AM, and returns `0` otherwise. We then use the
    `apply()` function of pandas to "apply" this function to the `ARRTIME` column
    and make the `NIGHT` column. We then drop the original `ARRTIME` column since
    it is not useful in its raw form.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，我们首先编写一个函数，如果患者的到达时间在晚上8点到早上8点之间，则返回`1`，否则返回`0`。然后我们使用pandas的`apply()`函数将这个函数“应用”到`ARRTIME`列，生成`NIGHT`列。接着，我们删除原始的`ARRTIME`列，因为它的原始形式没有用处。
- en: Wait time
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 等待时间
- en: The wait time spent in the ED is yet another visit information variable that
    could reasonably be correlated with the target variable. Hypothetically, patients
    with more serious illnesses could appear to be more symptomatic to the triage
    nurse and therefore assigned more critical triage scores, causing them to have
    smaller waiting times than people with less serious illnesses.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在急诊科的等待时间是另一个可能与目标变量相关的就诊信息变量。假设患有更严重疾病的患者可能在分诊护士眼中表现得更加有症状，因此可能会被分配更高的分诊分数，从而导致其等待时间比那些病情较轻的患者更短。
- en: In the documentation, it states that the `WAITTIME` variable may take values
    of `-9` and `-7` when blank and not applicable, respectively. Whenever a continuous
    variable has a placeholder value like this, we *must* do some sort of imputation
    to remove the placeholder values. Otherwise, the model will think that the patient
    had a wait time of `-7` minutes, and the whole model will be adjusted adversely.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在文档中，提到`WAITTIME`变量在空白和不可用时分别可能取值`-9`和`-7`。每当一个连续变量有这样的占位符值时，我们*必须*进行某种填补操作，以去除占位符值。否则，模型会认为患者的等待时间是`-7`分钟，从而导致整个模型的调整不利。
- en: In this case, mean imputation is the appropriate action. **Mean imputation**
    replaces those negative values with the mean of the rest of the dataset, so that
    during modeling time those observations will have no effect in determining the
    coefficient for this variable.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，均值填补是合适的操作。**均值填补**将这些负值替换为数据集其余部分的均值，这样在建模过程中，这些观察值就不会对该变量的系数产生影响。
- en: 'To perform mean imputation, we first convert the columns to the numeric type:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 为了执行均值填补，首先将列转换为数值类型：
- en: '[PRE22]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Next, we write a function, called `mean_impute_values()`, that removes values
    of `-7` and `-9` from the column and replaces them with the mean of the column.
    We make the function generalizable so that it may be used later on in our preprocessing
    for other columns:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们编写一个名为`mean_impute_values()`的函数，该函数移除`-7`和`-9`的值，并将它们替换为该列的均值。我们将这个函数设计为通用型，以便以后在预处理其他列时使用：
- en: '[PRE23]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: We then call the function on the data, and we are finished. Following that,
    we will confirm that this function has been applied correctly, but first, let's
    go over a few more variables.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们在数据上调用这个函数，完成这个过程。接下来，我们将确认该函数是否已正确应用，但在此之前，让我们再看一下几个其他变量。
- en: Other visit information
  id: totrans-156
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他就诊信息
- en: 'The final visit information variable in this dataset is the length of the visit
    variable (`LOV`). However, the length of visit is determined only after the entire
    ED visit, and by that time, the decision whether to admit or discharge will have
    already been made. It is important to drop variables that won''t be available
    during the time of the prediction, and for that reason, we must drop `LOV`. We
    do so as shown in the following code:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这个数据集中的最后一个访问信息变量是访问时长变量（`LOV`）。然而，访问时长只有在整个急诊访问结束后才能确定，而那时是否接收住院或者出院的决定已经做出。因此，必须删除那些在预测时无法获得的变量，出于这个原因，我们需要删除`LOV`。我们可以按照以下代码执行：
- en: '[PRE24]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Now that we've finished tackling the visit information, let's move on to demographic
    variables.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了访问信息的处理，接下来让我们转向人口统计变量。
- en: Demographic variables
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 人口统计变量
- en: In healthcare, demographic variables are usually associated with outcomes. Age,
    sex, and race are major demographic variables in healthcare. In this dataset,
    ethnicity and residence type have also been included. Let's sort out these variables
    as follows.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在医疗领域，人口统计变量通常与结果相关联。年龄、性别和种族是医疗领域中的主要人口统计变量。在这个数据集中，还包含了族裔和居住类型变量。让我们按如下方式整理这些变量。
- en: Age
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 年龄
- en: As people get older, one can expect them to be sicker and to be admitted to
    the hospital more frequently. This hypothesis will be tested once we see the variable
    importance results of our model.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 随着人们年龄的增长，我们可以预期他们的健康状况会变差，并且更频繁地住院。这个假设将在我们查看模型的变量重要性结果后进行验证。
- en: 'There are three variables that reflect the age in the dataset. `AGE` is an
    integer value that gives the age in years. `AGEDAYS` is an integer value that
    gives the age in days if the patient is less than 1 year old. `AGER` is the age
    variable, except that it has been converted to a categorical variable. Let''s
    convert the `AGE` variable to a numeric type, leave the `AGER` variable as is,
    and remove the `AGEDAYS` variable since it will be not applicable in the vast
    majority of cases:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集中有三个变量反映年龄。`AGE`是一个整数值，表示以年为单位的年龄。`AGEDAYS`是一个整数值，如果患者不到1岁，表示以天为单位的年龄。`AGER`是年龄变量，但它已经被转换为分类变量。我们将`AGE`变量转换为数值类型，保持`AGER`变量不变，并删除`AGEDAYS`变量，因为在绝大多数情况下它不适用：
- en: '[PRE25]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Sex
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 性别
- en: In healthcare, women have often been found to have longer life expectancies
    and be healthier overall than men, so let's include the `SEX` variable in our
    model. It is already categorical, so we can leave it as is.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在医疗领域，通常发现女性的预期寿命较长，整体健康状况也优于男性，因此我们要将`SEX`变量纳入我们的模型。它已经是分类变量，因此可以保持不变。
- en: Ethnicity and race
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 种族和族裔
- en: 'Ethnicity (Hispanic/Latino versus non-Hispanic/Latino) and race are also included
    in the data. Often, races that are prone to poor socioeconomic status have worse
    outcomes in healthcare. Let''s leave the unimputed ethnicity and race variables
    (`ETHUN` and `RACEUN`) as is. We can remove the redundant `RACER` variable as
    well as the imputed versions of ethnicity and race (`ETHIM` and `RACERETH`):'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 数据中还包含了种族（西班牙裔/拉丁裔与非西班牙裔/拉丁裔）和族裔信息。通常，容易处于低社会经济地位的种族在医疗中的结果较差。让我们保持未填充的种族和族裔变量（`ETHUN`和`RACEUN`）不变。我们可以删除冗余的`RACER`变量以及填充后的种族和族裔变量（`ETHIM`和`RACERETH`）：
- en: '[PRE26]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Other demographic information
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他人口统计信息
- en: The patient residence is included in the data. Since it is categorical, there
    is no need to alter it.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 患者居住地包含在数据中。由于它是分类变量，因此无需做任何更改。
- en: 'Let''s see what we have so far and print the first five rows using the `head()`
    function:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们查看目前为止的结果，并使用`head()`函数打印前五行：
- en: '[PRE27]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Scrolling horizontally through the output, you should confirm that all of our
    transformations and variable drops have been done correctly.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在输出中横向滚动时，你应该确认我们的所有转换和变量删除操作已正确执行。
- en: Triage variables
  id: totrans-176
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分诊变量
- en: Triage variables are important for emergency department modeling tasks. Triage
    encompasses assigning a risk score to a patient based on their initial presentation
    and vital signs. It is usually completed by a nurse specialized to perform triage
    and encompasses both subjective and objective information. Triage scores usually
    range from 1 (critical) to 5 (non-urgent). The `IMMEDR` variable (item number
    34 in the documentation) is the triage score in this dataset. We will certainly
    include it.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 分诊变量对急诊科建模任务非常重要。分诊包括根据患者的初始表现和生命体征为患者分配风险评分。通常由专业分诊护士完成，涵盖了主观和客观信息。分诊评分通常从1（危急）到5（非急诊）。`IMMEDR`变量（文档中的第34项）是本数据集中的分诊评分。我们当然会包括它。
- en: Other variables we can categorize as triage variables include whether or not
    the patient arrived via EMS (`ARREMS`; usually correlated with worse outcomes)
    and whether or not the patient has been seen and discharged within the last 72
    hours (`SEEN72`). We will also include these variables in our model.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将一些其他变量归类为分诊变量，包括患者是否通过急救医疗服务（`ARREMS`）到达（通常与较差的结果相关）以及患者是否在过去72小时内已经接受并出院（`SEEN72`）。我们也将在我们的模型中包括这些变量。
- en: Financial variables
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 财务变量
- en: 'The method of payment of the patient is commonly included in healthcare datasets
    and usually, certain payment types are associated with better or worse outcomes.
    Patients with no expected source of payment (`NOPAY`), or with Medicaid (`PAYMCAID`)
    or Medicare (`PAYMCARE`), typically are less healthy than patients with private
    insurance (`PAYPRIV`) or who are paying on their own (`PAYSELF`). Let''s include
    all of the financial variables except for the `PAYTYPER` variable, which is just
    a nonbinary expansion of the other payment variables:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 患者的支付方式通常包含在医疗数据集中，且通常某些支付方式与更好或更差的结果相关。没有预期支付来源（`NOPAY`）、或通过医疗补助（`PAYMCAID`）或医疗保险（`PAYMCARE`）支付的患者，通常比拥有私人保险（`PAYPRIV`）或自行支付（`PAYSELF`）的患者健康状况差。让我们包括所有财务变量，除了`PAYTYPER`变量，它只是其他支付变量的非二元扩展：
- en: '[PRE28]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Vital signs
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生命体征
- en: 'Vital signs are an important source of information for patients in healthcare
    modeling, for many reasons:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 生命体征是医疗建模中患者信息的重要来源，原因有很多：
- en: They are easy to collect.
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们易于收集。
- en: They are typically available at the beginning of the clinical encounter.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们通常在临床接诊初期可用。
- en: They are objective.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们是客观的。
- en: They are numerical indicators of patient health.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们是患者健康的数值指标。
- en: The vital signs included in this dataset are temperature, pulse, respiratory
    rate, blood pressure (systolic and diastolic), oxygen saturation percentage, and
    whether they are on oxygen. Height and weight are commonly also categorized as
    vital signs, but they are not included in our data. Let's take a look at each
    vital sign in turn.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 本数据集中包括的生命体征有体温、脉搏、呼吸频率、血压（收缩压和舒张压）、血氧饱和度百分比，以及是否使用氧气。身高和体重通常也被归类为生命体征，但它们不包括在我们的数据中。让我们逐一查看每项生命体征。
- en: Temperature
  id: totrans-189
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 体温
- en: '**Temperature** is usually measured using a thermometer early during the patient
    encounter and can be recorded in degrees Celsius or Fahrenheit. A temperature
    of 98.6° F (37.1° C) is usually considered a normal body temperature. Temperatures
    markedly above this range can be termed as **fever** or **hyperthermia** and usually
    reflect infection, inflammation, or environmental overexposure to the sun. Temperatures
    below normal by a certain amount are termed **hypothermia** and usually reflect
    environmental exposure to cold. The more the temperature deviates from normal,
    usually the more serious the illness is.'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '**体温**通常在患者接诊初期使用温度计测量，可以记录为摄氏度或华氏度。98.6°F（37.1°C）的体温通常被认为是正常体温。显著高于此范围的体温可以称为**发热**或**高热**，通常反映感染、炎症或环境过度暴露于阳光下。低于正常体温一定程度的情况被称为**低体温**，通常反映暴露于寒冷的环境。体温偏离正常值越多，通常意味着疾病越严重。'
- en: 'In our dataset, the `TEMPF` temperature has been multiplied by 10 and stored
    as an integer. Also, some values are blank (indicated by `-9`) and we must impute
    those, since temperature is a continuous variable. Following that, we first convert
    the temperature to a numeric type, use our previously written `mean_impute_values()`
    function to impute the missing values in `TEMPF`, and then use a lambda function
    to divide all temperatures by `10`:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的数据集中，`TEMPF`温度被乘以10并以整数形式存储。同时，一些值为空（用`-9`表示），我们必须填补这些空值，因为温度是一个连续变量。接着，我们首先将温度转换为数值类型，使用我们之前写的`mean_impute_values()`函数填补`TEMPF`中的缺失值，然后使用lambda函数将所有温度值除以`10`：
- en: '[PRE29]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Let''s print out 30 values of just this column to confirm that our processing
    was performed correctly:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们打印出此列的30个值，以确认我们的处理是否正确：
- en: '[PRE30]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'The output is as follows:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 输出结果如下：
- en: '[PRE31]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: We can see that the temperatures are now of the float type and that they are
    not multiplied by 10\. Also, we see that the mean value, `98.282103`, has been
    substituted where values were previously blank. Let's move on to the next variable.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到温度现在是浮动类型，并且它们没有被乘以10。同时，我们看到均值`98.282103`已经代替了之前为空的值。接下来我们来看下一个变量。
- en: Pulse
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 脉搏
- en: '**Pulse** measures the frequency of the heartbeat in the patient. The normal
    range is 60-100\. Having a pulse faster than `100` is termed **tachycardia** and
    usually indicates some underlying cardiac dysfunction, volume depletion, or infection
    (sepsis). A pulse lower than `60` is termed **bradycardia**.'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '**脉搏**测量患者心跳的频率。正常范围为60-100。脉搏超过`100`被称为**心动过速**，通常表明潜在的心脏功能障碍、血容量减少或感染（败血症）。脉搏低于`60`被称为**心动过缓**。'
- en: 'We must use mean imputation to impute the missing values. First, we convert
    the pulse to a numeric type:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须使用均值插补法来填补缺失值。首先，我们将脉搏转换为数值类型：
- en: '[PRE32]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Then, we write a `mean_impute_vitals()` function that is similar to our `mean_impute_values()`
    function, except that the placeholder values have been changed from `-7` and `-9`
    to `-998` and `-9`:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们编写一个类似于`mean_impute_values()`的`mean_impute_vitals()`函数，只是占位符值从`-7`和`-9`变为`-998`和`-9`：
- en: '[PRE33]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Respiratory rate
  id: totrans-204
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 呼吸频率
- en: The respiratory rate indicates the rate at which the person takes breaths. 18-20
    is considered normal. Tachypnea (abnormally elevated respiratory rate) is seen
    commonly in clinical practice and indicates an oxygen shortage in the body, usually
    due to either a cardiac or pulmonary cause. Bradypnea is an abnormally low respiratory
    rate.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 呼吸频率表示一个人每分钟的呼吸次数。18-20次被认为是正常的。呼吸急促（异常增高的呼吸频率）在临床实践中常见，通常表明体内缺氧，通常由于心脏或肺部问题。缓呼吸是指异常低的呼吸频率。
- en: 'In the following code, we convert the `RESPR` variable to a numeric type and
    then perform a mean imputation of the missing values:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码中，我们将`RESPR`变量转换为数值类型，然后对缺失值进行均值插补：
- en: '[PRE34]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Blood pressure
  id: totrans-208
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 血压
- en: The blood pressure measures the amount of force per unit area that the blood
    exerts on the blood vessel walls. Blood pressure consists of two numbers – the
    **systolic blood pressure** (blood pressure during the systolic phase of the heartbeat)
    and the **diastolic blood pressure** (blood pressure during the diastolic phase).
    Normal blood pressure is usually somewhere between 110 to 120 mmHg for the systolic
    blood pressure and 70 to 80 mmHg for the diastolic blood pressure. Elevated blood
    pressure is called **hypertension**. The most common cause of elevated blood pressure
    is essential hypertension, which is primarily genetic (but multifactorial). Low
    blood pressure is called **hypotension**. Both hypertension and hypotension have
    complex etiologies that are often difficult to identify.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 血压测量血液对血管壁施加的单位面积的压力。血压由两个数字组成——**收缩压**（心跳收缩期的血压）和**舒张压**（心跳舒张期的血压）。正常的血压通常在收缩压110到120
    mmHg之间，舒张压在70到80 mmHg之间。升高的血压称为**高血压**。高血压最常见的原因是原发性高血压，主要是遗传因素（但是多因素的）。低血压称为**低血压**。高血压和低血压都有复杂的病因，通常难以识别。
- en: 'In our dataset, systolic and diastolic blood pressure are in separate columns
    (`BPSYS` and `BPDIAS`, respectively). First, we process the systolic blood pressure
    by converting it to a numeric type and mean imputing the missing values as we
    have done already for other columns:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的数据集中，收缩压和舒张压分别位于单独的列中（`BPSYS`和`BPDIAS`）。首先，我们处理收缩压，将其转换为数值类型，并像其他列一样进行均值插补：
- en: '[PRE35]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Diastolic blood pressure is a bit more complex. The value `998` means that
    the pressure was `PALP`, meaning that it was too low to be detected by a sphygmamometer
    but high enough to feel by touch (palpation). After we convert it to a numeric
    type, we will substitute a numeric value of `40` for the `PALP` values:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 收缩压稍微复杂一些。`998` 这个值表示压力为 `PALP`，意味着它低到无法通过血压计检测，但又足够高，能通过触诊（触摸）感受到。我们将其转换为数值类型后，会将
    `PALP` 值替换为数值 `40`：
- en: '[PRE36]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'We write a new function called `mean_impute_bp_diast()` that does the conversion
    of `PALP` values to `40` and the missing values to the mean:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 我们编写了一个新函数 `mean_impute_bp_diast()`，它将 `PALP` 值转换为 `40`，并将缺失值填充为均值：
- en: '[PRE37]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Oxygen saturation
  id: totrans-216
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 血氧饱和度
- en: 'Oxygen saturation measures the oxygen level in the blood. It is reported as
    a percentage, with higher values being more healthy. We convert it to a numeric
    type and perform mean imputation as follows:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 血氧饱和度是衡量血液中氧气水平的指标，通常以百分比形式表示，值越高越健康。我们将其转换为数值类型并进行均值填充，过程如下：
- en: '[PRE38]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Let''s examine the vital sign transformations we''ve done so far by selecting
    those columns and using the `head()` function:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过选择这些列并使用 `head()` 函数来检查目前为止我们所做的生命体征转换：
- en: '[PRE39]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'The output is as follows:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '|  | TEMPF | PULSE | RESPR | BPSYS | BPDIAS |'
  id: totrans-222
  prefs: []
  type: TYPE_TB
  zh: '|  | TEMPF | PULSE | RESPR | BPSYS | BPDIAS |'
- en: '| --- | --- | --- | --- | --- | --- |'
  id: totrans-223
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- |'
- en: '| 15938 | 98.200000 | 101.000000 | 22.0 | 159.000000 | 72.000000 | 98.000000
    |'
  id: totrans-224
  prefs: []
  type: TYPE_TB
  zh: '| 15938 | 98.200000 | 101.000000 | 22.0 | 159.000000 | 72.000000 | 98.000000
    |'
- en: '| 5905 | 98.100000 | 70.000000 | 18.0 | 167.000000 | 79.000000 | 96.000000
    |'
  id: totrans-225
  prefs: []
  type: TYPE_TB
  zh: '| 5905 | 98.100000 | 70.000000 | 18.0 | 167.000000 | 79.000000 | 96.000000
    |'
- en: '| 4636 | 98.200000 | 85.000000 | 20.0 | 113.000000 | 70.000000 | 98.000000
    |'
  id: totrans-226
  prefs: []
  type: TYPE_TB
  zh: '| 4636 | 98.200000 | 85.000000 | 20.0 | 113.000000 | 70.000000 | 98.000000
    |'
- en: '| 9452 | 98.200000 | 84.000000 | 20.0 | 146.000000 | 72.000000 | 98.000000
    |'
  id: totrans-227
  prefs: []
  type: TYPE_TB
  zh: '| 9452 | 98.200000 | 84.000000 | 20.0 | 146.000000 | 72.000000 | 98.000000
    |'
- en: '| 7558 | 99.300000 | 116.000000 | 18.0 | 131.000000 | 82.000000 | 96.000000
    |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| 7558 | 99.300000 | 116.000000 | 18.0 | 131.000000 | 82.000000 | 96.000000
    |'
- en: '| 17878 | 99.000000 | 73.000000 | 16.0 | 144.000000 | 91.000000 | 99.000000
    |'
  id: totrans-229
  prefs: []
  type: TYPE_TB
  zh: '| 17878 | 99.000000 | 73.000000 | 16.0 | 144.000000 | 91.000000 | 99.000000
    |'
- en: '| 21071 | 97.800000 | 88.000000 | 18.0 | 121.000000 | 61.000000 | 98.000000
    |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| 21071 | 97.800000 | 88.000000 | 18.0 | 121.000000 | 61.000000 | 98.000000
    |'
- en: '| 20990 | 98.600000 | 67.000000 | 16.0 | 112.000000 | 65.000000 | 95.000000
    |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| 20990 | 98.600000 | 67.000000 | 16.0 | 112.000000 | 65.000000 | 95.000000
    |'
- en: '| 4537 | 98.200000 | 85.000000 | 20.0 | 113.000000 | 72.000000 | 99.000000
    |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| 4537 | 98.200000 | 85.000000 | 20.0 | 113.000000 | 72.000000 | 99.000000
    |'
- en: '| 7025 | 99.300000 | 172.000000 | 40.0 | 124.000000 | 80.000000 | 100.000000
    |'
  id: totrans-233
  prefs: []
  type: TYPE_TB
  zh: '| 7025 | 99.300000 | 172.000000 | 40.0 | 124.000000 | 80.000000 | 100.000000
    |'
- en: '| 2134 | 97.500000 | 91.056517 | 18.0 | 146.000000 | 75.000000 | 94.000000
    |'
  id: totrans-234
  prefs: []
  type: TYPE_TB
  zh: '| 2134 | 97.500000 | 91.056517 | 18.0 | 146.000000 | 75.000000 | 94.000000
    |'
- en: '| 5212 | 97.400000 | 135.000000 | 18.0 | 125.000000 | 71.000000 | 99.000000
    |'
  id: totrans-235
  prefs: []
  type: TYPE_TB
  zh: '| 5212 | 97.400000 | 135.000000 | 18.0 | 125.000000 | 71.000000 | 99.000000
    |'
- en: '| 9213 | 97.900000 | 85.000000 | 18.0 | 153.000000 | 96.000000 | 99.000000
    |'
  id: totrans-236
  prefs: []
  type: TYPE_TB
  zh: '| 9213 | 97.900000 | 85.000000 | 18.0 | 153.000000 | 96.000000 | 99.000000
    |'
- en: '| 2306 | 97.000000 | 67.000000 | 20.0 | 136.000000 | 75.000000 | 99.000000
    |'
  id: totrans-237
  prefs: []
  type: TYPE_TB
  zh: '| 2306 | 97.000000 | 67.000000 | 20.0 | 136.000000 | 75.000000 | 99.000000
    |'
- en: '| 6106 | 98.600000 | 90.000000 | 18.0 | 109.000000 | 70.000000 | 98.000000
    |'
  id: totrans-238
  prefs: []
  type: TYPE_TB
  zh: '| 6106 | 98.600000 | 90.000000 | 18.0 | 109.000000 | 70.000000 | 98.000000
    |'
- en: '| 2727 | 98.282103 | 83.000000 | 17.0 | 123.000000 | 48.000000 | 92.000000
    |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '| 2727 | 98.282103 | 83.000000 | 17.0 | 123.000000 | 48.000000 | 92.000000
    |'
- en: '| 4098 | 99.100000 | 147.000000 | 20.0 | 133.483987 | 78.127013 | 100.000000
    |'
  id: totrans-240
  prefs: []
  type: TYPE_TB
  zh: '| 4098 | 99.100000 | 147.000000 | 20.0 | 133.483987 | 78.127013 | 100.000000
    |'
- en: '| 5233 | 98.800000 | 81.000000 | 16.0 | 114.000000 | 78.000000 | 97.311242
    |'
  id: totrans-241
  prefs: []
  type: TYPE_TB
  zh: '| 5233 | 98.800000 | 81.000000 | 16.0 | 114.000000 | 78.000000 | 97.311242
    |'
- en: '| 5107 | 100.000000 | 95.000000 | 24.0 | 133.000000 | 75.000000 | 94.000000
    |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| 5107 | 100.000000 | 95.000000 | 24.0 | 133.000000 | 75.000000 | 94.000000
    |'
- en: '| 18327 | 98.900000 | 84.000000 | 16.0 | 130.000000 | 85.000000 | 98.000000
    |'
  id: totrans-243
  prefs: []
  type: TYPE_TB
  zh: '| 18327 | 98.900000 | 84.000000 | 16.0 | 130.000000 | 85.000000 | 98.000000
    |'
- en: Examining the preceding table, it looks like we are in good shape. We can see
    the imputed mean values for each column (values having extra precision). Let's
    move onto the last vital sign we have in our data, the pain level.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 查看前面的表格，似乎一切正常。我们可以看到每列的填充均值（值具有额外的精度）。现在我们来处理数据中的最后一个生命体征——疼痛级别。
- en: Pain level
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 疼痛级别
- en: '**Pain** is a common indication that something is wrong with the human body,
    and pain level is usually asked in every medical interview, whether it is the
    initial history and physical or the daily SOAP note. Pain levels are usually reported
    on a scale from 0 (non-existent) to 10 (unbearable). Let''s first convert the
    `PAINSCALE` column to the numeric type:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: '**疼痛**是人体出现问题的常见表现，疼痛程度通常会在每次医疗访谈中被询问，无论是初诊病史和体格检查，还是每日SOAP记录。疼痛程度通常用从0（无痛）到10（无法忍受）的等级来报告。我们首先将`PAINSCALE`列转换为数值类型：'
- en: '[PRE40]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Now, we have to write a separate function for mean-imputing pain values, since
    it uses `-8` as a placeholder value instead of `-7`:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要为疼痛值的均值填充编写一个单独的函数，因为它使用`-8`作为占位符，而不是`-7`：
- en: '[PRE41]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Together, vital signs provide an important picture of the health of the patient.
    In the end, we will see how important a role these variables play when we do the
    variable importance.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 综合来看，生命体征为患者健康提供了一个重要的整体图像。最终，我们将看到在进行变量重要性分析时，这些变量所发挥的关键作用。
- en: Now, we can move on to the next variable category.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以进入下一个变量类别。
- en: Reason-for-visit codes
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 就诊原因代码
- en: 'The reason-for-visit variables encode the reason for the patient visit, which
    can be seen as the chief complaint of the visit (we talked about chief complaints
    in [Chapter 2](71c31b0a-fa9e-4b31-8b58-f563a815e338.xhtml), *Healthcare Foundations*).
    In this dataset, these reasons are coded using a code set called *A Reason for
    Visit Classification for Ambulatory Care* (refer to *Page 16* and *Appendix II*
    of the 2011 documentation for further information; a screenshot of the first page
    of the *Appendix* is provided at the end of the chapter). While the exact code
    may not be determined early during the patient encounter, we include it here because:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 就诊原因变量编码了患者就诊的原因，可以视为就诊的主要诉求（我们在[第2章](71c31b0a-fa9e-4b31-8b58-f563a815e338.xhtml)，*医疗基础*中讨论了主要诉求）。在这个数据集中，这些原因使用一个名为*门诊就诊原因分类*的代码集进行编码（更多信息请参考2011年文档的*第16页*和*附录二*；附录第一页的截图已提供在本章结尾）。虽然确切的代码在患者就诊初期可能无法确定，但我们在这里包括它，因为：
- en: It reflects information available early during the patient encounter.
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它反映了患者就诊初期可用的信息。
- en: 'We would like to demonstrate how to process a coded variable (all the other
    coded variables occur too late in the patient encounter to be of use for this
    modeling task):'
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们想展示如何处理一个编码变量（其他所有编码变量出现在患者就诊的较晚阶段，无法用于本建模任务）：
- en: '![](img/c468e8f7-db28-46d9-8d7a-814054403ffc.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c468e8f7-db28-46d9-8d7a-814054403ffc.png)'
- en: 'Coded variables require special attention for the following reasons:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 编码变量需要特别注意，原因如下：
- en: Often there are multiple entries designated in the table for more than one code,
    and the reason-for-visit codes are no exception. Notice that this dataset contains
    three RFV columns (`RFV1`, `RFV2`, and `RFV3`). A code for asthma, for example,
    may appear in any of these columns. Therefore, it is not enough to do one-hot
    encoding for these columns. We must detect the presence of each code in *any*
    of the three columns, and we must write a special function to do that.
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 表格中常常会有多个条目对应多个代码，原因-就诊代码也不例外。注意，这个数据集包含了三个RFV列（`RFV1`、`RFV2`和`RFV3`）。例如，哮喘的代码可能会出现在这三列中的任何一列。因此，单独对这些列进行独热编码是不够的。我们必须检测每个代码在*任何*这三列中的出现情况，并且必须编写一个特殊的函数来处理这个问题。
- en: Codes are categorical, but the numbers themselves usually carry no meaning.
    For easier interpretation, we must name the columns accordingly, using suitable
    descriptions. To do this, we have put together a special `.csv` file that contains
    the typed description for each code (available for download at the book's GitHub
    repository).
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代码是分类变量，但这些数字本身通常没有实际意义。为了便于解释，我们必须相应地命名这些列，使用适当的描述。为此，我们整理了一份特殊的`.csv`文件，包含了每个代码的描述（可在本书的GitHub仓库中下载）。
- en: One output format possibility is a column for each code, where a `1` indicates
    the presence of that code and a `0` indicates its absence (as done in Futoma et
    al., 2015). Any desired combinations/transformations can then be performed. We
    have used that format here.
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一种可能的输出格式是每个代码对应一列，其中`1`表示该代码的存在，`0`表示其不存在（如Futoma等，2015年所做）。然后可以进行任何所需的组合/转换。我们在此采用了这种格式。
- en: 'Without further ado, let''s start transforming our reason-for-visit variables.
    First, we import the RFV code descriptions:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 不再赘述，让我们开始转换我们的就诊原因变量。首先，我们导入RFV代码描述：
- en: '[PRE42]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Now we will do our RFV code processing.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将开始处理RFV代码。
- en: First, to name the columns properly, we import the `sub()` function from the
    `re` module (`re` stands for regular expression).
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，为了正确命名列，我们从`re`模块导入`sub()`函数（`re`代表正则表达式）。
- en: Then we write a function that scans any given RFV columns for the presence of
    an indicated code, and returns the dataset with a new column, with a `1` if the
    code is present and a `0` if the code is absent.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们编写一个函数，扫描任何给定的RFV列，检查是否存在指定的代码，并返回包含新列的数据集。如果代码存在，则列值为`1`，如果代码不存在，则列值为`0`。
- en: Next, we use a `for` loop to iterate through every code in the `.csv` file,
    effectively adding a binary column for every possible code. We do this for both
    the training and testing sets.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们使用`for`循环遍历`.csv`文件中的每个代码，有效地为每个可能的代码添加一个二进制列。我们对训练集和测试集都执行此操作。
- en: 'Finally, we drop the original RFV columns, since we no longer need them. The
    full code is as follows:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们删除原始的RFV列，因为我们不再需要它们。完整的代码如下：
- en: '[PRE43]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Let''s take a look at our transformed dataset with the `head()` function:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们用`head()`函数查看一下转换后的数据集：
- en: '[PRE44]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Notice that there are now 1,264 columns. While the full DataFrame has been truncated,
    if you scroll horizontally, you should see some of the new `rfv_` columns appended
    to the end of the DataFrame.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，现在有1,264列。虽然完整的DataFrame已被截断，但如果你水平滚动，你应该能看到一些新的`rfv_`列被添加到DataFrame的末尾。
- en: Injury codes
  id: totrans-272
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 伤害代码
- en: 'Injury codes are also included in the data. While the reason-for-visit codes
    apply to all visits, injury codes only apply if the patient has undergone either
    physical injury, poisoning, or adverse effects of medical treatment (including
    suicide attempts). Because the exact reason for injury may not be known until
    a full workup has been performed, and that workup usually occurs after a decision
    to admit has already been made. Therefore, we will remove the injury code variables,
    since they potentially contain future information that will not be available at
    prediction time. However, if you wish to use such codes for your modeling task,
    remember that coded data can be processed in a manner similar to that shown earlier.
    Refer to the documentation for additional details on injury variables:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 伤害代码也包含在数据中。虽然就诊原因代码适用于所有就诊，但伤害代码仅在患者遭受了身体伤害、中毒或医疗治疗的副作用（包括自杀未遂）时适用。由于伤害的确切原因可能在进行全面检查之前无法得知，而且该检查通常在决定是否住院后才会进行，因此我们将删除伤害代码变量，因为它们可能包含在预测时不可用的未来信息。不过，如果你希望在建模任务中使用这些代码，请记住，编码数据可以像之前所示的那样进行处理。有关伤害变量的更多细节，请参阅文档：
- en: '[PRE45]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Diagnostic codes
  id: totrans-275
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 诊断代码
- en: 'The dataset also contains ICD-9-DM codes to classify diagnoses associated with
    each visit. Notice that there are three diagnostic code columns. This is consistent
    with what we said about coded variables in the *Reason-for-Visit codes* section.
    Because ICD-9 codes are usually assigned to visits after the workup has been performed
    and the cause of the symptoms determined, we will have to omit them from this
    modeling task:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集还包含ICD-9-DM代码，用于分类与每次就诊相关的诊断。请注意，数据集中有三个诊断代码列。这与我们在*就诊原因代码*部分提到的编码变量一致。由于ICD-9代码通常在进行检查并确定症状原因后分配给就诊，因此我们将需要将其从这个建模任务中排除：
- en: '[PRE46]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Medical history
  id: totrans-278
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 病史
- en: As we discussed in [Chapter 2](71c31b0a-fa9e-4b31-8b58-f563a815e338.xhtml), *Healthcare
    Foundations*, individuals that have chronic conditions are usually less healthy
    and have poorer health outcomes than those who do not have chronic health conditions.
    The dataset includes information on the presence of 11 common chronic conditions
    for each visit. These conditions are cancer, cerebrovascular disease, chronic
    obstructive pulmonary disease, a condition requiring dialysis, congestive heart
    failure, dementia, diabetes, history of myocardial infarction, history of pulmonary
    embolism or deep vein thrombosis, and HIV/AIDS. Because past medical history is
    often available electronically for previously seen patients and is usually established
    early during patient triage, we have decided to include these variables here.
    Because they are already binary, no processing of these variables is needed.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在[第二章](71c31b0a-fa9e-4b31-8b58-f563a815e338.xhtml)《*医疗基础*》中讨论的那样，患有慢性疾病的人通常比没有慢性疾病的人健康状况较差，健康结果也较差。数据集中包括了每次就诊时
    11 种常见慢性疾病的相关信息。这些疾病包括癌症、脑血管疾病、慢性阻塞性肺病、需要透析的疾病、充血性心力衰竭、痴呆、糖尿病、心肌梗死历史、肺栓塞或深静脉血栓历史，以及
    HIV/AIDS。由于以前就诊的患者通常能够获取其病史信息，并且这些信息通常在患者分诊时就已明确，因此我们决定在此包含这些变量。因为这些变量已经是二元的，所以不需要进一步处理。
- en: 'There is also a continuous variable, called `TOTCHRON`, that tallies the total
    number of chronic disease for each patient, which we mean-impute as follows:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一个连续变量，名为 `TOTCHRON`，用于统计每位患者的慢性病总数，我们将其进行均值填充，如下所示：
- en: '[PRE47]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Tests
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试
- en: 'Medical tests, while important, occur post-prediction time and must be omitted
    for this use case. They may be used for other modeling tasks, such as readmission
    prediction or mortality:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 医学测试虽然重要，但发生在预测时间之后，因此必须在此用例中省略。它们可能会用于其他建模任务，如再入院预测或死亡率：
- en: '[PRE48]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: Procedures
  id: totrans-285
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 程序
- en: 'We omit procedures because, similar to the tests, they often occur post-prediction
    time:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 我们省略了程序，因为与测试类似，它们通常发生在预测时间之后：
- en: '[PRE49]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: Medication codes
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 药物编码
- en: The data includes ample information on medications given in the ED and/or prescribed
    at discharge. In fact, information on up to 12 medications is allotted in various
    columns. Obviously, medication administration occurs after the decision to admit
    the patient has been made, so we cannot use these columns for this use case.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包括关于急诊科所给予的药物和/或出院时开出的药物的充足信息。实际上，最多可提供 12 种药物的信息，分布在不同的列中。显然，药物的给药是在决定是否接纳患者之后，因此我们不能在此用例中使用这些列。
- en: 'Nevertheless, we encourage you to peruse the documentation and read about the
    coding systems used for medications if you wish to use such information in your
    own predictive modeling:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，如果你希望在自己的预测建模中使用此类信息，我们鼓励你查阅文档并阅读有关药物编码系统的相关内容：
- en: '[PRE50]'
  id: totrans-291
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Provider information
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提供者信息
- en: 'Provider columns indicate which type(s) of medical providers participated in
    the medical encounter. We have omitted these variables:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 提供者列指示参与医疗接触的医疗提供者类型。我们已省略以下变量：
- en: '[PRE51]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Disposition information
  id: totrans-295
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处置信息
- en: 'Because disposition variables are directly related to the outcome, we cannot
    leave them in the data. We omit them here (recall that we previously removed several
    of the disposition variables right after we created our final target column):'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 由于处置变量与结果直接相关，因此我们不能将其保留在数据中。我们在此省略它们（请回顾我们在创建最终目标列后已删除了若干处置变量）：
- en: '[PRE52]'
  id: totrans-297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Imputed columns
  id: totrans-298
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 填充列
- en: 'These columns indicate those that contain imputed data. For the most part,
    we have included the unimputed counterparts in our data and therefore do not need
    the imputed columns, so we remove them:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 这些列表示包含填充数据的列。大部分情况下，我们在数据中已经包括了未填充的对应列，因此不需要填充列，所以我们将其删除：
- en: '[PRE53]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Identifying variables
  id: totrans-301
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 识别变量
- en: 'When combined, the identifying variables provide a unique key for each encounter.
    While this may come in handy in many situations, fortunately, `pandas` DataFrames
    already uniquely assign an integer to each row, so we can remove the ID variables:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 当结合在一起时，识别变量为每次接触提供唯一的键。虽然在许多情况下这很有用，但幸运的是，`pandas` DataFrame 已经为每一行唯一分配了一个整数，因此我们可以删除
    ID 变量：
- en: '[PRE54]'
  id: totrans-303
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Electronic medical record status columns
  id: totrans-304
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 电子病历状态栏
- en: 'The dataset includes dozens of columns that indicate the technological level
    of the facility at which the patient was seen. We discussed this in the *EHR technology
    and meaningful use* section in [Chapter 2](71c31b0a-fa9e-4b31-8b58-f563a815e338.xhtml),
    *Healthcare Foundations*. We omit these columns since they are valued on a per-hospital
    basis rather than a per-encounter basis:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集中包含数十列指示患者就诊时所在医疗机构的技术水平。我们在[第2章](71c31b0a-fa9e-4b31-8b58-f563a815e338.xhtml)《*EHR技术与有意义的使用*》部分中讨论了这一点，*医疗基础*。由于这些列是按医院而非就诊事件来评估的，因此我们将忽略这些列：
- en: '[PRE55]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: Detailed medication information
  id: totrans-307
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 详细的药物信息
- en: 'More detailed drug information is available in these columns. These columns
    include information on drug categories, which is coded. We must omit these columns
    because they represent future information. However, this information could be
    immensely useful in other machine learning problems:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 这些列包含更详细的药物信息，包括药物类别的编码信息。我们必须忽略这些列，因为它们表示的是未来信息。然而，这些信息在其他机器学习问题中可能非常有用：
- en: '[PRE56]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Miscellaneous information
  id: totrans-310
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他信息
- en: 'Finally, there are several columns at the end that are irrelevant for our purposes,
    so we remove them:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，数据集末尾有几个与我们目的无关的列，因此我们将它们删除：
- en: '[PRE57]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: Final preprocessing steps
  id: totrans-313
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最终的预处理步骤
- en: Now that we have gone through all of the variable groups, we are almost ready
    to build our predictive models. But first, we must expand all of our categorical
    variables into binary variables (also known as one-hot encoding or a 1-of-K representation)
    and convert our data into a format suitable for input into the `scikit-learn` methods.
    Let's do that next.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了所有变量组的处理，几乎可以开始构建我们的预测模型了。但首先，我们必须将所有类别变量扩展为二进制变量（也叫做独热编码或1-of-K表示法），并将数据转换为适合输入到`scikit-learn`方法的格式。接下来我们就来做这个。
- en: One-hot encoding
  id: totrans-315
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 独热编码
- en: Many classifiers of the scikit-learn library require categorical variables to
    be one-hot encoded. **One-hot encoding**, or a **1-of-K representation**, is when
    a categorical variable that has more than two possible values is recorded as multiple
    variables each having two possible values.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 许多`scikit-learn`库的分类器要求类别变量进行独热编码。**独热编码**，或**1-of-K表示法**，是指将一个有多个可能值的类别变量记录为多个变量，每个变量有两个可能的值。
- en: 'For example, let''s say that we have five patients in our dataset and we wish
    to one-hot encode a column that encodes the primary visit diagnosis. Before one-hot
    encoding, the column looks like this:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设我们在数据集中有五个患者，我们希望对表示主要就诊诊断的列进行独热编码。在进行独热编码之前，这一列看起来是这样的：
- en: '| `patient_id` | `primary_dx` |'
  id: totrans-318
  prefs: []
  type: TYPE_TB
  zh: '| `patient_id` | `primary_dx` |'
- en: '| 1 | copd |'
  id: totrans-319
  prefs: []
  type: TYPE_TB
  zh: '| 1 | copd |'
- en: '| 2 | hypertension |'
  id: totrans-320
  prefs: []
  type: TYPE_TB
  zh: '| 2 | hypertension |'
- en: '| 3 | copd |'
  id: totrans-321
  prefs: []
  type: TYPE_TB
  zh: '| 3 | copd |'
- en: '| 4 | chf |'
  id: totrans-322
  prefs: []
  type: TYPE_TB
  zh: '| 4 | chf |'
- en: '| 5 | asthma |'
  id: totrans-323
  prefs: []
  type: TYPE_TB
  zh: '| 5 | asthma |'
- en: 'After one-hot encoding, this column would be split into *K* columns, where
    *K* is the number of possible values, and each column takes a value of 0 or 1
    depending on whether the observation takes the value corresponding to that column:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行独热编码后，这一列将被拆分成*K*列，其中*K*是可能值的数量，每一列的值为0或1，具体取决于该观察值是否对应该列的值：
- en: '| `patient_id` | `primary_dx_copd` | `primary_dx_hypertension` | `primary_dx_chf`
    | `primary_dx_asthma` |'
  id: totrans-325
  prefs: []
  type: TYPE_TB
  zh: '| `patient_id` | `primary_dx_copd` | `primary_dx_hypertension` | `primary_dx_chf`
    | `primary_dx_asthma` |'
- en: '| 1 | 1 | 0 | 0 | 0 |'
  id: totrans-326
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 1 | 0 | 0 | 0 |'
- en: '| 2 | 0 | 1 | 0 | 0 |'
  id: totrans-327
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 0 | 1 | 0 | 0 |'
- en: '| 3 | 1 | 0 | 0 | 0 |'
  id: totrans-328
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 1 | 0 | 0 | 0 |'
- en: '| 4 | 0 | 0 | 1 | 0 |'
  id: totrans-329
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 0 | 0 | 1 | 0 |'
- en: '| 5 | 0 | 0 | 0 | 1 |'
  id: totrans-330
  prefs: []
  type: TYPE_TB
  zh: '| 5 | 0 | 0 | 0 | 1 |'
- en: Note that we have converted the strings of the previous column into an integer
    representation. This makes sense since machine learning algorithms are trained
    on numbers, not words! This is why one-hot encoding is necessary.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们已经将上一列的字符串转换为整数表示。这是有道理的，因为机器学习算法是基于数字而不是单词来训练的！这就是为什么独热编码是必要的原因。
- en: '`scikit-learn` has a `OneHotEncoder` class in its `preprocessing` module. However,
    `pandas` has a `get_dummies()` function that accomplishes one-hot encoding in
    a single line. Let''s use the `pandas` function. Before we do that, we must identify
    the columns that are categorical in our dataset to be passed to the function.
    We do this by using the metadata to identify the categorical columns and seeing
    which of those columns intersect with the columns that remain in our data:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: '`scikit-learn`在其`preprocessing`模块中有一个`OneHotEncoder`类。然而，`pandas`有一个`get_dummies()`函数，能够用一行代码完成独热编码。我们将使用`pandas`函数。在此之前，我们必须确定数据集中哪些列是类别变量，然后传递给该函数。我们通过使用元数据来识别类别列，并查看这些列与我们数据中剩余列的交集：'
- en: '[PRE58]'
  id: totrans-333
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'We must also one-hot encode the test data:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还必须对测试数据进行独热编码：
- en: '[PRE59]'
  id: totrans-335
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: As a final note, we should mention that there is the possibility that the testing
    set will contain categorical values that haven't been seen in the training data.
    This may cause an error when assessing the performance of the model using the
    testing set. To prevent this, you may have to write some extra code that sets
    any missing columns in the testing set to zero. Fortunately, we do not have to
    worry about that with our dataset.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 最后要提到的是，测试集可能包含在训练数据中未曾见过的类别值。这可能会导致在使用测试集评估模型性能时出现错误。为防止这种情况，您可能需要编写一些额外的代码，将测试集中缺失的列设置为零。幸运的是，在我们的数据集中我们不需要担心这个问题。
- en: Numeric conversion
  id: totrans-337
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数字转换
- en: 'Let''s now convert all of the columns into numeric format:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们将所有列转换为数字格式：
- en: '[PRE60]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: NumPy array conversion
  id: totrans-340
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: NumPy数组转换
- en: 'The final step is taking the NumPy array of the pandas DataFrame that will
    be passed directly into the machine learning algorithm. First, we save the final
    column names, which will assist us when we assess variable importance later on:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的步骤是获取将直接传入机器学习算法的pandas数据框的NumPy数组。首先，我们保存最终的列名，这将在稍后评估变量重要性时帮助我们：
- en: '[PRE61]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Now, we use the `values` attribute of the `pandas` DataFrames to access the
    underlying NumPy array for each DataFrame:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们使用`pandas`数据框的`values`属性来访问每个数据框的底层NumPy数组：
- en: '[PRE62]'
  id: totrans-344
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: Now, we are ready for to build the models.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好构建模型。
- en: Building the models
  id: totrans-346
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建模型
- en: 'In this section, we''ll build three types of classifiers and assess their performance:
    a logistic regression classifier, a random forest, and a neural network.'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将构建三种类型的分类器并评估它们的性能：逻辑回归分类器、随机森林和神经网络。
- en: Logistic regression
  id: totrans-348
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 逻辑回归
- en: 'We discussed the intuition behind and basics of logistic regression models
    in [Chapter 3](46c83498-cb6e-45b4-ac39-6875a8d32400.xhtml), *Machine Learning
    Foundations*. To build a model on our training set, we use the following code:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[第3章](46c83498-cb6e-45b4-ac39-6875a8d32400.xhtml)中讨论了逻辑回归模型的直觉和基本概念，*机器学习基础*。为了在我们的训练集上构建一个模型，我们使用以下代码：
- en: '[PRE63]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: Prior to the `for` loop, we import the `LogisticRegression` class and set `clf`
    equal to a `LogisticRegression` instance. The training and testing occur in the
    `for` loop. First, we use the `fit()` method to fit the model (for example, to
    determine the optimal coefficients) using the training data. Next, we use the
    `score()` method to assess the model performance on both the training data and
    the testing data.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 在`for`循环之前，我们导入`LogisticRegression`类，并将`clf`设置为`LogisticRegression`实例。训练和测试过程发生在`for`循环中。首先，我们使用`fit()`方法拟合模型（例如，确定最优的系数），使用训练数据。接下来，我们使用`score()`方法评估模型在训练数据和测试数据上的表现。
- en: In the second half of the `for` loop, we print out the coefficient values of
    each feature. In general, features with coefficients that are farther from zero
    are the most positively/negatively correlated with the outcome. However, we did
    not scale the data prior to training, so it is possible that more important predictors
    that are not scaled appropriately will have lower coefficients.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 在`for`循环的后半部分，我们打印出每个特征的系数值。通常，系数离零更远的特征与结果的相关性最强（无论是正相关还是负相关）。然而，我们在训练之前没有对数据进行缩放，因此有可能更重要的预测变量由于没有适当缩放而会有较低的系数。
- en: 'The output of the code should look like the following:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 代码的输出应如下所示：
- en: '[PRE64]'
  id: totrans-354
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: First, let's discuss the performance of the training and testing sets. They
    are close together, which indicates the model did not overfit to the training
    set. The accuracy is approximately 88%, which is on par with performance in research
    studies (Cameron et al., 2015) for predicting emergency department status.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们讨论一下训练集和测试集的表现。它们非常接近，这表明模型没有过拟合训练集。准确率约为88%，与研究中的表现（Cameron等人，2015年）相当，用于预测急诊科状态。
- en: 'Looking at the coefficients, we can confirm that they make intuitive sense.
    The feature with the highest coefficient is related to the onset of labor in pregnancy;
    we all know that labor results in a hospital admission. Many of the features pertaining
    to severe psychiatric disease, which almost always result in an admission due
    to the risk the patient poses to themselves or to others. The `IMMEDR_1` feature
    also has a high coefficient; remember that this feature corresponds to a value
    of 1 on the triage scale, which is the most critical value:'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 查看系数后，我们可以确认它们符合直觉。系数最高的特征与怀孕中的分娩开始相关；我们都知道，分娩通常会导致住院。许多与严重精神疾病相关的特征几乎总是会导致住院，因为患者对自己或他人构成风险。`IMMEDR_1`特征的系数也很高；请记住，这个特征对应的是分诊量表中的1，表示最紧急的情况：
- en: '[PRE65]'
  id: totrans-357
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: In contrast, scrolling to the bottom reveals some of the features that are negatively
    correlated with an admission. Having a toothache and needing sutures to be removed
    show up here, and they are not likely to result in admissions since they are not
    urgent complaints.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，滚动到页面底部会显示一些与入院呈负相关的特征。比如牙痛和需要拆除缝线的情况出现在这里，它们不太可能导致入院，因为这些情况并不是紧急问题。
- en: We've trained our first model. Let's see whether some of the more complex models
    will improve.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经训练了第一个模型。让我们看看一些更复杂的模型是否能带来改进。
- en: Random forest
  id: totrans-360
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 随机森林
- en: 'A convenient feature of `scikit-learn` is that many of the classifiers have
    identical methods so that models can be built interchangeably. We see that in
    the following code, when we use the `fit()` and `score()` methods of the `RandomForestClassifier`
    class to train the model and assess its performance, respectively:'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: '`scikit-learn`的一个便捷特性是，许多分类器具有相同的方法，因此可以互换使用模型。在下面的代码中，我们看到，当我们使用`RandomForestClassifier`类的`fit()`和`score()`方法来训练模型和评估其性能时：'
- en: '[PRE66]'
  id: totrans-362
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'The output should look similar to the following:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 输出应该类似于以下内容：
- en: '[PRE67]'
  id: totrans-364
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: This time the validation accuracy was similar to that of the logistic regression
    model, approximately 88%. However, the accuracy on the training data was 100%,
    indicating that we overfit the model to the training data. We'll discuss potential
    ways of improving our models at the end of this chapter.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 这次的验证准确率与逻辑回归模型相似，约为88%。然而，训练数据上的准确率为100%，这表明我们对模型进行了过拟合。我们将在本章末尾讨论一些改善模型的潜在方法。
- en: Looking at the feature importance, again the results make sense. This time the
    vital signs seem to be the most important predictors, along with the age predictor.
    Scrolling to the bottom reveals those features that had no impact on predictability.
    Note that in contrast to regression coefficients, with the variable importance
    of random forest, the frequency with which the variable was positive plays a role
    in the importance; this may explain why `IMMEDR_02` is ranked as more important
    than `IMMEDR_01`.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 查看特征重要性时，结果再次符合逻辑。这次，生命体征似乎是最重要的预测因子，还有年龄预测因子。滚动到页面底部显示了那些对预测没有影响的特征。请注意，与回归系数不同，在随机森林中，变量重要性的衡量标准不仅仅是系数的大小，还包括变量为正的频率；这可能解释了为什么`IMMEDR_02`的重要性排名高于`IMMEDR_01`。
- en: Neural network
  id: totrans-367
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 神经网络
- en: 'Finally, we arrive at the neural network model. Note that our training set
    only has approximately 18,000 observations; the most successful neural network
    models (for example, "deep learning" models) typically use millions or even billions
    of observations. Nevertheless, let''s see how our neural network model fares.
    For neural networks, it is recommended that the data is scaled appropriately (for
    example, having a **standard distribution** with a mean equal to 0 and a standard
    deviation equal to 1). We use the `StandardScaler` class to accomplish this:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们来到了神经网络模型。请注意，我们的训练集只有大约18,000个样本；最成功的神经网络模型（例如，“深度学习”模型）通常使用数百万甚至数十亿个样本。尽管如此，让我们看看我们的神经网络模型的表现如何。对于神经网络，建议对数据进行适当缩放（例如，使其**标准分布**，均值为0，标准差为1）。我们使用`StandardScaler`类来完成这一操作：
- en: '[PRE68]'
  id: totrans-369
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: Once you run the preceding cell, you will see iterations being completed, and
    once the iterations fail to result in improvements to the model, the training
    will stop and the accuracies will be printed. In our run, the validation accuracy
    of the model having 150 cells in its hidden layer was 87%, higher than the other
    hidden layer sizes.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你运行上述单元格，你将看到迭代完成，一旦迭代未能带来模型的改进，训练将停止，并打印出准确率。在我们的运行中，具有150个隐藏层单元的模型的验证准确率为87%，高于其他隐藏层大小。
- en: Using the models to make predictions
  id: totrans-371
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用模型进行预测
- en: We have finished preprocessing the data, and making and scoring the model. The
    AUC is similar to that reported in previous academic studies that predict ED outcomes
    (see Cameron et al., 2015 for an example).
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经完成了数据预处理、模型的构建和评分。AUC与之前学术研究中预测ED结果的报告相似（见Cameron等，2015年）。
- en: 'The next step would be to save and deploy the model and use it to make live
    predictions. Fortunately, all of the classifiers in the scikit-learn library include
    several functions for making predictions:'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是保存并部署模型，并使用它进行实时预测。幸运的是，scikit-learn库中的所有分类器都包含几个用于进行预测的函数：
- en: For most classifiers, the `predict()` function takes a matrix, *X*, that contains
    unlabeled data as input and simply returns the class predictions with no further
    information.
  id: totrans-374
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于大多数分类器，`predict()` 函数接受一个包含未标记数据的矩阵 *X* 作为输入，并简单地返回类预测结果，不包含其他信息。
- en: The `predict_proba()` function takes a matrix, *X*, that contains unlabeled
    data as input and returns the probabilities with which the observations belong
    to each class. These should add up to `1` for each observation.
  id: totrans-375
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`predict_proba()` 函数接受一个包含未标记数据的矩阵 *X* 作为输入，并返回观察值属于各个类别的概率。这些概率对于每个观察值应该加起来等于
    `1`。'
- en: The `predict_log_proba()` function is similar to the `predict_proba()` function
    except that it returns the log probabilities with which the observations belong
    to each class.
  id: totrans-376
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`predict_log_proba()` 函数与 `predict_proba()` 函数类似，只不过它返回的是观察值属于每个类别的对数概率。'
- en: 'Keep the following important fact in mind: *When making predictions, the unlabeled
    data must be preprocessed identically to the manner in which the training data
    was preprocessed*. This includes:'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 记住以下重要事实：*在进行预测时，未标记的数据必须以与训练数据预处理相同的方式进行预处理*。这包括：
- en: Column additions and deletions
  id: totrans-378
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 列的添加与删除
- en: Column transformations
  id: totrans-379
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 列变换
- en: Imputation of missing values
  id: totrans-380
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缺失值的填充
- en: Scaling and centering
  id: totrans-381
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缩放和中心化
- en: One-hot encoding
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 独热编码
- en: Just one column that is not preprocessed properly can have an extremely negative
    impact on the model predictions.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 仅仅是一个没有正确预处理的列，可能会对模型预测产生极大的负面影响。
- en: Improving our models
  id: totrans-384
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 改进我们的模型
- en: Although in this chapter we have built a rudimentary model that matches the
    performance of academic research studies, there is certainly room for improvement.
    The following are some ideas for how the model can be improved, and we leave it
    to the reader to implement these suggestions and any other tricks or techniques
    the reader might know to improve performance. How high will your performance go?
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在本章中我们构建了一个初步模型，其性能与学术研究中所报告的类似，但仍有改进的空间。以下是一些改善模型的想法，我们留给读者去实现这些建议以及其他可能的技巧或方法，以提高性能。你的性能能达到多高呢？
- en: 'First and foremost, the current training data has a large number of columns.
    Some sort of feature selection is almost always performed, particularly for logistic
    regression and random forest models. For logistic regression, common methods of
    performing feature selection include:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，当前的训练数据有大量的列。几乎总是会执行某种特征选择，尤其是对于逻辑回归和随机森林模型。对于逻辑回归，常见的特征选择方法包括：
- en: Using a certain number of predictors that have the highest coefficients
  id: totrans-387
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用具有最高系数的若干个预测变量
- en: Using a certain number of predictors that have the lowest *p*-values
  id: totrans-388
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用具有最低 *p*-值的若干个预测变量
- en: Using lasso regularization and removing predictors whose coefficients become
    zero
  id: totrans-389
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用lasso正则化并移除系数变为零的预测变量
- en: Using a greedy algorithm such as forward- or backward-stepwise logistic regression
    that removes/adds predictors systematically according to rules
  id: totrans-390
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用贪心算法，例如前向或后向逐步逻辑回归，根据规则系统地移除/添加预测变量
- en: Using a brute-force algorithm, such as best subset logistic regression, that
    tests every predictor permutation/combination for a given number of predictors
  id: totrans-391
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用暴力算法，例如最佳子集逻辑回归，测试给定数量的预测变量的所有排列/组合。
- en: For random forests, using the variable importance and selecting a certain number
    of predictors with the highest importance is very common, as is performing grid
    searches.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 对于随机森林，使用变量重要性并选择具有最高重要性的若干个预测变量是非常常见的，进行网格搜索也是如此。
- en: Neural networks have their own unique improvement techniques.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 神经网络有其独特的改进技术。
- en: For one thing, more data is always good, particularly with neural networks.
  id: totrans-394
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一方面，更多的数据总是好的，特别是在神经网络中。
- en: The specific optimization algorithm used can factor into the performance.
  id: totrans-395
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用的具体优化算法可能会影响性能。
- en: In this example, our neural networks only had one hidden layer. In the industry,
    models with multiple hidden layers are becoming increasingly common (although
    they may take a long time to train).
  id: totrans-396
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这个例子中，我们的神经网络只有一个隐藏层。在行业中，具有多个隐藏层的模型变得越来越常见（尽管它们可能需要较长时间进行训练）。
- en: The specific nonlinear activation function used may also impact the model's
    performance.
  id: totrans-397
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用的具体非线性激活函数也可能影响模型的性能。
- en: Summary
  id: totrans-398
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have built a predictive model for predicting outcomes in
    the emergency department. While there are many machine learning problems in healthcare,
    this exercise has demonstrated the issues typically faced as one preprocesses
    healthcare data, trains and scores models, and makes predictions with unlabeled
    data. This chapter marks the end of the coding portion of this book.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们构建了一个用于预测急诊科结果的预测模型。尽管医疗领域中有许多机器学习问题，但本练习展示了在预处理医疗数据、训练和评分模型以及使用无标签数据进行预测时通常会遇到的问题。本章标志着本书编码部分的结束。
- en: Now that we have seen the construction of a predictive model firsthand, the
    next logical question to ask is how predictive models have fared when compared
    with traditional statistical risk scores in predicting clinical outcomes. We explore
    that question in the next chapter.
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经亲自看到了预测模型的构建，接下来合乎逻辑的问题是，预测模型与传统统计风险评分在临床结果预测方面相比表现如何。我们将在下一章探讨这个问题。
- en: References and further reading
  id: totrans-401
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考文献及进一步阅读
- en: Cameron A, Rodgers K, Ireland A, et al. (2015). A simple tool to predict admission
    at the time of triage. *Emerg Med J* 2015;32:174-179.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: Cameron A, Rodgers K, Ireland A 等（2015）。一项简单工具用于预测分诊时的入院情况。*Emerg Med J* 2015;32:174-179。
- en: 'Futoma J, Morris J, Lucas J (2015). A comparison of models for predicting early
    hospital readmissions. Journal of Biomedical Informatics 56: 229-238.'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 'Futoma J, Morris J, Lucas J（2015）。预测早期住院再入院的模型比较。生物医学信息学杂志 56: 229-238。'
