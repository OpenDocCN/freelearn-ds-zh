- en: Chapter 3. Data Creation and Editing
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章 数据创建和编辑
- en: In this chapter, we will first create some new vector layers and cover how to
    select features and take measurements. We will then continue with editing feature
    geometries and attributes. Then, we will reproject vector and raster data, and
    before we end this chapter, learn how to convert between different file formats
    with joining data from text files and spreadsheets to our spatial data.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将首先创建一些新的矢量图层，并介绍如何选择要素和进行测量。然后，我们将继续编辑要素几何和属性。接着，我们将重新投影矢量和栅格数据，在结束本章之前，我们将学习如何通过将数据从文本文件和电子表格合并到我们的空间数据中来在不同文件格式之间进行转换。
- en: Creating new vector layers
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建新的矢量图层
- en: In this exercise, we'll create a new layer from scratch. QGIS offers a wide
    range of functionalities to create different layers. The **Layer** | **New** menu
    lists functions to create new Shapefile and SpatiaLite layers, but we can also
    create new database tables using the DB Manager plugin. The interfaces differ
    slightly to accommodate the features supported by each format.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将从头开始创建一个新的图层。QGIS提供了一系列功能来创建不同的图层。**图层** | **新建**菜单列出了创建新Shapefile和SpatiaLite图层的功能，但我们可以使用DB
    Manager插件创建新的数据库表。界面略有不同，以适应每种格式支持的功能。
- en: Let's create a new Shapefile to see how it works. A new Shapefile layer, which
    can be accessed by going to **Layer** | **New** or *Ctrl* + *Shift* + *N*, opens
    the New Vector Layer dialog with options for different geometry types, CRS, and
    attributes. The process itself is really fast because all mandatory fields already
    have default values. By default, it will create a new point layer with WGS84 CRS
    (unless specified otherwise in **Settings** | **Options** | **CRS**) and one integer
    field called **id**. We can simply click on **OK**, specify a filename, and a
    new layer appears in the layer list.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个新的Shapefile来查看它是如何工作的。通过访问**图层** | **新建**或*Ctrl* + *Shift* + *N*，可以打开一个新矢量图层对话框，其中包含不同几何类型、CRS和属性选项。整个过程非常快，因为所有必填字段已经设置了默认值。默认情况下，它将创建一个新的点图层，使用WGS84
    CRS（除非在**设置** | **选项** | **CRS**中指定了其他设置）和一个名为**id**的整数字段。我们只需点击**确定**，指定一个文件名，新的图层就会出现在图层列表中。
- en: 'Next, we also create one line and one polygon layer. We''ll add some extra
    fields to these layers. Besides integer fields, Shapefiles also support text and
    decimal values. To add a field, we only need to insert a name, select a type and
    width, and click on **Add to attributes list**. For decimal numbers, we also have
    to define the **Precision** value, which determines the number of digits after
    the comma. A **Width** value of **3** with a **Precision** value of **1** will
    allow a value range from -99.9 to + 99.9\. The following screenshot shows the
    **New Vector Layer** dialog and the **Attributes...** window for my example polygon
    layer:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们还会创建一个线和多边形图层。我们将向这些图层添加一些额外的字段。除了整数字段外，Shapefiles还支持文本和小数值。要添加字段，我们只需插入一个名称，选择类型和宽度，然后点击**添加到属性列表**。对于小数数字，我们还需要定义**精度**值，它决定了小数点后的位数。**宽度**为**3**，**精度**为**1**的值将允许从-99.9到+99.9的值范围。以下截图显示了**新矢量图层**对话框和我的示例多边形图层的**属性...**窗口：
- en: '![Creating new vector layers](img/7488_03_01.jpg)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![创建新的矢量图层](img/7488_03_01.jpg)'
- en: All of the new layers are empty so far, but we will create some features now.
    If we want to add features to a layer, we first have to enable editing for this
    layer. Editing can be turned on and off by selecting **Layer** | **Toggle editing**,
    **Toggle editing** in the layer name context menu, or with the **Toggle editing**
    button in the **Digitizing** toolbar. Notice how the layer's icon in the layer
    list changes to reflect whether editing is on or off. When we turn on editing
    for a layer, QGIS automatically enables the digitizing tools suitable for the
    layer's geometry type.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 所有的新图层目前都是空的，但我们将现在创建一些要素。如果我们想向图层添加要素，我们首先必须启用该图层的编辑功能。可以通过选择**图层** | **切换编辑**、图层名称上下文菜单中的**切换编辑**或**数字化**工具栏中的**切换编辑**按钮来打开或关闭编辑。注意图层列表中的图层图标如何改变以反映编辑是否开启。当我们为图层开启编辑时，QGIS会自动启用适合图层几何类型的数字化工具。
- en: Now, we can use the **Add Feature** tool in the editing toolbar to create new
    features. To place a point, we simply click on the map. We are then prompted to
    fill out the attribute form, and once we click on **OK** the new feature is created.
    Like with points, we can create new lines and polygons by placing nodes onto the
    map. To finish a line or a polygon, we simply right-click on the map. Create some
    features in each layer and then save your changes. We can re-use these test layers
    in the upcoming exercises.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以使用编辑工具栏中的**添加要素**工具来创建新要素。要放置一个点，我们只需在地图上单击。然后我们会提示填写属性表单，一旦我们点击**确定**，新要素就会被创建。与点一样，我们可以通过在地图上放置节点来创建新的线和多边形。要完成一条线或一个多边形，我们只需在地图上右键单击。在每个图层中创建一些要素，然后保存您的更改。我们可以在即将到来的练习中重新使用这些测试图层。
- en: Note
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: New features and feature edits are saved permanently only after clicking on
    the **Save Layer Edits** button in the **Digitizing** toolbar or once we finish
    editing and confirm that we want to save.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 新要素和要素编辑只有在点击**数字化**工具栏中的**保存图层编辑**按钮或完成编辑并确认要保存后才会永久保存。
- en: Working with feature selection tools
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用特征选择工具
- en: Selecting features is one of the core functions of any GIS, and it is useful
    to know them before we venture forward into editing geometries and attributes.
    Depending on the use case, selection tools come in many different flavors. QGIS
    offers three different kinds of tools to select features using the mouse, an expression,
    or another layer.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 选择特征是任何GIS的核心功能之一，在我们开始编辑几何形状和属性之前了解它们是有用的。根据用例，选择工具有多种不同的类型。QGIS提供了三种不同的工具来使用鼠标、表达式或另一个图层选择特征。
- en: The first group of tools in the **Attributes** toolbar allows us to select features
    on the map using the mouse, either one at a time or by drawing different shapes
    such as rectangles or freehand areas around the features. All features that intersect
    with the drawn shape are selected. Holding down *Ctrl* will add the new selection
    to an existing one.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**属性**工具栏中的第一组工具允许我们使用鼠标在地图上选择特征，一次选择一个或通过绘制不同的形状，如矩形或围绕特征的自由手绘区域。所有与绘制形状相交的特征都被选中。按住*Ctrl*键会将新选择添加到现有选择中。'
- en: 'Similarly, holding down *Ctrl* + *Shift* will remove the new selection from
    the existing selection. The following screenshot shows the tools:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，按住*Ctrl* + *Shift*键将新选择从现有选择中删除。以下截图显示了这些工具：
- en: '![Working with feature selection tools](img/7488_03_02.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![使用特征选择工具](img/7488_03_02.jpg)'
- en: 'The second type of select tool is called **Select by Expression** and it is
    also available in the **Attribute** toolbar. It selects features based on expressions
    that can contain references and functions using feature attributes and/or geometry.
    The list of available functions is pretty long, but we can use the search box
    to filter the list by name to find the function we are looking for faster. On
    the right-hand side of the window, we find the **Selected Function Help**, which
    explains the functionality and how to use the function in an expression. The **Function
    List** also shows the layer attribute fields, and by clicking on **Load all unique
    values** or **Load 10 sample values**, we can easily access their content. Like
    with the mouse tools, we can choose between creating a new selection or adding
    to or deleting from an existing selection. Additionally, we can choose to only
    select features from within an existing selection. Let''s have a look at some
    example expressions that you can build on and use in your own work:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种选择工具被称为**表达式选择**，它也存在于**属性**工具栏中。它根据可以包含引用和函数的表达式来选择特征，这些函数可以使用特征属性和/或几何形状。可用的函数列表相当长，但我们可以使用搜索框通过名称过滤列表，以便更快地找到所需的函数。在窗口的右侧，我们可以找到**所选函数帮助**，它解释了功能及其在表达式中的使用方法。**函数列表**还显示了图层属性字段，通过点击**加载所有唯一值**或**加载10个样本值**，我们可以轻松访问其内容。与鼠标工具一样，我们可以选择创建新的选择或添加到现有选择或从现有选择中删除。此外，我们还可以选择仅从现有选择中选择特征。让我们看看一些示例表达式，您可以在自己的工作中构建和使用它们：
- en: 'Using the `lakes.shp` file in our sample data, we can, for example, select
    big lakes with an area bigger than 1,000 square miles using a simple attribute
    query: `"AREA_MI" > 1000.0`, or by using geometry functions such as `$area > (1000.0
    * 27878400)`. Note that the `lakes.shp` CRS uses feet and we therefore have to
    multiply by 27,878,400 to convert from square feet to square miles.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用我们样本数据中的`lakes.shp`文件，例如，我们可以通过简单的属性查询选择面积大于1,000平方英里的湖泊：`"AREA_MI" > 1000.0`，或者使用几何函数如`$area
    > (1000.0 * 27878400)`。请注意，`lakes.shp`的CRS使用英尺，因此我们必须乘以27,878,400将平方英尺转换为平方英里。
- en: 'We can also work with string functions, for example, to find lakes with long
    names: `length("NAMES") > 12`, or lakes with names that contain an "s" or "S":
    `lower("NAMES") LIKE ''%s%''`, which first converts the names to lower case and
    then looks for any appearance of "s". The dialog will look like the following
    screenshot:'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们还可以使用字符串函数，例如，查找名称较长的湖泊：`length("NAMES") > 12`，或者名称中包含“s”或“S”的湖泊：`lower("NAMES")
    LIKE '%s%'`，这首先将名称转换为小写，然后查找“s”的任何出现。对话框将看起来像以下屏幕截图：
- en: '![Working with feature selection tools](img/7488_03_03.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![使用要素选择工具工作](img/7488_03_03.jpg)'
- en: The third type of tool allows us to select features in one layer based on their
    location relative to features in a second layer. These tools can be accessed by
    going to **Vector** | **Research Tools** | **Select by location** and **Vector**
    | **Spatial Query** | **Spatial Query**. Enable it in **Plugin Manager** if you
    cannot find it in the **Vector** menu. In general, we want to use the Spatial
    Query plugin as it supports a variety of spatial operations such as **crosses**,
    **equals**, **intersects**, **is disjoint**, **overlaps**, **touches**, and **contains**
    depending on the layer geometry type.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种工具允许我们根据要素在第二层中的相对位置选择第一层中的要素。这些工具可以通过访问**矢量** | **研究工具** | **按位置选择**和**矢量**
    | **空间查询** | **空间查询**来访问。如果无法在**矢量**菜单中找到它，请在**插件管理器**中启用它。通常，我们想要使用空间查询插件，因为它支持各种空间操作，如**交叉**、**等于**、**相交**、**不相交**、**重叠**、**接触**和**包含**，具体取决于图层几何类型。
- en: Let's test the Spatial Query plugin using `railroads.shp` and `pipelines.shp`
    from the sample data. For example, we might want to find all the railroad features
    that cross a pipeline; we therefore select the **railroads** layer, the **Crosses**
    operation, and the **pipelines** layer. After clicking on **Apply**, the plugin
    presents us the query results. There is a list of IDs of the result features on
    the right-hand side of the window as you can see in the following screenshot.
    Below this list, we can check the **Zoom to item** checkbox, and QGIS will zoom
    to the feature that belongs to the selected ID. Additionally, the plugin offers
    buttons to directly save all the resulting features to a new layer.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用样本数据中的`railroads.shp`和`pipelines.shp`测试空间查询插件。例如，我们可能想要找到所有穿过管道的铁路要素；因此，我们选择**railroads**图层、**Crosses**操作和**pipelines**图层。点击**应用**后，插件会展示查询结果。您可以在以下屏幕截图的窗口右侧看到结果要素的ID列表。在此列表下方，我们可以勾选**缩放到项目**复选框，QGIS会缩放到所选ID所属的要素。此外，插件还提供按钮，可以直接将所有结果要素保存到新图层。
- en: '![Working with feature selection tools](img/7488_03_04.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![使用要素选择工具工作](img/7488_03_04.jpg)'
- en: Editing vector geometries
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编辑矢量几何
- en: 'Now that we know how to create and select features, we can have a closer look
    at the other tools in the **Digitizing** and **Advanced Digitizing** toolbars.
    The Digitizing toolbar will look like the following screenshot:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道了如何创建和选择要素，我们可以更仔细地查看**绘图**和**高级绘图**工具栏中的其他工具。绘图工具栏将看起来像以下屏幕截图：
- en: '![Editing vector geometries](img/7488_03_05a.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![编辑矢量几何](img/7488_03_05a.jpg)'
- en: 'The basic **Digitizing** toolbar contains tools for creating and moving features
    and nodes, as well as for deleting, copying, cutting, and pasting features, as
    follows:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 基本绘图工具栏包含创建和移动要素以及节点、删除、复制、剪切和粘贴要素的工具，如下所示：
- en: With the **Move Feature(s)** tool, it is easy to move one or more features at
    once by dragging them to the new location.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**移动要素**工具，通过拖动它们到新位置，可以轻松地一次移动一个或多个要素。
- en: Similarly, the **Node Tool** feature allows us to move one or more nodes of
    the same feature. The first click activates the feature, while the second click
    selects the node. Hold the mouse key down to drag the node to its new location.
    Instead of moving only one node, we can also move an edge by clicking and dragging
    the line. And finally, we can select and move multiple nodes by holding down *Ctrl*.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类似地，**节点工具**功能允许我们移动同一特征的一个或多个节点。第一次点击激活特征，而第二次点击选择节点。按住鼠标键拖动节点到其新位置。除了移动单个节点外，我们还可以通过单击并拖动线来移动边。最后，我们可以按住*Ctrl*键选择并移动多个节点。
- en: '**Delete Selected**, **Cut Features**, and **Copy Features** are only active
    if one or more layer features are selected. Similarly, **Paste Features** only
    works after a feature has been cut or copied.![Editing vector geometries](img/7488_03_05b.jpg)'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**删除选定内容**、**剪切特征**和**复制特征**仅在选中一个或多个图层特征时才可用。同样，**粘贴特征**仅在特征已被剪切或复制后才能工作。![编辑矢量几何](img/7488_03_05b.jpg)'
- en: 'The **Advanced Digitizing** toolbar offers very useful **Undo** and **Redo**
    functionalities as well as additional tools for more involved geometry editing:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**高级数字化**工具栏提供了非常实用的**撤销**和**重做**功能，以及用于更复杂几何编辑的附加工具：'
- en: '**Rotate Feature(s)** enables us to rotate one or more selected features around
    a central point.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**旋转特征（s）**使我们能够围绕中心点旋转一个或多个选定的特征。'
- en: Using the **Simplify Feature** tool, we can simplify/generalize feature geometries
    by simply clicking on the feature and pulling the tolerance slider in the pop-up
    window.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**简化特征**工具，我们只需单击特征并拉动弹出窗口中的公差滑块，就可以简化/泛化特征几何形状。
- en: The following tools allow us to **Add Rings**, also known as "holes", into existing
    polygons or **Add Parts** to existing polygons. And of course, there are tools
    to **Delete Rings** and **Delete Parts** as well.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以下工具允许我们在现有多边形中**添加环**（也称为“洞”）或**添加部分**。当然，还有**删除环**和**删除部分**的工具。
- en: '**Reshape Features** can be used to alter the geometry of a feature by either
    cutting out or adding pieces. You can control the behavior by starting to draw
    the new form inside the original feature to add a piece, or start outside to cut
    out a piece, as shown in the following example diagram:![Editing vector geometries](img/7488_03_06.jpg)'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**重塑特征**可以通过切割或添加部分来改变特征的几何形状。您可以通过在原始特征内开始绘制新形状以添加部分，或者在外部开始切割部分来控制行为，如下面的示例图所示：![编辑矢量几何](img/7488_03_06.jpg)'
- en: The **Offset Curve** tool is only available for lines and allows us to displace
    a line geometry by a given offset.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**偏移曲线**工具仅适用于线条，并允许我们通过给定的偏移量移动线条几何形状。'
- en: '**Split Features** allows us to cut one or more features along a cut line.'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分割特征**允许我们沿着切割线切割一个或多个特征。'
- en: '**Merge Selected Features** enables us to merge multiple features while keeping
    control over which feature''s attributes will be available in the output feature.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**合并选定的特征**使我们能够在保持对输出特征中哪些特征的属性将可用的控制的同时合并多个特征。'
- en: Similarly, **Merge Attributes of Selected Features** lets us combine the attributes
    of multiple features, but without merging them into one feature. Instead, all
    original features remain as they were, but the attribute values are updated.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类似地，**合并选定特征的属性**允许我们将多个特征的属性合并，但不会将它们合并为一个特征。相反，所有原始特征保持原样，但属性值已更新。
- en: Finally, **Rotate Point Symbols** is only available for point layers with the
    **Rotation field** feature enabled (which we will cover in [Chapter 5](ch05.html
    "Chapter 5. Creating Great Maps"), *Creating Great Maps*).
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，**旋转点符号**仅适用于具有**旋转字段**功能启用的点图层（我们将在[第5章](ch05.html "第5章。创建优秀的地图")，*创建优秀的地图*中介绍）。
- en: Using the measuring tools
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用测量工具
- en: 'Another core functionality of any GIS are the measurement tools. In QGIS, we
    find tools to measure lines, areas, and angles in the **Attribute** toolbar, as
    shown in the following screenshot:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 任何GIS的核心功能之一是测量工具。在QGIS中，我们可以在**属性**工具栏中找到测量线条、面积和角度的工具，如下面的屏幕截图所示：
- en: '![Using the measuring tools](img/7488_03_07.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![使用测量工具](img/7488_03_07.jpg)'
- en: The measurements are updated continuously while we draw measurement lines, areas,
    or angles. When we draw a line with multiple segments, the tool will show the
    length of each segment as well as the total length of all the segments put together.
    To stop measuring, we just right-click. If we want to change the measurement units
    from meters to feet or from degrees to radians, we can do that in **Settings**
    | **Options** | **Map Tools**.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们绘制测量线、面积或角度时，测量值会持续更新。当我们绘制由多个段组成的线时，工具将显示每个段以及所有段的总长度。要停止测量，我们只需右键单击。如果我们想将测量单位从米更改为英尺，或者从度更改为弧度，我们可以在
    **设置** | **选项** | **地图工具** 中进行更改。
- en: Editing attributes
  id: totrans-44
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编辑属性
- en: There are three main use cases for attribute editing. First, we might want to
    edit the attributes of one specific feature, for example, to fix a wrong name.
    Second, we might want to edit attributes of a group of features. Or third, we
    might want to change the attributes of all the features within a layer. All these
    use cases are covered by functionality available through the attribute table.
    We can access it by going to **Layer** | **Open Attribute Table**, the **Open
    Attribute Table** button present in the **Attributes** toolbar, or in the layer
    name context menu.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 属性编辑有三个主要用例。首先，我们可能想要编辑特定要素的属性，例如，更正一个错误的名字。其次，我们可能想要编辑一组要素的属性。或者第三，我们可能想要更改图层中所有要素的属性。所有这些用例都由属性表提供的功能覆盖。我们可以通过访问
    **图层** | **打开属性表**，**属性**工具栏中的 **打开属性表** 按钮，或者在图层名称上下文菜单中来实现。
- en: To change attribute values, we always have to first enable editing. Then we
    can double-click on any cell in the attribute table to activate the input mode.
    Clicking on *Enter* confirms the change, but to save the new value permanently,
    we have to also click on the **Save Edit(s)** button or press *Ctrl* + *S*. In
    the bottom-right corner of the attribute table dialog, we can switch from the
    table to the form view, as shown in the following screenshot, and start editing
    there.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 要更改属性值，我们总是首先需要启用编辑功能。然后我们可以双击属性表中的任何单元格以激活输入模式。点击 *Enter* 确认更改，但为了永久保存新值，我们还需要点击
    **保存编辑(s)** 按钮，或者按 *Ctrl* + *S*。在属性表对话框的右下角，我们可以从表格视图切换到表单视图，如下面的截图所示，并从这里开始编辑。
- en: Tip
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Another option for editing the attributes of one feature is to open the attribute
    form directly by clicking on the feature on the map using the **Identify tool**.
    By default, the **Identify tool** displays the attribute values in the read mode,
    but we can enable **Open feature form if a single feature is identified** by going
    to **Settings** | **Options** | **Map Tools**.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑单个要素属性的另一种选项是直接通过点击地图上的要素并使用 **识别工具** 来打开属性表单。默认情况下，**识别工具** 以只读模式显示属性值，但我们可以通过访问
    **设置** | **选项** | **地图工具** 来启用 **如果识别到单个要素，则打开要素表单**。
- en: '![Editing attributes](img/7488_03_08.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![编辑属性](img/7488_03_08.jpg)'
- en: Note
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'In the attribute table, we also find tools to handle selections (from left
    to right starting at the third button): Delete selected features, Select by expression,
    Cancel the selection, Move selected features to the top of the table, Invert the
    selection, Pan to the selected features, Zoom to the selected features, and Copy
    the selected features. Another way to select features in the attribute table is
    to click on the row number.'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在属性表中，我们还找到处理选择（从左到右，从第三个按钮开始）的工具：删除选定的要素，通过表达式选择，取消选择，将选定的要素移动到表顶，反转选择，平移到选定的要素，缩放到选定的要素，以及复制选定的要素。在属性表中选择要素的另一种方法是点击行号。
- en: The next two buttons allow us to add and remove columns. When we click on the
    delete column button, we get a list of columns to choose from. Similarly, the
    add columns button brings up a dialog to specify the name and data type of the
    new column.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 下两个按钮允许我们添加和删除列。当我们点击删除列按钮时，会弹出一个列列表供我们选择。同样，添加列按钮会弹出一个对话框，用于指定新列的名称和数据类型。
- en: 'If we want to change attributes of multiple or all features in a layer, editing
    them manually usually isn''t an option. That is what **Field Calculator** is good
    for. We can access it using the **Open field calculator** button in the attribute
    table or using the *Ctrl* + *I* keys. In **Field Calculator**, we can choose to
    only update selected features or to update all the features in the layer. Besides
    updating an existing field, we can also create a new field. The function list
    is the same one we already explored when we selected features by expression. We
    can use any of these functions to populate a new field or update an existing one.
    Here are some example expressions that are used often:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要更改图层中多个或所有要素的属性，手动编辑通常不是一个选择。这正是**字段计算器**的作用所在。我们可以通过在属性表中的**打开字段计算器**按钮或使用*Ctrl*
    + *I*键来访问它。在**字段计算器**中，我们可以选择仅更新所选要素或更新图层中的所有要素。除了更新现有字段外，我们还可以创建一个新字段。函数列表与我们之前在通过表达式选择要素时探索的相同。我们可以使用这些函数中的任何一个来填充新字段或更新现有字段。以下是一些常用表达式的示例：
- en: We can create an `id` column using the `$rownum` function, which populates a
    column with the row numbers as shown in the following screenshot
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以使用`$rownum`函数创建一个`id`列，该列填充了如图所示行号
- en: Another common use case is to calculate line length or polygon area using the
    geometry functions `$length` and `$area` respectively
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 另一个常见用例是使用几何函数`$length`和`$area`分别计算线长度或多边形面积
- en: Similarly, we can get point coordinates using `$x` and `$y`
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样，我们可以使用`$x`和`$y`获取点坐标
- en: If we want to get the start or end points of a line, we can use `xat(0)` and
    `yat(0)` or `xat(-1)` and `yat(-1)`![Editing attributes](img/7488_03_09.jpg)
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们想要获取一条线的起点或终点，可以使用 `xat(0)` 和 `yat(0)` 或 `xat(-1)` 和 `yat(-1)` ![编辑属性](img/7488_03_09.jpg)
- en: Reprojecting and converting vector and raster data
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重投影和转换矢量及栅格数据
- en: In [Chapter 2](ch02.html "Chapter 2. Viewing Spatial Data"), *Viewing Spatial
    Data*, we talked about CRS and the fact that QGIS offers on-the-fly reprojection
    to display spatial datasets, which are stored in different CRS, in the same map.
    Still, in some cases, we will want to permanently reproject a dataset, for example
    to geoprocess it later on.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第2章](ch02.html "第2章。查看空间数据")中，我们讨论了CRS以及QGIS如何提供即时重投影以显示存储在不同CRS中的空间数据集，这些数据集在同一个地图中显示。尽管如此，在某些情况下，我们可能希望永久性地重投影数据集，例如稍后进行地理处理。
- en: In QGIS, reprojecting a vector or raster layer is done by simply saving it with
    a new CRS. We can save a layer using **Layer** | **Save as ...** or **Save as
    …** in the layer name context menu. Pick a target file format and file name, and
    then click on the **Browse** button besides the CRS field to pick a new CRS.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在QGIS中，通过简单地保存图层为新的CRS来重投影矢量或栅格图层。我们可以通过**图层** | **另存为...**或图层名称上下文菜单中的**另存为…**来保存图层。选择目标文件格式和文件名，然后点击CRS字段旁边的**浏览**按钮来选择新的CRS。
- en: Besides changing the CRS, the main use case of the Save vector/raster layer
    dialog is to convert between different file formats. For example, we can load
    a Shapefile and export it as GeoJSON, Mapinfo MIF, CSV, and so on, or the other
    way around.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 除了更改CRS外，保存矢量/栅格图层对话框的主要用例是在不同文件格式之间进行转换。例如，我们可以加载Shapefile并将其导出为GeoJSON、Mapinfo
    MIF、CSV等，或者相反。
- en: The Save raster layer dialog is also a convenient way to clip/crop rasters by
    a bounding box, as we can specify which extent we want to save.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 保存栅格图层对话框也是一个方便的裁剪/裁剪栅格的方法，因为我们可以指定我们想要保存的范围。
- en: Similarly, for vector layers, there is **Save selection as …** in both the **Layer**
    menu and the layer name context menu, which will open the same kind of dialog,
    but it will only save the selected features.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，对于矢量图层，**图层**菜单和图层名称上下文菜单中都有**保存选择为…**，它将打开相同的对话框，但它只会保存所选要素。
- en: '![Reprojecting and converting vector and raster data](img/7488_03_10.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![重投影和转换矢量及栅格数据](img/7488_03_10.jpg)'
- en: Tip
  id: totrans-65
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Enabling **Add saved file to map** (currently only available in the vector dialog)
    is very convenient because it saves us the effort to go and load the new file
    manually after it has been saved.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 启用**将保存的文件添加到地图中**（目前仅在矢量对话框中可用）非常方便，因为它节省了我们保存文件后手动加载新文件的麻烦。
- en: Joining tabular data
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 联接表格数据
- en: 'In many real-life situations, we get additional non-spatial data in the form
    of spreadsheets or text files. The good news is we can load XLS files by simply
    dragging them into QGIS from the file browser or using **Add Vector Layer**. Don''t
    let the wording fool you! It really works without any geometry data in the file.
    The file can even contain more than just one table. You will see the following
    dialog, which lets you choose which table(s) you want to load:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多实际情况下，我们以电子表格或文本文件的形式获得额外的非空间数据。好消息是我们可以通过简单地从文件浏览器拖动它们到 QGIS 或使用 **添加矢量图层**
    来加载 XLS 文件。不要被措辞误导！它真的可以在文件中没有几何数据的情况下工作。文件甚至可以包含不止一个表格。你会看到以下对话框，它允许你选择你想要加载的表格（s）：
- en: '![Joining tabular data](img/7488_03_11.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![连接表格数据](img/7488_03_11.jpg)'
- en: 'QGIS will automatically recognize the names and data types of columns in an
    XLS table. It''s quite easy to tell because numeric values are right-aligned in
    the attribute table as shown in the following screenshot:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS 将自动识别 XLS 表格中列的名称和数据类型。这很容易辨认，因为数值在属性表中是右对齐的，如下面的截图所示：
- en: '![Joining tabular data](img/7488_03_12.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![连接表格数据](img/7488_03_12.jpg)'
- en: We can also load tabular data from delimited text files like we saw in [Chapter
    2](ch02.html "Chapter 2. Viewing Spatial Data"), *Viewing Spatial Data*, when
    we loaded a point layer from a delimited text file. To load a delimited text file
    that only contains tabular data but no geometry information, we just need to enable
    the **No geometry** (attribute table only) option.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以从类似于我们在 [第 2 章](ch02.html "第 2 章。查看空间数据") 中看到的，*查看空间数据*，当我们从一个分隔符文本文件加载点图层时，加载来自分隔符文本文件的表格数据。要加载仅包含表格数据而不包含几何信息的数据的分隔符文本文件，我们只需启用
    **无几何**（仅属性表）选项。
- en: After loading the tabular data from either the spreadsheet or text file, we
    can continue to join this non-spatial data to a vector layer. To do that, we go
    to the vector **Layer Properties** | **Joins** tab. There, we can add a new join
    by pressing the green plus button. All we have to do is select the tabular **Join
    layer** and **Join field** fields (of the tabular layer), which should contain
    values that match those in the **Target field** field (of the vector layer). The
    page will look like the following screenshot.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在从电子表格或文本文件加载表格数据后，我们可以继续将此非空间数据连接到矢量层。为此，我们转到矢量 **图层属性** | **连接** 选项卡。在那里，我们可以通过按绿色加号按钮添加一个新的连接。我们只需选择表格的
    **连接层** 和 **连接字段** 字段（表格层的字段），这些字段应包含与矢量层的 **目标字段** 字段（的值）匹配的值。页面将类似于下面的截图。
- en: Note
  id: totrans-74
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The way joins work in QGIS is that the join layer's attributes are appended
    to the original layer's attribute table. The number of features in the original
    layer is not changed. Whenever there is a match between the join and the target
    field, the attribute value will be filled; otherwise you'll see NULL entries.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS 中连接的工作方式是，连接层的属性被附加到原始层的属性表中。原始层的要素数量不会改变。每当连接和目标字段之间有匹配时，属性值将被填充；否则，你会看到
    NULL 条目。
- en: '![Joining tabular data](img/7488_03_13.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![连接表格数据](img/7488_03_13.jpg)'
- en: Once the join is added, we can see the extended attribute table and use the
    new appended attributes for styling and labeling.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦添加了连接，我们就可以看到扩展的属性表，并可以使用新附加的属性进行样式和标签化。
- en: Tip
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: You can save the joined layer permanently. Just use **Save as …** to create
    the new file.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以永久保存连接层。只需使用 **另存为…** 创建新文件。
- en: Summary
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we covered how to create new layers from scratch. We used the
    tools to create and edit feature geometries in different ways. Then, we went into
    editing feature attributes of single features, feature selections, and whole layers.
    Next, we reprojected both vector and raster layers and also learned how to convert
    between different file formats. Finally, we finished this chapter on layer creation
    and editing by covering tabular data, how it can be loaded into QGIS, and how
    to join it to our spatial data.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了从头创建新图层的方法。我们使用了不同的工具以不同的方式创建和编辑要素几何形状。然后，我们进入了编辑单个要素的属性、要素选择和整个图层的属性。接下来，我们重新投影了矢量和栅格图层，并学习了如何在不同文件格式之间进行转换。最后，我们通过介绍表格数据、如何将其加载到
    QGIS 以及如何将其连接到我们的空间数据来结束本章关于图层创建和编辑的内容。
- en: In the following chapter, we will put our data to good use and learn how to
    perform different kinds of spatial analysis on raster and vector data.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将把我们的数据用于实际用途，并学习如何在矢量和栅格数据上执行不同类型的空间分析。
