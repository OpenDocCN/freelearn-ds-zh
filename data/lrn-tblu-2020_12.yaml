- en: '12'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '12'
- en: Exploring Mapping and Advanced Geospatial Features
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索映射和高级地理空间功能
- en: Up until now, we've seen examples of maps and geospatial visualizations that
    leverage some of the basic functionality of Tableau. In this chapter, we'll embark
    on a journey to uncover the vast range of mapping and geospatial features available.
    From levering the built-in geospatial database and supplementing it with additional
    data and spatial files, to using advanced geospatial functions, we'll explore
    what's possible with Tableau.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经看过利用 Tableau 基本功能的地图和地理空间可视化示例。在本章中，我们将踏上探索 Tableau 提供的广泛映射和地理空间功能之旅。从利用内置的地理空间数据库并用额外的数据和空间文件进行补充，到使用高级地理空间功能，我们将探索
    Tableau 能够实现的可能性。
- en: As we've done previously, this chapter will approach the concepts through some
    practical examples. These examples will span various industries, including real
    estate, transportation, and healthcare. As always, these examples are broadly
    applicable, and you'll discover many ways to leverage your data and uncover answers
    in the spatial patterns you'll find.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前所做的，本章将通过一些实际示例来介绍这些概念。这些示例将跨越不同行业，包括房地产、交通运输和医疗保健。与以往一样，这些示例具有广泛的适用性，您将发现许多方法来利用数据，发掘您所发现的空间模式中的答案。
- en: 'In this chapter, we''ll cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下主题：
- en: Overview of Tableau maps
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tableau 地图概述
- en: Rendering maps with Tableau
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Tableau 渲染地图
- en: Using geospatial data
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用地理空间数据
- en: Leveraging spatial functions
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用空间函数
- en: Creating custom territories
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建自定义区域
- en: 'Tableau mapping: tips and tricks'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tableau 映射：技巧与窍门
- en: Plotting data on background images
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在背景图像上绘制数据
- en: Overview of Tableau maps
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Tableau 地图概述
- en: Tableau contains an internal geographic database that allows it to recognize
    common geographic elements and render a mark at a specific latitude and longitude
    on a map. In many cases, such as with a country or state, Tableau also contains
    internal shapefiles that allow it to render the mark as a complex vector shape
    in the proper location. Tableau also leverages your specific geospatial data,
    such as latitude and longitude, shapefiles, and spatial objects. We'll consider
    some of those possibilities throughout this chapter. For now, we'll walk through
    some of the basics of how Tableau renders maps and some of the customizations
    and options available.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 包含一个内部地理数据库，使其能够识别常见的地理元素，并在地图上的特定纬度和经度位置渲染标记。在许多情况下，例如国家或州，Tableau
    还包含内部的形状文件，使其能够在正确的位置以复杂的矢量形状渲染标记。Tableau 还可以利用您特定的地理空间数据，例如纬度和经度、形状文件以及空间对象。本章中，我们将探讨其中的一些可能性。现在，我们将带您了解
    Tableau 渲染地图的一些基本知识，以及可用的自定义选项。
- en: Rendering maps with Tableau
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Tableau 渲染地图
- en: 'Consider the following screenshot (the `Basic Map` example in the `Chapter
    12` workbook), with certain elements numbered for reference:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下截图（`第 12 章` 工作簿中的 `基本地图` 示例），并对某些元素进行编号以便参考：
- en: '![](img/B16021_12_01.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_01.png)'
- en: 'Figure 12.1: A basic geospatial rendering in Tableau'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.1：Tableau 中的基本地理空间渲染
- en: 'The numbers indicate some of the important aspects of Tableau''s ability to
    render maps:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 数字表示 Tableau 渲染地图能力的某些重要方面：
- en: A geographic field in the data is indicated with a globe icon. Fields that Tableau
    recognizes will have this icon by default. You may assign a geographic role to
    any field by using the menu and selecting **Geographic Role**.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据中的地理字段会显示为一个地球图标。Tableau 默认会为它识别的字段添加此图标。您可以通过菜单为任何字段分配一个地理角色，选择 **地理角色**
    即可。
- en: The geographic field in the view (in this case, on **Detail**) is required to
    render the map.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 视图中的地理字段（在本例中位于 **详细信息**）是渲染地图所必需的。
- en: If Tableau is able to match the geographic field with its internal database,
    the **Latitude (generated)** and **Longitude (generated)** fields placed on **Rows**
    and **Columns** along with the geographic field(s) on the **Marks** card will
    render a map.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果 Tableau 能够将地理字段与其内部数据库匹配，那么将 **纬度（生成的）** 和 **经度（生成的）** 字段放在 **行** 和 **列**
    上，再加上地理字段（们）放在 **标记** 卡片上，即可渲染出一张地图。
- en: Values that are not matched with Tableau's geographic database will result in
    an indicator that alerts you to the fact that there are unknown values.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与 Tableau 地理数据库不匹配的值将显示一个指示器，提醒您存在未知值。
- en: 'You may right-click the unknown indicator to hide it, or click it for the following
    options:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以右键点击未知指示器将其隐藏，或者点击它以显示以下选项：
- en: To edit locations (manually match location values to known values or latitude/longitude)
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编辑位置（手动匹配位置值到已知值或经纬度）
- en: Filter out unknown locations
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过滤掉未知位置
- en: Plot at the default location (latitude and longitude of 0, a location that is
    sometimes humorously referred to as Null Island, located just off the west coast
    of Africa)
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在默认位置绘制（纬度和经度为0，这个位置有时幽默地被称为“空岛”，位于非洲西海岸附近）
- en: Tableau renders marks on the map similar to the way it would on a scatterplot
    (in fact, you might think of a map as a kind of scatterplot that employs some
    complex geometric transformations to project latitude and longitude). This means
    you can render circles, dots, and custom shapes on the map.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 在地图上呈现标记的方式与散点图类似（实际上，您可以把地图看作是一种散点图，它通过一些复杂的几何变换来投影经纬度）。这意味着您可以在地图上绘制圆形、点和自定义形状。
- en: Under the marks, the map itself is a vector image retrieved from an online map
    service. We'll consider the details and how to customize the map layers and options next.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在标记下方，地图本身是从在线地图服务中检索到的矢量图像。接下来，我们将考虑如何自定义地图图层和选项。
- en: Customizing map layers
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义地图图层
- en: The map itself—the land and water, terrain, topography, streets, country and
    state borders, and more—are all part of a vector image that is retrieved from
    an online map service (an offline option is available).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 地图本身——陆地和水域、地形、街道、国家和州的边界等——都是从在线地图服务中检索到的矢量图像（也提供离线选项）。
- en: Marks are then rendered on top of that image. You already know how to use data,
    calculations, and parameters to adjust how marks are rendered, but Tableau gives
    you a lot of control over how maps are rendered.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 然后在该图像上绘制标记。您已经知道如何使用数据、计算和参数来调整标记的渲染方式，但 Tableau 给予您对地图渲染方式的高度控制。
- en: 'Use the menu to explore various options by selecting **Map** | **Background
    Maps**. Here, for example, is a **Dark Map**:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 使用菜单通过选择**地图** | **背景地图**来探索各种选项。例如，这里是一个**暗色地图**：
- en: '![](img/B16021_12_02.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_02.png)'
- en: 'Figure 12.2: Dark Map is one of many options for map backgrounds'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.2：暗色地图是多种地图背景选项之一
- en: This map contains the exact same marks as the previous screenshot. It simply
    uses a different background. Other options include **Light**, **Streets**, **Satellite**,
    and more.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这张地图包含与前一个截图完全相同的标记，只是背景不同。其他选项包括**浅色**、**街道**、**卫星**等。
- en: If you will be using Tableau in an environment where the internet is not available
    (or publishing to a Tableau server that lacks an internet connection), select
    the **Offline** option. However, be aware that the offline version does not contain
    the detail or zoom levels available in the online options.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您将在没有互联网的环境中使用 Tableau（或发布到没有互联网连接的 Tableau 服务器），请选择**离线**选项。但是，请注意，离线版本不包含在线选项中的细节或缩放级别。
- en: 'Additional layer options can be found by selecting **Map** | **Map Layers**
    from the menu. This opens a **Map Layers** pane that looks like this:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 通过从菜单中选择**地图** | **地图图层**，可以找到其他图层选项。这将打开一个看起来像这样的**地图图层**面板：
- en: '![](img/B16021_12_03.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_03.png)'
- en: 'Figure 12.3: The Map Layers pane'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.3：地图图层面板
- en: The **Map Layers** pane gives you options for selecting a background, setting
    washout, selecting features to display, and setting a **Data Layer**. Various
    options may be disabled depending on the zoom level (for example, **Building Footprints**
    is not enabled unless you zoom in close enough on the map). **Data Layer** allows
    you to apply a filled map to the background based on various demographics. These
    demographics only appear as part of the image and are not interactive and the
    data is not exposed to either user interaction or calculation.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '**地图图层**面板提供了选择背景、设置洗涤效果、选择显示的特征以及设置**数据图层**的选项。根据缩放级别，某些选项可能会被禁用（例如，**建筑物轮廓**只有在缩放到足够接近地图时才会启用）。**数据图层**允许您基于各种人口统计数据将填充地图应用于背景。这些人口统计数据只作为图像的一部分显示，并且不具备互动性，数据不会暴露给用户交互或计算。'
- en: You may also use the menu options **Map** | **Background Maps** | **Manage Maps**
    to change which map service is used, allowing you to specify your own WMS server,
    a third party, or to use **Mapbox** maps. This allows you to customize the background
    layers of your map visualizations in any way you'd like.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用菜单选项**地图** | **背景地图** | **管理地图**来更改使用的地图服务，这样您就可以指定自己的WMS服务器、第三方服务，或者使用**Mapbox**地图。这使您能够以任何您喜欢的方式自定义地图可视化的背景图层。
- en: The details of these capabilities are outside the scope of this book, however,
    you'll find excellent documentation from Tableau at [https://help.tableau.com/current/pro/desktop/en-us/maps_mapsources_wms.htm](https://help.tableau.com/current/pro/desktop/en-us/maps_mapsources_wms.htm).
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这些功能的细节超出了本书的范围，不过，你可以在 Tableau 的[官方文档](https://help.tableau.com/current/pro/desktop/en-us/maps_mapsources_wms.htm)中找到相关内容。
- en: Customizing map options
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义地图选项
- en: 'Additionally, you can customize the map options available to end users. Notice
    the controls that appear when you hover over the map:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你还可以自定义可供最终用户使用的地图选项。注意当你将鼠标悬停在地图上时会出现的控制项：
- en: '![](img/B16021_12_04.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_04.png)'
- en: 'Figure 12.4 : Available controls when customizing a map'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.4：自定义地图时可用的控制项
- en: These controls allow you to search map, zoom in and out, pin the map to the
    current location, and use various types of selections.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 这些控制项允许你搜索地图、放大和缩小、将地图定位到当前位置，并使用各种选择方式。
- en: You can also use keyboard and mouse combinations to navigate the map. Use *Ctrl*
    + Mouse wheel or *Shift* + *Ctrl* + Mouse Click to zoom. Click and hold or *Shift*
    + Click to pan.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用键盘和鼠标组合来导航地图。使用*Ctrl* + 鼠标滚轮或*Shift* + *Ctrl* + 鼠标点击进行缩放。点击并按住或*Shift*
    + 点击来平移。
- en: 'Additional options will appear when you select **Map | Map Options** from the
    top menu:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 **地图 | 地图选项** 后会出现其他选项：
- en: '![](img/B16021_12_05.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_05.png)'
- en: 'Figure 12.5: Map Options'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.5：地图选项
- en: These options give you the ability to set what map actions are allowed for the
    end user and whether to show a scale. Additionally, you can set the units displayed
    for the scale and **radial selections**. The options are **Automatic** (based
    on system configuration), **Metric** (meters and kilometers), and **U.S.** (feet
    and miles).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这些选项让你能够设置允许最终用户执行哪些地图操作，以及是否显示比例尺。此外，你还可以设置比例尺和**径向选择**的显示单位。选项包括**自动**（基于系统配置）、**公制**（米和千米）和**美制**（英尺和英里）。
- en: There are quite a few other geospatial capabilities packed into Tableau and
    we'll uncover some of them as we next explore how to leverage geospatial data.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 中集成了许多其他地理空间功能，我们将在接下来的内容中揭示如何利用地理空间数据。
- en: Using geospatial data
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用地理空间数据
- en: We've seen that with any data source, Tableau supplies **Latitude (generated)**
    and **Longitude (generated)** fields based on any fields it matches with its internal
    geographic database. Fields such as country, state, zip code, MSA, and congressional
    district are contained in Tableau's internal geography. As Tableau continues to
    add geographic capabilities, you'll want to consult the documentation to determine
    specifics on what the internal database contains.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看到，对于任何数据源，Tableau 会根据它与内部地理数据库匹配的字段自动提供**纬度（生成）**和**经度（生成）**字段。像国家、省州、邮政编码、大都市区（MSA）和国会选区等字段都包含在
    Tableau 的内部地理库中。随着 Tableau 持续增加地理功能，你可能需要查阅文档，了解内部数据库具体包含的内容。
- en: 'However, you can also leverage specific geospatial data in your visualizations.
    We''ll consider ways to use data that enable geospatial visualizations, including
    the following:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，你也可以在可视化中利用特定的地理空间数据。我们将考虑使用能够支持地理空间可视化的数据，包括以下内容：
- en: Including `Latitude` and `Longitude` as values in your data.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在你的数据中包含`纬度`和`经度`作为数值。
- en: Importing a `.csv` file containing definitions of `Latitude` and `Longitude`
    into Tableau's database.
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将包含`纬度`和`经度`定义的`.csv`文件导入到 Tableau 的数据库中。
- en: Leveraging Tableau's ability to connect to various spatial files or databases
    that natively support spatial objects.
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用 Tableau 连接到支持空间对象的各种空间文件或数据库的能力。
- en: We'll explore each of these options in the following section and then look at
    how to extend the data even further with geospatial functions in the next.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的部分中探索这些选项，然后进一步了解如何利用地理空间函数扩展数据。
- en: Including latitude and longitude in your data
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在数据中包含纬度和经度
- en: Including latitude and longitude in your data gives you a lot of flexibility
    in your visualizations (and calculations). For example, while Tableau has built-in
    geocoding for countries, states, and zip codes, it does not provide geocoding
    at an address level. Supplying latitude or longitude in your data gives you the
    ability to precisely position marks on the map.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据中包含纬度和经度可以为你的可视化（和计算）提供极大的灵活性。例如，虽然 Tableau 内建了国家、省州和邮政编码的地理编码功能，但它并不提供地址级别的地理编码。提供纬度或经度数据能让你精确地在地图上定位标记。
- en: 'You''ll find the following example in the `Chapter 12` workbook using the `Real
    Estate` data source:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在使用`房地产`数据源的`第 12 章`工作簿中找到以下示例：
- en: '![](img/B16021_12_06.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_06.png)'
- en: 'Figure 12.6: A map of houses for sale, sized by price'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.6：按价格大小绘制的待售房屋地图
- en: Here, each individual house could be mapped with a precise location and sized
    according to price. In order to help the viewer visually, the **Streets** background
    has been applied.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，每个单独的房屋可以通过精确的位置进行映射，并根据价格调整大小。为了帮助观众更直观地理解，已经应用了**街道**背景。
- en: There are many free and commercial utilities that allow you to **geocode** addresses.
    That is, given an address, these tools will add latitude and longitude.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多免费的和商业的工具可以**地理编码**地址。也就是说，给定一个地址，这些工具会添加经度和纬度信息。
- en: If you are not able to add the fields directly to your data source, you might
    consider using cross-database joins or data blending. Another alternative is to
    import latitude and longitude definitions directly into Tableau. We'll consider
    this option next.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你无法直接将字段添加到数据源中，可以考虑使用跨数据库连接或数据混合。另一种选择是直接将纬度和经度定义导入到 Tableau 中。接下来我们将考虑这种选项。
- en: Importing definitions into Tableau's geographic database
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 导入定义到 Tableau 的地理数据库
- en: 'In order to import from the menu, select **Map** | **Geocoding** | **Import
    Custom Geocoding...**. The import dialog contains a link to documentation describing
    the option in further detail:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 若要从菜单导入，选择**地图** | **地理编码** | **导入自定义地理编码...**。导入对话框中包含了一个链接，描述了该选项的更多细节：
- en: '![](img/B16021_12_07.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_07.png)'
- en: 'Figure 12.7: The Import Custom Geocoding dialog box'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.7：导入自定义地理编码对话框
- en: 'By importing a set of definitions, you can either:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 通过导入一组定义，你可以：
- en: Add new geographic types
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加新的地理类型
- en: Extend Tableau's built-in geographic types
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扩展 Tableau 内建的地理类型
- en: Latitude and longitude define a single point. At times, you'll need to render
    shapes and lines with more geospatial complexity. For that, you'll want to consider
    some of the geospatial functions and spatial object support, which we'll look
    at next.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 纬度和经度定义了一个单一的点。在某些时候，你可能需要呈现更复杂的形状和线条。在这种情况下，你可以考虑一些地理空间函数和空间对象支持，接下来我们将讨论这些内容。
- en: Leveraging spatial objects
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 利用空间对象
- en: Spatial objects define geographic areas that can be as simple as a point and
    as complex as multi-sided polygons. This allows you to render everything from
    custom trade areas to rivers, roads, and historic boundaries of counties and countries.
    Spatial objects can be stored in spatial files and are supported by some relational
    databases as well.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 空间对象定义了地理区域，这些区域可以简单如一个点，也可以复杂如多边形。这使得你可以呈现从自定义商业区域到河流、道路以及县和国家的历史边界等所有内容。空间对象可以存储在空间文件中，并且被一些关系型数据库所支持。
- en: Tableau supports numerous spatial file formats, such as `ESRI`, `MapInfo`, `KML`,
    `GeoJSON`, and `TopoJSON`. Additionally, you may connect directly to `ESRI` databases
    as well as relational databases with geospatial support, such as `ESRI` or SQL
    Server. If you create an extract, the spatial objects will be included in the
    extract.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 支持多种空间文件格式，如`ESRI`、`MapInfo`、`KML`、`GeoJSON`和`TopoJSON`。此外，你还可以直接连接到`ESRI`数据库以及具有地理空间支持的关系型数据库，如`ESRI`或
    SQL Server。如果你创建了一个提取文件，空间对象将被包含在提取文件中。
- en: Many applications, such as `Alteryx`, `Google Earth`, and `ArcGIS`, can be used
    to generate spatial files. Spatial files are also readily available for download
    from numerous organizations. This gives you a lot of flexibility when it comes
    to geospatial analysis.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 许多应用程序，如`Alteryx`、`Google Earth`和`ArcGIS`，都可以用来生成空间文件。空间文件也可以从许多组织那里轻松下载。这为地理空间分析提供了极大的灵活性。
- en: 'Here, for example, is a map of US railroads:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，这里有一张美国铁路的地图：
- en: '![](img/B16021_12_08.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_08.png)'
- en: 'Figure 12.8: Map of US railroads'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.8：美国铁路地图
- en: 'To replicate this example, download the shapefile from the United States''
    Census Bureau here: [https://catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-u-s-rails-national-shapefile](https://catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-u-s-rails-national-shapefile).'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 要复制此示例，请从美国人口普查局下载 shapefile：[https://catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-u-s-rails-national-shapefile](https://catalog.data.gov/dataset/tiger-line-shapefile-2015-nation-u-s-rails-national-shapefile)。
- en: 'Once you have downloaded and unzipped the files, connect to the `tl_2015_us_rails.shp`
    file. In the preview, you''ll see records of data with ID fields and railway names.
    The **Geometry** field is the spatial object that defines the linear shape of
    the railroad segment:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 下载并解压文件后，连接到`tl_2015_us_rails.shp`文件。在预览中，你将看到带有ID字段和铁路名称的数据记录。**几何**字段是定义铁路段线性形状的空间对象：
- en: '![](img/B16021_12_09.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_09.png)'
- en: 'Figure 12.9: Map of US railroads preview'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.9：美国铁路地图预览
- en: On a blank sheet, simply double-click the **Geometry** field. Tableau will include
    the geographic collection in the detail and introduce automatically generated
    latitude and longitude fields to complete the rendering. Experiment with including
    the ID field in the detail and with filtering based on **Fullname**.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在空白工作表中，只需双击**几何**字段。Tableau将把地理数据集包括在细节中，并自动引入纬度和经度字段以完成渲染。尝试将ID字段包含在细节中，并根据**全名**进行筛选。
- en: Consider using cross-database joins to supplement existing data with custom
    spatial data. Additionally, Tableau supports spatial joins, which allow you to
    bring together data that is only related spatially, even if no other relationships
    exist.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑使用跨数据库连接来补充现有数据与自定义空间数据。此外，Tableau支持空间连接，允许你将仅在空间上相关的数据汇聚在一起，即使没有其他关系存在。
- en: Next, we'll take a look at leveraging some spatial functions and even a spatial
    join or two to extend your analytics.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将着眼于利用一些空间函数，甚至是空间连接来扩展你的分析。
- en: Leveraging spatial functions
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 利用空间函数
- en: 'Tableau continues to add native support for spatial functions. At the time
    of writing, Tableau supports the following functions:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau不断增加对空间函数的本地支持。撰写本文时，Tableau支持以下功能：
- en: '`Makeline()` returns a line spatial object given two points.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Makeline()`返回一个由两个点确定的线状空间对象。'
- en: '`Makepoint()` returns a point spatial object given two coordinates.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Makepoint()`返回一个由两个坐标确定的点状空间对象。'
- en: '`Distance()` returns the distance between two points in the desired units of measurement.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Distance()`返回两个点之间的距离，单位为所需的测量单位。'
- en: '`Buffer()` creates a circle around a point with a radius of the given distance.
    You may specify the units of measurement.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Buffer()`在一个点周围创建一个给定距离半径的圆形区域。你可以指定测量单位。'
- en: 'We''ll explore a few of these functions using the `Hospital and Patients` dataset
    in the `Chapter 12` workbook. The dataset reimagines the real estate data as a
    hospital surrounded by patients, indicated in the following view by the difference
    in **Shape**, **Size**, and **Color**:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过`第12章`工作簿中的`医院和病人`数据集来探索一些这些功能。该数据集将房地产数据重新构想为一个被病人环绕的医院，在以下视图中通过**形状**、**大小**和**颜色**的差异来表示：
- en: '![](img/B16021_12_10.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_10.png)'
- en: 'Figure 12.10: A hospital (represented by the star) surrounded by patients'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.10：一个被病人包围的医院（由星号表示）
- en: 'There are numerous analytical questions we might ask. Let''s focus on these:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可能会提出许多分析性问题。我们将集中讨论以下几个问题：
- en: How far is each patient from the hospital?
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个病人距离医院有多远？
- en: How many patients fall within a given radius?
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有多少病人位于给定半径内？
- en: Which patients are outside the radius?
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些病人位于半径之外？
- en: To start answering these questions, we'll create some calculated fields that
    give us the building blocks. In order to use multiple points in the same calculation,
    the latitude and longitude of the hospital will need to be included with each
    patient record. One way to achieve this is by using a couple of `FIXED` **Level
    of Detail** (**LOD**) expressions to return the values to each row.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 为了开始回答这些问题，我们将创建一些计算字段来为我们提供构建块。为了在同一计算中使用多个点，医院的纬度和经度需要与每个病人记录一起包含。实现这一目标的一种方法是使用几个`FIXED`
    **细节级别**（**LOD**）表达式将值返回到每一行。
- en: 'We''ll create a calculation called `Hospital Latitude` with the following code:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个名为`Hospital Latitude`的计算，代码如下：
- en: '[PRE0]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'And a corresponding calculation called `Hospital Longitude` with the following
    code:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 以及一个名为`Hospital Longitude`的相应计算，代码如下：
- en: '[PRE1]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In each case, the latitude and longitude for the hospital is determined with
    the `IF`/`THEN` logic and returned as a row-level result by the `FIXED` LOD expression.
    This gives us the building blocks for a couple of additional calculations. We'll
    next consider a couple of examples, contained in the `Chapter 12` workbook.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在每种情况下，医院的纬度和经度是通过`IF`/`THEN`逻辑确定的，并通过`FIXED` LOD表达式作为行级结果返回。这为我们提供了几个附加计算的构建块。接下来，我们将考虑`第12章`工作簿中的几个示例。
- en: MAKELINE() and MAKEPOINT()
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: MAKELINE()和MAKEPOINT()
- en: 'As we consider these two functions, we''ll create a calculated field to draw
    a line between the hospital and each patient. We''ll name our calculation `Line`
    and write this code:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑这两个功能时，我们将创建一个计算字段，绘制医院和每个患者之间的线。我们将命名我们的计算为`Line`并编写以下代码：
- en: '[PRE2]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '`MAKELINE()` requires two points, which can be created using the `MAKEPOINT()`
    function. That function requires a latitude and longitude. The first point is
    for the hospital and the second is the latitude and longitude for the patient.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`MAKELINE()`需要两个点，这些点可以通过`MAKEPOINT()`函数创建。该函数需要纬度和经度。第一个点是医院的位置，第二个点是患者的纬度和经度。'
- en: 'As the function returns a spatial object, you''ll notice the field has a geography
    icon:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 由于该函数返回一个空间对象，你会注意到该字段有一个地理图标：
- en: '![](img/B16021_12_11.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_11.png)'
- en: 'Figure 12.11: Geography icon added to Line field'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.11：地理图标已添加到Line字段
- en: On a new visualization, if you were to double-click the **Line** field, you'd
    immediately get a geographic visualization because that field defines a geospatial
    object. You'll notice the **COLLECT(Line)** field on **Detail**, and Tableau's
    **Longitude (generated)** and **Latitude (generated)** on **Columns** and **Rows**.
    The geospatial collection is drawn as a single object unless you split it apart
    by adding dimensions to the view.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个新的可视化中，如果你双击**Line**字段，你会立即得到一个地理可视化，因为该字段定义了一个地理空间对象。你会注意到**Detail**上的**COLLECT(Line)**字段，以及**Columns**和**Rows**上的Tableau的**Longitude
    (generated)**和**Latitude (generated)**。地理空间集合被绘制为一个单一对象，除非你通过向视图添加维度来将其拆分。
- en: 'In this case, each ID defines a separate line, so adding it to **Detail** on
    the **Marks** card splits the geospatial object into separate lines:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，每个ID定义了一条单独的线，因此将其添加到**Marks**卡片的**Detail**中会将地理空间对象拆分为单独的线：
- en: '![](img/B16021_12_12.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_12.png)'
- en: 'Figure 12.12: Each line originates at the hospital and is drawn to a patient'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.12：每条线从医院起点绘制到患者
- en: What if we wanted to know the distance covered by each line? We'll consider
    that next in an expanded example.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想知道每条线覆盖的距离呢？我们将在一个扩展的例子中考虑这个问题。
- en: DISTANCE()
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DISTANCE()
- en: 'Distance can be a very important concept as we analyze our data. Knowing how
    far apart two geospatial points are can give us a lot of insight. The calculation
    itself is very similar to `MAKELINE()` and we might create a calculated field
    named `Distance to the Hospital` with the following code:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 距离可能是我们分析数据时非常重要的概念。知道两个地理空间点之间的距离能为我们提供很多见解。计算本身非常类似于`MAKELINE()`，我们可以创建一个名为`Distance
    to the Hospital`的计算字段，使用以下代码：
- en: '[PRE3]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Similar to the `MAKELINE()` calculation, the `DISTANCE()` function requires
    a couple of points, but it also requires a unit of measurement. Here, we've specified
    miles using the argument `'mi'`, but we could have alternately used `'km'` to
    specify kilometers.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于`MAKELINE()`计算，`DISTANCE()`函数也需要几个点，但它还需要一个单位。这里，我们使用参数`'mi'`指定英里，但我们也可以使用`'km'`来指定公里。
- en: 'We can place this calculation on **Tooltip** to see the distance covered by
    each line:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将此计算放置在**Tooltip**上，以查看每条线所覆盖的距离：
- en: '![](img/B16021_12_13.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_13.png)'
- en: 'Figure 12.13: The tooltip now displays the distance from the hospital to the
    patient'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.13：工具提示现在显示从医院到患者的距离
- en: This simple example could be greatly extended. Right now, we can tell that patient
    ID **5** is **2.954…** miles away from the hospital when we hover over the line.
    We could improve the display by rounding down the distance to `2` decimal places
    or looking up the patient's name. We could greatly increase the analytical usefulness
    by using the distance as a filter (to analyze patients that are over or under
    a certain threshold of distance) or using distance as a correlating factor in
    more complex analysis.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 这个简单的例子可以大大扩展。现在，我们可以知道当我们悬停在这条线时，患者ID **5**距离医院**2.954…**英里。我们可以通过将距离四舍五入到`2`个小数位来改进显示，或者查看患者的名字。我们还可以通过将距离作为过滤器来显著增加分析的实用性（分析距离超过或低于某个阈值的患者），或者将距离作为更复杂分析中的相关因素。
- en: We can accomplish some of this visually with `Buffer()`, which we'll explore
    next!
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过`Buffer()`在视觉上完成一些操作，接下来我们将进一步探讨！
- en: BUFFER()
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BUFFER()
- en: Buffer is similar to `DISTANCE()`, but the reverse. Rather than calculating
    a distance between two points, the `BUFFER()` function allows you to specify a
    point, a distance, and a unit of measurement to draw a circle with a radius of
    the specified distance around the point.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: Buffer函数与`DISTANCE()`类似，但方向相反。与其计算两个点之间的距离，`BUFFER()`函数允许你指定一个点、一个距离和一个单位，进而在该点周围绘制一个具有指定半径的圆。
- en: 'For example, you might want to visualize which patients fall within a 3-mile
    radius of the hospital. To do that, we''ll create a calculated field named `Hospital
    Radius`, with the following code:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可能想要可视化哪些病人在医院的3英里半径范围内。为此，我们将创建一个名为`Hospital Radius`的计算字段，代码如下：
- en: '[PRE4]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This code first checks to make sure to perform the calculation only for the
    hospital record. The `BUFFER()` calculation itself uses the latitude and longitude
    to make a point and then specifies a 3-mile radius.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码首先检查确保只对医院记录进行计算。`BUFFER()`计算本身使用经纬度来生成一个点，并指定一个3英里半径。
- en: 'In order to visualize the radius along with the individual marks for each patient,
    we''ll create a **dual-axis map**. A dual-axis map copies either the latitude
    or longitude fields on rows or columns and then uses the separate sections of
    the **Marks** card to render different geospatial objects. Here, for example,
    we''ll plot the points for patients as circles and the radius using the **Automatic**
    mark type:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 为了可视化半径以及每个病人的个体标记，我们将创建一个**双轴地图**。双轴地图会复制经纬度字段并放在行或列中，然后使用**Marks**卡片的不同部分来渲染不同的地理空间对象。例如，在这里我们将病人的位置以圆点表示，将半径以**自动**标记类型表示：
- en: '![](img/B16021_12_14.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_14.png)'
- en: 'Figure 12.14: Patients who fall within a 3-mile radius of the hospital'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.14：位于医院3英里半径范围内的病人
- en: Notice that we've used the generated **Latitude** and **Longitude** fields.
    These serve as placeholders for Tableau to visualize any spatial objects. On the
    first section of the **Marks** card, we include the **Latitude** and **Longitude**
    fields from the data. On the second, we included the **Hospital Radius** field.
    In both cases, the generated fields allow Tableau to use the geographic or spatial
    objects on the **Marks** card to define the visualization.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们使用了生成的**纬度**和**经度**字段。这些字段作为占位符，供Tableau可视化任何空间对象。在**Marks**卡片的第一个部分，我们包含了来自数据的**纬度**和**经度**字段。在第二部分，我们加入了**医院半径**字段。在这两种情况下，生成的字段使Tableau能够使用**Marks**卡片上的地理或空间对象来定义可视化。
- en: We've barely scratched the surface of what's possible with spatial functions.
    For example, you could parameterize the radius value to allow the end user to
    change the distance dynamically. You could use `MAKEPOINT()` and `BUFFER()` calculations
    as join calculations in your data source to bring together spatially related data.
    With this data, for example, you could **intersect join** the hospital record
    on `BUFFER()` to the patient records on `MAKEPOINT()` to specifically work with
    a dataset that includes or excludes patients within a certain radius. This greatly
    increases your analytic capabilities.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚触及空间函数的表面。例如，你可以将半径值参数化，以便让最终用户动态更改距离。你还可以将`MAKEPOINT()`和`BUFFER()`计算作为连接计算在数据源中使用，以便将空间相关的数据汇聚在一起。例如，利用这些数据，你可以通过`BUFFER()`与`MAKEPOINT()`的**相交连接**将医院记录与病人记录结合，专门处理包含或排除特定半径内病人的数据集。这大大提升了你的分析能力。
- en: 'With a good understanding of the geospatial functions available, let''s shift
    our focus just a bit to discuss another topic of interest: creating custom territories.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 在充分理解了可用的地理空间函数后，我们稍微调整一下焦点，讨论另一个感兴趣的话题：创建自定义区域。
- en: Creating custom territories
  id: totrans-142
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建自定义区域
- en: '**Custom territories** are geographic areas or regions that you create (or
    that the data defines) as opposed to those that are built in (such as country
    or area code). Tableau gives you two options for creating custom territories:
    **ad hoc custom territories** and **field-defined custom territories**. We''ll
    explore these next.'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '**自定义区域**是你创建的（或数据定义的）地理区域或范围，而非内建的区域（例如国家或区号）。Tableau为你提供了两种创建自定义区域的选项：**临时自定义区域**和**字段定义自定义区域**。接下来我们将探讨这两者。'
- en: Ad hoc custom territories
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 临时自定义区域
- en: You can create custom territories in an ad hoc way by selecting and grouping
    marks on a map. Simply select one or more marks, hover over one, and then use
    the **Group** icon. Alternately, right-click one of the marks to find the option.
    You can create custom territories by grouping by any dimension if you have latitude
    and longitude in the data or any geographic dimension if you are using Tableau's
    generated latitude and longitude.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过选择和分组地图上的标记，以一种临时方式创建自定义区域。只需选择一个或多个标记，悬停在一个标记上，然后使用**分组**图标。或者，右键点击其中一个标记，找到相关选项。如果数据中包含纬度和经度，或者你正在使用
    Tableau 生成的纬度和经度，你可以按任何维度进行分组，从而创建自定义区域。
- en: 'Here, we''ll consider an example using zip code:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将通过邮政编码来考虑一个例子：
- en: '![](img/B16021_12_15.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_15.png)'
- en: 'Figure 12.15: After selecting the filled regions to group as a new territory,
    use the paperclip icon to create the group'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.15：选择填充区域并将其分组为一个新区域后，使用回形针图标创建该分组
- en: 'You''ll notice that Tableau creates a new field, `Zip Code (group)`, in this
    example. The new field has a paperclip and globe icon in the data pane, indicating
    it is a group and a geographic field:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 你会注意到，在这个例子中，Tableau 创建了一个新的字段 `Zip Code (group)`。该字段在数据面板中显示了回形针和地球图标，表明它是一个分组字段和地理字段：
- en: '![](img/B16021_12_16.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_16.png)'
- en: 'Figure 12.16: A group and geographic field'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.16：一个分组和地理字段
- en: Tableau automatically includes the group field on **Color**.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: Tableau 会自动将分组字段添加到**颜色**上。
- en: 'You may continue to select and group marks until you have all the custom territories
    you''d like. With zip code still part of the view level of detail, you will have
    a mark for each zip code (and any measure will be sliced by zip code). However,
    when you remove zip code from the view, leaving only the `Zip Code (group)` field,
    Tableau will draw the marks based on the new group:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以继续选择和分组标记，直到你得到所有所需的自定义区域。由于邮政编码仍然是视图级别的详细信息，视图中将显示每个邮政编码的标记（并且任何度量值将按邮政编码切分）。然而，当你从视图中移除邮政编码，仅保留`Zip
    Code (group)`字段时，Tableau 会根据新的分组绘制标记：
- en: '![](img/B16021_12_17.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_17.png)'
- en: 'Figure 12.17: Grouping by Custom Territories'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.17：按自定义区域分组
- en: Here, the group field has been renamed `Custom Territories` and the group names
    have been aliased as `East`, `West`, and `Central`. We can see the average price
    of houses in each of the custom territories.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，分组字段已重命名为 `Custom Territories`，并且分组名称已别名为`东区`、`西区`和`中区`。我们可以看到每个自定义区域内的房屋平均价格。
- en: The details of these capabilities are outside the scope of this book, however,
    you'll find excellent documentation from Tableau at [https://help.tableau.com/current/pro/desktop/en-us/maps_mapsources_wms.htm](https://help.tableau.com/current/pro/desktop/en-us/maps_mapsources_wms.htm).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这些功能的详细内容超出了本书的范围，但你可以在 Tableau 的[文档](https://help.tableau.com/current/pro/desktop/en-us/maps_mapsources_wms.htm)中找到相关信息。
- en: With a filled map, Tableau will connect all contiguous areas and still include
    disconnected areas as part of selections and highlighting. With a symbol map,
    Tableau will draw the mark in the geographic center of all grouped areas.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 使用填充地图时，Tableau 会连接所有相邻区域，并仍然将不相连的区域包含在选择和高亮显示中。使用符号地图时，Tableau 会在所有分组区域的地理中心绘制标记。
- en: Sometimes the data itself defines the territories. In that case, we won't need
    to manually create the territories. Instead, we'll use the technique described
    next.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，数据本身就定义了区域。在这种情况下，我们无需手动创建区域。相反，我们将使用接下来描述的技术。
- en: Field-defined custom territories
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 字段定义的自定义区域
- en: Sometimes your data includes the definition of custom territories. For example,
    let's say your data had a field named **Region** that already grouped zip codes
    into various regions. That is, every zip code was contained in only one region.
    You might not want to take the time to select marks and group them manually.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 有时你的数据包含自定义区域的定义。例如，假设你的数据中有一个名为**Region**的字段，已经将邮政编码分组到不同的区域中。也就是说，每个邮政编码只包含在一个区域中。在这种情况下，你可能不想花时间手动选择标记并进行分组。
- en: 'Instead, you can tell Tableau the relationship already exists in the data.
    In this example, you''d use the drop-down menu of the **Region** field in the
    data pane and select **Geographic Role** | **Create From...** | **Zip Code**.
    **Region** is now a geographic field that defines custom territories:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，你可以告诉 Tableau 数据中已经存在这种关系。在这个例子中，你可以使用数据面板中**Region**字段的下拉菜单，选择**地理角色** |
    **从...创建** | **邮政编码**。现在，**Region**变成了一个地理字段，定义了自定义区域：
- en: '![](img/B16021_12_18.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_18.png)'
- en: 'Figure 12.18: The custom regions here are defined by the Region field in the
    data'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.18：此处的自定义区域由数据中的区域字段定义
- en: In this case, the regions have been defined by the **Region** field in the data.
    If the regions are redefined at a later date, Tableau will display the new regions
    (as long as the data is updated). Using field-defined custom regions gives us
    confidence that we won't need to manually update the definitions.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，区域是由数据中的**区域**字段定义的。如果稍后重新定义这些区域，Tableau 会显示新区域（只要数据已更新）。使用字段定义的自定义区域使我们确信不需要手动更新定义。
- en: Use ad hoc custom territories to perform quick analysis, but consider field-defined
    custom territories for long-term solutions because you can then redefine the territories
    in the data without manually editing any groups in the Tableau data source.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 使用临时自定义区域进行快速分析，但考虑使用字段定义的自定义区域作为长期解决方案，因为这样你可以在数据中重新定义区域，而无需手动编辑 Tableau 数据源中的任何分组。
- en: Tableau mapping – tips and tricks
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Tableau 地图 – 提示与技巧
- en: 'There are a few other tips to consider when working with geographic visualizations:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理地理可视化时，还需考虑一些其他提示：
- en: Use the top menu to select **Map** | **Map Layers** for numerous options for
    what layers of background to show as part of the map.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 使用顶部菜单选择**地图** | **地图图层**，以查看多个可作为地图一部分显示的背景图层选项。
- en: Other options for zooming include using the mouse wheel, double-clicking, *Shift*
    + *Alt* + click, and *Shift* + *Alt* + *Ctrl* + click.
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 放大还可以通过使用鼠标滚轮、双击、*Shift* + *Alt* + 点击以及*Shift* + *Alt* + *Ctrl* + 点击来实现。
- en: You can click and hold for a few seconds to switch to pan mode.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以点击并按住几秒钟来切换到平移模式。
- en: You can show or hide the zoom controls and/or map search by right-clicking the
    map and selecting the appropriate option.
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以通过右键点击地图并选择相应选项来显示或隐藏缩放控制和/或地图搜索。
- en: Zoom controls can be shown on any visualization type that uses an axis.
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缩放控制可以在任何使用轴的可视化类型上显示。
- en: The pushpin on the zoom controls alternately returns the map to the best fit
    of visible data or locks the current zoom and location.
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 放大控制按钮上的图钉会交替将地图恢复到适合可见数据的最佳视图，或者锁定当前的缩放和位置。
- en: You can create a **dual-axis map** by duplicating (*Ctrl* + drag/drop) either
    the **Longitude** on **Columns** or **Latitude** on **Rows** and then using the
    field's drop-down menu to select **Dual Axis**. You can use this technique to
    combine multiple mark types on a single map:![](img/B16021_12_19.png)
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以通过复制（*Ctrl* + 拖动/放置）**列**上的**经度**或**行**上的**纬度**来创建**双轴地图**，然后使用字段的下拉菜单选择**双轴**。你可以使用这种技巧在单一地图上结合多种标记类型：![](img/B16021_12_19.png)
- en: 'Figure 12.19: Dual Axis Map showing Profit at a state level and Sales at a
    Postal Code level'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 12.19：双轴地图，显示州级的利润和邮政编码级别的销售额
- en: 'You can use dual axes to display various levels of detail or to use different
    mark types. In this case, both are accomplished. The map leverages the dual axis
    to show **Profit** at a state level with a filled map and **Sales** at a **Postal
    Code** level with a circle:'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以使用双轴来显示不同级别的细节或使用不同的标记类型。在这种情况下，两个目标都已实现。该地图利用双轴在州级别显示填充地图的**利润**，在**邮政编码**级别显示圆形的**销售额**：
- en: When using filled maps, consider setting **Washout** to **100%** in the **Map
    Layers** window for clean-looking maps. However, only filled shapes will show,
    so any missing states (or counties, countries, or others) will not be drawn:![](img/B16021_12_20.png)
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在使用填充地图时，考虑在**地图图层**窗口中将**洗净**设置为**100%**，以获得干净的地图效果。然而，只有填充的形状会显示，因此任何缺失的州（或县、国家等）将不会被绘制：![](img/B16021_12_20.png)
- en: 'Figure 12.20: Washed Out Map'
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 12.20：洗净地图
- en: You can change the source of the background map image tiles using the menu and
    selecting **Map** | **Background Maps**. This allows you to choose between **None**,
    **Offline** (which is useful when you don't have an internet connection but is
    limited in the detail that can be shown), or **Tableau** (the default).
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以通过菜单选择**地图** | **背景地图**来更改背景地图图像的来源。这样，你可以选择**无**、**离线**（在没有互联网连接时使用，但显示的细节有限）或**Tableau**（默认选项）。
- en: Additionally, from the same menu option, you can specify **Map Services...**
    to use a `WMS server` or `Mapbox`.
  id: totrans-181
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此外，从同一菜单选项中，你可以指定**地图服务...**来使用`WMS 服务器`或`Mapbox`。
- en: Next, we'll conclude this chapter by exploring how plotting your data onto background
    images can further enhance data visualization and presentation.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将通过探讨如何将数据绘制到背景图像上，来进一步提升数据可视化和展示效果，从而结束本章内容。
- en: Plotting data on background images
  id: totrans-183
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将数据绘制到背景图像上
- en: Background images allow you to plot data on top of any image. Consider the possibilities!
    You could plot ticket sales by seat on an image of a stadium, room occupancy on
    the floor plan of an office building, the number of errors per piece of equipment
    on a network diagram, or meteor impacts on the surface of the moon.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 背景图像允许你在任何图像上绘制数据。想象一下这些可能性！你可以在体育场的座位图上绘制票务销售数据、在办公室楼层图上绘制房间占用情况、在网络图上绘制每个设备的错误数量，或者在月球表面绘制陨石撞击数据。
- en: 'In this example, we''ll plot the number of patients per month in various rooms
    in a hospital. We''ll use two images of floorplans for the ground floor and the
    second floor of the hospital. The data source is located in the `Chapter 12` directory
    and is named `Hospital.xlsx`. It consists of two tabs: one for patient counts
    and another for room locations based on the x/y coordinates mapped to the images.
    We''ll shortly consider how that works. You can view the completed example in
    the `Chapter 12` `Complete.twbx` workbook or start from scratch using `Chapter
    12` `Starter.twbx`.'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们将绘制每月在医院不同房间里的病人数。我们将使用医院底层和二层的两张平面图作为图像。数据源位于`Chapter 12`目录下，文件名为`Hospital.xlsx`。它包含两个标签：一个是病人数统计，另一个是基于映射到图像上的x/y坐标的房间位置。我们接下来将讨论它是如何工作的。你可以查看`Chapter
    12`目录下的`Complete.twbx`工作簿来查看完整示例，或者从头开始使用`Chapter 12`目录下的`Starter.twbx`。
- en: To specify a background image, use the top menu to select **Map** | **Background
    Images** and then click the data source to which the image applies – in this example,
    `Patient Activity (Hospital)`. On the **Background Images** screen, you can add
    one or more images.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 要指定背景图片，请使用顶部菜单选择**地图** | **背景图片**，然后点击适用该图像的数据源——在本例中为`Patient Activity (Hospital)`。在**背景图片**屏幕上，您可以添加一张或多张图片。
- en: 'Here, we''ll start with `Hospital - Ground Floor.png`, located in the `Chapter
    12` directory:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将从位于`Chapter 12`目录下的`Hospital - Ground Floor.png`开始：
- en: '![](img/B16021_12_21.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_21.png)'
- en: 'Figure 12.21: Add Background Image pane'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.21：添加背景图片窗格
- en: You'll notice that we mapped the fields **X** and **Y** (from the **Locations**
    tab) and specified **Right** at **800** and **Bottom** at **700**. This is based
    on the size of the image in pixels.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 你会注意到我们映射了**X**和**Y**字段（来自**Locations**标签），并指定了**Right**为**800**，**Bottom**为**700**。这是基于图像的像素大小。
- en: You don't have to use pixels, but most of the time it makes it far easier to
    map the locations for the data. In this case, we have a tab of an Excel file with
    the locations already mapped to the **x** and **y** coordinates on the image (in
    pixels). With cross-database joins, you can create a simple text or Excel file
    containing mappings for your images and join them to an existing data source.
    You can map points manually (using a graphics application) or use one of many
    free online tools that allow you to quickly map coordinates on images.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 你不必使用像素，但大多数情况下，使用像素能让映射数据位置更容易。在这个例子中，我们有一个Excel文件标签，里面已经将位置映射到图像上的**x**和**y**坐标（单位为像素）。通过跨数据库联接，你可以创建一个包含图片映射的简单文本或Excel文件，并将其连接到现有数据源。你可以手动映射点（使用图形应用程序）或使用多个免费的在线工具，快速在图片上映射坐标。
- en: 'We''ll only want to show this blueprint for the ground floor, so switching
    to the **Options** tab, we''ll ensure that the condition is set based on the data.
    We''ll also make sure to check **Always Show Entire Image**:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只想显示这一蓝图的底层平面图，因此切换到**Options**标签，我们将确保基于数据设置条件。我们还将确保勾选**始终显示整个图像**：
- en: '![](img/B16021_12_22.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_22.png)'
- en: 'Figure 12.22: Edit Background Image pane'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.22：编辑背景图片窗格
- en: Next, repeating the preceding steps, we'll add the second image (`Hospital -
    2nd Floor.png`) to the data source, ensuring it only shows for `2nd Floor`.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，重复前面的步骤，我们将把第二张图像（`Hospital - 2nd Floor.png`）添加到数据源中，并确保它只在`2nd Floor`显示。
- en: 'Once we have the images defined and mapped, we''re ready to build a visualization.
    The basic idea is to build a scatterplot using the **X** and **Y** fields for
    axes. But we have to ensure that **X** and **Y** are not summed because if they
    are added together for multiple records, then we no longer have a correct mapping
    to pixel locations. There are a couple of options:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们定义并映射了图像，就可以开始构建可视化了。基本思路是使用**X**和**Y**字段作为轴来构建散点图。但我们必须确保**X**和**Y**没有被求和，因为如果它们在多个记录中被相加，就无法正确映射到像素位置。这里有几个选项：
- en: Use **X** and **Y** as continuous dimensions.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**X**和**Y**作为连续维度。
- en: Use `MIN`, `MAX`, or `AVG` instead of `SUM`, and ensure that **Location** is
    used to define the view level of detail.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `MIN`、`MAX` 或 `AVG` 替代 `SUM`，并确保 **位置** 被用来定义视图的细节级别。
- en: Additionally, images are measured from 0 at the top to **Y** at the bottom,
    but scatterplots start with 0 at the bottom and values increase upward. So, initially,
    you may see your background images appear upside-down. To get around this, we'll
    edit the *y* axis (right-click and select **Edit Axis**) and check the option
    for **Reversed**.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此外，图像从顶部的 0 到底部的 **Y** 进行度量，而散点图则从底部的 0 开始，数值向上增加。因此，最初你可能会看到背景图像显示倒置。为了避免这个问题，我们将编辑
    *y* 轴（右键点击并选择 **编辑轴**），然后勾选 **反向** 选项。
- en: 'We also need to ensure that the **Floor** field is used in the view. This is
    necessary to tell Tableau which image should be displayed. At this point, we should
    be able to get a visualization like this:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要确保 **楼层** 字段被用于视图中。这是为了告诉 Tableau 应该显示哪个图像。在这一点上，我们应该能够得到如下的可视化效果：
- en: '![](img/B16021_12_23.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B16021_12_23.png)'
- en: 'Figure 12.23: Plotting the number of patients per room on a floorplan image'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.23：在楼层平面图像上绘制每个房间的患者数量
- en: 'Here, we''ve plotted circles with the size based on the number of patients
    in each room. We could clean up and modify the visualization in various ways:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们已根据每个房间的患者数量绘制了大小不同的圆圈。我们可以通过多种方式清理和修改可视化：
- en: Hide the *x* and *y* axes (right-click the axis and uncheck **Show Header**)
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐藏 *x* 和 *y* 轴（右键点击轴并取消勾选 **显示标题**）
- en: Hide the header for **Floor**, as the image already includes the label
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐藏 **楼层** 的标题，因为图像已经包含了标签
- en: Add **Floor** to the **Filter** shelf so that the end user can choose to see
    one floor at a time
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 **楼层** 添加到 **筛选器** 架上，以便最终用户可以选择一次查看一个楼层
- en: The ability to plot marks on background images opens a world of possibilities
    for communicating complex topics. Consider how you might show the number of hardware
    errors on a diagram of a computer network, the number of missed jump shots on
    a basketball court, or the distance between people in an office building. All of
    this, and more, is possible!
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在背景图像上绘制标记的功能为传达复杂主题开辟了无限的可能性。想想你如何在计算机网络的图示上显示硬件错误数量，在篮球场上显示未投中的跳投次数，或者显示办公室大楼中人与人之间的距离。所有这一切，甚至更多，都是可能的！
- en: Summary
  id: totrans-208
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: We've covered a lot of ground in this chapter! The basics of visualizing maps
    are straightforward, but there is a lot of power and possibility behind the scenes.
    From using your own geospatial data to leveraging geospatial objects and functions,
    you have a lot of analytical options. Creating custom territories and plotting
    data on background images expand your possibilities even further.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们已经覆盖了很多内容！可视化地图的基本操作很简单，但背后有很多强大的功能和可能性。从使用你自己的地理空间数据到利用地理空间对象和函数，你有很多分析选项。创建自定义区域并在背景图像上绘制数据，进一步扩展了你的可能性。
- en: 'Next, we''ll turn our attention to a brand new feature of Tableau 2020.2: Data
    Model! And we''ll explore the difference between data model relationships, joins,
    blends, and see how all of them can be used to perform all kinds of valuable analysis!'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将重点介绍 Tableau 2020.2 的全新功能：数据模型！我们将探讨数据模型关系、连接、混合的区别，并看看如何使用它们进行各种有价值的分析！
