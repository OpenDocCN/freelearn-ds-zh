- en: '5'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '5'
- en: Using Visualizations for the Identification of Unexpected Values
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用可视化工具识别意外值
- en: We dipped our toes in the water on visualizations in several recipes in the
    previous chapter. We used histograms and QQ plots to examine the distribution
    of a single variable, and scatter plots to view how two variables are related.
    But we were just scratching the surface of the rich visualization tools available
    in the Matplotlib and Seaborn libraries. Getting comfortable with these tools,
    and their seemingly inexhaustible capabilities, can help us uncover patterns and
    oddities that are not obvious when we run the standard battery of descriptives.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章的多个配方中，我们已初步接触了可视化的内容。我们使用了直方图和QQ图来检查单一变量的分布，使用散点图查看两个变量之间的关系。但这仅仅是我们在 Matplotlib
    和 Seaborn 库中丰富的可视化工具的冰山一角。熟悉这些工具及其似乎无穷无尽的功能，可以帮助我们发现通过标准描述性统计无法轻易察觉的模式和异常。
- en: Boxplots, for example, are a great tool for visualizing values outside of a
    certain range. These can be extended with grouped boxplots or violin plots that
    allow us to compare distributions across subsets of data. We can also do much
    more with scatter plots than we did in the last chapter, including getting some
    sense of multivariate relationships. Histograms, too, can sometimes offer additional
    insight if we display several histograms on one plot or create a stacked histogram.
    We explore all of these capabilities in this chapter.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，箱形图是一个非常适合可视化超出特定范围的值的工具。这些工具可以通过分组箱形图或小提琴图进行扩展，允许我们比较不同数据子集之间的分布。我们还可以用散点图做更多的探索，而不仅仅是上一章所做的那样，甚至可以获得一些关于多变量关系的见解。直方图如果将多个直方图绘制在同一图表中，或者创建堆叠直方图时，也能提供更多的见解。本章将深入探讨这些功能。
- en: 'Specifically, the recipes in this chapter demonstrate the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的配方具体展示了以下内容：
- en: Using histograms to examine the distribution of continuous variables
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用直方图检查连续变量的分布
- en: Using boxplots to identify outliers for continuous variables
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用箱形图识别连续变量的异常值
- en: Using grouped boxplots to uncover unexpected values in a particular group
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用分组箱形图发现特定组中的意外值
- en: Examining both distribution shape and outliers with violin plots
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用小提琴图同时检查分布形态和异常值
- en: Using scatter plots to view bivariate relationships
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用散点图查看双变量关系
- en: Using line plots to examine trends in continuous variables
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用折线图检查连续变量的趋势
- en: Generating a heat map based on a correlation matrix
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于相关矩阵生成热图
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: You will need Pandas, Numpy, Matplotlib, and Seaborn to complete the recipes
    in this chapter. I used `pandas 2.1.4`, but the code will run on `pandas 1.5.3`
    or later.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本章中的配方，你将需要 Pandas、Numpy、Matplotlib 和 Seaborn。我使用的是`pandas 2.1.4`，但代码在`pandas
    1.5.3`或更高版本上也能运行。
- en: The code in this chapter can be downloaded from the book’s GitHub repository,
    `https://github.com/PacktPublishing/Python-Data-Cleaning-Cookbook-Second-Edition`.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的代码可以从本书的 GitHub 仓库下载，`https://github.com/PacktPublishing/Python-Data-Cleaning-Cookbook-Second-Edition`。
- en: Using histograms to examine the distribution of continuous variables
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用直方图检查连续变量的分布
- en: The go-to visualization tool for statisticians trying to understand how single
    variables are distributed is the histogram. Histograms plot a continuous variable
    on the *x* axis in bins determined by the researcher, and the frequency of occurrence
    on the *y* axis.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 统计学家用来理解单个变量分布的首选可视化工具是直方图。直方图将一个连续变量绘制在*X*轴上，分箱由研究者确定，频率分布则显示在*Y*轴上。
- en: Histograms provide a clear and meaningful illustration of the shape of a distribution,
    including central tendency, skewness (symmetry), excess kurtosis (relatively fat
    tails), and spread. This matters for statistical testing, as many tests make assumptions
    about a variable’s distribution. Moreover, our expectation of what data values
    to expect should be guided by our understanding of the distribution’s shape. For
    example, a value at the 90^(th) percentile has very different implications when
    it comes from a normal distribution rather than from a uniform distribution.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图提供了一个清晰且有意义的分布形态图示，包括集中趋势、偏度（对称性）、超额峰度（相对较胖的尾部）和分散程度。这对于统计检验至关重要，因为许多检验会假设变量的分布。此外，我们对数据值的预期应该以对分布形态的理解为指导。例如，来自正态分布的90^(th)百分位值与来自均匀分布的值有着非常不同的含义。
- en: One of the first tasks I ask introductory statistics students to do is to construct
    a histogram manually from a small sample. We do boxplots in the following class.
    Together, histograms and boxplots provide a solid foundation for subsequent analysis.
    In my data science work, I try to remember to construct histograms and boxplots
    on all continuous variables of interest shortly after the initial importing and
    cleaning of data. We create histograms in this recipe, and boxplots in the following
    two recipes.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 我要求初学统计学的学生做的第一项任务之一是从一个小样本手动构建直方图。下一节课我们将学习箱型图。直方图和箱型图一起为后续分析提供了坚实的基础。在我的数据科学工作中，我尽量记得在数据导入和清理之后，尽快为所有感兴趣的连续变量构建直方图和箱型图。在本食谱中，我们将创建直方图，接下来的两个食谱中我们将创建箱型图。
- en: Getting ready
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will use the `Matplotlib` library to generate histograms. Some tasks can
    be done quickly and straightforwardly in Matplotlib. Histograms are one of those
    tasks. We will switch between Matplotlib and Seaborn (which is built on Matplotlib)
    in this chapter depending on which tool gets us to the required graphic more easily.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用`Matplotlib`库生成直方图。在Matplotlib中，一些任务可以快速且直接地完成，直方图就是其中之一。在本章中，我们将根据哪个工具更容易生成所需的图形，来在Matplotlib和基于Matplotlib的Seaborn之间切换。
- en: We will also use the `statsmodels` library. You can install Matplotlib and statsmodels
    with pip using `pip install matplotlib` and `pip install statsmodels`.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将使用`statsmodels`库。你可以使用`pip install matplotlib`和`pip install statsmodels`通过pip安装Matplotlib和statsmodels。
- en: We will work with data covering Earth surface temperatures and COVID-19 cases
    in this recipe. The surface temperature DataFrame has one row per weather station.
    The COVID-19 DataFrame has one row per country with total cases and demographic
    information.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将处理地球表面温度和COVID-19病例的数据。地表温度数据框包含每个天气站的一行数据。COVID-19数据框包含每个国家的一行数据，其中包括总病例数和人口统计信息。
- en: '**Note**'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: The surface temperature DataFrame has the average temperature reading (in °C)
    in 2023 from over 12,000 stations across the world, though a majority of the stations
    are in the United States. The raw data was retrieved from the Global Historical
    Climatology Network integrated database. It is made available for public use by
    the United States National Oceanic and Atmospheric Administration at [https://www.ncei.noaa.gov/products/land-based-station/global-historical-climatology-network-monthly](https://www.ncei.noaa.gov/products/land-based-station/global-historical-climatology-network-monthly).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 地表温度数据框包含来自全球超过12,000个站点的2023年平均温度读数（单位：°C），尽管大多数站点位于美国。原始数据来自全球历史气候网络（GHCN）集成数据库。美国国家海洋和大气管理局提供该数据供公众使用，网址为[https://www.ncei.noaa.gov/products/land-based-station/global-historical-climatology-network-monthly](https://www.ncei.noaa.gov/products/land-based-station/global-historical-climatology-network-monthly)。
- en: '*Our World in Data* provides COVID data for public use at [https://ourworldindata.org/covid-cases](https://ourworldindata.org/covid-cases).
    The data used in this recipe was downloaded on March 3, 2024.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们的世界数据*提供了供公众使用的COVID数据，网址为[https://ourworldindata.org/covid-cases](https://ourworldindata.org/covid-cases)。本食谱中使用的数据是2024年3月3日下载的。'
- en: How to do it…
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'We take a close look at the distribution of surface temperatures by weather
    station in 2023 and total COVID-19 cases per million in population for each country.
    We start with a few descriptive statistics before doing a QQ plot, histograms,
    and stacked histograms:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仔细查看了2023年各天气站的地表温度分布，以及每个国家每百万人的COVID-19总病例数。我们首先进行一些描述性统计，然后绘制QQ图、直方图和堆积直方图：
- en: Import the `pandas`, `matplotlib`, and `statsmodels` libraries.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入`pandas`、`matplotlib`和`statsmodels`库。
- en: 'Also, load the data on surface temperatures and COVID-19 cases:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，加载地表温度和COVID-19病例的数据：
- en: '[PRE0]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Show some of the station temperature rows.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示一些天气站的温度行。
- en: 'The `latabs` column is the value of latitude without the north or south indicators;
    so, Cairo, Egypt at approximately 30 degrees north, and Porto Alegre, Brazil at
    about 30 degrees south have the same value:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`latabs`列是纬度的值，不包括北方或南方指示符；因此，位于大约30度北纬的埃及开罗和位于大约30度南纬的巴西阿雷格里港有相同的值：'
- en: '[PRE1]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Show some descriptive statistics.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示一些描述性统计信息。
- en: 'Also, look at skewness and kurtosis:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，查看偏度和峰度：
- en: '[PRE3]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '[PRE5]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Do a histogram of average temperatures.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制平均温度的直方图。
- en: 'Also, draw a line at the overall mean:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，在整体均值处绘制一条线：
- en: '[PRE9]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This results in the following histogram:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下直方图：
- en: '![](img/B18596_05_01.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_01.png)'
- en: 'Figure 5.1: Histogram of average temperatures across weather stations in 2019'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.1：2019 年各气象站的平均温度直方图
- en: Run a QQ plot to examine where the distribution deviates from a normal distribution.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 QQ 图，检查分布与正态分布的偏离情况。
- en: 'Notice that much of the distribution of temperatures falls along the red line
    (all dots would fall on the red line if the distribution were perfectly normal,
    but the tails fall off dramatically from normal):'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到大部分温度分布沿着红线分布（如果分布完全正常，所有点都会落在红线上，但尾部明显偏离正常分布）：
- en: '[PRE10]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This results in the following QQ plot:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这产生了以下 QQ 图：
- en: '![](img/B18596_05_02.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_02.png)'
- en: 'Figure 5.2: Plot of average temperature by station compared with a normal distribution'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.2：各气象站的平均温度与正态分布的对比图
- en: Show the skewness and kurtosis for total COVID-19 cases per million.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示每百万的总 COVID-19 病例的偏度和峰度。
- en: 'This is from the COVID-19 DataFrame, which has one row for each country:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 这来自 COVID-19 数据框，其中每一行代表一个国家：
- en: '[PRE11]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '[PRE13]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Do a stacked histogram of the COVID-19 case data.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 做一个 COVID-19 病例数据的堆叠直方图。
- en: 'Select data from four of the regions. (Stacked histograms can get messy with
    any more categories than that.) Define a `getcases` function that returns a Series
    for `total_cases_pm` for the countries of a region. Pass those Series to the `hist`
    method (`[getcases(k) for k in showregions]`) to create the stacked histogram.
    Notice how much unlike the other regions Western Europe is, accounting for almost
    all countries with cases per million above 500,000:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 从四个地区选择数据。（堆叠直方图如果类别超过这个数目会显得很杂乱。）定义一个 `getcases` 函数，返回一个地区内各国的 `total_cases_pm`
    Series。将这些 Series 传递给 `hist` 方法（`[getcases(k) for k in showregions]`）以创建堆叠直方图。注意，西欧与其他地区的差异，几乎所有每百万病例数超过
    500,000 的国家都位于该地区：
- en: '[PRE15]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This results in the following stacked histogram:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这产生了以下堆叠直方图：
- en: '![](img/B18596_05_03.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_03.png)'
- en: 'Figure 5.3: Stacked histogram of the number of countries per region at different
    levels of cases per million'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.3：按地区分布的各国病例数的堆叠直方图，每百万人的不同病例数水平
- en: Show multiple histograms on one figure.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在同一图形中显示多个直方图。
- en: 'This allows different *x* and *y* axis values. We need to loop through each
    axis and select a different region from `showregions` for each subplot:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 这允许不同的 *x* 和 *y* 坐标轴值。我们需要循环遍历每个坐标轴，并为每个子图选择 `showregions` 中的一个不同地区：
- en: '[PRE16]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'This results in the following histograms:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 这产生了以下直方图：
- en: '![](img/B18596_05_04.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_04.png)'
- en: 'Figure 5.4: Histograms of numbers of countries by region at different levels
    of cases per million'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.4：按每百万病例不同水平，按地区分布的国家数量的直方图
- en: The preceding steps demonstrated how to visualize the distribution of a continuous
    variable using histograms and QQ plots.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的步骤演示了如何通过直方图和 QQ 图来可视化连续变量的分布。
- en: How it works…
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: '*Step 4* shows how easy it is to display a histogram. This can be done by passing
    a Series to the `hist` method of Matplotlib’s `pyplot` module. (We use an alias
    of `plt` for Matplotlib.) We could have also passed any `ndarray`, or even a list
    of data Series.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '*步骤 4* 显示了显示直方图是多么容易。这可以通过将一个 Series 传递给 Matplotlib 的 `pyplot` 模块中的 `hist`
    方法来完成。（我们为 Matplotlib 使用了 `plt` 的别名。）我们也可以传递任何 `ndarray`，甚至是数据 Series 的列表。'
- en: We also get great access to the attributes of the figure and its axes. We can
    set the labels for each axis, as well as the tick marks and tick labels. We can
    also specify the content and look and feel of the legend. We will be taking advantage
    of this functionality often in this chapter.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以很好地访问图形及其坐标轴的属性。我们可以设置每个坐标轴的标签、刻度标记和刻度标签。我们还可以指定图例的内容及其外观。在本章中，我们将经常利用这一功能。
- en: We pass multiple Series to the `hist` method in *Step 7* to produce the stacked
    histogram. Each Series is the `total_cases_pm` (cases per million of the population)
    value for the countries in a region. To get the Series for each region, we call
    the `getcases` function for each item in `showregions`. We choose colors for each
    Series rather than allowing them to be applied automatically. We also use the
    `showregions` list to select labels for the legend.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将多个 Series 传递给 *步骤 7* 中的 `hist` 方法，以生成堆叠直方图。每个 Series 是一个地区内各国的 `total_cases_pm`（每百万人的病例数）值。为了获得每个地区的
    Series，我们为 `showregions` 中的每个项调用 `getcases` 函数。我们为每个 Series 选择颜色，而不是让系统自动分配颜色。我们还使用
    `showregions` 列表选择图例的标签。
- en: In *Step 8*, we start by indicating that we want four subplots, in two rows
    and two columns. That is what we get with `plt.subplots(2, 2)`, which returns
    both a figure and the four axes. We loop through the axes with `for j, ax in enumerate(axes)`.
    Within each loop, we select a different region for the histogram from `showregions`.
    Within each axis, we loop through the tick labels and change the rotation. We
    also adjust the start of the subplots to make enough room for the figure title.
    Note that we need to use `suptitle` to add a title in this case. Using `title`
    would add the title to a subplot.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤8*中，我们首先指定要创建四个子图，分为两行两列。这就是 `plt.subplots(2, 2)` 的返回结果，它返回了图形和四个坐标轴。我们通过
    `for j, ax in enumerate(axes)` 循环遍历坐标轴。在每次循环中，我们从 `showregions` 中选择一个不同的区域来绘制直方图。在每个坐标轴内，我们循环遍历刻度标签并改变其旋转角度。我们还调整子图的起始位置，以腾出足够的空间放置图形标题。请注意，在这种情况下，我们需要使用
    `suptitle` 来添加标题，使用 `title` 只会将标题添加到子图中。
- en: There’s more...
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The land temperature data is not quite normally distributed, as the histograms
    and the skew and kurtosis measures in *Steps 3-5* show. It is skewed to the left
    (skew of `-0.39`) and has tails that are close to normal (kurtosis of 2.79, compared
    with 3). Although there are some extreme values, there are not that many of them
    relative to the overall size of the dataset. While it is not perfectly bell-shaped,
    the land temperature DataFrame is a fair bit easier to deal with than the COVID-19
    case data.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 陆地温度数据并不是完全正态分布的，正如*步骤3-5*中的直方图以及偏度和峰度测量所显示的那样。它偏向左侧（偏度为 `-0.39`），且尾部接近正态分布（峰度为2.79，接近3）。虽然存在一些极端值，但与数据集的整体规模相比，它们并不多。虽然数据分布不是完美的钟形曲线，但陆地温度数据框比
    COVID-19 病例数据要容易处理得多。
- en: The skew and kurtosis of the COVID-19 `cases per million` variable show that
    it is some distance from normal. The skew of 0.83 and kurtosis of -0.43 indicate
    a somewhat positive skew and much skinnier tails than with a normal distribution.
    This is also reflected in the histograms, even when we look at the numbers by
    region. There are a number of countries at very low levels of cases per million
    in most regions, and just a few countries with high levels of cases. The *Using
    grouped boxplots to uncover unexpected values in a particular group* recipe in
    this chapter shows that there are outliers in almost every region.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: COVID-19 的 `每百万病例` 变量的偏度和峰度显示它与正态分布相距较远。偏度为 0.83，峰度为 -0.43，表明该分布具有一定的正偏态，并且尾部比正态分布更窄。这在直方图中也得到了体现，即使我们按地区查看数据。大多数地区有许多国家的每百万病例数非常低，只有少数几个国家病例数很高。本章中的*使用分组箱型图揭示某一特定组中的异常值*示例显示几乎每个地区都有异常值。
- en: 'If you work through all of the recipes in this chapter, and you are relatively
    new to Matplotlib and Seaborn, you will find those libraries either usefully flexible
    or confusingly flexible. It is difficult to even pick one strategy and stick with
    it because you might need to set up your figure and axes in a particular way to
    get the visualization you want. It is helpful to keep two things in mind when
    working through these recipes: first, you will generally need to create a figure
    and one or more subplots; and second, the main plotting functions work similarly
    regardless, so `plt.hist` and `ax.hist` will both often work.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你完成了本章中的所有示例，并且你对 Matplotlib 和 Seaborn 相对较为陌生，你会发现这两个库要么是灵活实用，要么是灵活得让人困惑。甚至很难选择一种策略并坚持下去，因为你可能需要以某种特定的方式设置图形和坐标轴才能获得你想要的可视化效果。在处理这些示例时，记住两件事是很有帮助的：第一，通常你需要创建一个图形和一个或多个子图；第二，主要的绘图函数通常是类似的，因此
    `plt.hist` 和 `ax.hist` 都能经常奏效。
- en: Using boxplots to identify outliers for continuous variables
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用箱型图识别连续变量的异常值
- en: Boxplots are essentially a graphical representation of our work in the *Identifying
    outliers with one variable* recipe in *Chapter 4*, *Identifying Outliers in Subsets
    of Data*. There, we used the concept of **interquartile range** (**IQR**)—the
    distance between the value at the first quartile and the value at the third quartile—to
    determine outliers. Any value greater than (`1.5 * IQR`) + the third quartile
    value, or less than the first quartile value – (`1.5 * IQR`), was considered an
    outlier. That is precisely what is revealed in a boxplot.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 箱型图本质上是我们在*第4章：使用单个变量识别异常值*中所做工作的图形表示，在这一章中我们使用了**四分位距**（**IQR**）的概念——即第一个四分位数和第三个四分位数之间的距离——来确定异常值。任何大于（`1.5
    * IQR`）+ 第三个四分位数的值，或小于第一个四分位数 - (`1.5 * IQR`) 的值，都被认为是异常值。箱型图正是揭示了这一点。
- en: Getting ready
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will work with cumulative data on COVID-19 cases and deaths by country, and
    the **National Longitudinal Surveys** (**NLS**) data. You will need the Matplotlib
    library to run the code on your computer.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用关于COVID-19病例和死亡数据的累计数据，以及**国家纵向调查**（**NLS**）数据。你需要安装Matplotlib库，以便在你的计算机上运行代码。
- en: How to do it…
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'We use boxplots to show the shape and spread of **Scholastic Assessment Test**
    (**SAT**) scores, weeks worked, and COVID-19 cases and deaths:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用箱线图来展示**学术能力评估测试**（**SAT**）分数、工作周数以及COVID-19病例和死亡数的形状和分布：
- en: Load the `pandas` and `matplotlib` libraries.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载`pandas`和`matplotlib`库。
- en: 'Also, load the NLS and COVID-19 data:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，加载NLS和COVID-19数据：
- en: '[PRE17]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Do a boxplot of SAT verbal scores.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制SAT语言成绩的箱线图。
- en: 'Produce some descriptives first. The `boxplot` method produces a rectangle
    that represents the IQR, the values between the first and third quartile. The
    whiskers go from that rectangle to 1.5 times the IQR. Any values above or below
    the whiskers (what we have labeled the outlier threshold) are considered outliers
    (we use `annotate` to point to the first and third quartile points, the median,
    and to the outlier thresholds):'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 首先生成一些描述性统计。`boxplot`方法生成一个矩形，表示四分位数间距（IQR），即第一和第三四分位数之间的值。须根从该矩形延伸到1.5倍的IQR。任何超过须根范围的值（我们标记为异常值阈值）都被视为异常值（我们使用`annotate`标记第一和第三四分位点、中位数以及异常值阈值）：
- en: '[PRE18]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'This results in the following boxplot:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 这将生成以下箱线图：
- en: '![](img/B18596_05_05.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_05.png)'
- en: 'Figure 5.5: Boxplot of SAT verbal scores with labels for interquartile range
    and outliers'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.5：带有四分位数范围和异常值标签的SAT语言成绩箱线图
- en: 'Next, show some descriptives on weeks worked:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，显示一些关于工作周数的描述性统计：
- en: '[PRE21]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[PRE22]'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Do boxplots of weeks worked:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制工作周数的箱线图：
- en: '[PRE23]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'This results in the following boxplots:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 这将生成以下箱线图：
- en: '![](img/B18596_05_06.png)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_06.png)'
- en: 'Figure 5.6: Boxplots of two variables side by side'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.6：并排显示的两个变量的箱线图
- en: Show some descriptives for the COVID-19 data.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示COVID-19数据的一些描述性统计。
- en: 'Create a list of labels (`totvarslabels`) for columns to use in a later step:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个标签列表（`totvarslabels`），供后续步骤使用：
- en: '[PRE24]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '[PRE25]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Do a boxplot of cases and deaths per million:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制每百万病例和死亡数的箱线图：
- en: '[PRE26]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'This results in the following boxplots:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 这将生成以下箱线图：
- en: '![](img/B18596_05_07.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_07.png)'
- en: 'Figure 5.7: Boxplots of two variables side by side'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.7：并排显示的两个变量的箱线图
- en: Show boxplots as separate subplots on one figure.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将箱线图作为单独的子图显示在一张图上。
- en: 'It is hard to view multiple boxplots on one figure when the variable values
    are very different, as is true for COVID-19 cases and deaths. Fortunately, Matplotlib
    allows us to create multiple subplots on each figure, each of which can use different
    *x* and *y* axes. We can also present the data in thousands to improve readability:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 当变量值差异很大时（例如COVID-19病例和死亡数），在一张图上查看多个箱线图会很困难。幸运的是，Matplotlib允许我们在每张图上创建多个子图，每个子图可以使用不同的*x*和*y*轴。我们还可以将数据以千为单位呈现，以提高可读性：
- en: '[PRE27]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'This results in the following boxplots:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这将生成以下箱线图：
- en: '![](img/B18596_05_08.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_08.png)'
- en: 'Figure 5.8: Boxplots with different y axes'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.8：具有不同y轴的箱线图
- en: Boxplots are a relatively straightforward but exceedingly useful way to view
    how variables are distributed. They make it easy to visualize spread, central
    tendency, and outliers, all in one graphic.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 箱线图是一种相对简单但极其有用的方式，用于查看变量的分布情况。它们使得在一个图形中同时可视化数据的分布、集中趋势和异常值变得非常容易。
- en: How it works...
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: It is fairly easy to create a boxplot with Matplotlib, as *Step 2* shows. Passing
    a series to pyplot is all that is required (we use the `plt` alias). We call pyplot’s
    `show` method to show the figure. This step also demonstrates how to use `annotate`
    to add text and symbols to your figure. We show multiple boxplots in *Step 4*
    by passing multiple series to pyplot.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Matplotlib创建箱线图相当简单，正如*步骤2*所示。只需将一个系列传递给pyplot（我们使用`plt`别名）即可。我们调用pyplot的`show`方法来显示图形。这一步也展示了如何使用`annotate`向图形添加文本和符号。我们在*步骤4*中通过将多个系列传递给pyplot来展示多个箱线图。
- en: It can be difficult to show multiple boxplots in a single figure when the scales
    are very different, as is the case with the COVID-19 outcome data (cases, deaths,
    cases per million, and deaths per million). *Step 7* shows one way to deal with
    that. We can create several subplots on one plot. We start by indicating that
    we want four subplots, in two columns and two rows. That is what we get with `plt.subplots(2,
    2)`, which returns both a figure and the four axes. We can then loop through the
    axes, calling `boxplot` on each one. Nifty!
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 当尺度差异很大时（例如COVID-19结果数据：病例数、死亡数、每百万病例数和每百万死亡数），在单一图形中显示多个箱形图可能会很困难。*步骤7*展示了处理这一问题的方法之一。我们可以在一张图上创建多个子图。首先，我们指定希望有四个子图，分布在两列两行。这就是`plt.subplots(2,
    2)`所得到的结果，它返回一个图形和四个坐标轴。然后，我们可以遍历这些坐标轴，在每个上调用`boxplot`。挺巧妙的！
- en: However, it is still hard to see the IQR for cases and deaths because of some
    of the extreme values. In the next recipe, we remove some of the extreme values
    to give us a better visualization of the remaining data.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，由于某些极端值的存在，仍然很难看到病例和死亡数的四分位距（IQR）。在下一个示例中，我们去除一些极端值，以便更好地可视化剩余数据。
- en: There’s more...
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: The boxplot of SAT verbal scores in *Step 2* suggests a relatively normal distribution.
    The median is close to the center of the IQR. This is not surprising given that
    the descriptives we ran show that the mean and median have the same value. There
    is, however, substantially more room for outliers at the lower end than at the
    upper end. (Indeed, the very low SAT verbal scores seem implausible and should
    be checked.)
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '*步骤2*中的SAT语文分数的箱形图表明该数据呈现相对正态分布。中位数接近IQR的中心位置。这并不令人惊讶，因为我们所做的描述性统计显示均值和中位数的值相同。然而，较低端的异常值空间远大于上端。（实际上，SAT语文分数非常低似乎不可信，应该进行检查。）'
- en: The boxplots of weeks worked in 2020 and 2021 in *Step 4* show variables that
    are distributed much differently than SAT scores. The medians are much higher
    than the mean. This suggests a negative skew. Also, notice that there are no whiskers
    or outliers at the upper end of the distribution for the 2020 value as the median
    is at, or near, the maximum.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '*步骤4*中的2020年和2021年工作的周数的箱形图显示了与SAT分数相比，变量分布差异非常大。中位数远高于均值，这表明存在负偏态。此外，注意到2020年值的分布上端没有胡须或异常值，因为中位数处于最大值附近或等于最大值。'
- en: See also
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Some of these boxplots suggest that the data we are examining is not normally
    distributed. The *Identifying outliers with one variable* recipe in *Chapter 4*
    covers some normal distribution tests. It also shows how to take a closer look
    at the values outside of the outlier thresholds: the circles in the boxplots.'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 一些箱形图表明我们正在检查的数据并非呈正态分布。*第4章*中的*识别异常值*示例涵盖了一些正态分布检验。它还展示了如何更仔细地查看超出异常值阈值的值：即箱形图中的圆点。
- en: Using grouped boxplots to uncover unexpected values in a particular group
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用分组箱形图发现特定组中的意外值
- en: We saw in the previous recipe that boxplots are a great tool for examining the
    distribution of continuous variables. They can also be useful when we want to
    see if those variables are distributed differently for parts of our dataset, such
    as salaries for different age groups, number of children by marital status, or
    litter sizes of different mammal species. Grouped boxplots are a handy and intuitive
    way to view differences in variable distribution by categories in our data.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我们看到箱形图是检查连续变量分布的一个很好的工具。当我们想查看不同部分的数据集是否具有不同的分布时，箱形图也很有用，例如不同年龄组的薪资、按婚姻状况划分的子女数量，或不同哺乳动物物种的胎儿大小。分组箱形图是通过类别查看变量分布差异的一个方便直观的方式。
- en: Getting ready
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will work with the NLS and the COVID-19 case data. You will need Matplotlib
    and Seaborn installed on your computer to run the code in this recipe.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用NLS和COVID-19病例数据。你需要在计算机上安装Matplotlib和Seaborn库，以便运行本示例中的代码。
- en: How to do it...
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We generate descriptive statistics of weeks worked by highest degree earned.
    We then use grouped boxplots to visualize the spread of the weeks worked distribution
    by degree, and of COVID-19 cases by region:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 我们生成了按最高学位获得情况分类的工作周数的描述性统计数据。然后，我们使用分组箱形图来可视化按学位类别划分的工作周数分布以及按地区划分的COVID-19病例分布。
- en: 'Import the `pandas`, `matplotlib`, and `seaborn` libraries:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入`pandas`、`matplotlib`和`seaborn`库：
- en: '[PRE28]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: View the median, and first and third quartile values for weeks worked for each
    degree attainment level.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看每个学位获得水平的工作周数的中位数以及第一和第三四分位数值。
- en: 'First, define a function that returns those values as a Series, then use `apply`
    to call it for each group:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，定义一个返回这些值的函数作为Series，然后使用`apply`对每个组调用该函数：
- en: '[PRE29]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '[PRE30]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Do a boxplot of weeks worked by highest degree earned.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制按最高学位划分的工作周数的箱线图。
- en: 'Use Seaborn for these boxplots. First, create a subplot and name it `myplt`.
    This makes it easier to access subplot attributes later. Use the `order` parameter
    of `boxplot` to order by highest degree earned. Notice that there are no outliers
    or whiskers at the lower end for individuals with no degree ever received. This
    is because the IQR for those individuals covers almost all of the range of values.
    The value at the 25^(th) percentile is 0:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Seaborn库绘制这些箱线图。首先，创建一个子图并命名为`myplt`。这使得稍后访问子图属性更加方便。使用`boxplot`的`order`参数按最高学位排序。注意，对于那些从未获得学位的人群，低端没有异常值或胡须，因为这些人群的IQR几乎覆盖了所有的值范围。25%分位数的值为0：
- en: '[PRE31]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'This results in the following boxplots:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下的箱线图：
- en: '![](img/B18596_05_09.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_09.png)'
- en: 'Figure 5.9: Boxplots of weeks worked with IQR and outliers by highest degree'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.9：按最高学位划分的工作周数的箱线图，包含IQR和异常值
- en: View the minimum, maximum, median, and first- and third-quartile values for
    total cases per million by region.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看按区域划分的每百万人病例的最小值、最大值、中位数，以及第一和第三四分位数值。
- en: 'Use the `gettots` function defined in *Step 2*:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 使用在*步骤 2*中定义的`gettots`函数：
- en: '[PRE32]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '[PRE33]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Do boxplots of cases per million by region.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制按区域划分的每百万人病例的箱线图。
- en: 'Flip the axes since there are a large number of regions. Also, do a swarm plot
    to give some sense of the number of countries by region. The swarm plot displays
    a dot for each country in each region. Some of the IQRs are hard to see because
    of the extreme values:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 由于区域数量较多，需要翻转坐标轴。同时，绘制一个蜂群图，以显示按区域划分的国家数量。蜂群图为每个区域中的每个国家显示一个点。由于极端值，某些IQR（四分位距）难以观察：
- en: '[PRE34]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'This results in the following boxplots:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下的箱线图：
- en: '![](img/B18596_05_10.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_10.png)'
- en: 'Figure 5.10: Boxplots and swarm plots of cases per million by region, with
    IQR and outliers'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.10：按区域划分的每百万人病例的箱线图和蜂群图，包含IQR和异常值
- en: 'Show the highest values for cases per million:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示每百万人病例的最高值：
- en: '[PRE35]'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '[PRE37]'
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '[PRE38]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Redo the boxplots without the extreme values:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新绘制不包含极端值的箱线图：
- en: '[PRE39]'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'This results in the following boxplots:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下的箱线图：
- en: '![](img/B18596_05_11.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_11.png)'
- en: 'Figure 5.11: Boxplots of cases per million by region without the extreme values'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.11：按区域划分的每百万人病例的箱线图（不包含极端值）
- en: These grouped boxplots reveal how much the distribution of cases, adjusted by
    population, varies by region.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 这些分组箱线图展示了按人口调整后的病例分布在各个区域之间的变化情况。
- en: How it works...
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: We use Seaborn for the figures we create in this recipe. We could have also
    used Matplotlib. Seaborn is actually built on top of Matplotlib, extending it
    in some areas, and making some things easier. It sometimes produces more aesthetically
    pleasing figures with the default settings than Matplotlib does.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本配方中使用Seaborn库来创建图形。我们也可以使用Matplotlib。实际上，Seaborn是基于Matplotlib构建的，扩展了Matplotlib的某些功能，并使一些操作变得更加简单。与Matplotlib的默认设置相比，它有时能生成更加美观的图形。
- en: 'It is a good idea to have some descriptives in front of us before creating
    figures with multiple boxplots. In *Step* *2*, we get the first and third quartile
    values, and the median, for each degree attainment level. We do this by first
    creating a function called `gettots`, which returns a series with those values.
    We apply `gettots` to each group in the DataFrame with the following statement:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建包含多个箱线图的图形之前，最好先准备一些描述性信息。在*步骤* *2*中，我们获取每个学位获得水平的第一个和第三个四分位数值，以及中位数。我们通过首先创建一个名为`gettots`的函数来实现，该函数返回一个包含这些值的序列。我们通过以下语句将`gettots`应用于数据框中的每个组：
- en: '[PRE40]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: The `groupby` method creates a DataFrame with grouping information, which is
    passed to the `apply` function. `gettots` then calculates summary values for each
    group. `unstack` reshapes the returned rows, from multiple rows per group (one
    for each summary statistic) to one row per group, with columns for each summary
    statistic.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '`groupby`方法创建一个包含分组信息的数据框，并将其传递给`apply`函数。然后，`gettots`为每个组计算汇总值。`unstack`方法将返回的行进行重塑，将每组中的多行（每个汇总统计量一行）转换为每组一行，并为每个汇总统计量创建列。'
- en: In *Step* *3*, we generate a boxplot for each degree attainment level. We do
    not normally need to name the subplot object we create when we use Seaborn’s `boxplot`
    method. We do so in this step, naming it `myplt`, so that we can easily change
    attributes—such as tick labels—later. We rotate the labels on the *x* axis using
    `set_xticklabels` so that the labels do not run into each other.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在*Step* *3*中，我们为每个学位层次生成一个箱线图。当我们使用Seaborn的`boxplot`方法时，通常不需要为创建的子图对象命名。但在这一步中，我们将其命名为`myplt`，以便稍后可以轻松更改属性，例如刻度标签。我们使用`set_xticklabels`旋转*x*轴上的标签，以避免它们重叠。
- en: We flip the axes for the boxplots in *Step 5* since there are more group levels
    (regions) than there are ticks for the continuous variable, cases per million.
    We do that by making `total_cases_pm` the value for the first argument, rather
    than the second. We also do a swarm plot to give some sense of the number of observations
    (countries) in each region.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在*Step 5*中，我们翻转箱线图的轴，因为区域的层级比连续变量每百万病例数的刻度多。为此，我们将`total_cases_pm`作为第一个参数的值，而不是第二个。我们还做了一个swarm
    plot，以便了解每个地区的观察数量（国家）。
- en: Extreme values can sometimes make it difficult to view a boxplot. Boxplots show
    both the outliers and the IQR, but the IQR rectangle will be so small that it
    is not viewable when outliers are several times the third or first quartile value.
    In *Step 7*, we remove all values of `total_cases_pm` greater than or equal to
    512,388\. This improves the presentation of some details on the visualization.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 极端值有时会使箱线图难以查看。箱线图显示异常值和四分位数间距（IQR），但当异常值是第三或第一四分位值的数倍时，IQR矩形将非常小而难以查看。在*Step
    7*中，我们删除所有大于或等于512,388的`total_cases_pm`值。这改善了可视化细节的呈现。
- en: There’s more…
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容…
- en: The boxplots of weeks worked by educational attainment in *Step* *3* reveal
    high variation in weeks worked, something that is not obvious in univariate analysis.
    The lower the educational attainment level, the greater the spread in weeks worked.
    There is substantial variability in weeks worked in 2021 for individuals with
    less than a high-school degree, and very little variability for individuals with
    college degrees.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在*Step* *3*中的教育程度的周工作箱线图显示了工作周数的高变异性，这在单变量分析中并不明显。教育程度越低，工作周数的波动就越大。2021年，持有高中以下学历的个体的工作周数存在相当大的变异性，而拥有大学学位的个体的变异性非常小。
- en: This is quite relevant, of course, to our understanding of what an outlier is
    in terms of weeks worked. For example, someone with a college degree who worked
    20 weeks is an outlier, but they would not be an outlier if they had less than
    a high-school diploma.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 这对于我们理解以工作周数衡量的异常值是非常相关的。例如，一个拥有大学学位的人工作了20周，算是一个异常值，但如果他们只有高中以下文凭，则不会被视为异常值。
- en: The *Cases Per Million* boxplots also invite us to think more flexibly about
    what an outlier is. For example, none of the outliers for cases per million in
    North Africa would be a high outlier for the dataset as a whole. The maximum value
    for North Africa is actually lower than the first quartile value for Western Europe.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '*每百万人口病例数*的箱线图也邀请我们更加灵活地思考什么是异常值。例如，在北非的每百万人口病例数的异常值在整个数据集中并不算是高异常值。北非的最大值实际上低于西欧的第一四分位数值。'
- en: One of the first things I notice when looking at a boxplot is where the median
    is in the IQR. When the median is not at all close to the center, I know I am
    not dealing with a normally distributed variable. It also gives me a good sense
    of the direction of the skew. If it is near the bottom of the IQR, meaning that
    the median is much closer to the first quartile than the third, then there is
    a positive skew. Compare the boxplot for Eastern Europe to that of Western Europe.
    A large number of low values and a few high values bring the median close to the
    first quartile value for Eastern Europe.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 当我看箱线图时，我首先注意到的是中位数在IQR中的位置。如果中位数与中心完全不接近，我知道我在处理的不是正态分布的变量。它还让我对偏斜的方向有了很好的感觉。如果它靠近IQR的底部，意味着中位数比第三四分位数接近第一四分位数，那么存在正偏斜。比较东欧和西欧的箱线图。大量低值和少量高值使东欧的中位数接近西欧的第一四分位数值。
- en: See also
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: We work much more with `groupby` in *Chapter 9*, *Fixing Messy Data When Aggregating*.
    We work more with `stack` and `unstack` in *Chapter 11*, *Tidying and Reshaping
    Data*.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第9章* *解决混乱数据聚合*中，我们更多地使用`groupby`。在*第11章* *整理和重塑数据*中，我们更多地使用`stack`和`unstack`。
- en: Examining both distribution shape and outliers with violin plots
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用小提琴图检查分布形状和异常值
- en: Violin plots combine histograms and boxplots in one plot. They show the IQR,
    median, and whiskers, as well as the frequency of observations at all ranges of
    values. It is hard to visualize how that is possible without seeing an actual
    violin plot. We generate a few violin plots on the same data we used for boxplots
    in the previous recipe, to make it easier to grasp how they work.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 小提琴图将直方图和箱线图结合在一张图中。它们显示了 IQR、中位数、须条，以及各个数值范围内观察值的频率。如果没有实际的小提琴图，很难想象这是如何做到的。我们使用与上一个食谱中箱线图相同的数据生成几个小提琴图，以便更容易理解它们的工作原理。
- en: Getting ready
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will work with the NLS data. You need Matplotlib and Seaborn installed on
    your computer to run the code in this recipe.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 NLS 数据。你需要在计算机上安装 Matplotlib 和 Seaborn 才能运行本食谱中的代码。
- en: How to do it…
  id: totrans-191
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'We do violin plots to view both the spread and shape of the distribution on
    the same graphic. We then do violin plots by groups:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用小提琴图来查看分布的范围和形态，并将它们显示在同一图表中。然后我们按组进行小提琴图绘制：
- en: 'Load `pandas`, `matplotlib`, and `seaborn`, and the NLS data:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载 `pandas`、`matplotlib` 和 `seaborn`，以及 NLS 数据：
- en: '[PRE41]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Do a violin plot of the SAT verbal score:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制 SAT verbal 分数的小提琴图：
- en: '[PRE42]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'This results in the following violin plot:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下小提琴图：
- en: '![](img/B18596_05_12.png)'
  id: totrans-198
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_12.png)'
- en: 'Figure 5.12: Violin plot of SAT verbal score with labels for IQR and outlier
    threshold'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.12：SAT verbal 分数的小提琴图，带有 IQR 和异常值阈值的标签
- en: 'Get some descriptives for weeks worked:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取工作周数的描述性统计：
- en: '[PRE43]'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '[PRE44]'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Show weeks worked for 2020 and 2021.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示 2020 年和 2021 年的工作周数。
- en: 'Use a more object-oriented approach to make it easier to access some axes’
    attributes. Notice that the `weeksworked` distributions are bimodal, with bulges
    near the top and the bottom of the distribution. Also, note the very different
    IQR for 2020 and 2021:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 使用更面向对象的方法，以便更容易访问某些轴的属性。请注意，`weeksworked` 分布是双峰的，分布的顶部和底部都有峰值。另外，注意 2020 年和
    2021 年的 IQR 非常不同：
- en: '[PRE45]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'This results in the following violin plots:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下小提琴图：
- en: '![](img/B18596_05_13.png)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_13.png)'
- en: 'Figure 5.13: Violin plots showing the spread and shape of the distribution
    for two variables side by side'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.13：显示两个变量分布范围和形态的小提琴图，按组并排展示
- en: Do a violin plot of wage income by gender and marital status.
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按性别和婚姻状况绘制工资收入的小提琴图。
- en: 'First, create a collapsed marital status column. Specify gender for the *x*
    axis, salary for the *y* axis, and a new collapsed marital status column for `hue`.
    The `hue` parameter is used for grouping, which will be added to any grouping
    already used for the *x* axis. We also indicate `scale="count"` to generate violin
    plots sized according to the number of observations in each category:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，创建一个合并的婚姻状况列。指定性别为 *x* 轴，工资为 *y* 轴，新的合并婚姻状况列为 `hue`。`hue` 参数用于分组，这将与 *x*
    轴已使用的任何分组一起添加。我们还指定 `scale="count"`，以便根据每个类别中的观察值数量生成大小不同的小提琴图：
- en: '[PRE46]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'This results in the following violin plots:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下小提琴图：
- en: '![](img/B18596_05_14.png)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_14.png)'
- en: 'Figure 5.14: Violin plots showing the spread and shape of the distribution
    across two different groups'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.14：显示两个不同组之间分布范围和形态的小提琴图
- en: 'Do violin plots of weeks worked by highest degree attained:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按最高学历绘制工作周数的小提琴图：
- en: '[PRE47]'
  id: totrans-216
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'This results in the following violin plots:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下小提琴图：
- en: '![](img/B18596_05_15.png)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_15.png)'
- en: 'Figure 5.15: Violin plots showing the spread and shape of the distribution
    by group'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.15：按组显示分布范围和形态的小提琴图
- en: These steps show just how much violin plots can tell us about how continuous
    variables in our DataFrame are distributed, and how that might vary by group.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 这些步骤展示了小提琴图如何告诉我们 DataFrame 中连续变量的分布情况，以及它们在不同组之间可能的变化。
- en: How it works…
  id: totrans-221
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: Similar to boxplots, violin plots show the median, the first and third quartiles,
    and the whiskers. They also show the relative frequency of variable values. (When
    the violin plot is displayed vertically, the relative frequency is the width at
    a given point.) The violin plot produced in *Step 2*, and the associated annotations,
    provide a good illustration. We can tell from the violin plot that the distribution
    of SAT verbal scores is not dramatically different from normal, other than the
    extreme values at the lower end. The greatest bulge (greatest width) is at the
    median, declining fairly symmetrically from there. The median is relatively equidistant
    from the first and third quartiles.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于箱型图，小提琴图显示了中位数、第一四分位数、第三四分位数和胡须。它们还显示了变量值的相对频率。（当小提琴图垂直显示时，相对频率就是某一点的宽度。）*第2步*中生成的小提琴图及其相关注释提供了一个很好的示例。从小提琴图中我们可以看出，SAT语文成绩的分布与正态分布没有显著差异，除了低端的极端值外。最大隆起（最大宽度）出现在中位数处，从那里对称地下降。中位数与第一和第三四分位数的距离大致相等。
- en: We can create a violin plot in Seaborn by passing one or more data Series to
    the `violinplot` method. We can also pass a whole DataFrame of one or more columns.
    We do that in *Step 4* because we want to plot more than one continuous variable.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过将一个或多个数据系列传递给`violinplot`方法来在Seaborn中创建小提琴图。我们也可以传递整个DataFrame中的一列或多列。在*第4步*中，我们这么做是因为我们希望绘制多个连续变量。
- en: 'We sometimes need to experiment with the legend a bit to get it to be both
    informative and unobtrusive. In *Step 5*, we used the following command to remove
    the legend title (since it is clear from the values), locate the legend in the
    best place on the figure, and make the box transparent (`framealpha=0`):'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 有时我们需要稍微调整图例，以使其既具有信息性，又不显得突兀。在*第5步*中，我们使用了以下命令来移除图例标题（因为从数值中已经很清楚），将图例放置在图形的最佳位置，并使框体透明（`framealpha=0`）：
- en: '[PRE48]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: There’s more…
  id: totrans-226
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: Once you get the hang of violin plots, you will appreciate the enormous amount
    of information they make available on one figure. We get a sense of the shape
    of the distribution, its central tendency, and its spread. We can also easily
    show that information for different subsets of our data.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你掌握了小提琴图，你就会欣赏到它在一张图上呈现的海量信息。我们可以了解分布的形状、中心趋势和分散程度。我们也可以轻松地展示不同数据子集的这些信息。
- en: The distribution of weeks worked in 2020 is different enough from weeks worked
    in 2021 to give the careful analyst pause. The IQR is quite different—31 for 2020
    (21 to 52) and 15 for 2021 (35 to 50). (The weeks worked in 2020 distribution
    was likely impacted by the pandemic.)
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 2020年工作周数的分布与2021年工作周数的分布差异足够大，以至于让细心的分析师停下来思考。2020年的四分位距（IQR）为31（从21到52），而2021年为15（从35到50）。（2020年的工作周数分布可能受到疫情的影响。）
- en: An unusual fact about the distribution of wage income is revealed when examining
    the violin plots produced in *Step 5*. There is a bunching-up of incomes at the
    top of the distribution for married males, and somewhat for married females. That
    is quite unusual for a wage income distribution. As it turns out, it looks like
    there is a ceiling on wage income of $380,288\. This is something that we definitely
    want to take into account in future analyses that include wage income.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 在检查*第5步*中生成的小提琴图时，揭示了一个关于工资收入分布的不寻常现象。已婚男性的收入在分布的顶部出现了集中现象，已婚女性也有类似的现象。这对于工资收入分布来说是相当不寻常的。事实证明，工资收入有一个上限为$380,288。这是我们在未来包括工资收入的分析中必须考虑的一个因素。
- en: The income distributions have a similar shape across gender and marital status,
    with bulges slightly below the median and extended positive tails. The IQRs have
    relatively similar lengths. However, the distribution for married males is noticeably
    higher (or to the right, depending on chosen orientation) than that for the other
    groups.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 不同性别和婚姻状况的收入分布形状相似，都在中位数下方略有隆起，并具有延伸的正尾。四分位距的长度相对相似。然而，已婚男性的分布明显高于（或在选择的方向上偏右）其他组。
- en: The violin plots of weeks worked by degree attained show very different distributions
    by group, as we also discovered in the boxplots of the same data in the previous
    recipe. What is more clear here, though, is the bimodal nature of the distribution
    at lower levels of education. There is a bunching at low levels of weeks worked
    for individuals without college degrees. Individuals without high-school diplomas
    were nearly as likely to work 5 or fewer weeks in 2021 as they were to work 50
    or more weeks.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 按学历划分的工作周数的提琴图显示出不同组别间的分布差异，正如我们在上一节的箱型图中发现的那样。更清晰的一点是，低学历人群的分布呈双峰态。在没有大学学位的人群中，工作周数较少的集中在低周数（例如工作5周或更少），而没有高中文凭的人群在2021年工作5周或更少的可能性几乎和工作50周或更多的可能性一样。
- en: We used Seaborn exclusively to produce violin plots in this recipe. Violin plots
    can also be produced with Matplotlib. However, the default graphics in Matplotlib
    for violin plots look very different from those for Seaborn.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们仅使用了Seaborn来生成提琴图。Matplotlib也可以生成提琴图，但Matplotlib中提琴图的默认图形与Seaborn的图形差别很大。
- en: See also
  id: totrans-233
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: It might be helpful to compare the violin plots in this recipe to histograms,
    boxplots, and grouped boxplots in the previous recipes in this chapter.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 将本节中本食谱的提琴图与本章前面的直方图、箱型图和分组箱型图进行比较可能会有所帮助。
- en: Using scatter plots to view bivariate relationships
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用散点图查看双变量关系
- en: My sense is that there are few plots that data analysts rely more on than scatter
    plots, with the possible exception of histograms. We are all very used to looking
    at relationships that can be illustrated in two dimensions. Scatter plots capture
    important real-world phenomena (the relationship between variables) and are quite
    intuitive for most people. This makes them a valuable addition to our visualization
    toolkit.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我的感觉是，数据分析师依赖的图表中，散点图是最常见的图表之一，可能只有直方图例外。我们都非常习惯查看可以在二维平面上展示的关系。散点图捕捉了重要的现实世界现象（变量之间的关系），并且对大多数人来说非常直观。这使得它们成为我们可视化工具箱中不可或缺的一部分。
- en: Getting ready
  id: totrans-237
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need Matplotlib and Seaborn for this recipe. We will be working with
    the `landtemps` dataset, which provides the average temperature in 2023 for 12,137
    weather stations across the world.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱需要`Matplotlib`和`Seaborn`。我们将使用`landtemps`数据集，它提供了2023年全球12,137个气象站的平均温度数据。
- en: How to do it...
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'We level up our scatter plot skills from the previous chapter and visualize
    more complicated relationships. We display the relationship between average temperature,
    latitude, and elevation by showing multiple scatter plots on one chart, creating
    3D scatter plots, and showing multiple regression lines:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一章提升了散点图技能，能够可视化更加复杂的关系。我们通过在一张图表中显示多个散点图、创建三维散点图以及显示多条回归线，来展示平均温度、纬度和海拔之间的关系：
- en: 'Load `pandas`, `numpy`, `matplotlib` and `seaborn`:'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载`pandas`、`numpy`、`matplotlib`和`seaborn`：
- en: '[PRE49]'
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Run a scatter plot of latitude (`latabs`) by average temperature:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行纬度（`latabs`）与平均温度的散点图：
- en: '[PRE50]'
  id: totrans-244
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'This results in the following scatter plot:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下散点图：
- en: '![](img/B18596_05_16.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_16.png)'
- en: 'Figure 5.16: Scatter plot of latitude by average temperature'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.16：按平均温度绘制的纬度散点图
- en: Show the high elevation points in red.
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用红色显示高海拔点。
- en: 'Create low and high elevation DataFrames. Notice that the high elevation points
    are generally lower (that is, cooler) on the figure at each latitude:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 创建低海拔和高海拔的数据框。请注意，在每个纬度下，高海拔点通常较低（即温度较低）：
- en: '[PRE51]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'This results in the following scatter plot:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下散点图：
- en: '![](img/B18596_05_17.png)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_17.png)'
- en: 'Figure 5.17: Scatter plot of latitude by average temperature and elevation'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.17：按平均温度和海拔绘制的纬度散点图
- en: View a three-dimensional plot of temperature, latitude, and elevation.
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看温度、纬度和海拔的三维图。
- en: 'It looks like there is a somewhat steeper decline in temperature, with increases
    in latitude for high-elevation stations:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来在高海拔站点的纬度增加下，温度的下降趋势较为陡峭：
- en: '[PRE52]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'This results in the following scatter plot:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下散点图：
- en: '![](img/B18596_05_18.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_18.png)'
- en: 'Figure 5.18: 3D scatter plot of latitude and elevation by average temperature'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.18：按平均温度绘制的纬度和海拔的三维散点图
- en: Show a regression line of latitude on temperature.
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示纬度与温度的回归线。
- en: 'Use `regplot` to get a regression line:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`regplot`获取回归线：
- en: '[PRE53]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'This results in the following scatter plot:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下散点图：
- en: '![](img/B18596_05_19.png)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_19.png)'
- en: 'Figure 5.19: Scatter plot of latitude by average temperature with regression
    line'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.19：纬度与平均温度的散点图，带有回归线
- en: Show separate regression lines for low- and high-elevation stations.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示低海拔和高海拔车站的回归线。
- en: 'We use `lmplot` this time instead of `regplot`. The two methods have similar
    functionality. Unsurprisingly, high-elevation stations appear to have both lower
    intercepts (where the line crosses the *y* axis) and steeper negative slopes:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 这次我们使用`lmplot`，而不是`regplot`。这两种方法有类似的功能。不出所料，高海拔车站的回归线看起来具有较低的截距（即线与*y*轴的交点）以及更陡峭的负斜率：
- en: '[PRE54]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'This results in the following scatter plot:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下的散点图：
- en: '![](img/B18596_05_20.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_20.png)'
- en: 'Figure 5.20: Scatter plot of latitude by temperature with separate regression
    lines for elevation'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.20：纬度与温度的散点图，带有不同海拔的回归线
- en: 'Show some stations above the low- and high-elevation regression lines. We can
    use the `high` and `low` DataFrames we created in *Step 3*:'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示一些位于低海拔和高海拔回归线上的车站。我们可以使用我们在*步骤 3*中创建的`high`和`low` DataFrame：
- en: '[PRE55]'
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: '[PRE56]'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: '[PRE57]'
  id: totrans-275
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '[PRE58]'
  id: totrans-276
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: Scatter plots are a great way to view the relationship between two variables.
    These steps also show how we can display that relationship for different subsets
    of our data.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图是查看两个变量之间关系的好方法。这些步骤还展示了我们如何为数据的不同子集显示这些关系。
- en: How it works…
  id: totrans-278
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: We can run a scatter plot by just providing column names for `x` and `y` and
    a DataFrame. Nothing more is required. We get the same access to the attributes
    of the figure and its axes as we get when we run histograms and boxplots—titles,
    axis labels, tick marks and labels, and so on. Note that to access attributes
    such as labels on an axis (rather than on the figure), we use `set_xlabels` or
    `set_ylabels`, not `xlabels` or `ylabels`.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只需提供`x`和`y`的列名以及一个 DataFrame，就可以运行一个散点图。无需其他更多的操作。我们可以访问与运行直方图和箱线图时相同的图形和坐标轴属性——标题、坐标轴标签、刻度线和标签等。请注意，为了访问像坐标轴标签（而不是图形上的标签）这样的属性，我们使用`set_xlabels`或`set_ylabels`，而不是`xlabels`或`ylabels`。
- en: 3D plots are a little more complicated. First we set the projection of our axes
    to `3d`—`plt.axes(projection='3d')`, as we did in *Step 4*. We can then use the
    `scatter3D` method for each subplot.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 3D 图稍微复杂一些。首先，我们将坐标轴的投影设置为`3d`——`plt.axes(projection='3d')`，就像我们在*步骤 4*中做的那样。然后我们可以为每个子图使用`scatter3D`方法。
- en: 'Since scatter plots are designed to illustrate the relationship between a regressor
    (the `x` variable) and a dependent variable, it is quite helpful to see a least-squares
    regression line on the scatter plot. Seaborn provides two methods for doing that:
    `regplot` and `lmplot`. I use `regplot` typically, since it is less resource-intensive.
    But sometimes, I need the features of `lmplot`. We use `lmplot` and its `hue`
    attribute in *Step 6* to generate separate regression lines for each elevation
    level.'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 由于散点图旨在说明回归变量（`x`变量）与因变量之间的关系，因此在散点图上看到最小二乘回归线是非常有帮助的。Seaborn 提供了两种方法来做到这一点：`regplot`和`lmplot`。我通常使用`regplot`，因为它资源消耗较少。但有时，我需要`lmplot`的特性。我们在*步骤
    6*中使用`lmplot`及其`hue`属性，为每个海拔水平生成单独的回归线。
- en: 'In *Step 7*, we view some of the outliers: those stations with temperatures
    much higher than the regression line for their group. We would want to investigate
    the data for the `LAJES_AB` station in Portugal and the `YEREVAN` station in Armenia
    (`(high.latabs>38) & (high.avgtemp>=18)`). The average temperatures are higher
    than would be predicted at the given latitude and elevation level.'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 7*中，我们查看一些异常值：那些温度明显高于其所属组的回归线的车站。我们想要调查葡萄牙的`LAJES_AB`车站和亚美尼亚的`YEREVAN`车站的数据（`(high.latabs>38)
    & (high.avgtemp>=18)`）。这些车站的平均温度高于根据给定纬度和海拔水平预测的温度。
- en: There’s more...
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: We see the expected relationship between latitude and average temperatures.
    Temperatures fall as latitude increases. But elevation is another important factor.
    Being able to visualize all three variables at once helps us identify outliers
    more easily. Of course, there are additional factors that matter for temperatures,
    such as warm ocean currents. That data is not in this dataset, unfortunately.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到了纬度与平均温度之间的预期关系。随着纬度的增加，温度下降。但是，海拔是另一个重要因素。能够同时可视化所有三个变量有助于我们更容易识别异常值。当然，温度的其他影响因素也很重要，比如暖流。遗憾的是，这些数据在当前的数据集中没有。
- en: Scatter plots are great for visualizing the relationship between two continuous
    variables. With some tweaking, Matplotlib’s and Seaborn’s scatter plot tools can
    also provide some sense of relationships between three variables—by adding a third
    dimension, via the creative use of colors (when the third dimension is categorical),
    or by changing the size of the dots (the *Using linear regression to identify
    data points with high influence* recipe in *Chapter 4*, *Identifying Outliers
    in Subsets of Data*, provides an example of that).
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图非常适合可视化两个连续变量之间的关系。通过一些调整，Matplotlib和Seaborn的散点图工具也可以通过增加第三维度（当第三维度为分类变量时，通过颜色的创意使用，或通过改变点的大小）来提供对三个变量之间关系的理解（*第4章*中*使用线性回归识别具有高影响力的数据点*的实例展示了这一点）。
- en: See also
  id: totrans-286
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: This is a chapter on visualization, and identifying unexpected values through
    visualizations. But these figures also scream out for the kind of multivariate
    analyses we did in *Chapter 4*, *Identifying Outliers in Subsets of Data*. In
    particular, linear regression analysis, and a close look at the residuals, would
    be useful for identifying outliers.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一本关于可视化的章节，着重于通过可视化识别意外值。但这些图形也迫切需要我们在*第4章*中进行的多变量分析，*在数据子集中的异常值识别*。特别是，线性回归分析和对残差的深入分析，对于识别异常值会很有帮助。
- en: Using line plots to examine trends in continuous variables
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用折线图检查连续变量的趋势
- en: A typical way to visualize values for a continuous variable over regular intervals
    of time is through a line plot, though sometimes bar charts are used for small
    numbers of intervals. We will use line plots in this recipe to display variable
    trends and examine sudden deviations in trends and differences in values over
    time by groups.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化连续变量在规律时间间隔内的值的典型方法是通过折线图，尽管有时对于较少的时间间隔，柱状图也可以使用。在本配方中，我们将使用折线图来展示变量趋势，并检查趋势的突变以及按组别的时间差异。
- en: Getting ready
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will work with daily COVID-19 case data in this recipe. In previous recipes,
    we have used totals by country. The daily data provides us with the number of
    new cases and new deaths each day by country, in addition to the same demographic
    variables we used in other recipes. You will need Matplotlib installed to run
    the code in this recipe.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 本配方将处理每日的COVID-19病例数据。在之前的配方中，我们使用了按国家统计的总数。每日数据提供了每个国家每日新增病例和新增死亡人数，以及我们在其他配方中使用的相同人口统计变量。你需要安装Matplotlib才能运行本配方中的代码。
- en: How to do it…
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'We use line plots to visualize trends in daily COVID-19 cases and deaths. We
    create line plots by region, and stacked plots to get a better sense of how much
    one country can drive the number of cases for a whole region:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用折线图来可视化每日COVID-19病例和死亡趋势。我们按地区创建折线图，并使用堆叠图来更好地理解一个国家如何影响整个地区的病例数量：
- en: 'Import `pandas`, `matplotlib`, and the `matplotlib.dates` and date-formatting
    utilities:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入`pandas`、`matplotlib`以及`matplotlib.dates`和日期格式化工具：
- en: '[PRE59]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'View a couple of rows of the COVID-19 daily data:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看几行COVID-19每日数据：
- en: '[PRE60]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: '[PRE61]'
  id: totrans-298
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Calculate new cases and deaths by day.
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按天计算新增病例和死亡人数。
- en: 'Select dates between July 1, 2023, and March 3, 2024, and then use `groupby`
    to summarize cases and deaths across all countries for each day:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 选择2023年7月1日到2024年3月3日之间的日期，然后使用`groupby`汇总每一天所有国家的病例和死亡数据：
- en: '[PRE62]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: '[PRE63]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: Show line plots for new cases and new deaths by day.
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按天显示新增病例和新增死亡的折线图。
- en: 'Show the cases and deaths on different subplots:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 在不同的子图中显示病例和死亡数据：
- en: '[PRE64]'
  id: totrans-305
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'This results in the following line plots:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下的折线图：
- en: '![](img/B18596_05_21.png)'
  id: totrans-307
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_21.png)'
- en: 'Figure 5.21: Daily trend lines of worldwide COVID-19 cases and deaths'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.21：全球COVID-19病例和死亡的每日趋势线
- en: 'Calculate new cases and deaths by day and region:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按天和地区计算新增病例和死亡人数：
- en: '[PRE65]'
  id: totrans-310
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: '[PRE66]'
  id: totrans-311
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: Show line plots of new cases by selected regions.
  id: totrans-312
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按选定地区显示新增病例的折线图。
- en: 'Loop through the regions in `showregions`. Do a line plot of the total `new_cases`
    by day for each region. Use the `gca` method to get the *x* axis and set the date
    format:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 遍历`showregions`中的各个地区。为每个地区绘制按天计算的`new_cases`总数的折线图。使用`gca`方法获取*x*轴并设置日期格式：
- en: '[PRE67]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'This results in the following line plots:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生以下的折线图：
- en: '![](img/B18596_05_22.png)Figure 5.22: Daily trend lines of COVID-19 cases by
    region'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B18596_05_22.png) 图 5.22：按地区显示的COVID-19每日趋势线'
- en: Use a stacked plot to examine the trend in a region more closely.
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用堆叠图来更仔细地检查一个地区的趋势。
- en: 'See if one country (Brazil) in South America is driving the trend line. Create
    a DataFrame (`sa`) for `new_cases` by day for South America. Add a Series for
    `new_cases` in Brazil to the `sa` DataFrame. Then, create a new Series in the
    `sa` DataFrame for South America cases minus Brazil cases (`sacasesnobr`):'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 查看南美洲是否是由一个国家（巴西）推动了趋势线。为南美洲按天创建一个`new_cases`的DataFrame（`sa`）。然后，将巴西的`new_cases`系列添加到`sa`
    DataFrame中。接着，在`sa` DataFrame中为南美洲的病例创建一个新的Series，去除巴西的病例（`sacasesnobr`）：
- en: '[PRE68]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'This results in the following stacked plot:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 这将生成以下堆叠图：
- en: '![](img/B18596_05_23.png)'
  id: totrans-321
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_23.png)'
- en: Figure 5.23 – Stacked daily trends of cases in Brazil and the rest of South
    America
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.23 – 巴西及南美洲其他地区每日病例的堆叠趋势
- en: These steps show how to use line plots to examine trends in a variable over
    time, and how to display trends for different groups on one figure.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 这些步骤展示了如何使用折线图查看变量随时间的变化趋势，并且如何在一张图上显示不同组的趋势。
- en: How it works...
  id: totrans-324
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: We need to do some manipulation of the daily COVID-19 data before we do the
    line charts. We use `groupby` in *Step 3* to summarize new cases and deaths over
    all countries for each day. We use `groupby` in *Step 5* to summarize cases and
    deaths for each region and day.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在绘制折线图之前，我们需要对每日COVID-19数据进行一些处理。在*步骤3*中，我们使用`groupby`来汇总每个国家每天的新病例和死亡病例。在*步骤5*中，我们使用`groupby`来汇总每个地区和每天的病例和死亡人数。
- en: In *Step* *4*, we set up our first subplot with `plt.subplot(2,1,1)`. That will
    give us a figure with two rows and one column. The `1` for the third argument
    indicates that this subplot will be the first, or top, subplot. We can pass a
    data Series for date and for the values for the *y* axis. So far, this is pretty
    much what we have done with the `hist`, `scatterplot`, `boxplot`, and `violinplot`
    methods. But since we are working with dates here, we take advantage of Matplotlib’s
    utilities for date formatting and indicate that we want only the month to show,
    with `xaxis.set_major_formatter(DateFormatter("%b"))`. Since we are working with
    subplots, we use `set_xlabel` rather than `xlabel` to indicate the label we want
    for the *x* axis.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤4*中，我们使用`plt.subplot(2,1,1)`设置了第一个子图。这将为我们提供一个包含两行一列的图形。第三个参数中的`1`表示这个子图将是第一个，也就是最上面的子图。我们可以传入一个日期数据序列以及*y*轴的数值。到目前为止，这与我们在使用`hist`、`scatterplot`、`boxplot`和`violinplot`方法时做的基本相同。但由于我们在处理日期数据，这里我们利用Matplotlib的日期格式化工具，并通过`xaxis.set_major_formatter(DateFormatter("%b"))`来设置只显示月份。由于我们在使用子图，我们使用`set_xlabel`而不是`xlabel`来指示我们想要的*X*轴标签。
- en: We show line plots for four selected regions in *Step 6*. We do this by calling
    `plot` for each region that we want plotted. We could have done it for all of
    the regions, but it would have been too difficult to view.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在*步骤6*中为四个选定的地区展示了折线图。我们通过对每个想要绘制的地区调用`plot`来实现这一点。我们本可以对所有地区进行绘制，但那样图形将过于复杂，难以查看。
- en: We have to do some additional manipulation in *Step 7* to pull the new Brazil
    cases out of the cases for South America. Once we do that, we can do a stacked
    plot with the South America cases (minus Brazil) and Brazil. This figure suggests
    that the trends in new cases in South America in 2023 were largely driven by trends
    in Brazil.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤7*中，我们需要做一些额外的处理，将巴西的新病例从南美洲的病例中分离出来。完成这一操作后，我们可以绘制一个堆叠图，将南美洲的病例（不包括巴西）和巴西的病例分别显示。这张图表明，2023年南美洲的新病例趋势主要受到巴西趋势的影响。
- en: There’s more…
  id: totrans-329
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容……
- en: The figure produced in *Step 6* reveals a couple of potential data issues. There
    is an unusual spike in April of 2023 in East Asia. It is important to examine
    these totals to check whether there is a data collection error.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: '*步骤6*中生成的图表揭示了一些潜在的数据问题。2023年4月，东亚地区出现了一个不寻常的峰值。检查这些总数是否存在数据收集错误非常重要。'
- en: It is difficult to miss how much the trends differ by region. There are substantive
    reasons for this, of course. The different lines reflect what we know to be reality
    about different rates of spread by country and region. However, it is worth exploring
    any significant change in the direction or slope of trend lines to make sure that
    we can confirm that the data is accurate.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 很难忽视不同地区趋势的差异。当然，这些差异背后有实际的原因。不同的曲线反映了我们所知道的不同国家和地区传播速度的现实情况。然而，值得探索趋势线方向或斜率的任何重大变化，以确保我们能确认数据的准确性。
- en: See also
  id: totrans-332
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: We cover `groupby` in more detail in *Chapter 9*, *Fixing Messy Data When Aggregating*.
    We go over merging data, as we did in *Step 7*, in *Chapter 10*, *Addressing Data
    Issues When Combining Data Frames*.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在*第9章*更详细地介绍`groupby`，在*第10章*像在*步骤7*中那样合并数据时，解决数据问题。
- en: Generating a heat map based on a correlation matrix
  id: totrans-334
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于相关矩阵生成热图
- en: The correlation between two variables is a measure of how much they move together.
    A correlation of 1 means that the two variables are perfectly positively correlated.
    As one variable increases in size, so does the other. A value of -1 means that
    they are perfectly negatively correlated. As one variable increases in size, the
    other decreases. Correlations of 1 or -1 only rarely happen, but correlations
    above 0.5 or below -0.5 might still be meaningful. There are several tests that
    can tell us whether the relationship is statistically significant (such as Pearson,
    Spearman, and Kendall). Since this is a chapter on visualizations, we will focus
    on viewing important correlations.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 两个变量之间的相关性是衡量它们一起移动程度的指标。相关系数为1意味着两个变量完全正相关。一个变量增大时，另一个也增大。值为-1意味着它们完全负相关。一个变量增大时，另一个减小。相关系数为1或-1很少发生，但大于0.5或小于-0.5的相关可能仍具有意义。有几种测试可以告诉我们这种关系是否具有统计学意义（如皮尔逊、斯皮尔曼和肯德尔）。因为这是关于可视化的章节，我们将专注于查看重要的相关性。
- en: Getting ready
  id: totrans-336
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need Matplotlib and Seaborn installed to run the code in this recipe.
    Both can be installed by using `pip`, with the `pip install matplotlib` and `pip
    install seaborn` commands.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此配方中的代码需要安装Matplotlib和Seaborn。两者都可以使用`pip`安装，命令为`pip install matplotlib`和`pip
    install seaborn`。
- en: How to do it…
  id: totrans-338
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'We first show part of a correlation matrix of the COVID-19 data, and scatter
    plots of some key relationships. We then show a heat map of the correlation matrix
    to visualize the correlations between all variables:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先展示COVID-19数据的部分相关矩阵，并展示一些关键关系的散点图。然后展示相关矩阵的热图，以可视化所有变量之间的相关性：
- en: 'Import `matplotlib` and `seaborn`, and load the COVID-19 totals data:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入`matplotlib`和`seaborn`，并加载COVID-19总数据：
- en: '[PRE69]'
  id: totrans-341
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Generate a correlation matrix.
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成相关矩阵。
- en: 'View part of the matrix:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 查看矩阵的一部分：
- en: '[PRE70]'
  id: totrans-344
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: '[PRE71]'
  id: totrans-345
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: Show scatter plots of median age and **gross domestic product** (**GDP**) per
    capita by cases per million.
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 显示中位年龄和国内生产总值（GDP）每人的散点图按百万人口病例。
- en: 'Indicate that we want the subplots to share *y*-axis values with `sharey=True`:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 指示我们希望子图共享*y*轴值，使用`sharey=True`：
- en: '[PRE72]'
  id: totrans-348
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'This results in the following scatter plots:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 这导致以下散点图：
- en: '![](img/B18596_05_24.png)'
  id: totrans-350
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_24.png)'
- en: 'Figure 5.24: Scatter plots of median age and GDP by cases per million side
    by side'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.24：中位年龄和GDP按百万人口病例并排的散点图
- en: 'Generate a heat map of the correlation matrix:'
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成相关矩阵的热图：
- en: '[PRE73]'
  id: totrans-353
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'This results in the following heat map:'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 这导致以下热图：
- en: '![](img/B18596_05_25.png)'
  id: totrans-355
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18596_05_25.png)'
- en: 'Figure 5.25: Heat map of COVID-19 data, with strongest correlations in red
    and peach'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.25：COVID-19数据的热图，最强相关性显示为红色和桃色
- en: Heat maps are a great way to visualize how all key variables in our DataFrame
    are correlated with one another.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 热图是可视化我们DataFrame中所有关键变量如何相互相关的好方法。
- en: How it works…
  id: totrans-358
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The `corr` method of a DataFrame generates correlation coefficients of all numeric
    variables by all other numeric variables. We display part of that matrix in *Step
    2*. In *Step 3*, we make scatter plots of median age by cases per million, and
    GDP per capita by cases per million. These plots give a sense of what it looks
    like when the correlation is 0.74 (median age and cases per million) and when
    it is 0.66 (GDP per capita and cases per million). Countries with higher median
    ages or higher GDP per capita tend to have higher cases per million of population.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: DataFrame的`corr`方法生成所有数值变量与其他数值变量的相关系数。我们在*步骤2*中显示了部分矩阵。在*步骤3*中，我们制作了中位年龄按百万人口病例和GDP每人按百万人口病例的散点图。这些图表显示了当相关系数为0.74时（中位年龄与百万人口病例）和当相关系数为0.66时（GDP每人与百万人口病例）。年龄较高或GDP较高的国家
    tend to have higher cases per million of population.
- en: The heat map provides a visualization of the correlation matrix we created in
    *Step 2*. All of the red squares are correlations of 1.0 (which is the correlation
    of the variable with itself). The peach rectangles indicate the substantially
    positive correlations, such as those between median age, GDP per capita, and human
    development index and cases per million. The dark rectangles indicate that the
    relationships are strongly negative, such as that between vaccinations per 100,000
    of the population and deaths per million.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 热图提供了我们在*步骤2*中创建的相关矩阵的可视化。所有红色方块表示相关系数为1.0（即变量与自身的相关性）。桃色矩形表示显著的正相关，如中位数年龄、人均GDP、人类发展指数和百万案例数之间的相关性。深色矩形表示强负相关关系，例如每十万人接种疫苗与每百万人死亡数之间的关系。
- en: There’s more…
  id: totrans-361
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: I find it helpful to always have a correlation matrix or heat map close by when
    I am doing exploratory analysis or statistical modeling. I understand the data
    much better when I am able to keep these bivariate relationships in mind.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行探索性分析或统计建模时，我发现随时拥有一个相关矩阵或热图非常有帮助。当我能够牢记这些双变量关系时，我能更好地理解数据。
- en: See also
  id: totrans-363
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: We go over tools for examining the relationship between two variables in more
    detail in the *Identifying outliers and unexpected values in bivariate relationships*
    recipe in *Chapter 4*, *Identifying Outliers in Subsets of Data*.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在*第4章*中更详细地讨论检查两个变量关系的工具，具体是*识别双变量关系中的异常值和意外值*这一部分，*在数据子集中的异常值识别*。
- en: Summary
  id: totrans-365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Histograms, boxplots, scatter plots, violin plots, line plots, and heat maps
    are all essential tools for understanding how variables are distributed. Scatter
    plots, violin plots, and heat maps can also help us better understand relationships
    between variables, whether they are continuous or categorical. We created visualizations
    with all of those tools in this chapter. In the next chapter, we will examine
    how to create new Series in pandas, or modify values in an existing Series.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图、箱线图、散点图、小提琴图、折线图和热图都是理解变量分布的基本工具。散点图、小提琴图和热图还可以帮助我们更好地理解变量之间的关系，无论它们是连续的还是分类的。在本章中，我们使用了所有这些工具来创建可视化。在下一章中，我们将探讨如何在
    pandas 中创建新的 Series，或修改现有 Series 中的值。
- en: Leave a review!
  id: totrans-367
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 留下评论！
- en: Enjoying this book? Help readers like you by leaving an Amazon review. Scan
    the QR code below to get a free eBook of your choice.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 喜欢这本书吗？通过在亚马逊上留下评论，帮助像你一样的读者。扫描下面的二维码，获取你选择的免费电子书。
- en: '![](img/Review_copy.png)'
  id: totrans-369
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Review_copy.png)'
