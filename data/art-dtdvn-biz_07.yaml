- en: '7'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '7'
- en: Predicting Customer Churn
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测客户流失
- en: The churn rate is a metric used to determine how many clients or staff leave
    a business in a certain time frame. It might also refer to the sum of money that
    was lost because of the departures. Changes in a company’s churn rate might offer
    insightful information about the firm. Understanding the amount or proportion
    of consumers who don’t buy more goods or services is possible through customer
    churn analysis.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 流失率是一个用来衡量在一定时间框架内有多少客户或员工离开公司的指标。它也可以指因客户流失而损失的资金总额。公司流失率的变化可能会提供关于公司有价值的信息。通过客户流失分析，可以了解不再购买更多商品或服务的消费者数量或比例。
- en: In this chapter, we will understand the concept of churn and why it is important
    in the context of business. We will then prepare the data for further analysis
    and create an analysis to determine the most important factors to take into account
    to understand the churn patterns. Finally, we will learn how to create machine
    learning models to predict customers that will churn.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将了解流失（churn）的概念以及它在商业中的重要性。接着，我们将准备数据进行进一步分析，并创建分析模型来确定理解流失模式时需要考虑的最重要因素。最后，我们将学习如何创建机器学习模型，以预测可能流失的客户。
- en: 'This chapter covers the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包含以下内容：
- en: Understanding customer churn
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解客户流失
- en: Exploring customer data
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索客户数据
- en: Exploring variable relationships
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索变量关系
- en: Predicting users who will churn
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测可能流失的用户
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'In order to be able to follow the steps in this chapter, you will need to meet
    the next requirements:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够按照本章中的步骤进行操作，您需要满足以下要求：
- en: A Jupyter Notebook instance running Python 3.7 and above. You can also use the
    Google Colab notebook to run the steps if you have a Google Drive account.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行Python 3.7及以上版本的Jupyter Notebook实例。如果你有Google Drive账户，也可以使用Google Colab笔记本来运行这些步骤。
- en: An understanding of basic math and statistical concepts.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解基础的数学和统计概念。
- en: Understanding customer churn
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解客户流失
- en: In business, the number of paying customers that fail to become repeat customers
    for a given product or service is known as customer churn, also known as customer
    attrition. Churn in this sense refers to a measurable rate of change that happens
    over a predetermined period of time.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在商业中，未能成为回头客的付费客户的数量被称为客户流失，也称为客户流失率。这里的流失是指在预定时间段内发生的可衡量的变化率。
- en: Analyzing the causes of churn, engaging with customers, educating them, knowing
    who is at risk, identifying your most valuable customers, offering incentives,
    selecting the correct audience to target, and providing better service are a few
    strategies to reduce customer turnover.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 分析流失的原因、与客户互动、教育客户、了解哪些客户处于风险中、识别最有价值的客户、提供激励措施、选择正确的目标受众以及提供更好的服务是减少客户流失的一些策略。
- en: 'It’s crucial to lower churn because it increases **Customer Acquisition Cost**
    (**CAC**) and lowers revenue. In actuality, maintaining and improving current
    client relationships is much less expensive than gaining new consumers. The more
    clients you lose, the more money you’ll need to spend on acquiring new ones in
    order to make up for the lost revenue. You can use the following formula to determine
    CAC: CAC is calculated by dividing the cost of sales and marketing by the number
    of new customers attracted. The proportion of consumers who come back to your
    firm is known as the retention rate.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 降低流失率至关重要，因为它会增加**客户获取成本**（**CAC**）并降低收入。实际上，维护和改善现有客户关系的成本远低于吸引新客户的成本。你失去的客户越多，你就需要花费更多的资金来吸引新客户，以弥补失去的收入。你可以使用以下公式来计算CAC：CAC通过将销售和营销成本除以新客户的数量来计算。客户回归率是指返回你公司并继续购买的消费者的比例。
- en: '![](img/Formula_07_001.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Formula_07_001.jpg)'
- en: This is different from the churn rate, which measures how many clients you’ve
    lost over time. By default, a business with a high churn rate will have a lower
    retention rate.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 这与流失率不同，后者衡量的是在一定时间内失去的客户数量。默认情况下，流失率高的公司会有较低的客户回归率。
- en: Now that we have an idea of the business value that we get by identifying the
    patterns that make our clients churn, in the next section, we will start to explore
    the data and its variables.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经大致了解了通过识别导致客户流失的模式所获得的商业价值，在接下来的部分中，我们将开始探索数据及其变量。
- en: Exploring customer data
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索客户数据
- en: Our goal is to create a model to estimate the likelihood of abandonment using
    data pertaining to Telecom customers. This is to answer the question of how likely
    it is that a consumer will discontinue utilizing the service.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标是创建一个模型，用于估算客户流失的可能性，数据来自电信客户。这是为了回答消费者停止使用该服务的可能性有多大这个问题。
- en: Initially, the data is subjected to exploratory analysis. Knowing the data types
    of each column is the first step in the process, after which any necessary adjustments
    to the variables are made.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 最初，数据会进行探索性分析。了解每一列的数据类型是过程中的第一步，之后将对变量进行必要的调整。
- en: To explore the data, we will plot the relationships between the churn variable
    and the other important factors that make up the dataset. Prior to suggesting
    a model, this work is carried out to get a preliminary understanding of the underlying
    relationships between the variables.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 为了探索数据，我们将绘制流失变量与其他构成数据集的重要因素之间的关系。在提出模型之前，进行这项工作是为了初步了解变量之间的潜在关系。
- en: A thorough approach is taken while performing descriptive statistics, which
    focus on client differences based on one or more attributes. The primary variable
    of interest, churn, is now the focus, and a new set of interesting graphs is produced
    for this reason.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行描述性统计时，采用了细致的方法，主要关注客户基于一项或多项属性的差异。现在，主要关注的变量是流失，因此为此生成了一组新的有趣图表。
- en: To examine the variables, we have to handle unstructured data and adjust data
    types; the first step is to explore the data. In essence, we will be learning
    about data distribution and arranging the data for the clustering analysis.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 为了检查变量，我们必须处理非结构化数据并调整数据类型；第一步是探索数据。本质上，我们将了解数据分布并为聚类分析整理数据。
- en: 'For the analysis we will use in the next example, the following Python modules
    were used:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的示例中，我们将使用以下Python模块：
- en: '**Pandas**: Python package for data analysis and data manipulation.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Pandas**：用于数据分析和数据操作的Python包。'
- en: '**NumPy**: This is a library that adds support for large, multi-dimensional
    arrays and matrices, along with an extensive collection of high-level mathematical
    functions to operate on these arrays.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NumPy**：这是一个为大型、多维数组和矩阵提供支持的库，还包含了广泛的高阶数学函数，用于处理这些数组。'
- en: '**statsmodels**: A Python package that provides a complement to SciPy for statistical
    computations, including descriptive statistics and estimation and inference for
    statistical models. It provides classes and functions for the estimation of many
    different statistical models.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**statsmodels**：一个Python包，它为统计计算提供了SciPy的补充，包括描述性统计和统计模型的估计与推断。它提供了用于估计多种统计模型的类和函数。'
- en: '**Seaborn, mpl_toolkits, and Matplotlib**: Python packages for effective data
    visualization.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Seaborn、mpl_toolkits和Matplotlib**：用于高效数据可视化的Python包。'
- en: 'We’ll now get started with the analysis as follows:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将按照以下步骤开始分析：
- en: 'The first step is in the following block of code, we will load all the required
    packages just mentioned, including the functions that we will be using, such as
    `LabelEncoder`, `StandardScaler`, and `KMeans`:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一部分的代码块中，我们将加载刚才提到的所有必需包，包括我们将要使用的函数，如`LabelEncoder`、`StandardScaler`和`KMeans`：
- en: '[PRE0]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '[PRE1]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[PRE3]'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'For readability purposes, we will limit the maximum rows to `20`, set the maximum
    columns to `50`, and show the floats with `2` digits of precision:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了提高可读性，我们将限制最大行数为`20`，将最大列数设置为`50`，并显示保留`2`位小数的浮动数据：
- en: '[PRE5]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '[PRE9]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This block of code will load the data and show the first rows of it:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码将加载数据并展示数据的前几行：
- en: '![Figure 7.1: Customer data ](img/B19026_07_1.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图7.1：客户数据](img/B19026_07_1.jpg)'
- en: 'Figure 7.1: Customer data'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1：客户数据
- en: 'Now, we can now look at the columns that the DataFrame has:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以查看DataFrame中的列：
- en: '[PRE11]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'In order to obtain information about the type of each column and the number
    of missing values, we can use the `info` method:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 为了获取每一列的类型和缺失值数量，我们可以使用`info`方法：
- en: '[PRE12]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![Figure 7.2: Pandas column data types ](img/B19026_07_2.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![图7.2：Pandas列数据类型](img/B19026_07_2.jpg)'
- en: 'Figure 7.2: Pandas column data types'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.2：Pandas列数据类型
- en: 'We can see that although we don’t have `null` values to impute, most of the
    variables are categorical – meaning that we need to cast them into `boolean` numerical
    columns before using machine learning models or clustering methods. The first
    step is converting `TotalCharges` into a numerical data type:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以看到，尽管我们没有`null`值需要填补，但大多数变量是分类变量——这意味着我们需要将它们转换为`boolean`数值列，才能使用机器学习模型或聚类方法。第一步是将`TotalCharges`转换为数值数据类型：
- en: '[PRE13]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The preceding code casts the variable to a numeric variable, coercing any errors
    instead of failing.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将变量转换为数值型变量，强制任何错误值，而不是失败。
- en: 'We can see the results of the transformation using `info` again:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过再次使用`info`方法查看转换结果：
- en: '[PRE14]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![Figure 7.3: Corrected data types ](img/B19026_07_3.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.3: 修正后的数据类型](img/B19026_07_3.jpg)'
- en: 'Figure 7.3: Corrected data types'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.3: 修正后的数据类型'
- en: The resulting transformation has been successful but has generated 10 `null`
    values that we can later drop.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 结果转换成功，但生成了10个`null`值，我们可以稍后删除这些值。
- en: 'Now, we will determine the total list of categorical columns that we need to
    cast to dummies for better analysis:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将确定需要转换为虚拟变量以便更好分析的所有分类列：
- en: '[PRE15]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'There are several columns that could be easily represented by ones and zeros
    given that there are `Yes` or `No` values; we will determine which of these variables
    has only these two options and then map these values to their numerical counterparts:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 有几列可以通过 1 和 0 来轻松表示，因为这些列的值是`Yes`或`No`；我们将确定哪些变量只有这两种选项，然后将这些值映射到它们的数值对应值：
- en: '[PRE17]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '[PRE21]'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[PRE22]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[PRE23]'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[PRE24]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '[PRE25]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The preceding code will generate a list of categorical `Yes`/`No` columns to
    which we can map the data into ones and zeros:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上述代码将生成一组`Yes`/`No`的分类列，我们可以将这些数据映射为1和0：
- en: '[PRE27]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '[PRE28]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '[PRE29]'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '[PRE30]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'We can now re-evaluate the results of these replacements:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以重新评估这些替换的结果：
- en: '[PRE31]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '![Figure 7.4: Column transformed into a normalized Boolean column ](img/B19026_07_4.jpg)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.4: 列转换为规范化布尔列](img/B19026_07_4.jpg)'
- en: 'Figure 7.4: Column transformed into a normalized Boolean column'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.4: 列转换为规范化布尔列'
- en: 'We can now look at the numerical variable distribution to get a better understanding
    of the data using the `describe` method:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以使用`describe`方法查看数值变量的分布，以更好地理解数据：
- en: '[PRE32]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![Figure 7.5: Statistical description of the data ](img/B19026_07_5.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.5: 数据的统计描述](img/B19026_07_5.jpg)'
- en: 'Figure 7.5: Statistical description of the data'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.5: 数据的统计描述'
- en: It is interesting to see that here, 27% of clients churn, which is a very large
    proportion. In other contexts, these values tend to be much lower, making the
    dataset highly imbalanced and imposing the need to adapt the analysis to handle
    these imbalances. Thankfully, this is not the case, as the number of occurrences
    of churn is representative enough. Nevertheless, an imbalanced dataset requires
    us to take into consideration that we need to inspect the metrics used to evaluate
    the model in more depth. If we would just look into the precision, in our case,
    a model that just outputs the most common variable (the customer doesn’t churn)
    will have an accuracy of 73%. That is why we need to add more performance metrics,
    precision, recall, and a combination of both, such as the F1 score, and especially
    look at the confusion matrix to find the proportion of correctly predicted cases
    for each type of class.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣的是，在这里，有27%的客户流失，这个比例非常大。在其他情况下，这些值往往会低得多，这使得数据集高度不平衡，并且需要调整分析方法以应对这些不平衡。幸运的是，这里并非如此，因为客户流失的发生频率足够具有代表性。然而，不平衡的数据集要求我们更深入地审视评估模型时使用的度量标准。如果我们仅仅关注准确率，在我们的案例中，模型如果只是输出最常见的变量（客户不流失），其准确率将是73%。这就是为什么我们需要添加更多的性能指标，比如精确率、召回率，以及两者的结合，如F1得分，特别是查看混淆矩阵，以找出每个类别正确预测案例的比例。
- en: 'We can now visualize the distribution of some of these categorical variables
    accounting for the cases in which the users have churn. We can do this using Seaborn''s
    `countplot`:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以可视化一些分类变量的分布，考虑到用户流失的情况。我们可以使用Seaborn的`countplot`来完成这个操作：
- en: '[PRE33]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '[PRE34]'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '[PRE35]'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '[PRE37]'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '[PRE38]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '[PRE39]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '![Figure 7.6: Customer internet contract versus churn ](img/B19026_07_6.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.6: 客户互联网合同与流失](img/B19026_07_6.jpg)'
- en: 'Figure 7.6: Customer internet contract versus churn'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.6: 客户互联网合同与流失'
- en: We can see that there is a big difference between the relative percentage of
    churn for the users that opted for the fiber optic service, compared to the ones
    who don’t have internet service or have DSL.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，选择光纤服务的用户与没有互联网服务或仅有DSL服务的用户在流失率上存在很大的差异。
- en: 'This information can be useful for diving into the reasons or developing new
    promotions to address this situation:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这些信息可以用于深入分析原因，或制定新的促销活动以应对这一情况：
- en: '[PRE40]'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: '[PRE41]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '[PRE42]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '[PRE43]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '[PRE44]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '![Figure 7.7: Customer phone contracts versus churn ](img/B19026_07_7.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.7: 客户电话合同与流失率](img/B19026_07_7.jpg)'
- en: 'Figure 7.7: Customer phone contracts versus churn'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.7: 客户电话合同与流失率'
- en: We can see some relative differences, again, for clients that have multiple
    lines, whereas the ones that don’t have multiple lines seem to churn more. These
    differences need to be validated with a t-test or other hypothesis testing methods
    to determine actual differences between the means of the groups.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，选择多个线路的客户与不选择多个线路的客户在流失率上存在一定差异。没有多个线路的客户似乎流失更多。这些差异需要通过t检验或其他假设检验方法来验证，以确定各组均值之间的实际差异。
- en: 'The next step is to visualize the relationship between the contract and churn:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是可视化合同与流失率之间的关系：
- en: '[PRE45]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '[PRE46]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '[PRE47]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '[PRE48]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '[PRE49]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'The code here will show us a bar plot of contract type method versus churn:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的代码将展示合同类型与流失率之间的条形图：
- en: '![Figure 7.8: Customer contract type versus churn ](img/B19026_07_8.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.8: 客户合同类型与流失率](img/B19026_07_8.jpg)'
- en: 'Figure 7.8: Customer contract type versus churn'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.8: 客户合同类型与流失率'
- en: Here, the client churn rate is extremely high for customers with month-to-month
    contracts relative to the ones that have 1- or 2-year contracts. This information
    can be used to create marketing strategies that seek to convert the month-to-month
    contracts into 1- or 2-year contracts.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，相比于拥有1年或2年合同的客户，按月合同的客户流失率极高。这些信息可以用来制定营销策略，尝试将按月合同转化为1年或2年的合同。
- en: 'Finally, our last variable exploration focuses on the type of payment method.
    The next plot will show us the relationship of churn to the type of payment used:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们对最后一个变量的探索聚焦于支付方式类型。下一个图表将展示流失率与使用的支付方式类型之间的关系：
- en: '[PRE50]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: '[PRE51]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: '[PRE52]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: '[PRE53]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '[PRE54]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'The code here will show us a bar plot of payment method versus churn:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的代码将展示支付方式与流失率之间的条形图：
- en: '![Figure 7.9: Customer payment method versus churn ](img/B19026_07_9.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.9: 客户支付方式与流失率](img/B19026_07_9.jpg)'
- en: 'Figure 7.9: Customer payment method versus churn'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.9: 客户支付方式与流失率'
- en: Here, the difference is clear between the ones using electronic checks rather
    than other kinds of payment methods.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，使用电子支票而非其他支付方式的客户之间的差异是显而易见的。
- en: Up next, we will explore the variable relationships between the different variables
    using Seaborn's `pairplot` and with the use of correlation analysis.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将使用Seaborn的`pairplot`以及相关分析来探索不同变量之间的关系。
- en: Exploring variable relationships
  id: totrans-131
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索变量关系
- en: 'Exploring the way in which variables move together can help us to determine
    the hidden patterns that govern the behaviors of our clients:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 探索变量如何共同变化可以帮助我们确定隐藏的模式，这些模式支配着客户的行为：
- en: 'Our first step here will be using the Seaborn method to plot some of the relationships,
    mostly between numerical continuous variables such as tenure, monthly charges,
    and total charges, using the churn as the `hue` parameter:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的第一步将使用Seaborn方法绘制一些关系图，主要是数值连续变量之间的关系，如服务年限、每月费用和总费用，使用流失率作为`hue`参数：
- en: '[PRE55]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: '![Figure 7.10: Continuous variable relationships ](img/B19026_07_10.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.10: 连续变量关系](img/B19026_07_10.jpg)'
- en: 'Figure 7.10: Continuous variable relationships'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '图 7.10: 连续变量关系'
- en: We can observe from the distributions that the customers who churn tend to have
    a low tenure number, generally having low amounts of monthly charges, as well
    as having much lower total charges on average.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 从分布情况来看，流失的客户通常具有较低的服务年限，通常每月费用较低，且总费用较低。
- en: 'Now, we can finally transform and determine the object columns that we will
    convert into dummies:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以最终转换并确定将要转化为虚拟变量的对象列：
- en: '[PRE56]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: '[PRE57]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Once these columns are determined, we can use the `get_dummies` function and
    create a new DataFrame only with numeric variables:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦确定了这些列，我们可以使用`get_dummies`函数，并创建一个仅包含数值型变量的新DataFrame：
- en: '[PRE58]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '[PRE59]'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: '[PRE60]'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'The preceding code will show us the data restructured:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将展示重新结构化后的数据：
- en: '![Figure 7.11: Restructured data ](img/B19026_07_11.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.11: 重新结构化的数据](img/B19026_07_11.jpg)'
- en: 'Figure 7.11: Restructured data'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.11：重构后的数据
- en: Here, the data can effectively describe each one of the customers’ descriptive
    levels so that the information is represented numerically rather than categorically.
    These factors consist of tenure, subscription type, cost, call history, and demographics,
    among other things. The fact that the dimensions need to be represented numerically
    is because most machine learning algorithms require the data to be this way.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，数据能够有效地描述每个客户的描述性水平，从而使信息以数值形式而非分类形式表示。这些因素包括任期、订阅类型、费用、通话历史和人口统计等。之所以需要以数值形式表示维度，是因为大多数机器学习算法要求数据以这种方式表示。
- en: 'As the next step, we will be studying the relationship of variables to determine
    the most important correlations between them:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步，我们将研究变量之间的关系，以确定它们之间最重要的相关性：
- en: '[PRE61]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: '[PRE62]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: '[PRE63]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: '[PRE64]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: '[PRE66]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '[PRE67]'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: The code determines these correlations and constructs a triangular dataset that
    we can plot as a heat map to clearly visualize the relationship between the variables.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 代码确定这些相关性并构建一个三角形数据集，我们可以将其绘制为热力图，以清晰地可视化变量之间的关系。
- en: '![Figure 7.12: Variable correlations ](img/B19026_07_12.jpg)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.12：变量相关性](img/B19026_07_12.jpg)'
- en: 'Figure 7.12: Variable correlations'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.12：变量相关性
- en: Here, we can visualize the entire set of variable correlations, but we may just
    look at the ones that are related to our target variable. We can see that some
    variables that depend on others will have a correlation of 1 to this variable
    – for example, in the case of `internet contract = no`, which has a correlation
    equal to 1 with `streaming service = no`. This is because if there is no internet
    contract, it is obvious that you won’t be able to access a streaming service that
    requires an internet contract.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以可视化整个变量相关性的集合，但我们可能只关注与目标变量相关的部分。我们可以看到，一些依赖其他变量的变量与此变量的相关性为1——例如，在`internet
    contract = no`的情况下，它与`streaming service = no`的相关性为1。这是因为如果没有互联网合同，很明显就无法使用需要互联网合同的流媒体服务。
- en: 'We can do this just by looking at the correlations related to this variable:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过查看与此变量相关的相关性来实现这一点：
- en: '[PRE68]'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '[PRE69]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: '![Figure 7.13: Most important correlations to churn ](img/B19026_07_13.jpg)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.13：与流失最相关的变量](img/B19026_07_13.jpg)'
- en: 'Figure 7.13: Most important correlations to churn'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.13：与流失最相关的变量
- en: This information is really useful, as it not only determines the variables associated
    with a higher degree of churn but also the ones that lead to a lower churn rate,
    such as the tenure time and having a 2-year contract. It would be a good practice
    to remove the churn variable here as the correlation of the variable with itself
    is 1 and distorts the graphic.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 这些信息非常有用，因为它不仅确定了与较高流失率相关的变量，还指出了能够降低流失率的变量，例如任期时间和拥有2年合同。建议在这里删除流失变量，因为该变量与自身的相关性为1，且会扭曲图形。
- en: After going through this EDA, we will develop some predictive models and compare
    them.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这一步EDA后，我们将开发一些预测模型并进行比较。
- en: Predicting users who will churn
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测将流失的用户
- en: 'In this example, we will train logistic regression, random forest, and SVM
    machine learning models to predict the users that will churn based on the observed
    variables. We will need to scale the variables first and we will use the sklearn
    `MinMaxScaler` functionality to do so:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将训练逻辑回归、随机森林和支持向量机（SVM）机器学习模型，预测基于观察到的变量将会流失的用户。我们需要首先对变量进行缩放，使用sklearn的`MinMaxScaler`功能来实现：
- en: 'We will start with logistic regression and scale all the variables to a range
    of 0 to 1:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将从逻辑回归开始，并将所有变量缩放到0到1的范围内：
- en: '[PRE70]'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: '[PRE71]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: '[PRE72]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: '[PRE73]'
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: '[PRE74]'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: '[PRE75]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: '[PRE76]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: The preceding code will create the `x` and `y` variables, out of which we only
    need to scale `x`.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的代码将创建`x`和`y`变量，其中我们只需要对`x`进行缩放。
- en: '![Figure 7.14: Model input features ](img/B19026_07_14.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.14：模型输入特征](img/B19026_07_14.jpg)'
- en: 'Figure 7.14: Model input features'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.14：模型输入特征
- en: It is important to scale the variables in logistic regression so that all of
    them are within a range of 0 to 1.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在逻辑回归中，缩放变量非常重要，以确保所有变量都在0到1的范围内。
- en: 'Next, we can train the logistic regression model by splitting the data to get
    a validation set first:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以通过分割数据来训练逻辑回归模型，首先获得一个验证集：
- en: '[PRE77]'
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '[PRE78]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: '[PRE79]'
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: '[PRE80]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: '[PRE81]'
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: '[PRE82]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: '[PRE83]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: '[PRE84]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Finally, we can print the prediction accuracy:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以打印出预测准确性：
- en: '[PRE85]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: '![Figure7.15: Logistic regression model accuracy ](img/B19026_07_15.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.15：逻辑回归模型准确性](img/B19026_07_15.jpg)'
- en: 'Figure7.15: Logistic regression model accuracy'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.15：逻辑回归模型准确性
- en: We have obtained good accuracy in the model.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在模型中获得了不错的准确性。
- en: 'We can also get the weights of all the variables to weigh their importance
    in the predictive model:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们还可以获得所有变量的权重，以衡量它们在预测模型中的重要性：
- en: '[PRE86]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE86]'
- en: '[PRE87]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE87]'
- en: The preceding code will create a data frame of the weights of the 10 most positive
    and 10 most negative weighted variables.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将创建一个数据框，显示 10 个权重最正向和 10 个权重最负向的变量。
- en: '![Figure 7.16: Model feature importance ](img/B19026_07_16.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.16：模型特征重要性](img/B19026_07_16.jpg)'
- en: 'Figure 7.16: Model feature importance'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.16：模型特征重要性
- en: It is interesting to see how the total charges and the tenure, especially the
    latter, have great importance in the regression. The importance of these variables
    is also validated by looking at the variable correlation. An important next step
    would be to do a deeper analysis of the relationship of this variable to the churn
    variable to understand the mechanism behind this relationship.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣的是，看到总费用和服务年限，尤其是后者，在回归模型中的重要性。通过查看变量之间的相关性，这些变量的重要性得到了验证。一个重要的下一步将是深入分析这些变量与流失变量之间的关系，以理解这种关系背后的机制。
- en: 'We can create the confusion matrix to visualize the performance of predicting
    each class:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以创建混淆矩阵，以可视化每个类别预测的性能：
- en: '[PRE88]'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE88]'
- en: '[PRE89]'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE89]'
- en: '![Figure 7.17: Model confusion matrix ](img/B19026_07_17.jpg)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.17：模型混淆矩阵](img/B19026_07_17.jpg)'
- en: 'Figure 7.17: Model confusion matrix'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.17：模型混淆矩阵
- en: In the confusion matrix, the information shown in the columns are the distinct
    classes (no churn and churn) and in the rows are the predicted outcomes in the
    same order (no churn, churn). The values in the diagonal represent the true positives,
    predicted to be a class that it in fact was. The values that are outside the diagonal
    are the values predicted wrong. In our case, we correctly classified `1401` cases
    of no churn, mislabeled `265` no churn as churn, predicted `145` cases to churn
    when in fact they didn’t, and correctly classified `302` cases of churn. We can
    see from the confusion matrix that the model is good at predicting the most common
    cases, which is that there is no churn, but it got almost a third of the classes
    wrong, which is important for us to predict.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在混淆矩阵中，列中显示的是不同的类别（无流失和流失），而行中则是按相同顺序预测的结果（无流失，流失）。对角线上的值表示真正的正例，预测为该类别且实际也是该类别。对角线外的值则表示预测错误的值。在我们的案例中，我们正确分类了
    `1401` 个无流失的案例，错误地将 `265` 个无流失分类为流失，将 `145` 个流失预测为无流失，正确分类了 `302` 个流失的案例。从混淆矩阵中可以看出，模型在预测最常见的情况（即无流失）方面表现良好，但几乎三分之一的类别预测错误，这对我们预测非常重要。
- en: Our next step is to create a classification system made up of several decision
    trees called a random forest. It attempts to produce an uncorrelated forest of
    decision trees, which is more accurate than a single individual tree, using bagging
    and feature randomness when generating each individual tree.
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们的下一步是创建一个由多个决策树组成的分类系统，称为随机森林。它通过使用自助法（bagging）和特征随机性在生成每个单独的树时，尝试产生一个相互独立的决策树森林，这比单棵树更准确。
- en: 'In the next code, we will use the `RandomForestClassifier` class from sklearn
    and train it on the data:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的代码中，我们将使用来自 sklearn 的 `RandomForestClassifier` 类，并在数据上进行训练：
- en: '[PRE90]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'Finally, we have trained the model and we can make predictions:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们训练了模型，并可以进行预测：
- en: '[PRE91]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE91]'
- en: '[PRE92]'
  id: totrans-214
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE92]'
- en: '![Figure 7.18: Random forest model accuracy ](img/B19026_07_18.jpg)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.18：随机森林模型准确度](img/B19026_07_18.jpg)'
- en: 'Figure 7.18: Random forest model accuracy'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.18：随机森林模型准确度
- en: We have obtained an accuracy very similar to the regression model.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了一个与回归模型非常相似的准确度。
- en: 'Let’s see the variable importance of the model as the next step:'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们来看一下模型的变量重要性，作为下一步：
- en: '[PRE93]'
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE93]'
- en: '[PRE94]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE94]'
- en: '[PRE95]'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE95]'
- en: The preceding code will show us the 10 most positive and 10 most negative weights
    of the model.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码将显示模型中 10 个最正向和 10 个最负向的权重。
- en: '![Figure 7.19: Model feature importance ](img/B19026_07_19.jpg)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.19：模型特征重要性](img/B19026_07_19.jpg)'
- en: 'Figure 7.19: Model feature importance'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.19：模型特征重要性
- en: 'This model has a different ranking, having, in the extremes, the month-to-month
    contract and the 2-year contract:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 这个模型有不同的排序，在极端情况下，月度合同和 2 年合同排在前列：
- en: '[PRE96]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: '![Figure 7.20: Model confusion matrix ](img/B19026_07_20.jpg)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.20：模型混淆矩阵](img/B19026_07_20.jpg)'
- en: 'Figure 7.20: Model confusion matrix'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.20：模型混淆矩阵
- en: This model predicts our target variable better, which makes it suitable for
    our needs.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 该模型更好地预测了我们的目标变量，这使得它更适合我们的需求。
- en: 'Next, we will train a supervised machine learning technique known as a **Support
    Vector Classifier** (**SVC**), which is frequently used for classification problems.
    An SVC separates the data into two classes by mapping the data points to a high-dimensional
    space and then locating the best hyperplane:'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将训练一种监督式机器学习技术，称为**支持向量分类器**（**SVC**），它常用于分类问题。SVC通过将数据点映射到高维空间，然后定位最佳超平面，将数据分为两类：
- en: '[PRE97]'
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE97]'
- en: '[PRE98]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE98]'
- en: '[PRE99]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE99]'
- en: '[PRE100]'
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE100]'
- en: '[PRE101]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE101]'
- en: The code here will fit the model to the data and print the accuracy score.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的代码将模型拟合到数据中，并打印出准确率得分。
- en: '![Figure 7.21: Model accuracy score ](img/B19026_07_21.jpg)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.21：模型准确率得分](img/B19026_07_21.jpg)'
- en: 'Figure 7.21: Model accuracy score'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.21：模型准确率得分
- en: 'The accuracy score is still in the same range as the other models, so let’s
    look at the absolute weight importance of the model:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准确率得分仍然在其他模型的相同范围内，因此让我们来看看模型的绝对权重重要性：
- en: '[PRE102]'
  id: totrans-240
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE102]'
- en: The code here will prompt the 10 most important variables for the model.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的代码将提示模型的10个最重要的变量。
- en: '![Figure 7.22: Model feature importance ](img/B19026_07_22.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.22：模型特征重要性](img/B19026_07_22.jpg)'
- en: 'Figure 7.22: Model feature importance'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.22：模型特征重要性
- en: We can see that tenure and total charges are variables of importance for the
    model, which is something that we saw in the other models as well. The drawback
    of this kind of visualization is that we cannot see the orientation of this importance.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，任期和总费用是模型中重要的变量，这也是我们在其他模型中看到的。这种可视化的缺点是我们无法看到这些重要性的方向性。
- en: 'Let’s look at the performance of predicting our target variable:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们看看预测目标变量的表现：
- en: '[PRE103]'
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE103]'
- en: The next step is the confusion matrix, which will allow us to determine with
    more certainty which labels we are correctly predicting.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是混淆矩阵，这将帮助我们更准确地确定哪些标签我们正确地预测了。
- en: '![Figure 7.23: Model confusion matrix ](img/B19026_07_23.jpg)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
  zh: '![图 7.23：模型混淆矩阵](img/B19026_07_23.jpg)'
- en: 'Figure 7.23: Model confusion matrix'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.23：模型混淆矩阵
- en: The model is less accurate than the random forest for predicting whether the
    clients will churn or not.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 该模型在预测客户是否流失方面的准确性低于随机森林。
- en: It is always good to combine the various perspectives of the confusion matrix,
    as the accuracy will not work as a performance metric alone if the set is imbalanced.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 将混淆矩阵的不同视角结合起来总是很有帮助的，因为如果数据集不平衡，仅凭准确率无法作为性能度量。
- en: Summary
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: 'In this chapter, we analyzed a very common business case: customer churn. Understanding
    the causes of this, as well as being able to take preventive actions to avoid
    this, can create a lot of revenue for a company.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们分析了一个非常常见的商业案例：客户流失。理解其原因，以及能够采取预防措施避免流失，可以为公司创造大量收入。
- en: In the example that we have analyzed, we have seen how to clean the variables
    in a dataset to properly represent them and prepare them for machine learning.
    Visualizing the variables in a relationship against the target variable that we
    are analyzing allows us to understand the problem better. Finally, we trained
    several machine learning models that we later analyzed to understand how their
    performances were when predicting the target variable.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们分析的示例中，我们看到了如何清洗数据集中的变量，正确表示它们并为机器学习做准备。将变量与我们分析的目标变量进行关系可视化，有助于我们更好地理解问题。最后，我们训练了几个机器学习模型，随后分析了它们在预测目标变量时的表现。
- en: In the next chapter, we will focus more of our attention on understanding how
    variables affect segments and group users with homogenous characteristics to understand
    them better.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将更加关注如何理解变量如何影响数据段，并将具有相似特征的用户分组，以便更好地理解他们。
