# 前言

|   | *“巴贝奇先生，如果你把错误的数字输入到机器里，正确的答案会出来吗？”* |   |
| --- | --- | --- |
|   | --*查尔斯·巴贝奇（1864）* |
|   | *“垃圾进，垃圾出”* |   |
|   | --*美国国税局（1963）* |
|   | *“没有干净的数据集。”* |   |
|   | --*乔什·沙利文，Booz Allen 副总裁，《财富》杂志（2015）* |

在他 1864 年的随笔集中，计算机发明者查尔斯·巴贝奇回忆起当时对“思想混乱”的困惑：有人竟然认为，尽管输入了错误的数据，计算机仍然能够算出正确的答案。再快进 100 年，税务局开始耐心解释“垃圾进，垃圾出”，以表达即使是强大的税务机构，计算机处理仍然依赖于输入数据的质量。再过 50 年，进入 2015 年：看似神奇的机器学习、自动校正、预测性界面和推荐系统的时代，它们比我更了解我自己。然而，这些有用的算法仍然需要高质量的数据才能正确地学习，而我们却感叹“没有干净的数据集”。

本书适合任何经常处理数据的人，无论是数据科学家、数据记者、软件开发者，还是其他相关职业。目标是教授实用策略，帮助快速且轻松地弥合我们希望获得的数据与实际拥有的数据之间的差距。我们希望拥有高质量、完美的数据，但现实是，我们的大多数数据远远不足够。无论是数据缺失、格式错误、位置不对，还是数据中的异常，结果往往正如说唱歌手 Notorious B.I.G.所说，“数据越多，问题越多”。

在本书中，我们将把数据清洗视为数据科学过程中的一个重要且值得做的步骤：它是可以轻松改进的，绝不被忽视。我们的目标是重新构建数据清洗的概念，使其不再是一个令人畏惧且繁琐的任务，而是必须完成的准备工作，才能进入真正的工作。相反，凭借一些经过验证的流程和工具，我们将学会像在厨房里一样，先洗好蔬菜，你的食物会看起来更好，味道更好，对身体也更有益。如果你掌握一些正确的刀工技巧，肉类会更嫩，蔬菜也会更均匀地煮熟。就像一个优秀的厨师会有他最喜欢的刀具和烹饪传统一样，一个优秀的数据科学家也会希望在最佳的数据和最佳的条件下工作。

# 本书内容

第一章，*为什么需要干净的数据？* 通过展示数据清理在整个数据科学过程中所起的核心作用，激发了我们对干净数据的追求。接下来，我们通过一个简单的例子展示了来自真实数据集的脏数据。我们权衡了每个潜在清理过程的利弊，然后描述了如何将我们的清理更改传达给他人。

第二章，*基础知识 – 格式、类型和编码*，介绍了关于文件格式、压缩、数据类型的基础知识，包括缺失数据、空数据和字符编码。每个小节都有来自真实数据集的示例。此章很重要，因为接下来的内容我们将依赖这些基本概念的知识。

第三章，*数据清理的主力军 – 电子表格和文本编辑器*，描述了如何最大化利用两种常用工具：文本编辑器和电子表格来进行数据清理。我们将涵盖解决常见问题的简单方法，包括如何使用函数、查找和替换、正则表达式来修正和转换数据。在本章的最后，我们将通过使用这两种工具来清理一些关于大学的真实数据，来检验我们的技能。

第四章，*使用通用语言 – 数据转换*，重点讲解了如何将数据从一种格式转换成另一种格式。这是数据清理中最重要的任务之一，拥有各种工具可以轻松完成此任务非常有用。我们首先一步步讲解不同的转换，包括常见格式之间的相互转换，如逗号分隔值（CSV）、JSON 和 SQL。为了将新的数据转换技能付诸实践，我们进行一个项目，下载一个 Facebook 好友网络，并将其转换为几种不同的格式，以便我们可以可视化其结构。

第五章，*从网络收集和清理数据*，介绍了三种不同的清理 HTML 页面内数据的方法。本章展示了三种流行的工具，用于从标记化文本中提取数据元素，同时也为理解除了本章展示的特定工具之外的其他方法提供了概念基础。作为本章的项目，我们构建了一套清理程序来从基于网络的讨论论坛中提取数据。

第六章, *PDF 文件中的数据清理*，介绍了几种方法来应对数据清理者常遇到的最顽固和最常见的挑战：提取存储在 Adobe 的便携文档格式（PDF）文件中的数据。我们首先检查一些低成本工具来完成这项任务，然后尝试一些低门槛工具，最后，我们还尝试了 Adobe 的非免费软件。和往常一样，我们使用真实世界的数据进行实验，这为我们提供了丰富的经验，帮助我们在遇到问题时找到解决办法。

第七章, *RDBMS 清理技术*，使用一个公开可用的推文数据集，演示如何清理存储在关系型数据库中的数据。展示的数据库是 MySQL，但许多概念，包括基于正则表达式的文本提取和异常检测，也可以很容易地应用到其他存储系统。

第八章, *分享你的干净数据的最佳实践*，描述了一些策略，帮助你使自己的辛勤工作尽可能地容易为他人使用。即使你从未计划与他人分享数据，本章中的策略也将帮助你在自己的工作中保持有序，从而节省未来的时间。本章讲解了如何创建理想的数据包并提供多种格式，如何文档化你的数据，如何选择并附加数据许可证，以及如何公开你的数据，以便你选择后它能够继续存在。

第九章, *Stack Overflow 项目*，带领你通过一个完整的项目，使用真实世界的数据集。我们从提出一系列可以回答的数据集相关问题开始。在回答这些问题时，我们将完成在第一章，*为什么需要干净的数据?*中介绍的整个数据科学流程，并且将实践我们在之前章节中学习到的许多清理过程。此外，由于这个数据集非常庞大，我们还将介绍一些新技巧，用来处理测试数据集的创建。

第十章，*Twitter 项目*，是一个完整的项目，展示了如何执行当前最热门、变化最快的数据收集和清理任务之一：挖掘 Twitter。我们将展示如何查找并收集一个关于真实世界当前事件的公开推文存档，同时遵守 Twitter 服务的法律使用限制。我们将通过这个数据集回答一个简单的问题，同时学习如何清理和提取 JSON 格式的数据，这也是目前最流行的 API 可访问的网络数据格式。最后，我们将设计一个简单的数据模型，用于长期存储提取和清理后的数据，并展示如何生成一些简单的可视化。

# 本书所需的工具

要完成本书中的项目，你将需要以下工具：

+   一个网页浏览器、互联网连接和一个现代操作系统。浏览器和操作系统通常没有太大关系，但最好能够访问命令行终端窗口（例如 OS X 中的终端应用）。在第五章，*收集与清理来自网络的数据*，其中的三项活动之一依赖于一个基于浏览器的工具，该工具在 Chrome 浏览器中运行，所以如果你想完成此活动，请记得这一点。

+   一个文本编辑器，比如 Mac OSX 上的 Text Wrangler 或 Windows 上的 Notepad++。一些集成开发环境（IDEs，例如 Eclipse）也可以作为文本编辑器使用，但它们通常有很多你不需要的功能。

+   一个电子表格应用程序，如 Microsoft Excel 或 Google 表格。尽可能地，我们会提供通用的示例，这些示例适用于这两种工具，但在某些情况下，可能需要使用其中一种。

+   一个 Python 开发环境和安装 Python 库的能力。我推荐使用 Enthought Canopy Python 环境，它可以在这里找到：[`www.enthought.com/products/canopy/`](https://www.enthought.com/products/canopy/)。

+   一个安装并运行的 MySQL 5.5+服务器。

+   一个网页服务器（运行任何服务器软件）和安装了 PHP 5+。

+   一个 MySQL 客户端接口，可以是命令行接口、MySQL Workbench，或 phpMyAdmin（如果你已安装 PHP）。

# 本书适用的读者

如果你正在阅读本书，我猜你可能属于以下两类之一。第一类是数据科学家群体，他们已经花费了大量时间清理数据，但你希望在这方面做得更好。你可能对数据清理的单调感到沮丧，并且你正在寻找加速清理过程、提高效率或只是使用不同工具来完成工作的方法。在我们的厨房隐喻中，你是那位只需要稍微提升一些刀工技能的厨师。

另一组人是做数据科学工作的人，但他们之前并不关心数据清理。现在，您开始认为，如果有清理过程，也许您的结果会更好。也许那句古老的格言“垃圾进，垃圾出”开始变得更现实了。也许您想与他人共享您的数据，但您对自己生成的数据集的质量没有信心。通过本书，您将获得足够的信心来“在公共场合烹饪”，通过学习一些技巧和培养新习惯，确保数据科学环境的整洁和清洁。

无论如何，本书将帮助您重新审视数据清理，将其从一项沉重的工作转变为您质量、品味、风格和效率的象征。您应该有一定的编程基础，但不必非常精通。和大多数数据科学项目一样，愿意学习和实验，以及拥有强烈的好奇心和细致入微的关注力，都非常重要且值得重视。

# 约定

本书中，您会看到多种文本样式，用以区分不同类型的信息。以下是一些样式示例及其含义解释。

文本中的代码词、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 用户名显示如下：“问题在于`open()`无法处理 UTF-8 字符。”

代码块设置如下：

```py
for tweet in stream:
    encoded_tweet = tweet['text'].encode('ascii','ignore')
    print counter, "-", encoded_tweet[0:10]
    f.write(encoded_tweet)
```

当我们希望引起您注意某个代码块的特定部分时，相关的行或项目会以粗体显示：

```py
First name,birth date,favorite color,salary
"Sally","1971-09-16","light blue",129000
"Manu","1984-11-03","",159960
"Martin","1978-12-10","",76888
```

任何命令行输入或输出都如下所示：

```py
tar cvf fileArchive.tar reallyBigFile.csv anotherBigFile.csv
gzip fileArchive.tar

```

**新术语**和**重要词汇**以粗体显示。屏幕上看到的词语，例如菜单或对话框中的文字，出现在文本中是这样的：“按住**Option**键并选择列中的文本。”

### 注意

警告或重要提示会以框的形式呈现，如下所示。

### 提示

小贴士和技巧像这样呈现。

# 读者反馈

我们始终欢迎读者的反馈。告诉我们您对本书的看法——喜欢或不喜欢的部分。读者反馈对我们来说很重要，因为它帮助我们开发您真正能从中受益的书籍。

要向我们发送一般反馈，只需通过电子邮件发送至 `<feedback@packtpub.com>`，并在邮件主题中提及书名。

如果您在某个领域有专业知识，并且有兴趣撰写或贡献一本书，请查看我们的作者指南：[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在，作为 Packt 书籍的骄傲拥有者，我们为您提供了一些帮助，让您最大化地利用您的购买。

## 下载本书的彩色图片

我们还为您提供了一个 PDF 文件，其中包含本书中使用的截图/图表的彩色图片。彩色图片将帮助您更好地理解输出中的变化。您可以从 [`www.packtpub.com/sites/default/files/downloads/Clean_Data_Graphics.zip`](https://www.packtpub.com/sites/default/files/downloads/Clean_Data_Graphics.zip) 下载该文件。

## 勘误

尽管我们已尽力确保内容的准确性，但错误难免发生。如果您在我们的书籍中发现错误——可能是文本或代码中的错误——我们将非常感激您能向我们报告。这样，您不仅能帮助其他读者避免困扰，还能帮助我们改进书籍的后续版本。如果您发现任何勘误，请访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata) 报告，选择您的书籍，点击**勘误提交表单**链接，并输入错误的详细信息。一旦您的勘误得到验证，您的提交将被接受，勘误将被上传到我们的网站或添加到该书标题下的勘误列表中。

若要查看之前提交的勘误，请访问 [`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support) 并在搜索框中输入书名。所需信息将出现在**勘误**部分。

## 盗版

互联网盗版问题在所有媒体中都普遍存在。在 Packt，我们非常重视保护我们的版权和许可证。如果您在互联网上发现任何非法复制的我们作品，请立即提供该材料的具体位置或网站名称，以便我们采取相应措施。

请通过电子邮件 `<copyright@packtpub.com>` 与我们联系，并提供涉嫌盗版材料的链接。

感谢您的帮助，保护我们的作者和我们为您提供有价值内容的能力。

## 问题

如果您对本书的任何部分有疑问，可以通过电子邮件 `<questions@packtpub.com>` 联系我们，我们将尽力解决问题。
