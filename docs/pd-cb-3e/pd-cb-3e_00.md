# 前言

pandas 是一个用于创建和处理结构化数据的 Python 库。我说的“结构化”是什么意思？我指的是像你在电子表格或数据库中看到的那样，按行和列组织的数据。数据科学家、分析师、程序员、工程师以及其他人都在利用它来塑造他们的数据。

pandas 仅限于“小数据”（可以容纳在单台机器内存中的数据）。然而，pandas 的语法和操作已经被其他项目采纳或启发：例如 PySpark、Dask 和 cuDF 等。这些项目的目标不同，但其中一些可以扩展到大数据。因此，了解 pandas 的工作原理是有价值的，因为它的功能正在成为与结构化数据交互的事实标准 API。

我是 Will Ayd，自 2018 年以来一直是 pandas 库的核心维护者。在此期间，我有幸为其他许多开源项目做出贡献并进行合作，这些项目属于同一生态系统，包括但不限于 Arrow、NumPy 和 Cython。

我还以咨询为生，使用我所贡献的相同生态系统。通过使用最好的开源工具，我帮助客户制定数据战略、实施流程和模式，并培训员工，以保持在不断变化的分析领域中领先。我坚信开源工具所提供的自由，并已向许多公司证明了这一价值。

如果贵公司有兴趣优化您的数据战略，请随时联系我（`will_ayd@innobi.io`）。

# 本书适合谁

本书包含了大量配方，范围从非常简单到高级。所有配方都力求以清晰、简洁和现代化的 pandas 惯用代码编写。“*如何运作*”部分包含了对每个步骤细节的极其详细描述。通常，在“*更多内容…*”部分，您会看到看似全新的配方。本书充满了大量 pandas 代码。

尽管不是严格要求，但建议用户按时间顺序阅读本书。书中的配方以一种结构化的方式呈现，首先通过非常小且有针对性的示例引入概念和特性，但从此基础上不断构建，逐渐过渡到更复杂的应用。

由于本书涉及的复杂性范围广泛，它对初学者和日常用户都很有用。根据我的经验，即使是那些经常使用 pandas 的人，也无法掌握它，除非他们接触到惯用的 pandas 代码。这在一定程度上是由于 pandas 提供的广度。几乎总是有多种方式完成相同的操作，这可能让用户得到他们想要的结果，但效率非常低。经常可以看到两组 pandas 解决方案在同一个问题上性能差距达到一个数量级或更多。

本书的唯一真正前提是具备基础的 Python 知识。假设读者已经熟悉 Python 中所有常见的内建数据容器，例如列表、集合、字典和元组。

# 本书内容涵盖

*第一章*，*pandas 基础*，介绍了 pandas 中的主要对象，即 `Series`、DataFrame 和 `Index`。

*第二章*，*选择与赋值*，展示了如何筛选你已加载到任何 pandas 数据结构中的数据。

*第三章*，*数据类型*，探讨了 pandas 背后的类型系统。这是一个快速发展的领域，并将继续发展，因此了解类型及其区别是非常宝贵的信息。

*第四章*，*pandas I/O 系统*，展示了为什么 pandas 长期以来一直是读取和写入各种存储格式的流行工具。

*第五章*，*算法及其应用*，介绍了使用 pandas 数据结构进行计算的基础。

*第六章*，*可视化*，展示了如何直接使用 pandas 进行绘图，以及与 seaborn 库的良好集成。

*第七章*，*重塑 DataFrame*，讨论了如何通过 pandas `pd.DataFrame` 强大地转换和总结数据的多种方式。

*第八章*，*分组*，展示了如何对包含在 `pd.DataFrame` 中的数据子集进行分段和总结。

*第九章*，*时间数据类型与算法*，向用户介绍了支持 pandas 在时间序列分析中应用的日期/时间类型，并强调了如何使用这些类型处理真实数据。

*第十章*，*常见用法/性能提示*，讲解了用户在使用 pandas 时常遇到的常见陷阱，并展示了符合惯用法的解决方案。

*第十一章*，*pandas 生态系统*，讨论了与 pandas 集成、扩展和/或互补的其他开源库。

# 如何充分利用这本书

有几件事情可以帮助你充分利用这本书。首先，最重要的一点是，你应该下载所有代码，这些代码存储在 Jupyter Notebook 中。在阅读每个食谱时，运行笔记本中的每一步代码。在运行代码时，确保自己进行探索。其次，打开 pandas 的官方文档页面（[`pandas.pydata.org/pandas-docs/stable/`](http://pandas.pydata.org/pandas-docs/stable/)）作为浏览器标签之一。pandas 文档是一个出色的资源，包含了超过 1000 页的资料，文档中有大多数 pandas 操作的示例，而且这些示例通常会直接从 *另见* 部分提供链接。虽然文档涵盖了大多数操作的基础内容，但它用的是琐碎的示例和虚假的数据，这些内容不能反映你在分析现实世界数据集时可能遇到的情况。

## 这本书所需的知识

pandas 是 Python 编程语言的第三方包，截至本书打印时，正从 2.x 版本过渡到 3.x 版本。本书中的示例应至少适用于 pandas 2.0 版本以及 Python 3.9 及以上版本。

本书中的代码将使用 pandas、NumPy 和 PyArrow 库。Jupyter Notebook 文件也是一种流行的可视化和检查代码的方式。所有这些库应该可以通过 `pip` 或你选择的包管理器安装。对于 pip 用户，你可以运行：

```py
`python -m pip install pandas numpy pyarrow notebook` 
```

## 下载示例代码文件

你可以从你的账户在 [www.packt.com](https://www.packt.com) 下载本书的示例代码文件。如果你从其他地方购买了本书，你可以访问 [www.packtpub.com/support/errata](https://www.packtpub.com/support/errata) 并注册，让文件直接通过电子邮件发送给你。

你可以按照以下步骤下载代码文件：

1.  在 [www.packt.com](https://www.packt.com) 上登录或注册。

1.  选择**支持**选项卡。

1.  点击**代码下载**。

1.  在**搜索**框中输入书名，并按照屏幕上的指示操作。

本书的代码包也托管在 GitHub 上，网址为 [`github.com/WillAyd/Pandas-Cookbook-Third-Edition`](https://github.com/WillAyd/Pandas-Cookbook-Third-Edition)。如果代码有更新，它会在现有的 GitHub 仓库中进行更新。

## 运行 Jupyter notebook

本书推荐的学习方法是保持 Jupyter notebook 运行，这样你可以在阅读配方时运行代码。边读边做可以让你在电脑上探索，从而比仅仅阅读书本更深入理解内容。

安装 Jupyter notebook 后，打开命令提示符（在 Windows 上输入 `cmd`，或者在 Mac 或 Linux 上打开终端），然后输入：

```py
`jupyter notebook` 
```

从你的主目录运行此命令并不是必须的。你可以从任何位置运行它，浏览器中的内容将会反映该位置。尽管我们现在已经启动了 Jupyter Notebook 程序，但实际上我们还没有启动任何单独的笔记本来开始进行 Python 开发。要做到这一点，你可以点击页面右侧的**新建**按钮，这将下拉显示所有可供你使用的内核列表。如果你是从全新安装开始，那么你将只能使用一个内核（Python 3）。选择 Python 3 内核后，浏览器中将打开一个新标签页，在那里你可以开始编写 Python 代码。

当然，你可以打开以前创建的笔记本，而不是开始一个新的笔记本。为此，你可以通过 Jupyter Notebook 浏览器主页提供的文件系统进行导航，选择你想要打开的笔记本。所有 Jupyter Notebook 文件的扩展名都是 `.ipynb`。

或者，您可以使用云服务提供商的笔记本环境。谷歌和微软都提供免费的预装有 pandas 的笔记本环境。

## 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图像。您可以在此下载：[`packt.link/gbp/9781836205876`](https://packt.link/gbp/9781836205876)。

## 约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码字、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter/X 账户。例如：“您可能需要安装 `xlwt` 或 `openpyxl` 来分别写入 XLS 或 XLSX 文件。”

代码块设置如下：

```py
`import pandas as pd import numpy as np movies = pd.read_csv("data/movie.csv") movies` 
```

**粗体**：表示一个重要的词，或屏幕上显示的词。例如：“从**管理面板**中选择**系统信息**。”

*斜体*：表示在写作上下文中具有额外重要性的*术语*。

**重要提示**

显示如下。

**提示**

显示如下。

## 每个食谱的假设

假设每个食谱开始时，都会将 pandas、NumPy、PyArrow 和 Matplotlib 导入到命名空间中：

```py
`import numpy as np import pyarrow as pa import pandas as pd` 
```

## 数据集描述

本书中使用了大约二十多个数据集。在完成食谱步骤时，了解每个数据集的背景信息非常有帮助。每个数据集的详细描述可以在 `dataset_descriptions` Jupyter Notebook 文件中找到，该文件位于 [`github.com/WillAyd/Pandas-Cookbook-Third-Edition`](https://github.com/WillAyd/Pandas-Cookbook-Third-Edition)。每个数据集将列出各列、每列的相关信息，并提供有关数据来源的备注。

# 章节

在本书中，您将找到几个经常出现的标题。

为了提供清晰的食谱完成指导，我们可能会使用以下某些或所有章节：

## 如何做

本节包含完成食谱所需的步骤。

## 它是如何工作的

本章节通常包含对前一章节内容的详细解释。

## 还有更多内容…

本节包含关于食谱的附加信息，旨在让您更了解该食谱。

# 联系我们

我们始终欢迎读者的反馈。

**常规反馈**：如果您对本书的任何方面有疑问，请在邮件主题中注明书名，并通过 `customercare@packtpub.com` 给我们发送邮件。

**勘误**：虽然我们已尽最大努力确保内容的准确性，但仍可能会发生错误。如果您在本书中发现错误，我们将非常感谢您向我们报告。请访问，[www.packtpub.com/support/errata](https://www.packtpub.com/support/errata)，选择您的书籍，点击**勘误提交表格**链接，并填写相关详情。

**盗版**：如果您在互联网上发现我们作品的任何形式的非法副本，请提供给我们位置地址或网站名称，我们将不胜感激。请通过`copyright@packt.com`与我们联系，并附上材料链接。

**如果您有兴趣成为作者**：如果您在某个专业领域有专长，并且有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](https://authors.packtpub.com)。

# 留下评论！

感谢您从 Packt Publishing 购买这本书，希望您喜欢！您的反馈是宝贵的，有助于我们改进和成长。阅读完毕后，请花点时间留下亚马逊评论；只需一分钟，但对像您这样的读者有很大的帮助。

![](img/QR_Code1474021820358918656.png)

`packt.link/NzOWQ`

扫描下面的二维码，获取您选择的免费电子书。

# 下载这本书的免费 PDF 副本

感谢您购买这本书！

您喜欢随时随地阅读，但无法随身携带印刷书籍吗？

您购买的电子书与您选择的设备不兼容吗？

别担心，现在每本 Packt 书籍您都可以免费获得该书的无 DRM PDF 版本。

随时随地，在任何地方，使用任何设备阅读。直接从您喜爱的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

好处不止于此，您还可以独家获得折扣、新闻简报和每天在您的收件箱中获得优质免费内容。

按照以下简单步骤获取这些好处：

1.  扫描二维码或访问下面的链接：

![](img/B31091_Free_PDF_QR.png)

[`packt.link/free-ebook/9781836205876`](https://packt.link/free-ebook/9781836205876 )

1.  提交您的购买凭证。

1.  就这样！我们将把您的免费 PDF 和其他好处直接发送到您的电子邮件。
