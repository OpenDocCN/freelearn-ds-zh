# 前言

数据科学的目的是利用数据改变世界，这个目标主要通过颠覆和改变真实行业中的真实流程来实现。要在这个层面上运作，我们需要能够构建实质性的数据科学解决方案；解决真正的问题，并且能够可靠地运行，以便人们信任并采取行动。

本书解释了如何使用 Spark 提供生产级的数据科学解决方案，这些解决方案创新、颠覆性，并且足够可靠，值得信赖。在撰写本书时，作者的意图是提供一本超越传统食谱风格的作品：不仅提供代码示例，还要培养探索内容的技巧和心态，就像一位大师；正如他们所说，“内容为王”！读者会注意到本书在新闻分析方面的重点，并偶尔引入其他数据集，如推文和金融数据。这种对新闻的重视并非偶然；我们花了很多精力试图专注于提供全球范围内提供背景的数据集。

本书致力于解决的隐含问题是缺乏提供人们如何以及为什么做出决策的适当背景的数据。通常，直接可访问的数据源非常专注于特定问题，因此在提供行为背景所需的更广泛数据集方面可能非常有限，这导致我们无法真正理解人们做出决策的驱动因素。

考虑一个简单的例子，网站用户的关键信息，如年龄、性别、位置、购物行为、购买等都是已知的，我们可以利用这些数据来推荐产品，基于其他“和他们相似”的人购买的产品。

但要想成为杰出的人，需要更多的背景信息来解释人们为什么会表现出这样的行为。当新闻报道暗示一场大西洋飓风正在接近佛罗里达海岸线，并且可能在 36 小时内到达海岸时，也许我们应该推荐人们可能需要的产品。比如 USB 充电宝、蜡烛、手电筒、净水器等物品。通过了解决策背后的背景，我们可以进行更好的科学研究。

因此，尽管本书确实包含有用的代码，而且在许多情况下还包含独特的实现，但它进一步深入探讨了真正掌握数据科学所需的技术和技能；其中一些经常被忽视或根本没有被考虑。作者们凭借多年的商业经验，利用他们丰富的知识，将数据科学的真实而令人兴奋的世界呈现出来。

# 本书涵盖的内容

第一章, *大数据科学生态系统*，本章介绍了一种在规模上实现数据成功的方法和相关生态系统。它侧重于数据科学工具和技术，这些工具和技术将在后面的章节中使用，并介绍了环境以及如何适当地配置它。此外，它解释了一些与整体数据架构和长期成功相关的非功能性考虑。

第二章, *数据获取*，作为数据科学家，最重要的任务之一是将数据准确地加载到数据科学平台中。本章解释了如何构建 Spark 中的通用数据摄入管道，这个管道可以作为可重用的组件，服务于许多输入数据源。

第三章，“输入格式和模式”，本章演示了如何从原始格式加载数据到不同的模式，从而使得可以对相同数据运行各种不同类型的下游分析。考虑到这一点，我们将研究传统上理解的数据模式领域。我们将涵盖传统数据库建模的关键领域，并解释其中一些基石原则如何今天仍然适用于 Spark。此外，当我们磨练我们的 Spark 技能时，我们将分析 GDELT 数据模型，并展示如何以高效和可扩展的方式存储这个大型数据集。

第四章，“探索性数据分析”，一个常见的误解是，EDA 仅用于发现数据集的统计属性，并提供关于如何利用它的见解。实际上，这并不是全部。完整的 EDA 将扩展这个想法，并包括对“在生产中使用这个数据源的可行性”的详细评估。这要求我们也要了解如何为这个数据集指定一个生产级的数据加载程序，这个程序可能会在很多年内以“无人值守模式”运行。本章提供了一种使用“数据概要分析”技术加速数据质量评估的快速方法。

第五章，“地理分析的 Spark”，地理处理是 Spark 的一个强大的新用例，本章演示了如何入门。本章的目的是解释数据科学家如何使用 Spark 处理地理数据，以生成基于地图的大型数据集的强大视图。我们演示了如何通过 Spark 与 Geomesa 集成轻松处理时空数据，从而帮助将 Spark 转变为一个复杂的地理处理引擎。本章后来利用这些时空数据应用机器学习，以预测石油价格。

第六章，“抓取基于链接的外部数据”，本章旨在解释一种增强本地数据的常见模式，即在 URL 或 API 上找到的外部内容，如 GDELT 和 Twitter。我们提供了一个使用 GDELT 新闻索引服务作为新闻 URL 来源的教程，演示了如何构建一个从互联网上抓取感兴趣的全球突发新闻的 Web 规模新闻扫描器。我们进一步解释了如何使用专门的网络抓取组件来克服规模的挑战，随后总结了本章。

第七章，“构建社区”，本章旨在解决数据科学和大数据中的一个常见用例。随着越来越多的人互动，交流信息，或者简单地分享不同主题的共同兴趣，整个世界可以被表示为一个图。数据科学家必须能够检测社区，找到影响者/顶级贡献者，并检测可能的异常。

第八章，“构建推荐系统”，如果要选择一个算法来向公众展示数据科学，推荐系统肯定会成为其中之一。今天，推荐系统随处可见；它们之所以如此受欢迎，是因为它们的多功能性、实用性和广泛适用性。在本章中，我们将演示如何使用原始音频信号推荐音乐内容。

第九章，“新闻词典和实时标记系统”，虽然分层数据仓库将数据存储在文件夹中，但典型的基于 Hadoop 的系统依赖于扁平架构来存储数据。如果没有适当的数据治理或对数据的清晰理解，就有不可否认的可能性将数据湖变成沼泽，其中一个有趣的数据集，如 GDELT，将不过是一个包含大量非结构化文本文件的文件夹。在本章中，我们将描述一种创新的方式，以非监督的方式对即将到来的 GDELT 数据进行标记，并且几乎是实时的。

第十章，“故事去重和变异”，在本章中，我们对 GDELT 数据库进行去重和索引，然后跟踪故事的变化，了解它们之间的联系，它们如何变异，以及它们是否可能导致不久的将来发生的事件。本章的核心是使用 Simhash 检测近似重复项，并使用随机索引构建向量以降低维度。

第十一章，“异常检测和情感分析”，也许 2016 年最引人注目的事件是紧张的美国总统选举及其最终结果：唐纳德·特朗普当选总统，这场竞选将长久被人们铭记；尤其是因为其对社交媒体的空前利用以及激起用户激情的方式，其中大多数人通过使用标签表达了自己的情感。在本章中，我们将尝试使用实时 Twitter 信息流检测美国选举期间的异常推文，而不是试图预测选举结果本身。

第十二章，“趋势演算”，在“趋势”成为数据科学家研究的热门话题之前，早有一个更古老的概念，至今仍未得到数据科学的充分应用；那就是趋势。目前，对趋势的分析，如果可以这样称呼的话，主要是由人们“用眼睛看”时间序列图表并进行解释。但人们的眼睛究竟在做什么？本章描述了 Apache Spark 中用于数值研究趋势的新算法：趋势演算。

第十三章，“安全数据”，在本书中，我们涉及了许多数据科学领域，经常涉足那些传统上与数据科学家的核心工作知识不太相关的领域。在本章中，我们将讨论另一个经常被忽视的领域，安全数据；更具体地说，如何在数据生命周期的各个阶段保护您的数据和分析结果。本章的核心是构建一个用于 Spark 的商业级加密编解码器。

第十四章，“可扩展算法”，在本章中，我们将了解为什么有时即使基本算法在小规模下运行良好，但在“大数据”中却经常失败。我们将看到如何避免在编写运行在大规模数据集上的 Spark 作业时出现问题，并了解算法的结构以及如何编写能够在数据量达到 PB 级别时扩展的自定义数据科学分析。本章涵盖了诸如：并行化策略、缓存、洗牌策略、垃圾回收优化和概率模型等领域；解释了这些如何帮助您充分利用 Spark 范式。

# 阅读本书需要什么

本书中使用了 Spark 2.0 以及 Scala 2.11、Maven 和 Hadoop。这是基本的环境要求，还有许多其他在相关章节中介绍的技术。

# 这本书是为谁准备的

我们假设阅读本书的数据科学家对数据科学、常见的机器学习方法和流行的数据科学工具有所了解，并且在工作中进行了概念验证研究并构建了原型。我们为这个受众提供了一本介绍高级技术和方法来构建数据科学解决方案的书籍，向他们展示如何构建商业级数据产品。

# 约定

在本书中，您会发现一些文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义的解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄显示如下："下一行代码读取链接并将其分配给`BeautifulSoup`函数。"

代码块设置如下：

```scala
import org.apache.spark.sql.functions._      

val rdd = rawDS map GdeltParser.toCaseClass    
val ds = rdd.toDS()     

// DataFrame-style API 
ds.agg(avg("goldstein")).as("goldstein").show() 
```

当我们希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

```scala
spark.sql("SELECT V2GCAM FROM GKG LIMIT 5").show 
spark.sql("SELECT AVG(GOLDSTEIN) AS GOLDSTEIN FROM GKG WHERE GOLDSTEIN IS NOT NULL").show()
```

任何命令行输入或输出都以以下方式编写：

```scala
$ cat 20150218230000.gkg.csv | gawk -F"\t" '{print $4}'

```

**新术语**和**重要单词**以粗体显示。屏幕上看到的单词，例如菜单或对话框中的单词，会以这样的方式出现在文本中："为了下载新模块，我们将转到**文件** | **设置** | **项目名称** | **项目解释器**。"

### 注意

警告或重要说明会出现在这样的框中。

### 提示

提示和技巧会出现在这样。
