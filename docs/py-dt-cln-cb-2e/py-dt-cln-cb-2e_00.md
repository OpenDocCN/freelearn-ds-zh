# 前言

本书是一本关于数据清理的实用指南，广义上定义为所有为分析准备数据所需的任务。它按照数据清理过程中的常见任务进行组织：导入数据、诊断性查看数据、识别离群值和意外值、填补缺失值、整理数据等。每个实例都会引导读者从原始数据处理到完成特定的数据清理任务。

市面上已经有一些非常好的 pandas 书籍。不出所料，这些书籍和本书有一些内容重叠。然而，本书的重点不同。我在本书中不仅关注“如何做”，也同样重视“为什么这么做”。

由于 pandas 仍然相对较新，我在数据清理方面学到的经验，受到了我使用其他工具时的影响。在大约 10 年前我定居于现在的 Python 和 R 工作方式之前，我在 2000 年代初期主要依赖 C# 和 T-SQL，90 年代使用 SAS 和 Stata，80 年代使用 FORTRAN 和 Pascal。本书的大多数读者可能都对多种数据清理和分析工具有一定经验。从许多方面来看，特定工具的重要性不如数据准备任务和数据的属性。我如果被要求编写《SAS 数据清理手册》或《R 数据清理手册》，也会覆盖几乎相同的内容。我只是用 Python/pandas 特定的方法来处理几十年来分析师们一直面临的相同数据清理挑战。

我在每一章的开始部分都会介绍如何思考当前手头的数据清理任务，然后再讨论如何使用 Python 生态系统中的工具——pandas、NumPy、Matplotlib 等来处理。每个实例中都会通过讨论我们在数据中揭示的内容的含义来加深这一点。我尽量将工具与目标联系起来。例如，像偏度和峰度这样的概念对于处理离群值的重要性，和了解如何更新 pandas Series 的值一样。

# 第二版新增内容

第一版的读者会发现，本书比第一版长了很多。这部分是因为增加了两个新章节——一个专门讲解缺失值处理，另一个讲解数据预处理在预测分析中的应用。第一版对缺失值的覆盖不足，以及没有涉及机器学习应用中数据预处理的内容，是重要的遗漏。数据预处理的内容通过最后一章关于数据管道的新实例得到了进一步改进，帮助读者从原始数据到模型评估。

本书中的所有章节的食谱都进行了修订。这是为了确保它们能够与最新版本的 pandas 兼容。在本书编写期间，pandas 从 1.5.3 版本更新到了 2.2.1 版本。我已尽力确保所有代码在 2023 年 1 月到 2024 年 2 月期间发布的所有 pandas 版本上都能正常工作。由于 AI 工具在我们的工作中越来越普遍，我在四章中加入了 OpenAI 工具的讨论。总的来说，82 个食谱中有 22 个是新的。所有使用的数据集也进行了更新。

# 本书适合的读者

在写这本书时，我考虑了多个读者群体，但我最常想到的是我的一位亲密朋友。30 年前，她购买了一本 Transact-SQL 书籍，很快便在数据库工作中建立了极大的信心，并最终围绕这些技能建立了职业生涯。如果一位刚开始做数据科学家或分析师的新人，通过本书也能有我朋友那样的经历，我会非常高兴。最重要的是，我希望你在阅读完本书后能对自己所能做的事情感到高兴和兴奋。

我也希望本书能为那些从事此类工作一段时间的朋友提供有价值的参考。在这里，我设想有人翻开书，心里想：“有哪些处理缺失数据的方法能够保持我变量的方差？”

与本书实践性的特点保持一致，书中的每一段输出都可以通过代码重现。我在写作过程中也始终遵循一个规则，即使遇到挑战也没有改变：每个食谱都从基本未改变的原始数据开始。你将从数据文件开始，一步步得到更好处理的数据。如果你忘记了某个对象是如何创建的，只需翻回几页就能找到。

有一些 pandas 和 NumPy 基础的读者会更容易理解某些代码块，了解 Python 和基础统计的读者也会有一些帮助。不过这些都不是必须的。只是有些食谱你可能需要停下来多想一会儿。

# 本书内容

*第一章*，*在使用 pandas 导入表格数据时预见数据清理问题*，探讨了将 CSV 文件、Excel 文件、关系数据库表、SAS、SPSS、Stata 和 R 文件加载到 pandas DataFrame 中的工具。

*第二章*，*处理 HTML、JSON 和 Spark 数据时预见数据清理问题*，讨论了读取和标准化 JSON 数据、网页抓取以及使用 Spark 处理大数据的技术。它还探讨了数据持久化技术，包括版本控制。

*第三章*，*衡量你的数据*，介绍了在 DataFrame 中导航、选择列和行以及生成摘要统计信息的常见技术。还介绍了使用 OpenAI 工具检查数据集结构和生成统计信息。

*第四章*，*在数据子集中过滤异常值*，探索了识别整个 DataFrame 及选定组中的异常值的广泛策略。

*第五章*，*使用可视化识别意外值*，展示了如何使用 Matplotlib 和 Seaborn 工具可视化关键变量的分布，包括直方图、箱线图、散点图、折线图和小提琴图。

*第六章*，*使用 Series 操作清理和探索数据*，讨论了如何使用标量、算术运算和基于一个或多个 Series 的条件语句更新 pandas Series。

*第七章*，*识别和修复缺失值*，介绍了识别行、列和数据子集中的缺失值的策略。探讨了填充缺失值的策略，例如设置为总体均值或某一类别的均值以及前向填充。还研究了多变量填充缺失值的技术，并讨论了它们的适用情况。

*第八章*，*编码、转换和缩放特征*，涵盖了各种变量转换技术，用于为预测分析准备特征和目标。这包括最常见的编码类型——独热编码、序数编码和哈希编码；改善变量分布的转换；以及用于解决偏态、峰态和异常值问题的分箱和缩放方法，还可以调整特征范围差异较大的情况。

*第九章*，*聚合数据时修复杂乱数据*，展示了通过分组聚合数据的多种方法，包括使用`itertuples`或 NumPy 数组遍历数据、删除重复行，以及使用 pandas 的 groupby 和透视表。还讨论了何时选择一种方法而非其他方法。

*第十章*，*合并 DataFrame 时处理数据问题*，探讨了连接和合并数据的不同策略，以及如何预测在合并数据时可能遇到的常见数据挑战。

*第十一章*，*整理和重塑数据*，介绍了几种去重、堆叠、熔化和透视数据的策略。

*第十二章*，*使用用户定义函数、类和管道自动化数据清理*，探讨了如何将前 11 章中的许多技术转化为可复用的代码。

## 下载示例代码文件

本书的代码包托管在 GitHub 上，地址为：[`github.com/PacktPublishing/Python-Data-Cleaning-Cookbook-Second-Edition`](https://github.com/PacktPublishing/Python-Data-Cleaning-Cookbook-Second-Edition)。我们还在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)提供了来自我们丰富书籍和视频目录的其他代码包。快来看看吧！

## 下载彩色图像

我们还提供了一个 PDF 文件，其中包含本书中使用的截图/图表的彩色图像。你可以在这里下载：[`packt.link/gbp/9781803239873`](https://packt.link/gbp/9781803239873)。

# 使用的约定

本书中使用了许多文本约定。

`Code in text`：指文本中的代码词汇、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 账号。例如：“将下载的`WebStorm-10*.dmg`磁盘映像文件挂载为系统中的另一个磁盘。”

代码块如下所示：

```py
import pandas as pd
import os
import sys
nls97 = pd.read_csv("data/nls97g.csv", low_memory=False)
nls97.set_index('personid', inplace=True) 
```

代码的任何输出将显示如下：

```py
 satverbal  satmath
min           14        7
per15        390      390
qr1          430      430
med          500      500
qr3          570      580
per85        620      621
max          800      800
count      1,406    1,407
mean         500      501
iqr          140      150 
```

**粗体**：表示新术语、重要词汇或屏幕上显示的文字。例如，菜单或对话框中的词汇将以这种方式出现在文本中。以下是一个示例：“从**系统信息**中选择**管理**面板。”

警告或重要说明如下所示。

提示和技巧如下所示。

# 与我们联系

我们欢迎读者的反馈。

**一般反馈**：请发送电子邮件至`feedback@packtpub.com`，并在邮件主题中提及书名。如果您对本书的任何方面有疑问，请通过`questions@packtpub.com`与我们联系。

**勘误**：尽管我们已经尽力确保内容的准确性，但错误难免。如果您在本书中发现了错误，欢迎您向我们报告。请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，点击**提交勘误**并填写表单。

**盗版**：如果你在互联网上发现任何我们作品的非法复制版本，请提供其位置地址或网站名称，我们将不胜感激。请通过`copyright@packtpub.com`与我们联系，并附上该材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题领域有专业知识，并且有兴趣撰写或参与写作书籍，请访问[`authors.packtpub.com`](http://authors.packtpub.com)。

# 分享您的想法

阅读完*Python 数据清理食谱（第二版）*后，我们很乐意听听您的想法！请[点击这里直接访问亚马逊评论页面](https://packt.link/r/1803239875)并分享您的反馈。

您的评价对我们和技术社区非常重要，并将帮助我们确保提供卓越的优质内容。

# 下载本书的免费 PDF 副本

感谢您购买本书！

您喜欢在旅途中阅读，但又无法随身携带纸质书籍吗？

你的电子书购买是否与您选择的设备不兼容？

别担心，现在购买每本 Packt 书籍时，您都能免费获得该书的无 DRM 版 PDF。

在任何地方、任何设备上阅读。直接从您最喜爱的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

特权不仅限于此，您还可以获得独家折扣、新闻通讯和每日发送到您邮箱的精彩免费内容。

按照以下简单步骤获取好处：

1.  扫描二维码或访问以下链接：

![](img/B18596_Free_PDF_QR.png)

https://packt.link/free-ebook/9781803239873

1.  提交您的购买凭证。

1.  就是这样！我们会将您的免费 PDF 和其他福利直接发送到您的邮箱。
