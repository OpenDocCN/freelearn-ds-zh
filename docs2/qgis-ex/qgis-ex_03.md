# 第三章。在打印地图上展示数据

打印地图是分享您空间信息的一个很好的工具，因为它们可以作为高质量的图形包含在演示文稿、出版物和报告中，或者以传统方式打印。QGIS 具有创建单页或多页（所谓的大地志）地图的强大功能，您可以将其导出为多种易于分发和打印的图形格式（例如，.pdf、.png、.svg 等）。

在本章中，您将接触到 QGIS 创建打印地图的主要工具，称为**打印作曲**，并学习如何使用它以获得出色的结果。

# 打印作曲

使用打印作曲，地图设计变得简单直观，因为它允许您设置布局并添加地图及其必要的元素，例如文本标签、图例、比例尺和指向北方的箭头。此外，您可以通过结合多个概述、图像、绘图和 HTML 标签来显著增强您的地图。为了简化地图生成并节省您的宝贵时间，您可以使用地图模板和大地志生成器功能。

要进入打印作曲模式，请从菜单中选择**项目** | **新建打印作曲**，点击**文件**工具栏上的![打印作曲](img/image00363.jpeg)按钮，或者直接使用*Ctrl* + *P*键盘快捷键。在**作曲标题**对话框窗口中，您将被要求为您的地图提供一个标题。点击**确定**按钮，标题将自动生成（例如`作曲 1`、`作曲 2`、`作曲 3`等；如果您想的话，稍后可以重命名它们）。

在打印作曲窗口的上行中，有下拉菜单，提供访问其选项和功能。工具栏的上行提供了快速访问相同功能的按钮。请注意，**作曲项**工具栏默认放置在窗口的左侧，因为它提供了快速访问通常构成地图所需的所有元素，例如地图画布、图例、比例尺、标签、注释等。在窗口的中央部分，您可以看到一个空白的页面，它代表可用于项目排列的作曲画布，如图所示：

![打印作曲](img/image00364.jpeg)

在打印作曲窗口的右侧，有两个带有标签的面板。上方面板包含以下标签页：

+   **项**：这显示添加到地图中的地图项列表。它允许您定义它们的可见性、重命名、重新排序并将它们锁定以防止更改。

+   **命令历史记录**：这显示使用的命令列表。使用历史记录，您可以轻松回滚更改，并更好地控制地图生成过程。

下方面板包含三个标签页，如下所示：

+   **组合**：这负责**纸张和质量**（页面大小、数量和分辨率）以及**指南和网格**（间距和吸附容差），以便简化地图项的放置。

+   **项目属性**：这是一个动态标签页，其内容会根据当前选定的地图项目自动更改。

+   **图集生成**：一旦**生成图集**切换处于活动状态，您就可以设置和修改其参数。

    ### 注意

    注意，只有默认面板的位置可以重新排列。为了更改面板/标签位置，将鼠标箭头悬停在它的穿孔区域上，它看起来像这样：

    ![打印作曲家](img/image00365.jpeg)

    现在，将其拖放到另一个位置。您还可以通过点击右上角按钮关闭任何不必要的面板。此外，您可以通过在菜单或工具栏面板上右键单击后可用的切换来打开或关闭面板，即当您看到类似以下内容时：

    ![打印作曲家](img/image00366.jpeg)

您可以通过其**Composer 选项**菜单获取对作曲设置的控制，该菜单位于**设置**下。例如，您可能想更改用于图例和文本标签的**默认字体**。在**网格外观**部分进行进一步工作，我们将**网格样式**设置为**实线**，并保持**网格和引导默认值**不变，因为我们将在稍后进行配置。

# 初始设置 - 页面格式和其他基本设置

在创建地图之前，我们应该设置我们的工作空间，这主要是由页面设置定义的。所有必要的选项都位于**编排**标签下。让我们更仔细地看看**纸张和品质**部分。在**预设**下拉列表中的默认页面大小是**A4**，但您可以从 23 种其他大小中选择。我们将通过以下步骤创建自己的页面：

1.  从列表中选择**自定义**。

1.  **宽度**和**高度**字段将被激活。为两者输入`200`的值（这意味着我们将为地图编排创建一个方形页面）。该值取决于在**单位**中选择的单位，默认情况下设置为**毫米**（毫米）。

由于我们只创建一张地图，我们将**页数**保留为 1，但如果您打算将多个页面合并成一个文档，您始终可以输入更多。这是因为您可以在单页编排中包含多个地图。如图例所示，我们使用的是方形页面。因此，它是否有**纵向**或**横向**页面方向无关紧要。**页面背景**是一个非常重要的项目，因为它允许您实现酷炫的地图可视化效果。通过点击**更改**按钮，您可以看到默认情况下，它设置为**简单填充**，颜色为白色（我们将使用它）。但是，您可以更改它，并从多个填充选项中选择以创建独特的填充图案。

### 小贴士

例如，您可以选择漂亮的栅格或 SVG 纹理，并通过选择**栅格图像填充**或**SVG 填充**分别将它们用作背景图案。否则，您可以选择**渐变**或**形状爆发填充**来尝试一些色彩分级效果。

**导出分辨率**定义了导出地图的 dpi 单位质量。此值越高，地图越好。然而，生成的文件也会更大。对于常见的用途，如出版物、报告和演示图形，`300 dpi`就足够了。当**打印为栅格**切换处于活动状态时，整个作品在导出为`.pdf`之前被转换为栅格。**世界文件打开**切换允许您将包含地理参考信息的`.wld`文件附加到图像导出输出。这意味着您的地图不仅可以用于图形或预览软件，还可以直接在 GIS 软件中打开并正确对齐。

现在，我们将调整用于在地图布局中对齐地图元素的网格：

1.  在**指南和网格**部分，将**网格间距**值设置为`5`毫米以使其更密集，并将**吸附容差**设置为`10`像素（值越高，吸附力越强）。

1.  要显示网格，请激活位于**视图**下的**显示网格**按钮，或者使用*Ctrl* + *'*键盘快捷键。

1.  切换**吸附到网格**，它位于**视图**下，或按*Ctrl* + *Shift* + *'*激活吸附。

    ### 小贴士

    除了使用预定义的网格外，您还可以通过将鼠标箭头放在水平（用于垂直指南）或垂直（用于水平指南）的标尺栏上，并点击并沿页面画布拖动它们来创建自己的指南。禁用**吸附到网格**，并使用**视图**菜单中的各种选项，如**显示/清除**或**吸附到指南**。**智能指南**选项可以帮助您根据您作品中的其他项目自动检测最佳放置位置。

# 添加和自定义地图

在本节中，我们将创建布鲁克林区的人口地图。请确保在主窗口中，以下图层处于活动状态：`布鲁克林区边界`、`zipcode`（带有人口样式）、`NY 区边界`和`水域区域`。

要将地图添加到您的打印布局中，请点击**作曲项目**工具栏中的**添加新地图** ![添加和自定义地图](img/image00367.jpeg) 按钮，并按住鼠标左键的同时，将鼠标箭头以对角线方式拖动到页面上。您将在页面上看到一个矩形，并在其中看到一个地图。

### 注意

注意，地图的内容会动态变化，以反映主窗口中地图画布的内容。这意味着，如果您在主窗口中打开/关闭某些图层或更改它们的样式，打印作曲家窗口中的地图也会发生变化。如果您看不到变化，请点击**刷新视图**![添加和自定义地图](img/image00368.jpeg)按钮以更新地图。我们很快将讨论如何抑制这种行为。

可以通过拖动边框中心和角落的特殊方形标记来移动或调整地图框架的大小。如果您看不到框架和标记，这意味着当前项目是无效的。要激活它，请点击**作曲家项目**工具栏中的**选择/移动项目**![添加和自定义地图](img/image00369.jpeg)按钮。如果您想在框架内移动地图，请使用**作曲家项目**工具栏中的**移动项目内容**按钮，![添加和自定义地图](img/image00370.jpeg)。此外，只要此按钮处于活动状态，您就可以使用鼠标滚轮（或使用*Ctrl*和鼠标滚轮）放大地图。使用标记，以覆盖整个页面的方式扩展地图。

在正确放置地图后，我们可以转到**项目属性**选项卡上的高级选项。此选项卡汇集了几个可以通过点击它们旁边的![添加和自定义地图](img/image00371.jpeg)符号来展开或折叠的分区。

**主要属性**部分允许您从以下地图预览模式中选择：

+   **缓存**: 此模式将在当前屏幕分辨率下渲染地图，在缩放时不会改变，但图像本身将被适当地缩放。

+   **渲染**: 在缩放时，地图的分辨率将调整到最大值。此模式提供了更好的预览图片，但与**缓存**模式相比，速度较慢。

+   **矩形**: 代替地图，将在一个空框中显示`Map will be printed here`消息。

当您在**比例**字段中输入一些值时，地图范围会动态变化。将其值设置为`100000`，并使用**移动项目内容**![添加和自定义地图](img/image00370.jpeg)按钮将地图正确地定位在框架内。以下截图显示了此阶段**项目属性**选项卡的外观：

![添加和自定义地图](img/image00372.jpeg)

使用**地图旋转**字段，您可以定义一个角度（以度为单位），在地图的框架内顺时针旋转地图。请注意，旋转角度将自动应用于网格线，以适当地调整它们与地图内容的关系。有三个切换按钮，它们提供以下选项：

+   当**绘制地图画布项目**切换按钮被激活时，主地图画布窗口中的现有注释将被添加到地图中。

+   如果您不希望打印地图反映主地图画布窗口中做出的更改，**锁定地图项图层**选项非常有用。因此，图层将保持不变，但它们的样式和标签将根据主窗口进行更改。我们激活此选项是因为我们不希望图层组合发生变化。

+   **锁定地图项图层样式**阻止地图项在主地图画布窗口中做出的样式更改。也要激活此选项。与上一个选项一起应用，它允许我们阻止作曲图从主地图画布窗口中的更改（即图层的样式和组合）。

在切换按钮的右侧，有一个**从可见性预设设置图层列表**按钮，![添加和自定义地图](img/image00373.jpeg)。此按钮允许我们从**图层**面板的工具栏上的可见性预设中快速定义地图项内容。要加载预设，请点击按钮右下角的小三角形箭头，并选择要在地图上显示的预设。地图的内容将根据预设和图层自动锁定。

**范围**部分提供了各种选项来定义和调整地图项的范围：

+   手动定义，通过在相应字段中输入**X**和**Y**值。

+   **设置为地图画布范围**：当前地图范围将变为与主地图画布窗口的范围相同。

+   **在地图画布中查看范围**：这与上一个按钮正好相反。它根据当前地图项范围更改主窗口中的地图画布范围。

**由图集控制**部分将在我们讨论*创建图集*部分中的图集生成时再进行介绍。

**网格**部分允许您向地图框架中添加坐标网格和框架。要添加新的网格，请点击![添加和自定义地图](img/image00374.jpeg)按钮，并调整其主要属性，如**网格类型**、**间隔**、**网格框架**、**坐标**等。

### 小贴士

您可以在单个地图项内组合使用不同坐标参考系统的多个网格。只需添加一个额外的网格。然后，在**绘制“网格 2”网格**部分中，点击**CRS**旁边的**更改**按钮，并选择您想要使用的 CRS。此选项的常见用例是将投影 CRS（使用线性测量单位，如英尺和米）与提供经纬度坐标的地理 CRS（以度为单位）组合。

**概述**部分允许您将不同比例的多个概述组合成单个地图组合。这将在*使用地图概述*部分中稍后介绍。

以下部分适用于各种地图项：

+   **位置和大小**部分允许您以页面单位定义项目框架的大小。**参考点**决定 X 和 Y 位置指定的是项目的哪个角落。

+   **旋转字段**值设置项目的旋转角度（以度为单位）。

+   **框架**切换按钮启用项目周围的框架，并提供访问其选项，例如**框架颜色**、**厚度**和**连接样式**。

+   **背景**负责框架的填充颜色。

+   **项目 ID**可用于与网络客户端创建地图项之间的链接，并且也便于在**项目**面板中识别特定项目。

+   **渲染**提供了访问**混合模式**和**透明度**选项，这些选项允许我们应用专业的图形效果。

# 添加和自定义图例

图例是任何地图的必要元素。它解释了图层的符号，并帮助我们阅读和理解地图。要添加图例，请点击**作曲家项目**工具栏中的**添加新图例** ![添加和自定义图例](img/image00375.jpeg) 按钮，并按住鼠标左键的同时，用鼠标箭头斜向拖动页面。您将在页面上看到一个矩形，其中包含一个图例。默认情况下，项目中的所有图层都将包含在图例中，因此它可能看起来太大，无法适应布局。选择图例项后，您可以使用**项目属性**选项卡来自定义其内容和外观。有几个特定的图例部分应该讨论。

**主要属性**部分允许您自定义以下选项：

+   **标题**：默认情况下，使用`图例`标题，但您可以在此处输入任何其他文本，或者留空以删除标题。

+   **标题对齐**：这可以将标题对齐到**左对齐**、**居中对齐**或**右对齐**。

+   **地图**：默认情况下，只有**地图 0**可用，但如果您在单个页面布局中组合多个地图，您可以决定图例将引用哪个地图。

+   **在**此处**换行**：在此处输入一个符号，该符号将用于将长行文本分割成较短的文本块。稍后，您可以在图例项中编辑文本并在此符号处插入，以强制开始新的一行。

**图例项**部分负责图例的内容。默认情况下，**自动更新**模式处于活动状态，所有可用图层都加载到图例中。关闭**自动更新**模式后，图例内容树下面的按钮将被激活，提供以下选项（从左到右）：

+   **向下**![添加和自定义图例](img/image00376.jpeg) 和 **向上**![添加和自定义图例](img/image00377.jpeg) 按钮用于移动项并更改它们的顺序。否则，您可以直接拖放项到新位置。任何更改后，图例的项内容将立即更新。

+   **添加组**![添加和自定义图例](img/image00378.jpeg) 按钮允许您添加新组和子组以构建图例层次结构。

+   **加号**![添加和自定义图例](img/image00374.jpeg) 和 **减号**![添加和自定义图例](img/image00379.jpeg) 按钮负责添加和删除任何项，无论是组还是图层。请注意，只有主地图画布窗口中激活的图层才可用于添加。

+   **编辑**![添加和自定义图例](img/image00380.jpeg) 按钮允许我们更改任何选定项（组、子组、图层或符号标签）的文本。例如，如果您想将长行换行，可以在 **主属性** 部分定义的文本符号中插入。这些更改仅应用于 **打印作曲家图例** 项，不会影响主窗口中的地图项。

+   **总和**![添加和自定义图例](img/image00381.jpeg) 按钮显示矢量图层每个类的要素计数。

+   **过滤**![添加和自定义图例](img/image00382.jpeg) 按钮通过地图内容过滤图例；也就是说，只有显示在地图项中的图例项（图层和类）将被包括在图例中。

在 **字体** 部分中，您可以定义标题、子组、组和项目的通用颜色和不同字体，以增强图例的可读性。如果图例包含许多项目并且太长而无法在单列中显示，它可以在 **列** 部分中拆分。在这里，您可以在 **计数** 字段中定义列数。默认情况下，列宽根据内容进行调整。如果您希望所有列的宽度相等，请激活 **等宽列** 切换。如果 **拆分图层** 模式开启，分类图层符号项将平均分配到各列；否则，不允许将类别移动到另一列。在下面的屏幕截图中，您可以查看这是如何工作的。顶部有一个不允许图层拆分的图例，底部类别在三个列中平均分配。

![添加和自定义图例](img/image00383.jpeg)

在 **符号** 部分中，默认的 **宽度** 和 **高度** 值可以手动修改。**WMS 图例图形** 用于为 WMS 图层添加图例，但这取决于 WMS 服务器是否支持并提供。在对话框窗口中，您可以调整作为栅格图像提供的图例宽度和高度。**间距** 部分允许您通过调整其各种项目（标题、组、子组、符号、图标标签、边界框和列）之间的空间来细化图例布局和可读性。

其他部分，如 **位置和大小**、**旋转**、**框架**、**背景**、**项目 ID** 和 **渲染**，提供与地图项相同的选项。

# 其他地图项

目前，我们的地图包含两个必要的项目：地图本身和解释其内容的图例。然而，还有更多项目可以用来改善其美学观感和地理可读性，例如刻度尺、指向北方的箭头、文本标签等。

## 刻度尺

在添加刻度尺项目之前，请确保您的地图画布使用线性测量单位的投影坐标参考系统（米和英尺）。要添加刻度尺，请单击**作曲项目**工具栏中的**添加新刻度尺** ![刻度尺](img/image00384.jpeg) 按钮，并按住鼠标左键的同时将鼠标箭头拖动到页面上。您将在页面上看到一个矩形和一个刻度尺在其中。选择刻度尺项目后，使用**项目属性**选项卡来定制其外观。

在**主要属性**部分，选择一个地图以将其与刻度尺关联。由于您将只使用一个地图，**地图 0**将默认设置。**样式**下拉列表定义了刻度尺的外观：

+   **单框**或**双框**分别负责刻度尺以单个或双条纹框的形式出现的外观

+   **线刻度中间**、**向下**或**向上**产生一个带有刻度标记的简单水平线，用于固定比例单位

+   **数字**显示比例作为数字比例

    ### 小贴士

    图形刻度尺是表示在演示文稿、报告和出版物中作为图像出现的地图比例的正确方法。建议使用它而不是数字比例尺，因为图形刻度尺在图像缩放时会按比例缩放。如果您仍然需要使用比例尺，请确保图像将以原始大小分布。

为了本教程的目的，请选择**双框样式**。**单位**部分负责正确表示测量单位：

1.  从下拉列表中选择**英尺**投影测量单位。刻度尺将转换为测量英里的条形。类似地，**米**和**海里**也支持转换。**地图单位**可以使用原始地图单位，但您必须指定它们。

1.  在**标签**字段中，输入`mi`以使用测量单位的缩写（在我们的例子中是英里）。

1.  **每条刻度线单位**表示地图单位与刻度线单位的比例。在此处输入`5280`，因为我们知道 1 英里等于 5,280 英尺。

不要担心您的刻度尺看起来奇怪或折叠；我们将在**段**部分中修复它，如以下解释：

1.  在**大小**部分，您应该输入定义段长度的值。如果您想让它有 1 英里长，请输入`5280`；要让它有 2 英里长，请输入`10560`（*5,280×2*）；依此类推。原理很简单——只需使用**每****刻度单位****地图单位**比例，您在**主要属性**部分中输入的，并将其乘以应在一段中包含的刻度单位数。为了本教程的目的，我们将一个段设为 1 英里，并输入一个值为`5280`。

1.  在**段**中，为**左**输入值`2`，为**右**输入值`1`。

1.  将刻度尺的**高度**值增加到`5`毫米。

在**显示**部分，您可以自定义以下刻度尺属性：

+   **框边距**：此值越大，刻度尺项目内容与其边界框边界的距离就越长。

+   **标签边距**：这定义了刻度尺与文本标签之间的空间。

+   **线宽**：这定义了刻度尺轮廓的宽度。

+   **连接样式**：这定义了刻度尺角落的外观。它仅适用于框型刻度尺。

+   **端头样式**：这定义了线条末尾的外观。它仅适用于线型刻度尺。

+   **对齐**：这将对刻度尺及其标签在边界框内的对齐进行设置。它仅适用于数字刻度类型。

**字体和颜色**部分提供了相应的功能。要更改字体或颜色，请点击按钮并从对话框窗口中选择必要的项目。请注意，**填充颜色**和**次要填充颜色**仅适用于框型刻度尺。在下面的屏幕截图中，您可以看到一个简单的**双框**刻度尺示例，左侧有两个段，右侧有一个段：

![刻度尺](img/image00385.jpeg)

**位置和大小**、**旋转**、**框架**、**背景**、**项目 ID**和**渲染**等部分提供了与地图项目相同的选项。

## 北箭头

要添加北箭头，请点击**作曲工具栏中的**![北箭头](img/image00386.jpeg)**添加图像**按钮，并按住鼠标左键拖动鼠标箭头到页面上。您将在页面上看到一个空矩形。选择**图像项目**后，使用**项目属性**选项卡来定制其外观。

首先，您应该导航到您想要使用的**图像源**文件：

1.  展开**搜索目录**部分。在此部分中，您可以设置**图像搜索路径**。默认情况下，您将看到`QGIS 安装路径\qgis\svg\`路径及其子文件夹。您可以使用**删除**和**添加**按钮重新定义路径，并访问您自己的图像。

1.  在**加载预览...**窗口中，您将看到可用图像的缩略图，如下面的截图所示。点击它们会自动将它们加载到图像项框架中。为了本教程的目的，我们选择`NorthArrow_02.svg`。![北箭头](img/image00387.jpeg)

现在您已经选择了北箭头，您可以调整其一些**主要属性**。**调整模式**定义了在框架内调整图像的方法：

+   **缩放**：图像将被调整到框架中，并且其比例将被保存。

+   **拉伸**：图像将在框架内拉伸，忽略其比例。

+   **剪辑**：图像将被调整到其原始大小，框架将用于剪辑图像，因此只有其中的一部分将是可见的。此模式仅适用于位图图像。

+   **缩放和调整框架**：图像和框架都将调整大小以适应彼此。首先，图像将按比例调整以适应框架，然后框架将调整以包含图像。

+   **调整框架到图像大小**：框架将被调整到原始图像大小。

为了本教程的目的，我们将使用**缩放和调整框架**模式。在此模式下，**放置**选项不可用，但您可以在选择**缩放**和**剪辑**模式时使用它来在框架内定位图像。同样，**图像旋转**也适用于**缩放**和**缩放和调整框架**模式。如果您想将北箭头与地图同步旋转，请激活**与地图同步**切换按钮。

其他部分，如**位置和大小**、**旋转**、**框架**、**背景**、**项目 ID**和**渲染**，提供了与地图项相同的选项。

## 其他项

到目前为止，我们只介绍了最重要的和必要的地图项。您可能已经注意到，**项目项**面板提供了访问更多项的途径，如下所示：

+   **标签项**![其他项](img/image00388.jpeg)：这提供了对文本（或 HTML）标签及其各种属性的控制，例如**字体**、**字体颜色**、**垂直**和**水平**（对齐）、**位置和大小**、**旋转**等。

+   **形状项**![其他项](img/image00389.jpeg)：这允许您向布局添加简单的几何图形，例如矩形、三角形或椭圆。在**项目属性**选项卡中，您可以更改它们的类型、样式和其他基本选项，例如**位置和大小**、**旋转**、**框架**、**背景**、**项目 ID**和**渲染**。

+   **箭头项**![其他项](img/image00390.jpeg)：这是一个非常有用的元素，用于突出多个地图和概述之间的关系。在**项目属性**选项卡中，您可以选择**线条样式**、**箭头轮廓**和**填充颜色**、**箭头轮廓**和**宽度**，以及**起始**和**结束标记**。

+   **属性表项目**![其他项目](img/image00391.jpeg)：此项目将矢量图层属性表添加到地图布局中。如果您想这样做，请选择**项目属性**标签页下的**图层**。通过点击**属性**按钮，您将被带到**选择属性**窗口，在那里您可以通过添加或删除不必要的列；更改标题、列对齐和宽度；以及应用排序选项来修改表格的结构和外观。![其他项目](img/image00392.jpeg)对于此项目，您还可以应用**特征过滤**以排除不必要的或多余的元素。在**外观**和**字体和文本样式**部分，您可以找到各种增强表格可读性的选项。

+   **HTML 框架项目**![其他项目](img/image00393.jpeg)：这负责使用 HTML 标记添加网页或用户生成的内容。例如，您可以在**源**窗口中输入以下表达式：`地图数据由<a href='https://nycopendata.socrata.com/'>纽约开放数据门户</a>提供`。这将在原始网站添加一个链接。

当一切准备就绪时，您可以通过菜单导出您的地图，导航到**组合器** | **导出为图像**或**导出为 SVG**或**导出为 PDF**，或者通过点击**组合器**工具栏中的相关按钮，其中![其他项目](img/image00394.jpeg)负责图像导出，![其他项目](img/image00395.jpeg)用于导出为 SVG，![其他项目](img/image00396.jpeg)用于导出为 PDF。

![其他项目](img/image00397.jpeg)

在打印组合器中创建的简单地图示例

# 与多张地图和概览一起工作

有时，需要在单个布局中结合多张地图。例如，假设您需要在单页上结合几张不同的地图，或者在一个大区域内显示感兴趣区域的地理位置。虽然这些任务看起来相似，但它们需要略微不同的解决方案，我们将在以下章节中探讨。

## 在单个打印组合器中结合多张地图

在我们的示例中，我们将结合两张地图——地形图和飓风疏散区域图——并在单个打印布局中完成：

1.  在主窗口中，激活将在地形图中使用的图层——“布鲁克林区边界”、“纽约区边界”、“水域”（以正确显示海岸线和水体），最后是“阴影”和“海拔高度，英尺”。

1.  然后，打开**新打印组合器**窗口，无论是从**项目**菜单还是使用*Ctrl* + *Shift* + *P*键盘快捷键。为此示例调整**页面大小**为**A3**，将**网格间距**设置为`5`毫米，并从**视图**菜单激活**显示网格**和**吸附到网格**选项。

1.  在**项目属性**标签页的**位置和大小**部分添加一个新的地图项目，并调整其大小为`200×200`毫米。将比例设置为`100000`并正确放置地图内容。之后，激活以下切换按钮以防止更改地图内容：

    +   **锁定地图项目图层**

    +   **锁定地图项目样式**

1.  添加并调整其他必要的地图元素，例如比例尺、图例、北箭头等。创建图例，移除不必要的图层。如果您想阻止某些项目发生变化，请在**项目**面板中锁定它们，如图所示：![在单个打印作曲家内组合多个地图](img/image00398.jpeg)

1.  当您完成等高线地图及其元素后，转到主地图画布窗口并激活您想在地图上显示的图层。例如，激活`飓风疏散区域`和`主要住宅区划`，并停用`阴影`和`海拔高度，ft`。

1.  添加一个新的地图项目并重复步骤 3 和 4。完成后，结果可能看起来像以下屏幕截图所示：![在单个打印作曲家内组合多个地图](img/image00399.jpeg)

您可以在单个布局中组合任意数量的地图，并为它们使用不同的比例尺和单独的图例。您应该始终记住的是使用**锁定地图项目（样式）**以防止对地图进行任何更改。

当您需要在单页内展示类似地图时，这种方法简单且有效，但有时需要在不同缩放级别上展示不同的感兴趣区域，并将它们的范围相互关联。在这种情况下，您应该使用所谓的地图概览。

## 使用地图概览

地图概览在单个布局中关联多个地图范围，并且对于展示感兴趣区域与更大的空间背景之间的关系非常有用，例如，一个国家内的一个地区，一个城市区域内的一个区，等等。

在本例中，我们将结合三个概览到一个单个地图布局中，以展示布鲁克林与整个纽约的关系，以及布鲁克林内的感兴趣区域与该区范围的关系。为了实现这一点，您需要执行以下步骤：

1.  在主地图画布窗口中，激活`NY 地区边界`图层并停用所有其他图层。创建一个新的打印作曲家，使用默认的**A4**页面大小，并调整任何其他所需的属性。将一个新的地图项目添加到布局中。此地图将用于显示简单的边界并为主地图提供空间背景，因此它可能被包含在一个小 95 x 95 mm 的框架中，比例为 1:515,000。在调整地图视图后，不要忘记选择**锁定地图项目图层**和**锁定地图项目样式**。

1.  现在，您将添加主地图，它将是布局的核心。在主地图画布窗口中，激活您想在地图上显示的图层（例如，`飓风疏散区域`和`主要住宅区划`）。再次，将一个新的地图项目添加到布局中并调整其大小、比例和位置。例如，它可能是 200 x 200 mm，比例为 1:97,000。再次，使用**锁定地图项目图层**和**锁定地图项目样式**。

1.  最后，添加第三个地图。在主地图画布窗口中激活您希望在地图中显示的图层（例如，`hillshade`和`height a.s.l., ft`）。添加一个新的地图元素。调整地图大小为 95 x 95 毫米，并将比例设置为`20000`。移动项目内容以显示您感兴趣的区域，并选择**锁定地图元素图层**。

1.  现在，我们需要将地图范围相互关联。我们可以通过概述来实现这一点。激活您添加的第一个地图元素，并在**项目属性**选项卡下展开**概述**部分。要添加新的概述，请点击![使用地图概述](img/image00374.jpeg)按钮，要将其显示在地图上，请激活**绘制“名称”概述**切换按钮。要将概述与地图元素范围关联，从**地图框架**下拉列表中选择地图。您可以使用**符号选择器**对话框窗口更改默认的**框架样式**。![使用地图概述](img/image00400.jpeg)**混合模式**在组合多个概述框架时非常有用，可以实现更时尚的效果。**反转概述**切换按钮将反转概述区域外的填充。**居中于概述**将地图元素内容移动到放置概述的中心。使用![使用地图概述](img/image00374.jpeg)按钮添加另一个包含**地图框架**且范围较小的概述。您可以根据需要组合任意数量的概述。使用![使用地图概述](img/image00379.jpeg)按钮删除不必要的概述，以及使用![使用地图概述](img/image00377.jpeg)和![使用地图概述](img/image00376.jpeg)按钮重新排序它们。

1.  前往另一个地图并为其添加一个概述。选择您感兴趣的地图元素，并转到其**属性**选项卡。展开**概述**部分，点击![使用地图概述](img/image00374.jpeg)按钮以添加概述。从**地图框架**下拉列表中选择必要的地图，并调整概述的**框架样式**。

    ### 小贴士

    QGIS 使您能够组合多个概述并生成复杂的结果。为了突出不同概述之间的差异和关系，请使用单个地图框架和比例尺。

在下面的屏幕截图中，您可以查看生成的地图。它结合了三个地图元素，并关联了它们的范围和概述。

![使用地图概述](img/image00401.jpeg)

## 创建图集

在 QGIS 中，图谱是通过自动化的图谱生成功能创建的多页地图。图谱背后的理念非常简单——用户通常需要生成多个小地图，而不是一个大地图。为了在多个页面中正确排列多个地图，使用图谱覆盖层。此覆盖层可能包含各种类型的几何体（点、线和多边形），用于定义地图的一般范围、单独页面的范围、它们的数量和它们的顺序。图谱最常见的一个例子是将一个大区域（例如，一个国家、地区或流域盆地）根据其子单位（例如，地区、州、县或子流域）分成几个部分。

在本示例教程中，我们将使用`zipcode`图层元素作为多个地图的边界范围，生成多个街道网络地图。此外，我们将使用专门设计的插件来遮罩所有排除区域，并实现时尚的制图效果：

1.  首先，我们启用我们将从中创建地图的图层：`布鲁克林地区边界`、`zipcode`、`水域面积`、`公园`和`道路`。

1.  为了本教程的目的，我们将使用外部**遮罩**插件。此插件允许用户创建地图遮罩层，并过滤其他层的标签，移除位于兴趣区域外的标签。它还能够与图谱生成过程交互。按照第一章中所述，*处理您的数据*，安装并激活**遮罩**插件。

1.  当插件被激活时，我们需要提供它基于哪些图层特征进行遮罩。在我们的案例中，这将是指`zipcode`。激活它。然后，使用**按区域或单击选择特征**![创建图谱](img/image00402.jpeg)模式，点击地图画布以选择任何特征。

1.  一旦选定的多边形被突出显示，请转到**插件** | **遮罩** | **创建遮罩**并打开**创建遮罩**对话框。在此窗口中，您可以定义遮罩的以下属性：

    +   **遮罩多边形的样式**，默认使用**反转多边形渲染器**和**形状爆发填充**选项，通过**透明度**进行修改。

    +   **缓冲区**切换会在兴趣区域周围生成一个缓冲区，其宽度和复杂性由**单位**和**段数**值定义。

    +   在表达式中所使用的遮罩几何体使用即时简化。值越高，几何体越粗糙。

    +   **用于多边形标签过滤的函数**定义了如何确切地消除遮罩多边形外的标签。

    +   **用于线标签过滤的函数**定义了线标签的排除模式。从下拉列表中选择**遮罩几何包含线**。在可用图层列表中激活`roads`（注意，只有当其标签开启时此图层才可用）。

    +   激活**另存为**切换按钮，并导航到您想要保存新创建的掩膜层的目录。否则，将创建一个所谓的内存（临时）层，并且在关闭项目后不会保存。

    ![创建图集](img/image00403.jpeg)

1.  在您点击**确定**后，掩膜层将出现在图层面板中，您将看到其应用于地图画布上的华丽样式效果。选定的多边形要素看起来被突出显示，而外围地图则变暗。此外，标签仅出现在掩膜要素内。现在我们可以禁用`zipcode`层，因为我们不希望其边界显示在生成的地图上，然后转到打印编者以生成图集。

1.  打开一个新的打印编者，并向其中添加一个新地图项以及您想要包含在布局中的任何其他项。在我们的示例中，我们将使用以下内容：

    +   自定义页面大小等于 200 x 200 毫米。

    +   路网地图项具有相同的尺寸，200 x 200 毫米，比例尺为 1: 20000。不要锁定此地图项的图层，因为它将在图集中动态更改。

    +   在右上角添加一个小的 50 x 50 毫米地图项，其中包含`New York borough boundaries`层，并添加一个概述。在创建此地图后，锁定其图层及其样式。

    +   现在，您可以回到主窗口并激活对路网地图必要的图层。

1.  在调整所有必要的项目后，转到**图集生成**选项卡并激活**生成图集**切换按钮。

1.  **配置**部分提供了以下选项来配置从其覆盖层生成的图集：

    +   从**覆盖层**下拉列表中选择`zipcode`。您可以从此列表中选择任何图层，并使用其特征来迭代它们并创建图集页面。

    +   当**隐藏覆盖层**处于活动状态时，覆盖层在地图上不会显示。在我们的案例中，我们不使用它，因为我们已经禁用了覆盖层。

    +   在**筛选条件**区域，您可以创建一个表达式来仅从覆盖区域选择某些要素。例如，您可以使用面积大于某个预定义值的多边形。

1.  **输出**部分通过以下选项提供了对结果的控制：

    +   **输出文件名表达式**是一个模板，将用于命名多个输出文件。

    +   **尽可能生成单个文件**在可能的情况下生成单个多页文件（适用于导出到`.pdf`）。如果此选项处于活动状态，则**输出文件名表达式**不适用。

    +   **排序方式**选项提供了访问覆盖层属性字段名称的权限，您可以选择其中的任何一个来按字段值升序或降序排序输出文件，旁边有箭头按钮。

1.  返回到**项目属性**选项卡。请注意，应选择包含主地图（路网）的地图项。激活**由图集控制**部分，您可以从以下选项中进行选择：

    +   **要素周围边距**：你可以为单个地图集页面上映射的每个要素设置周围区域的大小。这意味着地图范围和比例将不会固定。它们将调整以包含要素及其设置的边距。我们选择此选项并设置值为`5`百分比。

    +   **预定义比例尺（最佳匹配）**：项目的一个预定义比例尺，最适合将要素放入地图集页面中将被使用。

    +   **固定比例尺**：每个要素将以相同的比例显示，地图页面将自动围绕它居中。当你需要打印多个相同比例的地图时，这非常有用。

1.  现在，一切准备就绪，你可以生成和预览地图集。你会注意到**预览地图集**按钮在**地图集**工具栏中是激活的。点击它来生成你的地图集。当生成过程完成后，你会看到工具栏上的其他按钮也变得激活了。点击它们来预览地图集页面。![创建地图集](img/image00404.jpeg)使用工具栏按钮，你不仅可以探索你的地图集，它包含几分钟内创建的多个页面，还可以快速访问**打印**![创建地图集](img/image00405.jpeg)、**导出**和**设置**![创建地图集](img/image00406.jpeg)选项。**导出**选项显示在本截图上：![创建地图集](img/image00407.jpeg)

在以下截图上，你可以看到一个单页地图集的示例：

![创建地图集](img/image00408.jpeg)

# 管理打印作曲家

初学者通常忘记应用地图锁定选项，经常从头开始创建每个地图。结果，他们被多个地图作曲家所压倒，这些地图作曲家中的地图会永久性地改变。如果你想节省时间，那么使用**锁定地图项图层**和**锁定地图项样式**来阻止地图中的不希望的变化是明智的。

你可以在单个项目中存储多个地图和地图集，并通过转到**项目** | **打印作曲家**来访问它们。在**项目**下的**打印作曲家管理器**中提供了高级选项。

![管理打印作曲家](img/image00409.jpeg)

### 小贴士

在**作曲家管理器**中，你可以从模板创建一个新的打印作曲家。任何地图布局都可以从打印作曲家的菜单**作曲家** | **另存为模板**保存为模板。

# 摘要

在本章中，你学习了基本地图元素及其与打印作曲家的配置。现在你知道 QGIS 不仅是一个创建简单打印地图的强大工具，而且还提供了将多个地图组合成一个布局、通过概述关联它们以及最终通过几点击生成多页地图集的复杂选项。

虽然打印地图非常有用，但如果你更喜欢在线分享你的结果，它们效率不高。在下一章中，你将学习如何快速有效地在线发布你的数据。
