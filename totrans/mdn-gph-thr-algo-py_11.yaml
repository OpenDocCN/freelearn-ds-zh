- en: '7'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Goods Prices/Sales Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we’ll combine spatial and temporal approaches to **spatiotemporal
    data**—data that includes both spatial components and time series components.
    To handle the time components, we’ll slice our datasets into overlapping time
    windows as we did with our stock data in [*Chapter 6*](B21087_06.xhtml#_idTextAnchor078).
    To handle the spatial components, we’ll calculate local Moran statistics based
    on correlations for each time slice and threshold the value to create a network
    for that time slice. Then, we’ll look at changes in **Forman-Ricci curvature centrality**
    and **PageRank centrality** across slices of time and space. Examples include
    the Burkina Faso millet dataset first seen in [*Chapter 2*](B21087_02.xhtml#_idTextAnchor028)
    and a new store sales dataset.
  prefs: []
  type: TYPE_NORMAL
- en: By the end of this chapter, you’ll understand how to set up spatiotemporal data
    analytics with networks to capture changes over time within the spatial and temporal
    relationships of the datasets using **igraph** and different types of plots to
    look at spatial relationships within slices of time.
  prefs: []
  type: TYPE_NORMAL
- en: 'In particular, we will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: An introduction to spatiotemporal data
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing our spatiotemporal data
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You will require Jupyter Notebook to run the practical examples in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: 'The code for this chapter is available here: [https://github.com/PacktPublishing/Modern-Graph-Theory-Algorithms-with-Python](https://github.com/PacktPublishing/Modern-Graph-Theory-Algorithms-with-Python)'
  prefs: []
  type: TYPE_NORMAL
- en: An introduction to spatiotemporal data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In [*Chapter 2*](B21087_02.xhtml#_idTextAnchor028), we discussed some aspects
    of spatial and temporal data that make such data difficult to wrangle, analyze,
    and scale with statistical and machine learning methods. Recall that both types
    of data are not independent, with dependencies crossing either space or time in
    the dataset. Alternative approaches to prediction are needed, and representations
    of spatial and temporal data as a network allow analysts to leverage the tools
    of network science to find change points, mine for patterns, and even predict
    future system behavior in the case of temporal data. In the previous chapters,
    we’ve learned how to analyze both spatial and temporal data with network science
    tools such as centrality to understand important trends.
  prefs: []
  type: TYPE_NORMAL
- en: Many analytic tasks in the real world involve spatiotemporal data—including
    the analysis of world stock markets influenced by local policies, data mining
    of store data across locations for trends in customer behavior and revenue, discerning
    disease sources and population vulnerabilities during an epidemic, tracking human
    behavior (such as crime, eating habits, substance use, birth rates, or terrorism)
    across countries or regions of a specific country, and demonstrating the effects
    of climate change across vulnerable countries.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s get acquainted with our two datasets and problems relevant to many applications
    of spatiotemporal data.
  prefs: []
  type: TYPE_NORMAL
- en: The Burkina Faso market dataset
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In [*Chapter 2*](B21087_02.xhtml#_idTextAnchor028), we introduced the Burkina
    Faso market dataset, which recorded market millet prices across the country from
    Quarter 2 of 2015 to Quarter 2 of 2022\. During this period, world grain prices
    fluctuated due to COVID-19 supply chain issues and the Ukraine conflict limiting
    food distribution and aid. Food security is a major issue in many regions of the
    world, and understanding what might cause prices to soar out of reach for the
    average person or family is critical in meeting the world’s food needs and avoiding
    famine.
  prefs: []
  type: TYPE_NORMAL
- en: Some regions of a country may be more vulnerable to food shortages or soaring
    costs of goods than others, and the spatial features in our dataset capture these
    for the Burkina Faso markets. We’d imagine a rural market (such as the one shown
    in *Figure 7**.1*) would face greater pricing and availability instability than
    a market in the heart of a city such as Ouagadougou. In addition, some events
    within a period may cause more pricing volatility than other events in that same
    period. Capturing the time series trends is also important to understand the causes
    and potential effects of events on grain prices in the region. Thus, capturing
    the data as spatiotemporal data allows us to analyze both trends across locations
    and across time.
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.1 – An illustration of a rural market in Burkina Faso](img/B21087_07_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.1 – An illustration of a rural market in Burkina Faso
  prefs: []
  type: TYPE_NORMAL
- en: To capture spatial trends, we’ll return to the weight matrix introduced in [*Chapter
    2*](B21087_02.xhtml#_idTextAnchor028), which connected markets located in provinces
    that share a border. This roughly captures the geography of Burkina Faso, allowing
    regions that share many borders the potential to influence each other’s pricing
    and demonstrating the potential supply chain issues related to remote regions
    of the country.
  prefs: []
  type: TYPE_NORMAL
- en: Just as pricing can change over time and geography, so can sales volumes. Let’s
    turn to our next example and explore how sales can change across stores due to
    COVID-19 changes in work policies and the movements of populations across a city.
  prefs: []
  type: TYPE_NORMAL
- en: Store sales data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s consider a local chain of printer supply stores in a medium-sized city.
    As populations change near store locations, it may be necessary to pivot business
    strategy: closing stores that are struggling to minimize real estate costs, preferentially
    stocking certain stores that are doing well, and opening new locations in high-volume
    sales areas. Perhaps work-from-home initiatives during COVID-19 have resulted
    in more people working from home in certain areas of the city and more people
    moving to certain areas as they have the freedom to live where they would like
    to live rather than live close to their offices. Perhaps return-to-office initiatives
    also impact demand for home office supplies. All these factors can impact the
    printer supply stores and change quickly.'
  prefs: []
  type: TYPE_NORMAL
- en: 'To explore this further, we’ve created a simulated dataset with sales from
    four stores serving a single metropolitan area that mimic the population movement
    trends heralded by COVID-19 policies and subsequent waffling on return-to-office
    versus remote work policies. Let’s say Store 1 (*Figure 7**.2*) serves a population
    that mainly works in nursing, grocery store management, and other jobs that do
    not stay remote for very long. This area also has temporary school closures. We’d
    expect to see a bump in sales initially during COVID-19 lockdowns but a quick
    return-to-normal pattern of sales:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.2 – An illustration of a printer supply store – Store 1](img/B21087_07_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.2 – An illustration of a printer supply store – Store 1
  prefs: []
  type: TYPE_NORMAL
- en: However, Store 2 is located near the downtown area and serves a population of
    mostly mid-level technical workers, who largely don’t fall under return-to-work
    policies once they are fully remote. Thus, sales spike during the initial lockdown
    and stabilize to the new normal for that area of town.
  prefs: []
  type: TYPE_NORMAL
- en: 'Store 3 serves a very desirable suburb near the downtown area mainly comprised
    of high-earning professionals who either worked from home or went into the office
    regularly before COVID-19\. The commute is typically long, but the school system
    and safety of the neighborhood are excellent. During COVID-19, this suburb experienced
    a real estate boom as families elsewhere in the state decided to settle in that
    area now that they could work from home. Thus, by 2023, the area will have a large
    remote-worker population in need of printer supplies. Store 3 may need a larger
    space by 2023, as shown in *Figure 7**.3*:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.3 – An illustration of a warehouse of printer supplies](img/B21087_07_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.3 – An illustration of a warehouse of printer supplies
  prefs: []
  type: TYPE_NORMAL
- en: 'Store 4, however, serves the downtown area, which experiences a dramatic population
    loss as young families who like the convenience of a short commute move to the
    suburbs. Return-to-work policies don’t attract workers back to condos in the downtown
    areas, leaving most buildings partially empty or inhabited by seasonal residents.
    Ideally, we’d like to avoid a pile-up of supplies and no potential clients (*Figure
    7**.4*):'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.4 – An illustration of an abandoned printer supply store with no
    customers](img/B21087_07_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.4 – An illustration of an abandoned printer supply store with no customers
  prefs: []
  type: TYPE_NORMAL
- en: Our goal is to spot trends as they happen to pivot business strategy as quickly
    as possible to meet growing regional demands for supplies and to minimize real
    estate expenses as rents soar in our metro area. Given that these stores share
    a geography, we’ll assume that the spatial weight matrix connects all four stores
    to each other. In a larger chain of stores, creating spatial weights based on
    demographic characteristics or distance from other stores might hone the analysis.
  prefs: []
  type: TYPE_NORMAL
- en: For now, let’s turn our attention to the code that will help us find insights
    into our Burkina Faso market data and our COVID-19 store sales data.
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing our spatiotemporal datasets
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Our Burkina Faso market dataset is conveniently broken into quarters, and to
    understand quarter-by-quarter changes, it makes sense to set our window size as
    four quarters (a year) with a three-quarter overlap (to focus on monthly changes).
    As we did in [*Chapter 2*](B21087_02.xhtml#_idTextAnchor028), we’ll calculate
    the local Moran statistic through the weight matrix and correlation metric. Let’s
    set up our needed packages and import our Burkina Faso Market dataset plus its
    weight matrix with `Script 7.1`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Now that we have our data and packages, let’s calculate the Forman-Ricci curvature
    and PageRank centrality and save the network and overall metrics for each time
    slice by adding to `Script 7.1` with a correlation threshold set to `0.9` (for
    maximum sensitivity to major changes):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Now that we have our metrics calculated, let’s plot the results to see how
    PageRank and Forman-Ricci curvature centrality vary over time by adding to `Script
    7.1`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: This should show a plot with very little variance in PageRank centrality but
    an increase and cyclical fluctuation of Forman-Ricci curvature centrality (*Figure
    7**.5*). This suggests that the volatility of millet prices increased over our
    markets, starting sometime around 2018-2019 (where volatility increased, then
    decreased, then increased again before leveling off at a higher volatility level)
    and got a bit worse during COVID-19 and the Ukraine conflict.
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.5 – A plot of average centrality metrics from 2015-2022 on the Burkina
    Faso market millet prices](img/B21087_07_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.5 – A plot of average centrality metrics from 2015-2022 on the Burkina
    Faso market millet prices
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that we have a plot showing changes in volatility, we can investigate what
    our markets look like at different periods. You may wish to investigate all periods,
    but we’ll compare two periods—one with low volatility and one with high volatility—and
    show them in the following code. Let’s plot time period `4`, where volatility
    was low according to Forman-Ricci curvature centrality (highest centrality measurement
    in the dataset), and the size of each vertex is weighted by Forman-Ricci curvature
    for that vertex, by adding to `Script 7.1`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'This should yield a plot like *Figure 7**.6*, showing very few markets connected
    by correlation and spatial weighting and very low Forman-Ricci curvature for vertices
    (very small vertex sizes):'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.6 – A plot showing markets connected by correlation >0.9 within
    the same geographical area weighted by Forman-Ricci curvature centrality](img/B21087_07_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.6 – A plot showing markets connected by correlation >0.9 within the
    same geographical area weighted by Forman-Ricci curvature centrality
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 7**.6* shows that most markets are not connected to each other, and
    those that are connected to each other tend to have very little mutual connectivity,
    yielding Forman-Ricci curvature centrality metrics near `0`. This means that prices
    are independent, suggesting a robust network of markets that are unlikely to be
    highly impacted by external factors such as COVID-19 or international trade changes.
    Changes that impact one or two markets are unlikely to impact all of the country’s
    markets, and sellers and consumers impacted by local issues (such as a dry quarter)
    can seek grain from a neighboring area if needed. The government can also address
    shortages by simply moving excess grain from one province with a good supply to
    another with supply issues. Fixing local issues with supplies won’t take much
    time or money from a government perspective.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s examine a period of higher volatility (the 19th period) and see how connectivity
    and Forman-Ricci curvature centrality compared to time period `4` by adding to
    `Script 7.1`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: This should yield a plot like *Figure 7**.7*, where many markets are connected
    to each other mutually, yielding Forman-Ricci curvature centrality metrics much
    further from zero, suggesting highly interconnected supply chains across large
    regions of the country that are vulnerable to large shortages that could cause
    a famine in the area. Addressing these issues will cost the government much more
    in terms of time and cost, leaving people vulnerable to food shortages or price
    spikes that make grain unaffordable for consumers.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs: []
  type: TYPE_NORMAL
- en: Some connected markets share many mutual connections, yielding strong curvature
    metrics, while some markets remain unconnected to any other market. The less-connected
    market prices suggest some areas are less vulnerable to widespread grain price
    spikes or shortages that would cause a famine.
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.7 – The 19th time period in the Burkina Faso market millet price
    network](img/B21087_07_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.7 – The 19th time period in the Burkina Faso market millet price network
  prefs: []
  type: TYPE_NORMAL
- en: From our analyses, we can glean some insight into our market price behaviors
    over time. Prior to 2017, prices showed less volatility across markets. Individual
    markets weren’t as tightly coupled with respect to price, suggesting local impacts
    on pricing. However, as markets became more dependent on global forces with respect
    to price, the markets became more volatile and susceptible to the impact of world
    events, such as COVID-19 and the Ukraine conflict. Indeed, in our raw dataset,
    we can see prices soaring after these events. This suggests that country-wide
    approaches are needed to address rising food prices, rather than focus on local
    markets that are struggling or vulnerable to changes in local production or global
    aid.
  prefs: []
  type: TYPE_NORMAL
- en: Looking at historical changes through the **United States Agency for International
    Development** (**USAID**) database and articles found on Google, we see that 2010-2020
    was a period of development and international food aid in Burkina Faso, though
    many in the country relied mainly on subsistence farming rather than food purchased
    at markets. Given the rising prices, it is not surprising that subsistence farming
    and food aid were necessary, as grain prices reached crisis levels.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that we’ve seen how to analyze spatiotemporal data to visualize trends
    of volatility, let’s turn our attention to the four stores impacted by work-from-home
    and return-to-office policies in a localized city. We’ll ignore weighting, as
    these stores are in the same area and include only four stores. We’ll use a threshold
    of `0.9` again to maximize our chances of finding extremely volatile periods in
    the data. Let’s import our data with `Script 7.2` and get started:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'We’ll calculate Forman-Ricci curvature and PageRank centrality for this network
    by adding to `Script 7.2`; don’t worry if you encounter a runtime warning, as
    it may appear for Windows machines but does not indicate a problem running your
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Again, we can plot PageRank and Forman-Ricci curvature centrality to identify
    periods of high and low volatility by adding to `Script 7.2`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: You should see a plot similar to *Figure 7**.8*, where volatility overall is
    fairly constant over the time period, with a few periods of increasing or decreasing
    volatility marking periods where pricing may be influenced by outside factors
    that our store managers cannot control.
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.8 – A plot of PageRank and Forman-Ricci curvature averages](img/B21087_07_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.8 – A plot of PageRank and Forman-Ricci curvature averages
  prefs: []
  type: TYPE_NORMAL
- en: 'While we wouldn’t expect major changes from period to period in volatility
    to show up in network plots for each period, we do see some differences in volatility
    that are worth investigating. Let’s again choose two periods to investigate (period
    `10` and period `30`). We’ll investigate period `10` first by adding to `Script
    7.2`, weighting our vertices by Forman-Ricci curvature to visualize the interconnectivity
    of sales:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: This should show a plot like *Figure 7**.9*, where only two stores are connected
    to each other, suggesting a period of relative stability where outside influences
    shouldn’t impact sales across our stores as much as in other periods that are
    more volatile.
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.9 – A plot of our stores from period 10](img/B21087_07_09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.9 – A plot of our stores from period 10
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s compare this plot with period `30`’s plot by adding to `Script 7.2`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'This code should produce a plot similar to *Figure 7**.10*, showing connectivity
    across all four stores (maximum possible volatility), which leaves stores vulnerable
    to events that might impact sales across all four stores instead of impacting
    only one local store:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.10 – A network plot of our store data from period 30 showing maximal
    volatility](img/B21087_07_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.10 – A network plot of our store data from period 30 showing maximal
    volatility
  prefs: []
  type: TYPE_NORMAL
- en: Taken together, our results suggest volatility is fairly constant for our stores
    a few months prior to COVID-19 and increases upon the work-from-home mandates,
    continuing more or less through return-to-work policies. From our raw simulation
    data, some stores benefit from this change, while other stores suffer quite a
    bit. As volatility changes, store managers need to focus on factors they can control
    regarding their individual stores, and the manager overseeing all stores in the
    area may need to strategize on how to pivot supplies and growth needs of growing
    stores while considering the consolidation of buildings for those struggling stores.
  prefs: []
  type: TYPE_NORMAL
- en: Overall, these analyses provide some insight into pricing and sales vulnerability
    over times of crisis, allowing decision makers to pinpoint times requiring strategy
    pivots. Combined with other analytics (such as time series forecasting through
    multichannel singular spectrum analysis, for instance, or information on demographic
    or time-of-day differences in buying behavior), these types of analyses add insight
    into the timing and specific geographies that require attention to continue thriving
    in changing times.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we extended our prior insights on temporal and spatial data
    to tackle analytics problems with spatiotemporal datasets, including a store sales
    dataset and a Burkina Faso market millet price dataset. We sliced our two datasets
    by time, calculated spatial statistics, and analyzed network centrality metrics
    to identify changepoints and periods of volatility in our data. Periods of volatility
    correspond to network vulnerability to crashes and spikes in prices, sales, and
    other metrics, as the interconnectedness of the system allows for effects on one
    part of the network to spill into other parts of the network. We saw this at play
    during COVID-19 and the Ukraine conflict for Burkina Faso’s markets, as well as
    the impacts of COVID-19 on the sales data. In [*Chapter 7*](B21087_07.xhtml#_idTextAnchor088),
    we'll look at sales and goods pricing across both time and geography to see how
    network science can solve problems in spatiotemporal data. In [*Chapter 8*](B21087_08.xhtml#_idTextAnchor097),
    we'll consider dynamic networks, where connections and even individuals can change
    over time, and examine how these changes impact disease spread in wildlife populations.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Han, X., Zhu, G., Zhao, L., Du, R., Wang, Y., Chen, Z., ... & He, S. (2023).
    *Ollivier–Ricci Curvature Based Spatio-Temporal Graph Neural Networks for Traffic
    Flow Forecasting*. *Symmetry*, *15* (5), 995.
  prefs: []
  type: TYPE_NORMAL
- en: Schlör, J., Strnad, F. M., Fröhlich, C., & Goswami, B. (2022, May). *Identifying
    patterns of teleconnections, a curvature-based network analysis*. In *EGU General
    Assembly Conference Abstracts* (pp. EGU22-7256).
  prefs: []
  type: TYPE_NORMAL
- en: 'Shekhar, S., Jiang, Z., Ali, R. Y., Eftelioglu, E., Tang, X., Gunturi, V. M.,
    & Zhou, X. (2015). *Spatiotemporal data mining: A computational perspective*.
    *ISPRS International Journal of Geo-Information*, *4* (4), 2306-2338.'
  prefs: []
  type: TYPE_NORMAL
- en: Wang, Y., Huang, Z., Yin, G., Li, H., Yang, L., Su, Y., ... & Shan, X. (2022).
    *Applying Ollivier-Ricci curvature to indicate the mismatch of travel demand and
    supply in urban transit network*. *International Journal of Applied Earth Observation
    and Geoinformation*, *106*, 102666.
  prefs: []
  type: TYPE_NORMAL
