- en: Chapter 6. Composing Static Maps
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章。创建静态地图
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍以下食谱：
- en: Creating the simplest map renderer
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建最简单的地图渲染器
- en: Using the map composer
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用地图编者
- en: Adding labels to a map for printing
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为打印地图添加标签
- en: Adding a scale bar to the map
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加比例尺
- en: Adding a north arrow to the map
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加指向北方的箭头
- en: Adding a logo to the map
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加徽标
- en: Adding a legend to the map
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加图例
- en: Adding a custom shape to the map
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加自定义形状
- en: Adding a grid to the map
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加网格
- en: Adding a table to the map
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图添加表格
- en: Saving a map to a PNG image
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将地图保存为PNG图像
- en: Adding a world file to a map image
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为地图图像添加世界文件
- en: Saving a map to a project
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将地图保存到项目中
- en: Loading a map from a project
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从项目中加载地图
- en: Introduction
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: In this chapter, we'll create maps using PyQGIS, Qt image objects, and QGIS
    Map Composer to create map layouts that can be exported as documents or images.
    The QGIS Map Composer is designed to create static map layouts with decorative
    and reference elements, for printing or inclusion in another document.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用PyQGIS、Qt图像对象和QGIS地图编者创建地图布局，这些布局可以导出为文档或图像。QGIS地图编者旨在创建具有装饰性和参考元素的静态地图布局，用于打印或包含在其他文档中。
- en: Creating the simplest map renderer
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建最简单的地图渲染器
- en: In order to turn a dynamic GIS map into a static map image or document, you
    must create a renderer to **freeze** the map view and create a graphic version
    of it. In this recipe, we'll render a map to a JPEG image and save it.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将动态GIS地图转换为静态地图图像或文档，您必须创建一个渲染器来**冻结**地图视图并创建其图形版本。在本食谱中，我们将渲染地图到JPEG图像并保存它。
- en: Getting ready
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `hancock`:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下压缩的shapefile并将其解压缩到您的`qgis_data`目录下的`hancock`子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/hancock.zip](https://geospatialpython.googlecode.com/svn/hancock.zip)'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/hancock.zip](https://geospatialpython.googlecode.com/svn/hancock.zip)'
- en: You will also need to open the **Python Console** under the **Plugins** menu
    in QGIS. You can run these lines of code inside the console.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 您还需要在QGIS的**插件**菜单下打开**Python控制台**。您可以在控制台中运行这些代码行。
- en: How to do it...
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'In this recipe, we will load our shapefile, add it to the map, create a blank
    image, set up the map view, render the map image, and save it. To do this, we
    need to perform the following steps:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将加载我们的shapefile，将其添加到地图中，创建一个空白图像，设置地图视图，渲染地图图像，并将其保存。为此，我们需要执行以下步骤：
- en: 'First, we need to import the underlying `Qt` libraries required for image handling:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入用于图像处理的底层`Qt`库：
- en: '[PRE0]'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, we load the layer and add it to the map:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将加载图层并将其添加到地图中：
- en: '[PRE1]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, we create a blank image to accept the map image:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们创建一个空白图像以接受地图图像：
- en: '[PRE2]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Then, we access the map renderer:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们访问地图渲染器：
- en: '[PRE3]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, we get the IDs of the map layers:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们获取地图图层的ID：
- en: '[PRE4]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Then, we use the newly initialized renderer layers in the map:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们使用地图中新初始化的渲染器图层：
- en: '[PRE5]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Now, we get the full extent of the map as a rectangle:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们获取地图的全范围作为矩形：
- en: '[PRE6]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Then, we set a scale for the renderer. Smaller numbers produce a larger map
    scale, and larger numbers produce a smaller map scale. We can change the map scale
    to create a buffer around the map image:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们为渲染器设置一个比例。较小的数字会产生较大的地图比例，而较大的数字会产生较小的地图比例。我们可以更改地图比例以在地图图像周围创建缓冲区：
- en: '[PRE7]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Next, we set the extent of the renderer to the rectangle:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将渲染器的范围设置为矩形：
- en: '[PRE8]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Now we set the output size and resolution of the image. The resolution is automatically
    calculated:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们设置图像的输出大小和分辨率。分辨率会自动计算：
- en: '[PRE9]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now, we can render the map and finalize the image:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以渲染地图并最终确定图像：
- en: '[PRE10]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Finally, we save the map image:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们保存地图图像：
- en: '[PRE11]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Verify that you have a map image in your `qgis_data` directory, similar to the
    map displayed in QGIS.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认您在`qgis_data`目录中有一个地图图像，类似于在QGIS中显示的地图。
- en: How it works...
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: QGIS uses the underlying Qt GUI library to create common image types. We haven't
    used any of the QGIS composer objects to render the image; however, this rendering
    technique is used to save maps created with the QGIS composer.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS使用底层的Qt GUI库来创建常见的图像类型。我们没有使用任何QGIS编者对象来渲染图像；然而，这种渲染技术用于保存使用QGIS编者创建的地图。
- en: There's more...
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'The `QImage` object supports other image formats as well. To save a map image
    to a PNG, replace the last step in the *How to do it…* section with the following
    code:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '`QImage`对象还支持其他图像格式。要将地图图像保存为PNG，将*如何操作…*部分中的最后一步替换为以下代码：'
- en: '[PRE12]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Using the map composer
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用地图组合器
- en: The QGIS Map Composer allows you to combine a map with nonspatial elements that
    help enhance our understanding of the map. In this recipe, we'll create a basic
    map composition. A composition requires you to define the physical paper size
    and output format. Even a simple composition example such as this has over 20
    lines of configuration options.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS地图组合器允许您将地图与非空间元素结合，这些元素有助于增强我们对地图的理解。在这个配方中，我们将创建一个基本的地图组合。组合需要您定义物理纸张大小和输出格式。即使像这样的简单组合示例也有超过20行的配置选项。
- en: Getting ready
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `hancock`:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下压缩的shapefile并将其提取到您的`qgis_data`目录下的`hancock`子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/hancock.zip](https://geospatialpython.googlecode.com/svn/hancock.zip)'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/hancock.zip](https://geospatialpython.googlecode.com/svn/hancock.zip)'
- en: You will also need to open the **Python Console** under the **Plugins** menu
    in QGIS. You can run this recipe in the console or wrap it in a script for the
    **Script Runner** plugin, using the template provided with the plugin.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 您还需要在QGIS的**插件**菜单下打开**Python控制台**。您可以在控制台中运行此配方，或者将其包装在**脚本运行器**插件的脚本中，使用插件提供的模板。
- en: How to do it...
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In this recipe, the major steps are to load the shapefile into a map, build
    the map composition, and render it to an image, described as follows:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，主要步骤是将shapefile加载到地图中，构建地图组合，并将其渲染为图像，具体如下所述：
- en: 'First, we need to import the `Qt` libraries for image handling:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入用于图像处理的`Qt`库：
- en: '[PRE13]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Next, we load the layer and add it to the map:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们加载图层并将其添加到地图中：
- en: '[PRE14]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now, we create a blank image to accept the map image:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们创建一个空白图像以接受地图图像：
- en: '[PRE15]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Next, we get the IDs of the map layers:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们获取地图图层的ID：
- en: '[PRE16]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Then, we access the map renderer:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们访问地图渲染器：
- en: '[PRE17]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We then use the newly initialized renderer layers in the map:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们使用地图中新初始化的渲染器图层：
- en: '[PRE18]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Now, we get the full extent of the map as a rectangle:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们获取地图的完整范围作为矩形：
- en: '[PRE19]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Then, we set the scale for the renderer. Smaller numbers produce a larger map
    scale, and larger numbers produce a smaller map scale to add an image buffer around
    the map:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们为渲染器设置比例尺。较小的数字会产生较大的地图比例尺，而较大的数字会产生较小的地图比例尺，以便在地图周围添加图像缓冲区：
- en: '[PRE20]'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now, we set the map renderer''s extent to the full map''s extent:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将地图渲染器的范围设置为整个地图的范围：
- en: '[PRE21]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Next, we begin using the QGIS composer by creating a new composition and assigning
    it the map renderer:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们通过创建一个新的组合并分配地图渲染器来开始使用QGIS组合器：
- en: '[PRE22]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Then, we set the composition style. We will define it as `Print`, which will
    allow us to create both PDF documents and images. The alternative is to define
    it as a postscript, which is often used for direct output to printer devices:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们设置组合样式。我们将将其定义为`Print`，这将允许我们创建PDF文档和图像。另一种选择是将它定义为postscript，这通常用于直接输出到打印机设备：
- en: '[PRE23]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Now, we define our paper size, which is specified in millimeters. In this case,
    we will use the equivalent of an 8.5 x 11 inch sheet of paper, which is the US
    letter size:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们定义我们的纸张大小，以毫米为单位指定。在这种情况下，我们将使用相当于8.5 x 11英寸纸张大小的纸张，即美国信函大小：
- en: '[PRE24]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Next, we''ll calculate dimensions for the map so that it takes up approximately
    half the page and is centered:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将计算地图的尺寸，使其占据大约一半的页面并居中：
- en: '[PRE25]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Then, we create the map composer object and set its extent:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们创建地图组合器对象并设置其范围：
- en: '[PRE26]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Next, we give the map a frame around its border and add it to the page:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们在地图的边缘周围添加一个框架并将其添加到页面上：
- en: '[PRE27]'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now, we ensure that the resolution of the composition is set. The resolution
    defines how much detail the output contains. Lower resolutions contain less detail
    and create smaller files. Higher resolutions provide more image detail but create
    larger files:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们确保组合的分辨率已设置。分辨率定义了输出包含多少细节。较低的分辨率包含较少的细节并创建较小的文件。较高的分辨率提供更多的图像细节但创建较大的文件：
- en: '[PRE28]'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'We now convert the dots-per-inch resolution to dots-per-millimeter:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在将每英寸点数分辨率转换为每毫米点数：
- en: '[PRE29]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Next, we initialize the image:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们初始化图像：
- en: '[PRE30]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Now, we render the composition:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们渲染组合：
- en: '[PRE31]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Finally, we save the composition as a JPEG image:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将组合保存为JPEG图像：
- en: '[PRE32]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Verify that the output image resembles the following sample image:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 确认输出图像类似于以下示例图像：
- en: '![How to do it...](img/00047.jpeg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/00047.jpeg)'
- en: How it works...
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Map compositions are very powerful, but they can also be quite complex. You
    are managing the composition that represents a virtual sheet of paper. On that
    composition, you place objects, such as the map. Then, you must also manage the
    rendering of the composition as an image. All these items are independently configurable,
    which can sometimes lead to unexpected results with the sizing or visibility of
    items.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 地图组成非常强大，但它们也可能相当复杂。您正在管理代表虚拟纸张的组成。在这个组成中，您放置对象，例如地图。然后，您还必须管理将组成作为图像的渲染。所有这些项都是独立可配置的，这有时可能导致项目的大小或可见性出现意外结果。
- en: There's more…
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: In the upcoming versions of QGIS, the map composer class may be renamed as the
    `print layout` class. You can find out more information about this proposed change
    at [https://github.com/qgis/QGIS-Enhancement-Proposals/pull/9](https://github.com/qgis/QGIS-Enhancement-Proposals/pull/9)
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在QGIS即将推出的版本中，地图组成类可能被重命名为`print layout`类。您可以在[https://github.com/qgis/QGIS-Enhancement-Proposals/pull/9](https://github.com/qgis/QGIS-Enhancement-Proposals/pull/9)找到更多关于这个提议更改的信息。
- en: Adding labels to a map for printing
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为打印添加标签
- en: The `QgsComposition` object allows you to place arbitrary text anywhere in the
    composition. In this recipe, we'll demonstrate how to add a label to a map composition.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '`QgsComposition`对象允许您在组成中的任何位置放置任意文本。在这个菜谱中，我们将演示如何向地图组成中添加标签。'
- en: Getting ready
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `hancock`:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下压缩的shapefile并将其解压到您的`qgis_data`目录下的`hancock`子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/hancock.zip](https://geospatialpython.googlecode.com/svn/hancock.zip)'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/hancock.zip](https://geospatialpython.googlecode.com/svn/hancock.zip)'
- en: In addition to the shapefile, you will also need the `MapComposer` class. This
    class encapsulates the boilerplate composer code in a reusable way to make adding
    other elements easier. You can download it from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py).
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 除了shapefile之外，您还需要`MapComposer`类。这个类以可重用的方式封装了模板化组成代码，以便更容易添加其他元素。您可以从[https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)下载它。
- en: This file must be accessible from the QGIS Python console by ensuring that it
    is in the Python path directory. Place the file in the `.qgis2/python` directory
    within your home directory.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件必须可以通过确保它在Python路径目录中从QGIS Python控制台访问。将文件放置在您家目录中的`.qgis2/python`目录内。
- en: How to do it...
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To add a label to a composition, we''ll first build the map composition, create
    a label, and then save the composition as an image. To do this, we need to perform
    the following steps:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 要向组成中添加标签，我们首先构建地图组成，创建一个标签，然后将组成保存为图像。为此，我们需要执行以下步骤：
- en: 'First, we need to import the Qt GUI libraries and the `MapComposer` class:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入Qt GUI库和`MapComposer`类：
- en: '[PRE33]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Next, we create a layer with the shapefile, setting the path to the shapefile
    in order to match your system:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们创建一个带有shapefile的层，设置shapefile的路径以匹配您的系统：
- en: '[PRE34]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Now, we add this layer to the map:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将这一层添加到地图中：
- en: '[PRE35]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Next, we access the map renderer:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们访问地图渲染器：
- en: '[PRE36]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Then, we create a `MapComposer` object, passing in the map layer registry and
    the map renderer:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们创建一个`MapComposer`对象，传入地图层注册表和地图渲染器：
- en: '[PRE37]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Now, we create a new label object:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们创建一个新的标签对象：
- en: '[PRE38]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'We can set the label text to any string:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以将标签文本设置为任何字符串：
- en: '[PRE39]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'We can automatically set the size of the label container to fit the string
    we used:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以自动设置标签容器的尺寸以适应我们使用的字符串：
- en: '[PRE40]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Now, we add a frame around the label box:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们在标签框周围添加一个框架：
- en: '[PRE41]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Then, we set the position of the label on the page, which is at the top-left
    corner of the map:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们在页面上设置标签的位置，它位于地图的左上角：
- en: '[PRE42]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Next, we add the label the map composition now that it is configured:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，由于已经配置好了，我们现在将标签添加到地图组成中：
- en: '[PRE43]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Finally, we save the composition image:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们保存组成图像：
- en: '[PRE44]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Verify that your output image has a text label in a frame at the top-left corner
    of the map.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认您的输出图像在地图左上角有一个文本标签在框架内。
- en: How it works...
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this case, we created a very simple label based on defaults. However, labels
    can be customized to change the font, size, color, and style for print-quality
    compositions. Also, note that the *x*,*y* values used to place items in a composition
    start in the upper-left corner of the page. As you move an item down the page,
    the *y* value increases.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在此情况下，我们基于默认设置创建了一个非常简单的标签。然而，标签可以被自定义以更改字体、大小、颜色和样式，以用于打印质量的组合。此外，请注意，用于在组合中放置项目的
    *x*、*y* 值从页面的左上角开始。当您将项目向下移动页面时，*y* 值会增加。
- en: Adding a scale bar to the map
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向地图添加比例尺条
- en: A scale bar is one of the most important elements of a map composition, as it
    defines the scale of the map to determine the ground distance on the map. QGIS
    composer allows you to create several different types of scale bars from a simple
    text scale ratio to a graphical, double scale bar with two measurement systems.
    In this recipe, we'll create a scale bar that measures in kilometres.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 比例尺条是地图组合中最重要的元素之一，因为它定义了地图的比例，以确定地图上的地面距离。QGIS 组合器允许您创建多种不同类型的比例尺条，从简单的文本比例尺比到图形的、双测量系统的双比例尺条。在本配方中，我们将创建一个以公里为单位的比例尺条。
- en: Getting ready
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `ms`:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下压缩的 shapefile 并将其提取到您的 `qgis_data` 目录下的 `ms` 子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/mississippi.zip](https://geospatialpython.googlecode.com/svn/mississippi.zip)'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/mississippi.zip](https://geospatialpython.googlecode.com/svn/mississippi.zip)'
- en: In addition to the shapefile, you will also need the `MapComposer` class. This
    class encapsulates the boilerplate composer code in a reusable way to make adding
    other elements easier. You can download it from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 shapefile 之外，您还需要 `MapComposer` 类。这个类以可重用的方式封装了组合器代码的样板，以便更容易地添加其他元素。您可以从
    [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    下载它。
- en: This file must be accessible from the QGIS Python console; ensure that it is
    in the Python path directory. Place the file in the `.qgis2/python` directory
    within your home directory.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件必须可以从 QGIS Python 控制台中访问；确保它位于 Python 路径目录中。将文件放置在您主目录中的 `.qgis2/python`
    目录下。
- en: For the scale bar to display correctly, you must ensure that QGIS is set to
    automatically reproject data on the fly. In QGIS, go to the **Settings** menu
    and select **Options**. In the **Options** dialog, select the **CRS** panel. In
    the **Default CRS for new projects** section, check the **Enable 'on the fly'
    reprojection by default** radio button. Click on the **OK** button to confirm
    the setting.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 为了正确显示比例尺条，您必须确保 QGIS 设置为自动在飞行中重新投影数据。在 QGIS 中，转到 **设置** 菜单并选择 **选项**。在 **选项**
    对话框中，选择 **CRS** 面板。在 **新项目默认 CRS** 部分中，勾选 **默认启用 '在飞行中' 重投影** 单选按钮。单击 **确定** 按钮以确认设置。
- en: How to do it...
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'First, we will generate the map, then we''ll generate the composition, and
    finally we''ll create the scale bar and place it in the lower-right corner of
    the map. To do this, we need to perform the following steps:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将生成地图，然后生成组合，最后创建比例尺条并将其放置在地图的右下角。为此，我们需要执行以下步骤：
- en: 'First, we need to import the libraries we''ll need:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入我们将需要的库：
- en: '[PRE45]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Then, we''ll build the map renderer using the shapefile:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们将使用 shapefile 构建地图渲染器：
- en: '[PRE46]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Next, we''ll create the `MapComposer` object using the layer registry and map
    renderer:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将使用图层注册和地图渲染器创建 `MapComposer` 对象：
- en: '[PRE47]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Now, we''ll initialize the scale bar object:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将初始化比例尺条对象：
- en: '[PRE48]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Then, we define the scale bar type. The default is a text scale, but we''ll
    create a more traditional box scale bar:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们定义比例尺条的类型。默认是文本比例尺，但我们将创建一个更传统的框形比例尺条：
- en: '[PRE49]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Next, we apply the scale bar to the map and set the scale bar graphic to the
    default size:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将比例尺条应用到地图上，并将比例尺条图形设置为默认大小：
- en: '[PRE50]'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'We use the scale bar size, map size, and map position to calculate the desired
    position of the scale bar, in the lower-right corner of the map:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们使用比例尺条大小、地图大小和地图位置来计算比例尺条在地图右下角所需的位置：
- en: '[PRE51]'
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Then, we set the calculated position of the scale bar and add it to the composition:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们设置比例尺条的计算位置并将其添加到组合中：
- en: '[PRE52]'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Finally, we save the composition to an image:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将组合保存为图像：
- en: '[PRE53]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: How it works...
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The scale bar will display in kilometres if the map projection is set correctly,
    which is why it is important to have automatic reprojection enabled in the QGIS
    settings. The location of the scale bar within the composition is not important,
    as long as the `composerMap` object is applied to it.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如果地图投影设置正确，比例尺条将显示为公里，这就是为什么在QGIS设置中启用自动重投影很重要的原因。比例尺条在组合中的位置并不重要，只要将其应用于`composerMap`对象即可。
- en: Adding a north arrow to the map
  id: totrans-176
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加地图北向针
- en: North arrows are another common cartographic element found even in ancient maps,
    which show the orientation of the map relative to either true, gird, or magnetic
    north. Sometimes, these symbols can be quite elaborate. However, QGIS provides
    a basic line arrow element that we will use in combination with a map label to
    make a basic north arrow.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 北向针是另一种常见的制图元素，甚至在古代地图中也能找到，它显示了地图相对于真北、网格北或磁北的方位。有时，这些符号可能相当复杂。然而，QGIS提供了一个基本的线箭头元素，我们将与地图标签结合使用来制作基本的北向针。
- en: Getting ready
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `ms`:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下压缩的shapefile并将其提取到您的`qgis_data`目录中，到名为`ms`的子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)'
- en: In addition to the shapefile, you will also need the `MapComposer` class to
    simplify the code needed to add this one element. If you haven't already used
    it in a previous recipe, you can download it from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 除了shapefile之外，您还需要`MapComposer`类来简化添加此单个元素所需的代码。如果您之前没有在配方中使用过它，您可以从[https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)下载。
- en: This file must be accessible from the QGIS Python Console; for this, you need
    to ensure that it is in the Python path directory. Place the file in the `.qgis2/python`
    directory within your home directory.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件必须可以从QGIS Python控制台访问；为此，您需要确保它位于Python路径目录中。将文件放置在您家目录中的`.qgis2/python`目录内。
- en: How to do it...
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In this recipe, we will create a map composition, draw an arrow to the right
    of the map, and then place a label with a capital letter `N` below the arrow.
    To do this, we need to perform the following steps:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将创建一个地图组合，在地图右侧绘制一个箭头，然后在箭头下方放置一个带有大写字母`N`的标签。为此，我们需要执行以下步骤：
- en: 'First, we import the `Qt` and `MapComposer` Python libraries:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们导入`Qt`和`MapComposer`Python库：
- en: '[PRE54]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Next, we create the map composition object:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们创建地图组合对象：
- en: '[PRE55]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Now, we calculate the position of the arrow along the right-hand side of the
    map, set its position, and then add it to the composition:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们计算箭头在地图右侧的位置，设置其位置，然后将其添加到组合中：
- en: '[PRE56]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Then, we create a capital letter `N` label and add it to the composition just
    below the arrow:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们创建一个大写字母`N`标签并将其添加到箭头下方：
- en: '[PRE57]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Finally, we save the composition to an image:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将组合保存为图像：
- en: '[PRE58]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Verify that your output image looks similar to the following:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 确认您的输出图像与以下类似：
- en: '![How to do it...](img/00048.jpeg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/00048.jpeg)'
- en: How it works...
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The QGIS composer doesn't have a dedicated north arrow or compass rose object.
    However, it is quite simple to construct one, as demonstrated in the preceding
    section. The arrow is just a graphic. The direction of the arrow is controlled
    by the location of the start point and the end point listed, respectively, when
    you create the `QgsComposerArrow` object.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS组合器没有专门的北向针或罗盘玫瑰对象。然而，正如前文所示，构建一个相当简单。箭头只是一个图形。箭头的方向由创建`QgsComposerArrow`对象时列出的起点和终点位置控制。
- en: There's more...
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: You can extend this example to have an arrow point in multiple compass directions.
    You can also use an image of a more elaborate compass rose added to the composition.
    We'll demonstrate how to add images in the next recipe. Note that the arrow element
    can also be used to point to items on the map with an associated label.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将此示例扩展为使箭头指向多个罗盘方向。您还可以将更复杂的罗盘玫瑰图像添加到组合中。我们将在下一个配方中演示如何添加图像。请注意，箭头元素也可以用来指向带有相关标签的地图上的项目。
- en: Adding a logo to the map
  id: totrans-201
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加地图徽标
- en: An important part of customizing a map is to add your logo or other graphics
    to the composition. In this recipe, we'll add a simple logo to the map.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义地图的一个重要部分是向组合中添加您的标志或其他图形。在本菜谱中，我们将向地图添加一个简单的标志。
- en: Getting ready
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `ms`:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下zip格式的shapefile，并将其解压到您的`qgis_data`目录下的名为`ms`的子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)'
- en: You will also need a logo image, which you can download from [https://geospatialpython.googlecode.com/svn/trunk/logo.png](https://geospatialpython.googlecode.com/svn/trunk/logo.png).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 您还需要一个标志图像，您可以从[https://geospatialpython.googlecode.com/svn/trunk/logo.png](https://geospatialpython.googlecode.com/svn/trunk/logo.png)下载。
- en: Place the image in your `qgis_data/rasters` directory.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 将图像放置在您的`qgis_data/rasters`目录中。
- en: If you haven't already done so in the previous recipe, download the `MapComposer`
    library from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py),
    to simplify the creation of the map composition.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在先前的菜谱中还没有这样做，请从[https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)下载`MapComposer`库，以简化地图组合的创建。
- en: Place the file in the `.qgis2/python` directory within your home directory.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件放置在您家目录中的`.qgis2/python`目录内。
- en: How to do it...
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In this recipe, we will create the map composition, add the logo image, and
    save the map as an image. To do this, we need to perform the following steps:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在本菜谱中，我们将创建地图组合，添加标志图像，并将地图保存为图像。为此，我们需要执行以下步骤：
- en: 'First, we need to import the Qt GUI, core QGIS, QGIS GUI, and MapComposer libraries:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入Qt GUI、核心QGIS、QGIS GUI和MapComposer库：
- en: '[PRE59]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Next, we will build a basic map composition using the shapefile:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将使用shapefile构建基本的地图组合：
- en: '[PRE60]'
  id: totrans-215
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Now, we initialize the picture object:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们初始化图片对象：
- en: '[PRE61]'
  id: totrans-217
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Then, we set the path of the picture to our image file:'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们将图片的路径设置为我们的图像文件：
- en: '[PRE62]'
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'We must set the size of the box or scene rectangle such that it is large enough
    to contain the logo. Otherwise, the picture will appear cropped:'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们必须设置框或场景矩形的大小，使其足够大，可以包含标志。否则，图片将出现裁剪：
- en: '[PRE63]'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Next, we calculate the position of the logo relative to the map image. We''ll
    place the logo near the top-left corner of the map:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将计算标志相对于地图图像的位置。我们将标志放置在地图的右上角：
- en: '[PRE64]'
  id: totrans-223
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Now, we set the logo''s position and add it to the map composition:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们设置标志的位置并将其添加到地图组合中：
- en: '[PRE65]'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Finally, we save the composition as an image:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将组合保存为图像：
- en: '[PRE66]'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: How it works...
  id: totrans-228
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: This recipe is very straight forward, as the `QgsComposerPicture` is an extremely
    simple object. You can use JPG, PNG, or SVG images. This technique can be used
    to add custom north arrows or other cartographic elements as well.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 此菜谱非常直接，因为`QgsComposerPicture`是一个非常简单的对象。您可以使用JPG、PNG或SVG图像。此技术还可以用于添加自定义的北方箭头或其他制图元素。
- en: Adding a legend to the map
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向地图添加图例
- en: A map legend decodes the symbology used in a thematic GIS map for the reader.
    Legends are tightly integrated into QGIS, and in this recipe, we'll add the default
    legend from the map to the print composition.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 地图图例解码了用于主题GIS地图的符号，供读者解读。图例与QGIS紧密集成，在本菜谱中，我们将地图的默认图例添加到打印组合中。
- en: Getting ready
  id: totrans-232
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Download the shapefile for this map from [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)
    and extract it to your `qgis_data` directory in a subdirectory named `ms`.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 从[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)下载此地图的shapefile，并将其解压到您的`qgis_data`目录下的名为`ms`的子目录中。
- en: As with the previous recipes in this chapter, we will use the `MapComposer`
    library from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    to simplify the creation of the map composition.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 与本章中先前的菜谱一样，我们将使用[https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)中的`MapComposer`库来简化地图组合的创建。
- en: Place the file in the `.qgis2/python` directory within your home directory.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件放置在您家目录中的`.qgis2/python`目录内。
- en: How to do it...
  id: totrans-236
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'This recipe is as simple as creating the map, adding the automatically generated
    legend, and saving the output to an image. To do this, we need to perform the
    following steps:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 这个菜谱就像创建地图、添加自动生成的图例并将输出保存到图像一样简单。为此，我们需要执行以下步骤：
- en: 'First, we will need to load the Qt and QGIS GUI libraries followed by the MapComposer
    library:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要加载Qt和QGIS GUI库，然后是MapComposer库：
- en: '[PRE67]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Next, we will load the shapefile as a layer and create the map composition
    with the `MapComposer` library, passing it the map layer registry and map renderer:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将加载形状文件作为图层，并使用`MapComposer`库创建地图组合，传递地图图层注册表和地图渲染器：
- en: '[PRE68]'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Now, we initialize the legend object:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们初始化图例对象：
- en: '[PRE69]'
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'We now tell the legend which layer set we want to use:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在告诉图例我们想要使用哪个图层集：
- en: '[PRE70]'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Then, we set the legend''s position to the left-hand side of the map and add
    it to the composition:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们将图例的位置设置为地图的左侧，并将其添加到组合中：
- en: '[PRE71]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'Finally, we output the composition to the map:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将组合输出到地图上：
- en: '[PRE72]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: How it works...
  id: totrans-250
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Adding a legend is quite simple. QGIS will carry over the styling that is autogenerated
    when the layer is loaded or manually set by the user. Of course, you can also
    save layer styling, which is loaded with the layer and used by the legend. However,
    if you're generating a composition in the background such as in a standalone application,
    for example, every aspect of the legend is customizable through the PyQGIS API.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 添加图例相当简单。QGIS将在加载图层时自动生成样式，或者由用户手动设置。当然，您也可以保存图层样式，这些样式与图层一起加载，并由图例使用。然而，如果您在后台生成组合，例如在独立应用程序中，那么图例的每个方面都可以通过PyQGIS
    API进行自定义。
- en: Adding a custom shape to the map
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向地图添加自定义形状
- en: The QGIS composer has an object for drawing and styling nonspatial shapes, including
    rectangles, ellipses, and triangles. In this recipe, we'll add some rectangles
    filled with different colors, which will resemble a simple bar chart, as an example
    of using shapes.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS作曲器有一个用于绘制和样式化非空间形状的对象，包括矩形、椭圆和三角形。在这个菜谱中，我们将添加一些填充不同颜色的矩形，这将成为使用形状的一个简单条形图的例子。
- en: Getting ready
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Download the zipped shapefile for this map from [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)
    and extract it to your `qgis_data` directory, to in a subdirectory named `ms`.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 从[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)下载此地图的压缩形状文件，并将其解压到您的`qgis_data`目录下的`ms`子目录中。
- en: We will also use the `MapComposer` library from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    to simplify the creation of the map composition.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将使用来自[https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)的`MapComposer`库来简化地图组合的创建。
- en: Place the file in the `.qgis2/python` directory within your home directory.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件放置在您家目录中的`.qgis2/python`目录下。
- en: How to do it...
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'First, we will create a simple map composition with the shapefile. Then, we
    will define the style properties for our rectangles. Next, we will draw the rectangles,
    apply the symbols, and render the composition. To do this, we need to perform
    the following steps:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将使用形状文件创建一个简单的地图组合。然后，我们将定义矩形的样式属性。接下来，我们将绘制矩形，应用符号，并渲染组合。为此，我们需要执行以下步骤：
- en: 'First, we must import the PyQGIS and Qt GUI libraries as well as the MapComposer
    library, as follows:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们必须导入PyQGIS和Qt GUI库以及MapComposer库，如下所示：
- en: '[PRE73]'
  id: totrans-261
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'Next, we create the map composition by using the shapefile:'
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们使用形状文件创建地图组合：
- en: '[PRE74]'
  id: totrans-263
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Now, we create three basic fill symbols by building Python dictionaries with
    color properties and initialize the symbols with these dictionaries:'
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们通过构建具有颜色属性的Python字典来创建三个基本的填充符号，并用这些字典初始化符号：
- en: '[PRE75]'
  id: totrans-265
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Then, we calculate the y position of the first shape, relative to the map:'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们计算第一个形状相对于地图的y位置：
- en: '[PRE76]'
  id: totrans-267
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'We create the first shape and set it to the type 1, which is a rectangle:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们创建第一个形状并将其设置为类型1，这是一个矩形：
- en: '[PRE77]'
  id: totrans-269
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Next, we tell the shape to use a symbol, set the symbol for one of our three
    fill symbols, and add the shape to the composition:'
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们告诉形状使用一个符号，设置一个符号为我们三个填充符号中的一个，并将形状添加到组合中：
- en: '[PRE78]'
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'We repeat the process with two other shapes, changing their position, size,
    and symbols to make them look different:'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们用另外两种形状重复这个过程，改变它们的位置、大小和符号，使它们看起来不同：
- en: '[PRE79]'
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Finally, we output the composition as an image:'
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将组合输出为图像：
- en: '[PRE80]'
  id: totrans-275
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'Verify that your output image looks similar to the following:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 确认您的输出图像与以下类似：
- en: '![How to do it...](img/00049.jpeg)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![如何做到这一点...](img/00049.jpeg)'
- en: How it works...
  id: totrans-278
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: This simple graphical output is nearly 40 lines of code. While there may be
    some limited uses for dealing with these shapes, in most cases, the simpler route
    will be to just import images. However, it provides a good foundation for a richer
    graphics API, as QGIS continues to evolve.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 这种简单的图形输出几乎有40行代码。虽然这些形状可能有一些有限的用途来处理，但在大多数情况下，更简单的方法是直接导入图像。然而，这为更丰富的图形API提供了一个良好的基础，因为QGIS持续发展。
- en: There's more...
  id: totrans-280
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: If you are using fill symbols within a Python plugin in a QGIS version less
    than 2.6, you must ensure that the symbols are defined in the global scope, or
    QGIS will crash due to a bug. The easiest way to include the variables in the
    global scope is to define them immediately after the import statements. It also
    affects scripts that are run in the Script Runner plugin. This bug was fixed in
    version 2.6 and subsequent versions.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在QGIS版本低于2.6的Python插件中使用填充符号，您必须确保符号在全局范围内定义，否则QGIS会因为一个错误而崩溃。在全局范围内包含变量的最简单方法是立即在导入语句之后定义它们。这也影响了在Script
    Runner插件中运行的脚本。这个错误在2.6版及以后的版本中已修复。
- en: Adding a grid to the map
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向地图添加网格
- en: An annotated reference grid is useful for map products used to locate features.
    This recipe teaches you how to add both reference lines on a map and annotations
    for the lines around the edges of the map.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 一个带注释的参考网格对于用于定位特征的地图产品很有用。这个配方教你如何在地图上添加参考线以及地图边缘的注释。
- en: Getting ready
  id: totrans-284
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need a shapefile for this map from [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip),
    and you need to extract it to your `qgis_data` directory, to a subdirectory named
    `ms`.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要从这个地图中获取一个shapefile，来自[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)，并且您需要将其提取到您的`qgis_data`目录下的一个名为`ms`的子目录中。
- en: As with the previous recipes in this chapter, we will use the `MapComposer`
    library from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    to simplify the creation of the map composition.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 与本章中之前的配方一样，我们将使用来自[https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)的`MapComposer`库来简化地图组合的创建。
- en: Place the file in the `.qgis2/python` directory within your home directory.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件放在您家目录中的`.qgis2/python`目录中。
- en: How to do it...
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'In this recipe, the general steps are to create the map composition, establish
    the overall grid parameters, define the grid line placement, and then style the
    grid and annotations. To do this, we need to perform the following steps:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，一般的步骤是创建地图组合，建立整体网格参数，定义网格线位置，然后样式网格和注释。为此，我们需要执行以下步骤：
- en: 'First, we need to import all the GUI libraries and the MapComposer library:'
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入所有GUI库和MapComposer库：
- en: '[PRE81]'
  id: totrans-291
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Next, we create the map composition using the shapefile:'
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们使用shapefile创建地图组合：
- en: '[PRE82]'
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Now, we are going to create some variables to shorten some unusually long method
    and object names:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将创建一些变量来缩短一些异常长的方法和对象名称：
- en: '[PRE83]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'Then, we enable the grid, set the line spacing, and use solid lines for the
    grid:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们启用网格，设置行间距，并使用实线作为网格：
- en: '[PRE84]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Next, we enable the annotation numbers for coordinates and set the decimal
    precision to 0 for whole numbers:'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们启用坐标的注释数字，并将整数的小数精度设置为0：
- en: '[PRE85]'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Now, we go around the map composition frame and define locations and directions
    for each set of grid lines, using our shorter variable names from the previous
    steps:'
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们围绕地图组合框架移动，并使用上一步中较短的变量名定义每一组网格线的位置和方向：
- en: '[PRE86]'
  id: totrans-301
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE86]'
- en: 'Finally, we set some additional styling for the grid lines and annotations
    before adding the whole map to the overall composition:'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，在将整个地图添加到整体组合之前，我们为网格线和注释设置了一些额外的样式：
- en: '[PRE87]'
  id: totrans-303
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE87]'
- en: 'We output the composition to an image:'
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将组合输出到图像中：
- en: '[PRE88]'
  id: totrans-305
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE88]'
- en: 'Verify that your output image looks similar to the following:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 确认您的输出图像与以下类似：
- en: '![How to do it...](img/00050.jpeg)'
  id: totrans-307
  prefs: []
  type: TYPE_IMG
  zh: '![如何做到这一点...](img/00050.jpeg)'
- en: How it works...
  id: totrans-308
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: This recipe has a lot of steps because the grids are customizable. The order
    of operations is important as well. Notice that we do not add the map to the composition
    until the very end. Often, you will make what seem to be minor changes and the
    grid may not render. Hence, modify this recipe carefully.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 这个菜谱有多个步骤，因为网格是可定制的。操作顺序也很重要。请注意，我们直到最后才将地图添加到编排中。通常，您会做出看似微小的更改，网格可能无法渲染。因此，请仔细修改此菜谱。
- en: Adding a table to the map
  id: totrans-310
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将表格添加到地图中
- en: QGIS composer provides an object to add a table to a composition, representing
    either the attributes of a vector layer or an arbitrary text table you create.
    In this recipe, we'll add a table to the composition with the attributes of our
    map layer shapefile.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS 编排器提供了一个对象，可以将表格添加到编排中，表示矢量层的属性或您创建的任意文本表格。在本菜谱中，我们将使用地图层形状文件的属性将表格添加到编排中。
- en: Getting ready
  id: totrans-312
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Download the shapefile for this map from [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)
    and extract it to your `qgis_data` directory, to a subdirectory named `ms`.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 从 [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)
    下载此地图的形状文件，并将其提取到您的 `qgis_data` 目录下的 `ms` 子目录中。
- en: As with the previous recipes in this chapter, we will use the `MapComposer`
    library from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    to simplify the creation of the map composition.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 与本章中之前的菜谱一样，我们将使用 [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    中的 `MapComposer` 库来简化地图编排的创建。
- en: Place the file in the `.qgis2/python` directory within your home directory.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件放置在您家目录中的 `.qgis2/python` 目录下。
- en: How to do it...
  id: totrans-316
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following steps will create a map composition, add the table, and output
    the composition to an image:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将创建地图编排，添加表格，并将编排输出为图像：
- en: 'First, we import our GUI libraries and the MapComposer library:'
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们导入我们的 GUI 库和 MapComposer 库：
- en: '[PRE89]'
  id: totrans-319
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE89]'
- en: 'Next, we create the map composition:'
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们创建地图编排：
- en: '[PRE90]'
  id: totrans-321
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'Now, we can initialize the table object:'
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以初始化表格对象：
- en: '[PRE91]'
  id: totrans-323
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'Then, we reference the related map:'
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们引用相关的地图：
- en: '[PRE92]'
  id: totrans-325
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'Next, we can specify the layer whose attributes we want to display in the table:'
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以指定要显示在表格中的属性所在的层：
- en: '[PRE93]'
  id: totrans-327
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'Now, we can position the table below the map and add it to the composition:'
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以将表格放置在地图下方并将其添加到编排中：
- en: '[PRE94]'
  id: totrans-329
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'Finally, we output the composition to an image:'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将编排输出为图像：
- en: '[PRE95]'
  id: totrans-331
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE95]'
- en: How it works...
  id: totrans-332
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The table object is very straight forward. Using the attributes of a vector
    layer is automatic. You can also build the table cell by cell if you want to display
    customized information.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 表格对象非常直观。使用矢量层的属性是自动的。如果您想显示自定义信息，也可以逐个单元格构建表格。
- en: Adding a world file to a map image
  id: totrans-334
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将世界文件添加到地图图像中
- en: Exporting a map as an image removes all of its spatial information. However,
    you can create an external text file called a **world file**, which provides the
    georeferencing information for the raster image, so that it can be used by GIS
    software, including QGIS, as a raster layer. In this recipe, we'll export a map
    composition as an image and create a world file with it.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 将地图导出为图像会移除其所有空间信息。然而，您可以创建一个名为 **world file** 的外部文本文件，它为栅格图像提供地理参考信息，因此它可以由包括
    QGIS 在内的 GIS 软件用作栅格层。在本菜谱中，我们将导出地图编排为图像，并创建与其相关的 world file。
- en: Getting ready
  id: totrans-336
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need to download the zipped shapefile from [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)
    and extract it to your `qgis_data` directory, to a subdirectory named `ms`.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要从 [https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)
    下载压缩的形状文件，并将其提取到您的 `qgis_data` 目录下的 `ms` 子目录中。
- en: In addition to the shapefile, you will also need the `MapComposer` class to
    simplify the code needed to add this one element. If you have not already used
    it in a previous recipe, you can download it from [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py).
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 除了形状文件外，您还需要 `MapComposer` 类来简化添加此单个元素所需的代码。如果您之前没有在菜谱中使用它，您可以从 [https://geospatialpython.googlecode.com/svn/MapComposer.py](https://geospatialpython.googlecode.com/svn/MapComposer.py)
    下载它。
- en: This file must be accessible from the QGIS Python console; for this, you need
    to ensure that it is in the python path directory. Place the file in the `.qgis2/python`
    directory within your home directory.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件必须可以从 QGIS Python 控制台访问；为此，您需要确保它位于 python 路径目录中。将文件放置在您家目录中的 `.qgis2/python`
    目录内。
- en: How to do it...
  id: totrans-340
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'First, we''ll create the map composition, then we''ll save it as an image,
    and finally we''ll generate the world file. To do this, we need to perform the
    following steps:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将创建地图组合，然后将其保存为图像，最后生成世界文件。为此，我们需要执行以下步骤：
- en: 'First, we need to import the GUI and MapComposer libraries:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要导入 GUI 和 MapComposer 库：
- en: '[PRE96]'
  id: totrans-343
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE96]'
- en: 'Next, we''ll create the map''s composition using the MapComposer libraries:'
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将使用 MapComposer 库创建地图的组合：
- en: '[PRE97]'
  id: totrans-345
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'Now, we''ll define the name of our output file:'
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将定义输出文件的名称：
- en: '[PRE98]'
  id: totrans-347
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE98]'
- en: 'Then, we can export the composition as an image:'
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以将组合导出为图像：
- en: '[PRE99]'
  id: totrans-349
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE99]'
- en: 'Now, we''ll create an object that contains the world file''s information:'
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将创建一个包含世界文件信息的对象：
- en: '[PRE100]'
  id: totrans-351
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE100]'
- en: 'Finally, we''ll open a text file and write each line of the text file:'
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们将打开一个文本文件并写入文本文件的每一行：
- en: '[PRE101]'
  id: totrans-353
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE101]'
- en: How it works...
  id: totrans-354
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The world file contains the ground distance per pixel and the upper-left coordinate
    of the map image. The QGIS composer automatically generates this information based
    on the referenced map. The world file's name must be the same as the image with
    an extension that uses the first and last letter of the image file extension plus
    the letter `w`. For example, a `.TIFF` image file will have a world file with
    the extension `.TFW`. You can learn more about what the world file variables in
    each line mean at [http://en.wikipedia.org/wiki/World_file](http://en.wikipedia.org/wiki/World_file).
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 世界文件包含每像素的地面距离和地图图像的左上角坐标。QGIS 组合器会自动根据引用的地图生成这些信息。世界文件的名称必须与图像相同，扩展名使用图像文件扩展名的第一个和最后一个字母加上字母
    `w`。例如，`.TIFF` 图像文件将有一个扩展名为 `.TFW` 的世界文件。您可以在 [http://en.wikipedia.org/wiki/World_file](http://en.wikipedia.org/wiki/World_file)
    上了解更多关于每行中世界文件变量含义的信息。
- en: Saving a map to a project
  id: totrans-356
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将地图保存到项目中
- en: Saving a project automatically can be useful for autosave features or as part
    of a process to autogenerate projects from dynamically updated data. In this recipe,
    we'll save a QGIS project to a `.qgs` project file.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 自动保存项目可以用于自动保存功能或作为从动态更新的数据自动生成项目的流程的一部分。在这个配方中，我们将保存一个 QGIS 项目到 `.qgs` 项目文件。
- en: Getting ready
  id: totrans-358
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'You will need to download the following zipped shapefile and extract it to
    your `qgis_data` directory, to a subdirectory named `ms`:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要下载以下压缩的 shapefile 并将其解压到您的 `qgis_data` 目录下的 `ms` 子目录中：
- en: '[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://geospatialpython.googlecode.com/svn/Mississippi.zip](https://geospatialpython.googlecode.com/svn/Mississippi.zip)'
- en: How to do it...
  id: totrans-361
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will create a simple QGIS project by loading a shapefile layer, then we''ll
    access the project object, and save the map project to a file, as follows:'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过加载 shapefile 层创建一个简单的 QGIS 项目，然后访问项目对象，并将地图项目保存到文件中，如下所示：
- en: 'First, we need the Qt core library in the QGIS Python console:'
  id: totrans-363
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要在 QGIS Python 控制台中安装 Qt 核心库：
- en: '[PRE102]'
  id: totrans-364
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE102]'
- en: 'Next, we load the shapefile and add it to the map:'
  id: totrans-365
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们加载 shapefile 并将其添加到地图中：
- en: '[PRE103]'
  id: totrans-366
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE103]'
- en: 'Then, we create a `file` object to save our project:'
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们创建一个 `file` 对象来保存我们的项目：
- en: '[PRE104]'
  id: totrans-368
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE104]'
- en: 'Now, we can access the QGIS project object instance:'
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以访问 QGIS 项目对象实例：
- en: '[PRE105]'
  id: totrans-370
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE105]'
- en: 'Finally, we can save the project by writing it to the file object:'
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们可以通过将其写入文件对象来保存项目：
- en: '[PRE106]'
  id: totrans-372
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE106]'
- en: How it works...
  id: totrans-373
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: QGIS simply creates and XML document with all the project settings and GIS map
    settings. You can read and even modify the XML output by hand.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS 简单地创建了一个包含所有项目设置和 GIS 地图设置的 XML 文档。您可以手动读取甚至修改 XML 输出。
- en: Loading a map from a project
  id: totrans-375
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从项目中加载地图
- en: This recipe demonstrates how to load a project from a `.qgs` XML file. Loading
    a project will set up the map and project settings for a previously saved project
    within QGIS.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方演示了如何从 `.qgs` XML 文件中加载项目。加载项目将在 QGIS 中设置之前保存的项目的地图和项目设置。
- en: Getting ready
  id: totrans-377
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need to complete the previous recipe, *Saving a map to a project*,
    so that you have a project named `myProject.qgs` in your `qgis_data` folder.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要完成之前的配方，*将地图保存到项目中*，以便您在 `qgis_data` 文件夹中有一个名为 `myProject.qgs` 的项目。
- en: How to do it...
  id: totrans-379
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'For this recipe, you need to set up a file object, set a resource path, and
    then read the file object that references the project file. To do this, you need
    to perform the following steps:'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个菜谱，你需要设置一个文件对象，设置资源路径，然后读取引用项目文件的文件对象。为此，你需要执行以下步骤：
- en: 'First, we import the core `Qt` library for the file object:'
  id: totrans-381
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们导入核心 `Qt` 库用于文件对象：
- en: '[PRE107]'
  id: totrans-382
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE107]'
- en: 'Next, we initiate the file object with the path to the project file:'
  id: totrans-383
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们使用项目文件的路径初始化文件对象：
- en: '[PRE108]'
  id: totrans-384
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE108]'
- en: 'Now, we access the project object:'
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们访问项目对象：
- en: '[PRE109]'
  id: totrans-386
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE109]'
- en: 'Then, we set the resource path for QGIS to find data and other files, in case
    the project was saved with relative paths instead of absolute paths:'
  id: totrans-387
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们为 QGIS 设置资源路径以便找到数据和其它文件，以防项目是以相对路径而不是绝对路径保存的：
- en: '[PRE110]'
  id: totrans-388
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE110]'
- en: 'Finally, we tell the project object to read the project file in order to load
    the map:'
  id: totrans-389
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们告诉项目对象读取项目文件以加载地图：
- en: '[PRE111]'
  id: totrans-390
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE111]'
- en: How it works...
  id: totrans-391
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: QGIS has a setting to save references to data and other files either as relative
    paths, which are relative to the project file, or absolute paths, which contain
    the full path. If the saved paths are absolute, PyQGIS will be unable to locate
    data sources. Setting the read path to the full system path of the project file
    ensures that QGIS can find all the referenced files in the project file, if they
    are saved as relative paths.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS 有一个设置，可以将对数据和其它文件的引用保存为相对路径，这些路径相对于项目文件，或者绝对路径，这些路径包含完整路径。如果保存的路径是绝对路径，PyQGIS
    将无法定位数据源。将读取路径设置为项目文件的完整系统路径确保 QGIS 可以找到项目文件中所有引用的文件，如果它们是以相对路径保存的。
