<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Data Creation and Editing</h1></div></div></div><p>In this chapter, we will first create some new vector layers and cover how to select features and take measurements. We will then continue with editing feature geometries and attributes. Then, we will reproject vector and raster data, and before we end this chapter, learn how to convert between different file formats with joining data from text files and spreadsheets to our spatial data.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Creating new vector layers</h1></div></div></div><p>In this exercise, we'll create a new layer from scratch. QGIS offers a wide range of functionalities<a id="id171" class="indexterm"/> to create different layers. The <strong>Layer</strong> | <strong>New</strong> menu lists functions to create new Shapefile and SpatiaLite layers, but we can also create new database tables using the DB Manager plugin. The interfaces differ slightly to accommodate the features supported by each format.</p><p>Let's create a new Shapefile<a id="id172" class="indexterm"/> to see how it works. A new Shapefile layer, which can be accessed by going to <strong>Layer</strong> | <strong>New</strong> or <em>Ctrl</em> + <em>Shift</em> + <em>N</em>, opens the New Vector Layer dialog with options for different geometry types, CRS, and attributes. The process itself is really fast because all mandatory fields already have default values. By default, it will create a new point layer with WGS84 CRS (unless specified otherwise in <strong>Settings</strong> | <strong>Options</strong> | <strong>CRS</strong>) and one integer field called <strong>id</strong>. We can simply click on <strong>OK</strong>, specify a filename, and a new layer appears in the layer list.</p><p>Next, we also create one line and one polygon layer. We'll add some extra fields to these layers. Besides integer fields, Shapefiles also support text and decimal values. To add a field, we only need to insert a name, select a type and width, and click on <strong>Add to attributes list</strong>. For decimal numbers, we also have to define the <strong>Precision</strong> value, which determines the number of digits after the comma. A <strong>Width</strong> value of <strong>3</strong> with a <strong>Precision</strong> value of <strong>1</strong> will allow a value range from -99.9 to + 99.9. The following screenshot shows the <strong>New Vector Layer</strong> dialog<a id="id173" class="indexterm"/> and the <strong>Attributes...</strong> window for my example polygon layer:</p><div><img src="img/7488_03_01.jpg" alt="Creating new vector layers"/></div><p>All of the new layers are empty so far, but we will create some features now. If we want to add features to <a id="id174" class="indexterm"/>a layer, we first have to enable editing for this layer. Editing can be turned on and off by selecting <strong>Layer</strong> | <strong>Toggle editing</strong>, <strong>Toggle editing</strong> <a id="id175" class="indexterm"/>in the layer name context menu, or with the <strong>Toggle editing</strong> button in the <strong>Digitizing</strong> toolbar<a id="id176" class="indexterm"/>. Notice how the layer's icon in the layer list changes to reflect whether editing is on or off. When we turn on editing for a layer, QGIS automatically enables the digitizing tools suitable for the layer's geometry type.</p><p>Now, we can use the <strong>Add Feature</strong> tool<a id="id177" class="indexterm"/> in the editing toolbar to create new features. To place a point, we simply click on the map. We are then prompted to fill out the attribute form, and once we click on <strong>OK</strong> the new feature is created. Like with points, we can create new lines and polygons by placing nodes onto the map. To finish a line or a polygon, we simply right-click on the map. Create some features in each layer and then save your changes. We can re-use these test layers in the upcoming exercises.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>New features and feature edits are saved permanently only after clicking on the <strong>Save Layer Edits</strong> button<a id="id178" class="indexterm"/> in the <strong>Digitizing</strong> toolbar<a id="id179" class="indexterm"/> or once we finish editing and confirm that we want to save.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Working with feature selection tools</h1></div></div></div><p>Selecting features is one of the core functions of any GIS, and it is useful to know them before we <a id="id180" class="indexterm"/>venture forward into editing geometries and attributes. Depending on the use case, selection tools come in many different flavors. QGIS offers three different kinds of tools to select features using the mouse, an expression, or another layer.</p><p>The first group of tools in the <strong>Attributes</strong> toolbar<a id="id181" class="indexterm"/> allows us to select features on the map using the mouse, either one at a time or by drawing different shapes such as rectangles or freehand areas around the features. All features that intersect with the drawn shape are selected. Holding down <em>Ctrl</em> will add the new selection to an existing one.</p><p>Similarly, holding down <em>Ctrl</em> + <em>Shift</em> will remove the new selection from the existing selection. The following screenshot shows the tools:</p><div><img src="img/7488_03_02.jpg" alt="Working with feature selection tools"/></div><p>The second type of select tool is called <strong>Select by Expression</strong>
<a id="id182" class="indexterm"/> and it is also available in the <strong>Attribute</strong> toolbar. It selects features based on expressions that can contain references and functions using feature attributes and/or geometry. The list of available functions is pretty long, but we can use the search box to filter the list by name to find the function we are looking for faster. On the right-hand side of the window, we find the <strong>Selected Function Help</strong>, which explains the functionality and how to use the function in an expression. The <strong>Function List</strong>
<a id="id183" class="indexterm"/> also shows the layer attribute fields, and by clicking on <strong>Load all unique values</strong> or <strong>Load 10 sample values</strong>, we can easily access their content. Like with the mouse tools, we can choose between creating a new selection or adding<a id="id184" class="indexterm"/> to or deleting from an existing selection. Additionally, we can choose to only select features from within an existing selection. Let's have a look at some example expressions that you can build on and use in your own work:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using the <code class="literal">lakes.shp</code> file<a id="id185" class="indexterm"/> in our sample data, we can, for example, select big lakes with an area bigger than 1,000 square miles using a simple attribute query: <code class="literal">"AREA_MI" &gt; 1000.0</code>, or by using geometry functions such as <code class="literal">$area &gt; (1000.0 * 27878400)</code>. Note that the <code class="literal">lakes.shp</code> CRS uses feet and we therefore have to multiply by 27,878,400 to convert from square feet to square miles.</li><li class="listitem" style="list-style-type: disc">We can also work with string functions, for example, to find lakes with long names: <code class="literal">length("NAMES") &gt; 12</code>, or lakes with names that contain an "s" or "S": <code class="literal">lower("NAMES") LIKE '%s%'</code>, which first converts the names to lower case and then looks for any appearance of "s". The dialog will look like the following screenshot:</li></ul></div><div><img src="img/7488_03_03.jpg" alt="Working with feature selection tools"/></div><p>The third type of tool allows us to select features in one layer based on their location relative <a id="id186" class="indexterm"/>to features in a second layer. These tools can be accessed by going to <strong>Vector</strong> | <strong>Research Tools</strong> | <strong>Select by location</strong> and <strong>Vector</strong> | <strong>Spatial Query</strong> | <strong>Spatial Query</strong>. Enable it in <strong>Plugin Manager</strong> if you cannot find it in the <strong>Vector</strong> menu. In general, we want to use the Spatial Query plugin as it supports a variety of spatial operations such as <strong>crosses</strong>, <strong>equals</strong>, <strong>intersects</strong>, <strong>is disjoint</strong>, <strong>overlaps</strong>, <strong>touches</strong>, and <strong>contains</strong> depending on the layer geometry type.</p><p>Let's test the Spatial Query plugin using <code class="literal">railroads.shp</code>
<a id="id187" class="indexterm"/> and <code class="literal">pipelines.shp</code>
<a id="id188" class="indexterm"/> from the sample data. For example, we might want to find all the railroad features that cross a pipeline; we therefore select the <strong>railroads</strong> layer, the <strong>Crosses</strong> operation, and the <strong>pipelines</strong> layer. After clicking on <strong>Apply</strong>, the plugin presents us the query results. There is a list of IDs of the result features on the right-hand side of the window as you can see in the following screenshot. Below this list, we can check the <strong>Zoom to item</strong> checkbox, and QGIS will zoom to the feature that belongs to the selected<a id="id189" class="indexterm"/> ID. Additionally, the plugin offers buttons to directly save all the resulting features to a new layer.</p><div><img src="img/7488_03_04.jpg" alt="Working with feature selection tools"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Editing vector geometries</h1></div></div></div><p>Now that<a id="id190" class="indexterm"/> we know how to create and select features, we can have a closer look at the other tools in the <strong>Digitizing</strong> and <strong>Advanced Digitizing</strong> toolbars. The Digitizing toolbar will look like the following screenshot:</p><div><img src="img/7488_03_05a.jpg" alt="Editing vector geometries"/></div><p>The basic <strong>Digitizing</strong> toolbar<a id="id191" class="indexterm"/> contains tools for creating and moving features and nodes, as well as for deleting, copying, cutting, and pasting features, as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">With the <strong>Move Feature(s)</strong> tool<a id="id192" class="indexterm"/>, it is easy to move<a id="id193" class="indexterm"/> one or more features at once by dragging them to the new location.</li><li class="listitem" style="list-style-type: disc">Similarly, the <strong>Node Tool</strong><a id="id194" class="indexterm"/> feature allows us to move one or more nodes of the same<a id="id195" class="indexterm"/> feature. The first<a id="id196" class="indexterm"/> click activates the feature, while the second click selects the node. Hold the mouse key down to drag the node to its new location. Instead of moving only one node, we can also move an edge by clicking and dragging the line. And finally, we can select and move multiple nodes by holding down <em>Ctrl</em>.</li><li class="listitem" style="list-style-type: disc"><strong>Delete Selected</strong>, <strong>Cut Features</strong>, and <strong>Copy Features</strong> are only active if one or more<a id="id197" class="indexterm"/> layer<a id="id198" class="indexterm"/> features<a id="id199" class="indexterm"/> are selected. Similarly, <strong>Paste Features</strong> only works after a feature has been cut or copied.<div><img src="img/7488_03_05b.jpg" alt="Editing vector geometries"/></div></li></ul></div><p>The <strong>Advanced Digitizing</strong> toolbar offers very useful <strong>Undo</strong> and <strong>Redo</strong> functionalities as well as additional tools for more involved geometry editing:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Rotate Feature(s)</strong> enables us to rotate one or more selected features around a <a id="id200" class="indexterm"/>central<a id="id201" class="indexterm"/> point.</li><li class="listitem" style="list-style-type: disc">Using the <strong>Simplify Feature</strong> tool, we can simplify/generalize feature geometries<a id="id202" class="indexterm"/> by simply<a id="id203" class="indexterm"/> clicking on the feature and pulling the tolerance slider in the pop-up window.</li><li class="listitem" style="list-style-type: disc">The following tools allow us to <strong>Add Rings</strong><a id="id204" class="indexterm"/>, also <a id="id205" class="indexterm"/>known as "holes", into<a id="id206" class="indexterm"/> existing polygons or <strong>Add Parts</strong> to existing polygons. And of course, there are tools to <strong>Delete Rings</strong> and <strong>Delete Parts</strong> as well.</li><li class="listitem" style="list-style-type: disc"><strong>Reshape Features</strong><a id="id207" class="indexterm"/> can be<a id="id208" class="indexterm"/> used to alter the geometry of a feature by either cutting out or adding pieces. You can control the behavior by starting to draw the new form inside the original feature to add a piece, or start outside to cut out a piece, as shown in the following example diagram:<div><img src="img/7488_03_06.jpg" alt="Editing vector geometries"/></div></li><li class="listitem" style="list-style-type: disc">The <strong>Offset Curve</strong> tool is only available for lines and allows us to displace a line <a id="id209" class="indexterm"/>geometry by a given<a id="id210" class="indexterm"/> offset.</li><li class="listitem" style="list-style-type: disc"><strong>Split Features</strong><a id="id211" class="indexterm"/> allows us to cut <a id="id212" class="indexterm"/>one or more features along a cut line.</li><li class="listitem" style="list-style-type: disc"><strong>Merge Selected Features</strong> enables us to merge multiple features while keeping<a id="id213" class="indexterm"/> control over which feature's attributes<a id="id214" class="indexterm"/> will be<a id="id215" class="indexterm"/> available in the output feature.</li><li class="listitem" style="list-style-type: disc">Similarly, <strong>Merge Attributes of Selected Features</strong> lets us combine the attributes of multiple features, but without merging them into one feature. Instead, all original features remain as they were, but the attribute values are updated.</li><li class="listitem" style="list-style-type: disc">Finally, <strong>Rotate Point Symbols</strong> is only available for point layers with the <strong>Rotation field</strong> feature<a id="id216" class="indexterm"/> enabled<a id="id217" class="indexterm"/> (which we will cover in <a class="link" href="ch05.html" title="Chapter 5. Creating Great Maps">Chapter 5</a>, <em>Creating Great Maps</em>).</li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Using the measuring tools</h1></div></div></div><p>Another core<a id="id218" class="indexterm"/> functionality of any GIS are the measurement tools. In QGIS, we find tools to measure lines, areas, and angles in the <strong>Attribute</strong> toolbar, as <a id="id219" class="indexterm"/>shown in the following screenshot:</p><div><img src="img/7488_03_07.jpg" alt="Using the measuring tools"/></div><p>The measurements are updated continuously while we draw measurement lines, areas, or angles. When we draw a line with multiple segments, the tool will show the length of each segment<a id="id220" class="indexterm"/> as well as the total length of all the segments put together. To stop measuring, we just right-click. If we want to change the measurement units from meters to feet or from degrees to radians, we can do that in <strong>Settings</strong> | <strong>Options</strong> | <strong>Map Tools</strong>.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Editing attributes</h1></div></div></div><p>There are three main use cases for attribute editing. First, we might want to edit the attributes of<a id="id221" class="indexterm"/> one specific feature, for example, to fix a wrong name. Second, we might want to edit attributes of a group of features. Or third, we might want to change the attributes of all the features within a layer. All these use cases are covered by functionality available through the attribute table. We can access it by going to <strong>Layer</strong> | <strong>Open Attribute Table</strong>, the <strong>Open Attribute Table</strong> button present in the <strong>Attributes</strong> toolbar, or in the layer name context menu.</p><p>To change attribute values, we always have to first enable editing. Then we can double-click on any cell in the attribute table to activate the input mode. Clicking on <em>Enter</em> confirms the change, but to save the new value permanently, we have to also click on the <strong>Save Edit(s)</strong> button<a id="id222" class="indexterm"/> or press <em>Ctrl</em> + <em>S</em>. In the bottom-right corner of the attribute table dialog, we can switch from the table to the form view, as shown in the following screenshot, and start editing there.</p><div><div><h3 class="title"><a id="tip09"/>Tip</h3><p>Another option for editing the attributes of one feature is to open the attribute form directly by clicking on the feature on the map using the <strong>Identify tool</strong>. By default, the <strong>Identify tool</strong>
<a id="id223" class="indexterm"/> displays the attribute values in the read mode, but we can enable <strong>Open feature form if a single feature is identified</strong> by going to <strong>Settings</strong> | <strong>Options</strong> | <strong>Map Tools</strong>.</p></div></div><div><img src="img/7488_03_08.jpg" alt="Editing attributes"/></div><div><div><h3 class="title"><a id="note06"/>Note</h3><p>In the<a id="id224" class="indexterm"/> attribute table, we also find tools to handle selections (from left to right starting at the third button): Delete selected features, Select by expression, Cancel the selection, Move selected features to the top of the table, Invert the selection, Pan to the selected features, Zoom to the selected features, and Copy the selected features. Another way to select features in the attribute table is to click on the row number.</p><p>The next two buttons allow us to add and remove columns. When we click on the delete column button, we get a list of columns to choose from. Similarly, the add columns button brings up a dialog to specify the name and data type of the new column.</p></div></div><p>If we want to change attributes of multiple or all features in a layer, editing them manually usually isn't an option. That is what <strong>Field Calculator</strong> is good for. We can access it using the <strong>Open field calculator</strong> button<a id="id225" class="indexterm"/> in the attribute table or using the <em>Ctrl</em> + <em>I</em> keys. In<a id="id226" class="indexterm"/> <strong>Field Calculator</strong>, we can choose to only update selected features or to update all the features in the layer. Besides updating an existing field, we can also create a new field. The function list is the same one we already explored when we selected features by expression. We can use any of these functions to populate a new field or update an existing one. Here are some example expressions that are used often:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We can create an <code class="literal">id</code> column using the <code class="literal">$rownum</code> function, which populates a column <a id="id227" class="indexterm"/>with the row numbers as shown in the following screenshot</li><li class="listitem" style="list-style-type: disc">Another common use case is to calculate line length or polygon area using the <a id="id228" class="indexterm"/>geometry<a id="id229" class="indexterm"/> functions <code class="literal">$length</code> and <code class="literal">$area</code> respectively</li><li class="listitem" style="list-style-type: disc">Similarly, we can get point coordinates using <code class="literal">$x</code> and <code class="literal">$y</code></li><li class="listitem" style="list-style-type: disc">If we want to get the start or end points of a line, we can use <code class="literal">xat(0)</code> and <code class="literal">yat(0)</code> or <code class="literal">xat(-1)</code> and <code class="literal">yat(-1)</code><div><img src="img/7488_03_09.jpg" alt="Editing attributes"/></div></li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Reprojecting and converting vector and raster data</h1></div></div></div><p>In <a class="link" href="ch02.html" title="Chapter 2. Viewing Spatial Data">Chapter 2</a>, <em>Viewing Spatial Data</em>, we talked about CRS and the fact that QGIS offers on-the-fly <a id="id230" class="indexterm"/>reprojection to display spatial datasets, which are stored<a id="id231" class="indexterm"/> in different CRS, in the same map. Still, in some cases, <a id="id232" class="indexterm"/>we will want to permanently reproject a dataset, for<a id="id233" class="indexterm"/> example to geoprocess it later on.</p><p>In QGIS, reprojecting a vector or raster layer is done by simply saving it with a new CRS. We can save a layer using <strong>Layer</strong> | <strong>Save as ...</strong> or <strong>Save as …</strong> in the layer name context menu. Pick a target file format and file name, and then click on the <strong>Browse</strong> button besides the CRS field to pick a new CRS.</p><p>Besides<a id="id234" class="indexterm"/> changing the CRS, the main use case of the Save vector/raster layer dialog is to convert between different file formats. For example, we can<a id="id235" class="indexterm"/> load a Shapefile and export it as GeoJSON, Mapinfo <a id="id236" class="indexterm"/>MIF, CSV, and so on, or the other way around.</p><p>The Save<a id="id237" class="indexterm"/> raster layer dialog is also a convenient way to clip/crop rasters by a bounding box, as we can specify which extent we want to save.</p><p>Similarly, for vector layers, there is <strong>Save selection as …</strong> in both the <strong>Layer</strong> menu and the layer name context menu, which will open the same kind of dialog, but it will only save the selected features.</p><div><img src="img/7488_03_10.jpg" alt="Reprojecting and converting vector and raster data"/></div><div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>Enabling <a id="id238" class="indexterm"/>
<strong>Add saved file to map</strong> (currently only <a id="id239" class="indexterm"/>available in the vector dialog) is very convenient<a id="id240" class="indexterm"/> because it saves us the effort to go and<a id="id241" class="indexterm"/> load the new file manually after it has been saved.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Joining tabular data</h1></div></div></div><p>In many real-life situations, we get additional non-spatial data in the form of spreadsheets or text<a id="id242" class="indexterm"/> files. The good news is we can load XLS files by simply dragging them into QGIS from the file browser or using <strong>Add Vector Layer</strong>. Don't let the wording fool you! It really works without any geometry data in the file. The file can even contain more than just one table. You will see the following dialog, which lets you choose which table(s) you want to load:</p><div><img src="img/7488_03_11.jpg" alt="Joining tabular data"/></div><p>QGIS<a id="id243" class="indexterm"/> will automatically recognize the names and data types of columns in an XLS table. It's quite easy to tell because numeric values are right-aligned in the attribute table as shown in the following screenshot:</p><div><img src="img/7488_03_12.jpg" alt="Joining tabular data"/></div><p>We can also load tabular data from delimited text files like we saw in <a class="link" href="ch02.html" title="Chapter 2. Viewing Spatial Data">Chapter 2</a>, <em>Viewing Spatial Data</em>, when we loaded a point layer from a delimited text file<a id="id244" class="indexterm"/>. To load a delimited text file that only contains tabular data but no geometry information, we just need to enable the <strong>No geometry</strong> (attribute table only) option.</p><p>After loading the tabular data from either the spreadsheet or text file, we can continue to join this non-spatial data to a vector layer. To do that, we go to the vector <strong>Layer Properties</strong> | <strong>Joins</strong> tab. There, we can add a new join by pressing the green plus button. All we have<a id="id245" class="indexterm"/> to do is select the tabular <strong>Join layer</strong> and <strong>Join field</strong> fields<a id="id246" class="indexterm"/> (of the tabular layer), which should contain values that match those in the <strong>Target field</strong>
<a id="id247" class="indexterm"/> field (of the vector layer). The page will look like the following screenshot.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>The way joins work in QGIS is that the join layer's attributes are appended to the original layer's attribute table. The number of features in the original layer is not changed. Whenever there is a match between the join and the target field, the attribute value will be filled; otherwise you'll see NULL entries.</p></div></div><div><img src="img/7488_03_13.jpg" alt="Joining tabular data"/></div><p>Once the join is added, we can see the extended attribute table and use the new appended attributes<a id="id248" class="indexterm"/> for styling and labeling.</p><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>You can save the joined layer permanently. Just use <strong>Save as …</strong> to create the new file.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Summary</h1></div></div></div><p>In this chapter, we covered how to create new layers from scratch. We used the tools to create and edit feature geometries in different ways. Then, we went into editing feature attributes of single features, feature selections, and whole layers. Next, we reprojected both vector and raster layers and also learned how to convert between different file formats. Finally, we finished this chapter on layer creation and editing by covering tabular data, how it can be loaded into QGIS, and how to join it to our spatial data.</p><p>In the following chapter, we will put our data to good use and learn how to perform different kinds of spatial analysis on raster and vector data.</p></div></body></html>