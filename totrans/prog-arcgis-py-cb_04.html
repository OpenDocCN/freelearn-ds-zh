<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 4. Automating Map Production and Printing"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Automating Map Production and Printing</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a list of layout elements</li><li class="listitem" style="list-style-type: disc">Assigning a unique name to layout elements</li><li class="listitem" style="list-style-type: disc">Restricting the layout elements returned by ListLayoutElements()</li><li class="listitem" style="list-style-type: disc">Updating the properties of layout elements</li><li class="listitem" style="list-style-type: disc">Getting a list of available printers</li><li class="listitem" style="list-style-type: disc">Printing maps with PrintMap()</li><li class="listitem" style="list-style-type: disc">Exporting a map to a PDF file</li><li class="listitem" style="list-style-type: disc">Exporting a map to an image file</li><li class="listitem" style="list-style-type: disc">Exporting a report</li><li class="listitem" style="list-style-type: disc">Building a map book with Data Driven Pages and ArcPy mapping</li><li class="listitem" style="list-style-type: disc">Publishing a map document to an ArcGIS Server service</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Introduction</h1></div></div></div><p>The <code class="literal">arcpy.mapping</code> module, released with ArcGIS 10, provides a number of capabilities<a id="id211" class="indexterm"/> related to the automation of map production. The <code class="literal">arcpy.mapping</code> module can be used to automate map production, build map books, export maps to image or PDF files, and create and manage PDF files. In this chapter, you'll learn how to use the <code class="literal">arcpy.mapping</code> module to automate various geoprocessing tasks related to map production and printing.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Creating a list of layout elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Creating a list of layout elements</h1></div></div></div><p>Often, the first step in a geoprocessing script that automates the production of maps is to generate a list of the available layout elements. For example, you might need to update the title of <a id="id212" class="indexterm"/>your map before printing or creating a PDF file. In this case, the title is likely be stored in a <code class="literal">TextElement</code> object. You can generate a list of <code class="literal">TextElement</code> objects in your map layout view and then change the title. The first step is to generate a list of <code class="literal">TextElement</code> objects.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec79"/>Getting ready</h2></div></div></div><p>In ArcMap, two<a id="id213" class="indexterm"/> views <a id="id214" class="indexterm"/>are available, namely <a id="id215" class="indexterm"/>data view<a id="id216" class="indexterm"/> and layout view. <span class="strong"><strong>Data view</strong></span> is used to view geographic and tabular data, analyze data, symbolize layers, and manage data without regard for any particular map page size or layout. <span class="strong"><strong>Layout view</strong></span> shows the map as printed on a page, and is used to create production quality maps through the addition of map elements. These elements include map frames, layers, legends, titles, north arrows, scale bars, and title blocks. Each object in the layout is represented in <code class="literal">arcpy.mapping</code> as a layout element class. Examples of many of these layout element classes are displayed in the following screenshot:</p><div class="mediaobject"><img src="images/B04314_04_1.jpg" alt="Getting ready"/></div><p>Each element can be assigned a unique name that can then be used to access the element programmatically. This unique name is defined in ArcMap. The <code class="literal">arcpy.mapping</code> module provides a <code class="literal">ListLayoutElements()</code> function that returns a list of all these elements. In this recipe, you will learn how to use the <code class="literal">ListLayoutElements()</code> function to generate a list of map<a id="id217" class="indexterm"/> layout elements.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec80"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to generate a list of layout elements:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>) and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Generate a list of layout elements and print them to the screen if the name property is not empty:<div class="informalexample"><pre class="programlisting">for el in mapping.ListLayoutElements(mxd):
  if el.name != '':
    print(el.name)</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
for el in mapping.ListLayoutElements(mxd):
  if el.name != '':
    print(el.name)</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\CreateListLayoutElements.py</code> solution file.</li><li class="listitem">Run the script to see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Crime_Inset</strong></span>
<span class="strong"><strong>Alternating Scale Bar</strong></span>
<span class="strong"><strong>Legend Test Performance</strong></span>
<span class="strong"><strong>Crime Legend</strong></span>
<span class="strong"><strong>North Arrow</strong></span>
<span class="strong"><strong>Inset_Map</strong></span>
<span class="strong"><strong>Test_Performance</strong></span>
<span class="strong"><strong>Crime</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec81"/>How it works…</h2></div></div></div><p>
<code class="literal">ListLayoutElements()</code> returns a list of layout elements in the form of various layout classes. Each element can be one of the <code class="literal">GraphicElement</code>, <code class="literal">LegendElement</code>, <code class="literal">PictureElement</code>, <code class="literal">TextElement</code>, or <code class="literal">MapSurroundElement</code> object instances. Each element <a id="id218" class="indexterm"/>can have a unique name. You don't have to assign a name to each element, but it is helpful to do so if you plan to access these elements programmatically in your scripts. In this script, we first made sure that the element had a name assigned to it before printing the name. This was done because ArcMap does not require that an element be assigned a name.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Assigning a unique name to layout elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Assigning a unique name to layout elements</h1></div></div></div><p>It's a good practice to assign a unique name to all your layout elements using ArcMap. This is important in the event that your geoprocessing scripts need to access a particular element to <a id="id219" class="indexterm"/>make changes. For example, you might need <a id="id220" class="indexterm"/>to update the icon that displays your corporate logo. Rather than making this change manually in all your map document files, you could write a geoprocessing script that updates all your map document files programmatically with the new logo. However, in order for this to be possible, a unique name will need to be assigned to your layout elements. This gives you the ability to access the elements of your layout individually.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec82"/>Getting ready</h2></div></div></div><p>As I mentioned in the previous recipe, each layout element will be one of a number of element types and each can be assigned a name. This element name can then be used when you need to reference a particular element in your Python script. You can use ArcMap to assign unique names to each layout element. In this recipe, you will use ArcMap to assign names to the elements.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec83"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to assign unique names to each layout element using ArcMap:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Switch to the layout view and you should see something similar to this screenshot:<div class="mediaobject"><img src="images/B04314_04_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Names <a id="id221" class="indexterm"/>are assigned differently <a id="id222" class="indexterm"/>depending on the element type. Click on the uppermost data frame, which should be <span class="strong"><strong>Crime</strong></span>, to select it. The selection handles should appear as follows:<div class="mediaobject"><img src="images/B04314_04_3.jpg" alt="How to do it…"/></div></li><li class="listitem">Right-click <a id="id223" class="indexterm"/>on the upper data frame<a id="id224" class="indexterm"/> and select <span class="strong"><strong>Properties</strong></span> to display the <span class="strong"><strong>Data Frame Properties</strong></span> window, as shown in the following screenshot. The <span class="strong"><strong>Element Name</strong></span> property is what defines the unique name for the element and is found on the <span class="strong"><strong>Size and Position</strong></span> tab as seen in the following screenshot. In this case, set the element name to <code class="literal">Crime</code>:<div class="mediaobject"><img src="images/B04314_04_4.jpg" alt="How to do it…"/></div></li><li class="listitem">Close<a id="id225" class="indexterm"/> the <span class="strong"><strong>Data Frame Properties</strong></span> window.</li><li class="listitem">Select <a id="id226" class="indexterm"/><span class="strong"><strong>2009 Crime Data legend</strong></span> and open the <span class="strong"><strong>Properties</strong></span> window by right-clicking on the legend and selecting <span class="strong"><strong>Properties</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Size and Position</strong></span> tab.</li><li class="listitem">Change the <span class="strong"><strong>Element Name</strong></span> value to <code class="literal">Crime Legend</code>, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_04_5.jpg" alt="How to do it…"/></div></li><li class="listitem">You can <a id="id227" class="indexterm"/>also define unique names<a id="id228" class="indexterm"/> for text elements. Select the title element (<code class="literal">Crime and Its Impact on School Test Performance</code>), right-click on the element, and select <span class="strong"><strong>Properties</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Size and Position</strong></span> tab and define a unique name for this element, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_04_6.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec84"/>How it works…</h2></div></div></div><p>Each element <a id="id229" class="indexterm"/>in the layout view can be assigned a <a id="id230" class="indexterm"/>name, which can then be used in your geoprocessing script to retrieve the specific element. You should strive to define unique names for each element. It isn't required that you define a unique name for each element, nor is it required that you even define a name at all. However, it is a best practice to give each element a name and ensure that each name is unique if you intend to access these elements from your Python scripts. In terms of naming practices for your elements, you should strive to include only letters and underscores in the name.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec85"/>There's more…</h2></div></div></div><p>You can <a id="id231" class="indexterm"/>use element names in conjunction <a id="id232" class="indexterm"/>with the <code class="literal">ListLayoutElements()</code> function to restrict the elements that are returned by the function through the use of a wildcard parameter. In the next recipe, you'll learn how to restrict the list of layout elements that are returned through the use of wildcards and element types.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Restricting the layout elements returned by ListLayoutElements()"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Restricting the layout elements returned by ListLayoutElements()</h1></div></div></div><p>Layouts can contain a large number of elements, many of which you won't need for a particular geoprocessing script. The <code class="literal">ListLayoutElements()</code> function can restrict the layout <a id="id233" class="indexterm"/>elements returned, by<a id="id234" class="indexterm"/> passing a parameter that defines the type of element that should be returned along with an optional wildcard, which finds elements using a portion of the name.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec86"/>Getting ready</h2></div></div></div><p>There are many different types of layout elements, including graphics, legends, pictures, text, and data frames. When you return a list of layout elements, you can restrict (filter) the types of elements that are returned. In this recipe, you will write a script that filters the layout elements returned by element type and wildcard.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec87"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to restrict the list of layers returned by the <code class="literal">ListLayoutElements()</code> function through the use of optional parameters, which define the type of element that should be returned along with a wildcard that can also restrict the elements that are returned:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>) and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Use the <code class="literal">ListLayoutElements()</code> function with a restriction of only legend elements, as well as a wildcard that returns elements with a name containing the <code class="literal">Crime</code> text anywhere in the name:<div class="informalexample"><pre class="programlisting">for el in mapping.ListLayoutElements(mxd,"LEGEND_ELEMENT","*Crime*"):
  print(el.name)</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\RestrictLayoutElements.py</code> solution file.</li><li class="listitem">Run the script. In this case, only a single layout element will be returned:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Crime Legend</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec88"/>How it works...</h2></div></div></div><p>
<code class="literal">ListLayoutElements()</code> is a versatile function, which in its most basic form is used to return a <a id="id235" class="indexterm"/>list of all the <a id="id236" class="indexterm"/>layout elements on the page layout of a map document. However, there are two optional parameters that you can supply to filter this list. The first type of filter is an element type filter in which you specify that you only want to return one of the layout element types. You can also apply a wildcard to filter the returned list. These two types of filters can be used in combination. For example, in this recipe, we are specifying that we only want to return <code class="literal">LEGEND_ELEMENT</code> objects with the <code class="literal">Crime</code> text anywhere in the element name. This results in a highly filtered list that only contains a single layout element.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>
<code class="literal">ListLayoutElements()</code> can be filtered using one of these element types: <code class="literal">DATAFRAME_ELEMENT</code>, <code class="literal">GRAPHIC_ELEMENT</code>, <code class="literal">LEGEND_ELEMENT</code>, <code class="literal">MAPSURROUND_ELEMENT</code>, <code class="literal">PICTURE_ELEMENT</code>, or <code class="literal">TEXT_ELEMENT</code>.</p></div></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Updating the properties of layout elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Updating the properties of layout elements</h1></div></div></div><p>Each layout<a id="id237" class="indexterm"/> element has a set of properties that you can update programmatically. For example, <code class="literal">LegendElement</code> includes properties that allow you to change the position of the legend on the page, update the legend title, and access legend items.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec89"/>Getting ready</h2></div></div></div><p>There are many different types of layout elements, including graphics, legends, text, maps, and pictures. Each of these elements is represented by a class in the <code class="literal">arcpy.mapping</code> package. These classes provide various properties that you can use to programmatically alter the element.</p><p>The <code class="literal">DataFrame</code> class provides access to the data frame properties in the map document file. This object can work with both map units and page layout units, depending on the property <a id="id238" class="indexterm"/>being used. Page layout properties, such as positioning and sizing, can be applied to the properties, including <code class="literal">elementPositionX</code>, <code class="literal">elementPositionY</code>, <code class="literal">elementWidth</code>, and <code class="literal">elementHeight</code>.</p><p>The <code class="literal">GraphicElement</code> object is a generic object for various graphics that can be added to the page layout, including tables, graphs, neatlines, markers, lines, and area shapes. You'll want to make sure that you set the <code class="literal">name</code> property for each graphic element (and any other element for that matter), if you intend to access it through a Python script.</p><p>
<code class="literal">LegendElement</code> provides operations to position the legend on the page layout, modification of the legend title, and also provides access to the legend items and the parent data frame. <code class="literal">LegendElement</code> can only be associated with a single data frame.</p><p>
<code class="literal">MapSurroundElement</code> can refer to north arrows, scale bars, and scale text. It is similar to <code class="literal">LegendElement</code> and is associated with a single data frame. Properties on this object enable repositioning of the element on the page.</p><p>
<code class="literal">PictureElement</code> represents a raster or image on the page layout. The most useful property of this object enables acquiring and setting the data sources, which can be extremely helpful when you need to change a picture, such as a logo, in multiple map documents. For example, you could write a script that iterates through all your map document files and replaces the current logo with a new logo. You can also reposition or resize the object.</p><p>
<code class="literal">TextElement</code> represents text on a page layout, including inserted text, callouts, rectangle text, and titles, but does not include legend titles or texts that are part of a table or chart. Properties enable the modification of a text string, which can be extremely useful in situations where you need to make the same text string change in multiple places in the page layout or over multiple map documents, and of course, repositioning of the object is also available.</p><p>Each element in the page layout is returned as an instance of one of the element objects. In this recipe, we're going to use the <code class="literal">title</code> property of the <code class="literal">Legend</code> object to programmatically change the title of the <code class="literal">Crime</code> legend and obtain a list of the layers that are part of the legend.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec90"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to update the properties of a layout element:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>), and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Use the <code class="literal">ListLayoutElements()</code> method with a wildcard and restriction of only<a id="id239" class="indexterm"/> legend elements to return only the <code class="literal">Crime</code> legend and store it in a variable:<div class="informalexample"><pre class="programlisting">elLeg = mapping.ListLayoutElements(mxd, "LEGEND_ELEMENT","*Crime*")[0]</pre></div></li><li class="listitem">Use the <code class="literal">title</code> property to update the title of the legend:<div class="informalexample"><pre class="programlisting">elLeg.title = "Crimes by School District"</pre></div></li><li class="listitem">Get a list of the layers that are a part of the legend and print the names:<div class="informalexample"><pre class="programlisting">for item in elLeg.listLegendItemLayers():
  print(item.name)</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
elLeg = mapping.ListLayoutElements(mxd, "LEGEND_ELEMENT","*Crime*")[0]
elLeg.title = "Crimes by School District"
for item in elLeg.listLegendItemLayers():
  print(item.name)</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\UpdateLayoutElementProperties.py</code> solution file.</li><li class="listitem">Run the script. You should see the following layers printed:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Burglaries in 2009</strong></span>
<span class="strong"><strong>Crime Density by School District</strong></span>
</pre></div></li><li class="listitem">The change is displayed in the following screenshot:<div class="mediaobject"><img src="images/B04314_04_7.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec91"/>How it works...</h2></div></div></div><p>Each <a id="id240" class="indexterm"/>of the layout elements has a set of properties and methods. In this particular case, we've used the <code class="literal">title</code> property on the <code class="literal">Legend</code> object. Other properties of this object allow you to set the width and height, positioning, and so on. Methods used for the <code class="literal">Legend</code> object give you the ability to adjust the column count, list the legend items, and remove and update items.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Getting a list of available printers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Getting a list of available printers</h1></div></div></div><p>Yet another list function provided by <code class="literal">arcpy</code> is <code class="literal">ListPrinterNames()</code>, which generates a list of the <a id="id241" class="indexterm"/>available printers. As is the case with the other list functions that we've examined, <code class="literal">ListPrinterNames()</code> is often called a preliminary step in a multistep script.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec92"/>Getting ready</h2></div></div></div><p>Before printing maps with the <code class="literal">PrintMap()</code> function, it is a common practice to call the <code class="literal">ListPrinterNames()</code> function, which returns a list of the available printers for the local computer. A particular printer can then be found by iterating the list of printers and using it as an input for the <code class="literal">PrintMap()</code> function.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec93"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to use the <code class="literal">ListPrinterNames()</code> function to return a list of the <a id="id242" class="indexterm"/>available printers for your script:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>) and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Call the <code class="literal">ListPrinterNames()</code> function and print each printer:<div class="informalexample"><pre class="programlisting">for printerName in mapping.ListPrinterNames():
  print(printerName)</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\GetListOfPrinters.py</code> solution file.</li><li class="listitem">Run the script. The output will vary depending upon the list of available printers for your computer. However, it should print something similar to the following code snippet:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>HP Photosmart D110 series</strong></span>
<span class="strong"><strong>HP Deskjet 3050 J610 series (Network)</strong></span>
<span class="strong"><strong>HP Deskjet 3050 J610 series (Copy 1)</strong></span>
<span class="strong"><strong>HP Deskjet 3050 J610 series</strong></span>
<span class="strong"><strong>Dell 968 AIO Printer</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec94"/>How it works...</h2></div></div></div><p>The <code class="literal">ListPrinterNames()</code> function returns a Python list containing all the printers available to use in your script. You can then use the <code class="literal">PrintMap()</code> function, which we'll examine in the next recipe, to send a print job to a particular printer that is available for your computer.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Printing maps with PrintMap()"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Printing maps with PrintMap()</h1></div></div></div><p>Sending <a id="id243" class="indexterm"/>your map layout to a printer is easy with <a id="id244" class="indexterm"/>the <code class="literal">PrintMap()</code> function. By default, the print job will be sent to the default printer saved with the map document, but you can also define a specific printer to which the job should be sent.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec95"/>Getting ready</h2></div></div></div><p>The <code class="literal">arcpy.mapping</code> module provides a <code class="literal">PrintMap()</code> function to print page layouts or data frames from ArcMap. Before calling <code class="literal">PrintMap()</code>, it is a common practice to call the <code class="literal">ListPrinterNames()</code> function, which returns a list of the available printers for the local computer. A particular printer can then be found by iterating the list of printers that can be used as an input for the <code class="literal">PrintMap()</code> function.</p><p>
<code class="literal">PrintMap()</code> can<a id="id245" class="indexterm"/> print either a specific data frame <a id="id246" class="indexterm"/>or the page layout of a map document. By default, this function will use the printer saved with the map document or, the default system printer in the map document. As I mentioned earlier, you can also use <code class="literal">ListPrinterNames()</code> to get a list of the available printers, and select one of these printers as an input for <code class="literal">PrintMap()</code>. In this recipe, you will learn how to use the <code class="literal">PrintMap()</code> function to print the layout.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec96"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to use the <code class="literal">PrintMap()</code> function to print the layout view in ArcMap:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>), and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Look for the <code class="literal">Test_Performance</code> data frame and print it if it's found:<div class="informalexample"><pre class="programlisting">for df in mapping.ListDataFrames(mxd):
  if df.name == "Test_Performance":
    mapping.PrintMap(mxd,"",df)</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\PrintingWithPrintMap.py</code> solution file.</li><li class="listitem">Run the script. The script should send the data frame to the default printer.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec97"/>How it works...</h2></div></div></div><p>The <code class="literal">PrintMap()</code> function accepts one required parameter and a handful of optional parameters. The required parameter is a reference to the map document. The first optional parameter is the printer name. In this case, we haven't specified a particular printer to use. Since we haven't provided a specific printer; it will use the printer saved with the map document or the default system printer if a printer is not part of the map document. The second <a id="id247" class="indexterm"/>optional parameter is the data frame that <a id="id248" class="indexterm"/>we'd like to print, which in this instance is <code class="literal">Test_Performance</code>. Other optional parameters, not supplied in this case, are an output print file and image quality.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Exporting a map to a PDF file"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec38"/>Exporting a map to a PDF file</h1></div></div></div><p>Rather than <a id="id249" class="indexterm"/>sending your map or layout view to a printer, you <a id="id250" class="indexterm"/>may want to simply create PDF files that can be shared. ArcPy mapping provides an <code class="literal">ExportToPDF()</code> function, which you can use to do this.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec98"/>Getting ready</h2></div></div></div><p>PDF is a very popular interchange format designed to be viewable and printable from many different platforms. The ArcPy mapping <code class="literal">ExportToPDF()</code> function can be used to export data frames or the page layout to a PDF format. By default, the <code class="literal">ExportToPDF()</code> function exports the page layout, but you can pass an optional parameter that references a particular data frame, which can be printed instead of the page layout. In this recipe, you will learn how to export the page layout as well as a specific data frame to a PDF file.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec99"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to export a map to a PDF file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>), and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument('CURRENT')</pre></div></li><li class="listitem">Export the page layout with the <code class="literal">ExportToPDF()</code> function:<div class="informalexample"><pre class="programlisting">mapping.ExportToPDF(mxd,r"c:\ArcpyBook\Ch4\Map_PageLayout.pdf")</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\ExportToPDF_Step1.py</code> solution file.</li><li class="listitem">Run the script.</li><li class="listitem">Open the <code class="literal">Map_PageLayout.pdf</code> file that was created, and you should see something similar to the following screenshot:<div class="mediaobject"><img src="images/B04314_04_8.jpg" alt="How to do it…"/></div></li><li class="listitem">Now, we'll<a id="id251" class="indexterm"/> print a specific data frame from our<a id="id252" class="indexterm"/> map document file. Alter your script, so that it appears as follows. You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\ExportToPDF_Step2.py</code> solution file.<div class="mediaobject"><img src="images/B04314_04_14.jpg" alt="How to do it…"/></div></li><li class="listitem">Run the script and examine the output of the PDF file.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec100"/>How it works…</h2></div></div></div><p>The <code class="literal">ExportToPDF()</code> function requires two parameters, including a reference to the map document and<a id="id253" class="indexterm"/> the file that serves as the output PDF file. The first <a id="id254" class="indexterm"/>script that we developed was passed in a reference to the map document along with an output PDF file. Since we didn't pass in an optional parameter specifying the data frame, the <code class="literal">ExportToPDF()</code> function will export the page layout. There are also many optional parameters that can be passed into this method, including a specific data frame and a number of parameters mostly related to the quality of the output content and file. Our second script is passed in a specific data frame that should be exported. You can refer to the ArcGIS help pages for more information about each of the optional parameters.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Exporting a map to an image file"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec39"/>Exporting a map to an image file</h1></div></div></div><p>You can also <a id="id255" class="indexterm"/>export the contents of the map or layout view to an<a id="id256" class="indexterm"/> image file by using one of the many functions provided by <code class="literal">arcpy.mapping</code>. Each image export function will differ in its name depending upon the type of image file you'd like to create. The parameters passed into the function will also vary slightly.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec101"/>Getting ready</h2></div></div></div><p>In addition to providing the ability to export data frames and the page layout to a PDF format, you can also use one of the many export functions provided by <code class="literal">arcpy.mapping</code> to export an image file. Some of the available formats include AI, BMP, EMF, EPS, GIF, JPEG, SVG, and TIFF. The parameters provided for each function will vary depending on the type of image. Some examples of these function names include <code class="literal">ExportToJPEG()</code>, <code class="literal">ExportToGIF()</code>, and <code class="literal">ExportToBMP()</code>. In this recipe, you'll learn how to export your maps to images.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec102"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to export your data or layout view to an image file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch4\Crime_Ch4.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch4.mxd</code>), and assign this reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a list of data frames in the map document and find the data frame with the name "<code class="literal">Crime</code>".<div class="informalexample"><pre class="programlisting">for df in mapping.ListDataFrames(mxd):
     if df.name == "Crime":</pre></div></li><li class="listitem">Export the <code class="literal">Crime</code> data frame as a JPEG image. Your entire script should now appear as follows:<div class="mediaobject"><img src="images/B04314_04_15.jpg" alt="How to do it…"/></div></li><li class="listitem">You <a id="id257" class="indexterm"/>can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\ExportMapImageFile.py</code> solution file.</li><li class="listitem">Run <a id="id258" class="indexterm"/>the script and examine the output file.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec103"/>How it works…</h2></div></div></div><p>Note that the <code class="literal">ExportToJPEG()</code> function looks virtually the same as <code class="literal">ExportToPDF()</code>. Keep in mind though that the optional parameters will be different for all the export functions. Each <code class="literal">ExportTo&lt;Type&gt;</code> function will vary depending on the parameters that can be used in the creation of the image file.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Exporting a report"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Exporting a report</h1></div></div></div><p>Reports<a id="id259" class="indexterm"/> in ArcGIS provide you with a way of presenting information about your data or analysis. Information in a report is displayed by using information pulled directly from an attribute table<a id="id260" class="indexterm"/> in a feature class or a standalone table. Reports can contain attribute information, maps, pictures, graphics, and other supporting information. ArcMap includes a <span class="strong"><strong>Report Wizard</strong></span> and <span class="strong"><strong>Report Designer</strong></span> that you can use to create and modify reports. You can also save the format of a report to a template file. This template file can be used repeatedly to generate new reports based on any changes in your data. Using a combination of a report template along with <code class="literal">arcpy.mapping</code>, you can automate the production of reports.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec104"/>Getting ready</h2></div></div></div><p>The <span class="strong"><strong>Report Wizard</strong></span> in ArcGIS can be used to create reports. There are two native data formats for <a id="id261" class="indexterm"/>ArcGIS reports: <span class="strong"><strong>Report Document File</strong></span> (<span class="strong"><strong>RDF</strong></span>) and <span class="strong"><strong>Report Layout File</strong></span> (<span class="strong"><strong>RLF</strong></span>). RDF reports provide a static report of your data. A <a id="id262" class="indexterm"/>one-time snapshot, if you will. A RLF is a template file and is created using <span class="strong"><strong>Report Designer</strong></span>. The report template file can be used repeatedly and includes all the fields in the report along with how they are grouped, sorted, and formatted. It also includes any layout elements, such as graphics or maps. When the report is rerun, the report regenerates based on the source data that is connected to the template. The <code class="literal">arcpy.mapping ExportReport()</code> function can be used to connect a data source to a template file to automate the creation of a report. In this recipe, you will learn how to use the <code class="literal">ExportReport()</code> function with the <code class="literal">PDFDocument</code> class to create a report that contains crime information for school districts. The report will include attribute information and a map of the boundaries of the school district.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec105"/>How to do it…</h2></div></div></div><p>To save <a id="id263" class="indexterm"/>some time on this recipe, I have precreated a report template (RLF) file for you to use. This file, called <code class="literal">CrimeReport.rlf</code>, is located in the <code class="literal">c:\ArcpyBook\Ch4</code> folder and contains attribute columns for the name of the school district, number of crimes, crime density, and test performance scores. In addition to this, a placeholder for a map containing the boundaries of the school district has also been added to the template.</p><p>Follow these steps to learn how to automate the production of reports using the <code class="literal">arcpy.mapping ExportReport()</code> function and the <code class="literal">PDFDocument</code> class:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new script file in IDLE or your favorite Python editor and save it as <code class="literal">c:\ArcpyBook\Ch4\CreateReport.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> and <code class="literal">os</code> modules and get the current working directory:<div class="informalexample"><pre class="programlisting">import arcpy
import os
path = os.getcwd()</pre></div></li><li class="listitem">Create the output PDF file:<div class="informalexample"><pre class="programlisting">#Create PDF and remove if it already exists
pdfPath = path + r"\CrimeReport.pdf"
if os.path.exists(pdfPath):
  os.remove(pdfPath)
pdfDoc = arcpy.mapping.PDFDocumentCreate(pdfPath)</pre></div></li><li class="listitem">Create a list of school districts. We'll loop through this list to create reports for each district:<div class="informalexample"><pre class="programlisting">districtList = ["Harlandale", "East Central", "Edgewood", "Alamo Heights", "South San Antonio", "Southside", "Ft Sam Houston", "North East", "Northside", "Lackland", "Southwest", "Judson", "San Antonio"]</pre></div></li><li class="listitem">Get references to the map document, data frame, and layer:<div class="informalexample"><pre class="programlisting">mxd = arcpy.mapping.MapDocument(path + r"\Crime_Ch4.mxd")
df = arcpy.mapping.ListDataFrames(mxd)[0]
lyr = arcpy.mapping.ListLayers(mxd, "Crime Density by School District")[0]</pre></div></li><li class="listitem">Start a loop through the school districts and apply a <code class="literal">where</code> clause that acts as the definition query so that only the individual school district will be displayed:<div class="informalexample"><pre class="programlisting">pageCount = 1
for district in districtList:
  #Generate image for each district
  whereClause = "\"NAME\" = '" + district + " ISD'"
  lyr.definitionQuery = whereClause</pre></div></li><li class="listitem">Select the<a id="id264" class="indexterm"/> individual school district, set the data frame extent to the extent of the school district, and clear the selection set:<div class="informalexample"><pre class="programlisting">arcpy.SelectLayerByAttribute_management(lyr, "NEW_SELECTION", whereClause)
df.extent = lyr.getSelectedExtent()
arcpy.SelectLayerByAttribute_management(lyr, "CLEAR_SELECTION")</pre></div></li><li class="listitem">Export the data frame to a bitmap (<code class="literal">.bmp</code>) file:<div class="informalexample"><pre class="programlisting">arcpy.mapping.ExportToBMP(mxd, path + "\DistrictPicture.bmp", df) #single file</pre></div></li><li class="listitem">Call the <code class="literal">ExportReport()</code> function to create the report:<div class="informalexample"><pre class="programlisting">#Generate report
print("Generating report for: " + district + " ISD")
arcpy.mapping.ExportReport(report_source=lyr, report_layout_file=path + r"\CrimeLayout.rlf",output_file=path + r"\temp" + str(pageCount) + ".pdf", starting_page_number=pageCount)</pre></div></li><li class="listitem">Append the report to the PDF file:<div class="informalexample"><pre class="programlisting">#Append pages into final output
print("Appending page: " + str(pageCount))
pdfDoc.appendPages(path + r"\temp" + str(pageCount) + ".pdf")</pre></div></li><li class="listitem">Remove the temporary PDF report:<div class="informalexample"><pre class="programlisting">os.remove(path + r"\temp" + str(pageCount) + ".pdf")
pageCount = pageCount + 1</pre></div></li><li class="listitem">Save the PDF document:<div class="informalexample"><pre class="programlisting">pdfDoc.saveAndClose()</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="mediaobject"><img src="images/B04314_04_16.jpg" alt="How to do it…"/></div></li><li class="listitem">You can<a id="id265" class="indexterm"/> check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\CreateReport.py</code> solution file.</li><li class="listitem">Save and run your script. This will create a file called <code class="literal">CrimeReport.pdf</code> in your <code class="literal">c:\ArcpyBook\ch4</code> folder. The contents will contain one report page for each school district, as seen in this screenshot:<div class="mediaobject"><img src="images/B04314_04_13.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec106"/>How it works…</h2></div></div></div><p>In this<a id="id266" class="indexterm"/> recipe, we used several functions and classes that are part of the <code class="literal">arcpy.mapping</code> module, including <code class="literal">PDFDocument</code>, <code class="literal">ExportToReport()</code> and <code class="literal">ExportToBMP()</code>. Initially, we used the <code class="literal">PDFDocumentCreate()</code> function to create an instance of <code class="literal">PDFDocument</code>, which holds a pointer to the <code class="literal">CrimeReport.pdf</code> file that we'll create. Next, we created a list of school districts and began a loop through each of them. Inside the loop, for each district, we set a definition query on the layer, selected the district, and returned the extent of the district that was used to set the extent of the data frame. A bitmap file was then created using the <code class="literal">ExportToBMP()</code> function and the report was generated with the <code class="literal">ExportReport()</code> function. Finally, each page was appended to the <code class="literal">CrimeReport.pdf</code> file<a id="id267" class="indexterm"/> and the document was saved.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Building a map book with Data Driven Pages and ArcPy mapping"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Building a map book with Data Driven Pages and ArcPy mapping</h1></div></div></div><p>Many organizations have a need to create map books containing a series of individual maps that <a id="id268" class="indexterm"/>cover a larger geographical area. These<a id="id269" class="indexterm"/> map books contain a series of maps and <a id="id270" class="indexterm"/>some optional and additional <a id="id271" class="indexterm"/>pages, including title pages, an overview map, and some other ancillary information, such as reports and tables. For example, a utility company might want to generate a map book detailing their assets across a service area. A map book for this utility company could include a series of maps, each at a large scale, along with a title page and an overview map. These resources would then be joined together into a single document that could be printed or distributed as a PDF file.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec107"/>Getting ready</h2></div></div></div><p>ArcGIS for Desktop provides the ability to efficiently create a map book through a combination of<a id="id272" class="indexterm"/> Data Driven Pages along with an <code class="literal">arcpy.mapping</code> script. With a single map document file, you can use the <span class="strong"><strong>Data Driven Pages</strong></span> toolbar to create a basic series of maps using the layout view along with your operational data and an <code class="literal">index</code> layer. The <code class="literal">index</code> layer contains features that will be used to define the extent of each map in the series. However, if you need to include additional pages in the map book, including a title page, an overview map, and other ancillary pages, you'll need to combine the output from the Data Driven Pages toolbar with the functionality provided by the <code class="literal">arcpy.mapping</code> module. With the <code class="literal">arcpy.mapping</code> module, you can automate the export of the map series and append the ancillary files to a single map book document. While it is certainly possible to programmatically generate the entire map book using only Python and the <code class="literal">arcpy.mapping</code> module, it is more efficient to use a combination of programming and the Data Driven Pages toolbar. In this recipe, you'll learn how to create a map book that includes a series of maps along with a title page and an overview map page.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec108"/>How to do it…</h2></div></div></div><p>To save some time on this recipe, I have precreated a map document file for you that contains the data and Data Driven Pages functionality to create a series of topographic maps for King County, Washington. This map document file, called <code class="literal">Topographic.mxd</code>, can be found in the <code class="literal">c:\ArcpyBook\Ch4</code> folder. You may want to take a few moments to open this file in ArcGIS for Desktop and examine the data. The Data Driven Pages functionality has already been enabled for you. Additionally, a map title page (<code class="literal">TitlePage.pdf</code>) and an overview map page (<code class="literal">MapIndex.pdf</code>) have also been created for you. These files are also located in your <code class="literal">c:\ArcpyBook\Ch4</code> folder.</p><p>The steps to generate a map series can be somewhat lengthy, and are beyond the scope of this book. However, if you'd like an overview of the process, go to the <span class="strong"><strong>ArcGIS Desktop Help</strong></span> system, navigate to <span class="strong"><strong>Desktop</strong></span> | <span class="strong"><strong>Mapping</strong></span> | <span class="strong"><strong>Page layouts</strong></span> | <span class="strong"><strong>Creating a Map Book</strong></span>, and follow <a id="id273" class="indexterm"/>the first seven items under this folder. This<a id="id274" class="indexterm"/> includes building map books <a id="id275" class="indexterm"/>with ArcGIS through adding<a id="id276" class="indexterm"/> dynamic text to your map book.</p><p>Follow these steps to learn how to use the Data Driven Pages functionality and the <code class="literal">arcpy.mapping</code> module to create a map book:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new IDLE script and save it as <code class="literal">c:\ArcpyBook\Ch4\DataDrivenPages_MapBook.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> and <code class="literal">os</code> modules:<div class="informalexample"><pre class="programlisting">import arcpy
import os</pre></div></li><li class="listitem">Create an output directory variable:<div class="informalexample"><pre class="programlisting"># Create an output directory variable
outDir = r"C:\ArcpyBook\Ch4"</pre></div></li><li class="listitem">Create a new, empty PDF document in the specified output directory:<div class="informalexample"><pre class="programlisting"># Create a new, empty pdf document in the specified output directory
finalpdf_filename = outDir + r"\MapBook.pdf"
if os.path.exists(finalpdf_filename):
  os.remove(finalpdf_filename)
finalPdf = arcpy.mapping.PDFDocumentCreate(finalpdf_filename)</pre></div></li><li class="listitem">Add the title page to the PDF:<div class="informalexample"><pre class="programlisting"># Add the title page to the pdf
print("Adding the title page  \n")
finalPdf.appendPages(outDir + r"\TitlePage.pdf")</pre></div></li><li class="listitem">Add the index map to the PDF:<div class="informalexample"><pre class="programlisting"># Add the index map to the pdf
print("Adding the index page  \n")
finalPdf.appendPages(outDir + r"\MapIndex.pdf")</pre></div></li><li class="listitem">Export the Data Driven Pages to a temporary PDF and then add it to the final PDF:<div class="informalexample"><pre class="programlisting"># Export the Data Driven Pages to a temporary pdf and then add it to the
# final pdf. Alternately, if your Data Driven Pages have already been
# exported, simply append that document to the final pdf.
mxdPath = outDir + r"\Topographic.mxd"
mxd = arcpy.mapping.MapDocument(mxdPath)
print("Creating the data driven pages \n")
ddp = mxd.dataDrivenPages
temp_filename = outDir + r"\tempDDP.pdf"

if os.path.exists(temp_filename):
  os.remove(temp_filename)
ddp.exportToPDF(temp_filename, "ALL")
print("Appending the map series  \n")
finalPdf.appendPages(temp_filename)</pre></div></li><li class="listitem">Update<a id="id277" class="indexterm"/> the properties of the final <a id="id278" class="indexterm"/>PDF:<div class="informalexample"><pre class="programlisting"># Update the properties of the final pdf.
finalPdf.updateDocProperties(pdf_open_view="USE_THUMBS", pdf_layout="SINGLE_PAGE")</pre></div></li><li class="listitem">Save<a id="id279" class="indexterm"/> the PDF:<div class="informalexample"><pre class="programlisting"># Save your result
finalPdf.saveAndClose()</pre></div></li><li class="listitem">Remove <a id="id280" class="indexterm"/>the temporary Data Driven Pages file:<div class="informalexample"><pre class="programlisting"># remove the temporary data driven pages file
if os.path.exists(temp_filename):
    os.remove(temp_filename)</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="mediaobject"><img src="images/B04314_04_17.jpg" alt="How to do it…"/></div></li><li class="listitem">You <a id="id281" class="indexterm"/>can check your work by<a id="id282" class="indexterm"/> examining the <code class="literal">c:\ArcpyBook\code\Ch4\DataDrivenPages_MapBook.py</code> solution file.</li><li class="listitem">Save <a id="id283" class="indexterm"/>and execute your <a id="id284" class="indexterm"/>script. If the script successfully executes, you should find a new file called <code class="literal">MapBook.pdf</code> in the <code class="literal">c:\ArcpyBook\Ch4</code> folder. When you open this file, you should see this screenshot:<div class="mediaobject"><img src="images/B04314_04_9.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec109"/>How it works…</h2></div></div></div><p>The <code class="literal">PDFDocument</code> class in the <code class="literal">arcpy.mapping</code> module is frequently used to create map books. In <a id="id285" class="indexterm"/>this recipe, we used the <code class="literal">PDFDocumentCreate()</code> function to create an instance of <code class="literal">PDFDocument</code>. A path to the output <a id="id286" class="indexterm"/>PDF file was passed into the <code class="literal">PDFDocumentCreate()</code> function. With this instance of <code class="literal">PDFDocument</code>, we then called the <code class="literal">PDFDocument.appendPages()</code> method twice, inserting the title page and map index files that already <a id="id287" class="indexterm"/>existed as PDF files. Next, we <a id="id288" class="indexterm"/>retrieved a <code class="literal">dataDrivenPages</code> object from the map document file and exported each of the pages to a single PDF document. This document was then appended to our final output PDF file that already contained the title page and map index page. Finally, we updated the <code class="literal">PDFDocument</code> properties to use thumbs and a single page view, saved the entire file, and removed the temporary data drive page document.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Publishing a map document to an ArcGIS Server service"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec42"/>Publishing a map document to an ArcGIS Server service</h1></div></div></div><p>Using the <code class="literal">arcpy.mapping</code> module, it is possible to publish your map document files to <span class="strong"><strong>ArcGIS Server</strong></span>
<a id="id289" class="indexterm"/> as map services. ArcGIS Server is a platform to distribute maps and data on the Web. Using the ArcGIS JavaScript API, web and mobile applications can be created from services created in ArcGIS Server. For more information about <a id="id290" class="indexterm"/>ArcGIS Server, please visit the esri ArcGIS Server site at <a class="ulink" href="http://www.esri.com/software/arcgis/arcgisserver">http://www.esri.com/software/arcgis/arcgisserver</a>. There are several steps involved in creating a map service from a map document file. The map document file must first be analyzed for suitability and performance issues and any resulting errors must be fixed before final publication to ArcGIS Server. This process involves several steps including a call to an <code class="literal">arcpy.mapping</code> function along with the use of a couple of tools in <code class="literal">ArcToolbox</code> that can be called from your script. After errors have been fixed, you <a id="id291" class="indexterm"/>can then upload the resulting <span class="strong"><strong>Service Definition Draft</strong></span> file to ArcGIS Server as a service.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec110"/>Getting ready</h2></div></div></div><p>The publication <a id="id292" class="indexterm"/>of a map document to <a id="id293" class="indexterm"/>ArcGIS Server with Python is a three-step process. The first step is to call the <code class="literal">CreateMapSDDraft() arcpy.mapping</code> function. This will convert a map document file to a Service Definition Draft file. This file contains a combination of a map document, information about the server, and a set of service properties. Information about the server includes the server connection or server type being published to, the type of service being published, metadata for the service, and data references. The draft service definition file does not contain data. <code class="literal">CreateMapSDDraft()</code> also generates a Python dictionary containing errors and warnings that could cause problems with the publication of the service.</p><p>The second step <a id="id294" class="indexterm"/>is to call the <span class="strong"><strong>StageService Tool(.sd)</strong></span>. Staging compiles the information needed to successfully publish the GIS resources. If your data is not registered with the server, it will be added when Service Definition Draft is staged. Finally, the Service Definition Draft file can be uploaded and published as a GIS service to a specified GIS server by using the <span class="strong"><strong>UploadServiceDefinition Tool</strong></span>. This<a id="id295" class="indexterm"/> step takes the Service Definition file, copies it onto the server, extracts the required information, and publishes the GIS resource. Here is an illustration of this process:</p><div class="mediaobject"><img src="images/B04314_04_10.jpg" alt="Getting ready"/></div><p>Note that you will need to have access to an ArcGIS Server instance and also have the necessary<a id="id296" class="indexterm"/> privileges to publish a<a id="id297" class="indexterm"/> service to complete this exercise. In this recipe, you will learn how to publish a map document file to an ArcGIS Server map service.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec111"/>How to do it…</h2></div></div></div><p>Follow these steps to analyze a map document for suitability for publication to ArcGIS Server and then publish it as a map service:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new IDLE script and save it as <code class="literal">c:\ArcpyBook\Ch4\PublishMapService.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Set the current workspace:<div class="informalexample"><pre class="programlisting">wrkspc = r'c:\ArcpyBook\Ch4'</pre></div></li><li class="listitem">Get a reference to the map document:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument(wrkspc + r"\Crime.mxd")</pre></div></li><li class="listitem">Define variables for the service name and Service Draft Definition file:<div class="informalexample"><pre class="programlisting">service = 'Crime'
sddraft = wrkspc + service + '.sddraft'</pre></div></li><li class="listitem">Create the Service Definition Draft file:<div class="informalexample"><pre class="programlisting">mapping.CreateMapSDDraft(mxd, sddraft, service)</pre></div></li><li class="listitem">Analyze the draft file:<div class="informalexample"><pre class="programlisting">analysis = mapping.AnalyzeForSD(wrkspc + "Crime.sddraft")</pre></div></li><li class="listitem">Create<a id="id298" class="indexterm"/> a looping <a id="id299" class="indexterm"/>structure that will loop through all the potential messages, warnings, and errors, and print out the information:<div class="informalexample"><pre class="programlisting">for key in ('messages', 'warnings', 'errors'):
    print("----" + key.upper() + "----")
    vars = analysis[key]
    for ((message, code), layerlist) in vars.iteritems():
        print "    ", message, " (CODE %i)" % code
        print("     applies to:",)
        for layer in layerlist:
            print(layer.name)</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="mediaobject"><img src="images/B04314_04_18.jpg" alt="How to do it…"/></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\PublishMapService.py</code> solution file.</li><li class="listitem">Save and run your code to see this output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>----MESSAGES----</strong></span>
<span class="strong"><strong>     Layer draws at all scale ranges  (CODE 30003)</strong></span>
<span class="strong"><strong>     applies to: District_Crime_Join</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>District_Crime_Join</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>Texas_Counties_LowRes</strong></span>
<span class="strong"><strong>School_Districts</strong></span>
<span class="strong"><strong>Crime_surf</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>----WARNINGS----</strong></span>
<span class="strong"><strong>     Layer's data source has a different projection [GCS_WGS_1984] than the data frame's projection  (CODE 10001)</strong></span>
<span class="strong"><strong>     applies to: District_Crime_Join</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>District_Crime_Join</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>Texas_Counties_LowRes</strong></span>
<span class="strong"><strong>School_Districts</strong></span>
<span class="strong"><strong>Crime_surf</strong></span>
<span class="strong"><strong>Bexar_County_Boundary</strong></span>
<span class="strong"><strong>     Missing Tags in Item Description  (CODE 24059)</strong></span>
<span class="strong"><strong>     applies to:      Missing Summary in Item Description (CODE 24058)</strong></span>
<span class="strong"><strong>     applies to: ----ERRORS----</strong></span>
<span class="strong"><strong>     Data frame uses a background symbol that is not a solid fill  (CODE 18)</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>You'll want to pay particular attention to the Errors section. Errors must be fixed before the service can be created. Warnings can indicate problems related to the performance of the service but they won't stop a service from being published. In this case, the error indicates that the data frame uses a background symbol that is not a solid fill. This will need to be corrected in ArcGIS before we can proceed.</p></div></div></li><li class="listitem">In ArcMap, open <code class="literal">crime.mxd</code> in the <code class="literal">c:\ArcpyBook\ch4</code> folder and right-click <a id="id300" class="indexterm"/>on the <span class="strong"><strong>Crime</strong></span> data<a id="id301" class="indexterm"/> frame and select <span class="strong"><strong>Properties</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Frame</strong></span> tab, as seen in this screenshot:<div class="mediaobject"><img src="images/B04314_04_11.jpg" alt="How to do it…"/></div></li><li class="listitem">Change the <span class="strong"><strong>Background</strong></span> from the current symbol to none and click on <span class="strong"><strong>OK</strong></span>:<div class="mediaobject"><img src="images/B04314_04_12.jpg" alt="How to do it…"/></div></li><li class="listitem">Repeat <a id="id302" class="indexterm"/>this process<a id="id303" class="indexterm"/> for each of the data frames in the map document.</li><li class="listitem">Rerun the script you just wrote. This time, you shouldn't see any errors. You do still have a warning that should probably be fixed as well, but warnings won't stop your map document from being published as a service.</li><li class="listitem">With all our errors fixed, we'll now convert the <code class="literal">Crime.mxd</code> file into a <code class="literal">Crime.sd</code> file. Delete the looping structure that you added in step 6.</li><li class="listitem">Add the following <code class="literal">if</code>/<code class="literal">else</code> block of code. Note that I have commented on the line of code that calls the <code class="literal">UploadServiceDefinition</code> tool. If you have access to an ArcGIS Server instance and have the appropriate privileges and connection information, you can uncomment this line to have it upload the file as a<a id="id304" class="indexterm"/> map service. You <a id="id305" class="indexterm"/>would also need to add the connection parameters for the instance in the <code class="literal">con</code> variable, which is passed as the second parameter for this tool. Save and execute the script to see the results:<div class="informalexample"><pre class="programlisting">if analysis['errors'] == {}:
    #execute StageService
    arcpy.StageService_server(sddraft,sd)
    #execute UploadServiceDefinition
    #arcpy.UploadServiceDefinition_server(sd, con)
else:
    #if the sddraft analysis contained errors, display them
    print(analysis['errors'])</pre></div></li><li class="listitem">Your entire script should appear as follows:<div class="mediaobject"><img src="images/B04314_04_19.jpg" alt="How to do it…"/></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch4\PublishMapService2.py</code> solution file.</li><li class="listitem">If you have access to an ArcGIS Server instance and have the necessary privileges, you can uncomment the <code class="literal">UploadServiceDefinition</code> tool and execute the script.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec112"/>How it works…</h2></div></div></div><p>The <code class="literal">CreateMapSDDraft()</code> function creates a Service Definition Draft file from a map document file. Next, we call the <code class="literal">AnalyzeForSD()</code> function and examine the results that are<a id="id306" class="indexterm"/> returned for any messages, warnings, or errors. Any errors that are identified must then be fixed before<a id="id307" class="indexterm"/> the map service can be created. Finally, if no errors are present, we call the <code class="literal">StageService</code> tool that creates a Service Definition Draft file that can then be passed into the <code class="literal">UploadServiceDefinition</code> tool for publication to ArcGIS Server.</p></div></div></div>
</body></html>