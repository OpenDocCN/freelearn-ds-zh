<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Getting into Shape"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Getting into Shape</h1></div></div></div><p>In this chapter we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating simple shapes</li><li class="listitem" style="list-style-type: disc">Using a line generator</li><li class="listitem" style="list-style-type: disc">Using line interpolation</li><li class="listitem" style="list-style-type: disc">Changing line tension</li><li class="listitem" style="list-style-type: disc">Using an area generator</li><li class="listitem" style="list-style-type: disc">Using area interpolation</li><li class="listitem" style="list-style-type: disc">Using an arc generator</li><li class="listitem" style="list-style-type: disc">Implementing arc transition</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Introduction</h1></div></div></div><p>
<span class="strong"><strong>Scalable Vector Graphics</strong></span> (<span class="strong"><strong>SVG</strong></span>) is a mature <a id="id356" class="indexterm"/>
<span class="strong"><strong>World Wide Web Consortium</strong></span> (<span class="strong"><strong>W3C</strong></span>) standard<a id="id357" class="indexterm"/> designed for user interactive graphics on the Web and Mobile platform. Similar to <a id="id358" class="indexterm"/>HTML, SVG can coexist happily with other technologies like CSS<a id="id359" class="indexterm"/> and JavaScript<a id="id360" class="indexterm"/> in modern browsers forming the backbone of many web applications. In today's Web, you can see use cases of SVG everywhere from digital map to data visualization. So far in this book we have covered most of the recipes using HTML elements alone, however, in real-world projects, SVG is the de facto standard for data visualization; it is also where D3's strength really shines. In this chapter, we will cover the basic concept of SVG as well as D3's support for SVG shape generation. SVG is a very rich topic. Volumes of books can be and have been devoted to this topic alone, hence, we are not planning or even going to try to cover all SVG-related topics, rather we'll focus on D3 and data visualization related techniques and features.</p><div class="section" title="What is SVG?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec131"/>What is SVG?</h2></div></div></div><p>As its name suggests, SVG is about graphics. It is a way to describe graphical image with scalable vectors. Let's see two of the <a id="id361" class="indexterm"/>main SVG advantages:</p><div class="section" title="Vector"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec09"/>Vector</h3></div></div></div><p>SVG image is based on <a id="id362" class="indexterm"/>vectors instead of pixels. With the pixel-based approach, an<a id="id363" class="indexterm"/> image is composed of a bitmap with <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> as its coordinates filled with color pigmentations. While with the vector-based approach, each image consists of a set of geometric shapes described using simple and relative formulae filled with certain texture. As you can imagine, this later approach fits naturally with data visualization requirement. It is much simpler to visualize your data with lines, bar, and circles in SVG versus trying to manipulate color pigmentations in a bitmap.</p></div><div class="section" title="Scalability"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec10"/>Scalability</h3></div></div></div><p>The second signature capability of <a id="id364" class="indexterm"/>SVG is scalability. Since SVG graphic is a group of geometric shapes described using relative formulas, it can be rendered and re-rendered with different sizes and zoom levels without losing precision. On the other hand, when bitmap-based images are resized to a large resolution, they suffer the effect of <a id="id365" class="indexterm"/>
<span class="strong"><strong>pixelation</strong></span>, which occurs when the individual pixels become visible, while SVG does not have this drawback. See the following figure to get a better picture of what we just read:</p><div class="mediaobject"><img src="graphics/2162OS_07_01.jpg" alt="Scalability"/><div class="caption"><p>SVG versus bitmap pixelation</p></div></div><p>As a data visualizer, using SVG gives you the benefit of being able to display your visualization on any resolution without losing the crispiness of your eye-catching creation. On top of that, SVG offers you some additional advantages such as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Readability</strong></span>: SVG <a id="id366" class="indexterm"/>is based on XML, a human-readable markup language</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Open standard</strong></span>: SVG<a id="id367" class="indexterm"/> was created by W3C and is not a proprietary vendor standard</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Adoption</strong></span>: All <a id="id368" class="indexterm"/>modern browsers support SVG standard, even on mobile platform</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Interoperability</strong></span>: SVG <a id="id369" class="indexterm"/>works well with other web technologies, such as CSS and JavaScript; D3 itself is a perfect demonstration of this capability</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Lightweight</strong></span>: Compared <a id="id370" class="indexterm"/>to bitmap-based images, SVG is a lot lighter, taking up much less space</li></ul></div><p>Because of all these <a id="id371" class="indexterm"/>capabilities we have mentioned so far, SVG has become the de facto standard for data visualization on the Web. From this chapter onwards, all recipes in this book will be illustrated using SVG as its most important part, with which the true power of D3 can be professed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>Some older browsers do not support SVG natively. If your target users are using legacy browsers, please check SVG compatibility before deciding whether SVG is the right choice for your visualization project. Here is a link you can visit to check you browser's compatibility:</p><p>
<a class="ulink" href="http://caniuse.com/svg">http://caniuse.com/svg</a>
</p></div></div></div></div></div></div>
<div class="section" title="Creating simple shapes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Creating simple shapes</h1></div></div></div><p>In this recipe, we will explore a <a id="id372" class="indexterm"/>few simple built-in SVG shape formulae and their attributes. These simple shapes are quite easy to generate and are usually created manually using D3 when necessary. Though these simple shapes are not the most useful shape generator to know when working with D3, occasionally they could be handy when drawing peripheral shapes in your visualization project.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec132"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/simple-shapes.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/simple-shapes.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec133"/>How to do it...</h2></div></div></div><p>In this recipe, we will draw four different shapes in four different colors using native SVG shape elements:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var width = 600,
        height = 500;
        
    var svg = d3.select("body").append("svg");
    
    svg.attr("height", height)
        .attr("width", width);    
        
<span class="strong"><strong>    svg.append("line") // &lt;-A</strong></span>
<span class="strong"><strong>        .attr("x1", 0)</strong></span>
<span class="strong"><strong>        .attr("y1", 200)</strong></span>
<span class="strong"><strong>        .attr("x2", 100)</strong></span>
<span class="strong"><strong>        .attr("y2", 100);</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>    svg.append("circle") // &lt;-B</strong></span>
<span class="strong"><strong>        .attr("cx", 200)</strong></span>
<span class="strong"><strong>        .attr("cy", 150)</strong></span>
<span class="strong"><strong>        .attr("r", 50);</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>    svg.append("rect")</strong></span>
<span class="strong"><strong>        .attr("x", 300) // &lt;-C</strong></span>
<span class="strong"><strong>        .attr("y", 100)</strong></span>
<span class="strong"><strong>        .attr("width", 100) // &lt;-D</strong></span>
<span class="strong"><strong>        .attr("height", 100)</strong></span>
<span class="strong"><strong>        .attr("rx", 5); // &lt;-E</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>    svg.append("polygon")</strong></span>
<span class="strong"><strong>        .attr("points", "450,200 500,100 550,200"); // &lt;-F</strong></span>
&lt;/script&gt;</pre></div><p>The preceding code<a id="id373" class="indexterm"/> generates the following visual output:</p><div class="mediaobject"><img src="graphics/2162OS_07_02.jpg" alt="How to do it..."/><div class="caption"><p>Simple SVG shapes</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec134"/>How it works...</h2></div></div></div><p>We have drawn four different shapes: a line, a circle, a rectangle, and a triangle in this example using SVG built-in shape elements.</p><p>
<span class="strong"><strong>A little refresher on SVG coordinate system</strong></span>
</p><p>SVG <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> <a id="id374" class="indexterm"/>coordinate system originates from the top-left corner <code class="literal">(0, 0)</code> of the canvas and ends on the lower-right corner <code class="literal">(&lt;width&gt;, &lt;height&gt;)</code>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">line</code>: A line <a id="id375" class="indexterm"/>element creates a simple straight line with coordinate attributes <code class="literal">x1</code> and <code class="literal">y1</code> as its start point and <code class="literal">x2</code>, <code class="literal">y2</code> as its end point (see line <code class="literal">A</code>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">circle</code>: The <code class="literal">append()</code> function draws a circle with coordinate attributes <code class="literal">cx</code> and <code class="literal">cy</code> defining the center of the circle while the attribute <code class="literal">r</code> defines the radius of the circle (see line <code class="literal">B</code>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">rect</code>: The <code class="literal">append()</code> function draws a rectangle with coordinate attributes <code class="literal">x</code> and <code class="literal">y</code> defining the top-left corner of the rectangular (see line <code class="literal">C</code>), attributes <code class="literal">width</code> and <code class="literal">height</code> for controlling the size of the rectangle, and the attributes <code class="literal">rx</code> and <code class="literal">ry</code> can be used to introduce rounded corners. The attributes <code class="literal">rx</code> and <code class="literal">ry</code> control the <span class="emphasis"><em>x</em></span>- and <span class="emphasis"><em>y</em></span>-axis radius of the ellipse used to round off the corners of the rectangle (see line <code class="literal">E</code>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">polygon</code>: To draw a polygon, a set of points that makes up the polygon need to be defined using a <code class="literal">points</code> attribute (see line <code class="literal">F</code>). The <code class="literal">points</code> attribute accepts a list of point coordinates separated by space:<div class="informalexample"><pre class="programlisting">svg.append("polygon")
    .attr("points", "450,200 500,100 550,200"); // &lt;-F</pre></div></li></ul></div><p>All SVG shapes can be styled using style attributes directly or through CSS similar to HTML elements. Furthermore, they can be transformed and filtered using SVG transformation and filter support, however, due to limited scope in this book, we will not cover these topics in detail. In the rest of this chapter, we will focus on D3-specific supports on SVG shape generation instead.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec135"/>There's more...</h2></div></div></div><p>SVG also supports <code class="literal">ellipse</code> and <code class="literal">polyline</code> elements, however, due to their similarity to <code class="literal">circle</code> and <code class="literal">polygon</code> we will not cover them in detail in this book. For more information on SVG shape elements, please visit <a class="ulink" href="http://www.w3.org/TR/SVG/shapes.html">http://www.w3.org/TR/SVG/shapes.html</a>.</p><div class="section" title="D3 SVG shape generators"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec11"/>D3 SVG shape generators</h3></div></div></div><p>The "swiss army knife" <a id="id376" class="indexterm"/>among SVG shape elements is <code class="literal">svg:path</code>. A path defines the outline of any shape which can then be filled, stroked, or clipped. Every shape we have discussed so far can be mathematically defined using <code class="literal">svg:path</code> alone. SVG <code class="literal">path</code> is a very powerful construct and has its own mini-language and grammar. The <code class="literal">svg:path</code> mini-language is used to set the "<code class="literal">d</code>" attribute on an <code class="literal">svg:path</code> element, which consists of the following commands:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>moveto</strong></span>: Command<a id="id377" class="indexterm"/> <span class="strong"><strong>M</strong></span>(absolute)/<span class="strong"><strong>m</strong></span>(relative) moveto (x y)+</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>closepath</strong></span>: <span class="strong"><strong>Z</strong></span>(absolute)/<span class="strong"><strong>z</strong></span>(relative)<a id="id378" class="indexterm"/> closepath </li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>lineto</strong></span>: <span class="strong"><strong>L</strong></span>(absolute)/<span class="strong"><strong>l</strong></span>(relative) lineto (x y)+, <span class="strong"><strong>H</strong></span>(absolute)/<span class="strong"><strong>h</strong></span>(relative) horizontal<a id="id379" class="indexterm"/> lineto x+, <span class="strong"><strong>V</strong></span>(absolute)/<span class="strong"><strong>v</strong></span>(relative) vertical lineto y+</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Cubic Bézier</strong></span>: <span class="strong"><strong>C</strong></span>(absolute)/<span class="strong"><strong>c</strong></span>(relative) curve to (x1 y1 x2 y2 x y)+, <span class="strong"><strong>S</strong></span>(absolute)/<span class="strong"><strong>s</strong></span>(relative)<a id="id380" class="indexterm"/> shorthand curve to (x2 y2 x y)+</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Quadratic Bézier curve</strong></span>: <span class="strong"><strong>Q</strong></span>(absolute)/<span class="strong"><strong>q</strong></span>(relative) quadratic<a id="id381" class="indexterm"/> Bézier curve to (x1 y1 x y)+, <span class="strong"><strong>T</strong></span>(absolute)/<span class="strong"><strong>t</strong></span>(relative) shorthand quadratic Bézier curve to (x y)+</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Elliptical curve</strong></span>: <span class="strong"><strong>A</strong></span>(absolute)/<span class="strong"><strong>a</strong></span>(relative)<a id="id382" class="indexterm"/> elliptical arc (rx ry x-axis-rotation large-arc-flag sweep-flag x y)+</li></ul></div><p>As directly using paths is not a very pleasant method due to its cryptic language, therefore, in most cases, some kind of software, for example, Adobe Illustrator or Inkscape is required to assist us in creating the SVG <code class="literal">path</code> element visually. Similarly, D3 ships with a set of SVG shape generator functions that can be used to generate data-driven path formulae; this is how D3 truly revolutionizes the field of data visualization by combining the power of SVG with intuitive data-driven approach. This is also going to be the focus for the rest of this chapter.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec136"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to <a class="ulink" href="http://www.w3.org/TR/SVG/Overview.html">http://www.w3.org/TR/SVG/Overview.html</a> for more information on SVG-related topics</li><li class="listitem" style="list-style-type: disc">For a complete reference on SVG path formula language and its grammar please visit <a class="ulink" href="http://www.w3.org/TR/SVG/paths.html">http://www.w3.org/TR/SVG/paths.html</a></li></ul></div></div></div>
<div class="section" title="Using a line generator"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Using a line generator</h1></div></div></div><p>D3 line generator is <a id="id383" class="indexterm"/>probably one of the most versatile generators. Though it is called a "line" generator, it has little to do with the <code class="literal">svg:line</code> element. In contrast, it is implemented using the <code class="literal">svg:path</code> element. Like <code class="literal">svg:path</code>, D3 <code class="literal">line</code> generator is so flexible that you can effectively draw any shape using <code class="literal">line</code> alone, however, to make your life easier, D3 also provides other more specialized shape generators, which will be covered in later recipes in this chapter. In this recipe, we will draw multiple data-driven lines using the <code class="literal">d3.svg.line</code> generator.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec137"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec138"/>How to do it...</h2></div></div></div><p>Now, let's see the<a id="id384" class="indexterm"/> line generator in action:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var width = 500,
        height = 500,
        margin = 50,
<span class="strong"><strong>        x = d3.scale.linear() // &lt;-A</strong></span>
<span class="strong"><strong>            .domain([0, 10])</strong></span>
<span class="strong"><strong>            .range([margin, width - margin]),</strong></span>
<span class="strong"><strong>        y = d3.scale.linear() // &lt;-B</strong></span>
<span class="strong"><strong>            .domain([0, 10])</strong></span>
<span class="strong"><strong>            .range([height - margin, margin]);</strong></span>
        
<span class="strong"><strong>    var data = [ // &lt;-C</strong></span>
<span class="strong"><strong>        [</strong></span>
<span class="strong"><strong>            {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7},</strong></span>
<span class="strong"><strong>            {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4},</strong></span>
<span class="strong"><strong>            {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2}</strong></span>
<span class="strong"><strong>        ],</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>        d3.range(10).map(function(i){</strong></span>
<span class="strong"><strong>            return {x: i, y: Math.sin(i) + 5};</strong></span>
<span class="strong"><strong>        })</strong></span>
<span class="strong"><strong>    ];</strong></span>
    
<span class="strong"><strong>    var line = d3.svg.line() // &lt;-D</strong></span>
<span class="strong"><strong>            .x(function(d){return x(d.x);})</strong></span>
<span class="strong"><strong>            .y(function(d){return y(d.y);});</strong></span>
        
    var svg = d3.select("body").append("svg");
    
    svg.attr("height", height)
        .attr("width", width);
        
     svg.selectAll("path.line")
            .data(data)
        .enter()
<span class="strong"><strong>            .append("path") // &lt;-E</strong></span>
            .attr("class", "line")            
<span class="strong"><strong>            .attr("d", function(d){return line(d);}); // &lt;-F</strong></span>
            
    // Axes related code omitted
    ...        
&lt;/script&gt;</pre></div><p>The preceding code <a id="id385" class="indexterm"/>draws multiple lines along with the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> axes:</p><div class="mediaobject"><img src="graphics/2162OS_07_03.jpg" alt="How to do it..."/><div class="caption"><p>D3 line generator</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec139"/>How it works...</h2></div></div></div><p>In this recipe, the data we<a id="id386" class="indexterm"/> used to draw the lines are defined in a two-dimensional array:</p><div class="informalexample"><pre class="programlisting">var data = [ // &lt;-C
        [
            {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7},
            {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4},
            {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2}
        ],
        
        d3.range(10).map(function(i){
            return {x: i, y: Math.sin(i) + 5};
        })
];</pre></div><p>The first data series is defined manually and explicitly, while the second series is generated using a mathematical formula. Both of these cases are quite common in data visualization projects. Once the data is defined, then in order to map data points to its visual representation, two scales were created for the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates:</p><div class="informalexample"><pre class="programlisting">x = d3.scale.linear() // &lt;-A
            .domain([0, 10])
            .range([margin, width - margin]),
y = d3.scale.linear() // &lt;-B
            .domain([0, 10])
            .range([height - margin, margin]);</pre></div><p>Notice that the domains for these scales were set to be large enough to include all data points in both the series, while the range were set to represent the canvas area without including the margins. The <span class="emphasis"><em>y</em></span>-axis range is inverted since we want our point of origin at the lower-left corner of the canvas instead of the SVG-standard upper-left corner. Once both data and scales are set, all we need to do is generate the lines to define our generator using the <code class="literal">d3.svg.line</code> function:</p><div class="informalexample"><pre class="programlisting">var line = d3.svg.line() // &lt;-D
            .x(function(d){return x(d.x);})
            .y(function(d){return y(d.y);});</pre></div><p>The <code class="literal">d3.svg.line</code> function <a id="id387" class="indexterm"/>returns a D3 line generator function which you can further customize. In our example, we simply stated for this particular line generator the <span class="emphasis"><em>x</em></span> coordinate, which will be calculated using the <code class="literal">x</code> scale mapping, while the <span class="emphasis"><em>y</em></span> coordinate will be mapped by the <code class="literal">y</code> scale. Using D3 scales, to map coordinates, is not only convenient but also a widely accepted best practice (separation of concerns). Though, technically you can implement these functions using any approach you prefer. Now the only thing left to do is actually create the <code class="literal">svg:path</code> elements.</p><div class="informalexample"><pre class="programlisting">svg.selectAll("path.line")
            .data(data)
        .enter()
            .append("path") // &lt;-E
            .attr("class", "line")            
            .attr("d", function(d){return line(d);}); // &lt;-F</pre></div><p>Path creation process was very straightforward. Two <code class="literal">svg:path</code> elements are created using the data array we defined (on line <code class="literal">E</code>). Then the <code class="literal">d</code> attribute for each path element was set using the <code class="literal">line</code> generator we created previously by passing in the data <code class="literal">d</code> as its input parameter. The <a id="id388" class="indexterm"/>following screenshot shows what the generated <code class="literal">svg:path</code> elements look like:</p><div class="mediaobject"><img src="graphics/2162OS_07_04.jpg" alt="How it works..."/><div class="caption"><p>Generated SVG path elements</p></div></div><p>Finally two axes are created using the same <code class="literal">x</code> and <code class="literal">y</code> scales we defined earlier. Due to limited scope in this book, we have omitted the axes-related code in this recipe and in the rest of this chapter, since they don't really change and also are not the focus of this chapter.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec140"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For detailed information on D3 axes support please visit <a class="link" href="ch05.html" title="Chapter 5. Playing with Axes">Chapter 5</a>, <span class="emphasis"><em>Play with Axes</em></span></li></ul></div></div></div>
<div class="section" title="Using line interpolation"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec53"/>Using line interpolation</h1></div></div></div><p>By default, the D3 line generator uses <a id="id389" class="indexterm"/>
<span class="strong"><strong>linear interpolation</strong></span> mode, however, D3 supports a number of different line interpolation modes. Line interpolation determines how data points will be connected, for example, by a straight line (linear interpolation) or a curved line (<span class="strong"><strong>cubic interpolation</strong></span>). In this recipe, we will show you how these interpolation modes can be set along with their effects.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec141"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line-interpolation.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line-interpolation.html</a>
</p><p>This recipe is built on top of what we have done in the previous recipe, so, if you are not yet familiar with basic line generator functions, please review the previous recipe first before proceeding.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec142"/>How to do it...</h2></div></div></div><p>Now, let's see how <a id="id390" class="indexterm"/>different line interpolation modes can be used:</p><div class="informalexample"><pre class="programlisting">    var width = 500,
        height = 500,
        margin = 30,
        x = d3.scale.linear()
            .domain([0, 10])
            .range([margin, width - margin]),
        y = d3.scale.linear()
            .domain([0, 10])
            .range([height - margin, margin]);
        
    var data = [
        [
            {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7},
            {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4},
            {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2}
        ],  
        d3.range(10).map(function(i){
            return {x: i, y: Math.sin(i) + 5};
        })
    ];
    
    var svg = d3.select("body").append("svg");
    
    svg.attr("height", height)
        .attr("width", width);        
    
    renderAxes(svg);
        
    render("linear");    
    
    renderDots(svg);
    
    function render(mode){
        var line = d3.svg.line()
<span class="strong"><strong>                .interpolate(mode) // &lt;-A</strong></span>
                .x(function(d){return x(d.x);})
                .y(function(d){return y(d.y);});
                
        svg.selectAll("path.line")
                .data(data)
            .enter()
                .append("path")
                .attr("class", "line");                
                
        svg.selectAll("path.line")
                .data(data)       
            .attr("d", function(d){return line(d);});        
    }
    
<span class="strong"><strong>    function renderDots(svg){ // &lt;-B</strong></span>
<span class="strong"><strong>        data.forEach(function(set){</strong></span>
<span class="strong"><strong>             svg.append("g").selectAll("circle")</strong></span>
<span class="strong"><strong>                .data(set)</strong></span>
<span class="strong"><strong>              .enter().append("circle") // &lt;-C</strong></span>
<span class="strong"><strong>                .attr("class", "dot")</strong></span>
<span class="strong"><strong>                .attr("cx", function(d) { return x(d.x); })</strong></span>
<span class="strong"><strong>                .attr("cy", function(d) { return y(d.y); })</strong></span>
<span class="strong"><strong>                .attr("r", 4.5);</strong></span>
<span class="strong"><strong>        });</strong></span>
<span class="strong"><strong>    }</strong></span>
// Axes related code omitted</pre></div><p>The preceding code <a id="id391" class="indexterm"/>generates the following line chart in your browser with configurable interpolation modes:</p><div class="mediaobject"><img src="graphics/2162OS_07_05.jpg" alt="How to do it..."/><div class="caption"><p>Line interpolation</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec143"/>How it works...</h2></div></div></div><p>Overall, this recipe is<a id="id392" class="indexterm"/> similar to the previous one. Two lines are generated using pre-defined data set. However, in this recipe, we allow the user to select a specific line interpolation mode, which is then set using the <code class="literal">interpolate</code> function on line generator (see line <code class="literal">A</code>).</p><div class="informalexample"><pre class="programlisting">var line = d3.svg.line()
                .interpolate(mode) // &lt;-A
                .x(function(d){return x(d.x);})
                .y(function(d){return y(d.y);});</pre></div><p>The following interpolation modes are supported by D3:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>linear</strong></span>: Linear <a id="id393" class="indexterm"/>segments, that is, polyline</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>linear-closed</strong></span>: Closed<a id="id394" class="indexterm"/> linear segments, that is, polygon</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>step-before</strong></span>: Alternated<a id="id395" class="indexterm"/> between the vertical and horizontal segments, as in a step function</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>step-after</strong></span>: Alternated <a id="id396" class="indexterm"/>between the horizontal and vertical segments, as in a step function</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>basis</strong></span>: A B-spline, <a id="id397" class="indexterm"/>with control point duplication on the ends</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>basis-open</strong></span>: An<a id="id398" class="indexterm"/> open B-spline; may not intersect the start or end</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>basis-closed</strong></span>: A closed <a id="id399" class="indexterm"/>B-spline, as in a loop</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>bundle</strong></span>: Equivalent to <a id="id400" class="indexterm"/>basis, except the tension parameter is used to straighten the spline</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>cardinal</strong></span>: A Cardinal<a id="id401" class="indexterm"/> spline, with control point duplication on the ends.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>cardinal-open</strong></span>: An open <a id="id402" class="indexterm"/>Cardinal spline; may not intersect the start or end, but will intersect other control points</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>cardinal-closed</strong></span>: A<a id="id403" class="indexterm"/> closed Cardinal spline, as in a loop</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>monotone</strong></span>: Cubic <a id="id404" class="indexterm"/>interpolation that preserves monotonicity in <span class="emphasis"><em>y</em></span></li></ul></div><p>Additionally, in<a id="id405" class="indexterm"/> the <code class="literal">renderDots</code> function<a id="id406" class="indexterm"/> (see line <code class="literal">B</code>) we have also created a small circle for each data point to serve as reference points. These dots are created using <code class="literal">svg:circle</code> elements, as shown on line <code class="literal">C</code>:</p><div class="informalexample"><pre class="programlisting">function renderDots(svg){ // &lt;-B
        data.forEach(function(set){
             svg.append("g").selectAll("circle")
                .data(set)
              .enter().append("circle") // &lt;-C
                .attr("class", "dot")
                .attr("cx", function(d) { return x(d.x); })
                .attr("cy", function(d) { return y(d.y); })
                .attr("r", 4.5);
        });
}</pre></div></div></div>
<div class="section" title="Changing line tension"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec54"/>Changing line tension</h1></div></div></div><p>If Cardinal interpolation <a id="id407" class="indexterm"/>mode (cardinal, cardinal-open, cardinal-closed) is used, then line can be further modified using <span class="strong"><strong>tension</strong></span> settings. In this recipe, we will see how tension can be modified and its effect on line interpolation.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec144"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line-tension.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line-tension.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec145"/>How to do it...</h2></div></div></div><p>Now, let's see how line tension can be changed and what effect it has on line generation:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var width = 500,
        height = 500,
        margin = 30,
        duration = 500,    
        x = d3.scale.linear()
            .domain([0, 10])
            .range([margin, width - margin]),
        y = d3.scale.linear()
            .domain([0, 1])
            .range([height - margin, margin]);
        
    var data = d3.range(10).map(function(i){
            return {x: i, y: (Math.sin(i * 3) + 1) / 2};
        });
    
    var svg = d3.select("body").append("svg");
    
    svg.attr("height", height)
        .attr("width", width);
        
    renderAxes(svg);
        
<span class="strong"><strong>    render([1]);    </strong></span>
    
    function render(tension){
        var line = d3.svg.line()
                .interpolate("cardinal")
                .x(function(d){return x(d.x);})
                .y(function(d){return y(d.y);});
                
        svg.selectAll("path.line")
                .data(tension)
            .enter()
                .append("path")
                .attr("class", "line");            
                
<span class="strong"><strong>        svg.selectAll("path.line")</strong></span>
<span class="strong"><strong>                .data(tension) // &lt;-A                    </strong></span>
<span class="strong"><strong>            .transition().duration(duration).ease("linear") // &lt;-B</strong></span>
<span class="strong"><strong>            .attr("d", function(d){</strong></span>
<span class="strong"><strong>                return line.tension(d)(data); // &lt;-C</strong></span>
<span class="strong"><strong>            });</strong></span>
            
        svg.selectAll("circle")
            .data(data)
          .enter().append("circle")
            .attr("class", "dot")
            .attr("cx", function(d) { return x(d.x); })
            .attr("cy", function(d) { return y(d.y); })
            .attr("r", 4.5);
} 
// Axes related code omitted
    ...
&lt;/script&gt;
&lt;h4&gt;Line Tension:&lt;/h4&gt;
&lt;div class="control-group"&gt;
    &lt;button onclick="render([0])"&gt;0&lt;/button&gt;
    &lt;button onclick="render([0.2])"&gt;0.2&lt;/button&gt;
    &lt;button onclick="render([0.4])"&gt;0.4&lt;/button&gt;
    &lt;button onclick="render([0.6])"&gt;0.6&lt;/button&gt;
    &lt;button onclick="render([0.8])"&gt;0.8&lt;/button&gt;
    &lt;button onclick="render([1])"&gt;1&lt;/button&gt;
&lt;/div&gt;</pre></div><p>The preceding code generates a <a id="id408" class="indexterm"/>Cardinal line chart with configurable tension:</p><div class="mediaobject"><img src="graphics/2162OS_07_06.jpg" alt="How to do it..."/><div class="caption"><p>Line Tension</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec146"/>How it works...</h2></div></div></div><p>Tension sets the Cardinal spline interpolation tension to a specific number in the range of <code class="literal">[0, 1]</code>. Tension can be set using the <code class="literal">tension</code> function on line generator (see line <code class="literal">C</code>):</p><div class="informalexample"><pre class="programlisting">svg.selectAll("path.line")
                .data(tension) // &lt;-A                    
            .transition().duration(duration).ease("linear") // &lt;-B
            .attr("d", function(d){
                return line.tension(d)(data);} // &lt;-C 
            ); </pre></div><p>Additionally, we also <a id="id409" class="indexterm"/>initiated a transition on line <code class="literal">B</code> to highlight the tension effect on line interpolation. If the tension is not set explicitly, Cardinal interpolation sets tension to <code class="literal">0.7</code> by default.</p></div></div>
<div class="section" title="Using an area generator"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec55"/>Using an area generator</h1></div></div></div><p>Using D3 <a id="id410" class="indexterm"/>line generator, we can technically generate an outline of any shape, however, even with different interpolation-support, directly drawing an area using line (as in an area chart) is not an easy task. This is why D3 also provides a separate shape generator function specifically designed for drawing area.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec147"/>Getting Ready</h2></div></div></div><p>Open your local copy of <a id="id411" class="indexterm"/>the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/area.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/area.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec148"/>How to do it...</h2></div></div></div><p>In this recipe, we will add a filled area to a pseudo line chart effectively turning it into an area chart:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var width = 500,
        height = 500,
        margin = 30,
        duration = 500,
<span class="strong"><strong>        x = d3.scale.linear() // &lt;-A</strong></span>
<span class="strong"><strong>            .domain([0, 10])</strong></span>
<span class="strong"><strong>            .range([margin, width - margin]),</strong></span>
<span class="strong"><strong>        y = d3.scale.linear()</strong></span>
<span class="strong"><strong>            .domain([0, 10])</strong></span>
<span class="strong"><strong>            .range([height - margin, margin]);</strong></span>
        
<span class="strong"><strong>    var data = d3.range(11).map(function(i){ // &lt;-B</strong></span>
<span class="strong"><strong>            return {x: i, y: Math.sin(i)*3 + 5};</strong></span>
<span class="strong"><strong>        });</strong></span>
    
    var svg = d3.select("body").append("svg");
    
    svg.attr("height", height)
        .attr("width", width);        
    
    renderAxes(svg);
        
    render("linear");    
    
    renderDots(svg);
    
    function render(){
        var line = d3.svg.line()
                .x(function(d){return x(d.x);})
                .y(function(d){return y(d.y);});
                
        svg.selectAll("path.line")
                .data([data])
            .enter()
                .append("path")
                .attr("class", "line");                
                
        svg.selectAll("path.line")
                .data([data])       
            .attr("d", function(d){return line(d);});        
            
<span class="strong"><strong>        var area = d3.svg.area() // &lt;-C</strong></span>
<span class="strong"><strong>            .x(function(d) { return x(d.x); }) // &lt;-D</strong></span>
<span class="strong"><strong>            .y0(y(0)) // &lt;-E</strong></span>
<span class="strong"><strong>            .y1(function(d) { return y(d.y); }); // &lt;-F</strong></span>
<span class="strong"><strong>            </strong></span>
<span class="strong"><strong>        svg.selectAll("path.area") // &lt;-G</strong></span>
<span class="strong"><strong>                .data([data])</strong></span>
<span class="strong"><strong>            .enter()</strong></span>
<span class="strong"><strong>                .append("path")</strong></span>
<span class="strong"><strong>                .attr("class", "area")</strong></span>
<span class="strong"><strong>                .attr("d", function(d){return area(d);}); // &lt;-H</strong></span>
    }
    
    // Dots rendering code omitted
    
    // Axes related code omitted
    ...
&lt;/script&gt;</pre></div><p>The preceding code<a id="id412" class="indexterm"/> generates the following visual output:</p><div class="mediaobject"><img src="graphics/2162OS_07_07.jpg" alt="How to do it..."/><div class="caption"><p>Area generator</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec149"/>How it works...</h2></div></div></div><p>Similar to the <span class="emphasis"><em>Using a line generator</em></span> recipe earlier in this chapter, we have two scales defined to map data to visual domain on <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates (see line A), in this recipe:</p><div class="informalexample"><pre class="programlisting">x = d3.scale.linear() // &lt;-A
            .domain([0, 10])
            .range([margin, width - margin]),
        y = d3.scale.linear()
            .domain([0, 10])
            .range([height - margin, margin]);
        
    var data = d3.range(11).map(function(i){ // &lt;-B
            return {x: i, y: Math.sin(i)*3 + 5};
        });</pre></div><p>On line <code class="literal">B</code>, data is generated by a mathematical formula. Area generator is then created using the <code class="literal">d3.svg.area</code> function (see line <code class="literal">C</code>):</p><div class="informalexample"><pre class="programlisting">var area = d3.svg.area() // &lt;-C
            .x(function(d) { return x(d.x); }) // &lt;-D
            .y0(y(0)) // &lt;-E
            .y1(function(d) { return y(d.y); }); // &lt;-F</pre></div><p>As you can see, <a id="id413" class="indexterm"/>D3 area generator is—similar to the line generator—designed to work in a 2D homogenous coordinate system. With the <code class="literal">x</code> function defining an accessor function for <span class="emphasis"><em>x</em></span> coordinate (see line <code class="literal">D</code>), which simply maps data to the visual coordinate using the <code class="literal">x</code> scale we defined earlier. For the <span class="emphasis"><em>y</em></span> coordinate, we provided the area generator two different accessors; one for the lower bound (<code class="literal">y0</code>) and the other for the higher bound (<code class="literal">y1</code>) coordinates. This is the crucial difference between area and line generator. D3 area generator supports higher and lower bound on both <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> axes (<code class="literal">x0</code>, <code class="literal">x1</code>, <code class="literal">y0</code>, <code class="literal">y1</code>), and the shorthand accessors (<code class="literal">x</code> and <code class="literal">y</code>) if the higher and lower bounds are the same. Once the area generator is defined, the method of creating an area is almost identical to the line generator.</p><div class="informalexample"><pre class="programlisting">svg.selectAll("path.area") // &lt;-G
                .data([data])
            .enter()
                .append("path")
                .attr("class", "area")
                .attr("d", function(d){return area(d);}); // &lt;-H</pre></div><p>Area is also implemented using the <code class="literal">svg:path</code> element (see line <code class="literal">G</code>). D3 area generator is used to generate the <code class="literal">"d"</code> formula for the <code class="literal">svg:path</code> element on line <code class="literal">H</code> with data <code class="literal">"d"</code> as its input parameter.</p></div></div>
<div class="section" title="Using area interpolation"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Using area interpolation</h1></div></div></div><p>Similar to the D3 line generator, area generator also supports identical interpolation mode, hence, it can be used in combination with the line generator in every mode.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec150"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/area-interpolation.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/area-interpolation.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec151"/>How to do it...</h2></div></div></div><p>In this recipe, we will show <a id="id414" class="indexterm"/>how interpolation mode can be configured on an area generator. This way matching interpolated area can then be created with corresponding line:</p><div class="informalexample"><pre class="programlisting">    var width = 500,
        height = 500,
        margin = 30,
        x = d3.scale.linear()
            .domain([0, 10])
            .range([margin, width - margin]),
        y = d3.scale.linear()
            .domain([0, 10])
            .range([height - margin, margin]);
        
    var data = d3.range(11).map(function(i){
        return {x: i, y: Math.sin(i)*3 + 5};
    });
        
    var svg = d3.select("body").append("svg");
        
    svg.attr("height", height)
        .attr("width", width);        
        
    renderAxes(svg);
        
    render("linear");    
        
    renderDots(svg);
        
    function render(mode){
        var line = d3.svg.line()
<span class="strong"><strong>                .interpolate(mode) // &lt;-A</strong></span>
                .x(function(d){return x(d.x);})
                .y(function(d){return y(d.y);});
        
        svg.selectAll("path.line")
                .data([data])
            .enter()
                .append("path")
                .attr("class", "line");                
        
        svg.selectAll("path.line")
                .data([data])       
            .attr("d", function(d){return line(d);});        
        
        var area = d3.svg.area()
<span class="strong"><strong>            .interpolate(mode) // &lt;-B</strong></span>
            .x(function(d) { return x(d.x); })
            .y0(height - margin)
            .y1(function(d) { return y(d.y); });
            
        svg.selectAll("path.area")
                .data([data])
            .enter()
                .append("path")
                .attr("class", "area")
                
        svg.selectAll("path.area")
            .data([data])
            .attr("d", function(d){return area(d);});        
}
// Dots and Axes related code omitted</pre></div><p>The preceding code <a id="id415" class="indexterm"/>generates a pseudo area chart with configurable interpolation mode:</p><div class="mediaobject"><img src="graphics/2162OS_07_08.jpg" alt="How to do it..."/><div class="caption"><p>Area interpolation</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec152"/>How it works...</h2></div></div></div><p>This recipe is similar to the <a id="id416" class="indexterm"/>previous one except that in this recipe the interpolation mode is passed in based on the user's selection:</p><div class="informalexample"><pre class="programlisting">var line = d3.svg.line()
                .interpolate(mode) // &lt;-A
                .x(function(d){return x(d.x);})
                .y(function(d){return y(d.y);});

var area = d3.svg.area()
            .interpolate(mode) // &lt;-B
            .x(function(d) { return x(d.x); })
            .y0(y(0))
            .y1(function(d) { return y(d.y); });</pre></div><p>As you can see, the <a id="id417" class="indexterm"/>interpolation mode is configured on both lines along with the area generator through the <code class="literal">interpolate</code> function<a id="id418" class="indexterm"/> (see lines <code class="literal">A</code> and <code class="literal">B</code>). Since D3 line and area generator supports the same set of interpolation mode, they can always be counted on to generate matching line and area as seen in this recipe.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec153"/>There's more...</h2></div></div></div><p>D3 area generator also supports the same tension configuration when interpolated using Cardinal mode, however, since it is identical to line generator's tension support, and due to limited scope in this book we will not cover area tension here.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec154"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to <a class="ulink" href="https://github.com/mbostock/d3/wiki/SVG-Shapes#wiki-area">https://github.com/mbostock/d3/wiki/SVG-Shapes#wiki-area</a> for more information on area generator functions</li></ul></div></div></div>
<div class="section" title="Using an arc generator"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Using an arc generator</h1></div></div></div><p>Among the most common shape generators—besides the line and area generator—D3 also provides the<a id="id419" class="indexterm"/> <span class="strong"><strong>arc generator</strong></span>. At this point, you might be wondering, <span class="emphasis"><em>Didn't SVG standard already include circle element? Isn't that enough?</em></span>
</p><p>The simple answer to this is "no". The D3 arc generator is a lot more versatile than the simple <code class="literal">svg:circle</code> element. the D3 arc generator is capable of creating not only circles but also annulus (donut-like), circular sector, and annulus sector, all of which we will learn in this recipe. More importantly, an arc generator is designed to generate, as its name suggests, an arc (in others words, not a full circle or even a sector but rather arcs of arbitrary angle).</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec155"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/arc.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/arc.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec156"/>How to do it...</h2></div></div></div><p>In this recipe we will <a id="id420" class="indexterm"/>use arc generator to generate multi-slice circle, annulus (donut), circular sectors, and annulus sectors. </p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
var width = 400,
height = 400,
// angles are in radians
<span class="strong"><strong>    fullAngle = 2 * Math.PI, // &lt;-A</strong></span>
    colors = d3.scale.category20c();
    
var svg = d3.select("body").append("svg")
            .attr("class", "pie")
            .attr("height", height)
            .attr("width", width);    

function render(innerRadius, endAngle){
    if(!endAngle) endAngle = fullAngle;

<span class="strong"><strong>    var data = [ // &lt;-B</strong></span>
<span class="strong"><strong>        {startAngle: 0, endAngle: 0.1 * endAngle},</strong></span>
<span class="strong"><strong>        {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle},</strong></span>
<span class="strong"><strong>        {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle},</strong></span>
<span class="strong"><strong>        {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},        </strong></span>
<span class="strong"><strong>        {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},        </strong></span>
<span class="strong"><strong>        {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},        </strong></span>
<span class="strong"><strong>        {startAngle: 0.9 * endAngle, endAngle: endAngle}</strong></span>
<span class="strong"><strong>    ];</strong></span>
    
<span class="strong"><strong>    var arc = d3.svg.arc().outerRadius(200) // &lt;-C</strong></span>
<span class="strong"><strong>                    .innerRadius(innerRadius);</strong></span>
    
    svg.select("g").remove();
    
    svg.append("g")
            .attr("transform", "translate(200,200)")
    .selectAll("path.arc")
            .data(data)
        .enter()
            .append("path")
                .attr("class", "arc")
                .attr("fill", function(d, i){return colors(i);})
<span class="strong"><strong>                .attr("d", function(d, i){</strong></span>
<span class="strong"><strong>                   return arc(d, i); // &lt;-D</strong></span>
<span class="strong"><strong>});</strong></span>
}

render(0);
&lt;/script&gt;

&lt;div class="control-group"&gt;
    &lt;button onclick="render(0)"&gt;Circle&lt;/button&gt;
    &lt;button onclick="render(100)"&gt;Annulus(Donut)&lt;/button&gt;
    &lt;button onclick="render(0, Math.PI)"&gt;Circular Sector&lt;/button&gt;
    &lt;button onclick="render(100, Math.PI)"&gt;Annulus Sector&lt;/button&gt;
&lt;/div&gt;</pre></div><p>The preceding code produces <a id="id421" class="indexterm"/>the following circle, which you can change into an arc, a sector, or an arc sector by clicking on the buttons, for example, <span class="strong"><strong>Annulus(Donut)</strong></span> generates the second shape:</p><div class="mediaobject"><img src="graphics/2162OS_07_09.jpg" alt="How to do it..."/><div class="caption"><p>Arc generator</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec157"/>How it works...</h2></div></div></div><p>The most important part of understanding the D3 arc generator is its data structure. D3 arc generator has very specific requirements when it comes to its data, as shown on line <code class="literal">B</code>:</p><div class="informalexample"><pre class="programlisting">var data = [ // &lt;-B
        {startAngle: 0, endAngle: 0.1 * endAngle},
        {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle},
        {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle},
        {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},        
        {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},        
        {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},        
        {startAngle: 0.9 * endAngle, endAngle: endAngle}
];</pre></div><p>Each row of the arc data has to contain two mandatory fields, <code class="literal">startAngle</code> and <code class="literal">endAngle</code>. The angles have to be in the range <code class="literal">[0, 2 * Math.PI]</code> (see line <code class="literal">A</code>). D3 arc generator will use these angles to generate corresponding slices, as shown earlier in this recipe.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip40"/>Tip</h3><p>Along with the start and end angles, arc data set can contain any number of additional fields, which can then be accessed in D3 functions to drive other visual representation.</p></div></div><p>If you are thinking that<a id="id422" class="indexterm"/> calculating these angles based on the data you have is going to be a big hassle, you are absolutely correct. This is why D3 provides specific layout manager to help you calculate these angles, and which we will cover in the next chapter. For now, let's focus on understanding the basic mechanism behind the scenes so that when it is time to introduce the layout manager or if you ever need to set the angles manually, you will be well-equipped to do so. D3 arc generator is created using the <code class="literal">d3.svg.arc</code> function:</p><div class="informalexample"><pre class="programlisting">var arc = d3.svg.arc().outerRadius(200) // &lt;-C
                    .innerRadius(innerRadius); </pre></div><p>The<code class="literal"> d3.svg.arc</code> function optionally has <code class="literal">outerRadius</code> and <code class="literal">innerRadius</code> settings. When <code class="literal">innerRadius</code> is set, the arc generator will produce an image of annulus (donut) instead of a circle. Finally, the D3 arc is also implemented using the <code class="literal">svg:path</code> element, and thus similar to the line and area generator, <code class="literal">d3.svg.arc</code> generator function can be invoked (see line <code class="literal">D</code>) to generate the <code class="literal">d</code> formula for the <code class="literal">svg:path</code> element:</p><div class="informalexample"><pre class="programlisting">svg.append("g")
            .attr("transform", "translate(200,200)")
    .selectAll("path.arc")
            .data(data)
        .enter()
            .append("path")
                .attr("class", "arc")
                .attr("fill", function(d, i){return colors(i);})
                .attr("d", function(d, i){
                    return arc(d, i); // &lt;-D
                });</pre></div><p>One additional element worth mentioning here is the <code class="literal">svg:g</code> element. This element does not define any shape itself, but serves rather as a container element used to group other elements, in this case, the <code class="literal">path.arc</code> elements. Transformation applied to the <code class="literal">g</code> element is applied to all the <a id="id423" class="indexterm"/>child elements while its attributes are also inherited by its child elements.</p></div></div>
<div class="section" title="Implementing arc transition"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec58"/>Implementing arc transition</h1></div></div></div><p>One area where arc differs <a id="id424" class="indexterm"/>significantly from other shapes, such as line and area, is its transition. For most of the shapes we covered so far, including simple SVG built-in shapes, you can rely on D3 transition and interpolation to handle their animation. However, this is not the case when dealing with arc. We will explore the arc transition technique in this recipe.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec158"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/arc-transition.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/arc-transition.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec159"/>How to do it...</h2></div></div></div><p>In this recipe, we will <a id="id425" class="indexterm"/>animate a multi-slice annulus transitioning each slice starting from angle <code class="literal">0</code> to its final desired angle and eventually reaching a full annulus:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
var width = 400,
        height = 400,
        endAngle = 2 * Math.PI,
        colors = d3.scale.category20c();

var svg = d3.select("body").append("svg")
        .attr("class", "pie")
        .attr("height", height)
        .attr("width", width);

function render(innerRadius) {

    var data = [
        {startAngle: 0, endAngle: 0.1 * endAngle},
        {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle},
        {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle},
        {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},
        {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},
        {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},
        {startAngle: 0.9 * endAngle, endAngle: endAngle}
    ];

    var arc = d3.svg.arc().outerRadius(200).innerRadius(innerRadius);

    svg.select("g").remove();

    svg.append("g")
        .attr("transform", "translate(200,200)")
        .selectAll("path.arc")
            .data(data)
        .enter()
            .append("path")
            .attr("class", "arc")
            .attr("fill", function (d, i) {
                return colors(i);
            })
            .transition().duration(1000)
<span class="strong"><strong>            .attrTween("d", function (d) { // &lt;-A </strong></span>
<span class="strong"><strong>                var start = {startAngle: 0, endAngle: 0}; // &lt;-B</strong></span>
<span class="strong"><strong>                var interpolate = d3.interpolate(start, d); // &lt;-C</strong></span>
<span class="strong"><strong>                return function (t) {</strong></span>
<span class="strong"><strong>                    return arc(interpolate(t)); // &lt;-D</strong></span>
<span class="strong"><strong>                };</strong></span>
<span class="strong"><strong>            });</strong></span>
}

render(100);
&lt;/script&gt;</pre></div><p>The preceding code<a id="id426" class="indexterm"/> generates an arc which starts rotating and eventually becomes a complete annulus:</p><div class="mediaobject"><img src="graphics/2162OS_07_10.jpg" alt="How to do it..."/><div class="caption"><p>Arc transition with tweening</p></div></div><p>]</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec160"/>How it works...</h2></div></div></div><p>When confronted <a id="id427" class="indexterm"/>with the requirement of such transition, your first thought might be using the vanilla D3 transition while relying on built-in interpolations to generate the animation. Here is the code snippet which will do just that:</p><div class="informalexample"><pre class="programlisting">svg.append("g")
        .attr("transform", "translate(200,200)")
        .selectAll("path.arc")
            .data(data)
        .enter()
            .append("path")
            .attr("class", "arc")
            .attr("fill", function (d, i) {
                return colors(i);
            })
<span class="strong"><strong>            .attr("d", function(d){</strong></span>
<span class="strong"><strong>               return arc({startAngle: 0, endAngle: 0});</strong></span>
<span class="strong"><strong>             })</strong></span>
<span class="strong"><strong>            .transition().duration(1000).ease("linear")</strong></span>
<span class="strong"><strong>            .attr("d", function(d){return arc(d);});</strong></span>
</pre></div><p>As shown with highlighted lines in the preceding code snippet, with this approach we initially created slice path with both <code class="literal">startAngle</code> and <code class="literal">endAngle</code> set to zero. Then, through transition we interpolated the path <code class="literal">"d"</code> attribute to its final angle using the arc generator function <code class="literal">arc(d)</code>. This approach seems to make sense, however, what it generates is the transition shown in the following:</p><div class="mediaobject"><img src="graphics/2162OS_07_11.jpg" alt="How it works..."/><div class="caption"><p>Arc transition without tweening</p></div></div><p>This is obviously<a id="id428" class="indexterm"/> not the animation we want. The reason for this strange transition is that by directly creating a transition on the <code class="literal">svg:path</code> attribute <code class="literal">"d"</code>, we are instructing D3 to interpolate this string:</p><div class="informalexample"><pre class="programlisting">d="M1.2246063538223773e-14,-200A200,200 0 0,1 1.2246063538223773e-14,-200L6.123031769111886e-15,-100A100,100 0 0,0 6.123031769111886e-15,-100Z"</pre></div><p>To this string linearly:</p><div class="informalexample"><pre class="programlisting">d="M1.2246063538223773e-14,-200A200,200 0 0,1 117.55705045849463,-161.80339887498948L58.778525229247315,-80.90169943749474A100,100 0 0,0 6.123031769111886e-15,-100Z"</pre></div><p>Hence, this particular transition effect.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>Though this transition effect is not what we desire in this example, this is still a good showcase of how flexible and powerful built-in D3 transition is.</p></div></div><p>In order to achieve the transition effect we want, we need to leverage the D3 attribute tweening (for detailed description on tweening, see the <span class="emphasis"><em>Using tweening</em></span> recipe of <a class="link" href="ch06.html" title="Chapter 6. Transition with Style">Chapter 6</a>, <span class="emphasis"><em>Transition with Style</em></span>):</p><div class="informalexample"><pre class="programlisting">svg.append("g")
        .attr("transform", "translate(200,200)")
        .selectAll("path.arc")
            .data(data)
        .enter()
            .append("path")
            .attr("class", "arc")
            .attr("fill", function (d, i) {
                return colors(i);
            })
            .transition().duration(1000)
            .attrTween("d", function (d) { // &lt;-A
                var start = {startAngle: 0, endAngle: 0}; // &lt;-B
                var interpolate = d3.interpolate(start, d); // &lt;-C
                return function (t) {
                    return arc(interpolate(t)); // &lt;-D
                };
            });</pre></div><p>Here, instead of transitioning the <code class="literal">svg:path</code> attribute <code class="literal">"d"</code> directly, we created a tweening function on line <code class="literal">A</code>. As you can recall, D3 <code class="literal">attrTween</code> expects a factory function for a tween function. In this case, we start our tweening from angle zero (see line <code class="literal">B</code>). Then we create a compound object interpolator on line <code class="literal">C</code>, which will interpolate both start and end angles for each slice. Finally on line <code class="literal">D</code>, the arc generator is used to generate a proper <code class="literal">svg:path</code> formula using already interpolated angles. This is how a smooth transition of properly-angled <a id="id429" class="indexterm"/>arcs can be created through custom attribute tweening.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec161"/>There's more...</h2></div></div></div><p>D3 also provides support for other shape generators, for example, symbol, chord, and diagonal. However, due to their simplicity and the limited scope in this book we will not cover them individually here, although we will cover them as parts of other more complex visual constructs in the following chapters. More importantly, with well-grounded understanding of these shape generators that we introduced in this chapter, you should be able to pick up other D3 shape generators without much trouble.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec162"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more information on transition and tweening, refer to the Using tweening recipe in <a class="link" href="ch06.html" title="Chapter 6. Transition with Style">Chapter 6</a>, <span class="emphasis"><em>Transition with Style</em></span></li></ul></div></div></div></body></html>