- en: Chapter 5. Creating Great Maps
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。创建出色地图
- en: In this chapter, we will cover the important features that enable us to create
    great maps. We will first go into advanced vector styling, building on what we
    learned in [Chapter 2](ch02.html "Chapter 2. Viewing Spatial Data"), *Viewing
    Spatial Data*. Then, we will learn how to label features by following examples
    for point labels as well as more advanced road labels with road shield graphics.
    We will also cover how to tweak labels manually. Finally, we will get to know
    the print composer and how to use it to create printable maps and map books.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍使我们能够创建出色地图的重要功能。我们首先将深入了解高级矢量样式，基于我们在[第2章](ch02.html "第2章。查看空间数据")，“查看空间数据”中学到的知识。然后，我们将通过点标签的示例以及带有道路标志图形的更高级道路标签来学习如何标注要素。我们还将介绍如何手动调整标签。最后，我们将了解打印作曲家以及如何使用它来创建可打印的地图和地图集。
- en: Advanced vector styling
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高级矢量样式
- en: This section introduces more advanced vector styling features, building on the
    basics we saw in [Chapter 2](ch02.html "Chapter 2. Viewing Spatial Data"), *Viewing
    Spatial Data*. We will see how to use graduated styles, categorized styles, and
    rulebased styles.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍了更高级的矢量样式功能，基于我们在[第2章](ch02.html "第2章。查看空间数据")，“查看空间数据”中看到的基础知识。我们将看到如何使用渐变样式、分类样式和基于规则的样式。
- en: Creating a graduated style with size-scaling
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用尺寸缩放创建渐变风格
- en: 'Graduated styles are great to visualize distributions of numeric values in
    a choropleth map or similar. In our sample data, there is a `climate.shp` file,
    which contains locations and mean temperature values that we can visualize using
    a graduated style by simply selecting the value **T_F_MEAN** for the **Column**
    field and clicking on **Classify**. We can pick an existing **Color ramp** field
    or create a new one by scrolling down the list to the **New color ramp…** entry.
    Graduated styles are available in different classification modes as follows:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 渐变风格非常适合在等值图中或类似地图中可视化数值分布。在我们的样本数据中，有一个`climate.shp`文件，其中包含位置和平均温度值，我们可以通过简单地选择**列**字段中的值**T_F_MEAN**并点击**分类**来使用渐变风格进行可视化。我们可以选择现有的**颜色渐变**字段，或者通过滚动列表到**新建颜色渐变…**条目来创建一个新的。渐变风格在不同的分类模式中可用，如下所示：
- en: '**Equal Intervals**: This mode creates classes by splitting at equal intervals
    between the maximum and minimum values found in the specified column'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**等间隔**：此模式通过在指定列中找到的最大值和最小值之间的等间隔来创建类'
- en: '**Quantile (Equal Count)**: This mode creates classes so that each class contains
    an equal number of features'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分位数（等计数）**：此模式创建类，使得每个类包含相等数量的要素'
- en: '**Natural Breaks (Jenks)**: This mode uses the Jenks Natural Breaks algorithm
    to create classes by taking the distribution of values into account'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自然断点（Jenks）**：此模式使用Jenks自然断点算法，通过考虑值的分布来创建类'
- en: '**Standard Deviation**: This mode uses the column values'' standard deviation
    to create classes'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准差**：此模式使用列值的标准差来创建类'
- en: '**Pretty Breaks**: This mode is the only classification that doesn''t strictly
    create the specified number of classes, but tries to find pretty class breaks
    instead'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**漂亮的断点**：此模式是唯一不严格创建指定数量的类的分类，而是试图找到漂亮的类断点'
- en: Besides using color to distinguish between the different temperature values,
    we can also use size. By setting the **Size scale** **field** field in the **Advanced**
    tab to **T_F_MEAN**, as shown in the following screenshot, all point symbols will
    be scaled so that locations with higher mean temperatures are displayed with a
    bigger symbol.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用颜色区分不同的温度值外，我们还可以使用大小。通过在**高级**选项卡中将**尺寸比例****字段**设置为**T_F_MEAN**，如图下截图所示，所有点符号都将按比例缩放，使得平均温度较高的位置以更大的符号显示。
- en: Tip
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Using **Size scale field** , we can make the size of point symbols or the width
    of line symbols responsive to a certain attribute value. Note that we can choose
    between scaling the area or the diameter of a point symbol depending on the nature
    of the values. Similarly, there is also a **Rotation field** option, which allows
    us to rotate point symbols. The expected input is in degrees from 0 to 360 with
    0 pointing towards the north.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**尺寸比例字段**，我们可以使点符号的大小或线符号的宽度响应于某个属性值。请注意，我们可以根据值的性质选择缩放点符号的面积或直径。同样，还有一个**旋转字段**选项，允许我们旋转点符号。预期的输入是从0到360度的度数，0指向北方。
- en: '![Creating a graduated style with size-scaling](img/7488_05_01.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![使用尺寸缩放创建渐变风格](img/7488_05_01.jpg)'
- en: 'The following screenshot shows the results of using a **Graduated renderer**
    option with four classes using the **Pretty Breaks** classification mode and a
    **Size scale field** option, as shown in the preceding screenshot:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了使用**渐变渲染器**选项的结果，其中包含四个类别，使用**漂亮断点**分类模式和**大小缩放字段**选项，如前一个截图所示：
- en: '![Creating a graduated style with size-scaling](img/7488_05_02.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![创建具有大小缩放的渐变样式](img/7488_05_02.jpg)'
- en: Using categorized styles
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用分类样式
- en: Just as graduated styles are very useful to visualize numeric values, categorized
    styles are great for text values, or more generally speaking, for all kinds of
    values on a nominal scale. A good example for this kind of data can be found in
    the `trees.shp` file in our sample data. For each area, there is a **VEGDESC**
    value that describes the type of forest found there. Using a categorized style,
    we can very easily generate a style with one symbol for every unique value in
    the **VEGDESC** column as shown in the following screenshot.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 正如渐变样式对于可视化数值非常有用一样，分类样式非常适合文本值，或者更普遍地说，对于名义尺度上的所有类型的值。这种数据的良好示例可以在我们的样本数据中的`trees.shp`文件中找到。对于每个区域，都有一个**VEGDESC**值，它描述了那里发现的森林类型。使用分类样式，我们可以非常容易地生成一个样式，其中每个唯一的**VEGDESC**列值都有一个符号，如以下截图所示。
- en: Of course, every symbol is editable and can be customized. Just double-click
    on the symbol preview to open the **Symbol** selector dialog, which allows us
    to select and combine different symbols.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，每个符号都是可编辑的，并且可以自定义。只需双击符号预览以打开**符号**选择对话框，它允许我们选择和组合不同的符号。
- en: '![Using categorized styles](img/7488_05_03.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![使用分类样式](img/7488_05_03.jpg)'
- en: 'Once we click on **OK**, the style is applied to our trees layer to visualize
    the distribution of different tree types in the area. The map will look like the
    following screenshot:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们点击**确定**，样式就会应用到我们的树木层上，以可视化该区域不同树种的分布。地图将看起来像以下截图：
- en: '![Using categorized styles](img/7488_05_04.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![使用分类样式](img/7488_05_04.jpg)'
- en: Creating a rule-based style for road layers
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为道路层创建基于规则的样式
- en: With rule-based styles, we can create a layer style with a hierarchy of rules.
    Rules can take into account anything, from attribute values to scale and geometry
    properties such as area or length. The following screenshot shows an example of
    a rule-based renderer for the `ne_10m_roads.shp` file from Natural Earth (you
    can download it from [http://www.naturalearthdata.com/downloads/10m-cultural-vectors/roads/](http://www.naturalearthdata.com/downloads/10m-cultural-vectors/roads/)).
    On the first level of rules, we distinguish between roads of **"type" = 'Major
    Highway'** and those of **"type" = 'Secondary Highway'**. The next level of rules
    handles scale-dependence. To add this second layer of rules, we can use the **Refine
    current rules** button and select **Add scales to rule**. We simply input one
    or more scale values at which we want the rule to be split.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 使用基于规则的样式，我们可以创建一个具有规则层次结构的层样式。规则可以考虑到任何东西，从属性值到比例和几何属性，如面积或长度。以下截图显示了来自Natural
    Earth的`ne_10m_roads.shp`文件的一个基于规则的渲染器示例（您可以从[http://www.naturalearthdata.com/downloads/10m-cultural-vectors/roads/](http://www.naturalearthdata.com/downloads/10m-cultural-vectors/roads/)下载它）。在规则的第一个级别上，我们区分了**"type"
    = 'Major Highway'**的道路和**"type" = 'Secondary Highway'**的道路。下一级别的规则处理比例依赖性。要添加这个第二层规则，我们可以使用**细化当前规则**按钮并选择**向规则添加比例**。我们只需输入一个或多个我们希望规则分割的比例值。
- en: Tip
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: There are no symbols specified on the first rule level. If we would have symbols
    specified on the first level as well, the renderer would draw two symbols over
    each other. While this can be useful in certain cases, we don't want this effect
    now. Symbols can be deactivated in the Rule properties, which are accessible by
    double-clicking on the rule or clicking on the edit button below the rule's tree
    view (the button between the plus and minus buttons).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 第一规则级别上没有指定任何符号。如果我们也在第一级别指定了符号，渲染器会在每个符号上绘制两个符号。虽然这在某些情况下可能很有用，但我们现在不希望有这种效果。可以在规则属性中禁用符号，这些属性可以通过双击规则或单击规则树视图下方的编辑按钮（位于加号和减号按钮之间）访问。
- en: '![Creating a rule-based style for road layers](img/7488_05_05.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![为道路层创建基于规则的样式](img/7488_05_05.jpg)'
- en: In the following screenshot, we can see the scale rules in action. While the
    left-hand side shows a simplified version with thin grey lines for secondary highways,
    the right-hand side version shows wider, white roads with grey outlines.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下截图中，我们可以看到比例规则在起作用。左侧显示了一个简化版本，次要公路用细灰色线条表示，而右侧版本显示了更宽的白色道路和灰色轮廓。
- en: '![Creating a rule-based style for road layers](img/7488_05_06.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![为道路图层创建基于规则的样式](img/7488_05_06.jpg)'
- en: Tip
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'You can download the symbols used in this style by going to **Settings** |
    **Style Manager** | **Share** | **Import from**. The URL is [https://raw.github.com/anitagraser/QGIS-resources/master/symbols/osm_symbols.xml](https://raw.github.com/anitagraser/QGIS-resources/master/symbols/osm_symbols.xml).
    Paste the URL in the **Location** textbox, click on **Fetch Symbols**, then on
    **Select all**, and finally on **Import**. The dialog will look like the following
    screenshot:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过访问**设置** | **样式管理器** | **共享** | **导入**来下载此样式使用的符号。URL是[https://raw.github.com/anitagraser/QGIS-resources/master/symbols/osm_symbols.xml](https://raw.github.com/anitagraser/QGIS-resources/master/symbols/osm_symbols.xml)。将URL粘贴到**位置**文本框中，点击**获取符号**，然后点击**全选**，最后点击**导入**。对话框将类似于以下截图：
- en: '![Creating a rule-based style for road layers](img/7488_05_07.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![为道路图层创建基于规则的样式](img/7488_05_07.jpg)'
- en: Labeling
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 标签
- en: We can activate labeling by going to **Layer Properties** | **Labels**, checking
    **Label this layer with**, and selecting the attribute field that we want to use
    for the labels. This is all we need to do to display labels with default settings.
    While default labels are great for a quick preview, we usually want to customize
    the labels if we create visualizations for reports or stand-alone maps.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过访问**图层属性** | **标签**，勾选**使用以下标签标记此图层**，并选择我们想要用于标签的属性字段来激活标签。这就是我们显示默认设置标签所需做的全部。虽然默认标签对于快速预览很好，但如果我们为报告或独立地图创建可视化，我们通常希望自定义标签。
- en: 'Using **Expressions** (the button that is right beside the attribute drop-down
    list), we can format the label text to suit our needs. For example, the **NAME**
    field in our sample `airports.shp` file contains text in uppercase. To display
    the airport names in mixed case instead, we can set the expression `title(NAME)`,
    which will reformat the name text in title case. We can also use multiple fields
    to create the label, for example, combining name and elevation in brackets using
    the concatenation operator `||` as follows:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**表达式**（位于属性下拉列表右侧的按钮），我们可以格式化标签文本以满足我们的需求。例如，我们样本`airports.shp`文件中的**NAME**字段包含大写文本。为了以混合大小写显示机场名称，我们可以设置表达式`title(NAME)`，这将重新格式化名称文本为标题大小写。我们还可以使用多个字段来创建标签，例如，使用连接运算符`||`将名称和海拔高度在括号中结合，如下所示：
- en: '`title(NAME) || '' ('' || "ELEV" || '')''`'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '`title(NAME) || '' ('' || "ELEV" || '')''`'
- en: 'Note the use of simple quotation marks around text such as `'' (''` and double
    quotation marks around field names such as `"ELEV"`. The dialog will look like
    the following screenshot:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 注意文本周围的简单引号，如`' ('`，以及字段名周围的双引号，如`"ELEV"`。对话框将类似于以下截图：
- en: '![Labeling](img/7488_05_08a.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![标签](img/7488_05_08a.jpg)'
- en: 'The big preview area at the top of the dialog titled **Text/Buffer sample**
    shows a preview of the current settings. The background color can be adjusted
    to test readability on different backgrounds. Under the preview area, we find
    the following different label settings:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 对话框顶部的大预览区域，标题为**文本/缓冲区样本**，显示了当前设置的预览。背景颜色可以调整以测试在不同背景上的可读性。在预览区域下方，我们可以找到以下不同的标签设置：
- en: '**Text**: Besides changing the font style, size, color, and transparency, we
    can also modify letter and word spacing as well as the blend mode, which works
    like the layer blending mode we covered in [Chapter 2](ch02.html "Chapter 2. Viewing
    Spatial Data"), *Viewing Spatial Data*. Note the column of buttons on the right-hand
    side of every setting. Clicking on these buttons allows us to create so-called
    data-defined overrides. These can be used, for example, to define different label
    colors or to vary label size depending on an individual feature''s attribute value
    or an expression.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文本**：除了更改字体样式、大小、颜色和透明度外，我们还可以修改字母和单词间距以及混合模式，这与我们在[第2章](ch02.html "第2章。查看空间数据")中介绍的图层混合模式类似，即**查看空间数据**。注意每个设置右侧的按钮列。点击这些按钮允许我们创建所谓的“数据定义覆盖”。例如，我们可以使用这些覆盖来定义不同的标签颜色或根据单个要素的属性值或表达式来改变标签大小。'
- en: '**Formatting**: Here we can enable multiline labels by specifying which characters
    to wrap on. Additionally, we can control **line height** and **alignment**. We
    can also add a symbol that displays the line''s digitizing direction to the label.
    Finally, the **Formatted numbers** option offers a shortcut to format numeric
    values to a certain number of decimal places.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Formatting**: 在这里，我们可以通过指定哪些字符要换行来启用多行标签。此外，我们可以控制 **line height** 和 **alignment**。我们还可以将表示线条数字化方向的符号添加到标签中。最后，**Formatted
    numbers** 选项提供了一个快捷方式，可以将数值格式化为特定的小数位数。'
- en: '**Buffer**: We can adjust the buffer size, color and transparency, as well
    as the pen join style, and blending mode. With transparency and blending, we can
    improve label readability without blocking out the underlying map too much.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Buffer**: 我们可以调整缓冲区大小、颜色和透明度，以及笔尖连接样式和混合模式。通过透明度和混合，我们可以在不过多遮挡底层地图的情况下提高标签的可读性。'
- en: '**Background**: This allows us to add a background shape in the form of a rectangle,
    square, circle, ellipsoid, or an SVG. SVG backgrounds are great to create effects
    such as highway shields.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Background**: 这允许我们添加矩形、正方形、圆形、椭球体或 SVG 形式的背景形状。SVG 背景非常适合创建如高速公路标志等效果。'
- en: '**Shadow**: This makes it possible to add a shadow to labels. We can control
    everything from shadow direction to color, blur, size, and transparency.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Shadow**: 这使得为标签添加阴影成为可能。我们可以控制从阴影方向到颜色、模糊度、大小和透明度的所有内容。'
- en: '**Placement**: The available automatic label placement options depend on the
    layer geometry type. For point layers, we can choose between the following:'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Placement**: 可用的自动标签放置选项取决于图层几何类型。对于点图层，我们可以选择以下选项：'
- en: The flexible **Around point** option tries to find the best position for labels
    by distributing them around the points without overlaps. As you can see in the
    following screenshot, some labels are put to the upper-right corner of their point
    symbol while others appear at different positions in the lower-left (for example,
    **Anchorage Intl (129)**) or lower-right (for example, **Merrill Fld (123)**)
    corners.
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 灵活的 **Around point** 选项试图通过在点周围分布标签来找到最佳位置，避免重叠。正如您在下面的屏幕截图中所见，一些标签被放置在其点符号的右上角，而其他标签则出现在左下角的不同位置（例如，**Anchorage
    Intl (129)**）或右下角（例如，**Merrill Fld (123)**）。
- en: The **Offset from point** option forces all labels to a certain position; for
    example, all labels can be placed above their point symbol.
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Offset from point** 选项强制所有标签到某个位置；例如，所有标签都可以放置在其点符号上方。'
- en: 'The following screenshot shows airport labels with a 50 percent transparent
    **Buffer** and **Drop Shadow** placed using **Around point** and a **Label distance**
    of 1 mm:'
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下屏幕截图显示了使用 **Around point** 和 **Label distance** 为 1 mm 放置的带有 50% 透明 **Buffer**
    和 **Drop Shadow** 的机场标签：
- en: '![Labeling](img/7488_05_08.jpg)'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![Labeling](img/7488_05_08.jpg)'
- en: 'For line layers, we can choose from the following:'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于线图层，我们可以选择以下选项：
- en: '**Parallel** for straight labels that are rotated according to the line orientation'
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Parallel** 用于根据线条方向旋转的直行标签'
- en: '**Curved** for labels that follow the shape of the line'
  id: totrans-52
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Curved** 用于跟随线条形状的标签'
- en: '**Horizontal** for labels that keep a horizontal orientation regardless of
    the line orientation'
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Horizontal** 用于保持水平方向的标签，无论线条方向如何'
- en: For further fine-tuning, we can define whether the label should be placed **Above**
    **line**, **One line**, or **Below line**, and how far above and below using **Label
    distance**.
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了进一步微调，我们可以定义标签是否应放置在 **Above** **line**、**One line** 或 **Below line**，以及使用
    **Label distance** 的上下距离。
- en: 'The following example shows labels with road shields. You can download a blank
    road shield SVG from [http://upload.wikimedia.org/wikipedia/commons/c/c3/Blank_shield.svg](http://upload.wikimedia.org/wikipedia/commons/c/c3/Blank_shield.svg).
    Note how only Interstates are labeled. This can be achieved using the following
    labeling expression:'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下示例显示了带有道路标志的标签。您可以从 [http://upload.wikimedia.org/wikipedia/commons/c/c3/Blank_shield.svg](http://upload.wikimedia.org/wikipedia/commons/c/c3/Blank_shield.svg)
    下载空白道路标志 SVG。注意只有 Interstate 被标记。这可以通过以下标签表达式实现：
- en: '`CASE WHEN "level" = ''Interstate'' THEN name END`'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`CASE WHEN "level" = ''Interstate'' THEN name END`'
- en: The labels are positioned using the **Horizontal** option. Additionally, **Merge
    connected lines to avoid duplicate labels** (in the Rendering section) and **Suppress
    labeling of features smaller than** are activated; for example, 5 mm helps to
    avoid clutter by not labeling pieces of road that are shorter than 5 mm at the
    current scale.
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 标签使用**水平**选项进行定位。此外，**合并连接的线以避免重复标签**（在渲染部分）和**抑制小于以下特征大小的标签化**被激活；例如，5毫米有助于避免在当前比例下标签化长度小于5毫米的路段，从而避免杂乱。
- en: '![Labeling](img/7488_05_09.jpg)'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![标签化](img/7488_05_09.jpg)'
- en: To set up the road shield, go to the **Background** section and select the blank
    shield SVG from the folder you downloaded it to. To make sure that the label fits
    nicely inside the shield, we additionally specify the **Size type** field as a
    buffer with a **Size** of 1 mm, which makes the shield a little bigger than the
    label it contains.
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要设置道路标志，请转到**背景**部分，并从您下载到的文件夹中选择空白盾牌SVG。为了确保标签能够很好地位于盾牌内部，我们另外指定了**大小类型**字段为带有**大小**为1毫米的缓冲区，这使得盾牌比包含的标签略大。
- en: If you click on **Apply** now, you will notice that the labels are not centered
    perfectly inside the shields. To fix that, we apply a small **Offset** in the
    **Y** direction to the shield position, as shown in the following screenshot.
    Additionally, I recommend to deactivate the label **Buffer** as it tends to block
    out parts of the shield, and we don't need it anyway.
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您现在点击**应用**，您会注意到标签并没有完美地居中在盾牌内。为了解决这个问题，我们在盾牌位置应用了一个小的**Y方向偏移**，如图下所示。此外，我建议禁用标签**缓冲**，因为它往往会遮挡盾牌的一部分，而我们实际上也不需要它。
- en: '![Labeling](img/7488_05_10.jpg)'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![标签化](img/7488_05_10.jpg)'
- en: 'For polygon layers, the options are as follows:'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于多边形图层，选项如下：
- en: '**Offset from centroid**, which uses the polygon centroid as an anchor and
    works like **Offset from point** for point layers'
  id: totrans-63
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从质心偏移**，它使用多边形质心作为锚点，对于点图层来说，它的工作方式类似于**从点偏移**。'
- en: '**Around centroid** works in a manner similar to **Around point**'
  id: totrans-64
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**围绕质心**的工作方式类似于**围绕点**。'
- en: '**Horizontal** places a horizontal label somewhere inside the polygon, independent
    of the centroid'
  id: totrans-65
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**水平**将水平标签放置在多边形内的某个位置，独立于质心。'
- en: '**Free** fits a freely rotated label inside the polygon'
  id: totrans-66
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自由**选项将自由旋转的标签放置在多边形内。'
- en: '**Using perimeter** places the label on the polygon outline'
  id: totrans-67
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用周长**将标签放置在多边形轮廓上。'
- en: 'The following screenshot shows lake labels (`lakes.shp`) using the **Multiple
    lines** feature wrapping on the empty space character and positioned using the
    **Free** option:'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下截图显示了使用**多行**功能在空格字符上环绕的湖泊标签（`lakes.shp`），并使用**自由**选项定位：
- en: '![Labeling](img/7488_05_11.jpg)'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![标签化](img/7488_05_11.jpg)'
- en: Tip
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: By default, QGIS avoids overlapping labels, but for debug purposes, it can be
    useful to force **Show all labels (including colliding labels)** using the options
    in the Rendering section.
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 默认情况下，QGIS会避免标签重叠，但出于调试目的，使用渲染部分中的选项强制**显示所有标签（包括碰撞的标签）**可能很有用。
- en: Besides automatic label placement, we also have the option to use data-defined
    placement to position labels exactly where we want them to be. In the labeling
    toolbar, we find tools to move and rotate labels by hand. They are only active
    and available for layers that have data-defined placement for at least X and Y
    coordinates set up. To start using the tools, we can simply add three new columns,
    `label_x`, `label_y`, and `label_rot` to, for example, the `airports.shp` file.
    Then, we can specify these columns in data-defined settings by pressing the buttons
    beside **Offset X, Y** and **Rotation**. We don't have to enter any values in
    the attribute table right now. The labeling engine will check for values, and
    if it finds the attribute fields empty, it will simply place the labels automatically.
    By specifying data-defined placement, the labeling toolbar's tools are now available
    (note that the editing mode has to be turned on), and we can use the tools to
    move and rotate any of the labels on the map. The changes are written back to
    the attribute table. Try moving some labels, especially where they are placed
    closely together, and watch how the automatically placed labels adapt to your
    changes.
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 除了自动标签定位外，我们还可以选择使用数据定义定位来精确放置标签。在标签工具栏中，我们可以找到手动移动和旋转标签的工具。它们仅在至少设置了X和Y坐标的数据定义定位的图层上激活和可用。要开始使用这些工具，我们可以在例如`airports.shp`文件中简单地添加三个新列，`label_x`、`label_y`和`label_rot`。然后，我们可以通过按下**偏移X,
    Y**和**旋转**旁边的按钮来在数据定义设置中指定这些列。现在我们不需要在属性表中输入任何值。标签引擎将检查值，如果它发现属性字段为空，它将简单地自动放置标签。通过指定数据定义定位，标签工具栏的工具现在可用（注意编辑模式必须开启），我们可以使用这些工具来移动和旋转地图上的任何标签。更改将写回属性表。尝试移动一些标签，特别是它们放置得很近的地方，并观察自动放置的标签如何适应你的更改。
- en: '**Rendering**: This allows us to define **scale-based visibility** limits to
    display labels only at certain scales and **pixel size-based visibility** to hide
    labels for small features. Here, we can also tell the labeling engine to **show
    colliding labels,** which are normally hidden by default.'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**渲染**：这允许我们定义基于**比例的可见性**限制，以在特定比例下显示标签，以及基于**像素大小**的可见性来隐藏小特征上的标签。在这里，我们还可以告诉标签引擎**显示冲突标签**，这些标签默认情况下通常会被隐藏。'
- en: Designing print maps
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计打印地图
- en: In QGIS, print maps are designed in the print composer. A QGIS project can contain
    multiple composers, so it makes sense to pick descriptive names. Compositions
    are saved automatically whenever we save the project. To see a list of all the
    compositions available in a project, go to **Project** | **Composer Manager**.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在QGIS中，打印地图是在打印布局中设计的。一个QGIS项目可以包含多个布局，因此选择描述性的名称是有意义的。布局在保存项目时自动保存。要查看项目中所有可用布局的列表，请转到**项目**
    | **布局管理器**。
- en: 'We can open a new composer by going to **Project** | **New Print Composer**
    or by using *Ctrl* + *P*. The composer window consists of the following:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过转到**项目** | **新建打印布局**或使用*Ctrl* + *P*来打开一个新的布局。布局窗口包括以下内容：
- en: A preview area for the map composition displaying a blank page on start
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个用于显示空白页的地图布局预览区域
- en: Panels for configuring the **Composition**, **Item properties**, and **Atlas
    generation**, as well as a **Command history** panel for quick undo and redo
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置**布局**、**项属性**、**图集生成**的面板，以及一个用于快速撤销和重做的**命令历史**面板
- en: Toolbars for managing, saving and exporting compositions, navigating in the
    preview area, as well as adding and arranging different composer items
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于管理、保存和导出布局的工具栏，在预览区域中导航，以及添加和排列不同的布局项
- en: The **Composition** panel gives us access to the paper options such as size,
    orientation, and number of pages. It is also the place to configure snapping behavior
    and output resolution.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '**布局**面板让我们可以访问纸张选项，如大小、方向和页数。这也是配置吸附行为和输出分辨率的地点。'
- en: First, we add a map item to the paper using the **Add new map** button, or by
    going to **Layout** | **Add Map** and drawing the map rectangle onto the paper.
    Click on the paper, keep the mouse button pressed down, and drag the rectangle
    open. We can move, resize, and zoom the map using the mouse and the **Select/Move
    item** tools. Alternatively, it is also possible to configure all map settings
    in the **Item Properties** panel.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们通过点击**添加新地图**按钮，或者通过转到**布局** | **添加地图**并在纸上绘制地图矩形来将地图项添加到文档中。点击纸张，按住鼠标按钮，并拖动矩形打开。我们可以使用鼠标和**选择/移动项**工具来移动、调整大小和缩放地图。或者，也可以在**项属性**面板中配置所有地图设置。
- en: The **Item Properties** panel content depends on the currently selected composition
    item. If a map item is selected, we can adjust the map's **Scale** and **Extents**
    as well as the **Position and size** tool of the map item itself. At a **Scale**
    of 10,000,000, we can more or less fit Alaska on an A4 paper. To move the area
    that is displayed within the map item, we can use the **Move item content** tool.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**项目属性**面板的内容取决于当前选定的组合项。如果选择了地图项，我们可以调整地图的**比例**和**范围**，以及地图项本身的**位置和大小**工具。在**比例**为10,000,000时，我们可以在A4纸上大致放置阿拉斯加。要移动地图项内显示的区域，我们可以使用**移动项目内容**工具。'
- en: After the map looks like we want it to, we can add a scale bar using the **Add
    new scalebar** button or by going to **Layout** | **Add Scalebar** and clicking
    on the map. The **Item Properties** panel now displays the scalebar's properties
    similar to what you can see in the following screenshot. Since we can add multiple
    map items to one composition, it is important to specify which map the scale belongs
    to. The second main property is the scalebar style, which allows us to choose
    between different scalebar types or a **Numeric** type for a simple textual representation
    such as 1:10,000,000\. Using the **Units** properties, we can convert the map
    units in feet or meters to something more manageable, such as miles or kilometers.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在地图看起来符合我们的要求后，我们可以使用**添加新刻度尺**按钮或通过转到**布局** | **添加刻度尺**并点击地图来添加刻度尺。现在，**项目属性**面板显示刻度尺的属性，类似于以下截图所示。由于我们可以将多个地图项添加到一个组合中，因此指定哪个地图属于刻度尺很重要。第二个主要属性是刻度尺样式，它允许我们选择不同的刻度尺类型或用于简单文本表示（如1:10,000,000）的**数值**类型。使用**单位**属性，我们可以将地图单位从英尺或米转换为更易于管理的单位，如英里或千米。
- en: The **Segments** properties control the number of segments and the size of a
    single segment in the scalebar. Further, the properties control the scalebar's
    color, font, background, and so on.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '**段**属性控制刻度尺中段落数量和单个段落的尺寸。此外，这些属性还控制刻度尺的颜色、字体、背景等。'
- en: North arrows can be added to a composition using the **Add Image** button or
    by going to **Layout** | **Add image** and clicking on the paper. It might take
    a while for the **Item Properties** panel to update while QGIS loads the previews
    of the images in the SVG folder. Pick a north arrow from the list of images shipped
    with QGIS or select your own SVG. Further map decorations such as arrows or rectangle,
    triangle, and ellipse shapes can be added using the appropriate toolbar buttons
    **Add Arrow**, **Add Rectangle**, and so on.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用**添加图像**按钮或通过转到**布局** | **添加图像**并点击纸张来向组合中添加北箭头。在QGIS加载SVG文件夹中图像的预览时，**项目属性**面板可能需要一段时间才能更新。从QGIS附带图像列表中选择北箭头或选择自己的SVG。还可以使用适当的工具栏按钮（如**添加箭头**、**添加矩形**等）添加进一步的地图装饰，如箭头或矩形、三角形和椭圆形形状。
- en: '![Designing print maps](img/7488_05_12.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![设计打印地图](img/7488_05_12.jpg)'
- en: Maps that show an area close up are often accompanied by a second map that tells
    the reader where the area is located in a larger context. To create such an overview
    map, we add a second map item and activate its **Overview** option. By setting
    the **Overview frame**, we can define which detail map's extent should be highlighted.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 显示近距离区域的地图通常伴随着第二张地图，告诉读者该区域在更大背景中的位置。要创建这样的概览图，我们添加第二个地图项并激活其**概览**选项。通过设置**概览框架**，我们可以定义应该突出显示哪个详细地图的范围。
- en: Tip
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Every map item in a composition can display a different combination of layers.
    Generally, map items in composer are synced with the map in the main QGIS window.
    So, if we turn a layer off in the main window, it also gets removed from the print
    composer map. But, we can stop this automatic synchronization by enabling **Lock
    layers** for a map item in the map item's properties.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 组合中的每个地图项都可以显示不同的图层组合。通常，作曲器中的地图项与主QGIS窗口中的地图同步。因此，如果我们关闭主窗口中的图层，它也会从打印作曲器地图中删除。但是，我们可以通过在地图项属性中启用**锁定图层**来停止这种自动同步。
- en: 'Other common map features are grids and coordinate frames. Grids can be enabled
    for any map item. We can choose between a normal **Solid** grid or **Crosses**
    only. **Interval** and **Offset** values have to be specified in map units. Additionally,
    we can activate a value of **Zebra** for the **Frame style** and **Draw coordinates**
    inside or outside the frame, as shown in the following screenshot:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 其他常见的地图功能包括网格和坐标框架。可以为任何地图项目启用网格。我们可以在**实心**网格或**十字**之间进行选择。**间隔**和**偏移**值必须以地图单位指定。此外，我们可以激活**条纹**样式和**绘制坐标**在框架内部或外部，如下面的截图所示：
- en: '![Designing print maps](img/7488_05_13.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![设计打印地图](img/7488_05_13.jpg)'
- en: Legends are another vital map element. We can use the **Add new legend** button
    or go to **Layout** | **Add legend** to add a default legend with entries for
    all currently visible map layers. Legend entries can be reorganized, edited, and
    removed in the Legend items' properties. Using the **Wrap text on** option, we
    can split long labels on multiple rows as shown in the following screenshot. Additionally,
    the legend in this example is divided into four columns. By default, QGIS tries
    to keep all entries of one layer in a single column, but we can override this
    behavior be enabling **Split layers**.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 线条图是地图的另一个重要元素。我们可以使用**添加新线条图**按钮或转到**布局** | **添加线条图**来添加一个包含所有当前可见地图层条目的默认线条图。线条图条目可以在线条图项目属性中进行重新组织、编辑和删除。使用**在**选项，我们可以将长标签拆分为多行，如下面的截图所示。此外，本例中的线条图分为四列。默认情况下，QGIS尝试将一个层的所有条目保持在单列中，但我们可以通过启用**拆分图层**来覆盖此行为。
- en: 'To add text to the map, we can use the **Add new label** button or go to **Layout**
    | **Add label**. Simple labels display all text using the same font. By enabling
    **Render** as HTML, we can create more elaborate labels with headers, lists, different
    colors, and highlights in bold or italics using the normal HTML notation, for
    example:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要向地图添加文本，我们可以使用**添加新标签**按钮或转到**布局** | **添加标签**。简单标签使用相同的字体显示所有文本。通过启用**渲染为HTML**，我们可以创建更复杂的标签，包括标题、列表、不同颜色以及使用正常HTML标记的加粗或斜体突出显示，例如：
- en: '[PRE0]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Labels can also contain expressions such as:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 标签还可以包含如下表达式：
- en: '`[% $now %]` to insert the current timestamp'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[% $now %]` 在组合中插入当前时间戳'
- en: '`[% $page %] of [% $numpages %]` to insert page numbers in compositions with
    multiple pages'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[% $page %] of [% $numpages %]` 在多页组合中插入页码'
- en: Even more advanced text areas can be added using the **Add html frame** button.
    We can point the item's URL reference to any HTML page on our local machines or
    online, and the content will be displayed on the composer page.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**添加HTML框架**按钮可以添加更高级的文本区域。我们可以将项目的URL引用指向我们本地机器或在线上的任何HTML页面，内容将在作曲页面上显示。
- en: '![Designing print maps](img/7488_05_14.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![设计打印地图](img/7488_05_14.jpg)'
- en: To add additional details to the map, the composer also offers the possibility
    to add an attribute table to the composition using the **Add attribute table**
    button or by going to **Layout** | **Add attribute table**. By enabling **Show
    only visible features**, we can filter the table and display only relevant results.
    Sorting and renaming of columns is possible via the **Attributes…** button.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 要向地图添加更多详细信息，作曲器还提供了使用**添加属性表**按钮或通过转到**布局** | **添加属性表**来添加属性表的可能性。通过启用**仅显示可见要素**，我们可以过滤表格并仅显示相关结果。通过**属性…**按钮可以进行列排序和重命名。
- en: Finally, the **Atlas generation** panel enables us to create a series of maps
    using one print composition. The tool will create one map for every feature in
    the **Coverage layer** dropdown we define in the atlas configuration. Features
    in the Coverage layer can be displayed like regular features or hidden by enabling
    **Hidden coverage layer**. **Feature sorting** and **Feature filtering** make
    it possible to further fine-tune the results.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，**图集生成**面板使我们能够使用一个打印组合创建一系列地图。该工具将为图集配置中定义的**覆盖层**下拉列表中的每个要素创建一个地图。覆盖层中的要素可以像常规要素一样显示或通过启用**隐藏覆盖层**来隐藏。**要素排序**和**要素过滤**使我们可以进一步微调结果。
- en: Using the **Fixed scale** option, all maps will be rendered using the same scale.
    If we need more flexible output, we can switch to the **Margin around feature**
    option instead, which zooms to every Coverage layer feature and renders it in
    addition to the specified margin surrounding area. The **Output** field can be
    one image or PDF for each Coverage layer feature or a multipage PDF by enabling
    **Single file export** when possible before going to **Composer** | **Export as
    PDF**.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**固定比例**选项，所有地图都将使用相同的比例渲染。如果我们需要更灵活的输出，我们可以切换到**边缘周围功能**选项，该选项将缩放到每个覆盖层特征，并在指定的边缘周围区域渲染其外。**输出**字段可以是每个覆盖层特征的图像或PDF，或者通过在进入**作曲家**
    | **导出为PDF**之前启用**单文件导出**，可以生成多页PDF。
- en: '![Designing print maps](img/7488_05_15.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![设计打印地图](img/7488_05_15.jpg)'
- en: Summary
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we had a closer look into how we can create some more complex
    maps using advanced vector layer styles such as the categorized or rule-based
    style. We also covered the automatic and manual feature labeling options available
    in QGIS. This chapter also showed how to create printable maps using print composer,
    and introduced the Atlas functionality for creating map books. Congratulations!
    Over the previous chapters, you have learned how to install and use QGIS to create,
    edit, and analyze spatial data and how to present it in an effective manner.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们更深入地探讨了如何使用高级矢量图层样式，如分类样式或基于规则的样式来创建一些更复杂的地图。我们还介绍了QGIS中可用的自动和手动特征标签选项。本章还展示了如何使用打印作曲家创建可打印的地图，并介绍了用于创建地图集的Atlas功能。恭喜！在之前的章节中，你已经学习了如何安装和使用QGIS来创建、编辑、分析空间数据，以及如何有效地展示它。
