<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Spatial Analysis"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Spatial Analysis</h1></div></div></div><p>In this chapter, we will start with raster processing and analysis tasks such as clipping and terrain analysis. We will cover the essentials of converting between raster and vector formats, and then continue with common vector geoprocessing tasks such as generating heatmaps and calculating area shares within a region. We will finish the chapter with an introduction to automating geoprocessing workflows using the QGIS Processing modeler.</p><div class="section" title="Clipping rasters"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Clipping rasters</h1></div></div></div><p>A common<a id="id249" class="indexterm"/> task in raster processing is clipping a raster with a polygon. This task is well covered by the Clipper tool located in <span class="strong"><strong>Raster</strong></span> | <span class="strong"><strong>Extraction</strong></span> | <span class="strong"><strong>Clipper</strong></span>. This tool supports clipping to a specified extent or clipping using a polygon mask layer, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The extent can be set manually or by selecting it in the map. To do that, we just drag open a rectangle in the map area of the main QGIS window.</li><li class="listitem" style="list-style-type: disc">A mask layer can be any polygon layer that is currently loaded in the project or any other polygon layer, which can be specified using <span class="strong"><strong>Select…</strong></span>.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>If we only want to clip a raster to a certain extent (the current map view extent or any other), we can also use the raster <span class="strong"><strong>Save as ...</strong></span>, as shown in <a class="link" href="ch03.html" title="Chapter 3. Data Creation and Editing">Chapter 3</a>, <span class="emphasis"><em>Data Creation and Editing</em></span>.</p></div></div></li></ul></div><p>For a quick exercise, we will clip the hillshade raster using the Alaska Shapefile (both from our sample data) as a mask layer. At the bottom of the window, we can see the concrete <span class="strong"><strong>gdalwarp</strong></span> command<a id="id250" class="indexterm"/> that QGIS uses to clip the raster. This is very useful if you also want to learn how to use GDAL.</p><p>The default <span class="strong"><strong>No data value</strong></span> is <span class="strong"><strong>0</strong></span>, but we can override it if necessary. Another good option is to <span class="strong"><strong>Create an output alpha band</strong></span>, which will set all areas outside the mask to transparent, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_01.jpg" alt="Clipping rasters"/></div><p>The resulting layer will be loaded automatically since we enabled the <span class="strong"><strong>Load into canvas when finished</strong></span> option<a id="id251" class="indexterm"/>. QGIS should also automatically recognize the alpha layer we created, <a id="id252" class="indexterm"/>and the raster areas that fall outside the Alaska land mass should be transparent. If, for some reason, QGIS fails to automatically recognize the alpha layer, we can enable it manually using the <a id="id253" class="indexterm"/>
<span class="strong"><strong>Transparency band</strong></span> option in the raster layer properties' <span class="strong"><strong>Transparency</strong></span> section. This dialog is also the right place to specify any <span class="strong"><strong>No data value</strong></span> we want to be used, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_02.jpg" alt="Clipping rasters"/></div></div></div>
<div class="section" title="Analyzing elevation / terrain data"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Analyzing elevation / terrain data</h1></div></div></div><p>Raster terrain analysis can be used to calculate the slope, aspect, hillshade, ruggedness index, <a id="id254" class="indexterm"/>and relief from elevation rasters, as shown in the following<a id="id255" class="indexterm"/> screenshot. These tools are available through the <span class="strong"><strong>Raster</strong></span> | <span class="strong"><strong>Terrain analysis</strong></span> plugin, which comes with QGIS by default, but we have to enable it in the Plugin Manager.</p><div class="mediaobject"><img src="graphics/7488_04_03.jpg" alt="Analyzing elevation / terrain data"/></div><p>The Terrain analysis includes the following tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Slope</strong></span>: This<a id="id256" class="indexterm"/> tool calculates the slope angle for each<a id="id257" class="indexterm"/> cell in degrees (based on the first order derivative estimation)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Aspect</strong></span>: This <a id="id258" class="indexterm"/>tool calculates the exposition<a id="id259" class="indexterm"/> (in degrees counter-clockwise, starting with 0 for north)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Hillshade</strong></span>: This <a id="id260" class="indexterm"/>tool creates a basic hillshade<a id="id261" class="indexterm"/> raster with lighted areas and shadows</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Relief</strong></span>: This<a id="id262" class="indexterm"/> tool creates a shaded relief map<a id="id263" class="indexterm"/> with varying colors for different elevation ranges</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ruggedness Index</strong></span>: This<a id="id264" class="indexterm"/> tool calculates <a id="id265" class="indexterm"/>the ruggedness index for each cell by summarizing the elevation changes within a 3 x 3 cell grid</li></ul></div><p>Of course, <a id="id266" class="indexterm"/>to use any of these terrain analysis tools, we need an<a id="id267" class="indexterm"/> elevation raster. If you don't have any at hand, you can <a id="id268" class="indexterm"/>simply download a dataset from the NASA <span class="strong"><strong>Shuttle Radar Topography Mission</strong></span> (<span class="strong"><strong>SRTM</strong></span>)<span class="strong"><strong> </strong></span> using<a id="id269" class="indexterm"/> <a class="ulink" href="http://dwtkns.com/srtm/">http://dwtkns.com/srtm/</a> or any of the other SRTM download services.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>If you want to replicate the results in the following exercise exactly, please get the dataset called <code class="literal">srtm_05_01.zip</code>, which covers a small part of Alaska.</p></div></div><p>An important element in all terrain analysis tools is the <span class="strong"><strong>Z factor</strong></span>. The z factor is used if the x/y units are different from the z (elevation) unit. For example, if we tried to create a relief from elevation data where x/y are in degrees and z is in meters, the resulting relief would look grossly exaggerated. The values for the z factor are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If x/y and z are either all in meters or all in feet, use the default z factor 1.0</li><li class="listitem" style="list-style-type: disc">If x/y are in degrees and z is in feet, use the z factor 370,400</li><li class="listitem" style="list-style-type: disc">If x/y are in degrees and z is in meters, use the z factor 111,120</li></ul></div><p>Since the SRTM rasters are provided in WGS84 EPSG:4326, we need to use a <span class="strong"><strong>Z factor</strong></span> of <code class="literal">111120</code> in our exercise. Let's create a relief! The tool can calculate relief color ranges automatically; we just need to click on <span class="strong"><strong>Create automatically</strong></span>, as shown in the following screenshot. Of course, we can still edit the elevation ranges' upper and lower bounds, as well as the colors.</p><div class="mediaobject"><img src="graphics/7488_04_04.jpg" alt="Analyzing elevation / terrain data"/></div><p>While relief maps are three-banded rasters, which are primarily used for visualization purposes, slope rasters are a common intermediate step in spatial analysis workflows. We will now create<a id="id270" class="indexterm"/> a slope raster, which we can use in our example<a id="id271" class="indexterm"/> workflow through the following sections. The resulting slope raster will be loaded in grayscale automatically, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_05.jpg" alt="Analyzing elevation / terrain data"/></div></div>
<div class="section" title="Raster calculator"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Raster calculator</h1></div></div></div><p>By going<a id="id272" class="indexterm"/> to <span class="strong"><strong>Raster</strong></span> | <span class="strong"><strong>Raster Calculator</strong></span>, we can create a new raster layer based on values in one or more rasters that are loaded in the current QGIS project. All available raster bands are presented in a list in the top-left corner of the dialog in the form <code class="literal">raster_name@band_number</code> as shown in the following screenshot.</p><p>Continuing from our previous exercise in which we created a slope raster, we can, for example, find areas at elevations above 1,000 meters and with a slope of less than 5 degrees using the following expression (you might have to adjust the values depending on the dataset you are using):</p><div class="informalexample"><pre class="programlisting">srtm_05_01@1 &gt; 1000 AND slope_05_01@1 &lt; 5</pre></div><p>Cells that meet both criteria of high elevation and evenness will be assigned a value of 1 in the resulting raster, while cells that fail to meet a criterion will be set to 0. The only bigger areas with a value of 1 are found in the southern part of the raster layer.</p><div class="mediaobject"><img src="graphics/7488_04_06.jpg" alt="Raster calculator"/></div><p>Another typical use case is reclassifying a raster. For example, we could want to reclassify the landcover raster in our sample data so that all areas with a landcover class from 1 to 5 get the value 100, areas from 6 to 10 get 101, and areas over 11 get a new value of 102. We will use the following code for this:</p><div class="informalexample"><pre class="programlisting">( landcover@1 &gt; 0 AND landcover@1 &lt;= 6 ) * 100
+ ( landcover@1 &gt;= 7 AND landcover@1 &lt;= 10 ) * 101
+ ( landcover@1 &gt;= 11 ) * 102</pre></div><p>The preceding<a id="id273" class="indexterm"/> raster calculator expression has three parts, consisting of a check and a multiplication. For each cell, only one of the three checks can be true, and true is represented as 1. Therefore, if a landcover cell has a value of 4, the first check will be true and the expression evaluates to <code class="literal">1*100 + 0*101 + 0*102 = 100</code>.</p></div>
<div class="section" title="Converting between rasters and vectors"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Converting between rasters and vectors</h1></div></div></div><p>Tools for converting between raster and vector formats are available in <span class="strong"><strong>Raster</strong></span> | <span class="strong"><strong>Conversion</strong></span>
<a id="id274" class="indexterm"/> and are called Rasterize and Polygonize. Like<a id="id275" class="indexterm"/> the raster clipper tool we used before, this tool is also based on GDAL and displays the command at the bottom of the dialog.</p><p>Polygonize converts a raster into a polygon layer; depending on the size of the raster, the conversion can take some time. When the process is finished, QGIS will notify us with a pop up. For a quick test, we can, for example, convert the reclassified landcover raster to polygons. The resulting vector polygon layer contains multiple polygon features with a single attribute we called <code class="literal">lc</code>, which depends on the original raster value, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_07.jpg" alt="Converting between rasters and vectors"/></div><p>The Rasterize tool is very similar to the Polygonize tool. The only difference is that we get to <a id="id276" class="indexterm"/>specify the size of the resulting raster<a id="id277" class="indexterm"/> in pixels/cells. We can also specify the attribute field, which will provide input for the raster cell value. The <span class="strong"><strong>cat</strong></span> attribute<a id="id278" class="indexterm"/> of our <code class="literal">alaska.shp</code>
<a id="id279" class="indexterm"/> dataset is rather meaningless, but you get the idea of how the tool works, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_08.jpg" alt="Converting between rasters and vectors"/></div></div>
<div class="section" title="Accessing raster and vector layer statistics"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Accessing raster and vector layer statistics</h1></div></div></div><p>Whenever we get a new dataset, it is useful to examine the layer statistics to get a feeling for<a id="id280" class="indexterm"/> the data. Raster layer statistics are readily<a id="id281" class="indexterm"/> available in the <span class="strong"><strong>Layer Properties</strong></span> dialog, specifically <a id="id282" class="indexterm"/>in the following tabs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Metadata</strong></span> shows <a id="id283" class="indexterm"/>the minimum and maximum<a id="id284" class="indexterm"/> cell value as well as the mean and the standard deviation</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Histogram</strong></span><a id="id285" class="indexterm"/> presents the distribution<a id="id286" class="indexterm"/> of raster values</li><li class="listitem" style="list-style-type: disc">For vector layers, we can get summary statistics using two tools in <span class="strong"><strong>Vector</strong></span> | <span class="strong"><strong>Analysis Tools</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Basics statistics</strong></span> is very useful for numeric fields. It calculates parameters<a id="id287" class="indexterm"/> such as <a id="id288" class="indexterm"/>mean and median, min and max, the feature count <span class="emphasis"><em>n</em></span> and the number of unique values, and so on for all the features of a layer or for the selected features only.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>List unique values</strong></span><a id="id289" class="indexterm"/> is<a id="id290" class="indexterm"/> useful to get all the unique values of a certain field.</li></ul></div></li></ul></div><p>In both the tools, we can easily copy the results using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span> and paste them into a text file or spreadsheet. The following screenshots show examples exploring the contents of our airport sample dataset:</p><div class="mediaobject"><img src="graphics/7488_04_09.jpg" alt="Accessing raster and vector layer statistics"/></div></div>
<div class="section" title="Creating a heatmap from points"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Creating a heatmap from points</h1></div></div></div><p>Heatmaps<a id="id291" class="indexterm"/> are great for visualizing the distribution of points. To create them, QGIS provides a<a id="id292" class="indexterm"/> simple to use <span class="strong"><strong>Heatmap Plugin</strong></span>
<a id="id293" class="indexterm"/>, which we have to activate in <span class="strong"><strong>Plugin Manager</strong></span>
<a id="id294" class="indexterm"/>, and then we can access it by going to <span class="strong"><strong>Raster</strong></span> | <span class="strong"><strong>Heatmap</strong></span> | <span class="strong"><strong>Heatmap</strong></span>. The <a id="id295" class="indexterm"/>plugin offers different kernel shapes to choose from and allows us to control the raster size in cells as well as the cell size. The <span class="strong"><strong>Heatmap Plugin</strong></span> looks like the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_10.jpg" alt="Creating a heatmap from points"/></div></div>
<div class="section" title="Vector geoprocessing with Processing"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Vector geoprocessing with Processing</h1></div></div></div><p>The most comprehensive set of spatial analysis tools is accessible via the Processing plugin, which we <a id="id296" class="indexterm"/>can also enable in <span class="strong"><strong>Plugin Manager</strong></span>. When <a id="id297" class="indexterm"/>the plugin is enabled, we find an <span class="strong"><strong>Analysis</strong></span> menu where we can activate the toolbox, as shown in the following <a id="id298" class="indexterm"/>screenshot. In the toolbox, it is easy to find spatial analysis tools by their name thanks to the dynamic search box at the top. This makes finding tools in the toolbox easier than in the vector or raster menu. Another advantage of getting accustomed to the Processing tools is that they can be automated in Python and in geoprocessing models.</p><div class="mediaobject"><img src="graphics/7488_04_11.jpg" alt="Vector geoprocessing with Processing"/></div><p>Note that the preceding screenshot shows the advanced interface of the toolbox. You can <a id="id299" class="indexterm"/>switch from the simplified interface <a id="id300" class="indexterm"/>to the advanced interface using the drop-down button at the bottom of the toolbox. I prefer using the advanced version as it exposes all available algorithms and clearly displays how individual tools are related to the different components such as GDAL/OGR or GRASS.</p><p>In the following sections, we will cover a selection of the available geoprocessing tools and see how we can use the modeler to automate our tasks.</p><div class="section" title="Identifying features in the proximity of others"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec12"/>Identifying features in the proximity of others</h2></div></div></div><p>One common spatial analysis task is to identify features in the proximity of certain other features<a id="id301" class="indexterm"/>. One example would be to find all the airports near rivers. Using <code class="literal">airports.shp</code> and <code class="literal">majrivers.shp</code> from our sample data, we can find airports within 5,000 feet of a river using a combination of the <span class="strong"><strong>Fixed distance buffer</strong></span>
<a id="id302" class="indexterm"/> and <span class="strong"><strong>Select by location</strong></span> tools, as shown in the <a id="id303" class="indexterm"/>following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_12.jpg" alt="Identifying features in the proximity of others"/></div><p>After buffering the airport point locations, the <span class="strong"><strong>Select by location</strong></span> option selects all the airport buffers <a id="id304" class="indexterm"/>that intersect a river. As a result, 14 out of the 76 airports are selected. This information is displayed in the information area at the bottom of the QGIS main window as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_13.jpg" alt="Identifying features in the proximity of others"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>If you ever forget which settings you used or need to check that you used the correct input layer, you can go to <span class="strong"><strong>Analysis</strong></span> | <span class="strong"><strong>history and log</strong></span>. The <span class="strong"><strong>ALGORITHM</strong></span> section lists all the algorithms we have been running as well as the used settings. This is also the right place to look for error messages in the <span class="strong"><strong>WARNING</strong></span> section, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_14.jpg" alt="Identifying features in the proximity of others"/></div></div></div><p>The commands listed under <span class="strong"><strong>ALGORITHM</strong></span> can also be used to call Processing tools from the QGIS <a id="id305" class="indexterm"/>Python console by going to <span class="strong"><strong>Plugins</strong></span> <span class="strong"><strong>|</strong></span> <span class="strong"><strong>Python Console</strong></span>. The Python commands shown in the following screenshot run the buffer algorithm and load the result into the map:</p><div class="mediaobject"><img src="graphics/7488_04_15.jpg" alt="Identifying features in the proximity of others"/></div></div><div class="section" title="Raster sampling at point locations"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec13"/>Raster sampling at point locations</h2></div></div></div><p>Another common task is to sample a raster at specific point locations. Using Processing, we can solve<a id="id306" class="indexterm"/> this problem using a GRASS tool called v.sample<a id="id307" class="indexterm"/>. To use GRASS tools<a id="id308" class="indexterm"/>, make sure GRASS is installed and Processing is configured correctly in <span class="strong"><strong>Analysis</strong></span> | <span class="strong"><strong>options and configuration</strong></span>. On an OSGeo4W default system, the configuration will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_16.jpg" alt="Raster sampling at point locations"/></div><p>For this exercise, let's imagine we want to sample the landcover layer at the airport locations of our sample data. All we have to do is specify the vector layer containing the sample<a id="id309" class="indexterm"/> points and the raster layer that should be sampled. For this example, we can leave all other settings to their defaults. The tool will not only sample the raster, it also compares point attributes with the sampled raster value, but we don't need this comparison in our current example.</p><p>The dialog will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_17.jpg" alt="Raster sampling at point locations"/></div></div><div class="section" title="Mapping density with hexagonal grids"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec14"/>Mapping density with hexagonal grids</h2></div></div></div><p>Mapping the density of points using a hexagonal grid has become a quite popular alternative<a id="id310" class="indexterm"/> to creating heatmaps. Processing offers us a<a id="id311" class="indexterm"/> fast way to create such an analysis. There is already a pre-made script called <span class="strong"><strong>Hex grid from layer bounds</strong></span>, which we can use to first create a hexagonal grid that covers all points in the input layer. The dataset of populated places, <code class="literal">popp.shp</code>, is a good sample dataset for this exercise. Once the grid is ready, we can run <span class="strong"><strong>Count points in polygon</strong></span> to calculate the statistics. In case you cannot see the resulting layer, go to the <span class="strong"><strong>Layer Properties</strong></span> | <span class="strong"><strong>General</strong></span> tab and make sure the <span class="strong"><strong>CRS</strong></span> field is set to <span class="strong"><strong>NAD 27 / Alaska Albers</strong></span>. The tools dialog will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_18.jpg" alt="Mapping density with hexagonal grids"/></div></div><div class="section" title="Calculating area shares within a region"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec15"/>Calculating area shares within a region</h2></div></div></div><p>Another <a id="id312" class="indexterm"/>spatial analysis task we often encounter is calculating area shares within a certain region, for example, landcover shares along one<a id="id313" class="indexterm"/> specific river. Using <code class="literal">majrivers.shp</code> and <code class="literal">trees.shp</code>, we can calculate the share of wooded area in a 5,000 feet strip of land along the <code class="literal">Susitna River</code> value parameter. We first define the analysis region by selecting the river and buffering it. Note that the <span class="strong"><strong>Dissolve result</strong></span> option should be set to <span class="strong"><strong>Yes</strong></span>
<a id="id314" class="indexterm"/> to ensure that the buffer result is one continuous polygon, as shown in the following screenshot.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>QGIS Processing will only apply buffers to the selected features of the input layer. This default behavior can be changed in <span class="strong"><strong>Analysis</strong></span> | <span class="strong"><strong>options and configuration</strong></span> by disabling the <span class="strong"><strong>Use only selected features</strong></span> option.</p></div></div><div class="mediaobject"><img src="graphics/7488_04_19.jpg" alt="Calculating area shares within a region"/></div><p>Next, <a id="id315" class="indexterm"/>we calculate the size of the strip of land around <a id="id316" class="indexterm"/>our river. This can be done using the <span class="strong"><strong>Export/Add geometry columns</strong></span> tool, which adds the area and parameter to the attribute table. Then we can calculate the <span class="strong"><strong>Intersection</strong></span> field<a id="id317" class="indexterm"/> between the area along the river and the wooded areas in <code class="literal">trees.shp</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_20.jpg" alt="Calculating area shares within a region"/></div><p>Using the <span class="strong"><strong>Dissolve</strong></span> tool<a id="id318" class="indexterm"/>, we can recombine all areas from the intersection results into one big polygon representing the total wooded area around the river. Finally, we can calculate the final share of wooded area using <span class="strong"><strong>Advanced Python field calculator</strong></span>. The formula <code class="literal">value = $geom.area()/&lt;area&gt;</code> divides the area of the final polygon (<code class="literal">$geom.area()</code>) by the value in the "area" attribute (<code class="literal">&lt;area&gt;</code>), which we created in a previous step by running <span class="strong"><strong>Export/Add geometry columns</strong></span>. The tools will appear as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_21.jpg" alt="Calculating area shares within a region"/></div><p>This<a id="id319" class="indexterm"/> calculation results in a wood share of 0.31601<a id="id320" class="indexterm"/> for <span class="strong"><strong>Deciduous</strong></span> and 0.09666 for <span class="strong"><strong>Mixed</strong></span> trees. Therefore, we can conclude that in total, 41.27 percent of the land along <code class="literal">Susitna River</code> is wooded.</p></div></div>
<div class="section" title="Automated geoprocessing with the graphical modeler"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Automated geoprocessing with the graphical modeler</h1></div></div></div><p>Using the graphical modeler, we can turn whole geoprocessing and analysis workflows into automated <a id="id321" class="indexterm"/>models. To create a model, we go to <a id="id322" class="indexterm"/>
<span class="strong"><strong>Analysis</strong></span> | <span class="strong"><strong>Graphical modeler</strong></span> to open the modeler where we can select from different <span class="strong"><strong>Inputs</strong></span> and <span class="strong"><strong>Algorithms</strong></span> for our model.</p><p>Let's create a model that automates the creation of hexagonal heatmaps! By double-clicking on the <span class="strong"><strong>Vector layer</strong></span> entry in the <span class="strong"><strong>Inputs</strong></span> list, we can add an input field for the point layer. It's a good idea to use descriptive parameter names so we can recognize which input is first and which is later in the model. It is also useful to restrict the <span class="strong"><strong>Shape type</strong></span> field<a id="id323" class="indexterm"/> where appropriate. In our example, we restrict the input to <span class="strong"><strong>Point</strong></span>. This will enable Processing to prefilter the available layers and present us only with layers of the correct type. The second input we need is a <span class="strong"><strong>Number</strong></span> field to specify<a id="id324" class="indexterm"/> the desired hexagonal cell size. The tool will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_22.jpg" alt="Automated geoprocessing with the graphical modeler"/></div><p>After adding<a id="id325" class="indexterm"/> the inputs, we can now continue creating the model by assembling the algorithms. In the <span class="strong"><strong>Algorithms</strong></span> section, we can use<a id="id326" class="indexterm"/> the filter at the top to narrow down our search for the correct algorithm. To add an algorithm to the model, we simply double-click on the entry in the list of algorithms. This opens the algorithm dialog where we have to specify the inputs and further algorithm-specific parameters.</p><p>In our example, we want to use the point vector layer as the <span class="strong"><strong>input</strong></span> layer, and the number input <span class="strong"><strong>hex cell size</strong></span> as the <span class="strong"><strong>cellsize</strong></span> parameter<a id="id327" class="indexterm"/>. We can access the available inputs through the drop-down list. Alternatively, it's also possible to hardcode parameters such as the cell size.</p><div class="mediaobject"><img src="graphics/7488_04_23.jpg" alt="Automated geoprocessing with the graphical modeler"/></div><p>While adding the following algorithms, it is important to always choose the correct <span class="strong"><strong>input</strong></span> layer <a id="id328" class="indexterm"/>based on the previous processing step. We can <a id="id329" class="indexterm"/>verify the correct workflow using the arrow connections in the model diagram that the <span class="strong"><strong>modeler</strong></span> draws automatically. The tool will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_24.jpg" alt="Automated geoprocessing with the graphical modeler"/></div><p>To finish the model, we should enter a model name (for example, <code class="literal">Create hexagonal heatmap</code>) and a group name (for example, <code class="literal">my models</code>). Processing will use the group name to organize all the models we create. Once we have picked a name and group, we can save the model and then run it. After closing the modeler, we can run the saved models from the toolbox like any other tool. It is even possible to use one model as a building block in another model.</p><p>Another useful feature is that we can specify a layer style, which should be applied to the processing results automatically. This default style can be set using <span class="strong"><strong>Edit rendering styles for outputs</strong></span> in the context menu of the created model in the toolbox, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7488_04_25.jpg" alt="Automated geoprocessing with the graphical modeler"/></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, we covered various raster and vector geoprocessing and analysis tools and how to apply them in common tasks. We saw how to use the Processing toolbox to run individual tools as well as the modeler to create complex geoprocessing models from multiple tools. Using the modeler, we can automate our workflows and increase our productivity, especially with respect to reoccurring tasks.</p><p>In the following chapter, we will learn how to bring all our knowledge together to create beautiful maps using advanced styles and map compositioning features.</p></div></body></html>