<html><head></head><body>
  <div><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Customizing the ArcGIS Interface with Add-ins</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading and installing the Python Add-in Wizard</li><li class="listitem" style="list-style-type: disc">Creating a button add-in and using the Python add-ins module</li><li class="listitem" style="list-style-type: disc">Installing and testing an add-in</li><li class="listitem" style="list-style-type: disc">Creating a tool add-in</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec72"/>Introduction</h1></div></div></div><p>In this chapter, we're going to cover the creation, testing, editing, and sharing of add-ins created with Python. <strong>Add-ins</strong>
<a id="id554" class="indexterm"/> provide a way of adding user interface items to ArcGIS for Desktop through a modular code base designed to perform specific actions. Interface components can include buttons, tools, toolbars, menus, combo boxes, tool palettes, and application extensions. The add-in concept was first introduced in ArcGIS for Desktop 10.0 and could be created with .NET or Java. However, starting with the release of ArcGIS 10.1, add-ins can now be created with Python. Add-ins are created using Python scripts and an XML file that defines how a user interface should appear.</p><p>Add-ins provide an easy way to distribute user interface customizations to end users. No installation programs are necessary. A single compressed file with a file extension of <code class="literal">.esriaddin</code> is copied to a well-known folder, and ArcGIS for Desktop handles the rest. To simplify the development even further, a Python Add-In Wizard has been provided by Esri. You can download the wizard from the Esri website. We'll do this in the first recipe of this chapter.</p><p>There are a number of add-in types that can be created. Buttons and tools are the simplest types of add-ins that you can create. Buttons simply execute business logic when clicked. Tools are similar to buttons but require interaction with the map before the business logic is executed. Combo boxes provide a list of choices for the user to select from.</p><p>There are also a number of container objects, including menus, toolbars, tool palettes, and application extensions. Menus act as a container for buttons or other menus. Toolbars are a container for buttons, tools, combo boxes, tool palettes, and menus. They are the most versatile type of container for add-ins. Tool palettes also act as a container for tools, and need to be added to a toolbar before the tools are exposed. Finally, application extensions are the most complex add-in type. This type of add-in coordinates activities between other components and is responsible for listening and responding to various events, such as the addition or removal of a layer from a data frame.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec73"/>Downloading and installing the Python Add-in Wizard</h1></div></div></div><p>Esri provides a tool that you<a id="id555" class="indexterm"/> can use to make the development of add-ins easier. The Python Add-In Wizard can be downloaded from the Esri website and is a great resource to create add-ins.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec189"/>Getting ready</h2></div></div></div><p>The Python Add-In Wizard<a id="id556" class="indexterm"/> is a great resource to create the necessary files for an add-in. It generates the required files for the add-ins from a visual interface. In this recipe, you will download and install the Python Add-In Wizard.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec190"/>How to do it…</h2></div></div></div><p>Follow these <a id="id557" class="indexterm"/>steps to learn how to download and install the Python Add-in Wizard:</p><div><ol class="orderedlist arabic"><li class="listitem">Open a web browser and navigate to <a class="ulink" href="http://www.arcgis.com/home/item.html?id=5f3aefe77f6b4f61ad3e4c62f30bff3b">http://www.arcgis.com/home/item.html?id=5f3aefe77f6b4f61ad3e4c62f30bff3b</a>.<p>You should see a web page similar to the following screenshot:</p><div><img src="img/B04314_10_1.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on the <strong>Open</strong> button to download the installer file.</li><li class="listitem">Using Windows Explorer, create a new folder called <code class="literal">Python Add-In Wizard</code> somewhere on your computer. The name of the folder is irrelevant, but to keep things simple and easy to remember, you should go with <code class="literal">Python Add-In Wizard</code> or something similar.</li><li class="listitem">Unzip the <a id="id558" class="indexterm"/>file to this new folder There are many utilities that can be used to unzip a file. Each will differ slightly in how they are used but with WinZip, you should be able to right-click on the file and select <strong>Extract</strong>.</li><li class="listitem">Open the <code class="literal">bin</code> folder that was unzipped and double-click on <code class="literal">addin_assistant.exe</code> to run the wizard. In the following screenshot, I have created a new folder called <code class="literal">Python Add-In Wizard</code> and unzipped the downloaded file. The <code class="literal">bin</code> folder was created, and inside this folder is a file called <code class="literal">addin_assistant.exe</code>:<div><img src="img/B04314_10_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Double-clicking <a id="id559" class="indexterm"/>on <code class="literal">addin_assistant.exe</code> will prompt you to choose a directory to use as the add-in project root:<div><img src="img/B04314_10_3.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec191"/>How it works…</h2></div></div></div><p>The Python Add-In Wizard i<a id="id560" class="indexterm"/>s a visual interface tool that you can use to create add-ins for ArcGIS for Desktop. It greatly simplifies the process through a point-and-click tool. In the next recipe, you'll create basic ArcGIS for Desktop add-ins using the wizard.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec74"/>Creating a button add-in and using the Python add-ins module</h1></div></div></div><p>A <code class="literal">Button</code> add-in <a id="id561" class="indexterm"/>is the simplest type of add-in and is also the most commonly used. With button add-ins, the functionality that you code in your script is executed each time the button is clicked on.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec192"/>Getting ready</h2></div></div></div><p>Creating an<a id="id562" class="indexterm"/> add-in project is the first step in the creation of a new add-in. To create a project using the Python Add-In Wizard, you select a working directory, enter various project settings, and click on the <strong>Save</strong> button. Creation of the add-in then follows a well-defined process, as illustrated in the following screenshot:</p><div><img src="img/B04314_10_28.jpg" alt="Getting ready"/></div><p>You must first create a container for the add-in and this can either be in the form of a toolbar or menu. Next, create the button, tool, or any other add-in that you want to add to the container. In this recipe, we'll create a button. Next, you need to edit the Python script that is associated with the button. You'll also want to test the button to make sure it works as expected. Finally, you can share the add-in with others. In this recipe, you'll learn how to use the Add-In Wizard to create a button add-in for ArcGIS for Desktop. The button add-in will execute code that uses the <code class="literal">pythonaddins</code> module to display a dialog that allows the user to add feature classes that have already been created for a data frame.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec193"/>How to do it...</h2></div></div></div><p>Follow these steps to learn how to create a button add-in:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the ArcGIS Python Add-In Wizard by double-clicking on the <code class="literal">addin_assistant.exe</code> file located in the <code class="literal">bin</code> folder, where you extracted the wizard.</li><li class="listitem">Create a new project folder called <code class="literal">Wildfire_Addin</code> and select <strong>OK</strong>:<div><img src="img/B04314_10_4.jpg" alt="How to do it..."/></div></li><li class="listitem">The <a id="id563" class="indexterm"/><strong>Project Settings</strong> tab should be active initially and display the working directory that you just created. By default, <strong>ArcMap</strong> should be the selected product, but you should verify that this is the case:<div><img src="img/B04314_10_5.jpg" alt="How to do it..."/></div></li><li class="listitem">Give your <a id="id564" class="indexterm"/>project a name. We'll call it <code class="literal">Load Wildfire Data Addin</code>:<div><img src="img/B04314_10_6.jpg" alt="How to do it..."/></div></li><li class="listitem">By default, the <strong>Version:</strong> is <strong>0.1</strong>. You can <a id="id565" class="indexterm"/>change this if you like. Version numbers should change as you update or make additions to your tool. This helps with the tracking and sharing of your add-ins:<div><img src="img/B04314_10_7.jpg" alt="How to do it..."/></div></li><li class="listitem">The <strong>Name:</strong> and <strong>Version:</strong> properties <a id="id566" class="indexterm"/>are the only two required properties. It's a good practice to go ahead and add the company, description, and author information, as shown in the following screenshot. Add your own information:<div><img src="img/B04314_10_8.jpg" alt="How to do it..."/></div></li><li class="listitem">You may <a id="id567" class="indexterm"/>also wish to add an image for the add-in. A file called <code class="literal">wildfire.png</code> has been provided for this purpose in the <code class="literal">C:\ArcpyBook\Ch10</code> folder:<div><img src="img/B04314_10_9.jpg" alt="How to do it..."/></div></li><li class="listitem">The <strong>Add-In Contents</strong> tab <a id="id568" class="indexterm"/>is used to define the various add-ins that can be created. In this step, we're going to create a toolbar to hold a single button add-in that runs a wildfire script, which imports <code class="literal">fires</code> from a text file to a feature class. Click on the <strong>Add-In Contents</strong> tab:<div><img src="img/B04314_10_10.jpg" alt="How to do it..."/></div></li><li class="listitem">In the<a id="id569" class="indexterm"/> <strong>Add-In Contents</strong> tab, right-click on <strong>TOOLBARS</strong> and select <strong>New Toolbar</strong>. Give the toolbar a <strong>Caption:</strong>, accept the default name, and make sure the <strong>Show Initially</strong> checkbox is selected:<div><img src="img/B04314_10_11.jpg" alt="How to do it..."/></div><p>While it doesn't do a whole lot functionally, the Toolbar add-in is very important because it acts as a container for other add-ins, such as buttons, tools, combo boxes, tool palettes, and menus. Toolbars can be floating or docked. Creating a toolbar add-in is easy using the <code class="literal">Python Add-In Wizard</code>.</p></li><li class="listitem">Click <a id="id570" class="indexterm"/>on the <strong>Save</strong> button.</li><li class="listitem">Now, we'll add a button by right-clicking on the new <strong>Wildfire Toolbar</strong> option and selecting <strong>New Button</strong>.</li><li class="listitem">Fill in the <strong>Button</strong> details, including a <strong>Caption:</strong>, <strong>Class Name:</strong>, <strong>ID (Variable Name):</strong>, <strong>Tooltip:</strong>, and so on. You can also include an <strong>Image for control:</strong>. I haven't done so in this case, but you may choose to do this. This information is saved to the configuration file for the add-in:<div><img src="img/B04314_10_12.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <a id="id571" class="indexterm"/><strong>Save</strong> button. Add-ins have a Python script that they are attached to. This file, by default, will be named <code class="literal">AddIns_addin.py</code> and can be found in the <code class="literal">install</code> directory of your working project folder.</li><li class="listitem">We've already created a custom <code class="literal">ArcToolbox</code> Python script tool that loads a comma-delimited text file from a disk containing wildfire data to a feature class. We will be using the results of this script in our add-in. In Windows Explorer, go to the <code class="literal">addin</code> directory that you created earlier. It should be called <code class="literal">Wildfire_Addin</code>. Go to the <code class="literal">Install</code> folder and you should find a file called <code class="literal">WildfireAddin_addin.py</code>. Load this file into your Python editor.</li><li class="listitem">In this next step, we'll <a id="id572" class="indexterm"/>write code that uses the <code class="literal">pythonaddins</code> module to open a dialog that allows you to add one or more layers to a selected data frame. The <code class="literal">OpenDialog()</code> and <code class="literal">GetSelectedTOCLayerorDataFrame()</code> functions in <code class="literal">pythonaddins</code> are used to accomplish this task. Find the <code class="literal">onClick(self)</code> method, which is shown in the following code snippet. This method is triggered when the button is clicked. Remove the <code class="literal">pass</code> statement from the <code class="literal">onClick</code> event and add this code:<div><pre class="programlisting">import arcpy
import pythonaddins

class ButtonClassImportWildfires(object):
    """Implementation for Wildfire_addin.button (Button)"""
    def __init__(self):
        self.enabled = True
        self.checked = False
    def onClick(self):
        layer_files = pythonaddins.OpenDialog('Select Layers to Add', True, r'C:\ArcpyBook\data\Wildfires', 'Add')
        mxd = arcpy.mapping.MapDocument('current')
        df = pythonaddins.GetSelectedTOCLayerOrDataFrame()
        if not isinstance(df, arcpy.mapping.Layer):
            for layer_file in layer_files:
                layer = arcpy.mapping.Layer(layer_file)
                arcpy.mapping.AddLayer(df, layer)
        else:
            pythonaddins.MessageBox('Select a data frame', 'INFO', 0)</pre></div></li><li class="listitem">Save the file.</li><li class="listitem">You can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch10\WildfireAddIn.py</code> solution file.</li></ol></div><p>In the next recipe, you will learn how to install your new add-in.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec194"/>How it works...</h2></div></div></div><p>As you've seen in this recipe, the Python Add-In Wizard handles the creation of the add-in through a visual interface. However, behind the scenes, the wizard creates a set of folders and files for the add-in. The add-in file structure is really quite simple. Two folders and a set of files comprise the add-in structure. You can see this structure in the following screenshot:</p><div><img src="img/B04314_10_13.jpg" alt="How it works..."/></div><p>The <code class="literal">Images</code> folder<a id="id573" class="indexterm"/> contains any icons or other image files used by your add-in. In this recipe, we used the <code class="literal">wildfire.png</code> image. So, this file should now be in the <code class="literal">Images</code> folder. The <code class="literal">Install</code> folder contains the Python script that handles the business logic of the add-in. This is the file you will work with extensively to code the add-in. It performs whatever business logic needs to be performed by the buttons, tools, menu items, and so on. The <code class="literal">config.xml</code> file in the main folder of the add-in defines the user interface and static properties, such as the name, author, version, and so on. The <code class="literal">makeaddin.py</code> file can be double-clicked on to create the <code class="literal">.esriaddin</code> file, which wraps everything into a compressed file with an <code class="literal">.esriaddin</code> extension. This <code class="literal">.esriaddin</code> file is what will be distributed to end users, so that the add-in can be installed.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec75"/>Installing and testing an add-in</h1></div></div></div><p>You'll want to test <a id="id574" class="indexterm"/>add-ins before distributing them to your end users. To test these, you first need to install the add-in.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec195"/>Getting ready</h2></div></div></div><p>In the working <a id="id575" class="indexterm"/>folder of your add-in, the <code class="literal">makeaddin.py</code> script can be used to copy all files and folders to a compressed add-in folder in a working directory with the <code class="literal">&lt;working folder name&gt;.esriaddin</code> file format. Double-click on this <code class="literal">.esriaddin</code> file to launch the Esri ArcGIS add-in installation utility, which will install your add-in. You can then go into ArcGIS for Desktop and test the add-in. The custom toolbar or menu may already be visible and ready to test. If it is not visible, go to the <strong>Customize</strong> menu and click on <strong>Add-in Manager</strong>. The <strong>Add-In Manager</strong> dialog box lists the installed add-ins that target the current application. Add-in information, such as name, description, and image, which are entered as project settings, should be displayed.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec196"/>How to do it…</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Inside <a id="id576" class="indexterm"/>the main folder for your add-in, there will be a Python script file called <code class="literal">makeaddin.py</code>. This script creates the <code class="literal">.esriaddin</code> file. Double-click on the script <a id="id577" class="indexterm"/>to execute and create the <code class="literal">.esriaddin</code> file. This process is illustrated in the following screenshot:<div><img src="img/B04314_10_14.jpg" alt="How to do it…"/></div></li><li class="listitem">To install the add-in for ArcGIS for Desktop, double-click on the <code class="literal">Widlfire_Add-In.esriaddin</code> file, which will launch the <strong>Esri ArcGIS Add-In Installation Utility</strong> window, as shown in the following screenshot:<div><img src="img/B04314_10_15.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on <a id="id578" class="indexterm"/><strong>Install Add-In</strong>. If everything was successful, you<a id="id579" class="indexterm"/> should see the following message:<div><img src="img/B04314_10_16.jpg" alt="How to do it…"/></div></li><li class="listitem">To test the add-in, open <strong>ArcMap</strong>. Your add-in may already be active. If not, navigate to <strong>Customize</strong> | <strong>Add-In Manager</strong>. This will display the <strong>Add-In Manager</strong> dialog box, as <a id="id580" class="indexterm"/>shown in the following screenshot. You should be able<a id="id581" class="indexterm"/> to see the add-in that you created:<div><img src="img/B04314_10_19.jpg" alt="How to do it…"/></div></li><li class="listitem">If needed, select the <strong>Customize</strong> button. To add the toolbar to the application, click on the <strong>Toolbars</strong> tab and choose the toolbar you created:<div><img src="img/B04314_10_20.jpg" alt="How to do it…"/></div><p>The add-in <a id="id582" class="indexterm"/>should now be displayed, as seen in<a id="id583" class="indexterm"/> this screenshot:</p><div><img src="img/B04314_10_26.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on the <a id="id584" class="indexterm"/>button and in the dialog that is displayed, navigate<a id="id585" class="indexterm"/> to the <code class="literal">Wildfires</code> layers you created earlier inside the <code class="literal">WildlandFires.mdb</code>. Select and add them to the display:<div><img src="img/B04314_10_25.jpg" alt="How to do it…"/></div><p>Here, you will see the <a id="id586" class="indexterm"/>output of <a id="id587" class="indexterm"/>having selected one or more layers from the dialog:</p><div><img src="img/B04314_10_27.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec197"/>How it works…</h2></div></div></div><p>The utility <a id="id588" class="indexterm"/>will place <a id="id589" class="indexterm"/>the add-in into a well-known folder discoverable by ArcGIS for Desktop. The locations of this folder are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Windows 8: <code class="literal">C:\Users\&lt;username&gt;\Documents\ArcGIS\AddIns\Desktop10.3</code></li><li class="listitem" style="list-style-type: disc">Vista/7: <code class="literal">C:\Users\&lt;username&gt;\Documents\ArcGIS\AddIns\Desktop10.3</code></li><li class="listitem" style="list-style-type: disc">XP: <code class="literal">C:\Documents and Settings\&lt;username&gt;\My Documents\ArcGIS\AddIns\Desktop10.3</code></li></ul></div><p>A folder with a unique <a id="id590" class="indexterm"/>
<strong>globally unique identifier</strong> or <strong>GUID</strong> name will be created inside the well-known folder. The add-in will reside inside this unique folder name. This is illustrated in the following screenshot. When ArcGIS for Desktop starts, it will search these directories and load the add-ins:</p><div><img src="img/B04314_10_17.jpg" alt="How it works…"/></div><p>The add-in will look similar to the following:</p><div><img src="img/B04314_10_18.jpg" alt="How it works…"/></div><div><div><h3 class="title"><a id="note11"/>Note</h3><p>The default add-in folder is located in the <code class="literal">ArcGIS</code> folder within your user account. For example, if your <code class="literal">ArcGIS</code> installation is version 10.1, the add-in is copied to <code class="literal">C:\users\&lt;username&gt;\Documents\ArcGIS\AddIns\Desktop10.1</code> on a Vista or Windows 7 operating system.</p></div></div><p>You can also use <a id="id591" class="indexterm"/>a private network <a id="id592" class="indexterm"/>drive to distribute add-ins to end users. The <code class="literal">Add-In Manager</code> in ArcGIS for Desktop adds and maintains lists of folders that can be searched for add-ins. Select the <strong>Options</strong> tab and then <strong>Add Folder</strong> to add a network drive to the list.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec76"/>Creating a tool add-in</h1></div></div></div><p>Tool add-ins are <a id="id593" class="indexterm"/>similar to buttons with the exception that tools require some type of interaction with the map. The zoom-in tool, for example, is a type of tool. Tools should be placed inside a toolbar or tool palette. The properties similar to those of a button. You'll also need to edit the Python script.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec198"/>Getting ready</h2></div></div></div><p>The <code class="literal">Tool</code> class has a <a id="id594" class="indexterm"/>number of properties, including <code class="literal">cursor</code>, <code class="literal">enabled</code>, and <code class="literal">shape</code>. The <code class="literal">cursor</code> property sets the cursor for the tool when it is clicked on, and is defined as an integer value corresponding to the cursor types, as follows:</p><div><img src="img/B04314_10_21.jpg" alt="Getting ready"/></div><p>By default, tools <a id="id595" class="indexterm"/>are enabled. This can be changed, though, by setting the <code class="literal">enabled</code> property to <code class="literal">false</code>. Finally, the <code class="literal">shape</code> property specifies the type of shape to be drawn and it can be a line, rectangle, or circle. These properties are typically set inside the constructor of the tool, which is defined by the <code class="literal">__init__</code> method, as shown in the following code example. The <code class="literal">self</code> object refers to the current object (a tool in this case) and is a variable that refers to this current object:</p><div><pre class="programlisting">def __init__(self):
  self.enabled = True
  self.cursor = 3
  self.shape = 'Rectangle'</pre></div><p>There are a number of functions associated with the <code class="literal">Tool</code> class. All classes will have a constructor, which is used to define the properties for the class. You saw an example of this <code class="literal">__init__</code> function earlier. Other important functions of the tool class include <code class="literal">onRectangle()</code>, <code class="literal">onCircle()</code>, and <code class="literal">onLine()</code>. These functions correspond to the shape that will be drawn on the map with the tool. The geometry of the drawn shape is passed into the function. There are also a number of mouse and key functions that can be used. Finally, the <code class="literal">deactivate()</code> function can be called when you want to deactivate the tool.</p><p>We've already seen the constructor for the <code class="literal">Tool</code> class in action. This function, called <code class="literal">__init__</code>, is used to set various properties for the tool when it is created. Here, we've also shown the <code class="literal">onRectangle()</code> function for the <code class="literal">Tool</code> class. This function is called when a rectangle is drawn on the map. The geometry of the rectangle is passed into the function along with a reference to the tool itself:</p><div><pre class="programlisting">def onRectangle(self, rectangle_geometry):</pre></div><p>In this recipe, you will learn how to create a tool add-in that responds to the user dragging a rectangle on the map. The tool will use the <strong>Generate Random Points</strong> tool<a id="id596" class="indexterm"/> to generate points within the rectangle.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec199"/>How to do it...</h2></div></div></div><p>Follow these <a id="id597" class="indexterm"/>steps to create a tool add-in with the <strong>ArcGIS Python Add-In Wizard</strong>:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <strong>ArcGIS Python Add-In Wizard</strong> by double-clicking on the <code class="literal">addin_assistant.exe</code> file that is located in the <code class="literal">bin</code> folder, where you extracted the wizard.</li><li class="listitem">Create a new project folder called <code class="literal">Generate_Random_Points</code> and select <strong>OK</strong>.</li><li class="listitem">Enter properties, including <strong>Name:</strong>, <strong>Version:</strong>, <strong>Company:</strong>, <strong>Description:</strong>, and <strong>Author:</strong>, in the <strong>Project Settings</strong> tab:<div><img src="img/B04314_10_22.jpg" alt="How to do it..."/></div></li><li class="listitem">Click <a id="id598" class="indexterm"/>on the <strong>Add-In Contents</strong> tab.</li><li class="listitem">Right-click on <strong>TOOLBARS</strong> and select <strong>New Toolbar</strong>.</li><li class="listitem">Set the caption for the toolbar to <code class="literal">Random Points Toolbar</code>.</li><li class="listitem">Right-click on the newly created <code class="literal">Random Points Toolbar</code> and select <strong>New Tool</strong>.</li><li class="listitem">Enter items for the tool as shown in the following screenshot:<div><img src="img/B04314_10_23.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on <strong>Save</strong>. This will generate the folder and file structure for the add-in.</li><li class="listitem">Go to the <code class="literal">Install</code> folder for the new add-in and open <code class="literal">GenerateRandomPoints_addin.py</code> in IDLE.</li><li class="listitem">Add the <a id="id599" class="indexterm"/>following code to the <code class="literal">__init__</code> function, which is the constructor for the tool:<div><pre class="programlisting">def __init__(self):
  self.enabled = True
  self.cursor = 3
  self.shape = 'Rectangle'</pre></div></li><li class="listitem">In the <code class="literal">onRectangle()</code> function, write a code to generate a set of random points within the rectangle drawn on the screen:<div><pre class="programlisting">import arcpy
import pythonaddins

def __init__(self):
  self.enabled = True
  self.cursor = 3
  self.shape = 'Rectangle'

def onRectangle(self, rectangle_geometry):
    extent = rectangle_geometry
    arcpy.env.workspace = r'c:\ArcpyBook\Ch10'
    if arcpy.Exists('randompts.shp'):
        arcpy.Delete_management('randompts.shp')
        randompts = arcpy.CreateRandomPoints_management(arcpy.env.workspace,'randompts.shp',"",rectangle_geometry)
        arcpy.RefreshActiveView()
    return randompts</pre></div></li><li class="listitem">Save<a id="id600" class="indexterm"/> the file.</li><li class="listitem">You can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch10\GenerateRandomPoints_addin.py</code> solution file.</li><li class="listitem">Generate the <code class="literal">.esriaddin</code> file by double-clicking on the <code class="literal">makeaddin.py</code> file in the <code class="literal">main</code> folder for the add-in.</li><li class="listitem">Install the add-in by double-clicking on <code class="literal">GenerateRandom_Points.esriaddin</code>.</li><li class="listitem">Open <strong>ArcMap</strong> and add the <code class="literal">Generate Random Points</code> toolbar, if necessary.</li><li class="listitem">Add the <code class="literal">BexarCountyBoundaries</code> feature class from <code class="literal">C:\ArcpyBook\data\CityOfSanAntonio.gdb</code>.</li><li class="listitem">Test the add-in by dragging a rectangle on the map. The output should appear similar to the following screenshot. Your map will vary because the points are generated randomly:<div><img src="img/B04314_10_24.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec200"/>How it works...</h2></div></div></div><p>Tool add-ins are <a id="id601" class="indexterm"/>very similar to button add-ins with the difference being that tool add-ins require some sort of interaction with the map before the functionality is triggered. An interaction with the map can include a number of things, such as clicking on the map, drawing a polygon or rectangle, or performing various mouse or key events. Python code is written to respond to one or more of these events. In this recipe, you learned how to write a code that responds to the <code class="literal">onRectangle()</code> event. You also set various <a id="id602" class="indexterm"/>properties inside the constructor for the add-in, including <code class="literal">cursor</code> and <code class="literal">shape</code>, which will be drawn on the map.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec201"/>There's more...</h2></div></div></div><p>There are a number of additional add-ins that you can create. The <code class="literal">ComboBox</code> add-in provides a drop-down list of values that the user can select from, or alternatively type a new value into an editable field. As with the other add-ins, you'll first want to create a new project with the Python Add-In Wizard, add a new toolbar, and then create a combo box to add to the toolbar.</p><p>The Tool Palette provides a way of grouping related tools. It does need to be added to an existing toolbar. By default, tools will be added to the palette in a grid-like pattern.</p><p>The <code class="literal">Menu</code> add-in acts as a container for buttons and other menus. Menus, in addition to being displayed by the ArcGIS for Desktop Add-in Manager, will also be displayed in the <strong>Customize</strong> dialog box for ArcGIS for Desktop.</p><p>Application extensions are used to add specific sets of related functionality to ArcGIS for Desktop. Several examples include Spatial Analyst, 3D Analyst, and Business Analyst. Typically, application extensions are responsible for listening for events and handling them. For example, you could create an application extension that saves the map document file each time a user adds a layer to the map. Application extensions also coordinate activities between components.</p></div></div></div>
</body></html>