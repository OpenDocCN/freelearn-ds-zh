<html><head></head><body>
  <div><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Executing Geoprocessing Tools from Scripts</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Finding geoprocessing tools</li><li class="listitem" style="list-style-type: disc">Retrieving a toolbox alias</li><li class="listitem" style="list-style-type: disc">Executing geoprocessing tools from a script</li><li class="listitem" style="list-style-type: disc">Using the output of a tool as an input to another tool</li><li class="listitem" style="list-style-type: disc">Setting environment variables</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec47"/>Introduction</h1></div></div></div><p>ArcGIS Desktop<a id="id466" class="indexterm"/> contains over 800 geoprocessing tools, which can be used in your Python scripts. In this chapter, you will learn to use these tools in your scripts. Each tool has unique characteristics. The syntax for executing each will differ depending upon the type of input required to successfully execute the tool. We'll examine how you can determine the input parameters for any tool using the ArcGIS Desktop help system. The execution of a tool results in the creation of one or more output datasets along with a set of messages that are generated while the tool is running. We'll examine how you can use these messages. Finally, we'll look at how you can get and set environment variables for your script.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec48"/>Finding geoprocessing tools</h1></div></div></div><p>Before using a tool in your geoprocessing script, you will need to make sure that you have access to that<a id="id467" class="indexterm"/> tool, based on the current license level of ArcGIS Desktop that you are running or that your end users will run. This information is contained within the ArcGIS Desktop help system.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec118"/>Getting ready</h2></div></div></div><p>The availability of <a id="id468" class="indexterm"/>geoprocessing tools for your script is dependent upon the ArcGIS license level you are using. At version 10.1 of ArcGIS Desktop, there are three license levels, namely <strong>Basic</strong>, <strong>Standard</strong>, and <strong>Advanced</strong>. These were formerly known as<a id="id469" class="indexterm"/> <strong>ArcView</strong>, <a id="id470" class="indexterm"/>
<strong>ArcEditor</strong>, and<a id="id471" class="indexterm"/> <strong>ArcInfo</strong>, respectively. It is important for you to understand the license level required for the tool that you want to use in your script. In addition to this, the use of extensions in ArcGIS Desktop can result in the availability of additional tools for your script. There are two primary ways to find tools in ArcGIS Desktop. The first is to use the search window and the second is to simply browse the contents of ArcToolbox. In this recipe, you will learn to use the search window to find available geoprocessing tools that can be used in your scripts.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec119"/>How to do it…</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch6\Crime_Ch6.mxd</code> in ArcMap. </li><li class="listitem">From the <strong>Geoprocessing</strong> menu item select <strong>Search For Tools</strong>. This will display the <strong>Search</strong> window, as shown in the following screenshot. By default, you will be searching for <strong>Tools</strong>:<div><img src="img/4445_06_1.jpg" alt="How to do it…"/></div></li><li class="listitem">Type the term<a id="id472" class="indexterm"/> <code class="literal">Clip</code> into the search text box. As you begin typing this word, the <strong>Search</strong> textbox will automatically filter the results based upon the first few letters you type. You'll notice that for the word <code class="literal">Clip</code>, there are three possible tools: <code class="literal">clip(analysis)</code>, <code class="literal">clip(coverage)</code>, <code class="literal">clip(data_management)</code>. There are a number of cases where there are several geoprocessing tools with the same name. To uniquely define a tool, the toolbox alias is attached to the tool name. We'll examine toolbox aliases in greater detail in the next recipe.</li><li class="listitem">For now, click on the <strong>Search</strong> button to generate a list of matching tools. The search should generate a list similar to what you see in the following screenshot. Tools are indicated with a hammer icon in the search results. You'll also see a couple of other icons in the search results. The scroll icon indicates a Python script, and an icon containing multi-colored squares indicates a model:<div><img src="img/4445_06_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Select the <a id="id473" class="indexterm"/><strong>Clip (Analysis)</strong> tool. This will open the dialog box for the <strong>Clip (Analysis)</strong> tool. This isn't all that useful to you as a script programmer. You will probably be more interested in the ArcGIS Desktop help for a particular tool. </li><li class="listitem">Click on the <strong>Tool Help</strong> button at the bottom of the tool dialog box to display detailed information about this particular tool:<div><img src="img/4445_06_3.jpg" alt="How to do it…"/></div></li><li class="listitem">Scroll down to the bottom of the help page for the <strong>Clip</strong> tool to examine the syntax for this particular tool.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec120"/>How it works…</h2></div></div></div><p>The help system <a id="id474" class="indexterm"/>contains a summary, illustration, usage, syntax, code samples, available environment variables, related topics, and licensing information for each tool. As a geoprocessing script programmer, you will primarily be interested in the syntax, code samples, and licensing information sections near the bottom. </p><div><div><h3 class="title"><a id="note10"/>Note</h3><p>You should always examine the licensing information section at the bottom of the help documentation for each tool, to make sure you have the appropriate license level to use the tool.</p></div></div><p>The syntax section contains information about how this tool should be called from your Python script, including the name of the tool and the required and optional input parameters. All the parameters will be enclosed within parentheses. The required parameters for the <code class="literal">Clip</code> tool are <code class="literal">in_features</code>, <code class="literal">clip_features</code>, and <code class="literal">out_feature_class</code>. When you call this tool from your script, you will be required to provide these parameters to the tool for it to execute correctly. The fourth parameter is an optional parameter called <code class="literal">cluster_tolerance</code>. Parameters marked as optional in the syntax are surrounded by curly braces. The following screenshot provides an example of an optional parameter surrounded by curly braces. This doesn't mean that you enclose the parameter in curly braces when you call the tool. It is in the help section simply to indicate that this parameter is optional when being <a id="id475" class="indexterm"/>called from your geoprocessing script:</p><div><img src="img/4445_06_4.jpg" alt="How it works…"/></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec49"/>Retrieving a toolbox alias</h1></div></div></div><p>All toolboxes have <a id="id476" class="indexterm"/>an alias which, when combined with the tool name, provides a unique reference to any tool in ArcGIS Desktop. This alias is necessary because a number of tools have the same name. When referencing a tool from your Python script, it is necessary to reference both the tool name and tool alias.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec121"/>Getting ready</h2></div></div></div><p>In the last recipe we looked at the <strong>Clip</strong> tool. There are actually three Clip tools which can be found in the <strong>Analysis, Coverage</strong>, and <strong>Data Management</strong> toolboxes. Each <strong>Clip</strong> tool performs a different function. For instance, the <strong>Clip</strong> tool in the <strong>Analysis</strong> toolbox clips a vector feature class using an input feature, while the <strong>Clip</strong> tool in the <strong>Data Management</strong> toolbox is used to create a spatial subset of a raster. Since it is possible to have multiple tools with the same name, we can uniquely identify a particular tool by providing both the toolname and the toolbox alias where the tool resides. In this recipe you will learn how to find the alias of a toolbox.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec122"/>How to do it…</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch6\Crime_Ch6.mxd</code> in ArcMap. </li><li class="listitem">If necessary, open <strong>ArcToolbox</strong>.</li><li class="listitem">Find the <a id="id477" class="indexterm"/><strong>Analysis Tools</strong> toolbox, as shown in the following screenshot:<div><img src="img/4445_06_5.jpg" alt="How to do it…"/></div></li><li class="listitem">Right-click on the <strong>Analysis Tools</strong> toolbox and select <strong>Properties</strong>. This will display the <strong>Analysis Tools Properties</strong> dialog, as shown in the following screenshot. The <strong>Alias</strong> textbox will contain the alias:<div><img src="img/4445_06_6.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec123"/>How it works…</h2></div></div></div><p>You can follow <a id="id478" class="indexterm"/>this process to find the alias name of any toolbox. In a Python script, you can execute a tool by referring to the tool with the syntax <code class="literal">&lt;toolname&gt;_&lt;toolbox alias&gt;</code>. For example, if you were calling the <strong>Buffer</strong> tool, it would be <code class="literal">buffer_analysis</code>. Toolbox aliases are invariably simple. They are typically one word and do not include dashes or special characters. In the next recipe, we'll create a simple script that follows this format for executing a tool.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec50"/>Executing geoprocessing tools from a script</h1></div></div></div><p>Once you have <a id="id479" class="indexterm"/>
<a id="id480" class="indexterm"/>determined the toolbox alias and then verified the accessibility of the tool based on your current license level, you are ready to add the execution of the tool to a script.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec124"/>Getting ready</h2></div></div></div><p>Now that you understand how to find the tools that are available and how to uniquely reference them, the next step is to put this together and execute a tool from a geoprocessing script. In this recipe, you can then execute the tool from your script.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec125"/>How to do it…</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch6\Crime_Ch6.mxd</code> in ArcMap. </li><li class="listitem">Click<a id="id481" class="indexterm"/><a id="id482" class="indexterm"/> on the <strong>Add Data</strong> button and add the <code class="literal">EdgewoodSD.shp</code> file to the table of contents.</li><li class="listitem">Turn off the <strong>Crime Density by School District</strong> and <strong>Burglaries in 2009</strong> layers to get a better view of the <strong>EdgewoodSD</strong> layer. There is only one polygon feature in this file. It represents the Edgewood School District. Now we're going to write a script that clips the <strong>Burglaries in 2009</strong> features to this school district.</li><li class="listitem">Open the Python window in ArcMap.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Create a variable that references the input feature class to be clipped:<div><pre class="programlisting">in_features = "c:/ArcpyBook/data/CityOfSanAntonio.gdb/Burglary"</pre></div></li><li class="listitem">Create a variable that references the layer to be used for the clip:<div><pre class="programlisting">clip_features = "c:/ArcpyBook/Ch6/EdgewoodSD.shp"</pre></div></li><li class="listitem">Create a variable that references the output feature class:<div><pre class="programlisting">out_feature_class = "c:/ArcpyBook/Ch6/ClpBurglary.shp"</pre></div></li><li class="listitem">Execute the <code class="literal">Clip</code> tool from the <strong>Analysis Tools</strong> toolbox:<div><pre class="programlisting">arcpy.Clip_analysis(in_features,clip_features,out_feature_class)</pre></div></li><li class="listitem">Run the script. The output feature class containing only those burglary points within the Edgewood school district should be added to the data frame, as shown in the following screenshot:<div><img src="img/4445_06_7.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec126"/>How it works…</h2></div></div></div><p>The primary<a id="id483" class="indexterm"/>
<a id="id484" class="indexterm"/> line of code of interest in this recipe is the final line that executes the <code class="literal">Clip</code> tool. Notice that we called this tool by specifying a syntax of <code class="literal">Clip_analysis</code>, which gives us a reference to the <code class="literal">Clip</code> tool in the <strong>Analysis Tools</strong> toolbox, which has an alias of <code class="literal">analysis</code>. We've also passed in three parameters that reference the input feature class, clip feature class, and output feature class. I should point out that we hardcoded the paths to each of the datasets. This is not a good programming practice, but in this particular instance I just wanted to illustrate how you execute a tool. A future chapter will illustrate how you can remove the hardcoding in your scripts and make them much more versatile. </p><p>Most tools that you use will require paths to data sources. This path must be the same as the path reported on the ArcCatalog <strong>Location</strong> toolbar, as shown in the following screenshot:</p><div><img src="img/4445_06_8.jpg" alt="How it works…"/></div><p>Tools use <a id="id485" class="indexterm"/>
<a id="id486" class="indexterm"/>ArcCatalog<a id="id487" class="indexterm"/> to find geographic data using an ArcCatalog path. This path is a string and is unique to each dataset. The path can include folder locations, database connections, or a URL. So, it is important to check the path using ArcCatalog before attempting to write Python scripts against the data. ArcSDE paths require special consideration. Many ArcSDE users do not have standardized connection names, which can cause issues when running models or scripts. </p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec127"/>There's more...</h2></div></div></div><p>Geoprocessing tools are organized in two ways. You can access tools as functions on <code class="literal">arcpy</code> or as modules matching the toolbox alias name. In the first case, when tools are accessible as functions from <code class="literal">arcpy</code>, they are called in the format that you followed in this recipe. The tool name is followed by an underscore and then the toolbox alias. In the second form, tools are called as functions of a module, which takes the name of the toolbox alias. Here, <code class="literal">analysis</code> is the toolbox alias, so it becomes a module. <code class="literal">Clip</code> is a function of that module and is called follows:</p><div><pre class="programlisting">arcpy.analysis.Clip (in_features,clip_features,out_feature_class)</pre></div><p>Which method you use is really a matter of preference. They both accomplish the same thing, which is the execution of a geoprocessing tool.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec51"/>Using the output of a tool as an input to another tool</h1></div></div></div><p>There will be many<a id="id488" class="indexterm"/>
<a id="id489" class="indexterm"/> occasions when you will need to use the output of one tool as an input to another tool. This is called tool chaining. An example of tool chaining could involve buffering a streams layer and then finding all residential properties that fall within the buffer. In this case, the Buffer tool would output a new layer, which would then be used as an input to the Select by Location tool or one of the other overlay tools. In this recipe, you will learn how to obtain the output of a tool and use it as input to another tool.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec128"/>Getting ready</h2></div></div></div><p>The Buffer tool creates an output feature class from an input feature layer using a specified distance. This output feature class can be stored in a variable, which can then be used as an input to another tool, such as the <code class="literal">Select Layer by Location</code> tool. In this recipe, you will learn how to use the output from the <code class="literal">Buffer</code> tool as an input to the <code class="literal">Select Layer by Location</code> tool to find all schools that are within a half mile of a stream.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec129"/>How to do it...</h2></div></div></div><p>Follow these steps to learn how to access the currently active map document in ArcMap:</p><div><ol class="orderedlist arabic"><li class="listitem">Open ArcMap with a new map document file (<code class="literal">.mxd</code>).</li><li class="listitem">Click on the <strong>Add Data</strong> button and add the Streams and Schools shapefiles from <code class="literal">c:\ArcpyBook\data\TravisCounty</code>.</li><li class="listitem">Click on the Python window button.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Set the workspace:<div><pre class="programlisting">arcpy.env.workspace = "c:/ArcpyBook/data/TravisCounty"</pre></div></li><li class="listitem">Start a <code class="literal">try</code> statement and add variables for the streams, buffered streams layer, distance, and schools:<div><pre class="programlisting">try:
  # Buffer areas of impact around major roads
  streams = "Streams.shp"
  streamsBuffer = "StreamsBuffer.shp"
  distance = "2640 Feet"
  schools2mile = "Schools.shp"</pre></div></li><li class="listitem">Call the <code class="literal">Buffer</code> tool and pass in variables for the streams layer, the buffered stream layer, and the distance along with several variables that control the look of the buffer:<div><pre class="programlisting">arcpy.Buffer_analysis(streams, streamsBuffer, distance,'FULL','ROUND','ALL')</pre></div></li><li class="listitem">Create a temporary layer for the schools using the <code class="literal">Make Feature Layer</code> tool:<div><pre class="programlisting">arcpy.MakeFeatureLayer_management(schools2mile, 'Schools2Mile_lyr')</pre></div></li><li class="listitem">Select all schools within a half mile of a stream using the <code class="literal">Select Layer by Location </code>tool:<div><pre class="programlisting">arcpy.SelectLayerByLocation_management('Schools2Mile_lyr', 'intersect', streamsBuffer)</pre></div></li><li class="listitem">Add the <code class="literal">except</code> block to catch any errors:<div><pre class="programlisting">except:
  print 'Error in script'</pre></div></li><li class="listitem">The<a id="id490" class="indexterm"/><a id="id491" class="indexterm"/> entire script should appear as follows:<div><pre class="programlisting">import arcpy
arcpy.env.workspace = "c:/ArcpyBook/data/TravisCounty"
try:
  # Buffer areas of impact around major roads
  streams = "Streams.shp"
  streamsBuffer = "StreamsBuffer.shp"
  distance = "2640 Feet"
  schools2mile = "Schools.shp"
	
	
  arcpy.Buffer_analysis(streams, streamsBuffer, distance,'FULL','ROUND','ALL')

  # Make a layer
  arcpy.MakeFeatureLayer_management(schools2mile, 'Schools2Mile_lyr') 
  arcpy.SelectLayerByLocation_management('Schools2Mile_lyr', 'intersect', streamsBuffer)
except:
  print 'Error in script'</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec130"/>How it works...</h2></div></div></div><p>The <code class="literal">Buffer</code> tool creates an output feature class, which we called <code class="literal">StreamsBuffer.shp</code> and stored in a variable called <code class="literal">streamsBuffer</code>. This <code class="literal">streamsBuffer</code> variable is then used as an input to the <code class="literal">Select Layer by Location</code> tool as the third parameter being passed in to the function. Using the output of one tool simply requires that you create a variable to hold the output data and then it can be re-used as needed in other tools.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec52"/>Setting environment variables and examining tool messages</h1></div></div></div><p>Environment variables <a id="id492" class="indexterm"/>
<a id="id493" class="indexterm"/>provide additional parameters that can be set, which serve as global variables accessible at various levels including your scripts. Your scripts can get environment variable values as well as set values. You need to have an understanding of the environment variables that are available to your script as well as how they can be accessed. In addition to this, tools generate messages during execution. These messages come in several varieties.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec131"/>Getting ready</h2></div></div></div><p>Environment <a id="id494" class="indexterm"/>
<a id="id495" class="indexterm"/>settings are additional parameters available to your script during execution. These are the values that you set once at the ArcGIS Desktop application level using a separate dialog box accessed through the <strong>Geoprocessing - Environments</strong> menu item, and are organized by category:</p><div><img src="img/4445OT_06_08.jpg" alt="Getting ready"/></div><p>These settings are very similar to environment variable settings that you can set at an operating-system level, but they are specific to the ArcGIS geoprocessing framework. These application-level environment settings are the highest level, and default settings for all the tools are applied during the execution of any tool. In addition to application-level environment settings, you can also apply environment settings at the tool level. Environment settings at the tool level directly inherit the settings applied at the application level. However, these settings can be overridden at the tool level. Tool-level settings are applicable only to the current tool execution. Your Python scripts can get and set environment settings through the <code class="literal">env</code> class in <code class="literal">arcpy</code>. These are read/write properties. Both application- and tool-level settings are passed into the script and will apply to any tool that you run from within<a id="id496" class="indexterm"/>
<a id="id497" class="indexterm"/> the script. You may also override any environment settings from within your script and these will be applied during the execution of the script. Please keep in mind that just as with tools, environment settings set at the script level only apply to the current execution of a script. There are, however, two occasions when environment settings are not passed to the script. These include scripts running outside an ArcGIS application, such as when they are run from the operating system command prompt. In addition, when a script calls another script, environment settings are not passed through. In this recipe, you will learn to set environment settings from your Python script and view various messages generated by the tool during execution.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec132"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to set environment settings and generate messages in your script:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new IDLE script and save it as <code class="literal">c:\ArcpyBook\Ch6\SetEnvVariables.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Set the workspace using an environment variable:<div><pre class="programlisting">arcpy.env.workspace = "c:/ArcpyBook/Ch6"</pre></div></li><li class="listitem">Call the <code class="literal">Buffer</code> tool, passing in the input dataset of <code class="literal">Streams.shp</code>, an output dataset of <code class="literal">Streams_Buff.shp</code>, and a distance of 200 feet.<div><pre class="programlisting">arcpy.Buffer_analysis("Streams.shp","Streams_Buff,’200 Feet’")</pre></div></li><li class="listitem">Save the script.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec133"/>How it works…</h2></div></div></div><p>Environment variables can be set at both the application level and the tool level. Application-level environment settings are similar to global environment settings; in that they affect all tools. On the other hand, environment settings defined at the tool level affect only the current run of a tool. Both can be set using ArcGIS Desktop. Your scripts can also set environment variables, which are applicable only during the execution of the script. They are similar to environment variables set at the tool level. Probably, the most commonly set environment variable used in scripts is the <code class="literal">env.workspace</code> variable, which defines the current working directory for the script. Setting this variable at the top of your script can make your code less wordy, since you won’t have to constantly refer to the full path to a dataset, but rather simply the dataset name as defined in the current workspace.</p></div></div></div>
</body></html>