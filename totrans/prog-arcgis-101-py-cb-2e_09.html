<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 9. Using the ArcPy Data Access Module to Select, Insert, and Update Geographic Data and Tables"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Using the ArcPy Data Access Module to Select, Insert, and Update Geographic Data and Tables</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Overview of cursor objects</li><li class="listitem" style="list-style-type: disc">Retrieving features from a feature class with SearchCursor</li><li class="listitem" style="list-style-type: disc">Filtering records with a where clause</li><li class="listitem" style="list-style-type: disc">Improving cursor performance with Geometry tokens</li><li class="listitem" style="list-style-type: disc">Inserting rows with InsertCursor</li><li class="listitem" style="list-style-type: disc">Updating rows with UpdateCursor</li><li class="listitem" style="list-style-type: disc">Deleting rows with UpdateCursor</li><li class="listitem" style="list-style-type: disc">Inserting and updating rows inside an edit session</li><li class="listitem" style="list-style-type: disc">Reading geometry from a feature class</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec61"/>Introduction</h1></div></div></div><p>We'll start this chapter with a basic question. What are cursors? <span class="strong"><strong>Cursors</strong></span>
<a id="id600" class="indexterm"/> are in-memory objects containing one or more rows of data from a table or feature class. Each row contains the attributes from each field in the data source, along with the geometry for each feature. Cursors allow you to search, add, insert, update, and delete data from tables and feature classes. </p><p>The<a id="id601" class="indexterm"/> ArcPy Data Access module or <code class="literal">arcpy.da</code> is new <a id="id602" class="indexterm"/>to ArcGIS 10.1 and contains methods that allow you to iterate through each row in a cursor. Various types of cursors can be created. For example, search cursors can be created to read values from rows. Update cursors can be created to update values in rows or delete rows, and insert cursors can be created to insert new rows.</p><p>There are a number of cursor improvements that have been introduced with the ArcPy Data Access module. Prior to ArcGIS 10.1, cursor performance had been notoriously slow. Now, cursors are significantly faster. Esri <a id="id603" class="indexterm"/>has estimated that search cursors are up to 30 times faster while insert cursors are up to 12 times faster. In addition to these general performance improvements, the Data Access module also provides a number of new options that allow programmers to speed up processing. Rather than returning all the fields in a cursor, you can now specify that a subset of fields be returned. This increases the performance as less data needs to be returned. The same applies to geometry. Traditionally, when accessing the geometry of a feature, the entire geometric definition would be returned. You can now use geometry tokens to return a portion of the geometry rather than the full geometry for the feature. You can also use lists and tuples rather than using rows. Also new are edit sessions and the ability to work with versions, domains, and subtypes.</p><p>There are <a id="id604" class="indexterm"/>three cursor functions in <code class="literal">arcpy.da</code>. Each returns a cursor object having the same name as the function. <code class="literal">SearchCursor()</code> creates a read-only <code class="literal">SearchCursor</code> object containing rows from a table or feature class. <code class="literal">InsertCursor()</code> creates an <code class="literal">InsertCursor</code> object that can be used to insert new records into a table or feature class. <code class="literal">UpdateCursor()</code> returns a cursor object that can be used to edit or delete records from a table or feature class. Each of these cursor objects has methods for accessing rows in the cursor. You can see the relationship between the cursor functions, the objects they create, and how they are used as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Object Created</p>
</th><th style="text-align: left" valign="bottom">
<p>Usage</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SearchCursor()</code>
<a id="id605" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">SearchCursor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Read-only view of data from a table or feature class</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">InsertCursor()</code>
<a id="id606" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">InsertCursor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Adds rows to a table or feature class</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">UpdateCursor()</code>
<a id="id607" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">UpdateCursor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Edit or delete rows in a table or feature class</p>
</td></tr></tbody></table></div><p>The <code class="literal">SearchCursor()</code> function<a id="id608" class="indexterm"/> is used to return a<a id="id609" class="indexterm"/> <code class="literal">SearchCursor</code> object. This object can only be used to iterate through a set of rows returned for read-only purposes. No insertions, deletions, or updates can occur through this object. An optional <code class="literal">where</code> clause can be set to limit the rows returned. </p><p>Once you've obtained a cursor instance, it is common to iterate through the records, particularly with a <code class="literal">SearchCursor</code> or <code class="literal">UpdateCursor</code>. There are some peculiarities that you need to understand about navigating the records in a cursor. Cursor navigation is forward moving only. When a cursor is created, the pointer for the cursor sits just above the first row in the cursor. The first call to <code class="literal">next()</code> will move the pointer to the first row. Rather than calling the <a id="id610" class="indexterm"/> <code class="literal">next()</code> method, you can also use a <code class="literal">for</code> loop to process each of the records without the need to call the <code class="literal">next()</code> method. After performing whatever processing you need to do with this row, a subsequent call to <code class="literal">next()</code> will move the pointer to row 2. This process continues as long as you need to access additional rows. However, after a row has been visited, you can't go back a single record at a time. For instance, if the current row is row 3, you can't programmatically back up to row 2. You can only go forward. To revisit rows 1 and 2, you would need to either call the <code class="literal">reset()</code> method<a id="id611" class="indexterm"/> or recreate the cursor and move back through the object. As I mentioned, cursors are often navigated through the use of <code class="literal">for</code> loops as well. In fact, this is a more common way to iterate through a cursor and is a more efficient way to code your scripts. Cursor navigation is illustrated in the following diagram:</p><div class="mediaobject"><img src="images/4445OT_09_02.jpg" alt="Introduction"/></div><p>The <code class="literal">InsertCursor()</code> function<a id="id612" class="indexterm"/> is used to create an <code class="literal">InsertCursor</code> object<a id="id613" class="indexterm"/> that allows you to programmatically add new records to feature classes and tables. To insert rows, call the <code class="literal">insertRow()</code> method<a id="id614" class="indexterm"/> on this object. You can also retrieve a read-only tuple containing the field names in use by the cursor through the <code class="literal">fields</code> property. A lock is placed on the table or feature class being accessed through the cursor. It's important to always design your script in a way that releases the cursor when you are done.</p><p>The <code class="literal">UpdateCursor()</code> function<a id="id615" class="indexterm"/> can be used to create an <code class="literal">UpdateCursor</code> object<a id="id616" class="indexterm"/> that can update and delete rows in a table or feature class. As is the case with an <code class="literal">InsertCursor</code>, this function places a lock on the data while it's being edited or deleted. If the cursor is used inside a Python <code class="literal">with</code> statement, the lock will automatically be freed after the data has been processed. This hasn't always been the case. Prior to ArcGIS 10.1, cursors were required to be manually released using the Python <code class="literal">del</code> statement. Once an instance of <code class="literal">UpdateCursor</code> has been obtained, you can then call the <code class="literal">updateCursor()</code> method to update records in tables or feature classes and the <code class="literal">deleteRow()</code> method<a id="id617" class="indexterm"/> to delete a row.</p><p>The subject of data locks requires a little more explanation. Insert and update cursors must obtain a lock on the data source they reference. This means that no other application can concurrently access this data source. Locks are a way of preventing multiple users from changing data at the same time and thus corrupting the data. When the <code class="literal">InsertCursor()</code> and <code class="literal">UpdateCursor()</code> methods are called in your code, Python attempts to acquire a lock on the data. This lock must be specifically released after the cursor has finished processing, so that other users running applications such as <code class="literal">ArcMap</code> or <code class="literal">ArcCatalog</code> can access the data sources. Otherwise, no other application will be able to access the data. Prior to ArcGIS 10.1 and the <code class="literal">with</code> statement, cursors had to be specifically unlocked through Python's <code class="literal">del</code> statement. Similarly, <code class="literal">ArcMap</code> and <code class="literal">ArcCatalog</code> also acquire data locks when updating or deleting data. If a data source has been locked by either of these applications, your Python code will not be able to access the data. Therefore, best practice is to close <code class="literal">ArcMap</code> and <code class="literal">ArcCatalog</code> before running any standalone Python scripts that use insert or update cursors.</p><p>In this chapter, we're going to cover the use of cursors for accessing and editing tables and feature classes. However, many of the cursor concepts that existed before ArcGIS 10.1 still apply. </p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Retrieving features from a feature class with a SearchCursor"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec62"/>Retrieving features from a feature class with a SearchCursor</h1></div></div></div><p>There are <a id="id618" class="indexterm"/>
<a id="id619" class="indexterm"/>many occasions when you need to retrieve rows from a table or feature class for read-only purposes. For example, you might want to generate a list of all land parcels in a city with a value of greater than $100,000. In this case, you don't have any need to edit the data. Your needs are met simply by generating a list of rows that meet some sort of criteria.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec154"/>Getting ready</h2></div></div></div><p>The <code class="literal">SearchCursor()</code> function<a id="id620" class="indexterm"/> is used to return a <code class="literal">SearchCursor</code> object. This object can only be used to iterate through a set of rows returned for read-only purposes. No insertions, deletions, or updates can occur through this object. An optional <code class="literal">where</code> clause<a id="id621" class="indexterm"/> can be set to limit the rows returned. In this recipe, you will learn how to create a basic <code class="literal">SearchCursor</code> object on a feature class through the use of the <code class="literal">SearchCursor()</code> function.</p><p>The <code class="literal">SearchCursor</code> object contains a <code class="literal">fields</code> property along with <code class="literal">next()</code> and <code class="literal">reset()</code> methods. The <code class="literal">fields</code> property is a read-only structure in the form of a Python tuple, containing the fields requested from the feature class or table. You are going to hear the term tuple a lot in conjunction with cursors. If you haven't covered this topic before, tuples are a Python structure for storing a sequence of data similar to Python lists. But there are some important differences between Python tuples and lists. Tuples are defined as a sequence of values inside parentheses while lists are defined as a sequence of values inside <a id="id622" class="indexterm"/>
<a id="id623" class="indexterm"/>brackets. Unlike lists, tuples can't grow and shrink, which can be a very good thing in some cases when you want data values to occupy a specific position each time. Such is the case with cursor objects that use tuples to store data from fields in tables and feature classes. </p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec155"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to retrieve rows from a table or feature class inside a <code class="literal">SearchCursor</code> object:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE and create a new script window.</li><li class="listitem">Save the script as <code class="literal">c:\ArcpyBook\Ch9\SearchCursor.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy.da</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.da</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "c:/ArcpyBook/Ch9"</pre></div></li><li class="listitem">Use a Python <code class="literal">with</code> statement to create a cursor:<div class="informalexample"><pre class="programlisting">with arcpy.da.SearchCursor("Schools.shp",("Facility","Name")) as cursor:</pre></div></li><li class="listitem">Loop through each row in the <code class="literal">SearchCursor</code> and print the name of the school. Make sure you indent the <code class="literal">for</code> loop inside the <code class="literal">with</code> block:<div class="informalexample"><pre class="programlisting">for row in sorted(cursor):
  print("School name: " + row[1])</pre></div></li><li class="listitem">Save the script.</li><li class="listitem">Run the script. You should see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>School name: ALLAN</strong></span>
<span class="strong"><strong>School name: ALLISON</strong></span>
<span class="strong"><strong>School name: ANDREWS</strong></span>
<span class="strong"><strong>School name: BARANOFF</strong></span>
<span class="strong"><strong>School name: BARRINGTON</strong></span>
<span class="strong"><strong>School name: BARTON CREEK</strong></span>
<span class="strong"><strong>School name: BARTON HILLS</strong></span>
<span class="strong"><strong>School name: BATY</strong></span>
<span class="strong"><strong>School name: BECKER</strong></span>
<span class="strong"><strong>School name: BEE CAVE</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec156"/>How it works…</h2></div></div></div><p>The <code class="literal">with</code> statement, used <a id="id624" class="indexterm"/>
<a id="id625" class="indexterm"/>with the <code class="literal">SearchCursor()</code> function, will create, open, and close the cursor. So you no longer have to be concerned with explicitly releasing the lock on the cursor as you did prior to ArcGIS 10.1. The first parameter passed into the <code class="literal">SearchCursor()</code> function is a feature class, represented by the <code class="literal">Schools.shp</code> file. The second parameter is a Python tuple containing a list of fields that we want returned in the cursor. For performance reasons, it is a best practice to limit the fields returned in the cursor to only those that you need to complete the task. Here, we've specified that only the <code class="literal">Facility</code> and <code class="literal">Name</code> fields should be returned. The <code class="literal">SearchCursor</code> object is stored in a variable called <code class="literal">cursor</code>.</p><p>Inside the <code class="literal">with</code> block, we are using a Python <code class="literal">for</code> loop to loop through each school returned. We're also using the Python <code class="literal">sorted()</code> function<a id="id626" class="indexterm"/> to sort the contents of the cursor. To access the values from a field on the row, simply use the index number of the field you want to return. In this case, we want to return the contents of the <code class="literal">Name</code> column, which will be index number <code class="literal">1</code>, since it is the second item in the tuple of field names that are returned.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Filtering records with a where clause"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec63"/>Filtering records with a where clause</h1></div></div></div><p>By default, <code class="literal">SearchCursor</code> will contain all rows in a table or feature class. However, in many cases, you will want to restrict the number of rows returned by some sort of criteria. Applying a<a id="id627" class="indexterm"/>
<a id="id628" class="indexterm"/> filter through the use of a <code class="literal">where</code> clause limits the records returned.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec157"/>Getting ready</h2></div></div></div><p>By default, all <a id="id629" class="indexterm"/>rows from a table or feature class will be returned when you create a <code class="literal">SearchCursor</code> object. However, in many cases, you will want to restrict the records returned. You can do this by creating a query and passing it in as a <code class="literal">where</code> clause parameter when calling the <a id="id630" class="indexterm"/> <code class="literal">SearchCursor()</code> function. In this recipe, you'll build on the script you created in the previous recipe, by adding a <code class="literal">where</code> clause that restricts the records returned.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec158"/>How to do it…</h2></div></div></div><p>Follow these steps to apply a filter to a <code class="literal">SearchCursor</code> object that restricts the rows returned from a <a id="id631" class="indexterm"/>
<a id="id632" class="indexterm"/>table or feature class:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE and load the <code class="literal">SearchCursor.py</code> script that you created in the previous recipe.</li><li class="listitem">Update the <code class="literal">SearchCursor()</code> function by adding a <code class="literal">where</code> clause that queries the <code class="literal">facility</code> field for records that have the text <code class="literal">High School</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>with arcpy.da.SearchCursor("Schools.shp",("Facility","Name"), '"FACILITY" = \'HIGH SCHOOL\'') as cursor:</strong></span>
</pre></div></li><li class="listitem">Save and run the script. The output will now be much smaller and restricted to only those schools that are high schools:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>High school name: AKINS</strong></span>
<span class="strong"><strong>High school name: ALTERNATIVE LEARNING CENTER</strong></span>
<span class="strong"><strong>High school name: ANDERSON</strong></span>
<span class="strong"><strong>High school name: AUSTIN</strong></span>
<span class="strong"><strong>High school name: BOWIE</strong></span>
<span class="strong"><strong>High school name: CROCKETT</strong></span>
<span class="strong"><strong>High school name: DEL VALLE</strong></span>
<span class="strong"><strong>High school name: ELGIN</strong></span>
<span class="strong"><strong>High school name: GARZA</strong></span>
<span class="strong"><strong>High school name: HENDRICKSON</strong></span>
<span class="strong"><strong>High school name: JOHN B CONNALLY</strong></span>
<span class="strong"><strong>High school name: JOHNSTON</strong></span>
<span class="strong"><strong>High school name: LAGO VISTA</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec159"/>How it works…</h2></div></div></div><p>We covered the creation of queries in <a class="link" href="ch08.html" title="Chapter 8. Querying and Selecting Data">Chapter 8</a>, <span class="emphasis"><em>Querying and Selecting Data</em></span>, so hopefully you now have a good grasp of how these are created along with all the rules you need to follow when coding these structures. The <code class="literal">where</code> clause parameter accepts any valid SQL query, and is used in this case to restrict the number of records that are <a id="id633" class="indexterm"/>
<a id="id634" class="indexterm"/>returned.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Improving cursor performance with geometry tokens"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec64"/>Improving cursor performance with geometry tokens</h1></div></div></div><p>
<span class="strong"><strong>Geometry tokens</strong></span>
<a id="id635" class="indexterm"/> were introduced in ArcGIS 10.1 as a performance improvement for cursors. Rather than returning the entire geometry of a feature inside the cursor, only a portion of the geometry is returned. Returning the entire geometry of a feature can result in decreased cursor performance due to the amount of data that has to be returned. It's significantly faster to return only the geometry that is needed. </p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec160"/>Getting ready</h2></div></div></div><p>A token is provided as <a id="id636" class="indexterm"/>
<a id="id637" class="indexterm"/>one of the fields in the <code class="literal">field</code> list passed into the constructor for a cursor and is in the format <code class="literal">SHAPE@&lt;Part of Feature to be Returned&gt;</code>. The only exception to this format is the <code class="literal">OID@</code> token, which returns the object ID of the feature. The following code example retrieves the x and y coordinates of a feature:</p><div class="informalexample"><pre class="programlisting">with arcpy.da.SearchCursor(fc, ("SHAPE@XY","Facility","Name")) as cursor:</pre></div><p>The following table lists the available geometry tokens. Not all cursors support the full list of tokens. Please check the ArcGIS help files for information on the tokens supported by each cursor type. The <code class="literal">SHAPE@</code> token<a id="id638" class="indexterm"/> returns the entire geometry of the feature. Use this carefully though, because it is an expensive operation to return the entire geometry of a feature and can dramatically affect performance. If you don't need the entire geometry, then do not include this token!</p><div class="mediaobject"><img src="images/4445OT_09_08.jpg" alt="Getting ready"/></div><p>In this recipe, you will use a geometry token to increase the performance of a cursor. You'll retrieve the x and y coordinates of each land parcel from a <code class="literal">parcels</code> feature class, along with some attribute information about the parcel.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec161"/>How to do it…</h2></div></div></div><p>Follow these<a id="id639" class="indexterm"/>
<a id="id640" class="indexterm"/> steps to add a geometry token to a cursor, which should improve the performance of this object:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE and create a new script window.</li><li class="listitem">Save the script as <code class="literal">c:\ArcpyBook\Ch9\GeometryToken.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy.da</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.da, time</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "c:/ArcpyBook/Ch9"</pre></div></li><li class="listitem">We're going to measure how long it takes to execute the code using a geometry token. Add a start time for the script:<div class="informalexample"><pre class="programlisting">start = time.clock()</pre></div></li><li class="listitem">Use a Python <code class="literal">with</code> statement to create a cursor that includes the centroid of each feature as well as the ownership information stored in the <code class="literal">PY_FULL_OW</code> field:<div class="informalexample"><pre class="programlisting">with arcpy.da.SearchCursor("coa_parcels.shp",("PY_FULL_OW","SHAPE@XY")) as cursor:</pre></div></li><li class="listitem">Loop through each row in <code class="literal">SearchCursor</code> and print the name of the school. Make sure you indent the <code class="literal">for</code> loop inside the <code class="literal">with</code> block:<div class="informalexample"><pre class="programlisting">for row in cursor:
  print("Parcel owner: {0} has a location of: {1}".format(row[0], row[1]))</pre></div></li><li class="listitem">Measure the elapsed time:<div class="informalexample"><pre class="programlisting">elapsed = (time.clock() - start)</pre></div></li><li class="listitem">Print <a id="id641" class="indexterm"/><a id="id642" class="indexterm"/> the execution time:<div class="informalexample"><pre class="programlisting">print "Execution time: " + str(elapsed)</pre></div></li><li class="listitem">Save the script.</li><li class="listitem">Run the script. You should see something similar to the following output. Note the execution time; your time will vary:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN ATTN REAL ESTATE DIVISION has a location of: (3110480.5197341456, 10070911.174956793)</strong></span>
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN ATTN REAL ESTATE DIVISION has a location of: (3110670.413783513, 10070800.960865)</strong></span>
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN has a location of: (3143925.0013213265, 10029388.97419636)</strong></span>
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN % DOROTHY NELL ANDERSON ATTN BARRY LEE ANDERSON has a location of: (3134432.983822767, 10072192.047894118)</strong></span>
<span class="strong"><strong>Execution time: 9.08046185109</strong></span>
</pre></div></li></ol></div><p>Now, we're going to measure the execution time if the entire geometry is returned instead of just the portion of the geometry that we need:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Save a new copy of the script as <code class="literal">c:\ArcpyBook\Ch9\GeometryTokenEntireGeometry.py</code>.</li><li class="listitem">Change the <code class="literal">SearchCursor()</code> function to return the entire geometry using <code class="literal">SHAPE@</code> instead of <code class="literal">SHAPE@XY</code>:<div class="informalexample"><pre class="programlisting">with arcpy.da.SearchCursor("coa_parcels.shp",("PY_FULL_OW","SHAPE@")) as cursor:</pre></div></li><li class="listitem">Save and run the script. You should see the following output. Your time will vary from mine, but notice that the execution time is slower. In this case, it's only a little over a second slower but we're only returning 2600 features. If the feature class were significantly large, as many are, this would be<a id="id643" class="indexterm"/><a id="id644" class="indexterm"/> amplified:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN ATTN REAL ESTATE DIVISION has a location of: &lt;geoprocessing describe geometry object object at 0x06B9BE00&gt;</strong></span>
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN ATTN REAL ESTATE DIVISION has a location of: &lt;geoprocessing describe geometry object object at 0x2400A700&gt;</strong></span>
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN has a location of: &lt;geoprocessing describe geometry object object at 0x06B9BE00&gt;</strong></span>
<span class="strong"><strong>Parcel owner: CITY OF AUSTIN % DOROTHY NELL ANDERSON ATTN BARRY LEE ANDERSON has a location of: &lt;geoprocessing describe geometry object object at 0x2400A700&gt;</strong></span>
<span class="strong"><strong>Execution time: 10.1211390896</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec162"/>How it works…</h2></div></div></div><p>A geometry token can be supplied as one of the field names supplied in the constructor for the cursor. These tokens are used to increase the performance of a cursor by returning only a portion of the geometry instead of the entire geometry. This can dramatically increase the performance of a cursor, particularly when you are working with large polyline or polygon datasets. If you only need specific properties of the geometry in your cursor, you should use these tokens.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Inserting rows with InsertCursor"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec65"/>Inserting rows with InsertCursor</h1></div></div></div><p>You can insert a row <a id="id645" class="indexterm"/>
<a id="id646" class="indexterm"/>into a table or feature class using an <code class="literal">InsertCursor</code> object. If you want to insert attribute values along with the new row, you'll need to supply the values in the order found in the attribute table.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec163"/>Getting ready</h2></div></div></div><p>The <code class="literal">InsertCursor()</code> function is used to create an <code class="literal">InsertCursor</code> object that allows you to programmatically add new records to feature classes and tables. The <code class="literal">insertRow()</code> method<a id="id647" class="indexterm"/> on the <code class="literal">InsertCursor</code> object adds the row. A row, in the form of a list or tuple, is passed into the <code class="literal">insertRow()</code> method. The values in the list must correspond to the field values defined when the <code class="literal">InsertCursor</code> object was created. Just as with the other types of cursors, you can also limit the field names returned using the second parameter of the method. This function supports geometry tokens as well.</p><p>The following code example illustrates how you can use <code class="literal">InsertCursor</code> to insert new rows into a feature class. Here, we are inserting two new wildfire points into the <code class="literal">California</code> feature class. The row values to be inserted are defined in a <code class="literal">list</code> variable. Then, an <code class="literal">InsertCursor</code> object is created, passing in the feature class and fields. Finally, the new rows are inserted into the feature class using the <code class="literal">insertRow()</code> method:</p><div class="informalexample"><pre class="programlisting">rowValues = [{'Bastrop','N',3000,(-105.345,32.234)),('Ft Davis','N', 456, (-109.456,33.468))]
fc = "c:/data/wildfires.gdb/California"
fields["FIRE_NAME", "FIRE_CONTAINED", "ACRES", "SHAPE@XY"]
with arcpy.da.InsertCursor(fc, fields) as cursor:
  for row in rowValues:
    cursor.insertRow(row)</pre></div><p>In this recipe, you will use <code class="literal">InsertCursor</code> to add wildfires retrieved from a <code class="literal">text</code> file into a point feature class. When inserting rows into a feature class, you will need to know how to add the geometric representation of a feature into the feature class. This can be accomplished using <code class="literal">InsertCursor</code> along with two miscellaneous objects: <code class="literal">Array</code> and <code class="literal">Point</code>. In this exercise, we will add point features in the form of wildfire incidents to an empty point feature class. In addition, you will use Python file manipulation techniques to read the coordinate data from a text file.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec164"/>How to do it…</h2></div></div></div><p>We will be <a id="id648" class="indexterm"/>
<a id="id649" class="indexterm"/>importing North American wildland fire incident data from a single day in October, 2007. This data is contained in a comma-delimited text file containing one line for each fire incident on that particular day. Each fire incident has a latitude/longitude coordinate pair separated by commas along with a confidence value. This data was derived by automated methods that use remote sensing data to derive the presence or absence of a wildfire. Confidence values can range from 0 to 100. Higher numbers represent a greater confidence that this is indeed a wildfire:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the file at <code class="literal">c:\ArcpyBook\Ch9\Wildfire Data\NorthAmericaWildfire_2007275.txt</code> and examine the contents. <p>You will notice that this is a simple comma-delimited text file containing longitude and latitude values for each fire along with a confidence value. We will use Python to read the contents of this file line-by-line and insert new point features into the <code class="literal">FireIncidents</code> feature class located in the <code class="literal">c:\ArcpyBook\Ch9 \WildfireData\WildlandFires.mdb</code> personal geodatabase.</p></li><li class="listitem">Close the file.</li><li class="listitem">Open <code class="literal">ArcCatalog</code>.</li><li class="listitem">Navigate to <code class="literal">c:\ArcpyBook\Ch9\WildfireData</code>. <p>You should see a personal geodatabase called <code class="literal">WildlandFires</code>. Open this geodatabase and you will see a point feature class called <code class="literal">FireIncidents</code>. Right now this is an empty feature class. We will add features by reading the text file you examined earlier and inserting points. </p></li><li class="listitem">Right-click on <code class="literal">FireIncidents</code> and select <span class="strong"><strong>Properties</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Fields</strong></span> tab. <p>The latitude/longitude values found in the file we examined earlier will be imported into the <code class="literal">SHAPE</code> field and the confidence values will be written<a id="id650" class="indexterm"/>
<a id="id651" class="indexterm"/> to the <code class="literal">CONFIDENCEVALUE</code> field.</p></li><li class="listitem">Open IDLE and create a new script.</li><li class="listitem">Save the script to <code class="literal">c:\ArcpyBook\Ch9\InsertWildfires.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> and <code class="literal">os</code> modules:<div class="informalexample"><pre class="programlisting">import arcpy,os</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"</pre></div></li><li class="listitem">Open the text file and read all the lines into a list:<div class="informalexample"><pre class="programlisting">f = open("C:/ArcpyBook/Ch9/WildfireData/NorthAmericaWildfires_2007275.txt","r")
lstFires = f.readlines()</pre></div></li><li class="listitem">Start a <code class="literal">try</code> block:<div class="informalexample"><pre class="programlisting">try:</pre></div></li><li class="listitem">Create an <code class="literal">InsertCursor</code> object using a <code class="literal">with</code> block. Make sure you indent inside the <code class="literal">try</code> statement. The cursor will be created on the <code class="literal">FireIncidents</code> feature class:<div class="informalexample"><pre class="programlisting">with da.InsertCursor("FireIncidents",("SHAPE@XY","CONFIDENCEVALUE")) as cur:</pre></div></li><li class="listitem">Create a counter variable that will be used to print the progress of the script:<div class="informalexample"><pre class="programlisting">cntr = 1</pre></div></li><li class="listitem">Loop<a id="id652" class="indexterm"/><a id="id653" class="indexterm"/> through the text file line by line using a <code class="literal">for</code> loop. Since the text file is comma-delimited, we'll use the Python <code class="literal">split()</code> function<a id="id654" class="indexterm"/> to separate each value into a list variable called <code class="literal">vals</code>. We'll then pull out the individual latitude, longitude, and confidence value items and assign them to variables. Finally, we'll place these values into a list variable called <code class="literal">rowValue</code>, which is then passed into the <code class="literal">insertRow()</code> function<a id="id655" class="indexterm"/> for the <code class="literal">InsertCursor</code> object, and then we'll print a message:<div class="informalexample"><pre class="programlisting">for fire in lstFires:
      if 'Latitude' in fire:
        continue
      vals = fire.split(",")
      latitude = float(vals[0])
      longitude = float(vals[1])
      confid = int(vals[2])
      rowValue = [(latitude,longitude),confid]
      cur.insertRow(rowValue)
      print "Record number " + str(cntr) + " written to feature class"
      #arcpy.AddMessage("Record number" + str(cntr) + " written to feature class")
      cntr = cntr + 1</pre></div></li><li class="listitem">Add the <code class="literal">except</code> block to print any errors that may occur:<div class="informalexample"><pre class="programlisting">except Exception as e:
  print e.message</pre></div></li><li class="listitem">Add a <code class="literal">finally</code> block to close the text file:<div class="informalexample"><pre class="programlisting">finally:
  f.close()</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy, os

arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"
f = open("C:/ArcpyBook/Ch9/WildfireData/NorthAmericaWildfires_2007275.txt","r")
lstFires = f.readlines()
try:
  with da.InsertCursor("FireIncidents",("SHAPE@XY","CONFIDENCEVALUE")) as cur:
    cntr = 1
    for fire in lstFires:
      if 'Latitude' in fire:
        continue
      vals = fire.split(",")
      latitude = float(vals[0])
      longitude = float(vals[1])
      confid = int(vals[2])
      rowValue = [(latitude,longitude),confid]
      cur.insertRow(rowValue)
      print "Record number " + str(cntr) + " written to feature class"
      #arcpy.AddMessage("Record number" + str(cntr) + " written to feature class")
      cntr = cntr + 1
except Exception as e:
  print e.message
finally:
  f.close()</pre></div></li><li class="listitem">Save and <a id="id656" class="indexterm"/><a id="id657" class="indexterm"/>run the script. You should see messages being written to the output window as the script runs:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Record number: 406 written to feature class</strong></span>
<span class="strong"><strong>Record number: 407 written to feature class</strong></span>
<span class="strong"><strong>Record number: 408 written to feature class</strong></span>
<span class="strong"><strong>Record number: 409 written to feature class</strong></span>
<span class="strong"><strong>Record number: 410 written to feature class</strong></span>
<span class="strong"><strong>Record number: 411 written to feature class</strong></span>
</pre></div></li><li class="listitem">Open <code class="literal">ArcMap</code> and add the <code class="literal">FireIncidents</code> feature class to the table of contents. The points should be visible, as shown in the following screenshot:<div class="mediaobject"><img src="images/4445_09_3.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec165"/>How it works…</h2></div></div></div><p>Some <a id="id658" class="indexterm"/>
<a id="id659" class="indexterm"/>additional explanation may be needed here. The <code class="literal">lstFires</code> variable contains a list of all the wildfires that were contained in the comma-delimited text file. The <code class="literal">for</code> statement will loop through each of these records one by one, inserting each individual record into the <code class="literal">fire</code> variable. We also include an <code class="literal">if</code> statement that is used to skip the first record in the file, which serves as the header. As I explained earlier, we then pull out the individual latitude, longitude, and confidence value items from the <code class="literal">vals</code> variable, which is just a Python list object and assign them to variables called <code class="literal">latitude</code>, <code class="literal">longitude</code>, and <code class="literal">confid</code>. We then place these values into a new list variable called <code class="literal">rowValue</code> in the order that we defined when we created <code class="literal">InsertCursor</code>. That is, the latitude and longitude pair should be placed first, followed by the confidence value. Finally, we call the <code class="literal">insertRow()</code> function on the <code class="literal">InsertCursor</code> object assigned to the variable <code class="literal">cur</code>, passing in the new <code class="literal">rowValue</code> variable. We close by printing a message that indicates the progress of the script and also creating our <code class="literal">except</code> and <code class="literal">finally</code> blocks to handle errors and close the text file. Placing the <code class="literal">file.close()</code> method in the <code class="literal">finally</code> block ensures that it will execute, and close the file, even if there is an error in the previous try statement.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Updating rows with an UpdateCursor"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec66"/>Updating rows with an UpdateCursor</h1></div></div></div><p>If you need to edit or delete rows from a table or feature class, you can use <code class="literal">UpdateCursor</code>. As is the case with <code class="literal">InsertCursor</code>, the contents of <code class="literal">UpdateCursor</code> can be limited through the use of a <code class="literal">where</code> clause.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec166"/>Getting ready</h2></div></div></div><p>The <code class="literal">UpdateCursor()</code> function<a id="id660" class="indexterm"/>
<a id="id661" class="indexterm"/> can be used to either update or delete rows in a table or feature class. The returned <a id="id662" class="indexterm"/>cursor places a lock on the data, which will automatically be released if used inside a Python <code class="literal">with</code> statement. An <code class="literal">UpdateCursor</code> object is returned from a call to this method. </p><p>The <code class="literal">UpdateCursor</code> object<a id="id663" class="indexterm"/> places a lock on the data while it's being edited or deleted. If the cursor is used inside a Python <code class="literal">with</code> statement, the lock will automatically be freed after the data has been processed. This hasn't always been the case. Previous versions of cursors were required to be manually released using the Python <code class="literal">del</code> statement. Once an instance of <code class="literal">UpdateCursor</code> has been obtained, you can then call the <code class="literal">updateCursor()</code> method to update records in tables or feature classes and the <code class="literal">deleteRow()</code> method to delete a row. </p><p>In this recipe, you're going to write a script that updates each feature in the <code class="literal">FireIncidents</code> feature class by assigning a value of <code class="literal">poor</code>, <code class="literal">fair</code>, <code class="literal">good</code>, or <code class="literal">excellent</code> to a new field that is more descriptive of the confidence values using an <code class="literal">UpdateCursor</code>. Prior to updating the records, your script will add a new field to the <code class="literal">FireIncidents</code> feature class.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec167"/>How to do it…</h2></div></div></div><p>Follow these steps to create an <code class="literal">UpdateCursor</code> object that will be used to edit rows in a feature class:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE and create a new script.</li><li class="listitem">Save the script to <code class="literal">c:\ArcpyBook\Ch9\UpdateWildfires.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> and <code class="literal">os</code> modules:<div class="informalexample"><pre class="programlisting">import arcpy,os</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"</pre></div></li><li class="listitem">Start a <code class="literal">try</code> block:<div class="informalexample"><pre class="programlisting">try:</pre></div></li><li class="listitem">Add a new field called <code class="literal">CONFID_RATING</code> to the <code class="literal">FireIncidents</code> feature class. Make sure to indent inside the <code class="literal">try</code> statement:<div class="informalexample"><pre class="programlisting">arcpy.AddField_management("FireIncidents","CONFID_RATING","TEXT","10")
print "CONFID_RATING field added to FireIncidents"</pre></div></li><li class="listitem">Create a new instance of <code class="literal">UpdateCursor</code> inside a <code class="literal">with</code> block:<div class="informalexample"><pre class="programlisting">with arcpy.da.UpdateCursor("FireIncidents",("CONFIDENCEVALUE","CONFID_RATING")) as cursor:</pre></div></li><li class="listitem">Create a<a id="id664" class="indexterm"/><a id="id665" class="indexterm"/> counter variable that will be used to print the progress of the script. Make sure you indent this line of code and all the lines of code to follow inside the <code class="literal">with</code> block:<div class="informalexample"><pre class="programlisting">cntr = 1</pre></div></li><li class="listitem">Loop through each of the rows in the <code class="literal">FireIncidents</code> fire class. Update the <code class="literal">CONFID_RATING</code> field according to the following guidelines: <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Confidence value 0 to 40 = <code class="literal">POOR</code></li><li class="listitem" style="list-style-type: disc">Confidence value 41 to 60 = <code class="literal">FAIR</code></li><li class="listitem" style="list-style-type: disc">Confidence value 61 to 85 = <code class="literal">GOOD</code></li><li class="listitem" style="list-style-type: disc">Confidence value 86 to 100 = <code class="literal">EXCELLENT</code><div class="informalexample"><pre class="programlisting">for row in cursor:
      # update the confid_rating field
      if row[0] &lt;= 40:
        row[1] = 'POOR'
        cursor.updateRow(row)
      elif row[0] &gt; 40 and row[0] &lt;= 60:
        row[1] = 'FAIR'
        cursor.updateRow(row)
      elif row[0] &gt; 60 and row[0] &lt;= 85:
        row[1] = 'GOOD'
        cursor.updateRow(row)
      else:
        row[1] = 'EXCELLENT'
        cursor.updateRow(row)
print "Record number " + str(cntr) + " updated"
cntr = cntr + 1</pre></div></li></ul></div></li><li class="listitem">Add the <code class="literal">except</code> block to print any errors that may occur:<div class="informalexample"><pre class="programlisting">except Exception as e:
  print e.message</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy, os

arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"
try:
  #create a new field to hold the values
  arcpy.AddField_management("FireIncidents","CONFID_RATING","TEXT","10")
  print "CONFID_RATING field added to FireIncidents"
  with arcpy.da.UpdateCursor("FireIncidents",("CONFIDENCEVALUE","CONFID_RATING")) as cursor:
    cntr = 1
    for row in cursor:
      # update the confid_rating field
      if row[0] &lt;= 40:
        row[1] = 'POOR'
      elif row[0] &gt; 40 and row[0] &lt;= 60:
        row[1] = 'FAIR'
      elif row[0] &gt; 60 and row[0] &lt;= 85:
        row[1] = 'GOOD'
      else:
        row[1] = 'EXCELLENT'
      cursor.updateRow(row)			
print "Record number " + str(cntr) + " updated"
      cntr = cntr + 1
except Exception as e:
  print e.message</pre></div></li><li class="listitem">Save<a id="id666" class="indexterm"/><a id="id667" class="indexterm"/> and run the script. You should see messages being written to the output window as the script runs:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Record number 406 updated</strong></span>
<span class="strong"><strong>Record number 407 updated</strong></span>
<span class="strong"><strong>Record number 408 updated</strong></span>
<span class="strong"><strong>Record number 409 updated</strong></span>
<span class="strong"><strong>Record number 410 updated</strong></span>
</pre></div></li><li class="listitem">Open <code class="literal">ArcMap</code> and add the <code class="literal">FireIncidents</code> feature class. Open the attribute table and you should see that a new <code class="literal">CONFID_RATING</code> field has been added and populated by <code class="literal">UpdateCursor</code>:<div class="mediaobject"><img src="images/4445_09_4.jpg" alt="How to do it…"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>When you insert, update, or delete data in cursors, the changes are permanent and can't be undone if you're working outside an edit session. However, with the new edit session functionality provided by ArcGIS 10.1, you can now make these changes inside an edit session to avoid these problems. We'll cover edit sessions soon. </p></div></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec168"/>How it works…</h2></div></div></div><p>In this case, <a id="id668" class="indexterm"/>
<a id="id669" class="indexterm"/>we've used <code class="literal">UpdateCursor</code> to update each of the features in a feature class. We first used the <code class="literal">Add Field</code> tool to add a new field called <code class="literal">CONFID_RATING</code>, which will hold new values that we assign based on values found in another field. The groups are poor, fair, good, and excellent, and are based on numeric values found in the <code class="literal">CONFIDENCEVALUE</code> field. We then created a new instance of <code class="literal">UpdateCursor</code> based on the <code class="literal">FireIncidents</code> feature class, and returned the two fields mentioned previously. The script then loops through each of the features and assigns a value of poor, fair, good, or excellent to the <code class="literal">CONFID_RATING</code> field (<code class="literal">row[1]</code>), based on the numeric value found in <code class="literal">CONFIDENCEVALUE</code>. A Python <code class="literal">if</code>/<code class="literal">elif</code>/<code class="literal">else</code> structure is used to control the flow of the script based on the numeric value. The value for <code class="literal">CONFID_RATING</code> is then committed to the feature class by passing in the row variable into the <code class="literal">updateRow()</code> method.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Deleting rows with an UpdateCursor"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec67"/>Deleting rows with an UpdateCursor</h1></div></div></div><p>In addition to being used to edit rows in a table or feature class, an <code class="literal">UpdateCursor</code> can also be used to delete rows. Please keep in mind that when rows are deleted outside an edit session, the changes are permanent. </p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec169"/>Getting ready</h2></div></div></div><p>In addition to <a id="id670" class="indexterm"/>
<a id="id671" class="indexterm"/>updating records, <code class="literal">UpdateCursor</code> can also delete records from a table or feature class. The <code class="literal">UpdateCursor</code> object is created in the same way in either case, but instead of calling <code class="literal">updateRow()</code>, you call <code class="literal">deleteRow()</code>
<a id="id672" class="indexterm"/> to delete a record. You can also apply a <code class="literal">where</code> clause to <code class="literal">UpdateCursor</code>, to limit the records returned. In this recipe, we'll use an <code class="literal">UpdateCursor</code> object that has been filtered using a <code class="literal">where</code> clause to delete records from our <code class="literal">FireIncidents</code> feature class.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec170"/>How to do it…</h2></div></div></div><p>Follow these steps to create an <code class="literal">UpdateCursor</code> object that will be used delete rows from a feature class:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE and create a new script.</li><li class="listitem">Save the script to <code class="literal">c:\ArcpyBook\Ch9\DeleteWildfires.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> and <code class="literal">os</code> modules:<div class="informalexample"><pre class="programlisting">import arcpy,os</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"</pre></div></li><li class="listitem">Start a <code class="literal">try</code> block:<div class="informalexample"><pre class="programlisting">try:</pre></div></li><li class="listitem">Create a new instance of <code class="literal">UpdateCursor</code> inside a <code class="literal">with</code> block:<div class="informalexample"><pre class="programlisting">with arcpy.da.UpdateCursor("FireIncidents",("CONFID_RATING"),'[CONFID_RATING] = \'POOR\'') as cursor:</pre></div></li><li class="listitem">Create a counter variable that will be used to print the progress of the script. Make sure you indent this line of code and all the lines of code to follow inside the <code class="literal">with</code> block:<div class="informalexample"><pre class="programlisting">cntr = 1</pre></div></li><li class="listitem">Delete the returned rows by calling the <code class="literal">deleteRow()</code> method. This is done by looping through the returned cursor and deleting the rows one at a time:<div class="informalexample"><pre class="programlisting">for row in cursor:
  cursor.deleteRow()
     print "Record number " + str(cntr) + " deleted"
     cntr = cntr + 1</pre></div></li><li class="listitem">Add the <code class="literal">except</code> block to print any errors that may occur:<div class="informalexample"><pre class="programlisting">except Exception as e:
  print e.message</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy, os

arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"
try:
  with arcpy.da.UpdateCursor("FireIncidents",("CONFID_RATING"),'[CONFID_RATING] = \'POOR\'') as cursor:
    cntr = 1
    for row in cursor:
      cursor.deleteRow()
      print "Record number " + str(cntr) + " deleted"
      cntr = cntr + 1
except Exception as e:
  print e.message</pre></div></li><li class="listitem">Save and <a id="id673" class="indexterm"/><a id="id674" class="indexterm"/>run the script. You should see messages being written to the output window as the script runs. 37 records should be deleted from the <code class="literal">FireIncidents</code> feature class:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Record number 1 deleted</strong></span>
<span class="strong"><strong>Record number 2 deleted</strong></span>
<span class="strong"><strong>Record number 3 deleted</strong></span>
<span class="strong"><strong>Record number 4 deleted</strong></span>
<span class="strong"><strong>Record number 5 deleted</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec171"/>How it works…</h2></div></div></div><p>Rows from feature classes and tables can be deleted using the <code class="literal">deleteRow()</code> method on <code class="literal">UpdateCursor</code>. In this recipe, we used a <code class="literal">where</code> clause in the constructor of  <code class="literal">UpdateCursor</code> to limit the records returned to only those features with a <code class="literal">CONFID_RATING</code> of <code class="literal">POOR</code>. We then looped through the features returned in the cursor and called the <code class="literal">deleteRow()</code> method to delete the row from the feature class.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Inserting and updating rows inside an edit session"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec68"/>Inserting and updating rows inside an edit session</h1></div></div></div><p>As I've mentioned throughout the chapter, inserts, updates, or deletes to a table or feature class done outside an edit session are permanent. They can't be undone. Edit sessions give you much more flexibility for rolling back any unwanted changes.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec172"/>Getting ready</h2></div></div></div><p>Up until now, we've <a id="id675" class="indexterm"/>
<a id="id676" class="indexterm"/>
<a id="id677" class="indexterm"/>
<a id="id678" class="indexterm"/>used insert and update cursors to add, edit, and delete data from feature classes and tables. These changes have been permanent as soon as the script was executed and can't be undone. The new <code class="literal">Editor</code> class in the Data Access module supports the ability to create edit sessions and operations. With edit sessions, changes applied to feature classes or tables are temporary until permanently applied with a specific method call. This is the same functionality provided by the <code class="literal">Edit</code> toolbar in ArcGIS Desktop. </p><p>Edit sessions begin with a call to <code class="literal">Editor.startEditing()</code>, which initiates the session. Inside the session, you then start an operation with the <code class="literal">Editor.startOperation()</code> method. From within this operation, you then perform various operations that perform edits on your data. These edits can also be subject to undo, redo, and abort operations for rolling back, rolling forward, and aborting your editing operations. After the operations have been completed, you then call the <code class="literal">Editor.stopOperation()</code> method followed by <code class="literal">Editor.stopEditing()</code>. Sessions can be ended without saving changes. In this event, changes are not permanently applied. An overview of this process is provided in the following screenshot:</p><div class="mediaobject"><img src="images/4445OT_09_05.jpg" alt="Getting ready"/></div><p>Edit sessions can also be ended without saving changes. In this event, changes are not permanently applied. Edit sessions also allow for operations to be applied inside the session and then either applied permanently to the database or rolled back. In addition, the <code class="literal">Editor</code> class also supports undo and redo operations. </p><p>The following <a id="id679" class="indexterm"/>
<a id="id680" class="indexterm"/>
<a id="id681" class="indexterm"/>
<a id="id682" class="indexterm"/>code example shows the full edit session stack including the creation of the <code class="literal">Editor</code> object, the beginning of an edit session and an operation, edits to the data (an insert in this case), stopping the operation, and finally the end of the edit session by saving the data:</p><div class="informalexample"><pre class="programlisting">edit = arcpy.da.Editor('Database Connections/Portland.sde')
edit.startEditing(False)
edit.startOperation()
with arcpy.da.InsertCursor("Portland.jgp.schools",("SHAPE","Name")) as cursor:
  cursor.insertRow([7642471.100, 686465.725), 'New School'])
edit.stopOperation()
edit.stopEditing(True)</pre></div><p>The <code class="literal">Editor</code> class can be used with personal, file, and ArcSDE geodatabases. In addition, sessions can also be started and stopped on versioned databases. You are limited to editing only a single workspace at a time, and this workspace is specified in the constructor for the <code class="literal">Editor</code> object simply by passing in a string that references the workspace. Once created, this <code class="literal">Editor</code> object then has access to all the methods for starting, stopping, and aborting operations, and performing undo and redo operations. </p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec173"/>How to do it…</h2></div></div></div><p>Follow these steps to wrap <code class="literal">UpdateCursor</code> inside an edit session:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE.</li><li class="listitem">Open the <code class="literal">c:\ArcpyBook\Ch9\UpdateWildfires.py</code> script and save it to a new script called <code class="literal">c:\ArcpyBook\Ch9\EditSessionUpdateWildfires.py</code>.</li><li class="listitem">We're going to make several alterations to this existing script that updates values in the <code class="literal">CONFID_RATING</code> field.</li><li class="listitem">Remove the following lines of code:<div class="informalexample"><pre class="programlisting">arcpy.AddField_management("FireIncidents","CONFID_RATING","TEXT","10")
print "CONFID_RATING field added to FireIncidents"</pre></div></li><li class="listitem">Create an instance of the <code class="literal">Editor</code> class and start an edit session. These lines of code should be placed just inside the <code class="literal">try</code> block:<div class="informalexample"><pre class="programlisting">edit = arcpy.da.Editor('C:\ArcpyBook\data\CityOfSanAntonio.gdb')
edit.startEditing(True)</pre></div></li><li class="listitem">Alter the <code class="literal">if</code> statement so that it appears as follows:<div class="informalexample"><pre class="programlisting">if row[0] &gt; 40 and row[0] &lt;= 60:
  row[1] = 'GOOD'
elif row[0] &gt; 60 and row[0] &lt;= 85:
  row[1] = 'BETTER'
else:
  row[1] = 'BEST'</pre></div></li><li class="listitem">End the<a id="id683" class="indexterm"/><a id="id684" class="indexterm"/><a id="id685" class="indexterm"/><a id="id686" class="indexterm"/> edit session and save edits. Place this line of code just below the counter increment:<div class="informalexample"><pre class="programlisting">edit.stopEditing(True)</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy, os

arcpy.env.workspace = "C:/ArcpyBook/Ch9/WildfireData/WildlandFires.mdb"
try:
  edit = arcpy.da.Editor('C:\ArcpyBook\data\CityOfSanAntonio.gdb')
  edit.startEditing(True)
  with arcpy.da.UpdateCursor("FireIncidents",("CONFIDENCEVALUE","CONFID_RATING")) as cursor:
    cntr = 1
    for row in cursor:
      # update the confid_rating field
      if row[0] &gt; 40 and row[0] &lt;= 60:
        row[1] = 'GOOD'
      elif row[0] &gt; 60 and row[0] &lt;= 85:
        row[1] = 'BETTER'
      else:
        row[1] = 'BEST'
      cursor.updateRow(row)
      print "Record number " + str(cntr) + " updated"
      cntr = cntr + 1
  edit.stopEditing(True)
except Exception as e:
  print e.message</pre></div></li><li class="listitem">Save and run the script.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec174"/>How it works…</h2></div></div></div><p>Edit <a id="id687" class="indexterm"/>
<a id="id688" class="indexterm"/>
<a id="id689" class="indexterm"/>
<a id="id690" class="indexterm"/>operations should take place inside an edit session, which can be initiated with the <code class="literal">Editor.startEditing()</code> method. The <code class="literal">startEditing()</code> method<a id="id691" class="indexterm"/> takes two optional parameters including <code class="literal">with_undo</code> and <code class="literal">multiuser_mode</code>. The <code class="literal">with_undo</code> parameter<a id="id692" class="indexterm"/> accepts a Boolean value of <code class="literal">true</code> or <code class="literal">false</code>, with a default of <code class="literal">true</code>. This creates an undo/redo stack when set to <code class="literal">true</code>. The <code class="literal">multiuser_mode</code> parameter<a id="id693" class="indexterm"/> defaults to <code class="literal">true</code>. When <code class="literal">false</code>, you have full control of editing a non-versioned or versioned dataset. If your dataset is non-versioned and you use <code class="literal">stopEditing(False)</code>, your edits will not be committed. Otherwise, if set to <code class="literal">true</code>, your edits will be committed. The <code class="literal">Editor.stopEditing()</code> method takes a single Boolean value of <code class="literal">true</code> or <code class="literal">false</code>, indicating whether changes should be saved or not. This defaults to <code class="literal">true</code>.</p><p>The <code class="literal">Editor</code> class supports undo and redo operations. We'll first look at undo operations. During an edit session, various edit operations can be applied. In the event that you need to undo a previous operation, a call to <code class="literal">Editor.undoOperation()</code> will remove the most previous edit operation in the stack. This is illustrated as follows:</p><div class="mediaobject"><img src="images/4445OT_09_06.jpg" alt="How it works…"/></div><p>Redo operations, initiated by the <code class="literal">Editor.redoOperation()</code> method, will redo an operation that was <a id="id694" class="indexterm"/>
<a id="id695" class="indexterm"/>
<a id="id696" class="indexterm"/>
<a id="id697" class="indexterm"/>previously undone. This is illustrated as follows:</p><div class="mediaobject"><img src="images/4445OT_09_07.jpg" alt="How it works…"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Reading geometry from a feature class"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec69"/>Reading geometry from a feature class</h1></div></div></div><p>There may be times when you need to retrieve the geometric definition of features in a feature class. ArcPy provides the ability to read this information through various objects.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec175"/>Getting ready</h2></div></div></div><p>In ArcPy, feature <a id="id698" class="indexterm"/>
<a id="id699" class="indexterm"/>classes have associated geometry objects including <code class="literal">Polygon</code>, <code class="literal">Polyline</code>, <code class="literal">PointGeometry</code>, and <code class="literal">MultiPoint</code> that you can access from your cursors. These objects refer to the <code class="literal">shape</code> field in the attribute table for a feature class. You can read the geometries of each feature in a feature class through these objects.</p><p>Polyline and polygon feature classes are composed of features containing multiple parts. You can use the <code class="literal">partCount</code> property to return the number of parts per feature and then use <code class="literal">getPart()</code> for each part in the feature to loop through each of the points and pull out the coordinate information. Point feature classes are composed of one <code class="literal">PointGeometry</code> object per feature that contains the coordinate information for each point. </p><p>In this recipe, you will use a <code class="literal">SearchCursor</code> and <code class="literal">Polygon</code> object to read the geometry of a polygon feature class. </p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec176"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to read the geometric information from each feature in a feature class:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open IDLE and create a new script.</li><li class="listitem">Save the script to <code class="literal">c:\ArcpyBook\Ch9\ReadGeometry.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div class="informalexample"><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Set the input feature class to the <code class="literal">SchoolDistricts</code> polygon feature class:<div class="informalexample"><pre class="programlisting">infc = "c:/ArcpyBook/data/CityOfSanAntonio/SchoolDistricts"</pre></div></li><li class="listitem">Create a <code class="literal">SearchCursor</code> object with the input feature class, and return the <code class="literal">ObjectID</code> and <code class="literal">Shape</code> fields. The <code class="literal">Shape</code> field contains the geometry for each feature. The cursor will be created inside a <code class="literal">for</code> loop that we'll use to iterate through all the features in the feature class:<div class="informalexample"><pre class="programlisting">for row in arcpy.da.SearchCursor(infc, ["OID@", "SHAPE@"]):
Print the object id of each feature.  
# Print the current ID
  print("Feature {0}:".format(row[0]))
  partnum = 0</pre></div></li><li class="listitem">Use a <code class="literal">for</code> loop to loop through each part of the feature:<div class="informalexample"><pre class="programlisting">  # Step through each part of the feature
  for part in row[1]:
    # Print the part number
    print("Part {0}:".format(partnum))</pre></div></li><li class="listitem">Use a <code class="literal">for</code> loop to loop through each vertex in each part and print the x and y coordinates:<div class="informalexample"><pre class="programlisting">    # Step through each vertex in the feature
    #
    for pnt in part:
      if pnt:
        # Print x,y coordinates of current point
        #
        print("{0}, {1}".format(pnt.X, pnt.Y))
      else:
        # If pnt is None, this represents an interior ring
        #
        print("Interior Ring:")
    partnum += 1</pre></div></li><li class="listitem">Save <a id="id700" class="indexterm"/><a id="id701" class="indexterm"/>and run the script. You should see the following output as the script writes the information for each feature, each part of the feature, and the x and y coordinates that define each part:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Feature 1:</strong></span>
<span class="strong"><strong>Part 0:</strong></span>
<span class="strong"><strong>-98.492224986, 29.380866971</strong></span>
<span class="strong"><strong>-98.489300049, 29.379610054</strong></span>
<span class="strong"><strong>-98.486967023, 29.378995028</strong></span>
<span class="strong"><strong>-98.48503096, 29.376808947</strong></span>
<span class="strong"><strong>-98.481447988, 29.375624018</strong></span>
<span class="strong"><strong>-98.478799041, 29.374304981</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec177"/>How it works…</h2></div></div></div><p>We initially created a <code class="literal">SearchCursor</code> object to hold the contents of our feature class. After this, we looped through each row in the cursor using a <code class="literal">for</code> loop. For each row, we looped through all the parts of the geometry. Remember that polyline and polygon features are composed of two or more parts. For each part, we also returned the points associated with each <a id="id702" class="indexterm"/>
<a id="id703" class="indexterm"/>part and we printed the <code class="literal">x</code> and <code class="literal">y</code> coordinates of each point. </p></div></div></div>
</body></html>