<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Publishing the Map Online</h1></div></div></div><p>In this chapter, we will cover the QGIS Cloud service, a powerful map hosting platform, and you will learn how to use it to share your maps with others by publishing them on the Internet. We will cover all the necessary steps, such as creating a QGIS Cloud account, preparing your maps for publishing, filling metadata, restricting access to information, and publishing the map. Also, you will learn how to use this published map from a web browser, QGIS, and other desktop GISes.</p><p>In this chapter, we will go through the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Registering for the QGIS Cloud service</li><li class="listitem">The QGIS Cloud plugin</li><li class="listitem">Creating a database</li><li class="listitem">Publishing the map</li><li class="listitem">Viewing your map in QGIS and a browser</li><li class="listitem">Deleting unused maps</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Registering for the QGIS Cloud service</h1></div></div></div><p>QGIS Cloud is a cloud hosting <a id="id276" class="indexterm"/>service, developed and maintained by Sourcepole AG. Using this service, we can easily publish maps, share them with others, and even modify data—all this without any special knowledge, such as server setup and administration.</p><p>QGIS Cloud is built using open source technologies. To store vector data, it uses PostgreSQL/PostGIS databases, maps rendered with the QGIS server, and a web viewer based on QGIS Web Client. As a result, it integrates very well with desktop QGIS. Layers stored on the cloud can be loaded and edited with QGIS. A published map will have the same look and feel as a local map created in QGIS.</p><p>First, we need to create an account. This can<a id="id277" class="indexterm"/> be done with these simple steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open your browser and go to <a class="ulink" href="https://qgiscloud.com">https://qgiscloud.com</a>.</li><li class="listitem">Click on the <strong>Sign Up</strong> button on the main page.</li><li class="listitem">Fill in and submit the registration form. You will need to provide a valid e-mail address and password.</li><li class="listitem">After submitting the form, you will get a confirmation e-mail, with confirmation instructions. Confirm your account by visiting the link given in the e-mail.</li></ol><div></div><p>That's all! Now you<a id="id278" class="indexterm"/> have a QGIS Cloud account with a free plan. This plan allows you to publish an unlimited number of public maps, create five PostGIS databases, and upload up to 50 MB of data.</p><div><h3 class="title"><a id="note18"/>Note</h3><p>If you need more space for data, want to restrict access to your maps, or need some other special features, consider switching to one of the paid plans available. These plans, and the options<a id="id279" class="indexterm"/> they provide, are listed at <a class="ulink" href="https://qgiscloud.com/en/pages/plans">https://qgiscloud.com/en/pages/plans</a>.</p></div><p>You can also open the QGIS Cloud sign-up page directly from the QGIS Cloud plugin, if it is already installed. Just activate the plugin and click on the <strong>Signup</strong> link under the <strong>Account</strong> or <strong>Services</strong> tab. The corresponding page will open in your web browser.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec31"/>The QGIS Cloud plugin</h1></div></div></div><p>The <strong>QGIS Cloud plugin</strong><a id="id280" class="indexterm"/> provides a user-friendly interface for publishing your data and maps with QGIS Cloud hosting. As it is a third-party plugin, we first need to install it.</p><p>If you have a proxy server, it is necessary to configure it first. <strong>Plugin Manager</strong> uses the same proxy settings as QGIS, so all you need to do is to go to <strong>Settings</strong> | <strong>Options</strong> and set up a proxy in the <strong>Network</strong> tab:</p><div><ol class="orderedlist arabic"><li class="listitem">Start QGIS and open <strong>Plugin Manager</strong> by going to <strong>Plugins</strong> | <strong>Manage and Install Plugins</strong>. Wait while QGIS receives a list of plugins from the repository.</li><li class="listitem">Switch to the <strong>All</strong> tab and start typing <code class="literal">cloud</code> in the <strong>Search</strong> field in order to filter the list of plugins, as shown in this screenshot:<div><img src="img/image00410.jpeg" alt="The QGIS Cloud plugin"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Then, select the plugin and click on the <strong>Install plugin</strong> button. The download will take <a id="id281" class="indexterm"/>some time, so be patient. When it completes, you will see a message bar with the confirmation of the download, and you can now close <strong>Plugin Manager</strong>. More information about installing plugins can be found in the <em>Extending functionality through plugins</em> section of <a class="link" title="Chapter 1. Handling Your Data" href="part0014.xhtml#aid-DB7S2">Chapter 1</a>, <em>Handling Your Data</em>.</li></ol><div></div><p>After installing, the QGIS Cloud plugin will be available in the <strong>Plugins</strong> menu. QGIS Cloud plugin also puts button <img src="img/image00411.jpeg" alt="The QGIS Cloud plugin"/> in the <strong>Plugins</strong> toolbar and creates a <strong>QGIS Cloud</strong> floating panel. By default, this panel is docked on the left side of QGIS's main window.</p><p>Let's look at the plugin's interface:</p><div><img src="img/image00412.jpeg" alt="The QGIS Cloud plugin"/></div><p style="clear:both; height: 1em;"> </p><p>The plugin panel has<a id="id282" class="indexterm"/> four tabs:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Services</strong>: This is used to<a id="id283" class="indexterm"/> publish maps and update already published maps. Initially, this tab contains a short description of the plugin and the service itself, with links to the hosting website and its sign-up page. After publishing the map, you will find here links to the just published map (both desktop and mobile viewers) and the URL of the WMS service with your map.</li><li class="listitem"><strong>Upload Data</strong>: This allows you to upload local data to the QGIS Cloud database and publish the map. Here, we can select the database to be used, adjust the table names before publishing, and upload our local data to QGIS Cloud.</li><li class="listitem"><strong>Account</strong>: This is used for authentication and account management. With this tab, you can register for QGIS Cloud if you have no account yet. Also we can create databases and delete them here, if necessary.</li><li class="listitem"><strong>About</strong>: Here, you will find information about the plugin's authors, QGIS Cloud support contacts, and the plugin version. This information will be useful in the event<a id="id284" class="indexterm"/> of problems.</li></ul></div><p>Now, switch to the <strong>Account</strong> tab of the <strong>QGIS Cloud</strong> panel, click on <strong>Login</strong>, and use your user name and password<a id="id285" class="indexterm"/> to log in. This may take some time, as the plugin needs to interact with the QGIS Cloud server. After a successful login, a message bar pops up, and you will see in the plugin panel information about your current plan, used/free disk space (if you already have databases), and a list of existing databases, if any.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Creating a database</h1></div></div></div><p>QGIS Cloud stores all your <a id="id286" class="indexterm"/>geodata in PostgreSQL/PostGIS databases, so it is necessary to create at least one database for your data before uploading any layers and publishing the map.</p><p>To create a new database, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start QGIS and activate the QGIS Cloud plugin, if it is not yet activated.</li><li class="listitem">Switch to the <strong>Account</strong> tab in the <strong>QGIS Cloud</strong> panel and log in using your username and password.</li><li class="listitem">Click on the <strong>Create database</strong> button at the bottom of the <strong>Account</strong> tab and wait until the operation completes.</li></ol><div></div><p>Database creation is a time-consuming operation, so be patient. When it's done, you will see a new database with a random name in the list of available databases. Also, the plugin registered this database in QGIS, so it can be used like any other PostGIS database, for example, for loading and editing layers from it in QGIS.</p><div><h3 class="title"><a id="note19"/>Note</h3><p>If you are behind a firewall and/or have problems with creating the database, contact QGIS Cloud support via e-mail: <code class="email">&lt;<a class="email" href="mailto:support@qgiscloud.com">support@qgiscloud.com</a>&gt;</code>.</p></div><p>In the event that this PostGIS connection—which is created by the plugin—is removed from QGIS by accident, it can be restored manually. Just log in to QGIS Cloud using the plugin and hold the cursor over the database name. In the tooltip, you will find all of the information (host, port number, database username, and password) needed for creating the connection. We can also use this information to connect to the database with other PostgreSQL clients, such as psql or pgAdmin.</p><p>Unfortunately, you cannot rename the database to something meaningful, so keep a list somewhere with information about which data is stored in each database, for future reference. Also, you can examine the database's content with the DB Manager.</p><p>For convenience, we recommend that you keep each map/project in separate databases. This introduces some disk usage overhead, as each empty database is about 11 MB in size, but such an approach also simplifies things a lot. For example, you can easily remove an unused <a id="id287" class="indexterm"/>map without losing data used in another map that is also stored in the same database. Of course, it is possible to keep many layers in a single database and use them in different maps, but this will lead to some complexity when you decide to remove some maps or layers.</p><p>Remember that you cannot create more databases than what is allowed by your plan; the same applies to using disk storage. If you need more space or databases, upgrade to another plan.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Publishing the map</h1></div></div></div><p>Now, when a new database is created, we can publish the map designed in <a class="link" title="Chapter 2. Visualizing and Styling the Data" href="part0021.xhtml#aid-K0RQ1">Chapter 2</a>, <em>Visualizing and Styling the Data</em>, on the Internet.</p><p>Let's look at our project first; it<a id="id288" class="indexterm"/> contains raster and vector layers. There are several composers as well. Before publishing the data and map, we need to decide which information should be published and what we want to keep hidden.</p><p>By default, all vector layers are published with all their attributes available for both WMS and WFS services. All composers available in the project will be published too.</p><p>If you need to keep <a id="id289" class="indexterm"/>some attributes of the layer (or layers) unpublished, it is necessary to adjust the properties of the corresponding layer (or layers).</p><div><h3 class="title"><a id="note20"/>Note</h3><p>Later, in the <em>WMS settings</em> section of this chapter, you will learn how to exclude entire layers and composers from publishing.</p></div><p>To do this, select a layer from the QGIS layer tree, right-click to open the context menu, and select <strong>Properties</strong>. In the <strong>Layer Properties</strong> dialog, go to the <strong>Fields</strong> tab, as shown in the following screenshot:</p><div><img src="img/image00413.jpeg" alt="Publishing the map"/></div><p style="clear:both; height: 1em;"> </p><p>Here, we see a table with all the layer attributes, including additional information about them (data type, field length, precision, and so on). The last two columns, <strong>WMS</strong> and <strong>WFS</strong>, control attributes' visibility when the layer is published as WMS and/or WFS layer. If you don't want to publish some attributes, just deactivate the corresponding checkboxes. Then,<a id="id290" class="indexterm"/> click on the <strong>OK</strong> button to save the changes and close the dialog. Note that the same attribute can be published with WMS and not be available via WFS, and vice versa. Go through all the vector layers, examine their attributes, and hide them if necessary.</p><p>Now it is time to think about raster layers. Unfortunately, QGIS Cloud currently allows you to upload only local vector layers; local raster layer support is not available yet. But don't be discouraged! You can use WMS services and basemaps instead.</p><p>If our raster layers are also available as a WMS service, we can safely replace the local files with WMS layers, and our map will be published without losing any data. The already added WMS layers will be published as well.</p><p>But what to do if the raster data is available only as local files and you really need a background map? Fortunately, QGIS allows you to add basemaps; all you need is to install the <strong>OpenLayers plugin</strong>. Once this plugin is installed, go to <strong>Web</strong> | <strong>OpenLayers plugin</strong> and add the desired background maps from the available list. It is possible to add several background maps, for example, OpenStreetMap and Bing, so that after publishing the project, users will be able to switch between them.</p><p>Note that it is possible to have both the types of layers in the same map—WMS and background maps. Remember, however, that the WMS layer will overlay the background map and may cover it completely. If you want to see the background map under the WMS layer, don't forget to set the transparency for the WMS layers before publishing.</p><p>Our map contains only one raster layer—the digital elevation model—which has been loaded from a local file and, as a result, cannot be published. Let's add some other raster data that will be available<a id="id291" class="indexterm"/> from the published map.</p><p>As our map contains a DEM layer, it will be good to find a suitable replacement for it. Fortunately, USGS provides access to some maps, including shaded relief, via WMS. Of course, this layer is not as detailed as our DEM, but for online maps, it is more than enough. First, we need to create a new WMS connection by following these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the <strong>Add WMS/WMTS Layer</strong> button in the <strong>Layers</strong> toolbar, or go to <strong>Layer</strong> | <strong>Add Layer</strong> | <strong>Add WMS/WMTS Layer</strong>. In the <strong>Add Layer(s) from a WM(T)S Server</strong> dialog, click on <strong>New</strong> to create a new connection. Enter <code class="literal">USGS Relief (base)</code> as <strong>Name</strong> and <a class="ulink" href="http://basemap.nationalmap.gov/arcgis/services/USGSShadedReliefOnly/MapServer/WMSServer?request=GetCapabilities&amp;service=WMS">http://basemap.nationalmap.gov/arcgis/services/USGSShadedReliefOnly/MapServer/WMSServer?request=GetCapabilities&amp;service=WMS</a> as <strong>URL</strong>, and click on <strong>OK</strong>. Select the newly added connection from the combobox and click on the <strong>Connect</strong> button.</li><li class="listitem">From the layers tree, select the first node, called <strong>USGS Shaded Relief...</strong>.</li><li class="listitem">In the <strong>Coordinate Reference Systems</strong> group, click on <strong>Change</strong>, find and select <strong>WGS 84 / Pseudo Mercator (EPSG:3857)</strong>, and click on <strong>OK</strong>.</li><li class="listitem">Click on <strong>Add</strong> and close the WMS dialog.</li><li class="listitem">Finally, move the added layer below all the vector layers, so that it will be at the bottom of the QGIS layer tree.<div><h3 class="title"><a id="note21"/>Note</h3><p>Note that this shaded relief layer contains data for a scale of 1:18000 or smaller. If you want to display relief on more detailed scales, it will be necessary to add one more layer using another <a id="id292" class="indexterm"/>WMS URL: <a class="ulink" href="http://services.nationalmap.gov/arcgis/services/USGSShadedReliefLarge/MapServer/WMSServer?request=GetCapabilities&amp;service=WMS">http://services.nationalmap.gov/arcgis/services/USGSShadedReliefLarge/MapServer/WMSServer?request=GetCapabilities&amp;service=WMS</a>.</p></div></li></ol><div></div><p>You may have noticed that we added the layer in <strong>EPSG:3857</strong> while all our vector layers are in EPSG:2263. As a result, we now have "on-the-fly" reprojection enabled, and the project CRS is EPSG:3857. This is because we will also add a background Bing map, which is available only in EPSG:3857. If you don't need a background map, it is better to use a CRS that matches the CRS of your vector data or a well-known CRS, such as <strong>WGS 84</strong> and <strong>WGS 84 / Pseudo Mercator</strong>.</p><p>Now, we will add a <a id="id293" class="indexterm"/>background map with Bing aerial images.</p><div><h3 class="title"><a id="note22"/>Note</h3><p>Note that using some background maps may violate the terms of service of those maps. Before adding any background map, check whether you are allowed to use that service with your online map and redistribute maps that contain data from that service.</p></div><p>To do this, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Install and activate the <strong>OpenLayers plugin</strong> (see the <em>Extending functionality through plugins</em> section of <a class="link" title="Chapter 1. Handling Your Data" href="part0014.xhtml#aid-DB7S2">Chapter 1</a>, <em>Handling Your Data</em>, for more details).</li><li class="listitem">Go to <strong>Web</strong> | <strong>OpenLayers plugin</strong> | <strong>Bing Maps</strong> | <strong>Bing Aerial</strong>.</li><li class="listitem">Move the newly added layer to the bottom of the QGIS layer tree, so that it will be below all other layers.</li></ol><div></div><p>If necessary, you can add more WMS layers and/or background maps, but don't overload your map by additional layers without the need to do so. Also choose which raster will be visible by default and turn the other raster layers off in order to speed up map loading. Save the project when all the changes have been implemented.</p><p>Now that our data is ready for publishing, our next step is project preparation. Of course, you can publish a map as is, but it is better to spend some time and make your map more user friendly and professional looking, especially if you plan to share it with others.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec32"/>General settings</h2></div></div></div><p>First, we fill in some <a id="id294" class="indexterm"/>metadata that will help users find our map and provide some information about it. To do this, open the <strong>Project Properties</strong> dialog by pressing <em>Ctrl</em> + <em>Shift</em> + <em>P</em>, or go to <strong>Project</strong> | <strong>Project Properties...</strong> and switch to the <strong>OWS Server</strong> tab. This tab allows us to configure the way in which our project will be processed by QGIS Server. There are many different settings here; right now, we will look at the <strong>Service capabilities</strong> group:</p><div><img src="img/image00414.jpeg" alt="General settings"/></div><p style="clear:both; height: 1em;"> </p><p>Here, we need<a id="id295" class="indexterm"/> to fill in this metadata:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Title</strong>: This is the title of the map. We select <code class="literal">Brooklyn (New York) demo map</code>.</li><li class="listitem"><strong>Organization</strong>: Here, we specify the map author or owner. Enter your name here.</li><li class="listitem"><strong>Online resource</strong>: Here, we specify the URL that should be used to access our map. Right now, we can leave it empty because the map is not published, which is why we don't know its URL. But if you are curious, here is the convention used for URL generation in QGIS Cloud: <code class="literal">http://qgiscloud.com/&lt;user_name&gt;/&lt;map_name&gt;/wms</code>. In this, <code class="literal">&lt;user_name&gt;</code> is your QGIS Cloud login and <code class="literal">&lt;map_name&gt;</code> is the filename of the published project without extension. So, suppose your login is alex and the project will be saved after uploading the data as <code class="literal">brooklyn_demo.qgs</code>. Then, the URL will be <code class="literal">http://qgiscloud.com/alex/brooklyn_demo/wms</code>.</li><li class="listitem"><strong>Person</strong>: This is the name of the person who is responsible for the published map. It is mainly used as support contact. In our case, this is the same person as specified in <strong>Organization</strong> field.</li><li class="listitem"><strong>E-Mail</strong> and <strong>Phone</strong>: These are the contact details of the responsible person. We can leave them empty or fill in only one field so that users will be able to contact the creator of the map if they have any questions or problems.</li><li class="listitem"><strong>Abstract</strong>: This is a brief description of our map and used data. It is important information, as it helps users understand the purpose and coverage of the map. Such information can also be used by metadata catalogs for the purpose of indexing and searching maps. Here is our description; you can use it as is or modify it according to your tastes:<p>A demo map of the Brooklyn district of the New York city based on the official open data from the New York open data portal <a class="ulink" href="https://data.cityofnewyork.us/">https://data.cityofnewyork.us/</a>.</p><p>Map created for Packt Publishing <em>QGIS by Example</em> book.</p></li><li class="listitem"><strong>Fees</strong>: This<a id="id296" class="indexterm"/> shows information about the fees. It can be ignored if map does not use fees.</li><li class="listitem"><strong>Access constraints</strong>: This describes the restrictions on and legal requirements for using this map. For example, it can be "For internal use only" or some copyright notice. For public maps, this field usually is empty.</li><li class="listitem"><strong>Keyword list</strong>: This is a list of keywords or short phrases that describe the map. This information helps in searching and indexing. For our map, we use these keywords; feel free to adjust them to suit your tastes:<p><code class="literal">New York, Brooklyn, QGIS by Example, demo.</code></p></li></ul></div><p>It is good practice to fill in metadata not only for the map but also for each layer in it, so that when the user looks for the available WMS or WFS layers, they will see the layers' descriptions and easily understand that a particular layer is suitable for them. Anyone will agree that working with a WMS server where layers have a title and an abstract is more comfortable than working with a server without such information.</p><p>To edit the layer's metadata, select it from the QGIS layer tree, right-click to open the context menu, and choose <strong>Properties</strong>. In the <strong>layer properties</strong> dialog, go to the <strong>Metadata</strong> tab. The most important pieces of metadata to fill in are <strong>Title</strong>, <strong>Abstract</strong>, and <strong>Keyword list</strong>. After editing the metadata, click on <strong>OK</strong> to close the dialog and save the project.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec33"/>WMS settings</h2></div></div></div><p>Now look at the <strong>WMS Capabilities</strong> group, which allows you to tune the WMS service that will be created from our map, as<a id="id297" class="indexterm"/> shown in this screenshot:</p><div><img src="img/image00415.jpeg" alt="WMS settings"/></div><p style="clear:both; height: 1em;"> </p><p>By default, the entire map will be published. If you want to make only a part of your map available via WMS, check the <strong>Advertised extent</strong> box and define the allowed extent by entering its minimum and maximum coordinates. Click on the <strong>Use Current Canvas Extent</strong> button to restrict the available extent to the current map extent.</p><p>QGIS Server, used by QGIS Cloud, implements a special extension to the WMS standard: the <a id="id298" class="indexterm"/><strong>GetPrint</strong> request. This allows you to create printed maps using one of the composers available in the project. By default, all available composers will be published and advertised for printing. If you don't need this functionality at all or want to hide some composers from users, activate the <strong>Exclude composers</strong> group and add the composers that need to be excluded to this list using the <strong>+</strong> button.</p><p>Similarly, you can hide some layers if you don't want to publish all of them. To do this, activate the <strong>Exclude layers</strong> group and add layers to exclude using the <strong>+</strong> button.</p><div><h3 class="title"><a id="note23"/>Note</h3><p>Of course, we <a id="id299" class="indexterm"/>can just remove the layers, save the project with a different name, and then publish this new project. But in this case, we will lose one major advantage—the ability to use the same project for offline and online maps.</p><p>Imagine that after publishing a map, you need to change the symbology of a layer. In the case of two different projects, you will need to keep them in sync. It is much simpler to have a single project and hide the layers by changing the settings.</p></div><p>The next important setting is <strong>CRS restrictions</strong>. By default, every layer can be loaded in any QGIS-supported<a id="id300" class="indexterm"/> <strong>coordinate reference systems</strong> (<strong>CRS</strong>). As a result, the service capabilities document becomes very large, especially when the map contains many layers. This in turn causes slow map loading in web-based viewer and desktop clients, as they have to download and parse much more data.</p><p>In real-life applications, only a small subset of coordinate reference systems is required. So, we can safely restrict the list of available CRSes without any drawbacks, and moreover speed up the loading of our map. To do this, activate <strong>CRS restrictions</strong> and add all the necessary CRSes. The <strong>Used</strong> button allows us to add the current project's CRS to the list in just one click.</p><p>If you want to enable feature highlighting on identification, don't forget to select the <strong>Add geometry to feature response</strong> checkbox. It is also possible to limit coordinate precision by adjusting its value in the <strong>GetFeatureInfo geometry precision (decimal places)</strong> field.</p><p>Finally, you can limit the size of the image returned by the GetMap request by defining the width and height in the <strong>Maximums for GetMap</strong> request and adjusting <strong>Quality for JPEG images</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec34"/>WFS settings</h2></div></div></div><p>If you want to make your <a id="id301" class="indexterm"/>data available not only as rasters but also as vectors, it is necessary to configure <strong>WFS capabilities</strong>, which are shown in the following screenshot:</p><div><img src="img/image00416.jpeg" alt="WFS settings"/></div><p style="clear:both; height: 1em;"> </p><p>All you need to do is select the layers that should be available via WFS by selecting the corresponding checkboxes in the <strong>Published</strong> column. If the layer needs to be editable, it is necessary to specify<a id="id302" class="indexterm"/> the supported operations by activating the checkboxes in the corresponding columns:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Update</strong>: The user can edit existing features (both geometry and attributes) in layers with this capability</li><li class="listitem"><strong>Insert</strong>: The user can add new features to layers with this capability</li><li class="listitem"><strong>Delete</strong>: This allows the user to delete existing features from a layer<div><h3 class="title"><a id="note24"/>Note</h3><p>Remember that with the QGIS Cloud free plan, your map will be publicly available, and anyone will be able to edit your layers. If you need to restrict access, either consider switching to other plans or don't enable editing via WFS.</p><p>Being the map owner, you can always edit published vector layers by connecting to the corresponding QGIS Cloud database via QGIS.</p></div></li></ul></div><p>When you are satisfied with all the settings, click on the <strong>Apply</strong> button to save your changes and then close the <strong>Project Properties</strong> dialog.</p><p>Now, we can publish our map. Activate the QGIS Cloud plugin, if it has not already been activated. Switch to the <strong>Account</strong> tab in the <strong>QGIS Cloud</strong> panel and log in using your username and password. First, we need to create the database where all our layers will be saved. Database creation is covered in detail in the <em>Creating a database</em> section of this chapter; return to it if necessary. We will assume that a new empty database already exists.</p><p>Switch to the <a id="id303" class="indexterm"/><strong>Upload data</strong> tab. From the <strong>Database</strong> combobox, select the database created previously. In the table below this combobox, you will see all the layers supported by QGIS Cloud that can be uploaded. If there are no layers, click on <strong>Refresh layers</strong>. If necessary, you can adjust the name of the database table used to store layer data by editing the text in the <strong>Table name</strong> column.</p><div><h3 class="title"><a id="note25"/>Note</h3><p>Note that while all other columns are editable too, you should not edit them.</p></div><p>Also verify that all the layers listed in this table have the correct CRS assigned. QGIS Cloud supports the CRSes available in the EPSG database only, so if some layers have a user-defined CRS, it is necessary to reproject them before publishing.</p><p>If <strong>Replace local layers in project</strong> is checked, the plugin will update the project by replacing all local vector layers with uploaded layers. So, your project will contain layers from the QGIS Cloud database, and you can easily edit them from QGIS. All changes in these layers will be immediately visible in the published map.</p><p>To start the data upload, click on the <strong>Upload data</strong> button. The upload will take some time, depending on the data size and speed of your Internet connection. When it completes, you will be prompted to save the updated project. We recommend that you save the published project with a different name so that you will have the project with the local data unchanged.</p><div><h3 class="title"><a id="tip20"/>Tip</h3><p>QGIS Cloud uses the name of the project file as the map name, so choose the filename of your project carefully; it's better to use something meaningful.</p></div><p>After successful data upload, a new <strong>Publish Map</strong> button will be shown. Click on it to publish your map. That's all! Now your map is available on the Internet. Switch to the <strong>Services</strong> tab to get the URLs of standard and mobile viewers, the WMS service (the same link can be used for WFS), and the web interface admin panel.</p><p>If necessary, we can easily update the published map; for example, we can change layer symbology, or hide or show some attributes or composers, and so on. To do this, just open your project containing the Cloud-based layers, make necessary changes, and then publish the map by following these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Activate the QGIS Cloud plugin, if it is not activated yet.</li><li class="listitem">Switch to the <strong>Account</strong> tab in the <strong>QGIS Cloud</strong> panel and log in using your username and password.</li><li class="listitem">Now switch to the <strong>Services</strong> tab and press the <strong>Publish Map</strong> button to publish the updated map.</li></ol><div></div><p>There is no <a id="id304" class="indexterm"/>need to upload the data again, as all of the data was uploaded previously, and our project now contains layers from the QGIS Cloud database instead of local files.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Viewing your map in QGIS and a browser</h1></div></div></div><p>A published map can<a id="id305" class="indexterm"/> be viewed in QGIS and a browser. Depending on your needs, it is better to use one or the other. A web-based viewer is a good choice if all you<a id="id306" class="indexterm"/> need is viewing and some basic GIS functionality, such as map navigation, feature<a id="id307" class="indexterm"/> identification, and printing. Also, a web-based viewer is a great way to share your map with others.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec35"/>Working with a map from a browser</h2></div></div></div><p>QGIS Cloud provides two web<a id="id308" class="indexterm"/> viewers: one for mobile devices (smartphones or tablets), and another for desktop. Both viewers provide the same basic<a id="id309" class="indexterm"/> functionality such as map navigation and changing layer visibility. Let's take a closer look at them.</p><p>The standard desktop<a id="id310" class="indexterm"/> viewer is based on QGIS Web Client and it looks like a simple GIS application that runs in the browser, as seen in the following screenshot:</p><div><img src="img/image00417.jpeg" alt="Working with a map from a browser"/></div><p style="clear:both; height: 1em;"> </p><p>There is a layer tree on the left side, where you can change the layer's visibility and enable or disable background maps, if any. On the right-hand side, we can find the <strong>Attribute Data</strong> panel (hidden by default), which is used to display information about the identified feature. The rest of<a id="id311" class="indexterm"/> the space is occupied by the map view itself.</p><p>In the preceding<a id="id312" class="indexterm"/> screenshot, you can see a toolbar with navigation buttons, the identify tool, tools for measuring length and/or area, and the <strong>Print Map</strong> button. The navigation, identify, and measuring tools work similar to the corresponding tools from QGIS.</p><p>The most interesting feature of the standard viewer is map printing. If published project contains composers, they can be used for producing printed maps. They can be used to produce printed maps. To create such a map, zoom to the area of interest using the navigation tools, and then click on <strong>Print Map</strong> button. A <strong>Print Settings</strong> dialog will appear, and a selection rectangle will be shown on the map, like this:</p><div><img src="img/image00418.jpeg" alt="Working with a map from a browser"/></div><p style="clear:both; height: 1em;"> </p><p>Define the boundaries of the region you want to print by moving and resizing the rectangle. Then use the floating <strong>Print Settings</strong> panel to select the desired map layout, scale, and<a id="id313" class="indexterm"/> resolution. Define the map rotation, if necessary. When all the settings are made, click on the <strong>Print</strong> button to generate a PDF file containing your map. The generated map will be opened in a new browser window, and can be saved on the disk for further usage.</p><p>The mobile viewer, as the name implies, is optimized for usage with mobile devices, such as tablets or smartphones.</p><div><img src="img/image00419.jpeg" alt="Working with a map from a browser"/></div><p style="clear:both; height: 1em;"> </p><p>All of the<a id="id314" class="indexterm"/> available screen area is used to display the map. The buttons on touchscreens are large and easy to use. To access the layer tree, press the button in the bottom-left corner. The buttons in the top-right corner allow you to enable location tracking and set up some other options such as map rotation, scalebar display and so on. With the mobile viewer, you have no access to the print map capability. Nonetheless, it is possible to use the map for navigation. The viewer<a id="id315" class="indexterm"/> will track your position and update the map when it changes. If necessary, it is also possible to activate map rotation so that the map can be rotated to match its north to the actual north.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec36"/>Working with a map in QGIS</h2></div></div></div><p>Web-based viewers are good if all you need is read-only access to data. A published map, when used from<a id="id316" class="indexterm"/> QGIS, gives you more functionality and<a id="id317" class="indexterm"/> flexibility.</p><div><h3 class="title"><a id="note26"/>Note</h3><p>You can use published maps not only from QGIS but also from any WMS or WFS client.</p></div><p>By default, every published map is available<a id="id318" class="indexterm"/> via the <strong>Web Map Service</strong> (<strong>WMS</strong>) protocol. So, it is possible to use a layer from it as a background layer in another map or embed it in a web page with the help of libraries such as OpenLayers and Leaflet.</p><p>To add a layer from a published map as a WMS layer to QGIS, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <strong>Add Layer(s) from a WM(T)S Server</strong> dialog using the corresponding button on the <strong>Manage Layers</strong> toolbar, or from the <strong>Layer</strong> menu (<strong>Layer</strong> | <strong>Add Layer</strong> | <strong>Add WMS/WMTS Layer...</strong>). Add a <strong>New</strong> connection.</li><li class="listitem">Enter a connection name (it's best to use something meaningful) and the URL of the map.</li><li class="listitem">Select the created connection from the list and click on <strong>Connect</strong>. A list of available published layers will appear. If the map layers have metadata filled in, you will see their titles and descriptions.</li><li class="listitem">Select the necessary layers and add them to your project.</li></ol><div></div><p>Note that you can<a id="id319" class="indexterm"/> add only layers created from your local data. Background maps, and WMS layers used in published map are not available. If you need a background map and/or WMS layers, add them by using the corresponding plugins or the QGIS core functionality.</p><p>Also, if enabled by the author, a map can be accessed via the <a id="id320" class="indexterm"/><strong>Web Feature Service</strong> (<strong>WFS</strong>) and even modified <a id="id321" class="indexterm"/>with the <strong>Web Feature Service Transactional</strong> (<strong>WFS-T</strong>) protocols. To access a map via WFS<strong>-</strong>T with QGIS, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <strong>Add WFS Layer from a Server</strong> dialog using the corresponding button in the <strong>Manage Layers</strong> toolbar, or from the <strong>Layer</strong> menu (<strong>Layer</strong> | <strong>Add Layer</strong> | <strong>Add WFS Layer...</strong>).</li><li class="listitem">Add a <strong>New</strong> connection.</li><li class="listitem">Enter a connection name (it's best to use something meaningful) and the URL of the map.</li><li class="listitem">Select the created connection from the list and click on <strong>Connect</strong>. A list of available published layers will appear.</li><li class="listitem">Select the necessary layers and add them to your project.</li></ol><div></div><p>If the selected layers have update, delete, and insert capabilities, you can edit them with QGIS just as would do with any other layer. All changes will be visible in the published map immediately.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Deleting unused maps</h1></div></div></div><p>With the passage of time, some maps become unnecessary for various reasons. If you don't need some<a id="id322" class="indexterm"/> maps and data, you will be pleased to know that it is possible to remove them and, as a result, free some disk space for new projects.</p><p>There are several ways of removing unused data: with the QGIS Cloud plugin, from the QGIS Cloud web interface, and by using DB Manager or any other PostgreSQL/PostGIS client. They work differently and complement each other.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec37"/>Deleting layers with DB Manager</h2></div></div></div><p>As we mentioned <a id="id323" class="indexterm"/>previously, QGIS Cloud uses PostgreSQL/PostGIS to store spatial data. So, we can easily connect to the database with <strong>DB Manager</strong> or any other PostgreSQL client (for example, pgAdmin) and delete unused <a id="id324" class="indexterm"/>tables.</p><p>Assuming that a connection to the QGIS Cloud database is already created, here are the necessary steps that we need to perform in order to delete layers, using the <strong>DB Manager</strong> plugin:</p><div><ol class="orderedlist arabic"><li class="listitem">Start the <strong>DB Manager</strong> plugin. As this is a core plugin and is activated by default, you can find it by going to <strong>Database</strong> | <strong>DB Manager</strong>. If the <strong>Database</strong> menu does not exist, make sure that the <strong>DB Manager</strong> plugin is enabled. More information about using QGIS plugins can be found in the <em>Extending functionality through plugins</em> section of <a class="link" title="Chapter 1. Handling Your Data" href="part0014.xhtml#aid-DB7S2">Chapter 1</a>, <em>Handling Your Data</em>.</li><li class="listitem">Expand the <strong>PostGIS</strong> item in the database tree and find your database.</li><li class="listitem">Expand the <strong>public</strong> schema and find the table you want to delete.</li><li class="listitem">Select the table and right-click to open the context menu. Select <strong>Remove</strong> to delete this table from database.</li></ol><div></div><p>Note that you also need to delete or update the corresponding maps after deleting tables. See the <em>Deleting maps from the web interface</em> section later in this chapter for more information on this.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec38"/>Deleting databases from the QGIS Cloud plugin</h2></div></div></div><p>The QGIS Cloud plugin<a id="id325" class="indexterm"/> allows you to not only create a database and publish data and maps, but also remove unused databases. To remove an existing database, simply follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Start QGIS and activate the QGIS Cloud plugin, if it is not activated.</li><li class="listitem">Switch to the <strong>Account</strong> tab in the <strong>QGIS Cloud</strong> panel, and log in using your username and password.</li><li class="listitem">In the <strong>Databases</strong> list, find the database you want to remove and select it. Click on the <strong>Delete database</strong> button and wait while the operation completes.<div><h3 class="title"><a id="note27"/>Note</h3><p>Be careful! Currently, the QGIS Cloud plugin allows you to remove only an entire database, so you will lose all of the data from other maps that are stored in the deleted database. Make sure you have backups, or look at the previous section to learn how to delete separate layers.</p></div></li></ol><div></div><p>Note that the plugin <a id="id326" class="indexterm"/>deletes the entire database, with all of the data in it. Maps created using data from this deleted database will still be listed in your account, but they will be empty. To delete these maps, we need to use the QGIS Cloud web interface, as described in the next section.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec39"/>Deleting maps from the web interface</h2></div></div></div><p>Using the web interface, we can remove only unused maps. All of the data associated with them will be<a id="id327" class="indexterm"/> kept. So, this is a supplementary method and it should be used with the methods already described.</p><p>To remove an unused map, follow<a id="id328" class="indexterm"/> these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the browser and go to the QGIS Cloud site at <a class="ulink" href="https://qgiscloud.com">https://qgiscloud.com</a>.</li><li class="listitem">Log in to your account using your username and password.</li><li class="listitem">Click on the <strong>Maps</strong> link in the menu at the top.</li><li class="listitem">Locate the map that should be removed and click on <strong>Destroy</strong>. Confirm your action in the confirmation dialog.</li></ol><div></div><p>Remember that you've deleted only the map. The data used in this map is still available in the database (provided that you haven't deleted the database first). So, if you don't need this data, it is necessary to delete the database too, unless it is being used by other maps. If you are using the same database to store data for different maps, you can delete separate layers with any PostgreSQL client, as described in the <em>Deleting layers with DB Manager</em> section.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, we covered how to publish our maps online using QGIS Cloud hosting from QGIS. We saw how to prepare projects for publishing, including specifying project metadata, restricting access to some layers and composers, hiding layer attributes, and defining allowed actions. Also, you learned how to access a published map from different programs and how to manage your QGIS Cloud account.</p><p>In the next chapter, you will start getting familiarized with the analysis capabilities of QGIS. The first analysis type you will get to know is density analysis.</p></div></body></html>