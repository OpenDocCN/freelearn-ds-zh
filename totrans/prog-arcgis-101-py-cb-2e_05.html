<html><head></head><body>
  <div><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Automating Map Production and Printing</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a list of layout elements</li><li class="listitem" style="list-style-type: disc">Assigning a unique name to layout elements</li><li class="listitem" style="list-style-type: disc">Restricting the layout elements returned by ListLayoutElements()</li><li class="listitem" style="list-style-type: disc">Updating layout element properties</li><li class="listitem" style="list-style-type: disc">Getting a list of available printers</li><li class="listitem" style="list-style-type: disc">Printing maps with PrintMap()</li><li class="listitem" style="list-style-type: disc">Exporting a map to a PDF file</li><li class="listitem" style="list-style-type: disc">Exporting a map to an image file</li><li class="listitem" style="list-style-type: disc">Creating a map book with PDFDocumentCreate() and PDFDocumentOpen()</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Introduction</h1></div></div></div><p>The <a id="id373" class="indexterm"/> <code class="literal">arcpy.mapping</code> module, released with<a id="id374" class="indexterm"/> ArcGIS 10, provides a number of capabilities related to the automation of map production. <code class="literal">arcpy.mapping</code> can be used to automate map production, build map books, export to image or PDF files, and create and manage PDF files. In this chapter, you'll learn how to use the <code class="literal">arcpy.mapping</code> module to automate various geoprocessing tasks related to map production and printing.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Creating a list of layout elements</h1></div></div></div><p>Often, the first step in a <a id="id375" class="indexterm"/>geoprocessing script that automates the production of maps is to generate a list of the available layout elements. For example, you might need to update the title of your map before printing or creating a PDF file. In this case, the title would likely be stored in a <a id="id376" class="indexterm"/> <code class="literal">text</code> element. You can generate a list of <code class="literal">text</code> elements in your map layout view and then change the title in it. The first step is to generate a list of <code class="literal">text</code> elements.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec89"/>Getting ready...</h2></div></div></div><p>In ArcMap, two views are available, namely, data view and layout view. <strong>Data view</strong>
<a id="id377" class="indexterm"/> is used to view geographic and tabular data, analyze data, symbolize layers, and manage data without regard for any particular map page size or layout. <strong>Layout view</strong> <a id="id378" class="indexterm"/> shows the map as printed on a page, and is used to create production-quality maps through the addition of map elements. These elements include map frames, layers, legends, titles, north arrows, scale bars, and title blocks. Each object in the layout is represented in <code class="literal">arcpy.mapping</code> as a layout element class. Examples of many of these layout element classes are displayed in the following screenshot:</p><div><img src="img/4445_05_1.jpg" alt="Getting ready..."/></div><p>Each element can <a id="id379" class="indexterm"/>be assigned a unique name that can then be used to access the element programmatically. This unique name is defined in ArcMap. The <code class="literal">arcpy.mapping</code> module provides a <code class="literal">ListLayoutElements()</code> function that returns a list of all these elements. In this recipe, you will learn to use the <code class="literal">ListLayoutElements()</code> function<a id="id380" class="indexterm"/> to generate a list of map layout elements.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec90"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to generate a list of layout elements:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap.</li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>) and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Generate a list of layout elements and print them to the screen if the name property is not empty:<div><pre class="programlisting">for el in mapping.ListLayoutElements(mxd):
  if el.name != '':
    print el.name</pre></div></li><li class="listitem">The entire script should appear as follows:<div><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
for el in mapping.ListLayoutElements(mxd):
  if el.name != '':
    print el.name</pre></div></li><li class="listitem">Run the script to see the following output:<div><pre class="programlisting">
<strong>Crime_Inset</strong>
<strong>Alternating Scale Bar</strong>
<strong>Legend Test Performance</strong>
<strong>Crime Legend</strong>
<strong>North Arrow</strong>
<strong>Inset_Map</strong>
<strong>Test_Performance</strong>
<strong>Crime</strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec91"/>How it works…</h2></div></div></div><p>
<code class="literal">ListLayoutElements()</code> returns<a id="id381" class="indexterm"/> a list of layout elements in the form of various layout classes. Each element can be one of the following object instances: <a id="id382" class="indexterm"/>
<code class="literal">GraphicElement</code>, <a id="id383" class="indexterm"/> <code class="literal">LegendElement</code>, <a id="id384" class="indexterm"/> <code class="literal">PictureElement</code>, <a id="id385" class="indexterm"/> <code class="literal">TextElement</code>, or<a id="id386" class="indexterm"/> <code class="literal">MapSurroundElement</code>. Each element can have a unique name. <a id="id387" class="indexterm"/>You don't have to assign a name to each element, but it is helpful to do so if you plan to access these elements programmatically in your scripts. In this script, we first made sure that the element had a name assigned to it before printing the name. This was done because ArcMap does not require that an element be assigned a name.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Assigning a unique name to layout elements</h1></div></div></div><p>It's a good practice<a id="id388" class="indexterm"/>
<a id="id389" class="indexterm"/> to assign a unique name to all your layout elements using ArcMap. This is important in the event that your geoprocessing scripts need to access a particular element to make changes. For example, you might need to update the icon that displays your corporate logo. Rather than making this change manually in all your map document files, you could write a geoprocessing script that updates all your map document files programmatically with the new logo. However, in order for this to be possible, a unique name will need to be assigned to your layout elements. This gives you the ability to access the elements of your layout individually. </p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec92"/>Getting ready</h2></div></div></div><p>As I mentioned <a id="id390" class="indexterm"/>
<a id="id391" class="indexterm"/>in the previous recipe, each layout element will be one of a number of element types and each can be assigned a name. This element name can then be used when you need to reference a particular element in your Python script. You can use ArcMap to assign unique names to each layout element. In this recipe, you will use ArcMap to assign names to the elements.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec93"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to assign unique names to each layout element using ArcMap:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Switch to layout view and you should something similar to the following screenshot:<div><img src="img/4445_05_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Names are <a id="id392" class="indexterm"/><a id="id393" class="indexterm"/>assigned differently depending upon the element type. Click on the uppermost data frame, which should be <strong>Crime</strong>, to select it. The selection handles should appear as follows:<div><img src="img/4445_05_3.jpg" alt="How to do it…"/></div></li><li class="listitem">Right-click <a id="id394" class="indexterm"/><a id="id395" class="indexterm"/>on the upper data frame and select <strong>Properties</strong> to display the <strong>Data Frame Properties</strong> window, as shown in the following screenshot. The <strong>Name</strong> property defines the unique name for the element. In this case, the element name is <code class="literal">Crime</code>:<div><img src="img/4445_05_4.jpg" alt="How to do it…"/></div></li><li class="listitem">Close the <a id="id396" class="indexterm"/><a id="id397" class="indexterm"/><strong>Data Frame Properties</strong> window.</li><li class="listitem">Select <strong>2009 Crime Legend</strong> in the layout view and open the <strong>Properties</strong> window by right-clicking on the legend and selecting <strong>Properties</strong>. </li><li class="listitem">Setting the element name for the legend is different from setting the element name for a data frame. Click on the <strong>Size and Position</strong> tab.</li><li class="listitem">The <strong>Element Name</strong> textbox is used in this case. Change the current value to <code class="literal">2009 Crime Legend</code>, as shown in the following:<div><img src="img/4445_05_5.jpg" alt="How to do it…"/></div></li><li class="listitem">You can<a id="id398" class="indexterm"/><a id="id399" class="indexterm"/> also define unique names for text elements. Select the title element (<code class="literal">Crime and Its Impact on School Test Performance</code>), right-click on the element, and select <strong>Properties</strong>.</li><li class="listitem">Select the <strong>Size and Position</strong> tab and define a unique name for this element, as shown in the following screenshot:<div><img src="img/4445_05_6.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec94"/>How it works…</h2></div></div></div><p>Each element <a id="id400" class="indexterm"/>
<a id="id401" class="indexterm"/>in the layout view can be assigned a name, which can then be used in your geoprocessing script to retrieve the specific element. You should strive to define unique names for each element. It isn't required that you define a unique name for each element, nor is it required that you even define a name at all. However, it is a best practice to give each element a name and ensure that each element name is unique if you intend to access these elements from your Python scripts. In terms of naming practices for your elements, you should strive to include only letters and underscores in the name.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec95"/>There's more…</h2></div></div></div><p>You can use element names in conjunction with the <code class="literal">ListLayoutElements()</code> function<a id="id402" class="indexterm"/> to restrict the elements that are returned by the function through the use of a wildcard parameter. In the next recipe, you'll learn how to restrict the list of layout elements returned through the use of wildcards and element type.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Restricting the layout elements returned by ListLayoutElements()</h1></div></div></div><p>Layouts can contain a large number of elements, many of which you won't need for a particular geoprocessing script. The <code class="literal">ListLayoutElements()</code> function<a id="id403" class="indexterm"/> can restrict the layout elements returned by passing in a parameter that defines the type of element that should be returned along with an optional wildcard, which finds elements using a portion of the name.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec96"/>Getting ready</h2></div></div></div><p>There are <a id="id404" class="indexterm"/>
<a id="id405" class="indexterm"/>many different types of layout elements including graphics, legends, pictures, text, and data frames. When you return a list of layout elements, you can restrict (filter) the types of elements that are returned. In this recipe, you will write a script that filters the layout elements returned by element type and wildcard.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec97"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to restrict the list of layers returned by the <code class="literal">ListLayoutElements()</code> function through the use of optional parameters, which define the type of element that should be returned along with a wildcard that can also restrict the elements returned.</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>) and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Use the <code class="literal">ListLayoutElements()</code> function with a restriction of only legend elements as well as a wildcard that returns elements with a name containing the text <code class="literal">Crime</code> anywhere in the name:<div><pre class="programlisting">for el in mapping.ListLayoutElements(mxd,"LEGEND_ELEMENT","*Crime*")
  print el.name</pre></div></li><li class="listitem">Run the script. In this case, only a single layout element will be returned:<div><pre class="programlisting">
<strong>2009 Crime Legend</strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec98"/>How it works...</h2></div></div></div><p>ListLayoutElements() is a <a id="id406" class="indexterm"/>
<a id="id407" class="indexterm"/>versatile function, which in its most basic form is used to return a list of all the layout elements on the page layout of a map document. However, there are two optional parameters that you can supply to filter this list. The first type of filter is an element type filter in which you specify that you only want to return one of the layout element types. You can also apply a wildcard to filter the returned list. These two types of filters can be used in combination. For example, in this recipe we are specifying that we only want to return LEGEND_ELEMENT objects with the text "Crime" anywhere in the element name. This results in a highly filtered list that only contains a single layout element. </p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>
<code class="literal">ListLayoutElements()</code> can be filtered by one of the following element types: <code class="literal">DATAFRAME_ELEMENT</code>, <code class="literal">GRAPHIC_ELEMENT</code>, <code class="literal">LEGEND_ELEMENT</code>, <code class="literal">MAPSURROUND_ELEMENT</code>, <code class="literal">PICTURE_ELEMENT</code>, <code class="literal">TEXT_ELEMENT</code>.</p></div></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec41"/>Updating layout element properties</h1></div></div></div><p>Each layout element <a id="id408" class="indexterm"/>
<a id="id409" class="indexterm"/>has a set of properties that you can update programmatically. For example, <code class="literal">LegendElement</code> includes properties that allow you to change the position of the legend on the page, update the legend title, and access the legend items. </p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec99"/>Getting ready</h2></div></div></div><p>There are many different types of layout elements including graphics, legends, text, maps, and pictures. Each of these elements is represented by a class in the <code class="literal">arcpy.mapping</code> package. These classes provide various properties that you can use to programmatically alter the element. </p><p>The <code class="literal">DataFrame</code> class<a id="id410" class="indexterm"/> provides access to data frame properties in the map document file. This object can work with both map units and page layout units, depending upon the property being used. Page layout properties, such as positioning and sizing, can be applied to the properties including <code class="literal">elementPositionX</code>, <code class="literal">elementPositionY</code>, <code class="literal">elementWidth</code>, and <code class="literal">elementHeight</code>. </p><p>The<a id="id411" class="indexterm"/> <code class="literal">GraphicElement</code> object <a id="id412" class="indexterm"/>
<a id="id413" class="indexterm"/>is a generic object for various graphics that can be added to the page layout including tables, graphs, neatlines, markers, lines, and area shapes. You'll want to make sure that you set the <code class="literal">name</code> property for each graphic element (and any other element for that matter), if you intend to access it through a Python script.</p><p>
<code class="literal">LegendElement</code> provides<a id="id414" class="indexterm"/> operations for positioning of the legend on the page layout, modification of the legend title, and also provides access to the legend items and the parent data frame. <code class="literal">LegendElement</code> can be associated with only a single data frame.</p><p>
<code class="literal">MapSurroundElement</code> <a id="id415" class="indexterm"/> can refer to north arrows, scale bars, and scale text, and like <code class="literal">LegendElement</code> is associated with a single data frame. Properties on this object enable repositioning on the page. </p><p>
<code class="literal">PictureElement</code> <a id="id416" class="indexterm"/> represents a raster or image on the page layout. The most useful property on this object allows for getting and setting the data sources, which can be extremely helpful when you need to change a picture, such as a logo, in multiple map documents. For example, you could write a script that iterates through all your map document files and replaces the current logo with a new logo. You can also reposition or resize the object. </p><p>
<code class="literal">TextElement</code> <a id="id417" class="indexterm"/> represents text on a page layout including inserted text, callouts, rectangle text, and titles, but does not include legend titles or text that are part of a table or chart. Properties enable modifying the text string, which can be extremely useful in situations where you need to make the same text string change in multiple places in the page layout or over multiple map documents, and of course repositioning of the object is also available. </p><p>Each element in the page layout is returned as an instance of one of the element objects. In this recipe, we're going to use the <code class="literal">title</code> property on the <code class="literal">Legend</code> object to programmatically change the title of the <code class="literal">Crime</code> legend and obtain a list of the layers that are part of the legend.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec100"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to update the properties of a layout element:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>), and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Use the <a id="id418" class="indexterm"/><a id="id419" class="indexterm"/> <code class="literal">ListLayoutElements()</code> method<a id="id420" class="indexterm"/> with a wildcard and restriction of only legend elements to return only the <code class="literal">Crime</code> legend and store it in a variable:<div><pre class="programlisting">elLeg = mapping.ListLayoutElements(mxd, "LEGEND_ELEMENT","*Crime*")[0]</pre></div></li><li class="listitem">Use the <code class="literal">title</code> property to update the title of the legend:<div><pre class="programlisting">elLeg.title = "Crimes by School District"</pre></div></li><li class="listitem">Get a list of the layers that are a part of the legend and print the names:<div><pre class="programlisting">for item in elLeg.listLegendItemLayers():
  print item.name</pre></div></li><li class="listitem">The entire script should appear as follows:<div><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
elLeg = mapping.ListLayoutElements(mxd, "LEGEND_ELEMENT","*Crime*")[0]
elLeg.title = "Crimes by School District"
for item in elLeg.listLegendItemLayers():
  print item.name</pre></div></li><li class="listitem">Run the script. You should see the following layers printed:<div><pre class="programlisting">
<strong>Burglaries in 2009</strong>
<strong>Crime Density by School District</strong>
</pre></div></li><li class="listitem">The change is displayed in the following screenshot:<div><img src="img/4445_05_7.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec101"/>How it works...</h2></div></div></div><p>Each of the <a id="id421" class="indexterm"/>
<a id="id422" class="indexterm"/>layout elements has a set of properties and methods. In this particular case, we've used the <code class="literal">title</code> property<a id="id423" class="indexterm"/> on the<a id="id424" class="indexterm"/> <code class="literal">Legend</code> object. Other properties of this object allow you to set the width and height, positioning, and others. Methods on the <code class="literal">Legend</code> object give you the ability to adjust the column count, list the legend items, and remove and update items. </p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec42"/>Getting a list of available printers</h1></div></div></div><p>Yet another list function provided by <code class="literal">arcpy</code> is <code class="literal">ListPrinterNames()</code>, which generates a list of the available printers. As is the case with the other list functions that we've examined, <code class="literal">ListPrinterNames()</code> <a id="id425" class="indexterm"/> is often called as a preliminary step in a multi-step script. </p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec102"/>Getting ready</h2></div></div></div><p>Before printing maps with the<a id="id426" class="indexterm"/> <code class="literal">PrintMap()</code> function, it is a common practice to call the<a id="id427" class="indexterm"/> <code class="literal">ListPrinterNames()</code> function, which returns a list of the available printers for the local computer. A particular printer can then be found by iterating through the list of printers and using it as an<a id="id428" class="indexterm"/> input to the <code class="literal">PrintMap()</code> function. </p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec103"/>How to do it…</h2></div></div></div><p>Follow these steps to learn<a id="id429" class="indexterm"/>
<a id="id430" class="indexterm"/> how to use the <code class="literal">ListPrinterNames()</code> function to return a list of the available printers for your script:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>) and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Call the <code class="literal">ListPrinterNames()</code> function and print each printer:<div><pre class="programlisting">for printerName in mapping.ListPrinterNames():
  print printerName</pre></div></li><li class="listitem">Run the script. The output will vary depending upon the list of the available printers for your computer. However, it should print something similar to the following code snippet:<div><pre class="programlisting">
<strong>HP Photosmart D110 series</strong>
<strong>HP Deskjet 3050 J610 series (Network)</strong>
<strong>HP Deskjet 3050 J610 series (Copy 1)</strong>
<strong>HP Deskjet 3050 J610 series</strong>
<strong>Dell 968 AIO Printer</strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec104"/>How it works...</h2></div></div></div><p>The <code class="literal">ListPrinterNames()</code> function returns a Python list containing all the printers available to use in your script. You can then use the <code class="literal">PrintMap()</code> function, which we'll examine in the next recipe, to send a print job to a particular printer that is available to your computer.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec43"/>Printing maps with PrintMap()</h1></div></div></div><p>Sending your map<a id="id431" class="indexterm"/>
<a id="id432" class="indexterm"/> layout to a printer is easy with the <code class="literal">PrintMap()</code> function. By default, the print job will be sent to the default printer saved with the map document, but you can also define a specific printer where the job should be sent. </p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec105"/>Getting ready</h2></div></div></div><p>
<code class="literal">arcpy.mapping</code> provides a <code class="literal">PrintMap()</code> function for printing page layouts or data frames from ArcMap. Before calling <code class="literal">PrintMap()</code>, it is a common practice to call the <code class="literal">ListPrinterNames()</code> function. A particular printer can then be found by iterating the list of printers and used as an input to the <code class="literal">PrintMap()</code> function.</p><p>
<code class="literal">PrintMap()</code> can print either a specific data frame or the page layout of a map document. By default, this function will use the printer saved with the map document or, if not present in the map document, the default system printer. As I mentioned, you can also use <code class="literal">ListPrinterNames()</code> to get a list of the available printers, and select one of these printers as an input to <code class="literal">PrintMap()</code>. In this recipe, you will learn how to use the <code class="literal">PrintMap()</code> function to print the layout.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec106"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to use the <code class="literal">PrintMap()</code> function to print the layout view in ArcMap:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>), and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Look for the <code class="literal">Test_Performance</code> data frame and print if it is found:<div><pre class="programlisting">for df in mapping.ListDataFrames(mxd):
  if df.name == "Test_Performance":
    mapping.PrintMap(mxd,"",df)</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec107"/>How it works...</h2></div></div></div><p>The <code class="literal">PrintMap()</code> function <a id="id433" class="indexterm"/>
<a id="id434" class="indexterm"/>accepts one required parameter and a handful of optional parameters. The required parameter is a reference to the map document. The first optional parameter is the printer name. In this case, we haven't specified a particular printer to use. Because we haven't provided a specific printer, it will use the printer saved with the map document or the default system printer if a printer is not part of the map document. The second optional parameter is the data frame that we'd like to print, which in this instance is <code class="literal">Test_Performance</code>. Other optional parameters, not supplied in this case, are an output print file and the image quality.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec44"/>Exporting a map to a PDF file</h1></div></div></div><p>Rather than sending <a id="id435" class="indexterm"/>
<a id="id436" class="indexterm"/>your map or layout view to a printer, you may want to simply create PDF files that can be shared. Arcpy mapping provides an <a id="id437" class="indexterm"/> <code class="literal">ExportToPDF()</code> function, which you can use to do this.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec108"/>Getting ready</h2></div></div></div><p>PDF<a id="id438" class="indexterm"/> is a very popular interchange format designed to be viewable and printable from many different platforms. The arcpy mapping <code class="literal">ExportToPDF()</code> function can be used to export data frames or the page layout to PDF format. By default, the <code class="literal">ExportToPDF()</code> function exports the page layout, but you can pass in an optional parameter that references a particular data frame, which can be printed instead of the page layout. In this recipe, you will learn how to export the page layout as well as a specific data frame to a PDF file.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec109"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to export a map to a PDF fil:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>), and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument('CURRENT')</pre></div></li><li class="listitem">Export the page layout with the <code class="literal">ExportToPDF()</code> function:<div><pre class="programlisting">mapping.ExportToPDF(mxd,r"c:\ArcpyBook\Ch5\Map_PageLayout.pdf").</pre></div></li><li class="listitem">Run the script.</li><li class="listitem">Open the <code class="literal">Map_PageLayout.pdf</code> file that was created, and you should see something similar to the following screenshot:<div><img src="img/4445_05_8.jpg" alt="How to do it…"/></div></li><li class="listitem">Now, <a id="id439" class="indexterm"/><a id="id440" class="indexterm"/>we'll print a specific data frame from our map document file. Alter your script, so that it appears as follows:<div><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument('CURRENT')
for df in mapping.ListDataFrames(mxd):
  if df.name == "Crime":
    mapping.ExportToPDF(mxd,r"c:\ArcpyBook\Ch5\DataFrameCrime.pdf",df)</pre></div></li><li class="listitem">Run the script and examine the output PDF.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec110"/>How it works…</h2></div></div></div><p>The <code class="literal">ExportToPDF()</code> function<a id="id441" class="indexterm"/> requires two parameters, including a reference to the map document and the file that serves as the output PDF file. The first script that we developed, passed in a reference to the map document along with an output PDF file. Since we didn't pass <a id="id442" class="indexterm"/>
<a id="id443" class="indexterm"/>in an optional parameter specifying the data frame, the <code class="literal">ExportToPDF()</code> function will export the page layout. There are also many optional parameters that can be passed into this method, including a specific data frame and a number of parameters, mostly related to the quality of the output content and file. Our second script passed in a specific data frame that should be exported. You can reference the ArcGIS help pages for more information on each of the optional parameters. </p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec45"/>Exporting a map to an image file</h1></div></div></div><p>You can also export <a id="id444" class="indexterm"/>
<a id="id445" class="indexterm"/>the contents of the map or layout view to an image file using one of the many functions provided by <code class="literal">arcpy.mapping</code>. Each image export function will differ in name depending upon the type of image file you'd like to create. The parameters passed into the function will also vary slightly.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec111"/>Getting ready</h2></div></div></div><p>In addition to providing the ability to export data frames and the page layout to a PDF format, you can also use one of the many export functions provided by <code class="literal">arcpy.mapping</code> to export an image file. Available formats include AI, BMP, EMF, EPS, GIF, JPEG, SVG, and TIFF. The parameters provided for each function will vary depending upon the type of image. Some examples of these function names include <a id="id446" class="indexterm"/> <code class="literal">ExportToJPEG()</code>, <a id="id447" class="indexterm"/> <code class="literal">ExportToGIF()</code>, and<a id="id448" class="indexterm"/> <code class="literal">ExportToBMP()</code>. In this recipe, you'll learn how to export your maps to images.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec112"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to export your data or layout view to an image file:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap. </li><li class="listitem">Open the Python window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch5.mxd</code>), and assign the reference to a variable:<div><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Export the <code class="literal">Crime</code> data frame as a JPEG image:<div><pre class="programlisting">for df in mapping.ListDataFrames(mxd):
  if df.name == "Crime":
    mapping.ExportToJPEG(mxd,r"c:\ArcpyBook\Ch5\DataFrameCrime.jpg",df)</pre></div></li><li class="listitem">Run the script and examine the output file.</li><li class="listitem">Now, we'll use an optional parameter that outputs a <code class="literal">world</code> file along with the image. Alter your script, so that it appears as follows:<div><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
for df in mapping.ListDataFrames(mxd):
  if df.name == "Crime":
    mapping.ExportToPDF(mxd,r"c:\ArcpyBook\Ch5\DataFrameCrime2.jpg",df,world_file=True)</pre></div></li><li class="listitem">Run the script. A new file called <code class="literal">DataFrameCrime.jpg</code> will be created. Open this file in a text editor, and you should see the following content:<div><pre class="programlisting">
<strong>470.520239851286190</strong>
<strong>0.000000000000000</strong>
<strong>0.000000000000000</strong>
<strong>-496.256971063348490</strong>
<strong>1972178.761771137800000</strong>
<strong>13815440.387677660000000</strong>
</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec113"/>How it works…</h2></div></div></div><p>Notice <a id="id449" class="indexterm"/>
<a id="id450" class="indexterm"/>that the <code class="literal">ExportToJPEG()</code> function<a id="id451" class="indexterm"/> looks virtually the same as <a id="id452" class="indexterm"/> <code class="literal">ExportToPDF()</code>. Keep in mind though that the optional parameters will be different for all the export functions. Each <code class="literal">ExportTo&lt;Type&gt;</code> function will vary depending upon the parameters that can be used in the creation of the image file.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Creating a map book with PDFDocumentCreate() and PDFDocumentOpen()</h1></div></div></div><p>One common <a id="id453" class="indexterm"/>
<a id="id454" class="indexterm"/>
<a id="id455" class="indexterm"/>
<a id="id456" class="indexterm"/>scenario for many GIS professionals is the need to create a map book that can then be shared with others. A map book is simply a collection of maps for a particular area and usually contains an index map as well. Map books are often created with PDF files, as they are a common interchange format.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec114"/>Getting ready</h2></div></div></div><p>In addition to exporting your maps to PDF, you can also manipulate existing PDF documents or create new PDF documents. You can merge pages, set document open behavior, add file attachments, and create or change document security settings. The <code class="literal">PDFDocumentOpen()</code> function<a id="id457" class="indexterm"/> is used to open an existing PDF file for manipulation. <code class="literal">PDFDocumentCreate()</code> <a id="id458" class="indexterm"/>creates a new PDF document. These functions are often used in the creation of map books, which is what we'll do in this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec115"/>How to do it…</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open IDLE and create a new script window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> and <code class="literal">os</code> modules:<div><pre class="programlisting">import arcpy.mapping as mapping
import os</pre></div></li><li class="listitem">Set the path and filename for the map book. Remove the file if it already exists:<div><pre class="programlisting">pdfPath = r"C:\ArcpyBook\Ch5\CrimeMapBook.pdf"
if os.path.exists(pdfPath):
  os.remove(pdfPath)</pre></div></li><li class="listitem">Create the PDF document:<div><pre class="programlisting">pdfDoc = mapping.PDFDocumentCreate(pdfPath)</pre></div></li><li class="listitem">Append existing PDF pages to the document:<div><pre class="programlisting">pdfDoc.appendPages(r"c:\ArcpyBook\Ch5\Map_PageLayout.pdf")
pdfDoc.appendPages(r"c:\ArcpyBook\Ch5\Map_DataFrameCrime.pdf")</pre></div></li><li class="listitem">Commit changes to the map book:<div><pre class="programlisting">pdfDoc.saveAndClose()</pre></div></li><li class="listitem">The entire script should appear as follows:<div><pre class="programlisting">import arcpy.mapping as mapping
import os
pdfPath = r"C:\ArcpyBook\Ch5\CrimeMapBook.pdf"
if os.path.exists(pdfPath):
  os.remove(pdfPath)
pdfDoc = mapping.PDFDocumentCreate(pdfPath)
pdfDoc.appendPages(r"c:\ArcpyBook\Ch5\Map_PageLayout.pdf")
pdfDoc.appendPages(r"c:\ArcpyBook\Ch5\Map_DataFrameCrime.pdf")
pdfDoc.saveAndClose()</pre></div></li><li class="listitem">Run the script.</li><li class="listitem">Examine the new map book at <code class="literal">c:\ArcpyBook\Ch5\CrimeMapBook.pdf</code>. The book should now contain two pages consisting of the PDF files that we created in an earlier recipe.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec116"/>How it works...</h2></div></div></div><p>The <a id="id459" class="indexterm"/>
<a id="id460" class="indexterm"/>
<a id="id461" class="indexterm"/>
<a id="id462" class="indexterm"/> <code class="literal">PDFDocumentCreate()</code> function<a id="id463" class="indexterm"/> is used to create a new PDF document by providing a path and filename for the document. The PDF is not actually created on disk until you insert or append pages and then call <code class="literal">PDFDocument.saveAndClose()</code>. The <code class="literal">appendPages()</code> and <code class="literal">insertPages()</code> functions are used to insert and append pages. </p><p>
<code class="literal">PDFDocumentOpen()</code> <a id="id464" class="indexterm"/> accepts a parameter that specifies the path to a PDF file and returns an instance of the <a id="id465" class="indexterm"/> <code class="literal">PDFDocument</code> class. Once open, you can make modifications to PDF file properties, add or insert files, and attach documents. Make sure you call <code class="literal">PDFDocument.saveAndClose()</code> after all operations, to save the changes.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec117"/>There's more…</h2></div></div></div><p>A number of properties can be set on a PDF document through the <code class="literal">PDFDocument</code> object, including getting the page count, attaching files, updating title, author, subject, keywords, open behavior, and the layout. You can also update document security by calling <code class="literal">PDFDocument.updateDocSecurity()</code> to set a password, encryption, and security restrictions. </p></div></div></div>
</body></html>