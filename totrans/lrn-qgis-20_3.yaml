- en: Chapter 3. Data Creation and Editing
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we will first create some new vector layers and cover how to
    select features and take measurements. We will then continue with editing feature
    geometries and attributes. Then, we will reproject vector and raster data, and
    before we end this chapter, learn how to convert between different file formats
    with joining data from text files and spreadsheets to our spatial data.
  prefs: []
  type: TYPE_NORMAL
- en: Creating new vector layers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this exercise, we'll create a new layer from scratch. QGIS offers a wide
    range of functionalities to create different layers. The **Layer** | **New** menu
    lists functions to create new Shapefile and SpatiaLite layers, but we can also
    create new database tables using the DB Manager plugin. The interfaces differ
    slightly to accommodate the features supported by each format.
  prefs: []
  type: TYPE_NORMAL
- en: Let's create a new Shapefile to see how it works. A new Shapefile layer, which
    can be accessed by going to **Layer** | **New** or *Ctrl* + *Shift* + *N*, opens
    the New Vector Layer dialog with options for different geometry types, CRS, and
    attributes. The process itself is really fast because all mandatory fields already
    have default values. By default, it will create a new point layer with WGS84 CRS
    (unless specified otherwise in **Settings** | **Options** | **CRS**) and one integer
    field called **id**. We can simply click on **OK**, specify a filename, and a
    new layer appears in the layer list.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, we also create one line and one polygon layer. We''ll add some extra
    fields to these layers. Besides integer fields, Shapefiles also support text and
    decimal values. To add a field, we only need to insert a name, select a type and
    width, and click on **Add to attributes list**. For decimal numbers, we also have
    to define the **Precision** value, which determines the number of digits after
    the comma. A **Width** value of **3** with a **Precision** value of **1** will
    allow a value range from -99.9 to + 99.9\. The following screenshot shows the
    **New Vector Layer** dialog and the **Attributes...** window for my example polygon
    layer:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating new vector layers](img/7488_03_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: All of the new layers are empty so far, but we will create some features now.
    If we want to add features to a layer, we first have to enable editing for this
    layer. Editing can be turned on and off by selecting **Layer** | **Toggle editing**,
    **Toggle editing** in the layer name context menu, or with the **Toggle editing**
    button in the **Digitizing** toolbar. Notice how the layer's icon in the layer
    list changes to reflect whether editing is on or off. When we turn on editing
    for a layer, QGIS automatically enables the digitizing tools suitable for the
    layer's geometry type.
  prefs: []
  type: TYPE_NORMAL
- en: Now, we can use the **Add Feature** tool in the editing toolbar to create new
    features. To place a point, we simply click on the map. We are then prompted to
    fill out the attribute form, and once we click on **OK** the new feature is created.
    Like with points, we can create new lines and polygons by placing nodes onto the
    map. To finish a line or a polygon, we simply right-click on the map. Create some
    features in each layer and then save your changes. We can re-use these test layers
    in the upcoming exercises.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: New features and feature edits are saved permanently only after clicking on
    the **Save Layer Edits** button in the **Digitizing** toolbar or once we finish
    editing and confirm that we want to save.
  prefs: []
  type: TYPE_NORMAL
- en: Working with feature selection tools
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Selecting features is one of the core functions of any GIS, and it is useful
    to know them before we venture forward into editing geometries and attributes.
    Depending on the use case, selection tools come in many different flavors. QGIS
    offers three different kinds of tools to select features using the mouse, an expression,
    or another layer.
  prefs: []
  type: TYPE_NORMAL
- en: The first group of tools in the **Attributes** toolbar allows us to select features
    on the map using the mouse, either one at a time or by drawing different shapes
    such as rectangles or freehand areas around the features. All features that intersect
    with the drawn shape are selected. Holding down *Ctrl* will add the new selection
    to an existing one.
  prefs: []
  type: TYPE_NORMAL
- en: 'Similarly, holding down *Ctrl* + *Shift* will remove the new selection from
    the existing selection. The following screenshot shows the tools:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Working with feature selection tools](img/7488_03_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The second type of select tool is called **Select by Expression** and it is
    also available in the **Attribute** toolbar. It selects features based on expressions
    that can contain references and functions using feature attributes and/or geometry.
    The list of available functions is pretty long, but we can use the search box
    to filter the list by name to find the function we are looking for faster. On
    the right-hand side of the window, we find the **Selected Function Help**, which
    explains the functionality and how to use the function in an expression. The **Function
    List** also shows the layer attribute fields, and by clicking on **Load all unique
    values** or **Load 10 sample values**, we can easily access their content. Like
    with the mouse tools, we can choose between creating a new selection or adding
    to or deleting from an existing selection. Additionally, we can choose to only
    select features from within an existing selection. Let''s have a look at some
    example expressions that you can build on and use in your own work:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Using the `lakes.shp` file in our sample data, we can, for example, select
    big lakes with an area bigger than 1,000 square miles using a simple attribute
    query: `"AREA_MI" > 1000.0`, or by using geometry functions such as `$area > (1000.0
    * 27878400)`. Note that the `lakes.shp` CRS uses feet and we therefore have to
    multiply by 27,878,400 to convert from square feet to square miles.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We can also work with string functions, for example, to find lakes with long
    names: `length("NAMES") > 12`, or lakes with names that contain an "s" or "S":
    `lower("NAMES") LIKE ''%s%''`, which first converts the names to lower case and
    then looks for any appearance of "s". The dialog will look like the following
    screenshot:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Working with feature selection tools](img/7488_03_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The third type of tool allows us to select features in one layer based on their
    location relative to features in a second layer. These tools can be accessed by
    going to **Vector** | **Research Tools** | **Select by location** and **Vector**
    | **Spatial Query** | **Spatial Query**. Enable it in **Plugin Manager** if you
    cannot find it in the **Vector** menu. In general, we want to use the Spatial
    Query plugin as it supports a variety of spatial operations such as **crosses**,
    **equals**, **intersects**, **is disjoint**, **overlaps**, **touches**, and **contains**
    depending on the layer geometry type.
  prefs: []
  type: TYPE_NORMAL
- en: Let's test the Spatial Query plugin using `railroads.shp` and `pipelines.shp`
    from the sample data. For example, we might want to find all the railroad features
    that cross a pipeline; we therefore select the **railroads** layer, the **Crosses**
    operation, and the **pipelines** layer. After clicking on **Apply**, the plugin
    presents us the query results. There is a list of IDs of the result features on
    the right-hand side of the window as you can see in the following screenshot.
    Below this list, we can check the **Zoom to item** checkbox, and QGIS will zoom
    to the feature that belongs to the selected ID. Additionally, the plugin offers
    buttons to directly save all the resulting features to a new layer.
  prefs: []
  type: TYPE_NORMAL
- en: '![Working with feature selection tools](img/7488_03_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Editing vector geometries
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now that we know how to create and select features, we can have a closer look
    at the other tools in the **Digitizing** and **Advanced Digitizing** toolbars.
    The Digitizing toolbar will look like the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Editing vector geometries](img/7488_03_05a.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The basic **Digitizing** toolbar contains tools for creating and moving features
    and nodes, as well as for deleting, copying, cutting, and pasting features, as
    follows:'
  prefs: []
  type: TYPE_NORMAL
- en: With the **Move Feature(s)** tool, it is easy to move one or more features at
    once by dragging them to the new location.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Similarly, the **Node Tool** feature allows us to move one or more nodes of
    the same feature. The first click activates the feature, while the second click
    selects the node. Hold the mouse key down to drag the node to its new location.
    Instead of moving only one node, we can also move an edge by clicking and dragging
    the line. And finally, we can select and move multiple nodes by holding down *Ctrl*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Delete Selected**, **Cut Features**, and **Copy Features** are only active
    if one or more layer features are selected. Similarly, **Paste Features** only
    works after a feature has been cut or copied.![Editing vector geometries](img/7488_03_05b.jpg)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The **Advanced Digitizing** toolbar offers very useful **Undo** and **Redo**
    functionalities as well as additional tools for more involved geometry editing:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Rotate Feature(s)** enables us to rotate one or more selected features around
    a central point.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the **Simplify Feature** tool, we can simplify/generalize feature geometries
    by simply clicking on the feature and pulling the tolerance slider in the pop-up
    window.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The following tools allow us to **Add Rings**, also known as "holes", into existing
    polygons or **Add Parts** to existing polygons. And of course, there are tools
    to **Delete Rings** and **Delete Parts** as well.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Reshape Features** can be used to alter the geometry of a feature by either
    cutting out or adding pieces. You can control the behavior by starting to draw
    the new form inside the original feature to add a piece, or start outside to cut
    out a piece, as shown in the following example diagram:![Editing vector geometries](img/7488_03_06.jpg)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **Offset Curve** tool is only available for lines and allows us to displace
    a line geometry by a given offset.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Split Features** allows us to cut one or more features along a cut line.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Merge Selected Features** enables us to merge multiple features while keeping
    control over which feature''s attributes will be available in the output feature.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Similarly, **Merge Attributes of Selected Features** lets us combine the attributes
    of multiple features, but without merging them into one feature. Instead, all
    original features remain as they were, but the attribute values are updated.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finally, **Rotate Point Symbols** is only available for point layers with the
    **Rotation field** feature enabled (which we will cover in [Chapter 5](ch05.html
    "Chapter 5. Creating Great Maps"), *Creating Great Maps*).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the measuring tools
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Another core functionality of any GIS are the measurement tools. In QGIS, we
    find tools to measure lines, areas, and angles in the **Attribute** toolbar, as
    shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Using the measuring tools](img/7488_03_07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The measurements are updated continuously while we draw measurement lines, areas,
    or angles. When we draw a line with multiple segments, the tool will show the
    length of each segment as well as the total length of all the segments put together.
    To stop measuring, we just right-click. If we want to change the measurement units
    from meters to feet or from degrees to radians, we can do that in **Settings**
    | **Options** | **Map Tools**.
  prefs: []
  type: TYPE_NORMAL
- en: Editing attributes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are three main use cases for attribute editing. First, we might want to
    edit the attributes of one specific feature, for example, to fix a wrong name.
    Second, we might want to edit attributes of a group of features. Or third, we
    might want to change the attributes of all the features within a layer. All these
    use cases are covered by functionality available through the attribute table.
    We can access it by going to **Layer** | **Open Attribute Table**, the **Open
    Attribute Table** button present in the **Attributes** toolbar, or in the layer
    name context menu.
  prefs: []
  type: TYPE_NORMAL
- en: To change attribute values, we always have to first enable editing. Then we
    can double-click on any cell in the attribute table to activate the input mode.
    Clicking on *Enter* confirms the change, but to save the new value permanently,
    we have to also click on the **Save Edit(s)** button or press *Ctrl* + *S*. In
    the bottom-right corner of the attribute table dialog, we can switch from the
    table to the form view, as shown in the following screenshot, and start editing
    there.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Another option for editing the attributes of one feature is to open the attribute
    form directly by clicking on the feature on the map using the **Identify tool**.
    By default, the **Identify tool** displays the attribute values in the read mode,
    but we can enable **Open feature form if a single feature is identified** by going
    to **Settings** | **Options** | **Map Tools**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Editing attributes](img/7488_03_08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'In the attribute table, we also find tools to handle selections (from left
    to right starting at the third button): Delete selected features, Select by expression,
    Cancel the selection, Move selected features to the top of the table, Invert the
    selection, Pan to the selected features, Zoom to the selected features, and Copy
    the selected features. Another way to select features in the attribute table is
    to click on the row number.'
  prefs: []
  type: TYPE_NORMAL
- en: The next two buttons allow us to add and remove columns. When we click on the
    delete column button, we get a list of columns to choose from. Similarly, the
    add columns button brings up a dialog to specify the name and data type of the
    new column.
  prefs: []
  type: TYPE_NORMAL
- en: 'If we want to change attributes of multiple or all features in a layer, editing
    them manually usually isn''t an option. That is what **Field Calculator** is good
    for. We can access it using the **Open field calculator** button in the attribute
    table or using the *Ctrl* + *I* keys. In **Field Calculator**, we can choose to
    only update selected features or to update all the features in the layer. Besides
    updating an existing field, we can also create a new field. The function list
    is the same one we already explored when we selected features by expression. We
    can use any of these functions to populate a new field or update an existing one.
    Here are some example expressions that are used often:'
  prefs: []
  type: TYPE_NORMAL
- en: We can create an `id` column using the `$rownum` function, which populates a
    column with the row numbers as shown in the following screenshot
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Another common use case is to calculate line length or polygon area using the
    geometry functions `$length` and `$area` respectively
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Similarly, we can get point coordinates using `$x` and `$y`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If we want to get the start or end points of a line, we can use `xat(0)` and
    `yat(0)` or `xat(-1)` and `yat(-1)`![Editing attributes](img/7488_03_09.jpg)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reprojecting and converting vector and raster data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In [Chapter 2](ch02.html "Chapter 2. Viewing Spatial Data"), *Viewing Spatial
    Data*, we talked about CRS and the fact that QGIS offers on-the-fly reprojection
    to display spatial datasets, which are stored in different CRS, in the same map.
    Still, in some cases, we will want to permanently reproject a dataset, for example
    to geoprocess it later on.
  prefs: []
  type: TYPE_NORMAL
- en: In QGIS, reprojecting a vector or raster layer is done by simply saving it with
    a new CRS. We can save a layer using **Layer** | **Save as ...** or **Save as
    …** in the layer name context menu. Pick a target file format and file name, and
    then click on the **Browse** button besides the CRS field to pick a new CRS.
  prefs: []
  type: TYPE_NORMAL
- en: Besides changing the CRS, the main use case of the Save vector/raster layer
    dialog is to convert between different file formats. For example, we can load
    a Shapefile and export it as GeoJSON, Mapinfo MIF, CSV, and so on, or the other
    way around.
  prefs: []
  type: TYPE_NORMAL
- en: The Save raster layer dialog is also a convenient way to clip/crop rasters by
    a bounding box, as we can specify which extent we want to save.
  prefs: []
  type: TYPE_NORMAL
- en: Similarly, for vector layers, there is **Save selection as …** in both the **Layer**
    menu and the layer name context menu, which will open the same kind of dialog,
    but it will only save the selected features.
  prefs: []
  type: TYPE_NORMAL
- en: '![Reprojecting and converting vector and raster data](img/7488_03_10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Enabling **Add saved file to map** (currently only available in the vector dialog)
    is very convenient because it saves us the effort to go and load the new file
    manually after it has been saved.
  prefs: []
  type: TYPE_NORMAL
- en: Joining tabular data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In many real-life situations, we get additional non-spatial data in the form
    of spreadsheets or text files. The good news is we can load XLS files by simply
    dragging them into QGIS from the file browser or using **Add Vector Layer**. Don''t
    let the wording fool you! It really works without any geometry data in the file.
    The file can even contain more than just one table. You will see the following
    dialog, which lets you choose which table(s) you want to load:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Joining tabular data](img/7488_03_11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'QGIS will automatically recognize the names and data types of columns in an
    XLS table. It''s quite easy to tell because numeric values are right-aligned in
    the attribute table as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Joining tabular data](img/7488_03_12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We can also load tabular data from delimited text files like we saw in [Chapter
    2](ch02.html "Chapter 2. Viewing Spatial Data"), *Viewing Spatial Data*, when
    we loaded a point layer from a delimited text file. To load a delimited text file
    that only contains tabular data but no geometry information, we just need to enable
    the **No geometry** (attribute table only) option.
  prefs: []
  type: TYPE_NORMAL
- en: After loading the tabular data from either the spreadsheet or text file, we
    can continue to join this non-spatial data to a vector layer. To do that, we go
    to the vector **Layer Properties** | **Joins** tab. There, we can add a new join
    by pressing the green plus button. All we have to do is select the tabular **Join
    layer** and **Join field** fields (of the tabular layer), which should contain
    values that match those in the **Target field** field (of the vector layer). The
    page will look like the following screenshot.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The way joins work in QGIS is that the join layer's attributes are appended
    to the original layer's attribute table. The number of features in the original
    layer is not changed. Whenever there is a match between the join and the target
    field, the attribute value will be filled; otherwise you'll see NULL entries.
  prefs: []
  type: TYPE_NORMAL
- en: '![Joining tabular data](img/7488_03_13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Once the join is added, we can see the extended attribute table and use the
    new appended attributes for styling and labeling.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can save the joined layer permanently. Just use **Save as …** to create
    the new file.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we covered how to create new layers from scratch. We used the
    tools to create and edit feature geometries in different ways. Then, we went into
    editing feature attributes of single features, feature selections, and whole layers.
    Next, we reprojected both vector and raster layers and also learned how to convert
    between different file formats. Finally, we finished this chapter on layer creation
    and editing by covering tabular data, how it can be loaded into QGIS, and how
    to join it to our spatial data.
  prefs: []
  type: TYPE_NORMAL
- en: In the following chapter, we will put our data to good use and learn how to
    perform different kinds of spatial analysis on raster and vector data.
  prefs: []
  type: TYPE_NORMAL
