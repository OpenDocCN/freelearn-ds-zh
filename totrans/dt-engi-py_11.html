<html><head></head><body>
		<div><h1 id="_idParaDest-100"><em class="italic"><a id="_idTextAnchor102"/>Chapter 9</em>: Monitoring Data Pipelines</h1>
			<p>You now know how to build data pipelines that are production ready—they are idempotent, use atomic transactions, and are version controlled. They are ready to start running in production, but before you can deploy them, you need to be able to monitor them. There will be errors in the code, in the data, in the network, or in other areas outside your control. You will need to know when errors happen, and when things are running as they should.</p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Monitoring NiFi in the GUI</li>
				<li>Monitoring NiFi using processors</li>
				<li>Monitoring NiFi with Python and the REST API</li>
			</ul>
			<h1 id="_idParaDest-101"><a id="_idTextAnchor103"/>Monitoring NiFi using the GUI</h1>
			<p>The NiFi GUI <a id="_idIndexMarker491"/>provides several ways to monitor your data pipelines. Using <a id="_idIndexMarker492"/>the GUI is the simplest way to start monitoring your NiFi instance.</p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor104"/>Monitoring NiFi with the status bar</h2>
			<p>Much of <a id="_idIndexMarker493"/>the information you need is on the status bar. The status <a id="_idIndexMarker494"/>bar is below the component toolbar and looks like the following screenshot:</p>
			<div><div><img src="img/Figure_9.1_B15739.jpg" alt="Figure 9.1 – Component and status toolbars&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.1 – Component and status toolbars</p>
			<p>Starting at the left of the status bar, let's look at what is being monitored:</p>
			<ul>
				<li><strong class="bold">Active thread</strong>: This lets you know how many threads are running. You can get a sense of tasks and load.</li>
				<li><strong class="bold">Total queued data</strong>: The number of flowfiles and the combined size on disk.</li>
				<li><strong class="bold">Transmitting remote process groups and not transmitting remote process groups</strong>: You can run NiFi on multiple machines or instances on the same machine and allow process groups to communicate. These icons tell you whether they are or are not communicating.</li>
				<li><strong class="bold">Running components, stopped components, invalid components, and disabled components</strong>: These show you the state of your components. Running does not necessarily mean that a component is currently processing data, but that it is on and scheduled to do so.</li>
				<li><strong class="bold">Up-to-date versioned process groups, locally modified versioned process groups, stale versioned process groups, locally modified and stale versioned process groups, and sync failure versioned process groups</strong>: This group of icons show the versioning information of your processor groups. From here you can tell if you have uncommitted changes or are using older versions.</li>
				<li><strong class="bold">Last refresh</strong>: This lets you know when the data in the toolbar is valid for. The refresh is usually every five minutes.</li>
			</ul>
			<p>The status <a id="_idIndexMarker495"/>bar gives you the monitoring information for all <a id="_idIndexMarker496"/>of your processors, but there is also a status toolbar on every processor group and for each processor. You can see the status of the same metrics in the <strong class="bold">SCF</strong> processor group, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.2_B15739.jpg" alt="Figure 9.2 – Processor group monitoring&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.2 – Processor group monitoring</p>
			<p>The <strong class="bold">In</strong> and <strong class="bold">Out</strong> metrics show if there is data flowing into the process group from another processor or group. You will learn how to connect processor groups in the next chapter. The versioning <a id="_idIndexMarker497"/>information is not on the toolbar but to the left <a id="_idIndexMarker498"/>of the title of the processor group. The red square on the right of <a id="_idIndexMarker499"/>the processor group is a <strong class="bold">bulletin</strong>. This provides information on errors within the processor group. Hovering over it shows the error, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.3_B15739.jpg" alt="Figure 9.3 – Looking at the bulletin on a processor group&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.3 – Looking at the bulletin on a processor group</p>
			<p>I currently <a id="_idIndexMarker500"/>do not have Elasticsearch running and as <a id="_idIndexMarker501"/>a result, the processor that sends data to Elasticsearch is failing with a connection timeout. If you enter the processor group, you can see the bulletin on the specific processor, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.4_B15739.jpg" alt="Figure 9.4 – The bulletin on a specific processor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.4 – The bulletin on a specific processor</p>
			<p>To change <a id="_idIndexMarker502"/>the bulletin messages, you can adjust the level in <a id="_idIndexMarker503"/>the processor configuration under <strong class="bold">Settings</strong>. The <strong class="bold">Bulletin Level</strong> dropdown allows you to show more or less based on severity, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.5_B15739.jpg" alt="Figure 9.5 – Setting the Bulletin Level&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.5 – Setting the Bulletin Level</p>
			<p>You can see the bulletin information for all your NiFi processors using the <strong class="bold">Bulletin Board</strong>, which is <a id="_idIndexMarker504"/>accessed from the waffle menu in the upper-right corner of NiFi. Selecting the <strong class="bold">Bulletin Board</strong> will show all the messages, as shown <a id="_idIndexMarker505"/>in the following screenshot:</p>
			<div><div><img src="img/Figure_9.6_B15739.jpg" alt="Figure 9.6 – Bulletin Board showing all the notices&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.6 – Bulletin Board showing all the notices</p>
			<p>Within <a id="_idIndexMarker506"/>each processor group, every processor also <a id="_idIndexMarker507"/>has status information, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.7_B15739.jpg" alt="Figure 9.7 – Status of a single processor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.7 – Status of a single processor</p>
			<p>The <strong class="bold">In</strong> and <strong class="bold">Out</strong> metrics <a id="_idIndexMarker508"/>in a processor show how much <a id="_idIndexMarker509"/>data (the flowfiles size) has passed through the processor in the last five minutes.</p>
			<h3>Using counters</h3>
			<p>Similar to <a id="_idIndexMarker510"/>bulletins, you can create increment- or decrement-counters. Counters don't tell you that something succeeded or failed, but they can give you an idea <a id="_idIndexMarker511"/>of how many flowfiles are being processed at any point in a data pipeline.</p>
			<p>In the <code>UpdateCounter</code> processor between the <code>EvaluateJsonPath</code> and <code>ElasticSCF</code> processors. This means that before a flowfile is inserted into Elasticsearch, the counter will be updated. The flow is shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.8_B15739.jpg" alt="Figure 9.8 – The UpdateCounter processor added to the data pipeline&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.8 – The UpdateCounter processor added to the data pipeline</p>
			<p>As you can see in the preceding screenshot, 162 flowfiles were sent through the processor. You will <a id="_idIndexMarker512"/>see the results of this later in this section. But first, to configure the processor, you will need to specify <strong class="bold">Counter Name</strong> and <strong class="bold">Delta</strong>. <strong class="bold">Delta</strong> is the number <a id="_idIndexMarker513"/>to increment or decrement by. I have configured the processor as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.9_B15739.jpg" alt="Figure 9.9 – Configuration of the UpdateCounter processor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.9 – Configuration of the UpdateCounter processor</p>
			<p>When you <a id="_idIndexMarker514"/>have configured the processor and ran the data pipeline, you will have a count. Earlier, 162 records passed through the data pipeline when I ran it. To see your counters, click the <a id="_idIndexMarker515"/>waffle menu in the top-right corner of the NiFi window and select <strong class="bold">Counters</strong>, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.10_B15739.jpg" alt="Figure 9.10 – NiFi Counters&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.10 – NiFi Counters</p>
			<p>The preceding <a id="_idIndexMarker516"/>screenshot shows the counts of the counter and an aggregate. If we had other <code>UpdateCounter</code> processors that updated the same counter, it would <a id="_idIndexMarker517"/>aggregate those values.</p>
			<p>Using the GUI is an excellent way to quickly see how your processor groups and processors are running. But you can also use processors to monitor the data pipeline.</p>
			<p>In the previous section, you learned about the NiFi bulletin. You can use background tasks to monitor NiFi and post that data to the NiFi bulletin using reporting tasks. Reporting tasks are like processors that run in the background and perform a task. The results will appear in the bulletin or you can send it to other locations.</p>
			<p>To create a reporting task, in the waffle menu, select <strong class="bold">Controller Settings</strong>, then navigate to the <strong class="bold">Reporting Task</strong> tab. The list should be blank, but you can add a new task using the plus sign on the right-hand corner of the window. You will see a list of tasks that are available. Single-click on one to see the description. You should see a list similar to the following screenshot:</p>
			<div><div><img src="img/Figure_9.11_B15739.jpg" alt="Figure 9.11 – Reporting tasks available in NiFi&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.11 – Reporting tasks available in NiFi</p>
			<p>For this <a id="_idIndexMarker518"/>example, double click the <strong class="bold">MonitorDiskUsage</strong> task. It will appear <a id="_idIndexMarker519"/>on the list with the ability to edit. Click the pencil to edit, set the <strong class="bold">Threshold</strong> to <strong class="bold">1%</strong>, and set the directory to your NiFi directory. The configuration will look like the following screenshot:</p>
			<div><div><img src="img/Figure_9.12_B15739.jpg" alt="Figure 9.12 – Configuring the MonitorDiskUsage task&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.12 – Configuring the MonitorDiskUsage task</p>
			<p>You can <a id="_idIndexMarker520"/>use a percentage or a value such as 20 gigabytes. I have set it to 1% so that it will post to the bulletin. I chose the NiFi directory because it contains all the <a id="_idIndexMarker521"/>logs and repositories.</p>
			<p>Running the <strong class="bold">Reporting Task</strong> processor, you should see a bulletin in the main NiFi window. The message will be that the <strong class="bold">MonitorDiskUsage</strong> task exceeded the 1% threshold. The following screenshot shows the bulletin:</p>
			<div><div><img src="img/Figure_9.13_B15739.jpg" alt="Figure 9.13 – The Reporting Task bulletin&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.13 – The Reporting Task bulletin</p>
			<p>You can <a id="_idIndexMarker522"/>create reporting tasks for many other metrics. Using the GUI is useful <a id="_idIndexMarker523"/>and convenient, but you will most likely not be able to sit in front of NiFi watching it all day. This would be horribly inefficient. A better method would be to have NiFi send you a message. You can do this using processors. The next section will show you how.</p>
			<h1 id="_idParaDest-103"><a id="_idTextAnchor105"/>Monitoring NiFi with processors</h1>
			<p>Instead <a id="_idIndexMarker524"/>of relying on watching the NiFi GUI, you can <a id="_idIndexMarker525"/>insert a processor into your data pipeline to report what is happening with the pipeline. For example, you can use the <code>PutSlack</code> processor to send messages on failures or success. </p>
			<p>To send Slack messages, you will need to create an app in your Slack workspace. You can do this by browsing to <a href="https://api.slack.com/apps">https://api.slack.com/apps</a>. Click <strong class="bold">Create New App</strong>, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.14_B15739.jpg" alt="Figure 9.14 – Creating a new app&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.14 – Creating a new app</p>
			<p>Slack will <a id="_idIndexMarker526"/>ask you to name your app and then <a id="_idIndexMarker527"/>select a workspace, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.15_B15739.jpg" alt="Figure 9.15 – Specifying a name and workspace for your app&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.15 – Specifying a name and workspace for your app</p>
			<p>When <a id="_idIndexMarker528"/>finished, you will be redirected to the app page. Under the <strong class="bold">Features</strong> heading, click <strong class="bold">Incoming Webhooks</strong> and turn it on, as shown <a id="_idIndexMarker529"/>in the following screenshot:</p>
			<div><div><img src="img/Figure_9.16_B15739.jpg" alt="Figure 9.16 – Activating Incoming Webhooks&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.16 – Activating Incoming Webhooks</p>
			<p>You will be <a id="_idIndexMarker530"/>asked to select a channel for the webhook. I selected myself so that the channel becomes a direct message to me. You can create a <a id="_idIndexMarker531"/>channel for the data pipeline so that multiple people can join and see the messages. Once you have completed this step, scroll to the bottom of the page to see the new webhook. Click the copy button and open NiFi. It is time to add <code>PutSlack</code> to your data pipeline.</p>
			<p>In NiFi, I have opened the <strong class="bold">SCF</strong> processor group. I found the <strong class="bold">ElasticSCF</strong> processor—the processor that sends the issues in to Elasticsearch. Drag and drop the processor icon in the control toolbar to the canvas and select <strong class="bold">PutSlack</strong>. Create a connection between <strong class="bold">ElasticSCF</strong> and <strong class="bold">PutSlack</strong> for the relationship failure, as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.17_B15739.jpg" alt="Figure 9.17 – PutSlack added to the end of the data pipeline&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.17 – PutSlack added to the end of the data pipeline</p>
			<p>To configure the <code>PutSlack</code> processor, paste the copied URL to the <strong class="bold">Webhook URL</strong> property. NiFi will hide the URL because it is a sensitive property. The <strong class="bold">Username</strong> property is whatever you want Slack to display when the message is sent. You can also set an icon or an emoji. The <strong class="bold">Webhook Text</strong> property is the message that will be sent. You can set the message to plain text saying that the processor failed, or because the <strong class="bold">Webhook Text </strong>property accepts the NiFi expression language, you can use a combination of a flowfile attribute with text. I have configured the processor as shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.18_B15739.jpg" alt="Figure 9.18 – PutSlack configuration&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.18 – PutSlack configuration</p>
			<p>I used the append method of the NiFi expression language. The statement is as follows:</p>
			<pre>${id:append(': Record failed Upsert Elasticsearch')}</pre>
			<p>The preceding statement gets the <code>id</code> property, <code>${id},</code> and calls append, <code>:append()</code>. Inside <a id="_idIndexMarker532"/>the <code>append()</code> method <a id="_idIndexMarker533"/>is the text. The result will be a message like the one shown in the following screenshot:</p>
			<div><div><img src="img/Figure_9.19_B15739.jpg" alt="Figure 9.19 – Slack direct message from NiFi&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.19 – Slack direct message from NiFi</p>
			<p>The preceding <a id="_idIndexMarker534"/>screenshot is my direct messages. You can see that I added the NiFi integration to the workspace, then received <a id="_idIndexMarker535"/>a message from NiFi. The message is the ID of the <strong class="bold">SeeClickFix</strong> issue and some text saying that it failed. I can now take action. </p>
			<p>You can use processors to send emails, write files, or perform many other actions that you could use to monitor your data pipeline. You can also write your own monitoring applications outside of NiFi using Python. The next section will cover the NiFi REST API.</p>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor106"/>Using Python with the NiFi REST API</h1>
			<p>Using Python <a id="_idIndexMarker536"/>and the NiFi REST API, you could write your <a id="_idIndexMarker537"/>own monitoring tools, or wire up a dashboard. The NiFi REST <a id="_idIndexMarker538"/>API documentation is located at <a href="https://nifi.apache.org/docs/nifi-docs/rest-api/index.html">https://nifi.apache.org/docs/nifi-docs/rest-api/index.html</a>. You can see all of the different endpoints by type and some information about each of them. This section will highlight some of the endpoints that you have covered in this chapter but by using the GUI.</p>
			<p>The first thing we can look at are the system diagnostics. System diagnostics will show you your resource usage. You can see heap size, threads, repository usage, and several other metrics. To call the endpoint with requests, you can use the following code:</p>
			<pre>r=requests.get('http://localhost:9300/nifi-api/system-diagnostics')
data=r.json()
data['systemDiagnostics']['aggregateSnapshot']['maxHeap']
#'512 MB'
data['systemDiagnostics']['aggregateSnapshot']['totalThreads']
#108
data['systemDiagnostics']['aggregateSnapshot']['heapUtilization']
#'81.0%'</pre>
			<p>Other endpoints of interest are the processor groups. Using this endpoint, you can find basic information <a id="_idIndexMarker539"/>about any processor group. You will need to <a id="_idIndexMarker540"/>get the ID of the group in NiFi. You can find this in the URL as the <code>processGroupId</code> parameter. With it, you can use the process-groups endpoint, as shown in the following code: </p>
			<pre>pg=requests.get('http://localhost:9300/nifi-api/process-groups/9466c3ca-4c6d-3884-ac72-af4a27919fb0')
pgdata=pg.json()
pgdata['component']['name']
#'SCF'
pgdata['status']</pre>
			<p>The <code>status</code> object holds most of the pertinent information that you would find in the status toolbar. The output is as follows:</p>
			<pre>{'id': '9466c3ca-4c6d-3884-ac72-af4a27919fb0', 'name': 'SCF', 'statsLastRefreshed': '16:11:16 MDT', 'aggregateSnapshot': {'id': '9466c3ca-4c6d-3884-ac72-af4a27919fb0', 'name': 'SCF', 'versionedFlowState': 'LOCALLY_MODIFIED', 'flowFilesIn': 0, 'bytesIn': 0, 'input': '0 (0 bytes)', 'flowFilesQueued': 6481, 'bytesQueued': 18809602, 'queued': '6,481 (17.94 MB)', 'queuedCount': '6,481', 'queuedSize': '17.94 MB', 'bytesRead': 0, 'read': '0 bytes', 'bytesWritten': 0, 'written': '0 bytes', 'flowFilesOut': 0, 'bytesOut': 0, 'output': '0 (0 bytes)', 'flowFilesTransferred': 0, 'bytesTransferred': 0, 'transferred': '0 (0 bytes)', 'bytesReceived': 0, 'flowFilesReceived': 0, 'received': '0 (0 bytes)', 'bytesSent': 0, 'flowFilesSent': 0, 'sent': '0 (0 bytes)', 'activeThreadCount': 0, 'terminatedThreadCount': 0}}</pre>
			<p>Using the processors endpoint, you can look specifically at a single processor. You can use the <code>status</code> object to look at the status toolbar information, as shown in the following code:</p>
			<pre>p=requests.get('http://localhost:9300/nifi-api/processors/8b63e4d0-eff2-3093-f4ad-0f1581e56674')
pdata=p.json()
pdata['component']['name']
#'Query SCF - Archive'
pdata['status']</pre>
			<p>Using the <a id="_idIndexMarker541"/>NiFi API, you can even look into the queues and <a id="_idIndexMarker542"/>download flowfiles. To get the contents of a flowfile you need to follow these steps:</p>
			<ol>
				<li>Make a listing request to the queue:<pre>q=requests.post('http://localhost:9300/nifi-api/flowfile-queues/295fc119-0172-1000-3949-54311cdb478e/listing-requests')
qdata=q.json()
listid=qdata['listingRequest']['id']  
# '0172100b-179f-195f-b95c-63ea96d151a3'</pre></li>
				<li>Then you will get the status of the listing request by passing the request (<code>listid</code>):<pre>url="http://localhost:9300/nifi-api/flowfile-queues/295fc119-0172-1000-3949-54311cdb478e/listing-requests/"+listid
ff=requests.get(url)
ffdata=ff.json()
ffid=ffdata['listingRequest']['flowFileSummaries'][0]['uuid']
#'3b2dd0fa-dfbe-458b-83e9-ea5f9dbb578f'</pre></li>
				<li>Lastly, you will call the flowfiles endpoint, pass the flowfile ID (<code>ffid</code>), and then request the content. The flowfile is JSON, so the result will be JSON:<pre>ffurl="http://localhost:9300/nifi-api/flowfile-queues/295fc119-0172-1000-3949-54311cdb478e/flowfiles/"+ffid+"/content"
download=requests.get(ffurl)
download.json()</pre><p>You <a id="_idIndexMarker543"/>now have <a id="_idIndexMarker544"/>the contents of an entire flowfile:</p><pre>{'request_type': {'related_issues_url': 'https://seeclickfix.com/api/v2/issues?lat=35.18151754051&amp;lng=-106.689667822892&amp;request_types=17877&amp;sort=distance', 'title': 'Missed Trash Pick Up', 'url': 'https://seeclickfix.com/api/v2/request_types/17877', 'organization': 'City of Albuquerque', 'id': 17877}, 'shortened_url': None, 'rating': 2, 'description': 'Yard waste in bags', 'created_at': '2020-05-08T17:15:57-04:00', 'opendate': '2020-05-08', 'media': {'image_square_100x100': None, 'image_full': None, 'video_url': None, 'representative_image_url': 'https://seeclickfix.com/assets/categories/trash-f6b4bb46a308421d38fc042b1a74691fe7778de981d59493fa89297f6caa86a1.png'}, 'private_visibility': False, 'transitions': {}, 'point': {'coordinates': [-106.689667822892, 35.18151754051], 'type': 'Point'}, 'updated_at': '2020-05-10T16:31:42-04:00', 'id': 7781316, 'lat': 35.18151754051, 'coords': '35.1815175405,-106.689667823', 'summary': 'Missed Trash Pick Up', 'address': '8609 Tia Christina Dr Nw Albuquerque NM 87114, United States', 'closed_at': '2020-05-08T17:24:55-04:00', 'lng': -106.689667822892, 'comment_url': 'https://seeclickfix.com/api/v2/issues/7781316/comments', 'reporter': {'role': 'Registered User', 'civic_points': 0, 'avatar': {'square_100x100': 'https://seeclickfix.com/assets/no-avatar-100-5e06fcc664c6376bbf654cbd67df857ff81918c5f5c6a2345226093147382de9.png', 'full': 'https://seeclickfix.com/assets/no-avatar-100-5e06fcc664c6376bbf654cbd67df857ff81918c5f5c6a2345226093147382de9.png'}, 'html_url': 'https://seeclickfix.com/users/347174', 'name': 'Gmom', 'id': 347174, 'witty_title': ''}, 'flag_url': 'https://seeclickfix.com/api/v2/issues/7781316/flag', 'url': 'https://seeclickfix.com/api/v2/issues/7781316', 'html_url': 'https://seeclickfix.com/issues/7781316', 'acknowledged_at': '2020-05-08T17:15:58-04:00', 'status': 'Archived', 'reopened_at': None}</pre></li>
				<li>You can clear queues by making a <code>drop</code> request:<pre>e=requests.post('http://localhost:9300/nifi-api/flowfile-queues/295fc119-0172-1000-3949-54311cdb478e/drop-requests')
edata=e.json()</pre></li>
				<li>You can <a id="_idIndexMarker545"/>pass the listing request ID to the end of the preceding URL to see that it worked. Or you can open NiFi and browse to the queue and you will see that it is empty.</li>
				<li>You can <a id="_idIndexMarker546"/>read the NiFi bulletin by calling the bulletin board endpoint:<pre>b=requests.get('http://localhost:9300/nifi-api/flow/bulletin-board')
bdata=b.json()
bdata</pre><p>The result is a single message saying I do not have Elasticsearch running. The output is as follows:</p><pre>{'bulletinBoard': {'bulletins': [{'id': 2520, 'groupId': '9466c3ca-4c6d-3884-ac72-af4a27919fb0', 'sourceId': 'e5fb7c4b-0171-1000-ac53-9fd365943393', 'timestamp': '17:15:44 MDT', 'canRead': True, 'bulletin': {'id': 2520, 'category': 'Log Message', 'groupId': '9466c3ca-4c6d-3884-ac72-af4a27919fb0', 'sourceId': 'e5fb7c4b-0171-1000-ac53-9fd365943393', 'sourceName': 'ElasticSCF', 'level': 'ERROR', 'message': 'PutElasticsearchHttp[id=e5fb7c4b-0171-1000-ac53-9fd365943393] Routing to failure due to exception: Failed to connect to localhost/127.0.0.1:9200: java.net.ConnectException: Failed to connect to localhost/127.0.0.1:9200', 'timestamp': '17:15:44 MDT'}}], 'generated': '17:16:20 MDT'}}</pre></li>
				<li>You can also read the counters you created earlier. The following code will send a <code>get</code> request to the counter endpoint:<pre>c=requests.get('http://localhost:9300/nifi-api/counters')
cdata=c.json()
cdata</pre><p>In the following code block, you will see that I have added an additional counter:</p><pre>{'counters': {'aggregateSnapshot': {'generated': '17:17:17 MDT', 'counters': [{'id': '6b2fdf54-a984-38aa-8c56-7aa4a544e8a3', 'context': 'UpdateCounter (01721000-179f-195f-6715-135d1d999e33)', 'name': 'SCFSplit', 'valueCount': 1173, 'value': '1,173'}, {'id': 'b9884362-c70e-3634-8e53-f0151396be0b', 'context': "All UpdateCounter's", 'name': 'SCFSplit', 'valueCount': 1173, 'value': '1,173'}, {'id': 'fb06d19f-682c-3f85-9ea2-f12b090c4abd', 'context': "All UpdateCounter's", 'name': 'SCFtoElasticsearch', 'valueCount': 162, 'value': '162'}, {'id': '72790bbc-3115-300d-947c-22d889f15a73', 'context': 'UpdateCounter (295f179f-0172-1000-ee63-c25c545f224e)', 'name': 'SCFtoElasticsearch', 'valueCount': 162, 'value': '162'}]}}}</pre></li>
				<li>Lastly, you <a id="_idIndexMarker547"/>can also get information on your reporting <a id="_idIndexMarker548"/>tasks. You can see the results in the bulletin, but this endpoint allows you to see their state; in this case, I have them stopped. The following code shows you how:<pre>rp=requests.get('http://localhost:9300/nifi-api/reporting-tasks/01721003-179f-195f-9cbe-27f0f068b38e')
rpdata=rp.json()
rpdata</pre><p>The information about the reporting task is as follows:</p><pre>{'revision': {'clientId': '2924cbec-0172-1000-ab26-103c63d8f745', 'version': 8}, 'id': '01721003-179f-195f-9cbe-27f0f068b38e', 'uri': 'http://localhost:9300/nifi-api/reporting-tasks/01721003-179f-195f-9cbe-27f0f068b38e', 'permissions': {'canRead': True, 'canWrite': True}, 'bulletins': [], 'component': {'id': '01721003-179f-195f-9cbe-27f0f068b38e', 'name': 'MonitorDiskUsage', 'type': 'org.apache.nifi.controller.MonitorDiskUsage', 'bundle': {'group': 'org.apache.nifi', 'artifact': 'nifi-standard-nar', 'version': '1.12.1'}, 'state': 'STOPPED', 'comments': '', 'persistsState': False, 'restricted': False, 'deprecated': False, 'multipleVersionsAvailable': False, 'schedulingPeriod': '5 mins', 'schedulingStrategy': 'TIMER_DRIVEN', 'defaultSchedulingPeriod': {'TIMER_DRIVEN': '0 sec', 'CRON_DRIVEN': '* * * * * ?'}, 'properties': {'Threshold': '1%', 'Directory Location': '/home/paulcrickard/nifi-1.12.1', 'Directory Display Name': 'MyDrive'}, 'descriptors': {'Threshold': {'name': 'Threshold', 'displayName': 'Threshold', 'description': 'The threshold at which a bulletin will be generated to indicate that the disk usage of the partition on which the directory found is of concern', 'defaultValue': '80%', 'required': True, 'sensitive': False, 'dynamic': False, 'supportsEl': False, 'expressionLanguageScope': 'Not Supported'}, 'Directory Location': {'name': 'Directory Location', 'displayName': 'Directory Location', 'description': 'The directory path of the partition to be monitored.', 'required': True, 'sensitive': False, 'dynamic': False, 'supportsEl': False, 'expressionLanguageScope': 'Not Supported'}, 'Directory Display Name': {'name': 'Directory Display Name', 'displayName': 'Directory Display Name', 'description': 'The name to display for the directory in alerts.', 'defaultValue': 'Un-Named', 'required': False, 'sensitive': False, 'dynamic': False, 'supportsEl': False, 'expressionLanguageScope': 'Not Supported'}}, 'validationStatus': 'VALID', 'activeThreadCount': 0, 'extensionMissing': False}, 'operatePermissions': {'canRead': True, 'canWrite': True}, 'status': {'runStatus': 'STOPPED', 'validationStatus': 'VALID', 'activeThreadCount': 0}}</pre></li>
			</ol>
			<p>With these <a id="_idIndexMarker549"/>NiFi endpoints, you can collect information <a id="_idIndexMarker550"/>on your system, on process groups, on processors, and on queues. You can use this information to build your own monitoring systems or create dashboards. The API has a lot of potential—you could even call the API using NiFi itself.</p>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor107"/>Summary</h1>
			<p>In this chapter, you have learned how to use the NiFi GUI to monitor your data pipelines using the status bar, the bulletin, and counters. You also learned how to add processors that can send information to you inside your data pipeline. With the <code>PutSlack</code> processor, you were able to send yourself direct messages when there was a failure, and you passed data from the flowfile in the message with the NiFi expression language. Lastly, you learned how to use the API to write your own monitoring tools and grab the same data as is in the NiFi GUI—even reading the contents of a single flowfile.</p>
			<p>In the next chapter, you will learn how to deploy your production pipelines. You will learn how to use processor groups, templates, versions, and variables to allow you to import data pipelines to a production NiFi instance with minimal configuration.</p>
		</div>
	</body></html>