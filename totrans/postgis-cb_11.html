<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Using Desktop Clients</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Adding PostGIS layers – QGIS</li>
<li>Using the Database Manager plugin <span>–</span> QGIS</li>
<li>Adding PostGIS layers <span>–</span> OpenJUMP GIS</li>
<li>Running database queries <span>–</span> OpenJUMP GIS</li>
<li>Adding PostGIS layers <span>–</span> gvSIG</li>
<li>Adding PostGIS layers <span>–</span> uDig</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>At a minimum, desktop GIS programs allow you to visualize data from a PostGIS database. This relationship gets more interesting with the ability to edit and manipulate data outside of the database and in a dynamic <em>play</em> environment.</p>
<p>Make a change, see a change! For this reason, visualizing the data stored in PostGIS is often critical for effective spatial database management—or at least as a now-and-again sanity check. This chapter will demonstrate both dynamic and static relationships between your database and desktop clients.</p>
<p>Regardless of your experience level or role in the geospatial community, you should find at least one of the four GIS programs serviceable as a potential intermediate staging environment between your PostGIS database and end product.</p>
<p>In this chapter, we will connect to PostGIS using the following desktop GIS programs: <strong>QGIS</strong>, <strong>OpenJUMP GIS</strong>, <strong>gvSIG</strong>, and <strong>uDig</strong>.</p>
<p>Once connected to PostGIS, extra emphasis will be placed on some of the more sophisticated functionalities offered by <kbd>QGIS</kbd> and <kbd>OpenJUMP GIS</kbd> using the <strong>Database Manager</strong> (<strong>DB Manager</strong>) plugin and data store queries, respectively.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding PostGIS layers – QGIS</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will establish a connection to our PostGIS database in order to add a table as a layer in <strong>QGIS</strong> (formerly known as <strong>Quantum GIS</strong>). Viewing tables as layers is great for creating maps or simply working on a copy of the database outside the database.</p>
<p>Please navigate to the following site to install the latest version LTR of QGIS (2.18 – Las Palmas at the time of writing):</p>
<p><a href="http://qgis.org/en/site/"><span class="URLPACKT">http://qgis.org/en/site/</span></a></p>
<p>On this page, click on <span class="packt_screen">Download Now</span> and you will be able to choose a suitable operating system and the relevant settings. QGIS is available for Android, Linux, macOS X, and Windows. You might also be inclined to click on <span class="packt_screen">Discover QGIS</span> to get an overview of basic information about the program along with features, screenshots, and case studies.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To begin, create the schema for this chapter as <kbd>chp11</kbd>; then, download data from the U.S. Census Bureau's FTP site:</p>
<p><a href="http://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip"><span class="URLPACKT">http://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip</span></a></p>
<p>The shapefile is <kbd>All Lines</kbd> for Cuyahoga county in Ohio, which consist of roads and streams among other line features.</p>
<div class="packt_tip">Extract the ZIP file to your working directory and then load it into your database using <kbd>shp2pgsql</kbd>. Be sure to specify the spatial reference system, EPSG/SRID: 4269. When in doubt about using projections, use the service provided by the folks at OpenGeo at the following website:<br/>
<a href="http://prj2epsg.org/search"><span class="URLPACKT">http://prj2epsg.org/search</span></a></div>
<p>Use the following command to generate the SQL to load the shapefile in a table of the <kbd>chp11</kbd> schema:</p>
<pre><strong>shp2pgsql -s 4269 -W LATIN1 -g the_geom -I tl_2012_39035_edges.shp chp11.tl_2012_39035_edges &gt; tl_2012_39035_edges.sql</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Now it's time to give the data we downloaded a look using QGIS. We must first create a connection to the database in order to access the table. Get connected and add the table as a layer by following the ensuing steps:</p>
<ol>
<li>Click on the Add PostGIS Layers icon:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b26071bf-5890-4d16-8b5b-b3b19495070a.png" style="width:12.17em;height:11.33em;"/></div>
<ol start="2">
<li>Click on the <span class="packt_screen">New</span> button below the <span class="packt_screen">Connections</span> drop-down menu.</li>
</ol>
<p> </p>
<ol start="3">
<li>Create a new PostGIS connection. After the <span class="packt_screen">Add PostGIS Table(s)</span> window opens, create a name for the connection and fill in a few parameters for your database, including <span class="packt_screen">Host</span>, <span class="packt_screen">Port</span>, <span class="packt_screen">Database</span>, <span class="packt_screen">Username</span>, and <span class="packt_screen">Password</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/831f624c-973a-413d-baf5-803c1d3e7aca.png" style="width:28.67em;height:39.92em;"/></div>
<ol start="4">
<li>Once you have entered all of the pertinent information for your database, click on the <span class="packt_screen">Test </span><span class="packt_screen">Connection</span> button to verify that the connection is successful. If the connection is not successful, double-check for typos and errors. Additionally, make sure you are attempting to connect to a PostGIS-enabled database.</li>
<li>If the connection is successful, go ahead and check the <span class="packt_screen">Save Username</span> and <span class="packt_screen">Save Password</span> checkboxes. This will prevent you from having to enter your login information multiple times throughout the exercise.</li>
</ol>
<p> </p>
<ol start="6">
<li>Click on <span class="packt_screen">OK</span> at the bottom of the menu to apply the connection settings. Now you can connect!</li>
</ol>
<p style="padding-left: 60px">Make sure the name of your PostGIS connection appears in the drop-down menu and then click on the <span class="packt_screen">Connect</span> button. If you choose not to store your username and password, you will be asked to submit this information every time you try to access the database.</p>
<p style="padding-left: 60px">Once connected, all schemas within the database will be shown and the tables will be made visible by expanding the target schema.</p>
<ol start="7">
<li>Select the table(s) to be added as a layer by simply clicking on the table name or anywhere along its row. Selection(s) will be highlighted in blue. To deselect a table, click on it a second time and it will no longer be highlighted. Select the <kbd>tl_2012_39035_edges</kbd> table that was downloaded at the beginning of the chapter and click on the <span class="packt_screen">Add</span> button, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6a7a27fd-eafb-4886-9a54-78dc4ad9434c.png" style="width:51.83em;height:33.42em;"/></div>
<ol start="8">
<li>A subset of the table can also be added as a layer. This is accomplished by double-clicking on the desired <span class="packt_screen">table name</span>.</li>
<li>The <span class="packt_screen">Query </span><span class="packt_screen">Builder</span> window will open, which aids in creating simple SQL <kbd>WHERE</kbd> clause statements. Add the roads by selecting the records where <kbd>roadflg = Y</kbd>. This can be done by typing a query or using the buttons within <span class="packt_screen">Query </span><span class="packt_screen">Builder</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c48c8e0a-9196-4fc7-8869-33b2db5b8a1f.png" style="width:46.50em;height:34.17em;"/></div>
<ol start="10">
<li>Click on the <span class="packt_screen">OK</span> <span class="CaptionCharacters">button</span> followed by the <span class="packt_screen">Add</span> button. A subset of the table is now loaded into QGIS as a layer. The layer is strictly a static, temporary copy of your database. You can make whatever changes you like to the layer and not affect the database table.</li>
</ol>
<p style="padding-left: 60px">The same holds true the other way around. Changes to the table in the database will have no effect on the layer in QGIS.</p>
<p style="padding-left: 60px">If needed, you can save the temporary layer in a variety of formats, such as DXF, GeoJSON, KML, or SHP. Simply right-click on the layer name in the <span class="packt_screen">Layers</span> panel and click on <span class="packt_screen">Save As</span>. This will then create a file, which you can recall at a later time or share with others.</p>
<p style="padding-left: 60px">The following screenshot shows the Cuyahoga county road network:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/89438422-74c2-4263-b088-2eb5b2e3f8d9.png" style="width:49.58em;height:30.25em;"/></div>
<p style="padding-left: 60px">You may also use the QGIS <span class="packt_screen">Browser Panel</span> to navigate through the now connected PostGIS database and list the schemas and tables. This panel allows you to double-click to add spatial layers to the current project, providing a better user experience not only of connected databases, but on any directory of your machine:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/db0b2deb-982a-4532-bca1-d8b3863eb625.png" style="width:20.08em;height:24.67em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>You have added a PostGIS layer into QGIS using the built-in <span class="packt_screen">Add PostGIS Table</span> GUI. This was achieved by creating a new connection and entering your database parameters.</p>
<p>Any number of database connections can be set up simultaneously. If working with multiple databases is more common for your workflows, saving all of the connections into one XML file (see the tip in the preceding section) would save time and energy when returning to these projects in QGIS.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Database Manager plugin – QGIS</h1>
                </header>
            
            <article>
                
<p><strong>Database Manager</strong> (<strong>DB Manager</strong>) allows for a more sophisticated relationship with PostGIS by allowing users to interact with the database in a variety of ways. The plugin mimics some of the core functionality of pgAdmin with the added benefit of data visualization.</p>
<p>In this recipe, we will use DB Manager to create, modify, and delete items within the database and then tinker with the SQL window. By the end of this section, you will be able to do the following:</p>
<ul>
<li>Navigate to the DB Manager menu</li>
<li>Create, modify, and delete database schemas and tables</li>
<li>Run SQL queries to add new QGIS layers or create new tables in the database</li>
</ul>
<p>QGIS needs to be installed for this recipe. Please refer to the first recipe in this chapter for information on where to download the installer.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's make sure the plugin is enabled and connected to the database.</p>
<ol>
<li>Click on the <span class="packt_screen">Plugins</span> menu located on the QGIS menu bar and select <span class="packt_screen">Manage </span><span class="packt_screen">and </span><span class="packt_screen">Install </span><span class="packt_screen">Plugins</span> from the drop-down menu, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/626a2bfb-e4c1-4f20-9def-3f62101c2c0d.png" style="width:17.17em;height:7.50em;"/></div>
<ol start="2">
<li>The QGIS <span class="packt_screen">Plugin </span><span class="packt_screen">Manager</span> window will open. Search for <span class="packt_screen">DB Manager</span> in the list of plugins and make sure it is checked (enabled), as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/ed24d00a-75b3-4bb7-97b4-235340cfbcad.png" style="width:47.83em;height:37.00em;"/></div>
<ol start="3">
<li>Now that <span class="packt_screen">DB Manager</span> is enabled, let us open the plugin and check the status of the database connection. Open <span class="packt_screen">DB Manager</span> by navigating to <span class="packt_screen">Database</span> | <span class="packt_screen">DB </span><span class="packt_screen">Manager</span> from the QGIS menu bar, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b911de78-2e8c-4c98-97a3-473be68c91d6.png" style="width:35.17em;height:5.42em;"/></div>
<ol start="4">
<li>Expand the <span class="packt_screen">PostGIS</span> directory within the <span class="packt_screen">Tree</span> window of DB Manager. The PostGIS connection created in the last recipe will appear. Expand the connection to view your schema(s) and table(s). You will be asked for a username and password if you opted not to save your credentials.<br/>
On the <span class="packt_screen">Info</span> tab above the main window, you can view information about the data, such as spatial reference, geometry type, field names, field types, and much more, as in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/92bc79fe-2f35-44e1-876b-ba67f076a342.png" style="width:49.42em;height:35.50em;"/></div>
<p>A PostGIS connection is not in place if you are unable to expand the <span class="packt_screen">PostGIS</span> menu. If you need to establish a connection, refer to <em>steps 1</em> to <em>4</em> in the <em>Adding </em><em>PostGIS </em><em>layers – QGIS</em> recipe. The connection must be established before using DB Manager.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Navigate to the <span class="packt_screen">DB Manager</span> menu and carry out the following steps:</p>
<ol>
<li>Select the <kbd>tl_2012_39035_edges</kbd> table in the <span class="packt_screen">Tree</span> window.</li>
<li>Next, click on the <span class="packt_screen">Table</span> tab to view the actual data table, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/b3ad86db-2f95-47d5-9047-9a16165d967f.png" style="width:53.42em;height:38.33em;"/></div>
<ol start="3">
<li>The final tab, <span class="packt_screen">Preview</span>, is for visualizing the data, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/4cdf1aec-89e7-4189-8cb5-079dc27871f8.png" style="width:51.67em;height:33.92em;"/></div>
<p>To create, modify, and delete database schemas and tables, follow the ensuing steps:</p>
<ol>
<li>First, create a new schema in the database to store data for this chapter. Select <span class="packt_screen">Schema</span> | <span class="packt_screen">Create schema</span> from the menu bar, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/eafbf5f7-0ea6-4509-9f66-d2c7f33f8bb5.png" style="width:23.08em;height:6.25em;"/></div>
<ol start="2">
<li>Enter <kbd>new_schema</kbd> as the schema name and then click on <span class="packt_screen">OK</span>. If you do not see the <kbd>new_schema</kbd> in the list, you may need to select the database connection in the <span class="packt_screen">Tree</span> window and click on the <span class="packt_screen">Refresh</span> button or press <em>F5</em> (see the following screenshot):</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/af0a05bd-3fc5-406e-8799-0f978720e04f.png" style="width:49.58em;height:18.33em;"/></div>
<div>
<ol start="3">
<li>Your new, empty schema will now be visible in the<span> </span><span class="packt_screen">Tree</span><span> </span>window:</li>
</ol>
</div>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/e1de2df4-8281-44ee-b186-00bd860f1cc0.png" style="width:12.50em;height:22.58em;"/></div>
<p>Now let's continue to work with our <span class="packt_screen">chp11</span> schema containing the <kbd>tl_2012_39035_edges</kbd> table. Let's modify the table name to something more generic. How about <kbd>lines</kbd>? You can change the table name by clicking on the table in the <span class="packt_screen">Tree</span> window. As soon as the text is highlighted and the cursor flashes, you can delete the existing name and enter the new name, <kbd>lines</kbd>.</p>
<p>Right now, our <kbd>lines</kbd> table's data is using degrees as the unit of measurement for its current projection (<em>EPSG: 4269</em>). Let's add a new geometry column using EPSG: 3734, which is a State Plane Coordinate system that measures projections in feet. To run SQL queries, follow the ensuing steps:</p>
<ol>
<li>Click on the <span class="packt_screen">SQL </span><span class="packt_screen">window</span> button in the DB Manager or press <em>F2</em>, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/04652e6b-8dfe-4956-8172-ff3b8c54486e.png" style="width:17.33em;height:7.08em;"/></div>
<ol start="2">
<li>Copy the following query into the SQL window and then click on <span class="packt_screen">Execute</span>:</li>
</ol>
<pre>      <strong>SELECT AddGeometryColumn('chp11', 'lines','geom_sp',3734,<br/>                               'MULTILINESTRING', 2);</strong>
      <strong>UPDATE "chp11".lines </strong>
      <strong>SET geom_sp = ST_Transform(the_geom,3734);</strong></pre>
<p style="padding-left: 60px">The query creates a new geometry column named <kbd>geom_sp</kbd> and then updates the geometry information by transforming the original geometry (<kbd>geom</kbd>) from EPSG 4269 to 3734, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d2b1a29e-7fb7-40c7-9209-0d0592283342.png" style="width:49.50em;height:19.42em;"/></div>
<ol start="3">
<li>Refresh the <kbd>chp11</kbd> schema and you'll notice that the table in the database now has two geometry columns that are treated independently in the <span class="packt_screen">Tree</span> window:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/03963bf6-a3ae-4ad9-bdb6-9cebb91af65c.png"/></div>
<p style="padding-left: 60px">The preceding screenshot shows the original geometry. The following screenshot shows the created geometry:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/512da5fb-a351-433f-8031-a1c2aa6cb010.png"/></div>
<ol start="4">
<li>For our next query, let us take a subset of the <kbd>lines</kbd> table. Similar to what we did in the preceding section, we will only look at the data about roads. However, this time, we can limit the columns that we want to load with the layer, as well as perform more complicated spatial queries. We'll apply a buffer of 10 feet using the new geometry column (<kbd>geom_sp</kbd>) by executing the following command:</li>
</ol>
<pre>      <strong>SELECT gid, ST_Buffer(geom_sp, 10) AS geom, fullname, roadflg <br/>      FROM "chp11".lines WHERE roadflg = 'Y'</strong></pre>
<p style="padding-left: 60px">Check the <span class="packt_screen">Load as new layer</span> checkbox and then select <span class="packt_screen">gid</span> as the unique ID and <span class="packt_screen">geom</span> as the geometry. Create a name for the layer and then click on <span class="packt_screen">Load Now!</span>, and what you'll see is shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/afd51f5d-8b22-476e-a114-b635509c5f7c.png"/></div>
<p style="padding-left: 60px">The query adds the result in QGIS as a temporary layer.</p>
<ol start="5">
<li>Now let us modify the query to create a table in the database, rather than load the query as a layer, by executing the following command:</li>
</ol>
<pre>      <strong>CREATE TABLE "chp11".roads_buffer_sp AS SELECT gid, <br/>      ST_Buffer(geom_sp, 10) AS geom, fullname, roadflg <br/>      FROM "chp11".lines WHERE roadflg = 'Y'</strong></pre>
<p style="padding-left: 60px">The following screenshot shows the Cuyahoga county road network:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9524b601-f99f-4484-a7cb-03fea31b84a1.png" style="width:45.25em;height:36.25em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Connecting to a PostGIS database (see the <em>Adding PostGIS layers – QGIS</em> recipe in this chapter) allows you to utilize the DB Manager plugin. Once DB Manager was enabled, we were able to toggle between the <span class="packt_screen">Info</span>, <span class="packt_screen">Table</span>, and <span class="packt_screen">Preview</span> tabs to efficiently view metadata, tabular data, and data visualization.</p>
<p>Next, we made changes to the database through the query window, running on the table lines of schema <kbd>chp11</kbd> in order to transform the projection. Note the autocomplete feature in the <span class="packt_screen">SQL Window</span>, which makes writing queries a breeze.</p>
<p>Changes to the database were made visible in DB Manager by refreshing the database connection.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding PostGIS layers – OpenJUMP GIS</h1>
                </header>
            
            <article>
                
<p>In this section, we will connect to PostGIS with OpenJUMP GIS (OpenJUMP) in order to add spatial tables as layers. Next, we will edit the temporary layer and update it in a new table in the database.</p>
<p>The <strong>JUMP</strong> in OpenJUMP stands for <strong>Java Unified Mapping Platform</strong>. To learn more about the program, or if you need to install the latest version, go to:</p>
<p><a href="http://www.openjump.org/"><span class="URLPACKT">http://www.openjump.org/</span></a></p>
<p>Click on the <span class="packt_screen">Download latest version</span> link (<span class="URLPACKT"><a href="http://sourceforge.net/projects/jump-pilot/files/OpenJUMP/1.12/">http://sourceforge.net/projects/jump-pilot/files/OpenJUMP/1.12/</a></span>) on the page to view the list of installers. Select the version that suits your operating system (<kbd>.exe</kbd> for Windows and <kbd>.jar</kbd> for Linux and mac OS). Detailed directions for installing OpenJUMP along with other documentation and information can be found on the OpenJUMP Wiki page at the following link:</p>
<p><a href="http://ojwiki.soldin.de/index.php?title=Main_Page"><span class="URLPACKT">http://ojwiki.soldin.de/index.php?title=Main_Page</span></a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We will be reusing and building upon data used in the <em>Adding PostGIS layers <span>–</span> QGIS</em> recipe. If you skipped over this recipe, you will want to do the following:</p>
<ol>
<li>Download the following ZIP file from the U.S. Census Bureau's FTP site:</li>
</ol>
<p style="padding-left: 60px"><a href="ftp://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip"><span class="URLPACKT">ftp://ftp2.census.gov/geo/tiger/TIGER2012/EDGES/tl_2012_39035_edges.zip</span></a></p>
<p style="padding-left: 60px">The shapefile is <kbd>All Lines</kbd> for Cuyahoga county in Ohio, which consist of roads and streams, among other line features.</p>
<ol start="2">
<li>Extract the ZIP file to your working directory and then load it into your database using <kbd>shp2pgsql</kbd>. Be sure to specify the spatial reference system, which is <em>EPSG: 4269</em>, and name the table <kbd>lines</kbd>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>The data source layer can be added by performing the following steps:</p>
<ol>
<li>Click on the <span class="packt_screen">Open</span> (folder) icon or go to <span class="packt_screen">File</span> | <span class="packt_screen">Open</span>.</li>
<li>Select <span class="packt_screen">Data Store Layer</span> from the left-hand-side menu, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/029250d9-fbdc-4950-bc8d-aaf2aa7904d7.png"/></div>
<ol start="3">
<li>Click on the icon to the right of the <span class="packt_screen">Connection</span> dropdown to open the connection manager.</li>
</ol>
<p> </p>
<ol start="4">
<li>Click on the <span class="packt_screen">Add</span> button. This will prompt a new window to appear in which you must enter your database parameters:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/686b004e-4f57-4ed4-a6f0-4df78ebe5d33.png" style="width:21.67em;height:18.25em;"/></div>
<ol start="5">
<li>Enter a name for the connection and then enter values for the following database parameters:</li>
</ol>
<ul>
<li style="list-style-type: none">
<ul>
<li><span class="packt_screen">Server/Host</span></li>
<li><span class="packt_screen">Port</span></li>
<li><span class="packt_screen">Database</span></li>
<li><span class="packt_screen">Username</span></li>
<li><span class="packt_screen">Password</span></li>
</ul>
</li>
</ul>
<ol start="6">
<li>Then click on <span class="packt_screen">OK</span>. You are now connected to the database.</li>
<li>Check for typos and errors if a connection error message appears. If the connection is successful, select the connection and click on <span class="packt_screen">OK</span>.</li>
</ol>
<p> </p>
<ol start="8">
<li>Now you can select the <span class="packt_screen">lines</span> table to add, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/abf16c6d-9278-49e7-aa68-52a750e30f60.png" style="width:48.92em;height:32.58em;"/></div>
<p style="padding-left: 60px">If multiple geometry columns exist, you may choose the one you want to use. Add the data's state plane coordinator geometry (<kbd>geom_sp</kbd>), as shown in the <em>Using the Database Manager plugin – QGIS</em> recipe.</p>
<p style="padding-left: 60px">Simple SQL <kbd>WHERE</kbd> clause statements can be used if only a subset of a table is needed.</p>
<ol start="9">
<li>Click on <span class="packt_screen">Finish</span> to load the dataset into the main window, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6dee57d2-c618-4dc4-ba0f-1c71a6072fe6.png"/></div>
<ol start="10">
<li>Now make a quick edit to the temporary layer and save it back to the database. Select the <span class="packt_screen">Editing Toolbox</span> button. When the toolbox is loaded, click on the Select Features Tool button (to the top-left corner of the screen), as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-315 image-border" src="assets/55fcbe8d-3b95-43a2-81a8-4a3ff96e8c2d.png" style="width:8.25em;height:11.08em;"/></div>
<ol start="11">
<li>Select some of the lines, as shown in the following screenshot, that look out of place on the map. In particular, the lines to the North of the county; these actually jet out into Lake Erie. You can select multiple lines by clicking and dragging a rectangle with the cursor or by holding <em><span class="KeyPACKT">Shift</span></em> while clicking on line segments. Hit the <em><span class="KeyPACKT">Delete</span></em> key (or <em>F<span class="KeyPACKT">n</span></em> + <em><span class="KeyPACKT">Delete</span></em> on macOS) once you have selected some lines to remove them from the data:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/9efc1ef2-1b6c-420d-b097-328f0f90b6c9.png"/></div>
<ol start="12">
<li>Save the changes made to the layer and replace the existing table in the database with the edited copy. Right-click on the layer name on the left panel and then select <span class="packt_screen">Save Dataset As</span>.</li>
<li>Select your PostGIS connection with the <span class="packt_screen">Connection</span> drop-down menu, choose the appropriate table name, and then make sure that the <span class="packt_screen">Create </span><span class="packt_screen">new </span><span class="packt_screen">or </span><span class="packt_screen">replace </span><span class="packt_screen">existing </span><span class="packt_screen">table</span> option is selected, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/62a54645-3a02-468e-b6bf-7d247383a221.png"/></div>
<ol start="14">
<li>Click on <span class="packt_screen">OK</span>; you have now successfully edited a PostGIS table in OpenJUMP.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We added a PostGIS layer in OpenJUMP using the <span class="packt_screen">Open Data Store Layer</span> menu. This was achieved after creating a new connection and entering our database parameters.</p>
<p>In the example, census data was added which included the boundary of Cuyahoga county. Part of the boundary advances into Lake Erie to the International Boundary with Canada. While technically correct, the water boundary is typically not used for practical mapping purposes. In this case, it's easy to visualize which data needs to be removed.</p>
<p>OpenJUMP allows us to easily see and delete records that should be deleted from the table. The selected lines were deleted, and the table was saved to the database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running database queries – OpenJUMP GIS</h1>
                </header>
            
            <article>
                
<p>Executing ad hoc queries in OpenJUMP is simple and offers a couple of unique features. Queries can be run on specific data selections, allowing for the manual control of the queried area without considering the attribution. Similarly, temporary fences (areas) can be drawn on the fly and the geometry of the surface can be used in queries. In this recipe, we will explore each of those cases.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Refer to the preceding recipe if you need to install OpenJUMP or require assistance connecting to a database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Carry out the following steps to run the data store query:</p>
<ol start="1">
<li>Navigate to <span class="packt_screen">File</span> | <span class="packt_screen">Run </span><span class="packt_screen">Datastore </span><span class="packt_screen">Query.</span> Choose the PostGIS connection from the <span class="packt_screen">Connection</span> drop-down menu or use the <span class="packt_screen">Connection Manager</span> utility if you are not linked to the database.</li>
<li>We'll create and name a polygon layer of the main streams in the region by executing the following query:</li>
</ol>
<pre>      <strong>SELECT gid, ST_BUFFER("chp11".lines.geom_sp, 75) <br/>      AS the_geom, fullname <br/>      FROM "chp11".lines WHERE fullname &lt;&gt; '' </strong><strong>AND hydroflg = 'Y'</strong></pre>
<p style="padding-left: 60px">The preceding query is shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign" style="color: black;font-size: 1em"><img src="assets/36774018-4013-4df8-9048-67eff2866ea8.png" style="width:49.42em;height:17.50em;"/></div>
<p style="padding-left: 60px">The preceding query selects the lines on the map that represent hydrology units such as <kbd>"hydroflg" = 'Y'</kbd> and streams. The selected stream lines (which use the State Plane geometry) are buffered by 75 feet, which should yield a result like that shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4c7f1a46-5c72-4472-a90f-ac11ae8cf4b5.png" style="width:32.33em;height:25.75em;"/></div>
<ol start="3">
<li>The <kbd>ST_Buffer</kbd> function uses the units of the data projection for buffering. So, if your data still has the original spatial reference <em>EPSG: 4269</em>, you will be buffering the lines by 75 degrees, and this will lead to very strange results indeed! Modify the following SQL query to transform your geometry:</li>
</ol>
<pre>      <strong>SELECT AddGeometryColumn('chp11', 'lines','geom_sp',3734,<br/>                               'MULTILINESTRING', 2);</strong>
      <strong>UPDATE "chp11".lines SET geom_sp = ST_Transform(geom,3734);</strong></pre>
<ol start="4">
<li>You'll then want to go back to <em>step 2</em> in order to create the buffer measured in feet.</li>
<li>Next, pan and zoom on the map and find two, separate polygons that are near each other.</li>
<li>Select the <span class="packt_screen">Fence</span> icon on the main menu, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6c0f9e38-2199-4436-8527-70881ad927c2.png"/></div>
<ol start="7">
<li>Draw a connection (overlapping a connection is fine) between the two unconnected polygons using the <span class="packt_screen">Fence</span> tool. Click once on the <span class="packt_screen">Fence</span> button to create a vertex and double-click on it once your polygon is complete.</li>
<li>Switch over to the Select Features Tool<span class="packt_screen">,</span> as shown in the following screenshot, and select the polygons that you drew on either side of the <span class="packt_screen">Fence</span> bridge; select multiple features by holding down the <em><span class="KeyPACKT">Shift</span></em> key:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ead4d152-0d8a-460b-b7b8-3e5bbbb2d13c.png"/></div>
<p style="padding-left: 60px">You should now have a fence junction between the selected polygons. You should see something similar to the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/079369ca-f78e-4fc4-975d-a8aa575db4c2.png" style="width:40.25em;height:18.58em;"/></div>
<ol start="9">
<li>Navigate to <span class="packt_screen">File</span> | <span class="packt_screen">Run </span><span class="packt_screen">Datastore </span><span class="packt_screen">Query</span> again.</li>
<li>This time, we will utilize the buttons to the right-hand side of the window to connect.</li>
</ol>
<p style="padding-left: 60px">Run <kbd>ST_UNION</kbd> on the selection and fence together so that the gap is filled. We do this with the following query:</p>
<pre>      <strong>SELECT ST_UNION(geom1, geom2) AS geom</strong></pre>
<p style="padding-left: 60px">Use the <span class="packt_screen">Selection</span> and <span class="packt_screen">Fence</span> buttons in place of <kbd>geom1</kbd> and <kbd>geom2</kbd> so that your query looks as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8f03cb87-d1d6-4789-aefd-738e015f0c59.png" style="width:38.92em;height:13.83em;"/></div>
<ol start="11">
<li>Click on <span class="packt_screen">OK</span> and view the query result by turning off the <span class="packt_screen">Main Streams</span> and <span class="packt_screen">Fence</span> layers, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/44d5f8e8-b118-49f1-864a-e615dc3f6166.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We added a buffered subset of a PostGIS layer in OpenJUMP using the <span class="packt_screen">Run Datastore Query</span> menu. We took lines from a database table and converted them to polygons to view them in OpenJUMP.</p>
<p>We then manually selected an area of interest that had two representative stream polygons disjointed from one another, the idea being that the streams would be, or are, connected in a natural state.</p>
<p>The <span class="packt_screen">Fence</span> tool was used to draw a freehand polygon between the streams. A <kbd>union</kbd> query was then performed to combine the two stream polygons and the fences. Fences allow us to create temporary tables for use in spatial queries executed against a database table.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding PostGIS layers – gvSIG</h1>
                </header>
            
            <article>
                
<p>gvSIG is a GIS package developed for the <strong>Generalitat Valenciana</strong> (<strong>gv</strong>) in Spain. SIG is the Spanish equivalent of GIS. Intended for use all over the world, gvSIG is available in more than a dozen languages.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Installers, documentation, and more details for gvSIG can be found at the following website:</p>
<p><a href="http://www.gvsig.org/web/"><span class="URLPACKT">http://www.gvsig.org/web/</span></a></p>
<p>To download gvSIG, click on the latest version (gvSIG 2.0 at the time of writing). The all-included version is recommended on the gvSIG site. Be careful while selecting the <kbd>.exe</kbd> or <kbd>.bin</kbd> versions; otherwise, you may download the program in a language that you don't understand.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>The GeoDB layer can be added by following the ensuing steps:</p>
<ol>
<li>Select <span class="packt_screen">View</span> as the document type in the <span class="packt_screen">Project manager</span> section and then click on the <span class="packt_screen">New</span> button. A blank view (canvas) will open.</li>
<li>Click on the <span class="packt_screen">Add </span><span class="packt_screen">Layer</span> button on the menu bar, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a5e2c537-3cae-46dd-a336-acd3587bf4f7.png"/></div>
<ol start="3">
<li>Next, select the <span class="packt_screen">GeoDB</span> tab and click on the button to the right of the <span class="packt_screen">Choose </span><span class="packt_screen">connection</span> drop-down menu.</li>
</ol>
<p> </p>
<ol start="4">
<li>Enter the values in <span class="packt_screen">Connection parameters</span> and make sure to select <span class="packt_screen">PostgreSQLExplorer</span> as the value for <span class="packt_screen">Driver</span><span class="packt_screen">,</span> as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1d20a043-6a48-4c94-94e0-fb83260c2083.png" style="width:32.67em;height:35.33em;"/></div>
<ol start="5">
<li>Click on <span class="packt_screen">OK</span>. All of your tables should appear in <span class="packt_screen">Choose </span><span class="packt_screen">table</span>. One or many tables can be added at a time. You can also do the following:
<ul>
<li>Choose the columns you want to add in each layer</li>
<li>Select the geometry column to be used in the event of multiple geometries being present</li>
<li>Give each layer a unique name</li>
<li>Perform SQL <kbd>WHERE</kbd> clause queries to load a subset of a dataset</li>
</ul>
</li>
</ol>
<p style="padding-left: 60px">You can see these steps performed in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/305fb5c1-1470-4063-9a0c-7a302b824ead.png" style="width:33.00em;height:35.33em;"/></div>
<ol start="6">
<li>Click on <span class="packt_screen">OK</span> when you're ready. The data will load in the new view that was created, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/44f295be-29df-4a8e-a4a5-200d9857c26e.png" style="width:50.50em;height:30.42em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>PostGIS layers were added to gvSIG using the <span class="packt_screen">Add Layer</span> menu. The <span class="packt_screen">GeoDB</span> tab allowed us to set the PostGIS connection. After choosing a table, many options are afforded with gvSIG. The layer name can be aliased to something more meaningful and unnecessary columns can be omitted from the table.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding PostGIS layers – uDig</h1>
                </header>
            
            <article>
                
<p>A hallmark of the <strong>User-friendly Desktop Internet GIS</strong> (<strong>uDig</strong>) program built with <strong>Eclipse</strong> is that it can be used as a standalone application or a plugin for existing applications. Details on the uDig project as well as installers can be found at the following website:</p>
<p><a href="http://udig.refractions.net/"><span class="URLPACKT">http://udig.refractions.net/</span></a></p>
<p>Click on <span class="packt_screen">Downloads</span> at the preceding website to view the list of versions and installers. At the time of writing, 2.0.0.RC1 is the latest stable version. uDig is supported by Windows, macOS X, and Linux.</p>
<p>In this recipe, we will quickly connect to a PostGIS database and then add a layer to uDig.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Carry out the following steps:</p>
<ol>
<li>Navigate to <span class="packt_screen">File</span> | <span class="packt_screen">New Layer</span> from the main menu, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/813d5203-fb25-40e6-81ae-8f1217d1d59f.png" style="width:35.42em;height:24.58em;"/></div>
<ol start="2">
<li>Select <span class="packt_screen">PostGIS</span> as the data source and click on the <span class="packt_screen">Next</span> button to continue, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b59fcf07-0181-4a1a-bc28-4ceb0dd852d0.png" style="width:36.92em;height:32.00em;"/></div>
<ol start="3">
<li>Fill in your PostGIS connection parameters and then click on the <span class="packt_screen">Next</span> button, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ab3814b1-b945-4942-a94a-c67388985bfc.png" style="width:41.75em;height:36.17em;"/></div>
<ol start="4">
<li>Select the target database in the <span class="packt_screen">Database</span> drop-down menu. Click on the <span class="packt_screen">List</span> button to view all of the tables from the database that have valid geometries. Then, check the checkboxes for one or more tables to add them as layers, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3a716ed5-9842-4fbe-9384-85f423e66fa4.png" style="width:39.92em;height:35.92em;"/></div>
<ol start="5">
<li>Click on <span class="packt_screen">Finish</span> and your data will be loaded in the <span class="packt_screen">Map</span> window.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6607cb6b-ae14-45c9-955c-8210a672a2ef.png" style="width:38.50em;height:39.75em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">New Layer</span> menu in uDig generates a hefty list of possible sources that can be added. PostGIS was set as the database and your database parameters were entered. uDig was then connected to the database. Clicking on <span class="packt_screen">List</span> displays the total number of tables available in the connected database. Any number of tables can be added at once.</p>


            </article>

            
        </section>
    </body></html>