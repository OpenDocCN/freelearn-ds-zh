- en: Chapter 6. Answering Questions with Visibility Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章. 使用可视性分析回答问题
- en: 'Visibility analysis is a valuable part of GIS analysis that answers questions
    such as "What can be seen from this location point?" In this chapter, you will
    be exposed to the basics of visibility analysis through defining the roof that
    provides the most scenic view of an area, and where the viewing platform can potentially
    be located. Throughout the chapter, you will learn how to do the following:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 可视性分析是GIS分析中的一个宝贵部分，它回答了诸如“从这个位置点可以看到什么？”等问题。在本章中，您将通过定义提供该区域最佳景观视角的屋顶以及潜在观景平台的位置，接触到可视性分析的基本知识。在整个章节中，您将学习以下内容：
- en: Prepare data to represent urban landscape features
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备数据以表示城市景观特征
- en: Select potential observation points
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择潜在的观测点
- en: Compute the viewsheds to find the most scenic points
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算可视域以找到最美丽的点
- en: Present the results in a 3D scene
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在3D场景中展示结果
- en: Before we start, we will explore some essential principles of viewshed analysis.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始之前，我们将探讨一些可视性分析的基本原则。
- en: The basics of visibility analysis
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可视性分析的基本原理
- en: 'The aim of visibility analysis is to produce a coverage of an area that can
    be seen from a specified location. This coverage is called a **viewshed**, which
    is why the terms **visibility analysis** and **viewshed analysis** are used interchangeably.
    To perform a simple visibility analysis, you need to define at least two components:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 可视性分析的目标是从指定位置生成一个可见区域的覆盖。这个覆盖称为**可视域**，这就是为什么使用**可视性分析**和**可视域分析**这两个术语可以互换的原因。要执行简单的可视性分析，您至少需要定义以下两个组件：
- en: '**Observation point**: A point that represents an observer''s position and
    for which visibility is being analyzed'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**观测点**：代表观察者位置且正在分析可视性的点'
- en: '**DEM**: This represents irregularities in the earth''s surface and is used
    to examine visibility along the line of sight'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DEM**：这代表地球表面的不规则性，并用于检查视线方向上的可视性'
- en: 'The idea underlying the process of this analysis is to compare the height of
    the observation point against the height of earth''s surface point along the given
    line of sight. If the height of the surface point is less than that of the observation
    point, then it will be seen from the current position; if it is higher, the visibility
    line will be blocked. Similarly, all points within a certain radius are compared
    against the observation point and divided into the two categories, as follows:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 这种分析背后的思想是将观测点的海拔高度与给定视线方向上的地球表面点的海拔高度进行比较。如果表面点的海拔低于观测点，则从当前位置可以看到它；如果它更高，则可视线路径将被阻挡。同样，所有在一定半径内的点都与观测点进行比较，并分为以下两类：
- en: Visible, with the height lower than the observation height and located below
    the visibility line
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可见，高度低于观测高度且位于可视线下方
- en: Invisible, with the height higher than the observation height and located above
    the visibility line
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不可见，高度高于观测高度且位于可视线上方
- en: 'The main output of visibility analysis is a binary true/false viewshed coverage
    that usually includes visible points and excludes invisible points. Depending
    on the algorithm used and the capacity of GIS, this basic analytical approach
    can be modified and improved by the following features and outputs:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 可视性分析的主要输出是一个二元真/假可视域覆盖，通常包括可见点并排除不可见点。根据所使用的算法和GIS的能力，可以通过以下特性和输出修改和改进这种基本分析方法：
- en: Instead of a single observation point, multiple points and even lines can be
    used
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与单一观测点不同，可以使用多个点甚至线条
- en: Visibility relationships between several objects can be analyzed, and then intervisibility
    coverage is produced as the output
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以分析几个物体之间的可视关系，然后生成互视覆盖作为输出
- en: Conversely to the assessment of a viewshed for the current observation point,
    the earth's surface can be analyzed to provide information about points and areas
    from which a certain object can be seen
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相反，对于当前观测点的可视域评估，可以分析地球表面以提供有关可以从特定位置看到某些物体的点和区域的信息
- en: A line of the horizon can be modeled as the cumulative edge of visibility zones
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地平线线可以建模为可视区域累积边缘
- en: Views can be bound by a horizontal or vertical viewing angle or azimuthal values
    that limit extension of visibility lines
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 视野可以由水平或垂直视角或方位值限制，这些值限制了可视线的延伸
- en: The earth's curvature and atmospheric refraction can be taken into account to
    simulate more realistic results
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地球的曲率和大气折射可以考虑到模拟更真实的结果
- en: The most typical practical application of visibility analysis is in placement
    of communication towers, where instead of visibility, signal penetration is modeled.
    Viewsheds are also of great use in territorial and urban planning. For example,
    some features such as factories or landfills are expected to be hidden from the
    human' eye because of their unsightly appearance. In this case, the area undergoes
    a visibility analysis to find places from where such kinds of objects can't be
    seen. The more the blind spots associated with a certain point, the better it
    is for the object's location. Furthermore, instead of hiding some objects, viewsheds
    are used to detect scenery points that provide the most spectacular view of an
    area. This knowledge is then used for optimal placement of the sight places, which
    is what we are going to do in this chapter.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 可视性分析最典型的实际应用是在通信塔的放置中，而不是可视性，而是模拟信号穿透。视域在领土和城市规划中也非常有用。例如，一些特征，如工厂或垃圾填埋场，由于外观不雅，预计将不会被人眼看到。在这种情况下，该区域将进行可视性分析，以找到无法看到这类物体的地方。与某个点相关的盲点越多，对物体的位置就越有利。此外，除了隐藏某些物体外，视域还用于检测提供该区域最壮观景观的景观点。然后，这种知识被用于最佳放置观景点，这正是我们将在本章中要做的。
- en: Step 1 – converting a buildings' vector layer to raster
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 1 步 – 将建筑矢量图层转换为栅格
- en: 'We are going to deal with a highly urbanized landscape, whose primary features
    have been greatly transformed by humans. In the context of visibility analysis,
    this means that lines of sight are blocked mainly by buildings, while the original
    relief features play only a minor role. In our dataset, we have two layers that
    describe the area of interest, exterior, and appearance:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将处理一个高度城市化的景观，其主要特征已经受到人类的极大改造。在可视性分析的情况下，这意味着视线主要被建筑物阻挡，而原始的地形特征只扮演了较小的角色。在我们的数据集中，我们有两个图层描述感兴趣的区域、外观和特征：
- en: '`lidar_dem`: This represents the bare earth only, and provides a description
    of the general relief'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lidar_dem`：这仅代表裸地，并提供了地形的一般描述'
- en: '`building_footprints`: These are polygons that depict all buildings, and they
    also contain information about a building''s height in feet above the bare earth''s
    surface in the `height_roo` attribute field'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`building_footprints`：这些是多边形，描绘了所有建筑物，并且它们还包含有关建筑物在裸地表面以上英尺高度的信息，这些信息存储在 `height_roo`
    属性字段中'
- en: 'We need to add their values in order to obtain a meaningful result, but these
    layers use different data models: DEM is a raster coverage, and building footprints
    is a vector polygon layer. That is why before adding them, we should first take
    layers to a single common data model. In GIS, calculations for coverages are typically
    performed using raster algebra, which means that the `building_footprints` vector
    layer should be converted into a raster, or rasterized. Additionally, if we want
    this raster layer to contain data about building''s height, the `height_roo` attribute
    field should be used as the provider of *Z* values.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要添加它们的值以获得有意义的结果，但这些图层使用不同的数据模型：DEM 是栅格覆盖，而建筑足迹是矢量多边形图层。这就是为什么在添加之前，我们应该首先将图层转换为单一的共同数据模型。在
    GIS 中，覆盖物的计算通常使用栅格代数进行，这意味着 `building_footprints` 矢量图层应该转换为栅格，或者进行栅格化。此外，如果我们想使这个栅格层包含有关建筑高度的数据，应使用
    `height_roo` 属性字段作为 *Z* 值的提供者。
- en: 'It is also important that a newly created building footprint''s raster has
    the same extent and resolution as `lidar_dem`. To get this information about `lidar_dem`,
    go to **Layer Properties** | **Metadata**. At the bottom of the window, you will
    see the **Properties** scrolling window section, which contains all of the information
    important to know in order to work with rasters, namely **Band 1** (statistics),
    **Dimensions** (number of rows and columns), **Origin** (coordinates of the bottom-left
    corner), and so on. The parameters of particular interest to us are as follows:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 同样重要的是，新建建筑足迹的栅格应该与 `lidar_dem` 具有相同的范围和分辨率。要获取有关 `lidar_dem` 的这些信息，请转到 **图层属性**
    | **元数据**。在窗口底部，您将看到 **属性** 滚动窗口部分，其中包含所有重要的信息，以便与栅格一起工作，即 **波段 1**（统计数据）、**维度**（行数和列数）、**原点**（左下角的坐标）等等。对我们特别感兴趣的参数如下：
- en: '**Pixel Size**: This contains the vertical and horizontal lengths of the pixel''s
    sides. Usually, the values are equal, which means that the pixel is a square;
    but sometimes, it can be rectangular, with unequal values.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**像素大小**：这包含像素边的垂直和水平长度。通常，这些值相等，这意味着像素是正方形；但有时，它可以是矩形，具有不等的值。'
- en: '**Layer extent (layer original source projection)**: This represents the minimum
    and maximum horizontal (*x*) and vertical (*y*) values of the raster extent, that
    is, the raster bounding box''s northern, southern, eastern, and western limits
    in the layer''s original coordinate reference system.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**图层范围（图层原始源投影）**：这表示栅格范围的水平和垂直（*x*）和垂直（*y*）的最小和最大值，即栅格边界框在图层原始坐标参考系统中的北部、南部、东部和西部限制。'
- en: 'The following screenshot shows the described parameters for the `lidar_dem`
    layer:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的截图显示了`lidar_dem`层所描述的参数：
- en: '![Step 1 – converting a buildings'' vector layer to raster](img/image00442.jpeg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![步骤 1 – 将建筑矢量图层转换为栅格](img/image00442.jpeg)'
- en: 'To rasterize a layer, go to **Raster** | **Conversion** | **Rasterize (Vector
    to Raster)**. In the dialog window, adjust the following parameters:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 要将图层栅格化，请转到**栅格** | **转换** | **栅格化（矢量到栅格）**。在对话框窗口中，调整以下参数：
- en: '**Input file (shapefile)**: This is a shapefile to be rasterized. Select `building_footprints`
    from the drop-down list.'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**输入文件（shapefile）**：这是一个要栅格化的shapefile。从下拉列表中选择`building_footprints`。'
- en: '**Attribute field**: This defines an attribute field with the values to be
    burned into an output raster. Select `HEIGHT_ROO` from the drop-down list.'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**属性字段**：这定义了一个要烧录到输出栅格中的值属性字段。从下拉列表中选择`HEIGHT_ROO`。'
- en: '**Output file for rasterized vectors (raster)**: There are two possible options
    in this field. You can select an already existing file, and patches of vector
    geometry footprints with the selected values will be burned into it. It is very
    convenient if you have, for example, some gaps in the original raster layer and
    want to fill them with some values from the vector layer (such as elevation and
    surface level of water bodies). But we have to deal with the buildings'' relative
    height above the bare earth level. This means that, in order to summarize them
    with DEM, building footprints should be rasterized as an individual layer. Navigate
    to your working directory and type `building.tif` as a new layer name. You will
    be shown this message: **The output file doesn''t exist. You must set up the output
    size or resolution to create it.**. Click on **OK** and proceed to the following
    stage:![Step 1 – converting a buildings'' vector layer to raster](img/image00443.jpeg)'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**输出栅格化矢量文件（栅格）**：在此字段中有两个可能的选项。您可以选择一个已存在的文件，并且具有所选值的矢量几何足迹补丁将被烧录到其中。如果您例如有一些原始栅格层中的空隙，并希望用矢量层中的某些值（如水体的高程和水面）填充它们，这将非常方便。但我们必须处理建筑物相对于裸地面的相对高度。这意味着，为了与DEM汇总，建筑物足迹应作为单独的图层进行栅格化。导航到您的工作目录，并输入`building.tif`作为新的图层名称。您将看到此消息：**输出文件不存在。您必须设置输出大小或分辨率才能创建它**。单击**确定**并继续到下一阶段：![步骤
    1 – 将建筑矢量图层转换为栅格](img/image00443.jpeg)'
- en: 'In the previous steps, you defined some major options. As we need to create
    a raster with exactly the same extent and resolution as `lidar_dem.tif`, we will
    use advanced options by editing the `gdal_rasterize` command-line parameters:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前面的步骤中，您定义了一些主要选项。由于我们需要创建一个与`lidar_dem.tif`具有完全相同范围和分辨率的栅格，我们将通过编辑`gdal_rasterize`命令行参数使用高级选项：
- en: Click on the **Edit**![Step 1 – converting a buildings' vector layer to raster](img/image00444.jpeg)
    button to make the line editable. All the previous options will be deactivated
    and grayed out.
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**编辑**![步骤 1 – 将建筑矢量图层转换为栅格](img/image00444.jpeg)按钮以使线条可编辑。所有先前的选项都将被禁用并变灰。
- en: Delete the `–ts 3000 3000` option, as we are going to specify a resolution parameter
    that makes raster width and height parameters that are defined by `–ts` meaningless.
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除`–ts 3000 3000`选项，因为我们将指定一个分辨率参数，这使得由`–ts`定义的栅格宽度和高度参数变得没有意义。
- en: The `–init 0` parameter defines the initial values of the output raster. It
    creates an empty raster with initially predefined values, and then vector values
    are burned into it. In our case, this means that building-free areas will be assigned
    zero values.
  id: totrans-39
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`–init 0`参数定义了输出栅格的初始值。它创建一个具有预先定义值的空栅格，然后矢量值被烧录到其中。在我们的情况下，这意味着无建筑区域将被分配为零值。'
- en: The target extent is defined by the `–te` parameter described by space-separated
    bounding box values (**Xmin**, **Ymin**, **Xmax**, and **Ymax**) in georeferenced
    units. If you want to use a predefined extent, just copy its values from a piece
    of correspondent raster metadata. Don't forget to replace the commas and semicolons
    with spaces.
  id: totrans-40
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目标范围由`–te`参数定义，该参数使用地理参照单位中的空格分隔的边界框值（**Xmin**、**Ymin**、**Xmax**和**Ymax**）描述。如果您想使用预定义的范围，只需从相应的栅格元数据中复制其值。别忘了将逗号和分号替换为空格。
- en: The target resolution (`–tr`) parameter defines the vertical and horizontal
    pixel size in units specified by the layer's CRS.
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目标分辨率（`–tr`）参数定义了以图层CRS指定的单位表示的垂直和水平像素大小。
- en: The output data type is defined by the `–ot` parameter, whose default value
    is `Float64`, but we replace it by `Float32`, which is the same as that for `lidar_dem.tif`.
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输出数据类型由`–ot`参数定义，其默认值为`Float64`，但我们将其替换为`Float32`，这与`lidar_dem.tif`相同。
- en: 'The resulting line will look as follows:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的行将如下所示：
- en: '[PRE0]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Note
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To convert a vector to a raster, we have used a tool called `gdal_rasterize`
    from the **Geospatial Data Abstraction Library** (**GDAL**). You can read an extended
    synopsis of the `gdal_raserize` parameters and their values from [http://www.gdal.org/gdal_rasterize.html](http://www.gdal.org/gdal_rasterize.html).
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 要将矢量转换为栅格，我们使用了来自**地理空间数据抽象库**（**GDAL**）的名为`gdal_rasterize`的工具。您可以从[http://www.gdal.org/gdal_rasterize.html](http://www.gdal.org/gdal_rasterize.html)阅读`gdal_rasterize`参数及其值的扩展说明。
- en: 'After hitting **OK**, the resulting raster will be created and added to the
    map canvas. If you click on any pixel with the **Identify Features** tool selected,
    a height value of the building will be displayed, and if you click on an empty
    space, it will show `0`. The layer itself will look similar to the following screenshot:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**确定**后，生成的栅格将被创建并添加到地图画布上。如果您选择**识别特征**工具并点击任何像素，将显示建筑的高度值；如果您点击空白区域，将显示`0`。该图层看起来将与以下截图相似：
- en: '![Step 1 – converting a buildings'' vector layer to raster](img/image00445.jpeg)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![步骤 1 – 将建筑矢量图层转换为栅格](img/image00445.jpeg)'
- en: Step 2 – combining the DEM and buildings layers
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 步骤 2 – 合并DEM和建筑图层
- en: Now, we need to combine the two layers into a single layer by adding their values.
    **Raster algebra** is a common approach to overlaying a raster layer (or layers),
    combining their values using algebraic operations (addition, subtraction, multiplication,
    division, and so on), and calculating values for a new raster layer. Modern GIS
    software uses so-called raster calculators that help create, validate, and apply
    raster algebra expressions to raster datasets.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要通过添加它们的值将两个图层合并为单个图层。**栅格代数**是叠加栅格层（或多个层）的常用方法，通过代数运算（加法、减法、乘法、除法等）组合它们的值，并计算新栅格层的值。现代GIS软件使用所谓的栅格计算器，有助于创建、验证和应用栅格代数表达式到栅格数据集中。
- en: 'QGIS also has its own raster calculator located at **Raster** | **Raster Calculator**.
    The **Calculator** dialog window consists of the following parts:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: QGIS还有一个位于**栅格** | **栅格计算器**的自己的栅格计算器。**计算器**对话框窗口由以下部分组成：
- en: '**Raster bands**: In the top-left corner of the window, you can see the list
    of all rasters available in the project. The raster band number is separated from
    its name by an `@` sign. If the layer is a single-band raster, then only `name@1`
    appears in the list, but if it is a multiband raster, then `name@1`, `name@2`,
    and so on up to `name@n` (where *n* is the total number of bands in the multiband
    raster) will be shown for each band separately.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**栅格波段**：在窗口的左上角，您可以查看项目中所有可用栅格的列表。栅格波段号通过`@`符号与其名称分开。如果图层是单波段栅格，则列表中只出现`name@1`，但如果它是多波段栅格，则对于每个波段将分别显示`name@1`、`name@2`，等等，直到`name@n`（其中*n*是多波段栅格中的波段总数）。'
- en: '**Result layer**: In the top-right part of the calculator window, you can adjust
    the output raster properties. The **Current layer extent** button sets up an output
    extent from the raster layer that is currently selected in the **Raster bands**
    list on the left side. It is very useful when you are working with layers that
    have different extents, and allows you to decide which extent to use.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**结果图层**：在计算器窗口的右上角，您可以调整输出栅格属性。**当前图层范围**按钮从左侧**栅格波段**列表中当前选定的栅格图层设置输出范围。当您处理具有不同范围的图层时，这非常有用，并允许您决定使用哪个范围。'
- en: '**Operators**: In the central part of the window, there are various operator
    buttons that can be used to construct expressions. Click on the relevant button
    to add an operator, or type it manually.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**运算符**：在窗口的中央部分，有各种运算符按钮，可以用来构建表达式。点击相关按钮添加运算符，或者手动输入。'
- en: '**Raster calculator expression**: In the bottom part of the calculator, there
    is the expression window, where the calculation formula to be used is displayed.
    Double-click on the relevant layer to add it to the expression (it will be shown
    in double quotes). Note that for the expression, we type only the right side of
    the calculation formula, which comes after the equal to sign. Under the expression,
    you will see the **Expression valid/ invalid** message change dynamically, and
    this helps you control the correctness of the constructed formula.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**栅格计算器表达式**：在计算器的底部部分，有一个表达式窗口，其中显示了要使用的计算公式。双击相关图层将其添加到表达式中（它将以双引号显示）。请注意，对于表达式，我们只输入计算公式的右侧，即等于号之后的部分。在表达式下方，您将看到**表达式有效/无效**消息动态更改，这有助于您控制构建公式的正确性。'
- en: 'In the following screenshot, you can see that we apply a simple addition formula
    (`"building@1" + "liadar_dem@1"`) to combine rasterized buildings'' heights and
    DEM layers:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下屏幕截图中，您可以看到我们应用了一个简单的加法公式（`"building@1" + "liadar_dem@1"`）来合并栅格化的建筑高度和DEM图层：
- en: '![Step 2 – combining the DEM and buildings layers](img/image00446.jpeg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![步骤 2 – 合并 DEM 和建筑图层](img/image00446.jpeg)'
- en: 'After you''ve clicked on the **OK** button, the calculation is performed and
    a newly created `urban_surface` raster appears in the **Layers** panel. Now, we
    can check its values with the **Identify features** tool ![Step 2 – combining
    the DEM and buildings layers](img/image00447.jpeg):'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**确定**按钮后，计算将被执行，并在**图层**面板中显示一个新的`urban_surface`栅格图层。现在，我们可以使用**识别特征**工具检查其值
    ![步骤 2 – 合并 DEM 和建筑图层](img/image00447.jpeg)：
- en: Uncheck all unnecessary layers except those from `urban_surface`, `building`,
    and `lidar_dem`. Maintaining their order simplifies the interpretation of **Identify
    Results**.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除了`urban_surface`、`building`和`lidar_dem`之外，取消选中所有不必要的图层。保持它们的顺序简化了**识别结果**的解释。
- en: Go to the **Identify Results** tab. From the **Mode** drop-down list, select
    **Top down**. The identified values will be shown for all the active layers in
    order, from top to bottom.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**识别结果**选项卡。从**模式**下拉列表中选择**自上而下**。识别的值将按顺序显示在所有活动图层中，从上到下。
- en: From the **View** drop-down list, select **Table**. The identified values will
    be organized into a simple table, as shown in this screenshot:![Step 2 – combining
    the DEM and buildings layers](img/image00448.jpeg)
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**视图**下拉列表中选择**表格**。识别的值将被组织成一个简单的表格，如图所示：![步骤 2 – 合并 DEM 和建筑图层](img/image00448.jpeg)
- en: Now, by clicking on any point in the map canvas, you can explore values and
    make sure that they have been added properly.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，通过点击地图画布上的任何一点，您可以探索值并确保它们已被正确添加。
- en: Step 3 – defining observation points
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 3 步 – 定义观测点
- en: 'Observation points play an important role in visual exploration of modern cityscapes.
    Usually, they are represented by the highest points in an area that provide the
    most spectacular views. Therefore, viewing platforms in the city are usually located
    on rooftops. In this section, we are going to create a layer that contains several
    prospective viewing platforms through the following steps:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 观察点在现代城市景观的视觉探索中起着重要作用。通常，它们由一个区域内最高的点表示，提供最壮观的视野。因此，城市中的观景平台通常位于屋顶上。在本节中，我们将通过以下步骤创建一个包含几个潜在观景平台的图层：
- en: Creating an empty vector layer
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个空矢量图层
- en: Populating it with some points that represent the highest buildings
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用代表最高建筑的点填充它
- en: Providing them with the information on height from the `buildings_footprint`
    layer
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`buildings_footprint`图层提供高度信息
- en: Creating an empty vector layer
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个空矢量图层
- en: 'To create a vector layer, go to **Layer** | **Create layer**. There are three
    options available here:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个矢量图层，转到**图层** | **创建图层**。这里有三种选项可用：
- en: '**New Shapefile Layer**: Also accessible by the *Ctrl* + *Shift* + *N* keyboard
    shortcut, this creates a new empty shapefile layer.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**新Shapefile图层**：也可以通过*Ctrl* + *Shift* + *N*键盘快捷键访问，这会创建一个新的空shapefile图层。'
- en: '**New SpatiaLite Layer**: Also accessible by the *Ctrl* + *Shift* + *A* keyboard
    shortcut, this creates an empty SpatiaLite layer within a specified SpatiaLite
    database (by default, a currently connected database is specified).'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**新建SpatiaLite图层**：也可以通过*Ctrl* + *Shift* + *A*键盘快捷键访问，这将在指定的SpatiaLite数据库（默认情况下为当前连接的数据库）内创建一个空的SpatiaLite图层。'
- en: '**New Temporary Scratch Layer**: This creates a temporary layer that can be
    used and analyzed like any other layer within a working session, but the layer
    will disappear if it is not saved before closing the project. These layers are
    meant to be drafts, and using them for testing purposes prevents cluttering your
    project. This is the option we will use to create an empty layer.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**新建临时擦除图层**：这创建了一个临时图层，可以在工作会话中像任何其他图层一样使用和分析，但如果在关闭项目之前未保存，该图层将消失。这些图层旨在作为草稿，用于测试目的可以防止项目变得杂乱。我们将使用此选项创建一个空图层。'
- en: 'Similarly, you can use a relevant button from the **Manage Layers** toolbar
    and the small triangle beside it to get access to the options, as shown in the
    following screenshot:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，您可以使用**管理图层**工具栏中的相关按钮以及其旁边的小三角形来访问选项，如图所示：
- en: '![Creating an empty vector layer](img/image00449.jpeg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![创建空矢量图层](img/image00449.jpeg)'
- en: 'After selecting **New Temporary Scratch Layer**, you will see this dialog window:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择**新建临时擦除图层**后，您将看到此对话框：
- en: '![Creating an empty vector layer](img/image00450.jpeg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![创建空矢量图层](img/image00450.jpeg)'
- en: 'Consider the options in the **New Temporary Scratch Layer** window, as follows:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑**新建临时擦除图层**窗口中的选项，如下所示：
- en: '**Layer name**: Type in a name or leave the default as it is, because we are
    going to use the layer for temporary work and its name really doesn''t matter.'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**图层名称**：输入一个名称或保留默认设置，因为我们打算将图层用于临时工作，其名称实际上并不重要。'
- en: '**Type**: This defines the geometry type. As we are going to set up observation
    points, the default **Point** option is suitable.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**类型**：这定义了几何类型。由于我们将设置观测点，因此默认的**点**选项是合适的。'
- en: '**Selected CRS**: A default projection is selected, but you need to set up
    a projection of your project in order for the layer to be processed correctly.
    To do so, select the **Project CRS** option from the drop-down combobox.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**所选CRS**：已选择默认投影，但您需要设置项目投影，以便正确处理图层。为此，从下拉组合框中选择**项目CRS**选项。'
- en: After clicking on **OK**, a **New scratch layer** will be added to the **Layers**
    panel. By default, editing mode for the layer is activated (you can see it as
    a little pencil drawn above its marker symbol beside the layer's name) as shown
    in the following screenshot. Now we can proceed to the next stage and add some
    points to it.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**确定**后，将在**图层**面板中添加一个**新擦除图层**。默认情况下，图层的编辑模式被激活（您可以在图层名称旁边的标记符号上方看到一个小铅笔，如图所示）。现在我们可以继续到下一阶段，并向其添加一些点。
- en: '![Creating an empty vector layer](img/image00451.jpeg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![创建空矢量图层](img/image00451.jpeg)'
- en: Populating a layer with points
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用点填充图层
- en: 'Activate the **Digitizing** toolbar, if it has not already been done. You can
    do this by going to **View** | **Toolbars** | **Digitizing**, or simply by right-clicking
    somewhere on the toolbar''s panel and activating the relevant toggle. The toolbar
    contains the primary digitizing tools, and looks like this:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果尚未激活，请激活**数字化**工具栏。您可以通过转到**视图** | **工具栏** | **数字化**，或者简单地通过在工具栏面板上的某处右键单击并激活相关切换来完成此操作。该工具栏包含主要的数字化工具，外观如下：
- en: '![Populating a layer with points](img/image00452.jpeg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![用点填充图层](img/image00452.jpeg)'
- en: 'This panel''s buttons provide access to the following options (from left to
    right):'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 此面板的按钮提供以下选项的访问权限（从左到右）：
- en: '**Current edits**: This maintains edits within a current editing session for
    the selected layer (or layers). Click on the little black triangle in the bottom-right
    corner of the button to access the **Save**, **Rollback**, or **Cancel** options
    for your edits. Note that these options are available until the **Save Layer Edits**
    button isn''t clicked on.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**当前编辑**：这将在所选图层（或图层组）的当前编辑会话中保持编辑。点击按钮右下角的小黑三角形以访问**保存**、**回滚**或**取消**选项。请注意，这些选项在点击**保存图层编辑**按钮之前都是可用的。'
- en: '**Toggle Editing**: This button activates/deactivates the editing mode.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**切换编辑**：此按钮激活/停用编辑模式。'
- en: '**Save Layer Edits**: This saves all the current edits without exiting the
    editing session. After clicking on this button, edits cannot be rolled back. It
    is inactive when there are no edits to save.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**保存图层编辑**：此按钮用于保存所有当前编辑而不退出编辑会话。点击此按钮后，无法撤销编辑。如果没有要保存的编辑，则此按钮不可用。'
- en: '**Add Feature**: Use this button to draw new features on the layer. Its appearance
    depends on layer''s geometry type. Currently, it shows points because you are
    editing a point layer.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**添加要素**：使用此按钮在图层上绘制新的要素。其外观取决于图层的几何类型。目前，它显示为点，因为你正在编辑一个点图层。'
- en: '**Move Feature(s)**: When this button is selected, you can move one or several
    features. It is important to note that if you are going to move multiple features,
    they should have been previously selected.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**移动要素**：当选择此按钮时，你可以移动一个或多个要素。重要的是要注意，如果你打算移动多个要素，它们应该事先被选中。'
- en: '**Node Tool**: This tool is used to add, remove, or move vertices of geometric
    features such as lines and polygons. It is unnecessary for a point layer and is
    therefore inaccessible.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**节点工具**：此工具用于添加、删除或移动几何要素（如线和多边形）的顶点。对于点图层来说是不必要的，因此不可访问。'
- en: '**Delete Selected**: This deletes the previously selected feature (or features).
    Until the edits are saved, they can be rolled back through the **Current Edits**
    button options.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**删除选中项**：这将删除之前选中的要素（或要素）。在保存编辑之前，可以通过**当前编辑**按钮选项撤销这些编辑。'
- en: '**Cut/ Copy/ Paste Features**: Similarly to other kinds of software, you can
    use these buttons to cut or copy features onto the clipboard and then paste them.
    Features must be previously selected if you want to apply these options. While
    **Cut** and **Paste** are available only in editing mode, **Copy** can be used
    with any other layer, and is of great use when moving features between layers.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**剪切/复制/粘贴要素**：与其他类型的软件类似，你可以使用这些按钮将要素剪切或复制到剪贴板，然后粘贴。如果你想要应用这些选项，要素必须事先被选中。虽然**剪切**和**粘贴**仅在编辑模式下可用，但**复制**可以在任何其他图层中使用，当在图层之间移动要素时非常有用。'
- en: Tip
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'You can also use more complex digitizing tools and options, such as feature
    rotation, simplification, adding parts and rings, and so on. These are available
    from the **Advanced Digitizing** panel, as shown in the following screenshot:'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你还可以使用更复杂的数字化工具和选项，例如要素旋转、简化、添加部分和环等。这些工具在**高级数字化**面板中可用，如下面的截图所示：
- en: '![Populating a layer with points](img/image00453.jpeg)'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![用点填充图层](img/image00453.jpeg)'
- en: 'Moreover, the panel provides access to input tools that are similar to those
    used in **computer-aided design** (**CAD**) systems. These tools allow digitizing
    with precise numerical values of coordinates, distances, and angles; control segments;
    parallelism; and perpendicularity, as shown in the following screenshot:'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此外，面板还提供了类似于在**计算机辅助设计**（**CAD**）系统中使用的输入工具。这些工具允许使用精确的坐标、距离和角度数值进行数字化；控制线段；平行性和垂直性，如下面的截图所示：
- en: '![Populating a layer with points](img/image00454.jpeg)'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![用点填充图层](img/image00454.jpeg)'
- en: 'Now that you are familiar with the **Digitizing** toolbar, **Toggle editing**,
    and using **Add Feature**, click on different places to locate some observation
    points. Remember that these points should be placed on the footprints of the highest
    buildings. It is recommended to use the previously created `urban_surface` raster
    as a background, as it helps locate the points properly. Now, add several points
    (five to seven are enough) by clicking on the map canvas. Click on the **Toggle
    editing** button to exit editing mode. Click on the **Save** button when you are
    asked about edits. As a result, your map will look similar to this screenshot:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经熟悉了**数字化**工具栏、**切换编辑**以及使用**添加要素**，点击不同的地方以定位一些观测点。请记住，这些点应该放在最高建筑的底部。建议使用之前创建的`urban_surface`栅格作为背景，因为它有助于正确定位这些点。现在，通过点击地图画布添加几个点（五到七个就足够了）。点击**切换编辑**按钮退出编辑模式。当被询问编辑时，点击**保存**按钮。结果，你的地图将类似于以下截图：
- en: '![Populating a layer with points](img/image00455.jpeg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![用点填充图层](img/image00455.jpeg)'
- en: Providing points with height values
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提供具有高度值的点
- en: As we are going to locate viewing platforms on the rooftops, taking into account
    the height of the building is of great importance to obtain realistic modeling
    results. Instead of looking for the necessary building and its height and adding
    the height value to the visibility points manually, we will automatically join
    attributes, taking into account the locations of the points. This operation—when
    you merge attributes from two different layers based on their spatial relationship—is
    very common in GIS and is called a **spatial join**.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们将在屋顶上定位观测平台，考虑到建筑的高度对于获得逼真的建模结果非常重要。我们不会寻找必要的建筑及其高度并手动将高度值添加到可见性点，而是将自动连接属性，考虑到点的位置。这种操作——当你基于两个不同图层之间的空间关系合并属性时——在GIS中非常常见，被称为**空间连接**。
- en: 'Go to **Vector** | **Data Management Tools** | **Join Attributes by Location**.
    In the dialog window, the following options are present:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 前往**矢量** | **数据管理工具** | **通过位置连接属性**。在对话框窗口中，有以下选项：
- en: '**Target vector layer**: The layer to which attributes will be joined; in our
    case, it''s **New scratch layer**.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标矢量图层**：将连接属性的图层；在我们的案例中，它是**新临时图层**。'
- en: '**Join vector layer**: The layer from which attributes will be taken; in our
    case, it is `building_footprints`.![Providing points with height values](img/image00456.jpeg)'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连接矢量图层**：从中提取属性的图层；在我们的案例中，它是`building_footprints`。![提供具有高度值的点](img/image00456.jpeg)'
- en: '**Attribute Summary** deals with multiple attribute values available for joining.
    The **Take attributes of first located feature** option joins a single value,
    and this is the default action that we select. Optionally, you can activate **Take
    summary of intersection features** and select one or several summarizing functions
    (**Mean**, **Min**, **Max**, and so on).'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**属性摘要**处理可用于连接的多个属性值。**取第一个定位特征的属性**选项连接单个值，这是我们默认选择的行为。可选地，您可以激活**取交集特征的摘要**并选择一个或多个汇总函数（**平均值**、**最小值**、**最大值**等）。'
- en: '**Output Shapefile** provides the path to the resulting vector layer. Click
    on the **Browse** button to select the necessary directory and type a name, for
    example, `observ_points`.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输出Shapefile**提供了结果矢量图层的路径。点击**浏览**按钮选择必要的目录并输入名称，例如，`观测点`。'
- en: '**Output table** is responsible for the number of records in the resulting
    attribute table. We leave the **Only keep matching records** default option as
    selected because we only need records of buildings that match with the observation
    points.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输出表**负责结果属性表中的记录数量。我们保留默认选中的**仅保留匹配记录**选项，因为我们只需要与观测点匹配的建筑记录。'
- en: After clicking on **OK** and completing the spatial join, you will be informed
    that a new layer has been created and asked, "Would you like to add the new layer
    to the TOC?" Click on **Yes**, and the layer will be loaded and appear in the
    map canvas. Click on the **Close** button to exit the **Join attributes by location**
    dialog window.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**确定**并完成空间连接后，您将被告知已创建了一个新图层，并被询问：“您想将新图层添加到目录中吗？”点击**是**，图层将被加载并显示在地图画布上。点击**关闭**按钮退出**通过位置连接属性**对话框。
- en: Now, if you open the `observ_point` attribute table, you will see that all the
    attributes from matching buildings in the `building_footprint` layer have been
    joined to the points. This tool may be of great use when working with a large
    number of entities.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果您打开`观测点`属性表，您将看到所有来自`building_footprint`图层中匹配建筑的属性都已连接到这些点。当处理大量实体时，此工具可能非常有用。
- en: Step 4 – creating viewshed coverages
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4步 – 创建视域覆盖
- en: In this section, we will apply the advanced visibility analysis tools that are
    available from the **Viewshed Analysis** plugin. Install it as described in the
    *Extending functionality through plugins* section of [Chapter 1](part0014.xhtml#aid-DB7S2
    "Chapter 1. Handling Your Data"), *Handling Your Data*.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将应用**视域分析**插件提供的先进可见性分析工具。按照[第1章](part0014.xhtml#aid-DB7S2 "第1章。处理您的数据")中*通过插件扩展功能*部分所述进行安装，*处理您的数据*。
- en: After the plugin has been installed, you can get access to its functionality
    by going to **Plugin** | **Viewshed Analysis**. The **Advanced viewshed analysis**
    dialog window consists of three tabs. The **General** tab provides access to all
    the available analysis and output options. The **Reference** tab contains brief
    descriptions of the options and a link to the project's homepage, where you can
    read detailed information about the algorithm implemented in the plugin and report
    bugs, if any. The **About** tab contains brief information about the author and
    the plugin's homepage link.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 安装插件后，您可以通过转到**插件** | **视域分析**来访问其功能。**高级视域分析**对话框包含三个选项卡。**常规**选项卡提供对所有可用分析和输出选项的访问。**参考**选项卡包含选项的简要描述以及到项目主页的链接，您可以在那里阅读有关插件中实现的算法的详细信息，并在必要时报告错误。**关于**选项卡包含有关作者和插件主页的简要信息。
- en: 'Use the following options under the **General** tab to create viewshed coverages,
    as shown in the following screenshot:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在**常规**选项卡下使用以下选项来创建视域覆盖，如图中所示：
- en: '**Elevation raster**: Select the `urban_surface` raster to represent the earth''s
    surface and buildings on it.'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高程栅格**：选择`urban_surface`栅格来表示地球表面及其上的建筑物。'
- en: '**Observation points**: Select the `observ_points` point layer.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**观测点**：选择`observ_points`点层。'
- en: '**Output file**: Click on the **Browse** button, navigate to the working directory,
    and type a name for the output raster layer. Note that one output raster file
    will be created for each observation point, and the typed filename will be used
    as a template that will be accompanied by the output coverage type (viewshed,
    intervisibility, invisibility, and horizon) and index number. For this reason,
    we call the output layer `coverage`, presuming that the explanatory parameters
    (coverage type and point number) will be added automatically.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输出文件**：点击**浏览**按钮，导航到工作目录，并为输出栅格图层输入一个名称。请注意，每个观测点将创建一个输出栅格文件，输入的文件名将用作模板，该模板将与输出覆盖类型（视域、互视、不可视和地平线）和索引号一起使用。因此，我们称输出层为`coverage`，假设解释参数（覆盖类型和点数）将自动添加。'
- en: Our goal is to find the point (or points) of the most scenic view, so there
    is no need to analyze the points' intervisibility. Hence, the **Target points**
    (intervisibility) field is omitted.
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们的目标是找到风景最美的点（或多个点），因此没有必要分析点的互视性。因此，省略了**目标点**（互视性）字段。
- en: '**Search radius**: This is the size of the area observed around a point in
    the layer''s measurement units (feet in our case). The higher the value, the longer
    the time taken to produce coverages. Accept the default value of 5000.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**搜索半径**：这是在图层测量单位（在我们的例子中是英尺）中围绕图层中的点观测的区域大小。值越高，生成覆盖所需的时间越长。接受默认值5000。'
- en: '**Observer height**: This defines the height of an observation point above
    the earth''s surface. Usually, the higher the point, the better the observation.
    Instead of the predefined height, select `HEIGHT_ROO` from the field drop-down
    list.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**观测者高度**：这定义了观测点相对于地球表面的高度。通常，点越高，观测效果越好。而不是选择预定义的高度，从字段下拉列表中选择`HEIGHT_ROO`。'
- en: '**Target height**: This is necessary when you want to know whether any target
    objects of a specific height are visible from the current position. We omit this
    option because we are more interested in the general visibility than in the visibility
    of specific objects.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标高度**：当您想知道从当前位置是否可以看到特定高度的目标物体时，这是必要的。我们省略了这个选项，因为我们更感兴趣的是一般可见性，而不是特定物体的可见性。'
- en: '**Adapt to highest point at distance of**: This option finds the highest point
    in the observer or target vicinity within a certain area, defined in pixels. It
    may be of great use when your observation points provide approximate locations,
    and you need their height values to be adjusted to the highest point within the
    surrounding area. As we already have the exact height values, this option will
    be omitted.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**适应距离内的最高点**：此选项在定义的像素区域内找到观测者或目标附近的最高点。当您的观测点提供近似位置，并且需要将它们的高度值调整到周围区域内的最高点时，这可能非常有用。因为我们已经有了精确的高度值，所以此选项将被省略。'
- en: '**Output**: This can be represented by the following coverages:'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**输出**：这可以通过以下覆盖表示：'
- en: '**Binary viewshed**: This is a simple raster coverage where all pixel values
    are assigned `0` (invisible) or `1` (visible). Activate this option to create
    viewsheds.'
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**二值视域**：这是一个简单的栅格覆盖，其中所有像素值都被分配为`0`（不可见）或`1`（可见）。激活此选项以创建视域。'
- en: '**Invisibility depth**: This measures the size an object should attain in order
    to become visible if placed in an area which is out of view. In other words, it
    defines the number of height units required for an object to become visible within
    a given radius. The output raster is a kind of inverted visibility raster where
    all visible pixels are assigned 0 as the value and all invisible pixels are assigned
    negative height values (the lower the value, the more invisible an object).![Step
    4 – creating viewshed coverages](img/image00457.jpeg)'
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不可见深度**：这衡量了一个物体在放置在一个看不见的区域时应该达到的大小，以便变得可见。换句话说，它定义了物体在给定半径内变得可见所需的高度单位数。输出栅格是一种倒置的可见性栅格，其中所有可见像素都被分配为0值，所有不可见像素都被分配为负高度值（值越低，物体越不可见）。![步骤
    4 – 创建视域覆盖](img/image00457.jpeg)'
- en: '**Intervisibility**: The output will be a shapefile that represents a network
    of visual relations between the observation points. In the output network, points
    that can be visible from each other are connected.'
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**互视性**：输出将是一个代表观测点之间视觉关系的网络形状文件。在输出网络中，可以相互看见的点被连接起来。'
- en: '**Horizon**: The output raster coverages represent the horizon line or the
    edge of the visibility area.'
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**地平线**：输出栅格覆盖表示地平线或可见区域的边缘。'
- en: Optionally, instead of multiple coverages, a single **cumulative** raster that
    summarizes raster coverages to generalize analysis results can be created. Then,
    `0` values are assigned to invisible pixels, and positive values are assigned
    to visible pixels (higher values correspond to pixels visible from multiple observation
    points).
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可选地，而不是创建多个覆盖，可以创建一个单一的**累积**栅格，该栅格总结了栅格覆盖以概括分析结果。然后，将`0`值分配给不可见像素，将正值分配给可见像素（值越高，表示从多个观测点可见的像素）。
- en: '**Use earth curvature option**: This takes into account the earth''s curvature
    and the effects of refraction of light when traveling through the atmosphere.
    Activate this option and accept the default `0.13` refraction value. After all
    the options are adjusted, click on the **OK** button and wait for the results
    to be loaded into the map canvas.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用地球曲率选项**：这考虑了地球的曲率和光在穿过大气层时的折射效应。激活此选项并接受默认的`0.13`折射值。调整完所有选项后，点击**确定**按钮，等待结果加载到地图画布上。'
- en: 'Similarly, you can create the **Horizon** individual coverages. As a result,
    a total of 18 raster coverages will be added to the map canvas:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，您可以创建**地平线**单独的覆盖。结果，总共将添加18个栅格覆盖到地图画布上：
- en: '`coverage_N_Binary`: A binary visibility raster where *N* is the number of
    observation point'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`coverage_N_Binary`：一个二进制可见性栅格，其中*N*是观测点的数量'
- en: '`coverage_N_Horizon`: A raster that represents the horizon line for the point
    *N*'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`coverage_N_Horizon`：一个表示点*N*的地平线的栅格'
- en: 'In the following screenshot, you can see the example combination of binary
    visibility (on the left) and the horizon line (on the right) coverages for the
    same observation point:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下屏幕截图中，您可以查看同一观测点的二进制可见性（在左侧）和地平线（在右侧）覆盖的示例组合：
- en: '![Step 4 – creating viewshed coverages](img/image00458.jpeg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![步骤 4 – 创建视域覆盖](img/image00458.jpeg)'
- en: Step 5 – finding scenic points
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 步骤 5 – 寻找景观点
- en: Now, we should go through all the observation points and corresponding coverages,
    adjust their visualization options, and select the point (or points) that provides
    the best view of the area of interest.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们应该遍历所有观测点和相应的覆盖，调整它们的可视化选项，并选择提供最佳区域视图的点（或多个点）。
- en: 'First of all, we need to enumerate the points properly in order to be able
    to distinguish between them. Follow these steps to do so:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要适当地列举这些点，以便能够区分它们。按照以下步骤进行：
- en: Select **Open Attribute Table** from the `observ_points` by right-clicking on
    the contextual shortcut, or click on the correspondent button ![Step 5 – finding
    scenic points](img/image00459.jpeg) from the **Attributes** toolbar.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过右键单击上下文快捷方式从`observ_points`中选择**打开属性表**，或者点击**属性**工具栏中的对应按钮 ![步骤 5 – 寻找景观点](img/image00459.jpeg)。
- en: Select **Open Field calculator**![Step 5 – finding scenic points](img/image00460.jpeg)
    from the table toolbar or use the *Ctrl* + *I* keyboard shortcut.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从表工具栏中选择**打开字段计算器**![步骤 5 – 寻找景观点](img/image00460.jpeg)，或者使用*Ctrl* + *I*键盘快捷键。
- en: In the **Field calculator** dialog window, activate the **Update existing field**
    option, and make sure that the `OBJECTID` attribute field is selected from the
    drop-down list, as shown in the following screenshot. This field already contains
    values that were joined from the `building_footprints` layer. These values are
    independent of the point number, and this is why we are using the update option
    to change the existing values to consistent values.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**字段计算器**对话框窗口中，激活**更新现有字段**选项，并确保从下拉列表中选择`OBJECTID`属性字段，如以下截图所示。此字段已包含从`building_footprints`图层合并的值。这些值与点数无关，这就是我们使用更新选项将现有值更改为一致值的原因。
- en: In the **Expression** tab, expand the **Record** group, which contains functions
    that operate on record identifiers. Select and double-click on the **$id** function
    to be added to the **Expression** window. This function returns the feature ID
    of the current row, which will help us identify the points and the correspondent
    coverages properly.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**表达式**选项卡中，展开包含对记录标识符进行操作的函数的**记录**组。选择并双击要添加到**表达式**窗口的**$id**函数。此函数返回当前行的要素ID，这将帮助我们正确识别点和相应的覆盖范围。
- en: Click on the **OK** button. **Edit mode** will be automatically turned on and
    the records' values will be updated.
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击**确定**按钮。**编辑模式**将自动开启，并更新记录的值。
- en: '![Step 5 – finding scenic points](img/image00461.jpeg)'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![步骤 5 – 寻找景观点](img/image00461.jpeg)'
- en: '**Toggle editing mode**![Step 5 – finding scenic points](img/image00462.jpeg)
    from the **Table** toolbar or use the *Ctrl* + *E* keyboard shortcut to exit editing
    mode. You will be asked whether you want to save the changes made to the `observ_points`
    layer. Click on the **Save** button and close the attribute table.'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**表格**工具栏切换到**编辑模式**![步骤 5 – 寻找景观点](img/image00462.jpeg)或使用*Ctrl* + *E*快捷键退出编辑模式。系统会询问您是否要保存对`observ_points`图层所做的更改。点击**保存**按钮并关闭属性表。
- en: Double-click on the `observ_points` layer to open its **Layer Properties** dialog
    window. In the **Labels** section, activate the **Label this layer with** option
    and select the `OBJECTID` field for labeling. Adjust any other labeling options,
    if needed, and click on **OK** to exit the window. When the observation points
    are labeled, it will be much easier to analyze them and their viewsheds.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击`observ_points`图层以打开其**图层属性**对话框窗口。在**标签**部分，激活**使用以下选项标签此图层**选项，并选择`OBJECTID`字段进行标签。如有需要，调整任何其他标签选项，然后点击**确定**以退出窗口。当观测点被标签化后，分析它们及其视域将变得更加容易。
- en: 'Now, we will adjust the symbology of the visibility layers to simplify their
    interpretation. Let''s start from the very beginning—point number `0`. Follow
    these steps to achieve meaningful results:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将调整可见图层符号以简化其解释。让我们从最基本的地方开始——点号`0`。按照以下步骤以获得有意义的结果：
- en: Activate the `coverage_0_Horizon` and `coverage_0_Binary` layers, and deactivate
    all other visibility layers. Make sure that the layers lie under `observ_points`.
    Activate any other layers that might be of interest when analyzing visibility
    (for example, `urban_surface`, `roads`, and so on), and make sure that they underlie
    visibility rasters.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 激活`coverage_0_Horizon`和`coverage_0_Binary`图层，并关闭所有其他可见图层。确保这些图层位于`observ_points`之下。激活在分析可见性时可能感兴趣的任何其他图层（例如，`urban_surface`、`roads`等），并确保它们位于可见栅格之下。
- en: 'Adjust the `coverage_0_Horizon` layer''s style. This layer contains only two
    values: `1` represents the horizon line (that is, the edge of the visibility area),
    and `0` represents all other areas. Double-click on its name in the **Layers**
    panel to open the **Layer Properties** dialog, go to the **Style** section, and
    adjust the following parameters:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 调整`coverage_0_Horizon`图层样式。此图层只包含两个值：`1`代表地平线（即可见区域的边缘），`0`代表所有其他区域。在**图层**面板中双击其名称以打开**图层属性**对话框，转到**样式**部分，并调整以下参数：
- en: From the **Render type** drop-down list, select **Singleband pseudocolor**.
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从**渲染类型**下拉列表中选择**单波段伪彩色**。
- en: Set **Color interpolation** to **Exact**, as we have only two values and want
    them to be assigned to the selected colors.
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将**颜色插值**设置为**精确**，因为我们只有两个值，希望它们被分配到所选颜色。
- en: Use the ![Step 5 – finding scenic points](img/image00463.jpeg) button to add
    the necessary values manually. Enter `0` and double-click on its **Color** sample.
    In the **Change color** window, select black from **Standard colors**, and using
    the **Opacity slider**, set the transparency to `25%`. Click on the **OK** button
    to come back to the main styling options.
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用![步骤 5 – 寻找风景点](img/image00463.jpeg)按钮手动添加必要的值。输入`0`并双击其**颜色**样本。在**更改颜色**窗口中，从**标准颜色**中选择黑色，并使用**不透明度滑块**将透明度设置为`25%`。点击**确定**按钮返回到主要样式选项。
- en: 'Again, add one more row for the value of `1`, and assign it a bright, contrasting
    color to make the horizon line distinguishable on the map. Type in the explanatory
    names for values in the **Label** field. Your color table should look similar
    to the following screenshot:'
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 再次添加一行，值为`1`，并为其分配一个明亮、对比度高的颜色，以便在地图上区分地平线线。在**标签**字段中输入值的解释性名称。你的颜色表应该类似于以下截图：
- en: '![Step 5 – finding scenic points](img/image00464.jpeg)'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![步骤 5 – 寻找风景点](img/image00464.jpeg)'
- en: 'Open the `coverage_0_Binary` properties dialog by double-clicking on the layer
    name in the **Layers** panel, and go to the **Transparency** section. We will
    use **Custom transparency** options and **Transparent pixel list** to adjust the
    pixels'' transparency properties according to their values. The binary visibility
    raster contains only two values: `1` for visible areas and `0` for invisible areas.
    To add these values to the list, click on ![Step 5 – finding scenic points](img/image00463.jpeg),
    the **Add values manually** button. A new row will appear in the list. There,
    you should manually enter the **From** and **To** values, and adjust or accept
    the **Percent Transparent** value, which is set to `100` by default. As we are
    going to use values instead of ranges to set the transparency, the **From** and
    **To** entries will be identical:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过双击**图层**面板中的图层名称打开`coverage_0_Binary`属性对话框，并转到**透明度**部分。我们将使用**自定义透明度**选项和**透明像素列表**来根据它们的值调整像素的透明度属性。二值可见性栅格只包含两个值：`1`表示可见区域，`0`表示不可见区域。要将这些值添加到列表中，点击![步骤
    5 – 寻找风景点](img/image00463.jpeg)，**手动添加值**按钮。列表中会出现新的一行。在那里，你应该手动输入**从**和**到**的值，并调整或接受默认设置为`100`的**百分比透明度**值。由于我们将使用值而不是范围来设置透明度，**从**和**到**的条目将是相同的：
- en: In the first row, enter `1` and accept the 100% transparency.
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第一行，输入`1`并接受100%的透明度。
- en: 'Click on ![Step 5 – finding scenic points](img/image00463.jpeg) again to add
    the next row, enter `0` in **From** and **To**, and set the transparency to `25%`.
    As a result, your **Transparent pixel list** will look like this:'
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 再次点击![步骤 5 – 寻找风景点](img/image00463.jpeg)以添加下一行，在**从**和**到**中输入`0`，并将透明度设置为`25%`。结果，你的**透明像素列表**将看起来像这样：
- en: '![Step 5 – finding scenic points](img/image00465.jpeg)After making all the
    necessary adjustments, click on the **OK** button to apply them.'
  id: totrans-158
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![步骤 5 – 寻找风景点](img/image00465.jpeg)在完成所有必要的调整后，点击**确定**按钮以应用它们。'
- en: Apply the same styling options for the layers of the other points. Instead of
    working on every raster individually, right-click and navigate to **Styles** |
    **Copy Style** to replicate the preliminary configured visualization options from
    `coverage_0_Horizon` and `coverage_0_Horizon`. Then, go to **Styles** | **Paste
    Style** to insert them into the appropriate layers.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为其他点的图层应用相同的样式选项。而不是逐个处理每个栅格，右键单击并导航到**样式** | **复制样式**以复制从`coverage_0_Horizon`和`coverage_0_Horizon`预先配置的视觉选项。然后，转到**样式**
    | **粘贴样式**以将它们插入适当的图层。
- en: If the coverages are visualized properly, we only need to visually interpret
    them and make a decision about the best points after considering several criteria.
    First of all, a point should provide a view for the vast areas, and this can be
    analyzed through binary coverages; the more the area open to the observer, the
    better. Secondly, the horizon line should be clear, solid, and not disrupted by
    artifacts, if possible. The integrity of the visibility edge ensures panoramic
    views, and it can be analyzed through horizon coverages; the straighter and simpler
    the line, the better.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如果覆盖范围被正确可视化，我们只需要在考虑几个标准后，通过视觉解释它们并做出关于最佳点的决定。首先，一个点应该为广阔的区域提供视野，这可以通过二值覆盖来分析；对观察者开放的面积越多，越好。其次，地平线线应该清晰、坚固，尽可能不被伪影破坏。可见边缘的完整性确保了全景视图，这可以通过地平线覆盖来分析；线条越直、越简单，越好。
- en: 'Finally, you should always take into account the local features represented
    by sights, open spaces, and any other possible points of interest. Regarding New
    York city''s Brooklyn borough, there are a few remarkable features that you have
    probably heard about: the Brooklyn bridge and the waterfront area where the Brooklyn
    Bridge Park is located. This area is famous for its beautiful sunsets and awe-inspiring
    views of Manhattan and the East River. Taking into consideration all of these
    criteria, point number 7 would probably be the best choice. Not only does it provide
    views of the southern and northeastern parts of the area, but it also encompasses
    the waterfront area almost entirely, as shown here:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您始终应考虑由景点、开放空间和其他可能的兴趣点所代表的本地特征。关于纽约市的布鲁克林区，有几个您可能听说过的显著特征：布鲁克林大桥和布鲁克林大桥公园所在的水域。这个区域以其美丽的日落和令人敬畏的曼哈顿和东河景观而闻名。考虑到所有这些标准，第7点可能是最佳选择。它不仅提供了该区域南部和东北部的景观，而且几乎完全包括了水域，如图所示：
- en: '![Step 5 – finding scenic points](img/image00466.jpeg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![第5步 – 寻找风景点](img/image00466.jpeg)'
- en: When the winner among the best view is chosen, we can proceed to the following
    step and visualize the results of the analysis. Instead of representing them in
    a conventional cartographic way, we will use the power of three-dimensional visualization,
    which is of great use when dealing with urban landscapes.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 当选择最佳视图的获胜者后，我们可以进行下一步，并可视化分析结果。我们不会以传统的制图方式表示它们，而是将利用三维可视化的力量，这在处理城市景观时非常有用。
- en: Step 6 – styling the results in 3D
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6步 – 在3D中设置结果
- en: In this section, we will represent our data in a 3D scene using the impressive
    capabilities of the **Qgis2threejs** plugin. Install it as described in the *Extending
    functionality through the plugins* section of [Chapter 1](part0014.xhtml#aid-DB7S2
    "Chapter 1. Handling Your Data"), *Handling Your Data*. This plugin relies on
    the `three.js` library. It allows us to export terrain data, the map canvas image,
    and vector data straight to a web browser. As a result, you can view and explore
    exported objects as a 3D scene on web browser that supports WebGL.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将利用**Qgis2threejs**插件的强大功能，将我们的数据以3D场景的形式呈现。按照[第1章](part0014.xhtml#aid-DB7S2
    "第1章. 处理您的数据")中“通过插件扩展功能”部分所述，安装此插件，即“处理您的数据”。此插件依赖于`three.js`库。它允许我们直接将地形数据、地图画布图像和矢量数据导出到网页浏览器中。因此，您可以在支持WebGL的网页浏览器中查看和探索导出的对象，就像3D场景一样。
- en: 'After the installation is completed, the plugin is available from the **Qgis2threejs**
    menu under **Web**. There are two submenus available:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，该插件可在**Web**菜单下的**Qgis2threejs**菜单中找到。有两个可用的子菜单：
- en: '**Settings**: This is responsible for defining a browser that will be used
    to open generated 3D scenes. These settings should not be changed if you want
    your default browser to be used.'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**设置**：这负责定义一个将用于打开生成的3D场景的浏览器。如果您想使用默认浏览器，则不应更改这些设置。'
- en: '**Qgis2threejs**: This is the main window of the plugin, and it provides access
    to its general functionality. In the left part of the window, you can see the
    list of all available control parameters and the project''s layers. The right
    part of the window provides access to their settings and changes interactively,
    depending on the item selected on the left.'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Qgis2threejs**：这是插件的主窗口，它提供了对其一般功能的访问。在窗口的左侧，您可以查看所有可用控制参数和项目图层列表。窗口的右侧提供了对它们的设置和更改的访问，这取决于左侧选中的项目。'
- en: 'First of all, you need to adjust the map layers that will be used to generate
    an image draped over the terrain. For this example, we activate the following
    layers ordered from bottom to top: `water_area`, `parks`, `roads`, and `coverage_7_Binary`.
    You can always add more layers or even use the predefined WMS/ WFS or OpenLayers
    plugin coverages, for example, OpenStreetMap. These active layers will be used
    to provide background terrain.'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要调整将用于生成覆盖地形的图像的地图图层。在这个例子中，我们激活以下从下到上的图层：`water_area`、`parks`、`roads`和`coverage_7_Binary`。您始终可以添加更多图层，甚至可以使用预定义的WMS/WFS或OpenLayers插件覆盖，例如OpenStreetMap。这些活动图层将被用于提供背景地形。
- en: Note
  id: totrans-170
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: In the following sections, we are going to explore only the basic settings of
    the plugin that are necessary for generating a meaningful result from the training
    data. Extended help and descriptions of the parameters are available at [https://github.com/minorua/Qgis2threejs/wiki/ExportSettings](https://github.com/minorua/Qgis2threejs/wiki/ExportSettings).
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下部分，我们将仅探索插件的基本设置，这些设置对于从训练数据生成有意义的结果是必要的。有关参数的扩展帮助和描述可在[https://github.com/minorua/Qgis2threejs/wiki/ExportSettings](https://github.com/minorua/Qgis2threejs/wiki/ExportSettings)找到。
- en: Working on the general settings of a 3D scene
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在3D场景的一般设置上工作
- en: 'Once all the necessary layers are active, go through the following options
    to adjust the general settings of the scene:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦所有必要的图层都处于活动状态，请通过以下选项调整场景的一般设置：
- en: '**Template file**: Here, you can select different output templates from the
    drop-down list. Use the default **3DViewer(dat-gui).html** option, as it not only
    generates a 3D scene but also adds a control parameters panel to regulate the
    visibility and opacity of the layers and vertical movement of a custom horizontal
    plane.'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模板文件**：在此，您可以从下拉列表中选择不同的输出模板。使用默认的**3DViewer(dat-gui).html**选项，因为它不仅生成3D场景，还添加了一个控件参数面板来调节图层可见性和不透明度以及自定义水平平面的垂直移动。'
- en: '**World**: This item is responsible for the general appearance of the scene
    in the 3D world. The parameter we are especially interested in is **Vertical**
    **exaggeration**, as it defines the complexity of relief appearance. The bigger
    the value, the more emphasized terrain will reflect the relief features. Also,
    this value affects the *Z* positions of all vector 3D objects and 3D object heights
    of some object types with volume (points and extruded polygons). The default value
    is set to `1.5`, but our area of interest has a plane relief with smoothly changing
    values, so we enter `2` to make changes in the height more obvious.'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**世界**：此项目负责3D世界中场景的一般外观。我们特别感兴趣的是**垂直放大**参数，因为它定义了地形外观的复杂性。值越大，地形反映的地形特征就越明显。此外，此值还影响所有矢量3D对象的*Z*位置以及某些具有体积（点和挤出多边形）的对象类型的3D对象高度。默认值设置为`1.5`，但我们的兴趣区域有一个平面地形，其值变化平滑，因此我们输入`2`以使高度变化更加明显。'
- en: '**Controls**: There are two available control choices, accompanied by descriptions.
    Leave the default `OrbitControl.js` unchanged.'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**控件**：有两个可用的控件选项，附有描述。保持默认的`OrbitControl.js`不变。'
- en: '**DEM**: From the **DEM** layer drop-down list of available rasters, select
    `lidar_dem`, which will be used to provide actual information about heights of
    the area and generate a terrain of predefined vertical exaggeration. There are
    several sections that provide parameters to regulate DEM appearance:'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DEM**：从可用的栅格**DEM**层下拉列表中选择`lidar_dem`，它将用于提供关于该区域高度的实际信息并生成具有预定义垂直放大的地形。有几个部分提供参数来调节DEM外观：'
- en: The **Resampling** block is responsible for the generated surface resolution
    and provides various options for its adjustment. For the purpose of this tutorial,
    we will simply move the slider to the fourth tick, which gives an output resolution
    close to 400 x 400 pixels and resamples the original DEM to approximately 26.8
    feet. This approach is fast and produces a lightweight output, but resampling
    values affects the DEM's resolution, not the texture draped over it. If you want
    to produce more sophisticated and high-resolution results, read about the advanced
    settings, but bear in mind that high-resolution output takes more time to export,
    and also that the scene itself will require more computer resources to be responsive
    and rendered fast.
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**重采样**块负责生成的表面分辨率，并提供各种调整选项。在本教程的目的下，我们将简单地将滑块移动到第四个刻度，这将输出分辨率接近400 x 400像素，并将原始DEM重采样到大约26.8英尺。这种方法速度快，生成的输出轻量，但重采样值会影响DEM的分辨率，而不是覆盖其上的纹理。如果您想生成更复杂和高分辨率的成果，请阅读有关高级设置的说明，但请记住，高分辨率输出需要更多时间来导出，而且场景本身也需要更多的计算机资源来保持响应和快速渲染。'
- en: '**Display type**: Accept all the default settings that presume use of **Map
    canvas image** as a texture.'
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**显示类型**：接受所有默认设置，假设使用**地图画布图像**作为纹理。'
- en: '**Sides and frame**: Accept the default **Build sides** option. It adds sides
    and a bottom to the DEM.'
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**边框和框架**：接受默认的**构建边框**选项。它为DEM添加侧面和底部。'
- en: '**Additional DEM**: this option is might be of great use if you want to combine
    two rasters that contain some *Z* values (for example, absolute height and slope,
    heat maps and so on). As we are mainly interested in buildings and binary visibility
    rasters, this option is omitted.'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**附加DEM**：如果您想结合包含某些*Z*值（例如，绝对高度和坡度，热图等）的两个栅格，此选项可能非常有用。由于我们主要对建筑和二值可见性栅格感兴趣，此选项被省略。'
- en: Adjusting 3D visualization of the observation points
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调整观测点的3D可视化
- en: 'Expand the **Point** item on the left side of the window to see all the available
    point layers, and activate `observ_point`. In the right part of the window, adjust
    the following settings:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 展开窗口左侧的**点**项，以查看所有可用的点层，并激活`observ_point`。在窗口的右侧部分，调整以下设置：
- en: For **Object type**, accept the default **Sphere** value. The observation points
    will be represented by spheres in the 3D space.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**对象类型**，接受默认的**球体**值。观测点将在3D空间中以球体表示。
- en: 'Set **Z coordinate Mode** to **+"HEIGHT_ROO"**, which means that the height
    of a point will be obtained from the following formula: *z = elevation at vertex
    + field value + addend* *= DEM + HEIGHT_ROO*. In other words, we only summarize
    the elevation of the relief and the height of the building at a certain point,
    without any other values (*addend* is set to 0 and excluded from the second part
    of the formula). As a result, the point will take into account the local relief
    and represent the real vertical position of the observer.'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Z坐标模式**设置为**+"HEIGHT_ROO"**，这意味着点的海拔高度将根据以下公式获得：*z = 顶点海拔 + 字段值 + 加数* *=
    DEM + HEIGHT_ROO*。换句话说，我们只总结了地形的海拔和某一点的建筑高度，没有其他值（加数设置为0，并排除在公式的第二部分）。因此，该点将考虑局部地形并代表观察者的真实垂直位置。
- en: 'The **Style** section is responsible for the visual properties of the symbol:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**样式**部分负责符号的视觉属性：'
- en: Set **Color** to **Random** from the drop-down list, and the spheres will be
    assigned a color randomly.
  id: totrans-187
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从下拉列表中将**颜色**设置为**随机**，球体将被随机分配颜色。
- en: Accept the default **Feature style** option under **Transparency**. It will
    make the points solid, not transparent.
  id: totrans-188
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**透明度**下接受默认的**特征样式**选项。这将使点变得实心，而不是透明的。
- en: As we want all spheres to have the same size, we accept the **Fixed value**
    under **Radius** as it is. Type `50` in the **Value** field.
  id: totrans-189
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于我们希望所有球体具有相同的大小，我们在**半径**下接受**固定值**。在**值**字段中输入`50`。
- en: Now, let's consider **Features that intersect with map canvas extent**. With
    this default option, only the features that are displayed on the map canvas will
    be exported.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们考虑**与地图画布范围相交的特征**。使用此默认选项，只有显示在地图画布上的特征将被导出。
- en: 'The **Attribute and label** section provides access to the labeling options:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**属性和标签**部分提供了访问标签选项的权限：'
- en: Activate **Export** attributes to enable labeling. All the attributes will be
    exported and shown when you click on the relevant object in the 3D scene.
  id: totrans-192
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 激活**导出**属性以启用标签。所有属性将在您在3D场景中单击相关对象时导出并显示。
- en: From the **Label** field drop-down list, select the `OBJECTID` field that will
    be used for labeling.
  id: totrans-193
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从**标签**字段下拉列表中，选择用于标签的`OBJECTID`字段。
- en: The **Label height** option defines how high from the sphere its label will
    be shown. Here, we select the **Height from point** option from the drop-down
    list and set **Value** to `100`.
  id: totrans-194
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标签高度**选项定义了标签从球体的高度。在此处，我们从下拉列表中选择**从点高度**选项，并将**值**设置为`100`。'
- en: 'The following screenshot shows how the window will look after all the parameters
    are defined:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了定义所有参数后窗口的外观：
- en: '![Adjusting 3D visualization of the observation points](img/image00467.jpeg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![调整观测点的3D可视化](img/image00467.jpeg)'
- en: Adjusting 3D visualization of building footprints
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调整建筑轮廓的3D可视化
- en: 'Expand the **Polygon** item on the left side of the window to see all the available
    polygon layers, and activate `building_footprints`. On the right side of the window,
    change the settings to what is shown in the following screenshot:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 展开窗口左侧的**多边形**项，以查看所有可用的多边形层，并激活`building_footprints`。在窗口的右侧，将设置更改为以下截图所示：
- en: '**Object type**: Set this to **Extruded**. This means that 2D polygon footprints
    will be represented as 3D parallelepipeds.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对象类型**：将其设置为**拉伸**。这意味着二维多边形足迹将被表示为三维平行六面体。'
- en: '**Mode**: Set this to **Relative to DEM**. This means that the height of the
    building will be obtained from the following formula *z = elevation at vertex
    + addend* *= DEM*. In other words, as we don''t use any additional values and
    the height is set to 0, the relative height of the building will be DEM dependent
    only.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模式**: 将此设置为 **相对于DEM**。这意味着建筑的高度将通过以下公式获得 *z = 顶点高程 + 加数* *= DEM*。换句话说，因为我们没有使用任何额外的值，并且高度设置为0，所以建筑物的相对高度将仅依赖于DEM。'
- en: '**Height**: Set this to `HEIGHT_ROO`. Jointly with the previous setting, this
    setting makes it possible to show buildings with their real height, relative to
    the absolute height a.s.l. obtained from the DEM.![Adjusting 3D visualization
    of building footprints](img/image00468.jpeg)'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高度**: 将此设置为 `HEIGHT_ROO`。与之前的设置一起，此设置使得显示建筑物时能够展示其真实高度，相对于从数字高程模型（DEM）获得的绝对高度。![调整建筑物足迹的3D可视化](img/image00468.jpeg)'
- en: 'After all of these settings are done, click on the **Browse** button to specify
    the path and name for the output scene. Then click on **Run**. When the scene
    is generated, it will be automatically loaded and opened in your default web browser,
    where you can visually explore the results of the analysis using the previously
    defined controls, as shown here:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 完成所有这些设置后，点击 **浏览** 按钮以指定输出场景的路径和名称。然后点击 **运行**。当场景生成后，它将自动加载并在你的默认网络浏览器中打开，你可以使用之前定义的控件来可视化地探索分析结果，如图所示：
- en: '![Adjusting 3D visualization of building footprints](img/image00469.jpeg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![调整建筑物足迹的3D可视化](img/image00469.jpeg)'
- en: Summary
  id: totrans-204
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you were exposed to the basics of visibility analysis, including
    input data preparation, visibility point creation, and production and interpretation
    of visibility coverages in order to find the best observation point. Moreover,
    you learned how to represent your results through realistic 3D models, which are
    of great use in the visual exploration of urban data and the results of its analysis.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你接触到了可见性分析的基础，包括输入数据准备、可见点创建以及生成和解释可见性覆盖，以便找到最佳的观测点。此外，你还学习了如何通过逼真的3D模型来展示你的结果，这在城市数据的视觉探索及其分析结果中非常有用。
- en: In the next chapter, you will learn how to define a perfect location by means
    of spatial analysis.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，你将学习如何通过空间分析来定义一个完美的位置。
