<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Visualizing and Styling the Data" id="aid-K0RQ1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Visualizing and Styling the Data</h1></div></div></div><p>Collecting and organizing data from different sources is only half of the story. The next step is to present it on a map, accurately disclosing thematic content and features. For this purpose, various techniques of visual design, or styling layers based on their attributes, are used in GIS. QGIS has incredibly broad and flexible capabilities of cartographic visualization and data styling.</p><p>In this chapter, we will go through the following topics and skills:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Good practices with respect to data organization within a single working document (project)</li><li class="listitem">Visual representation of data, revealing its thematic and spatial features</li><li class="listitem">Layer labeling, which is done to enhance data readability</li><li class="listitem">Control over styles</li><li class="listitem">Base maps used to provide spatial context and a background for your data</li></ul></div><p>The main result of this chapter will be a project, designed according to the basic requirements of cartographic visualization.</p><div class="section" title="Loading layers from the spatial database"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Loading layers from the spatial database</h1></div></div></div><p>Throughout this <a id="id85" class="indexterm"/>chapter, we will use the database that we created earlier. As you remember, this is a SpatiaLite file database. In order to work with it, we must first establish a connection and then load the data. As always, there are <a id="id86" class="indexterm"/>a few alternative ways of doing this in QGIS:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">From the menu, go to <span class="strong"><strong>Layer</strong></span> | <span class="strong"><strong>Add Layer</strong></span> | <span class="strong"><strong>Add SpatiaLite Layer</strong></span></li><li class="listitem">
Click on <span class="inlinemediaobject"><img src="../Images/image00305.jpeg" alt="Loading layers from the spatial database"/></span>, the <span class="strong"><strong>Add SpatiaLite Layer</strong></span> button, in the <span class="strong"><strong>Manage Layers</strong></span> toolbar
</li><li class="listitem">Use the <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>L</em></span> keyboard shortcut</li></ul></div><p>In the opened window, define the database you want to connect to by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If you have<a id="id87" class="indexterm"/> created the database as was described in the previous chapter, you are likely to notice that it has already been connected. If it is not, then click on the <span class="strong"><strong>New</strong></span> button and navigate to the <code class="literal">.sqlite</code> file you want to work with.</li><li class="listitem">After the<a id="id88" class="indexterm"/> database file is selected, click on the <span class="strong"><strong>Connect</strong></span> button to see the list of available layers. You will see the layers' names and geometry types.</li><li class="listitem">Select the necessary layer (or layers, which is done by holding down the <span class="emphasis"><em>Ctrl</em></span> key) and click on the <span class="strong"><strong>Add</strong></span> button.<div class="note" title="Note"><h3 class="title"><a id="note09"/>Note</h3><p>The <span class="strong"><strong>Set filter</strong></span> button gives you more flexibility when adding the data, as it provides access to the <span class="strong"><strong>Query Builder</strong></span> window, where you can make up a conditional expression to define the sub-dataset, as shown in the following figure. For example, if you want to select a <a id="id89" class="indexterm"/>multipurpose play area (MPPA) from the <code class="literal">athletic facilities</code> dataset, you can do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">On the left side of the <span class="strong"><strong>Query Builder</strong></span> window, select a necessary field called <code class="literal">primary_sp</code> (double-click on its name to add to the expression in the <span class="strong"><strong>Provider specific filter expression</strong></span> textbox)</li><li class="listitem">Type in or click on the operator button (the equality sign in our case)</li><li class="listitem">Load the field values by clicking on the <span class="strong"><strong>All</strong></span> button, and double-click on an <code class="literal">MPPA</code> value to add it to the expression</li><li class="listitem">In the <span class="strong"><strong>Provider specific filter expression</strong></span> textbox, you will see the following line: <code class="literal">"primary_sp" = 'MPPA'</code></li></ul></div><p>Test the query. If it returns a meaningful result, click on <span class="strong"><strong>OK</strong></span>. After returning to the main window, you will see the condition beside the <span class="strong"><strong>geom</strong></span> column. Click on the <span class="strong"><strong>Add</strong></span> button to load the layers.</p></div><div class="mediaobject"><img src="../Images/image00306.jpeg" alt="Loading layers from the spatial database"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>Loading layers is <a id="id90" class="indexterm"/>even simpler from the <span class="strong"><strong>Browser</strong></span> panel. To see the available layers, successively<a id="id91" class="indexterm"/> expand <span class="strong"><strong>SpatiaLite</strong></span> and the relevant database item. Now you can just drag and drop the layers onto the map canvas.</p></div></div>
<div class="section" title="Grouping and reordering layers" id="aid-KVCC1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Grouping and reordering layers</h1></div></div></div><p>By default, layers<a id="id92" class="indexterm"/> are loaded<a id="id93" class="indexterm"/> in alphabetical order (reversely if you add them from the browser panel). Each new layer is laid on top of the previous layer and covers it. By default, all layers are turned on, styled with simple uniform symbols, and randomly assigned colors. The order of layers can be changed by simply dragging and dropping them up and down the legend. Also, it is strongly advisable to order and arrange layers in some logical groups, as it simplifies the navigation and understanding of data.</p><p>To manage<a id="id94" class="indexterm"/> and rearrange layers and maintain their visibility, use the <span class="strong"><strong>Layer</strong></span> toolbar in the <span class="strong"><strong>Layers</strong></span> panel, which is shown in the following screenshot and contains the buttons described afterwards (in the order of appearance from left to right):</p><div class="mediaobject"><img src="../Images/image00307.jpeg" alt="Grouping and reordering layers"/></div><p style="clear:both; height: 1em;"> </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Add Group</strong></span>: This <a id="id95" class="indexterm"/>creates an empty layers group.</li><li class="listitem"><span class="strong"><strong>Manage Layer Visibility</strong></span>: This allows us to quickly show and hide layers and also customize their visibility with predefined layer combinations—so-called presets.</li><li class="listitem"><span class="strong"><strong>Filter Legend By Map Content</strong></span>: If the filter is active, layer legend only shows those items that are actually visible inside the map canvas. All other symbols are hidden from the legend.</li><li class="listitem"><span class="strong"><strong>Expand All</strong></span> / <span class="strong"><strong>Collapse All</strong></span>: Buttons are used to expand or collapse layers, symbology legends, and layer groups, if any.</li><li class="listitem"><span class="strong"><strong>Remove Layer/Group</strong></span>: This removes the selected legend entries.</li></ul></div><p>There are two ways of creating a layer group:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
Click on <span class="inlinemediaobject"><img src="../Images/image00308.jpeg" alt="Grouping and reordering layers"/></span>, the <span class="strong"><strong>Add Group</strong></span> button, from the <span class="strong"><strong>Layers</strong></span> toolbar. A new group will appear at the bottom of the list of layers. Type in an appropriate name and then drag and drop the layers into the group.
</li><li class="listitem">Select several layers while holding down the <span class="emphasis"><em>Ctrl</em></span> key, and use the <span class="strong"><strong>Group Selected</strong></span> right-click contextual shortcut to place them in a single group.</li></ul></div><p>It is possible to develop a multilevel hierarchy with subgroups by selecting groups and applying <span class="strong"><strong>Add Group</strong></span> to them. Any item of the layer legend, whether it's a single layer or a group, can be renamed with the <span class="strong"><strong>Rename</strong></span> right-click shortcut. Renaming doesn't affect the dataset itself, but allows us to apply to it a proper and meaningful name within a project. Now<a id="id96" class="indexterm"/> try arranging the layers into several meaningful groups yourself, and name<a id="id97" class="indexterm"/> them appropriately.</p></div>
<div class="section" title="Developing your own styles"><div class="titlepage" id="aid-LTSU2"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Developing your own styles</h1></div></div></div><p>In QGIS, a style is a way of cartographic visualization that takes into account a layer's individual and<a id="id98" class="indexterm"/> thematic features. It encompasses basic characteristics of symbology, such as the color and presence of fill, outline parameters, the use of markers, scale-dependent rendering, layer transparency, interactions with other layers, and labels.</p><p>A well-chosen style greatly simplifies data perception and readability, so it is important to learn how to work with styles in order to be capable of representing your data in the best way. In this section, we will discuss vector and raster layers separately, as their stylization has some unique features.</p><div class="section" title="Developing styles for vector layers"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>Developing styles for vector layers</h2></div></div></div><p>The <span class="strong"><strong>Style</strong></span> menu from the <span class="strong"><strong>Layer Properties</strong></span> dialog provides you with all the necessary tools to symbolize and <a id="id99" class="indexterm"/>style your data. To open it, double-click<a id="id100" class="indexterm"/> on a layer name in the <span class="strong"><strong>Layers</strong></span> panel, or use the <span class="strong"><strong>Properties</strong></span> right-click contextual shortcut, and select the <span class="strong"><strong>Style</strong></span> section. You will see something similar to this:</p><div class="mediaobject"><img src="../Images/image00309.jpeg" alt="Developing styles for vector layers"/></div><p style="clear:both; height: 1em;"> </p><p>The very first<a id="id101" class="indexterm"/> thing you should pay your attention to is the small <span class="strong"><strong>Renderer</strong></span> drop-down type list in the top-left corner. It contains the following items:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Single Symbol</strong></span>: This is the simplest type that draws all the layer features with the same symbol.</li><li class="listitem"><span class="strong"><strong>Categorized</strong></span>: This defines data-driven categories and allows us to symbolize them individually.</li><li class="listitem"><span class="strong"><strong>Graduated</strong></span>: This <a id="id102" class="indexterm"/>defines the categories based on quantitative attributes, allowing us to rank features gradually.</li><li class="listitem"><span class="strong"><strong>Rule-based</strong></span>: This is the most flexible and advanced renderer type. It allows the user to define their own categories using multiple criteria and style them individually.</li><li class="listitem"><span class="strong"><strong>Point displacement</strong></span>: This renderer is useful when you are working with a point layer containing overlapping points that have similar coordinates or are located too close to each other. It is available only for single point layers, and will automatically shift the location of the markers so that all overlapping markers are visible.</li><li class="listitem"><span class="strong"><strong>Inverted polygons</strong></span>: These are used to style the area exterior to the polygon, and are available for polygon layers only.</li><li class="listitem"><span class="strong"><strong>Heatmap</strong></span>: This represents a point layer with a continuous surface according to the points' density, It is available for point layers only.</li></ul></div><p>Depending on the renderer type selected, the <span class="strong"><strong>Style</strong></span> menu section changes its view, and if you mistakenly select an inappropriate type (for example, the heat map renderer for a line layer), you will get the corresponding message.</p><p>After the renderer<a id="id103" class="indexterm"/> type is chosen, you can start adjusting the symbology with the <span class="strong"><strong>Symbol selector</strong></span> dialog, whose accessibility depends on the renderer<a id="id104" class="indexterm"/> type selected. For example, for the <span class="strong"><strong>Single symbol</strong></span> and the <span class="strong"><strong>Inverted polygons</strong></span> renderer, this dialog is directly available from the <span class="strong"><strong>Style</strong></span> section. For the <span class="strong"><strong>Categorized</strong></span> and <span class="strong"><strong>Graduated</strong></span> renderers, it is available from the <span class="strong"><strong>Symbol Change</strong></span> button, which looks like this: <span class="inlinemediaobject"><img src="../Images/image00310.jpeg" alt="Developing styles for vector layers"/></span>.</p><p><span class="strong"><strong>Rule-based</strong></span>, <span class="strong"><strong>Point displacement</strong></span>, and <span class="strong"><strong>Heatmap</strong></span> renderers have their own specifications for symbology selection and adjustment, which will be covered in the following sections. Nevertheless, regardless of the renderer type selected (except the <span class="strong"><strong>Heatmap</strong></span> renderer), you always have access to the <span class="strong"><strong>Symbol selector</strong></span> dialog, which looks similar to what is shown in the following screenshot and consists of several sections:</p><div class="mediaobject"><img src="../Images/image00311.jpeg" alt="Developing styles for vector layers"/></div><p style="clear:both; height: 1em;"> </p><p>In the top-left part of the window, you can see a symbol preview. Underneath the preview, there are symbol layers. By default, only one layer is used, but you can add more with the <span class="strong"><strong>Add symbol layer</strong></span> button, <span class="inlinemediaobject"><img src="../Images/image00312.jpeg" alt="Developing styles for vector layers"/></span>, or remove unnecessary layers with the <span class="strong"><strong>Remove symbol layer</strong></span> button, <span class="inlinemediaobject"><img src="../Images/image00313.jpeg" alt="Developing styles for vector layers"/></span>, which is active only if there are two or more layers available. With the <span class="strong"><strong>Lock layer's color</strong></span> button, <span class="inlinemediaobject"><img src="../Images/image00314.jpeg" alt="Developing styles for vector layers"/></span>, the layer's <a id="id105" class="indexterm"/>color will be locked for changes, which prevents<a id="id106" class="indexterm"/> colors from being modified by a categorized or graduated renderer. Layers can be reordered with the <span class="strong"><strong>Move up</strong></span> (<span class="inlinemediaobject"><img src="../Images/image00315.jpeg" alt="Developing styles for vector layers"/></span>) and <span class="strong"><strong>Move down</strong></span> (<span class="inlinemediaobject"><img src="../Images/image00316.jpeg" alt="Developing styles for vector layers"/></span>) buttons, and if you are satisfied with the result, <span class="strong"><strong>use the Save symbol button</strong></span> in the symbol library.</p><p>In the right-hand side of the dialog window, there are options available for the symbol layer selected. Among them, <span class="strong"><strong>Symbol layer type</strong></span> is the most important. The list of available types depends on the layer geometry. For a polygon layer, you can select from the following list:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Centroid fill</strong></span>: Polygons are symbolized by a marker at the polygon's centroid, instead of rendering the entire area of the polygon. This is useful if you have a lot of small polygons that are better to visualize by a point than by a tiny polygon that is visible only after zooming in.</li><li class="listitem"><span class="strong"><strong>Gradient fill</strong></span>: Use a predefined gradient or create a custom gradient to fill the polygon.</li><li class="listitem"><span class="strong"><strong>Line pattern fill</strong></span>: Line patterns can be combined to create various hatching effects. These effects are useful when you want to use the same fill color underneath but want to highlight some differences between objects with hatching.</li><li class="listitem"><span class="strong"><strong>Point pattern fill</strong></span>: Regularly distributed points (or other symbols) can fill the polygon and create a pattern.</li><li class="listitem"><span class="strong"><strong>Raster image fill</strong></span>: Any raster image can be used to create a background-filling texture <a id="id107" class="indexterm"/>or pattern.</li><li class="listitem"><span class="strong"><strong>SVG fill</strong></span>: A scalable vector graphics <code class="literal">.svg</code> file (or a marker) can be used to create a filling texture or pattern.</li><li class="listitem"><span class="strong"><strong>Shapeburst fill</strong></span>: This shades the interior of a polygon, depending on the distance from the edge of the polygon, and creates amazing border buffering effects.</li><li class="listitem"><span class="strong"><strong>Simple fill</strong></span>: This the default type, and is characterized by fill color, pattern, and border.</li><li class="listitem"><span class="strong"><strong>Outline: marker line</strong></span>: A marker symbol is used as the outline.</li><li class="listitem"><span class="strong"><strong>Outline: Simple line</strong></span>: Only the polygon's outline is drawn and its properties defined by line color, width, and style.</li></ul></div><p>For a point layer, you <a id="id108" class="indexterm"/>can choose from different marker types represented by <span class="strong"><strong>Ellipse</strong></span>, letters or signs (<span class="strong"><strong>Font marker</strong></span>), various markers (<span class="strong"><strong>Simple marker</strong></span>), icons (<span class="strong"><strong>SVG marker</strong></span>), or attribute field values (<span class="strong"><strong>Vector Field marker</strong></span>).</p><p>For a line layer, the <span class="strong"><strong>Simple</strong></span> and <span class="strong"><strong>Marker line</strong></span> types are available. In the first case, the line is rendered as usual, and in the second, a regularly recurring marker symbol is used. <span class="strong"><strong>Marker line</strong></span> can be used, for example, to show a line's direction (movement on a road, a river flow, and so on) with an arrow marker symbol.</p><p>Now that we have covered the basics, we will closely explore different rendering styles in the example of some layers from our database.</p><div class="section" title="Styling a layer with the Single Symbol renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec01"/>Styling a layer with the Single Symbol renderer</h3></div></div></div><p>In this example, we <a id="id109" class="indexterm"/>will use the <code class="literal">Brooklyn borough boundaries</code> layer to outline the area of interest on the map. As you can see in the following<a id="id110" class="indexterm"/> screenshot, we use two symbol layers, both defined as <span class="strong"><strong>Outline: Simple line</strong></span>, but with different <span class="strong"><strong>Pen style</strong></span> patterns. Underneath, we place a lighter <span class="strong"><strong>Solid line</strong></span> and cover it with a darker <span class="strong"><strong>Dash Line</strong></span> pen style. Selecting contrast colors allows us to implement a border-like stripe effect.</p><div class="mediaobject"><img src="../Images/image00317.jpeg" alt="Styling a layer with the Single Symbol renderer"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Styling a layer with the Categorized renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec02"/>Styling a layer with the Categorized renderer</h3></div></div></div><p>Let's style the <code class="literal">public schools</code> layer to reflect the school type:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">After setting the<a id="id111" class="indexterm"/> renderer type to <span class="strong"><strong>Categorized</strong></span>, select the column with the categories to be rendered under<span class="strong"><strong> Column</strong></span>. The column is available from the drop-down list that contains all the<a id="id112" class="indexterm"/> layer attribute fields. As we want school types to be shown as categories, select the <code class="literal">sch_type</code> field to categorize the layer:<div class="mediaobject"><img src="../Images/image00318.jpeg" alt="Styling a layer with the Categorized renderer"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Symbol Change</strong></span> button to adjust the layer symbology. In the <span class="strong"><strong>Symbol selector</strong></span> window, set <span class="strong"><strong>Symbol layer type</strong></span> to <span class="strong"><strong>SVG marker</strong></span> and navigate to the training dataset catalog called <code class="literal">svg</code>. Select the <code class="literal">school.svg</code> file and adjust the symbol's <span class="strong"><strong>Size</strong></span> value to <code class="literal">3</code> mm. Click on the <span class="strong"><strong>OK</strong></span> button to come back to the main window:<div class="mediaobject"><img src="../Images/image00319.jpeg" alt="Styling a layer with the Categorized renderer"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Classify</strong></span> button. The window with the <span class="strong"><strong>Symbol</strong></span>, <span class="strong"><strong>Value</strong></span>, and <span class="strong"><strong>Legend</strong></span> columns will automatically be populated with the categories and their descriptions from the attribute field. The difference between <span class="strong"><strong>Value</strong></span> and <span class="strong"><strong>Legend</strong></span> is that<a id="id113" class="indexterm"/> values represent unique attributes, while the legend provides their descriptive characteristics. It's more obvious when values, for example, are some codes and the legend is supposed to explain their meaning. Also, values are not visible in the<a id="id114" class="indexterm"/> layer's legend, but their descriptions are. You can add or delete the categories, or manually edit the text of its elements (<span class="strong"><strong>Value</strong></span> or <span class="strong"><strong>Legend</strong></span>) by double-clicking on the item in the relevant column. For now, just click on <span class="strong"><strong>OK</strong></span> to exit the <span class="strong"><strong>Style</strong></span> dialog and take a look at the preliminary result.</li><li class="listitem">You will see that the symbols on the map canvas are too dense and overlapped, which makes the map cluttered. To enhance readability, we should relate the appearance of symbols with a scale, and there are two basic approaches to do this:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Activate <span class="strong"><strong>Scale dependent visibility</strong></span> from the <span class="strong"><strong>General</strong></span> tab of the <span class="strong"><strong>Properties</strong></span> window, where you should enter values of <span class="strong"><strong>Minimum (exclusive)</strong></span> and <span class="strong"><strong>Maximum (inclusive)</strong></span> scales. For example, if you define the values, as shown in the following screenshot, the<a id="id115" class="indexterm"/> layer will become visible within a scale range of 1:49,999 (because the minimum value of <code class="literal">50000</code> is excluded) and more. This approach doesn't affect the symbol's size. It only regulates the scale range for its appearance while zooming in and out of the<a id="id116" class="indexterm"/> map canvas:<div class="mediaobject"><img src="../Images/image00320.jpeg" alt="Styling a layer with the Categorized renderer"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">
The other approach, which we will actually use, is more sophisticated because it makes the symbol size dependent on the scale. To apply it, open the <span class="strong"><strong>Style</strong></span> dialog in the <span class="strong"><strong>Properties</strong></span> window, and click on <span class="inlinemediaobject"><img src="../Images/image00321.jpeg" alt="Styling a layer with the Categorized renderer"/></span>, the <span class="strong"><strong>Symbol</strong></span><span class="strong"><strong>Change</strong></span> button, to open the <span class="strong"><strong>Symbol selector</strong></span> dialog, as shown. Activate the necessary symbol layer, change its <span class="strong"><strong>Size</strong></span> units to <span class="strong"><strong>Map unit</strong></span>, and enter <code class="literal">30</code>. This means that the symbol size will be set 30 feet and changed according to the scale while zooming in or out. Click on the <span class="strong"><strong>OK</strong></span> button to come back to the main window.
<div class="mediaobject"><img src="../Images/image00322.jpeg" alt="Styling a layer with the Categorized renderer"/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="tip08"/>Tip</h3><p>In this case, the scale range can be defined through the <span class="strong"><strong>Adjust scaling range</strong></span> button (<span class="inlinemediaobject"><img src="../Images/image00323.jpeg" alt="Styling a layer with the Categorized renderer"/></span>), which opens a dialog window to define the minimum and maximum scale values.</p></div></li></ul></div></li><li class="listitem">By default, all categories are assigned the same <span class="strong"><strong>Symbol</strong></span> marker according to the SVG file selected, but you can modify it by <a id="id117" class="indexterm"/>double-clicking and adjusting the necessary properties (that is, <span class="strong"><strong>Fill</strong></span> and <span class="strong"><strong>Border</strong></span>) in the <span class="strong"><strong>Symbol selector</strong></span> dialog. Also, right-clicking on any item brings up a contextual menu with the <span class="strong"><strong>Copy</strong></span>, <span class="strong"><strong>Paste</strong></span>, <span class="strong"><strong>Change color</strong></span>, <span class="strong"><strong>Change transparency</strong></span>, <span class="strong"><strong>Change output unit</strong></span>, and <span class="strong"><strong>Change size</strong></span> shortcuts for simplifying some common actions.</li></ol><div style="height:10px; width: 1px"/></div><p>This screenshot shows what the screen may look like if you choose the <span class="strong"><strong>Categorized</strong></span> renderer and adjust the settings as described previously:</p><div class="mediaobject"><img src="../Images/image00324.jpeg" alt="Styling a layer with the Categorized renderer"/></div><p style="clear:both; height: 1em;"> </p><p>After you've clicked on the <span class="strong"><strong>OK</strong></span> button, the layer's style properties will be applied, and you can explore<a id="id118" class="indexterm"/> the layer visibility in the map canvas. In the case of map unit related symbol size, you will probably not be able to see markers while zooming out, but they will appear on larger scales, changing in size accordingly. Note that the symbols in the layer's legend<a id="id119" class="indexterm"/> on the <span class="strong"><strong>Layers</strong></span> panel behave similarly, that is, become larger on larger scales and shrink on smaller scales. This helps you know whether the layer is visible on this scale, and if it is, helps you see the appearance of its markers.</p></div><div class="section" title="Styling a layer with the Graduated renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec03"/>Styling a layer with the Graduated renderer</h3></div></div></div><p>The <span class="strong"><strong>Graduated</strong></span> renderer<a id="id120" class="indexterm"/> type is useful when you want to grade features according to some quantitative attribute. In our sample dataset, we have<a id="id121" class="indexterm"/> the <code class="literal">zipcodes</code> layer, which contains data about population in the <code class="literal">population</code> field. We will use this layer and field to rank ZIP code boundaries according to the number of people living and demonstrate how graduated rendering works.</p><div class="note" title="Note"><h3 class="title"><a id="tip09"/>Tip</h3><p>Instead of choosing an attribute field, you can click on the <span class="strong"><strong>Expression dialog</strong></span> button <span class="inlinemediaobject"><img src="../Images/image00325.jpeg" alt="Styling a layer with the Graduated renderer"/></span>, beside it. It will be useful if you need to use some values that are not in the attribute table, but can be derived from the field values. For example, you can use the <code class="literal">area/ 43560</code> expression to convert area in square feet into acres.</p></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set the renderer type to <span class="strong"><strong>Graduated</strong></span> and select the <code class="literal">population</code> field in the <span class="strong"><strong>Column</strong></span> section.</li><li class="listitem">Define the number of classes you wish to show (normally, five to seven classes are<a id="id122" class="indexterm"/> recommended, otherwise it can be difficult to distinguish between them visually), and select a <span class="strong"><strong>Color ramp</strong></span>.<div class="note" title="Note"><h3 class="title"><a id="tip10"/>Tip</h3><p>You can use a predefined standard color ramp or select from the advanced options. To<a id="id123" class="indexterm"/> use them, select <span class="strong"><strong>New color ramp</strong></span> from the bottom of the drop-down list. In the <span class="strong"><strong>Color ramp type</strong></span> window, you will get access to the following options:</p><div class="mediaobject"><img src="../Images/image00326.jpeg" alt="Styling a layer with the Graduated renderer"/></div><p style="clear:both; height: 1em;"> </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Gradient</strong></span>: This provides options to create and modify custom gradients.</li><li class="listitem"><span class="strong"><strong>Random</strong></span>: This creates a random color ramp according to various customizable options, such as <span class="strong"><strong>Hue</strong></span>, <span class="strong"><strong>Saturation</strong></span>, <span class="strong"><strong>Value</strong></span>, and <span class="strong"><strong>Classes</strong></span>.</li><li class="listitem"><span class="strong"><strong>ColorBrewer</strong></span>: Use predefined color palettes for maps designed for optimal clarity. This includes several color schemes for different kinds of data (sequential, divergent, and qualitative).</li><li class="listitem"><span class="strong"><strong>cpt-city</strong></span>: This provides access to dozens of color gradients for cartography, technical illustration, and design.</li></ul></div></div></li><li class="listitem">Then, select an appropriate graduation mode, which is as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Equal interval</strong></span>: The value range is divided into equal range classes<a id="id124" class="indexterm"/> according to the number of classes set (for example, values from 0 to 100<a id="id125" class="indexterm"/> are divided into five classes of 20 units each).</li><li class="listitem"><span class="strong"><strong>Quantile (Equal Count)</strong></span>: All of the data will be divided into the number of classes set, and ranges will be chosen in such a way that each class will contain the same number of items.</li><li class="listitem"><span class="strong"><strong>Natural Breaks (Jenks)</strong></span>: This method groups values according to their similarity. So the values within a class have minimum variance, but feature values across classes vary significantly.</li><li class="listitem"><span class="strong"><strong>Standard Deviation</strong></span>: Classes are divided according to the standard deviation of the values, and this shows how the data differs from its mean value.</li><li class="listitem"><span class="strong"><strong>Pretty Breaks</strong></span>: This creates <span class="emphasis"><em>n+1</em></span> classes for the given range of values (that is, if 5 classes are set, the resulting amount will be 6), similar to <span class="strong"><strong>Equal interval</strong></span>, but breaking points are selected so that the values are nicely rounded numbers (for example, multiples of 10 if using integers).</li></ul></div></li></ol><div style="height:10px; width: 1px"/></div><p>After you've clicked on the <span class="strong"><strong>Classify</strong></span> button, the <span class="strong"><strong>Symbol</strong></span>, <span class="strong"><strong>Values</strong></span>, and <span class="strong"><strong>Legend</strong></span> columns will be populated. Double-click on any of these to modify it. Right-clicking opens a contextual menu. It is strongly advisable to play around with the various classes and classification modes before deciding which is best for revealing the features of your data.</p><div class="mediaobject"><img src="../Images/image00327.jpeg" alt="Styling a layer with the Graduated renderer"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Styling a layer with the Rule-based renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec04"/>Styling a layer with the Rule-based renderer</h3></div></div></div><p>The <span class="strong"><strong>Rule-based</strong></span> renderer is the most flexible renderer because it allows you to divide data into your own<a id="id126" class="indexterm"/> complex categories and style them separately. We will explore the rule-based rendering <a id="id127" class="indexterm"/>capabilities in the example of the <code class="literal">bike routes</code> layer, which has a lot of attributes that are useful to visualize. For example, there are two fields that are of particular interest to visualize on map. The first one is <code class="literal">allclasses</code>, which contains the classification of the route types (for existing cycling facilities), based on the NYC Bicycle Master Plan classification. The types are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>I</strong></span>: Greenway/multi-use path.</li><li class="listitem"><span class="strong"><strong>II</strong></span>: On-street striped bicycle lane.</li><li class="listitem"><span class="strong"><strong>III</strong></span>: On-street signed bicycle route.</li><li class="listitem"><span class="strong"><strong>0</strong></span>: Planned, but not yet existing as a bike route.</li><li class="listitem"><span class="strong"><strong>L</strong></span>: Link. There is no facility present, but the element is suggested as a connection between portions of the bike network.</li><li class="listitem"><span class="strong"><strong>S</strong></span>: Stairs and pedestrian overpasses.</li></ul></div><p>The second field is <code class="literal">lanecount</code>, which shows the number of lanes. Rules need to be used to combine these attributes into separate categories that show both the route type and lane count. Follow these steps to develop a Rule-based symbology for the layer:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">
Navigate to <span class="strong"><strong>Properties</strong></span> | <span class="strong"><strong>Style</strong></span> and select the <span class="strong"><strong>Rule-based renderer</strong></span> type from the drop-down list. To create a rule, click on the <span class="strong"><strong>Add rule</strong></span><span class="inlinemediaobject"><img src="../Images/image00312.jpeg" alt="Styling a layer with the Rule-based renderer"/></span> button. The <span class="strong"><strong>Rule properties</strong></span> dialog window will open.
</li><li class="listitem">In the window, click on the <span class="strong"><strong>...</strong></span> button beside the <span class="strong"><strong>Filter</strong></span> line. The <span class="strong"><strong>Expression string builder</strong></span> window will open. This window consists of three sections:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The left section is <span class="strong"><strong>Expression</strong></span>, with the row of operator buttons above it. You <a id="id128" class="indexterm"/>can either type the expression manually or double-click on field names, values, and functions to compose it.</li><li class="listitem">The<a id="id129" class="indexterm"/> central section of the window is <span class="strong"><strong>Functions</strong></span>. To expand any item, click on the <span class="strong"><strong>+</strong></span> sign beside it and double-click to add it to the expression. We're mostly interested in the <span class="strong"><strong>Field</strong></span> and <span class="strong"><strong>Values</strong></span> items that contain all the available attribute field names. When you highlight any of them and click on the <span class="strong"><strong>Load values</strong></span> buttons that are <span class="strong"><strong>all unique</strong></span> or <span class="strong"><strong>10 samples</strong></span>, the list of values is returned. Again, you can either type a value in the expression manually or add it by double-clicking on it.</li><li class="listitem">If you're lost, look at the right part of the window. It contains contextual help for the item highlighted in <span class="strong"><strong>Functions</strong></span>.</li></ul></div><p>In our expression, we want to show greenways and multi-use paths that are in the <span class="strong"><strong>I</strong></span> category. The <code class="literal">"allclasses" = 'I'</code> expression for this is shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00328.jpeg" alt="Styling a layer with the Rule-based renderer"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">After clicking on the <span class="strong"><strong>OK</strong></span> button, you'll be in the <span class="strong"><strong>Rule properties</strong></span> window again. First of all, test the<a id="id130" class="indexterm"/> consistency of the expression. You will get the message <span class="strong"><strong>Filter returned 'some number' of feature(s)</strong></span>. If the number of features is <code class="literal">0</code>, it means that there are no features that satisfy the rule. Otherwise, you'll get a positive number<a id="id131" class="indexterm"/> that shows the number of features in the class.</li><li class="listitem">Then add a <span class="strong"><strong>Label</strong></span> and, if necessary, <span class="strong"><strong>Description</strong></span> to the class. If the <span class="strong"><strong>Scale range</strong></span> toggle is activated, you can define the maximum-minimum scale range to visualize the class on a map. Class symbology is developed in the <span class="strong"><strong>Symbol</strong></span> section of the window as shown:<div class="mediaobject"><img src="../Images/image00329.jpeg" alt="Styling a layer with the Rule-based renderer"/></div><p style="clear:both; height: 1em;"> </p><p>After clicking on<a id="id132" class="indexterm"/> the <span class="strong"><strong>OK</strong></span> button, you will be back to the main <span class="strong"><strong>Style</strong></span> window, where rules can be<a id="id133" class="indexterm"/> managed with the <span class="strong"><strong>Add rule</strong></span> <span class="inlinemediaobject"><img src="../Images/image00312.jpeg" alt="Styling a layer with the Rule-based renderer"/></span>, <span class="strong"><strong>Edit</strong></span> <span class="strong"><strong>rule</strong></span> <span class="inlinemediaobject"><img src="../Images/image00330.jpeg" alt="Styling a layer with the Rule-based renderer"/></span>, or <span class="strong"><strong>Remove rule</strong></span> <span class="inlinemediaobject"><img src="../Images/image00313.jpeg" alt="Styling a layer with the Rule-based renderer"/></span> buttons. Go ahead and add categories for the other classes available in this layer.</p></li></ol><div style="height:10px; width: 1px"/></div><p>With the <span class="strong"><strong>Refine current rules</strong></span> button, you can go further and develop multilevel hierarchy based on scales, categories, or ranges. For example, we can take <code class="literal">allclasses</code> as a major classification<a id="id134" class="indexterm"/> attribute and then divide it into subcategories by the number of lanes:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select category, navigate to <span class="strong"><strong>Refine current rule</strong></span> | <span class="strong"><strong>Add categories to rule</strong></span>, and select<a id="id135" class="indexterm"/> the <span class="strong"><strong>lanecount</strong></span> field from the <span class="strong"><strong>Column</strong></span> drop-down list. Click on the <span class="strong"><strong>Classify</strong></span> button:<div class="mediaobject"><img src="../Images/image00331.jpeg" alt="Styling a layer with the Rule-based renderer"/></div><p style="clear:both; height: 1em;"> </p><p>Similarly, add subcategories to other rules.</p></li><li class="listitem">
Now, we should check our rules to remove empty categories. Select all the available categories by holding down the <span class="emphasis"><em>Ctrl</em></span> key, and click on the <span class="strong"><strong>Count features</strong></span> button. Empty categories will be identified by the <span class="strong"><strong>0</strong></span> count. Click on the <span class="strong"><strong>Remove rule</strong></span> button <span class="inlinemediaobject"><img src="../Images/image00313.jpeg" alt="Styling a layer with the Rule-based renderer"/></span> to exclude them from the legend.
</li><li class="listitem">As a result, your rule-based style may look like this:<div class="mediaobject"><img src="../Images/image00332.jpeg" alt="Styling a layer with the Rule-based renderer"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You can greatly improve the visualization of multilevel symbols by clicking on the <span class="strong"><strong>Rendering order</strong></span> button and adjusting the symbol levels. In the opened <span class="strong"><strong>Symbol Levels</strong></span> dialog window, you can define the order in which the symbol layers are rendered. The numbers in the cells decide in which rendering pass the layer will be drawn. The idea is that some symbol levels should have a lower rendering order and others should have higher rendering order. Lower levels will<a id="id136" class="indexterm"/> be covered by higher ones, allowing the user to create smooth conjunctions and preserve the<a id="id137" class="indexterm"/> symbology hierarchy. Set up the rendering order as shown in the following screenshot and explore the results:<div class="mediaobject"><img src="../Images/image00333.jpeg" alt="Styling a layer with the Rule-based renderer"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Styling a layer with the Point displacement renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec05"/>Styling a layer with the Point displacement renderer</h3></div></div></div><p>Some point layers (for example, the <code class="literal">wifi public</code> layer from the training dataset) contain points<a id="id138" class="indexterm"/> with the same or similar coordinates that are impossible to distinguish on the map because of their overlapping. In this case, <span class="strong"><strong>Point displacement</strong></span> renderer can be of great use, as it locates overlapping points within an imaginary circle. It moves points to a small distance in such a way that they all become visible. Note that the renderer doesn't<a id="id139" class="indexterm"/> affect real point positions in the dataset, but visually changes placement to satisfy cartographic requirements. To be able to use this type of rendering, a layer should be a single point feature type.</p><p>To apply <span class="strong"><strong>Point displacement</strong></span> renderer to the <code class="literal">wifi public</code> layer follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Choose the <span class="strong"><strong>Center symbol</strong></span> marker around which the points will be displaced. By clicking on the symbol button, you get access to the conventional <span class="strong"><strong>Symbols selector</strong></span> dialog. In the window, set <span class="strong"><strong>Symbol layer type</strong></span> to <span class="strong"><strong>SVG marker</strong></span>, navigate to the training dataset catalog called <code class="literal">svg</code>, and select the <code class="literal">Wi-Fi-Logo.svg</code> file. Set its size to <code class="literal">20</code> and select <span class="strong"><strong>Map unit</strong></span> as the size measurements unit. After clicking on the <span class="strong"><strong>OK</strong></span> button, you will be brought back to the main window.</li><li class="listitem">Go to <span class="strong"><strong>Renderer</strong></span> | <span class="strong"><strong>Single symbol</strong></span> for the points themselves. After clicking on the <span class="strong"><strong>Rendering settings</strong></span> button below, you will be in the <span class="strong"><strong>Symbol selector</strong></span> dialog. Again, set the symbol layer type to <span class="strong"><strong>SVG marker</strong></span>, navigate to the training dataset catalog called <code class="literal">svg</code>, and select the <code class="literal">wi-fi.svg</code> file. Set its size to <code class="literal">30</code> and select <span class="strong"><strong>Map unit</strong></span> as the size measurement unit. After clicking on <span class="strong"><strong>OK</strong></span>, you will be taken back to the main window.</li><li class="listitem">The <span class="strong"><strong>Rendering circles</strong></span> section defines the properties of the circles that appear on a map to group the points that have similar coordinates and are thus grouped around the common center. The following properties are included:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Circle pen width</strong></span>: This defines the outline width of the bordering circle</li><li class="listitem"><span class="strong"><strong>Circle color</strong></span>: This defines the outline color of the bordering circle</li><li class="listitem"><span class="strong"><strong>Circle radius modification</strong></span>: The bigger this value, the bigger the circle will be</li><li class="listitem"><span class="strong"><strong>Point distance tolerance</strong></span>: The bigger this value, the more the points to be snapped around the common center</li></ul></div><p>For now, we accept the default values and apply the settings. In the following<a id="id140" class="indexterm"/> screenshot, you can see what the result may look like in the case of <a id="id141" class="indexterm"/>several points that share similar coordinates and need to be grouped around a common center:</p><div class="mediaobject"><img src="../Images/image00334.jpeg" alt="Styling a layer with the Point displacement renderer"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>The <span class="strong"><strong>Labels</strong></span> section contains some major labeling settings, for example, <span class="strong"><strong>Label attribute</strong></span>, <span class="strong"><strong>font</strong></span>, <span class="strong"><strong>color</strong></span>, and so on. We temporarily omit this, as labeling will be covered later in the <span class="emphasis"><em>Adding labels</em></span> section of this chapter.</p></div><div class="section" title="Styling a layer with the Inverted polygons renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec06"/>Styling a layer with the Inverted polygons renderer</h3></div></div></div><p>The <span class="strong"><strong>Inverted polygons</strong></span><a id="id142" class="indexterm"/> renderer styles the polygon outside its boundary and allows us to achieve remarkable cartographic effects. One of its common uses is for showing water bodies with the "fading out" blur <a id="id143" class="indexterm"/>effects on the map. For this purpose, <span class="strong"><strong>Duplicate</strong></span> the <code class="literal">NY borough boundaries</code> layer with the right-click contextual shortcut, right-click to <span class="strong"><strong>Rename</strong></span> it to <code class="literal">water area</code>, open the <span class="strong"><strong>Style</strong></span> properties dialog, and select the <span class="strong"><strong>Inverted polygons</strong></span> renderer.</p><p>Now, create a complex symbol that consists of two layers:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first <span class="strong"><strong>Symbol layer type</strong></span> is set to <span class="strong"><strong>Outline: simple line</strong></span>.</li><li class="listitem">The second one is <span class="strong"><strong>Shapeburst fill</strong></span>.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">In the <span class="strong"><strong>Gradient colors</strong></span> section, we choose the <span class="strong"><strong>Two color</strong></span> gradient from blue to white.</li><li class="listitem">In <span class="strong"><strong>Shading style</strong></span>, activate <span class="strong"><strong>Shade to a set distance:</strong></span>. The bigger the value, the larger the shading effect will be.</li><li class="listitem">Finally, adjust the <span class="strong"><strong>Blur strength</strong></span> slider to a value of <code class="literal">10</code> to make blurring softer. Click on the <span class="strong"><strong>OK</strong></span> button and enjoy the result!</li></ul></div><div class="mediaobject"><img src="../Images/image00335.jpeg" alt="Styling a layer with the Inverted polygons renderer"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Styling a layer with the Heatmap renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec07"/>Styling a layer with the Heatmap renderer</h3></div></div></div><p><span class="strong"><strong>Heatmap</strong></span> is a relatively new<a id="id144" class="indexterm"/> renderer type. It was introduced in the QGIS 2.8. It represents a point as a continuous-density surface and allows us to apply cool styling effects. Note that in order to be able to apply this type <a id="id145" class="indexterm"/>of renderer, the layer and map canvas should be in the same coordinate reference system.</p><p>We will apply the renderer to the <code class="literal">trees</code> layer, which contains over 15000 points. These are hard to show on the map individually because of their high density:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">After selecting the <span class="strong"><strong>Heatmap</strong></span> renderer type from the drop-down list, select a predefined color ramp for the layer called <span class="strong"><strong>Greens</strong></span>. If you are not satisfied with the color ramp, you can modify it by clicking on the <span class="strong"><strong>Edit</strong></span> button beside it, or create your own color ramp by choosing <span class="strong"><strong>New color ramp</strong></span> from the very end of the list, and finally <span class="strong"><strong>Invert</strong></span> the color ramp if there is a need.</li><li class="listitem">The <span class="strong"><strong>Radius</strong></span> field determines the search area for density estimation. It basically represents how close points must be to each other to influence the heat map. The larger the radius, the smoother the surface; and the smaller the radius, the finer the details in the heat map. You can define the radius of a point in different units: <span class="strong"><strong>Pixels</strong></span>, <span class="strong"><strong>Millimeter</strong></span>, or <span class="strong"><strong>Map unit</strong></span>. Remember that map units are scale dependent. Pixels and millimeters change regardless of the scale, but reflect zooming effects as well.</li><li class="listitem"><span class="strong"><strong>Maximum</strong></span><a id="id146" class="indexterm"/> <span class="strong"><strong>value</strong></span> is usually set automatically and is responsible for the maximum density of points per area unit, but you can adjust it to your needs.</li><li class="listitem">Also, you can use a <span class="strong"><strong>Weight points by</strong></span> numerical field just in case you want the layer to reflect some important information in addition to density. For example, if we have the relevant data, we can weigh schools by the number of students, or cafés by the number of visitors per month.</li><li class="listitem">The <span class="strong"><strong>Rendering</strong></span><a id="id147" class="indexterm"/> <span class="strong"><strong>quality</strong></span> slider is used to adjust the smoothness of the surface. The higher the quality you choose, the slower the rendering process will be, while coarser surfaces are rendered faster.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Layer rendering"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec08"/>Layer rendering</h3></div></div></div><p>Whichever rendering type<a id="id148" class="indexterm"/> you choose, there are always the same <span class="strong"><strong>Layer rendering</strong></span> options at the bottom of the <span class="strong"><strong>Style</strong></span> dialog window. The first one is a general <span class="strong"><strong>Layer transparency</strong></span> percentage slider. You can move it to adjust the layer transparency. <span class="strong"><strong>Layer blending mode</strong></span> provides some special graphics effects for the layer you work with to interact with the bottom layer (or layers). By default, the <span class="strong"><strong>Normal</strong></span> mode is set, which means that the underlying layer is hidden underneath without mixing of colors with covering layer. This is written as <code class="literal">(a, b) = a</code>, where <code class="literal">a</code> is the top layer and <code class="literal">b</code> is the bottom layer.</p><div class="mediaobject"><img src="../Images/image00336.jpeg" alt="Layer rendering"/><div class="caption"><p>Example of the Normal blend mode applied to the overlapping layers</p></div></div><p style="clear:both; height: 1em;"> </p><p>You can choose from among 12 different blending modes divided into four groups, as described in the<a id="id149" class="indexterm"/> following table:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Blend mode</p>
</th><th valign="bottom">
<p>Formula and description</p>
</th><th valign="bottom">
<p>The example of effects</p>
</th></tr></thead><tbody><tr><td colspan="3" valign="top" style="text-align: center">
<p><span class="strong"><strong>Lighten modes—this group of blending modes makes black disappear, preserves white, and lightens midtones.</strong></span></p>
</td></tr><tr><td valign="top">
<p>Lighten</p>
</td><td valign="top">
<p><span class="emphasis"><em>max (a, b)</em></span></p>
<p>The maximum of RGB components from both layers are selected.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00337.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Screen</p>
</td><td valign="top">
<p><span class="emphasis"><em>1-(1-a)×(1-b)</em></span></p>
<p>At first, RGB components of both layers are inverted. Then they are multiplied, and the final result is inverted again.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00338.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Dodge</p>
</td><td valign="top">
<p><span class="emphasis"><em>b÷(1-a)</em></span></p>
<p>the bottom layer is divided by the inverted top layer.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00339.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Addition</p>
</td><td valign="top">
<p><span class="emphasis"><em>a+b</em></span></p>
<p>This summarizes components for both layers.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00340.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td colspan="3" valign="top" style="text-align: center">
<p><span class="strong"><strong>Darken modes: this group is opposite to the previous one, which means that it preserves black, makes white disappear, and darkens midtones.</strong></span></p>
</td></tr><tr><td valign="top">
<p>Darken</p>
</td><td valign="top">
<p><span class="emphasis"><em>min (a, b)</em></span></p>
<p>The<a id="id150" class="indexterm"/> minimum of RGB components from both layers are selected.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00341.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Multiply</p>
</td><td valign="top">
<p><span class="emphasis"><em>a × b</em></span></p>
<p>The layers are multiplied.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00342.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Burn</p>
</td><td valign="top">
<p><span class="emphasis"><em>1 - (1-b)÷a</em></span></p>
<p>The bottom layer is inverted and divided by the top layer, and the result is inverted again.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00343.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td colspan="3" valign="top" style="text-align: center">
<p><span class="strong"><strong>Contrast modes: the modes drop midtones, and apply dark and light pixels from the top layer to darken or lighten pixels from the bottom layer respectively.</strong></span></p>
</td></tr><tr><td valign="top">
<p>Overlay</p>
</td><td valign="top">
<p>Combines two blend modes for different pixels. For lighter pixels, half-strength Screen mode is applied, and for darker pixels, it is Multiply mode. As a result, gray midtones become invisible. Calculations are based on the bottom layer, which means that pixels of the top layer are lightened or darkened by the bottom layer.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00344.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Soft light</p>
</td><td valign="top">
<p>This is<a id="id151" class="indexterm"/> the same as the previous one, but instead of Screen and Multiply modes, Dodge and Burn modes are used for lightening and darkening respectively.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00345.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Hard light</p>
</td><td valign="top">
<p>This is similar to Overlay, but the top and bottom layers are switched.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00346.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td colspan="3" valign="top" style="text-align: center">
<p><span class="strong"><strong>Inversion and cancellation modes: apply simple arithmetic actions to invert colors and suppress black</strong></span></p>
</td></tr><tr><td valign="top">
<p>Difference</p>
</td><td valign="top">
<p><span class="emphasis"><em>b-a</em></span></p>
<p>This subtracts pixel values of the top layer from the bottom layer, preserving only positive values; that is, blending with black (0) has no changes, while blending with white (1) inverts the color.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00347.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr><tr><td valign="top">
<p>Subtract</p>
</td><td valign="top">
<p><span class="emphasis"><em>b-a</em></span></p>
<p>This is similar to the Difference mode, but negative values are substituted by black.</p>
</td><td valign="top">
<div class="mediaobject"><img src="../Images/image00348.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p>
</td></tr></tbody></table></div><p><span class="strong"><strong>Feature blending mode</strong></span> applies the same effects to the overlapping features within the layer. We advise you to give the different modes a try in order to understand how they work with different data types and styling options. Getting familiar with them allows you to create professional-looking maps with stunning cartographic design effects.</p><div class="mediaobject"><img src="../Images/image00349.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p><p>The preceding <a id="id152" class="indexterm"/>screenshot is an example of the hurricane evacuation zones layer combined with the underlying primary residential zoning layer through simple 50 percent transparency (on the left), versus the <span class="strong"><strong>Multiply blending mode</strong></span> used without any transparency (on the right).</p><div class="mediaobject"><img src="../Images/image00350.jpeg" alt="Layer rendering"/></div><p style="clear:both; height: 1em;"> </p><p>In the preceding screenshot, the <code class="literal">noise</code> point layer with simple marker fill opacity set to 20 percent; the<a id="id153" class="indexterm"/> <span class="strong"><strong>Layer blending mode</strong></span> is <span class="strong"><strong>Hard light</strong></span> and <span class="strong"><strong>Feature blending mode</strong></span> is <span class="strong"><strong>Dodge</strong></span>.</p></div></div><div class="section" title="Developing styles for raster layers"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>Developing styles for raster layers</h2></div></div></div><p>Our dataset contains three<a id="id154" class="indexterm"/> raster layers: <code class="literal">landcover 2010</code>, <code class="literal">height a.s.l., ft</code>, and <code class="literal">hillshade</code>. All of these are remote sensing derivatives that are useful for representing land use and relief<a id="id155" class="indexterm"/> features. We will develop styles for them to represent the DEM as a continuous layer, and combine it with a hillshade to obtain some semi-3D cartographic effects. The <code class="literal">landcover 2010</code> layer will be used to show how to work with the set of discrete classes.</p><p>First, let's style the <code class="literal">landcover 2010</code> layer that contains several landcover classes. These are coded by integer values described in the metadata as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">1</code>: <code class="literal">tree canopy</code></li><li class="listitem"><code class="literal">2</code>: <code class="literal">grass/shrub</code></li><li class="listitem"><code class="literal">3</code>: <code class="literal">bare earth</code></li><li class="listitem"><code class="literal">4</code>: <code class="literal">water</code></li><li class="listitem"><code class="literal">5</code>: <code class="literal">buildings</code></li><li class="listitem"><code class="literal">6</code>: <code class="literal">roads</code></li><li class="listitem"><code class="literal">7</code>: <code class="literal">other paved surfaces</code></li></ul></div><p>Let's develop the styles by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <span class="strong"><strong>Style</strong></span> tab from the <span class="strong"><strong>Properties</strong></span> dialog window (double-click on the layer in the legend, or select the <span class="strong"><strong>Properties</strong></span> right-click contextual shortcut).</li><li class="listitem">Set <span class="strong"><strong>Singleband pseudocolor</strong></span> as <span class="strong"><strong>Render type</strong></span>. As our raster has only one band, it will be loaded automatically as <span class="strong"><strong>Band 1 (Gray)</strong></span> in the <span class="strong"><strong>Band</strong></span> drop-down list.</li><li class="listitem">As we work with discrete landcover classes, we go to <span class="strong"><strong>Color interpolation</strong></span> | <span class="strong"><strong>Discrete</strong></span>.</li><li class="listitem">
Now we need to add our classes into the legend window. Use the <span class="strong"><strong>Add values manually</strong></span> button, <span class="inlinemediaobject"><img src="../Images/image00312.jpeg" alt="Developing styles for raster layers"/></span>, to add classes.
</li><li class="listitem">By default, all the classes are assigned the <span class="strong"><strong>Value</strong></span> of <code class="literal">0</code>, the same <span class="strong"><strong>Color</strong></span>, and <span class="strong"><strong>Custom color map entry</strong></span> instead of <span class="strong"><strong>Label</strong></span>. You can change them by double-clicking on a correspondent item. When you're done, your <span class="strong"><strong>Style</strong></span> section will look similar to what is shown in the following screenshot:<div class="mediaobject"><img src="../Images/image00351.jpeg" alt="Developing styles for raster layers"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">For the <code class="literal">height a.s.l., ft</code> layer, in the <span class="strong"><strong>Style</strong></span> section, select <span class="strong"><strong>Render type</strong></span> as <span class="strong"><strong>Singleband pseudocolor</strong></span>.</li><li class="listitem">The band will be set automatically, and in the case of smoothly changing values as<a id="id156" class="indexterm"/> in DEM, leave the default <span class="strong"><strong>Linear</strong></span> option (under<span class="strong"><strong> Color interpolation</strong></span>) unchangeable.</li><li class="listitem">Now, we need to select an appropriate color ramp for the thematic content of the layer. A<a id="id157" class="indexterm"/> predefined ramps drop-down list doesn't show you all of the available diversity. To get this, select <span class="strong"><strong>New color ramp</strong></span>. From the <span class="strong"><strong>Color ramp type</strong></span> window drop-down list, select <code class="literal">cpt-city</code>. You will be shown all the available predefined color ramps, sorted into several thematic groups.</li><li class="listitem">Click on the <span class="strong"><strong>Topography</strong></span> group, select the <span class="strong"><strong>elevation</strong></span> ramp (or any other ramp you like), and click on the <span class="strong"><strong>OK</strong></span> button.</li><li class="listitem">We will be asked to enter a name for new color ramp. Click on <span class="strong"><strong>OK</strong></span> as we're satisfied with the existing one. Then, we'll be back to the main <span class="strong"><strong>Style</strong></span> window.</li><li class="listitem">Navigate to <span class="strong"><strong>Mode</strong></span> | <span class="strong"><strong>Continuous</strong></span>, and QGIS will create classes after you click on the <span class="strong"><strong>Classify</strong></span> button. The <span class="strong"><strong>min / max</strong></span> values range within which these classes will be created is defined in the <span class="strong"><strong>Load min/max values</strong></span> section with the following options, as shown in the following screenshot:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Cumulative count cut</strong></span>: By default, this is set to 2-98 percent of the data range and helps cut very low or very high data outliers. Choosing<a id="id158" class="indexterm"/> this type of data<a id="id159" class="indexterm"/> range setting, the initial image gains more contrast and better reflects differences in the data values.</li><li class="listitem"><span class="strong"><strong>Min / max</strong></span>: The entire data range is taken into account, but the resulting map may look dull.</li><li class="listitem"><span class="strong"><strong>Mean +/- standard deviation ×</strong></span>: Values within the given standard deviations (or deviations) define the data range.</li></ul></div><div class="mediaobject"><img src="../Images/image00352.jpeg" alt="Developing styles for raster layers"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>To load values <a id="id160" class="indexterm"/>according to the specified data range mode, choose <span class="strong"><strong>Actual (slower)</strong></span> in the <span class="strong"><strong>Accuracy</strong></span> section option and click on the <span class="strong"><strong>Load</strong></span> button. Depending on the dataset, it may take some time, and when you see that the <span class="strong"><strong>Min</strong></span> and <span class="strong"><strong>Max</strong></span> values below the color ramp and <span class="strong"><strong>Mode</strong></span> are updated, click on the <span class="strong"><strong>Classify</strong></span> button. In the window to the left, you will see classes and their ranges set up automatically within<a id="id161" class="indexterm"/> the defined data range. This is as per the color ramp chosen. It is important to understand that every value represents the maximum limit of the class, and the highest value is not the real maximum value of the dataset, but the cumulative maximum count. You can adjust values by double-clicking on them and typing integer values, and clarify the legend by entering ranges instead of single values. Look at the preceding screenshot to understand these explanations.</p><p>Finally, let's style the <code class="literal">hillshade</code> raster to reveal details and roughness of relief. Before starting, make sure that the layer is above <code class="literal">height a.s.l., ft</code>, and if not, drag it and place it properly. Hill-shading simulates how sunrays illuminate the terrain. Combining it with DEM is a very popular approach in cartographic visualization for implementing semi-3D effects and<a id="id162" class="indexterm"/> highlighting relief details. Conventionally, semi-transparent hill-shading is overlaid above the terrain layer to achieve this. As a<a id="id163" class="indexterm"/> result, the final terrain visualization loses color contrasts and becomes dull. To overcome this, we will first move the <span class="strong"><strong>Global transparency</strong></span> slider to 50 percent in the <span class="strong"><strong>Transparency</strong></span> section under<span class="strong"><strong> Layer properties</strong></span>, and in the <span class="strong"><strong>Style</strong></span> section, select <span class="strong"><strong>Multiply</strong></span> from the <span class="strong"><strong>Blending mode</strong></span> drop-down list. If you're not sure about what exactly has happened, try to apply <span class="strong"><strong>Normal blending mode</strong></span> using <span class="strong"><strong>Apply</strong></span>, and then go back to <span class="strong"><strong>Multiply</strong></span>. The following screenshot shows the difference:</p><div class="mediaobject"><img src="../Images/image00353.jpeg" alt="Developing styles for raster layers"/></div><p style="clear:both; height: 1em;"> </p><p>The preceding<a id="id164" class="indexterm"/> screenshot shows combined hillshade and<a id="id165" class="indexterm"/> DEM layers using simple 50 percent transparency (above) and the Multiply layer blending mode with 50 percent transparency (below).</p></div></div>
<div class="section" title="Adding labels"><div class="titlepage" id="aid-MSDG2"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Adding labels</h1></div></div></div><p>Labeling is an important part of cartographic visualization. It significantly enhances data readability and<a id="id166" class="indexterm"/> understanding. Note that labeling is applicable only for vector layers because they contain landmarks and attributes (usually names) to be shown on the map. You can reach the <span class="strong"><strong>Labels</strong></span> section from the <span class="strong"><strong>Layer Properties</strong></span> dialog or by going to <span class="strong"><strong>Layer</strong></span> | <span class="strong"><strong>Labeling</strong></span> menu. Also, there is a <span class="strong"><strong>Label</strong></span> toolbar that you can turn on or off by right-clicking on the toolbars panel contextual menu and use for fast access to the labeling options.</p><p>If you want to add labels to your layer quickly, just turn on the <span class="strong"><strong>Label this layer with</strong></span> option, select the attribute field to be used for labeling from the drop-down list beside it, and click on <span class="strong"><strong>OK</strong></span>. Labels will be added immediately to the layer. While this works well for personal and temporary use, there are many more labeling options available for the following label properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Text</strong></span>: This defines the main properties of the text style, such as <span class="strong"><strong>Font</strong></span>, <span class="strong"><strong>Size</strong></span>, <span class="strong"><strong>Color</strong></span>, <span class="strong"><strong>Type case</strong></span>, and so on</li><li class="listitem"><span class="strong"><strong>Formatting</strong></span>: This is used to organize and format labels as multiple lines</li><li class="listitem"><span class="strong"><strong>Buffer</strong></span>: Text buffering defines properties of the buffer halo like size, color, transparency, and so on</li><li class="listitem"><span class="strong"><strong>Background</strong></span>: They contain background options for the labels like shape, size, color of the background, and many more</li><li class="listitem"><span class="strong"><strong>Shadow</strong></span>: These are shadowing options for labels and backgrounds</li><li class="listitem"><span class="strong"><strong>Placement</strong></span>: These are advanced placement options for arranging labels and avoiding overlapping</li><li class="listitem"><span class="strong"><strong>Rendering</strong></span>: These are options for labels and features for fast and clear label rendering</li></ul></div><p>Now, we will go through some examples of layer labeling using advanced labeling options.</p><div class="section" title="Labeling a point layer"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Labeling a point layer</h2></div></div></div><p>In this example, we <a id="id167" class="indexterm"/>will label the <code class="literal">subway stations</code> point layer <a id="id168" class="indexterm"/>with station names and lines IDs. This means that in a label, we need to combine information from different fields, and to do this, we will use the <code class="literal">"name" || '\n' || "line"</code> expression.</p><div class="note" title="Note"><h3 class="title"><a id="note11"/>Note</h3><p>Expressions give you advanced control over labeling options because with them, you can combine multiple fields, text, and functions to achieve the best result. The rules for constituting expressions are very simple: <code class="literal">field_name</code> is written in double quotes, and <code class="literal">text strings</code> in single. To merge them into a single expression, we use the <code class="literal">||</code> concatenation sign, and <code class="literal">\n</code> is used to start a new line.</p></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the <span class="strong"><strong>Font</strong></span> drop-down list, choose for example <span class="strong"><strong>OpenSans</strong></span> (or another desired font) and<a id="id169" class="indexterm"/> maximize its <span class="strong"><strong>Size</strong></span> value to 9 points.</li><li class="listitem">In the <span class="strong"><strong>Formatting</strong></span> section, we only set <span class="strong"><strong>Alignment</strong></span> to <span class="strong"><strong>Center</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Buffer</strong></span><a id="id170" class="indexterm"/> section, activate <span class="strong"><strong>Draw text buffer</strong></span>. Set <span class="strong"><strong>Buffer size</strong></span> to <code class="literal">1</code> mm and <span class="strong"><strong>Pen join style</strong></span> to <span class="strong"><strong>Round</strong></span>.</li><li class="listitem">Don't forget to choose the color for buffering. Also, if you want to achieve more stylish effects, play with the <span class="strong"><strong>Transparency</strong></span> slider and the <span class="strong"><strong>Blend</strong></span> modes. We will not use any background options, so in this example, this section is omitted and we'll go right to the <span class="strong"><strong>Shadow</strong></span>.</li><li class="listitem">Activate the <span class="strong"><strong>Draw drop shadow</strong></span> toggle. From the <span class="strong"><strong>Draw under</strong></span> drop-down list, select <span class="strong"><strong>Lowest label component</strong></span>.<div class="note" title="Note"><h3 class="title"><a id="tip11"/>Tip</h3><p>If you want to see the result without leaving the dialog window, click on the <span class="strong"><strong>Apply</strong></span> button from time to time.</p></div></li><li class="listitem">In the <span class="strong"><strong>Offset</strong></span> section, you can define the drop shadow angle. The value is entered manually or adjusted with the mouse arrow in a rotary switch beside.</li><li class="listitem">Note that the shadow's outline depends on the label rotation angle. If you want to ignore it, the <span class="strong"><strong>Use global shadow</strong></span> toggle should be activated.</li><li class="listitem">Maximizing the <span class="strong"><strong>Blur radius</strong></span> value softens the shadow, and you can achieve more complex effects using the <span class="strong"><strong>Transparency</strong></span>, <span class="strong"><strong>Color</strong></span>, and <span class="strong"><strong>Blend</strong></span> modes.</li><li class="listitem">By minimizing or maximizing the <span class="strong"><strong>Scale</strong></span> value, the shadow can be made more subtle or obvious.</li><li class="listitem">In the <span class="strong"><strong>Placement</strong></span> section, activate the <span class="strong"><strong>Offset from point</strong></span> mode and you will see the placement quadrants. Click on the lowest central quadrant button to place the label centered under the symbol marker. If the label is complex, as in our case, there is a chance that it will partially overlap the symbol. To avoid overlapping, use <span class="strong"><strong>Offset X,Y</strong></span>, which are the values for the label's horizontal and vertical displacement. Enter a small positive <span class="strong"><strong>Y</strong></span> value (for example, <code class="literal">3.0</code>) to move the label slightly lower.</li><li class="listitem">Finally, in the <span class="strong"><strong>Rendering</strong></span> section, activate <span class="strong"><strong>Scale-based visibility</strong></span> and enter <code class="literal">10000</code> in the denominator for the maximum possible scale. This means that our labels will be visible only within the 1:1 to 1:10000 scale range. If you want to prevent<a id="id171" class="indexterm"/> QGIS from hiding overlapped labels, activate <span class="strong"><strong>Show all labels for this layer (including colliding labels)</strong></span>. Some labels may be rotated for better placement, or even the map canvas can be rotated. Then, you can decide whether or not to allow upside-down label<a id="id172" class="indexterm"/> rotation using <span class="strong"><strong>Show upside down labels</strong></span>.</li></ol><div style="height:10px; width: 1px"/></div><p>If the layer contains a lot of features, it is possible to use a number for <span class="strong"><strong>Limit number of features to be labeled to</strong></span>. You can also use <span class="strong"><strong>Discourage labels from covering features</strong></span>. As a result, your map will look neater. Depending on the labeling options you have chosen, your labeled layer may look similar to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00354.jpeg" alt="Labeling a point layer"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Labeling a line layer"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>Labeling a line layer</h2></div></div></div><p>The process of labeling a<a id="id173" class="indexterm"/> line layer is similar to the one described previously, but<a id="id174" class="indexterm"/> in the <span class="strong"><strong>Placement</strong></span> section, you can find some line-specific options. The most important options are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Parallel</strong></span>: The label is adjusted along a direction parallel to the major direction of the labeled line. This type of placement is good for conveying line curvature, but can miss small details.</li><li class="listitem"><span class="strong"><strong>Curved</strong></span>: The label will be curved so as to reflect an original line's curvature. This is the best choice for labeling objects with complex geometry, such as rivers and pathways.</li><li class="listitem"><span class="strong"><strong>Horizontal</strong></span>: Regardless of the line orientation, the label is always placed horizontally.</li></ul></div><p>Labels can be placed above, on, or below line respectively. In the case of on-line placement, the line will be partially overlapped by the label. If you select several options at once, QGIS will define the best position and even take into account the line direction with <span class="strong"><strong>Line orientation</strong></span><a id="id175" class="indexterm"/> <span class="strong"><strong>dependent position</strong></span> activated. The <span class="strong"><strong>Distance</strong></span> option defines how far from the line the<a id="id176" class="indexterm"/> label will be placed (it is active only for <span class="strong"><strong>Above/ On line</strong></span> positions). The maximum angle between curved characters defines how far you can bend a label. In the <span class="strong"><strong>Rendering</strong></span> sections, the main line-specific options are located within <span class="strong"><strong>Feature options</strong></span>. For example, here you can use <span class="strong"><strong>Merge connected lines to avoid duplicate labels</strong></span>, which is very useful for working with a road network. With <span class="strong"><strong>Suppress labeling feature smaller than</strong></span>, you can set up the values for small features to be ignored during labeling.</p></div><div class="section" title="Labeling a polygon layer"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Labeling a polygon layer</h2></div></div></div><p>In this section, we<a id="id177" class="indexterm"/> will add labels to the <code class="literal">zipocodes</code> layer:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Activate labeling and select the <code class="literal">zipcode</code> field to add labels.</li><li class="listitem">In the text section, set <span class="strong"><strong>Font</strong></span> to <span class="strong"><strong>Harlow Solid Italic</strong></span> (or any other font you like) and enter <code class="literal">10</code><a id="id178" class="indexterm"/> under <span class="strong"><strong>Size</strong></span>. The labels are very simple, so we won't use any formatting, and instead of using buffer, we will work with <span class="strong"><strong>Background</strong></span>.</li><li class="listitem">Activate the <span class="strong"><strong>Draw background</strong></span> toggle.</li><li class="listitem">In the <span class="strong"><strong>Shape</strong></span> drop-down list, there are several options available for defining the shape of the background. You can select from simple geometries (rectangle, square, ellipse, and so on) or more sophisticated shapes with SVG. Select <span class="strong"><strong>SVG</strong></span>, navigate to the training <code class="literal">dataset/svg</code> folder, and select <code class="literal">plate.svg</code>. Set its type to <span class="strong"><strong>Buffer</strong></span> and adjust <span class="strong"><strong>Size</strong></span> to <code class="literal">1</code> mm. Also, if the SVG parameters are modifiable, you can select <span class="strong"><strong>Fill</strong></span>, <span class="strong"><strong>Border color</strong></span>, and <span class="strong"><strong>Border width</strong></span>.</li></ol><div style="height:10px; width: 1px"/></div><p>In the <span class="strong"><strong>Placement</strong></span> section, you will see some polygon-specific options, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Offset from centroid</strong></span>: Labels will be placed in the center of polygon within a selected quadrant and with a specified offset, if any. You can also specify exactly which centroid to use, visible or whole. If you select the visible polygon centroid, then the label visibility and placement will change dynamically while zooming and panning the map. If you select the whole polygon centroid, the<a id="id179" class="indexterm"/> labels will be static. Additionally, if you activate <span class="strong"><strong>Force point inside polygon</strong></span>, the labels will tend to stay inside the polygon only.</li><li class="listitem"><span class="strong"><strong>Around centroid</strong></span>: Labels will be placed in the center of the polygon within a specified distance.</li><li class="listitem"><span class="strong"><strong>Using Perimeter</strong></span>: Labels will be placed along the border line (the <span class="strong"><strong>Above/ On/ Below</strong></span> placement options are available, and it is possible to combine them to allow QGIS to define the best position). Activate <span class="strong"><strong>Line orientation dependent position</strong></span> if you want take the line direction into account. The <span class="strong"><strong>Distance</strong></span><a id="id180" class="indexterm"/> value defines how far from the line the label will be placed, and the <span class="strong"><strong>Repeat</strong></span> values vary the repetition frequency. This type of labeling is very useful for boundaries.</li><li class="listitem"><span class="strong"><strong>Horizontal (slow)</strong></span>: All labels will be placed horizontally and will change their position dynamically with zooming and panning to stay inside the polygon. As QGIS constantly defines the optimal position, this type of labeling can work slower for large datasets.</li><li class="listitem"><span class="strong"><strong>Free (slow)</strong></span>: QGIS will define the optimal position (including rotation) for the label within the current map view.</li></ul></div><p>Try the different options yourself for a better understanding of label placement. The <span class="strong"><strong>Rendering</strong></span> section is the same as for line layers, so you can avoid labeling some small features or limit their number.</p></div><div class="section" title="Advanced labeling"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Advanced labeling</h2></div></div></div><p>Beside any labeling option, you can see the <span class="strong"><strong>Data defined override</strong></span> button, <span class="inlinemediaobject"><img src="../Images/image00355.jpeg" alt="Advanced labeling"/></span>. It provides <a id="id181" class="indexterm"/>advanced control over labeling parameters. You can do this with an expression or by using a specially created attribute field that overrides the defined settings with custom parameters. Data-defined properties are very useful when you want to distinguish between labels for objects with different properties (for example, cities and towns with different populations) or apply your own placement positions.</p><p>Let's create three types of <code class="literal">zipcode</code> labels depending on population. The smaller label will be for areas where the population is less than 40000, the medium-sized label will be for a population of 40000-80000, and the biggest will be for a population of over 80000.</p><p>This means that we<a id="id182" class="indexterm"/> need to adjust the <span class="strong"><strong>Size</strong></span> value of the font according to the <code class="literal">population</code> field values. From the <span class="strong"><strong>Data defined override</strong></span> contextual menu, select <span class="strong"><strong>Edit…</strong></span>, like this:</p><div class="mediaobject"><img src="../Images/image00356.jpeg" alt="Advanced labeling"/></div><p style="clear:both; height: 1em;"> </p><p>In <span class="strong"><strong>Expression string builder</strong></span>, enter the expression shown in the following screenshot. In this expression, we use the population as the condition for font size value definition:</p><div class="mediaobject"><img src="../Images/image00357.jpeg" alt="Advanced labeling"/></div><p style="clear:both; height: 1em;"> </p><p>But what if we not only want to vary the size, but also want to underline the labels with the largest values? Then, we select <span class="strong"><strong>Edit</strong></span> from the <span class="strong"><strong>Underline</strong></span> button from the data override contextual <a id="id183" class="indexterm"/>menu and type the following expression: <code class="literal">case when "population" &gt; 80000 then 1 else 0 end</code>.</p><div class="note" title="Note"><h3 class="title"><a id="tip12"/>Tip</h3><p>If you are confused about exactly which values to enter for the parameter definition and how to combine them to get a meaningful result, select the <span class="strong"><strong>Description</strong></span> item from <span class="strong"><strong>Data defined override</strong></span>. A window, with a short explanation of the expected input, will be displayed. For example, from the following screenshot, which shows an explanation of the color input, we can conclude that if we want to change the label color according to the population, we can use <code class="literal">case when "population" &gt; 80000 then '255,0,0,0' else '25,81,119,0' end</code>:</p><div class="mediaobject"><img src="../Images/image00358.jpeg" alt="Advanced labeling"/></div><p style="clear:both; height: 1em;"> </p></div></div></div>
<div class="section" title="Managing styles" id="aid-NQU21"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Managing styles</h1></div></div></div><p>As you can see from the previous section, developing styles is a time-consuming task. But the good thing is that<a id="id184" class="indexterm"/> once developed, styles are not lost. They can be saved, applied to other layers, and imported from and exported to external sources.</p><p>The main style management options are available from the <span class="strong"><strong>Style</strong></span> button at the bottom row of the <span class="strong"><strong>Style</strong></span> section under <span class="strong"><strong>Properties</strong></span> as shown. The menu is divided into sections separated by horizontal lines. The first section is responsible for loading and saving styles. The second and third are for managing multiple styles for the layer, and at the bottom is the toggle for activating different styles (inactive and grayed out by default, when there's only one style available).</p><div class="mediaobject"><img src="../Images/image00359.jpeg" alt="Managing styles"/></div><p style="clear:both; height: 1em;"> </p><div class="note" title="Note"><h3 class="title"><a id="tip13"/>Tip</h3><p>You can get access to some of these options by right-clicking on the layer's <span class="strong"><strong>Styles</strong></span> contextual shortcut. For example, you can copy and paste a style from one layer to another, add a new style, or rename an existing style. Also, this is very convenient for rapid switching between multiple layer styles.</p></div><p>When you have finished polishing your style, it is wise to save it. There are three main options for doing this from the <span class="strong"><strong>Style</strong></span> button of the <span class="strong"><strong>Save Style</strong></span> menu:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>QGIS Layer Style File</strong></span>: The style is saved as a <code class="literal">.qml</code> file, which is a native QGIS format for storing styles.</li><li class="listitem"><span class="strong"><strong>SLD File</strong></span>: The style is exported to a style layer descriptor (<code class="literal">.sld</code>) file. This file type converts the original symbology into a single-symbol or rule-based type. This means categorized, graduated, heatmap, and other types of symbology may not be supported properly. Renderer-based symbology may not be supported properly. It may be convenient to save the symbology in an <code class="literal">.sld</code> file if you plan to work on it within an external application, such as GeoServer.</li><li class="listitem"><span class="strong"><strong>Save in database</strong></span>: We use this option to store and distribute all our data and styles within a single SpatiaLite database. When loading a style, it is important to provide a meaningful name and an exhaustive description. This is very handy because if you want somebody else to work with your data and style it properly, they just need to connect to the database, load the spatial layers and styles, and apply them.</li></ul></div><p>Once the style is saved, you <a id="id185" class="indexterm"/>can use <span class="strong"><strong>Load from file</strong></span> (<span class="strong"><strong>Style</strong></span> | <span class="strong"><strong>Load Style</strong></span> | <span class="strong"><strong>Load from file</strong></span>) or <span class="strong"><strong>Load from database</strong></span> to select and apply the style.</p><div class="note" title="Note"><h3 class="title"><a id="note12"/>Note</h3><p>The QGIS community is very active in developing resources and eager to share them, so instead of spending a long time developing your own styles, you can apply ready styles provided by various users. We advise you to take a look at the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Charley Glynn's OSM<a id="id186" class="indexterm"/> shapefile QGIS style sheets available at <a class="ulink" href="https://github.com/charleyglynn/OSM-Shapefile-QGIS-stylesheets">https://github.com/charleyglynn/OSM-Shapefile-QGIS-stylesheets</a></li><li class="listitem">3liz styles for <a id="id187" class="indexterm"/>OpenStreetMap data in QGIS at <a class="ulink" href="https://github.com/3liz/osm-in-qgis">https://github.com/3liz/osm-in-qgis</a></li><li class="listitem">Anita Graser's styles for<a id="id188" class="indexterm"/> SpatiaLite databases at <a class="ulink" href="https://github.com/anitagraser/QGIS-resources/tree/master/qgis2/osm_spatialite">https://github.com/anitagraser/QGIS-resources/tree/master/qgis2/osm_spatialite</a></li><li class="listitem">Ross McDonald's grayscale<a id="id189" class="indexterm"/> styles for OSM shapefiles in QGIS at <a class="ulink" href="https://github.com/mixedbredie/OSM-Shapefile-QGIS-stylesheets/tree/master/QML%20files/greyscale">https://github.com/mixedbredie/OSM-Shapefile-QGIS-stylesheets/tree/master/QML%20files/greyscale</a></li></ul></div><p>You can download ready-to-use <code class="literal">.qml</code> files from there and apply them to your layers, but it's important that attributes of your layers be the same as those used in the ready styles. Otherwise, you can use these styles as basic templates and adjust the field names and values manually.</p></div><div class="section" title="Using several styles for the same layer"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Using several styles for the same layer</h2></div></div></div><p>You can also get quick <a id="id190" class="indexterm"/>access to some styling properties from the layer's contextual <span class="strong"><strong>Styles</strong></span> right-click shortcut, as shown here:</p><div class="mediaobject"><img src="../Images/image00360.jpeg" alt="Using several styles for the same layer"/></div><p style="clear:both; height: 1em;"> </p><p>For example, you can easily copy a style from one layer and paste it to another. Moreover, you can apply several styles for one layer and switch between them when necessary. To add a one more style to the layer, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the right-click contextual shortcut of<span class="strong"><strong> Add layer</strong></span>, which is under<span class="strong"><strong> Styles</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>New style</strong></span> window, type the name for the new style, and click on <span class="strong"><strong>OK</strong></span>, as shown in the following screenshot<div class="mediaobject"><img src="../Images/image00361.jpeg" alt="Using several styles for the same layer"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The layer's appearance will not be changed, because it relies on the last applied style for now. Open the layer's <span class="strong"><strong>Properties</strong></span> dialog and adjust the new style like this:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">You can develop a new style in the <span class="strong"><strong>Style</strong></span> section in a common way, as described earlier in the <span class="emphasis"><em>Developing your own styles</em></span> section.</li><li class="listitem">Also, it's possible to upload a ready style by going to <span class="strong"><strong>Style</strong></span> | <span class="strong"><strong>Load Style</strong></span>.</li></ul></div></li><li class="listitem">After the styling is done, click on the <span class="strong"><strong>OK</strong></span> button. You will see that both the styles are available, either from the <span class="strong"><strong>Style</strong></span> button menu or the <span class="strong"><strong>Styles</strong></span> right-click contextual shortcut.</li><li class="listitem">You can <a id="id191" class="indexterm"/>develop as many styles as you wish, and use the toggle beside their names to switch between styles. Also, you can use the <span class="strong"><strong>Add</strong></span>, <span class="strong"><strong>Remove Current</strong></span>, and <span class="strong"><strong>Rename Current</strong></span> shortcuts to manage multiple styles.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Adding base maps"><div class="titlepage" id="aid-OPEK2"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Adding base maps</h1></div></div></div><p>Base maps are ready-to-use background maps that provide contextual and spatial information additional to your data. They can be satellite imagery, general maps from various sources, or<a id="id192" class="indexterm"/> even self-prepared custom maps. In this section, we will take a look at the most popular types of background maps and how to load them into QGIS to combine them with your data.</p><div class="section" title="The OpenLayers plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>The OpenLayers plugin</h2></div></div></div><p>This is one of the most popular QGIS plugins, as it allows simple addition of base maps from numerous popular map providers (OpenStreetMap, Google Maps, Bing Maps, and so on). Install the <a id="id193" class="indexterm"/>plugin as described in <a class="link" title="Chapter 1. Handling Your Data" href="part0014.xhtml#aid-DB7S2">Chapter 1</a>, <span class="emphasis"><em>Handling Your Data</em></span>, and make sure that it's active after installation.</p><p>Loading base maps is<a id="id194" class="indexterm"/> simple; go to <span class="strong"><strong>Web</strong></span> | <span class="strong"><strong>OpenLayers</strong></span>, select the provider, and click on the map you want to add. The map will be loaded into the map canvas and appear in the <span class="strong"><strong>Layers</strong></span> panel. By default, layers are added to the first layer group, but you can drag and drop them wherever you want. The layer can be shown or hidden with the toggle beside its name, and deleted from the project with the <span class="strong"><strong>Remove</strong></span> right-click contextual shortcut.</p><p>You can gain extended control over layers and navigation by activating the <span class="strong"><strong>OpenLayers Overview</strong></span> panel from the menu. The panel will appear in the bottom-left corner under the <span class="strong"><strong>Layers</strong></span> panel.</p><div class="mediaobject"><img src="../Images/image00362.jpeg" alt="The OpenLayers plugin"/></div><p style="clear:both; height: 1em;"> </p><p>Activate the <span class="strong"><strong>Enable map</strong></span> toggle and select a map for overview from the drop-down list. You can use two different maps in the overview window and the map canvas window for comparison. If you want to load the map into the canvas, click on the <span class="strong"><strong>Add map</strong></span> button beside the drop-down list. For<a id="id195" class="indexterm"/> simpler navigation, there is a red cross in the main map window. It marks the center of the overview extent. You can hide it by clicking on the corresponding toggle. Also, the overview map can be saved as a <code class="literal">.jpeg</code> image, or a rectangular extent can be copied to the clipboard as KML.</p><p>The <span class="strong"><strong>OpenLayers</strong></span> plugin is very useful because of its numerous maps and simplicity, but there are a number of constraints you should pay attention to while working with it. First of all, this plugin is aimed at providing base maps only, and before using it to perform other tasks, it is highly recommended to study the provider's licensing terms. Secondly, note that adding any layer from the plugin's list automatically changes the original map projection to <span class="strong"><strong>EPSG: 3857 WGS 84 / Pseudo Mercator</strong></span>.</p><p>This is because the plugin fetches data originally provided in EPSG: 3857, and instead of reprojecting, it suppresses map projection and automatically reprojects the user's data. Last but not least is the fact that with the OpenLayers plugin, you cannot rely on scale and map measurements. This is because the EPSG: 3857 WGS 84 / Pseudo Mercator projection it uses was designed not to minimize object distortions (shape, area, distance, and so on) but to fit the entire globe in such a way that it <a id="id196" class="indexterm"/>could be shown on the web map. All measurements in this projection are performed on a sphere, and will most likely be much larger than expected. In a few words, this projection is good for visual exploration but not for measurements. To overcome these limitations, you can use other approaches.</p><div class="section" title="Adding WMS/WMTS layers"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec09"/>Adding WMS/WMTS layers</h3></div></div></div><p>The <span class="strong"><strong>Web Map Service</strong></span> / <span class="strong"><strong>Web Map Tile Service </strong></span>(<span class="strong"><strong>WMS</strong></span>/<span class="strong"><strong>WMTS</strong></span>) is a <a id="id197" class="indexterm"/>popular web-protocol for spatial information transferring To add WMS/WMTS base layer to your map perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To load data from <a id="id198" class="indexterm"/>web services, go to <span class="strong"><strong>Layer</strong></span> | <span class="strong"><strong>Add Layer</strong></span> | <span class="strong"><strong>Add WMS/WMTS</strong></span>, use the corresponding button in the <span class="strong"><strong>Mange layers</strong></span> toolbar, or use the <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>W</em></span> keyboard shortcut.</li><li class="listitem">In the <span class="strong"><strong>Add layer(s) from a WM(T)S Server</strong></span> window, click on the <span class="strong"><strong>New</strong></span> button to configure new connection parameters.</li><li class="listitem">In <span class="strong"><strong>Create a new WMS Connection</strong></span>, enter connection details. Type <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>URL</strong></span> for the connection and authentication parameters, if any. After filling in these details, click on <span class="strong"><strong>OK</strong></span>. A newly created connection will show up in the drop-down list under the <span class="strong"><strong>Layers</strong></span> tab.</li><li class="listitem">Click on the <span class="strong"><strong>Connect</strong></span> button to get information about the available layers, select the layer you want to use, click on <span class="strong"><strong>Add</strong></span>, and then click on <span class="strong"><strong>Close</strong></span> to leave the window.</li></ol><div style="height:10px; width: 1px"/></div><p>In the case of using WMS-layers, the data will automatically be reprojected. Also, you will have access to the layer's <span class="strong"><strong>Properties</strong></span> dialog and styling parameters, such as transparency, blending, and color mode available for modification. Of course, these layers are available for creating high-resolution printing maps.</p></div></div><div class="section" title="Adding TMS layers"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Adding TMS layers</h2></div></div></div><p>The <span class="strong"><strong>Tile Map Service</strong></span> (<span class="strong"><strong>TMS</strong></span>) is another <a id="id199" class="indexterm"/>way of providing spatial data through the Internet in the form of georeferenced<a id="id200" class="indexterm"/> images (tiles). To load TMS data into QGIS, install and activate the <span class="strong"><strong>TileMapScale</strong></span> plugin, as described in <a class="link" title="Chapter 1. Handling Your Data" href="part0014.xhtml#aid-DB7S2">Chapter 1</a>, <span class="emphasis"><em>Handling Your Data</em></span>. After installation, the plugin is available from the <span class="strong"><strong>TileMapScale</strong></span> menu under <span class="strong"><strong>Plugins</strong></span>. The plugin's panel consists of two tabs. On the first tab, <span class="strong"><strong>Tool</strong></span>, you can see a drop-down list with the available TMS datasets. With the <span class="strong"><strong>activate zoomlevels</strong></span> toggle, scales will be set automatically to fit the<a id="id201" class="indexterm"/> tile's zoom level. Under the <span class="strong"><strong>Options</strong></span> tab, you can activate <span class="strong"><strong>Use 'On-The-Fly' Transformation</strong></span> if you want the tile layers to be adjusted to map projection. Set <span class="strong"><strong>min/max Zoomlevels</strong></span> and click on the <span class="strong"><strong>DPI</strong></span> button<a id="id202" class="indexterm"/> to set the resolution directly.</p><div class="note" title="Note"><h3 class="title"><a id="note14"/>Note</h3><p>The plugin stores<a id="id203" class="indexterm"/> dataset descriptions in the <code class="literal">UserName\ .qgis2\ python\ plugins\ TileMapScaleLevels\ datasets</code> folder as <code class="literal">.xml</code> files. These files use the GDAL TMS minidriver format to describe the data source parameters. You can read more about this at <a class="ulink" href="http://www.gdal.org/frmt_wms.html">http://www.gdal.org/frmt_wms.html</a>. Using the examples provided with the original plugin installation and by studying the documentation, you can create <code class="literal">.xml</code> files for your own data providers.</p></div><p>Other than this plugin, you can also use the <span class="strong"><strong>TileLayer</strong></span> and <span class="strong"><strong>QuickMapServices</strong></span> plugins to work with TMS.</p></div></div>
<div class="section" title="Summary" id="aid-PNV61"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Summary</h1></div></div></div><p>Now you know everything necessary for organizing and styling your data. You are also able to add informative labels, save your styles for future use and sharing, and provide some spatial background context with base maps from various sources.</p><p>The next step is to prepare your maps for printing.</p></div></body></html>