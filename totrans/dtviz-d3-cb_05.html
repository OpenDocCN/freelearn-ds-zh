<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Playing with Axes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Playing with Axes</h1></div></div></div><p>In this chapter we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Working with basic axes</li><li class="listitem" style="list-style-type: disc">Customizing ticks</li><li class="listitem" style="list-style-type: disc">Drawing grid lines</li><li class="listitem" style="list-style-type: disc">Dynamic rescaling of axes</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Introduction</h1></div></div></div><p>D3 was initially released without the built-in support of the Axis component. This situation did not last long; since axes are the universal building blocks in many Cartesian coordinate system-based visualization projects, it quickly became clear that D3 needs to provide built-in support for axes. Therefore, it was introduced quite early on and is continuously being enhanced ever since it was released. In this chapter, we will explore the usage of the Axis component and some related techniques.</p></div></div>
<div class="section" title="Working with basic axes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Working with basic axes</h1></div></div></div><p>In this recipe, we will focus on <a id="id272" class="indexterm"/>introducing the basic concepts and supports of the <a id="id273" class="indexterm"/>Axis component in D3 while covering different types and features of Axis as well as their <a id="id274" class="indexterm"/>
<span class="strong"><strong>SVG</strong></span> structures.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec88"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/basic-axes.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/basic-axes.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec89"/>How to do it...</h2></div></div></div><p>Let's first take a<a id="id275" class="indexterm"/> look at the following code sample:</p><div class="informalexample"><pre class="programlisting">&lt;div class="control-group"&gt;
    &lt;button onclick="renderAll('bottom')"&gt;
        horizontal bottom
    &lt;/button&gt;
    &lt;button onclick="renderAll('top')"&gt;
        horizontal top
    &lt;/button&gt;
    &lt;button onclick="renderAll('left')"&gt;
        vertical left
    &lt;/button&gt;
    &lt;button onclick="renderAll('right')"&gt;
        vertical right
    &lt;/button&gt;
&lt;/div&gt;

&lt;script type="text/javascript"&gt;
    var height = 500, 
        width = 500, 
        margin = 25,
        offset = 50,
        axisWidth = width - 2 * margin,
        svg;
    
<span class="strong"><strong>    function createSvg(){ // &lt;-A</strong></span>
<span class="strong"><strong>         svg = d3.select("body").append("svg") // &lt;-B</strong></span>
<span class="strong"><strong>            .attr("class", "axis") // &lt;-C</strong></span>
            .attr("width", width)
            .attr("height", height);
    }
    
    function renderAxis(scale, i, orient){
<span class="strong"><strong>        var axis = d3.svg.axis() // &lt;-D</strong></span>
<span class="strong"><strong>            .scale(scale) // &lt;-E</strong></span>
<span class="strong"><strong>            .orient(orient) // &lt;-F</strong></span>
<span class="strong"><strong>            .ticks(5); // &lt;-G</strong></span>
        
        svg.append("g")        
<span class="strong"><strong>            .attr("transform", function(){ // &lt;-H</strong></span>
<span class="strong"><strong>                if(["top", "bottom"].indexOf(orient) &gt;= 0)</strong></span>
<span class="strong"><strong>                    return "translate("+margin+","+i*offset+")";</strong></span>
<span class="strong"><strong>                else</strong></span>
<span class="strong"><strong>                    return "translate("+i*offset+", "+margin+")";</strong></span>
<span class="strong"><strong>            })</strong></span>
<span class="strong"><strong>            .call(axis); // &lt;-I</strong></span>
    }
    
    function renderAll(orient){
        if(svg) svg.remove();
        
        createSvg();
        
        renderAxis(d3.scale.linear()
                    .domain([0, 1000])
                    .range([0, axisWidth]), 1, orient);
        renderAxis(d3.scale.pow()
                    .exponent(2)
                    .domain([0, 1000])
                    .range([0, axisWidth]), 2, orient);
        renderAxis(d3.time.scale()
                    .domain([new Date(2012, 0, 1), new Date()])
                    .range([0, axisWidth]), 3, orient);
    }
&lt;/script&gt;</pre></div><p>The preceding code<a id="id276" class="indexterm"/> produces a visual output with only the four buttons shown in the following screenshot. Once you click on <span class="strong"><strong>horizontal bottom</strong></span>, it shows the following:</p><div class="mediaobject"><img src="graphics/2162OS_05_01.jpg" alt="How to do it..."/><div class="caption"><p>Horizontal Axis</p></div></div><div class="mediaobject"><img src="graphics/2162OS_05_02.jpg" alt="How to do it..."/><div class="caption"><p>Vertical Axis</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec90"/>How it works...</h2></div></div></div><p>The first step in this <a id="id277" class="indexterm"/>recipe is to create the <code class="literal">svg</code> element which will be used to render our axes. This is done by the<a id="id278" class="indexterm"/> <code class="literal">createSvg</code> function, which is defined on line <code class="literal">A</code>, and using D3 <code class="literal">append</code> and <code class="literal">attr</code> modifier functions shown on line <code class="literal">B</code> and <code class="literal">C</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>This is the first recipe in this book that uses SVG instead of HTML element since D3 Axis component only supports SVG. If you are not familiar with SVG standard, don't worry; we will cover it in detail in <a class="link" href="ch07.html" title="Chapter 7. Getting into Shape">Chapter 7</a>, <span class="emphasis"><em>Getting into Shape</em></span>. While for the purpose of this chapter, some of the basic and limited SVG concepts will be introduced when they are used by D3 Axis component.</p></div></div><p>Let's look at how we created the SVG canvas in the following code:</p><div class="informalexample"><pre class="programlisting">var height = 500, 
  width = 500, 
  margin = 25,
  offset = 50,
  axisWidth = width - 2 * margin,
  svg;
    
function createSvg(){ // &lt;-A
     svg = d3.select("body").append("svg") // &lt;-B
        .attr("class", "axis") // &lt;-C
        .attr("width", width)
        .attr("height", height);
} </pre></div><p>Now we are <a id="id279" class="indexterm"/>ready to render the axes on this <code class="literal">svg</code> canvas. The<a id="id280" class="indexterm"/> <code class="literal">renderAxis</code> function is designed to do exactly just that. On line <code class="literal">D</code>, we first create an Axis component using the <code class="literal">d3.svg.axis</code> function:</p><div class="informalexample"><pre class="programlisting">var axis = d3.svg.axis() // &lt;-D
            .scale(scale) // &lt;-E
            .orient(orient) // &lt;-F
            .ticks(5); // &lt;-G</pre></div><p>D3 Axis is designed to work out of the box with D3 quantitative, time, and ordinal scales. Axis scale is provided using the<a id="id281" class="indexterm"/> <code class="literal">scale()</code> function (see line <code class="literal">E</code>). In this example, we render three different axes with the following scales:</p><div class="informalexample"><pre class="programlisting">d3.scale.linear().domain([0, 1000]).range([0, axisWidth])
d3.scale.pow().exponent(2).domain([0, 1000]).range([0, axisWidth])
d3.time.scale()
  .domain([new Date(2012, 0, 1), new Date()])
  .range([0, axisWidth])</pre></div><p>The second customization we have done with the <code class="literal">axis</code> object is its orient. Orient tells D3 how this axis will be placed (orientation), therefore, how it should be rendered, whether horizontally or vertically. D3 supports four different orient configurations for an axis:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">top</code>: A horizontal axis with labels placed on top of the axis</li><li class="listitem" style="list-style-type: disc"><code class="literal">bottom</code>: A horizontal axis with labels placed at the bottom of the axis</li><li class="listitem" style="list-style-type: disc"><code class="literal">left</code>: A vertical axis with labels placed on the left hand side of the axis</li><li class="listitem" style="list-style-type: disc"><code class="literal">right</code>: A vertical axis with labels placed on the right hand side of the axis</li></ul></div><p>On line <code class="literal">G</code>, we set the number of ticks to <code class="literal">5</code>. This tells D3, ideally how many ticks we want to render for this axis, however, D3 might choose to render slightly more or less ticks based on the available space and its own calculation. We will explore Axis ticks configuration in detail in the next recipe.</p><p>Once the axis is defined, the final step in this creation process is to create a <code class="literal">svg:g</code> container element, which will then be used to host all SVG structures that are required to render an axis:</p><div class="informalexample"><pre class="programlisting">svg.append("g")        
  .attr("transform", function(){ // &lt;-H
    if(["top", "bottom"].indexOf(orient) &gt;= 0)
      return "translate(" + margin + ","+ i * offset + ")";
    else
      return "translate(" + i * offset + ", " + margin + ")";
    })
    .call(axis); // &lt;-I</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>Having a <code class="literal">g</code> element to contain all SVG elements related to an axis is not only a good practice but also a requirement of D3 axis component.</p></div></div><p>Most of the logic in this <a id="id282" class="indexterm"/>code snippet is related to the calculation of where to draw the axis on <code class="literal">svg</code> canvas using the <code class="literal">transform</code> attribute (see line <code class="literal">H</code>). In the preceding code example, to shift the axis using offsets we used the <code class="literal">translate</code> SVG transformation, which allows us to shift an element using a distance parameter that is defined with the coordinates in <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>SVG transformation will be discussed in detail in <a class="link" href="ch07.html" title="Chapter 7. Getting into Shape">Chapter 7</a>, <span class="emphasis"><em>Getting into Shape</em></span>, or you can refer to the following URL for more information on this topic:</p><p>
<a class="ulink" href="http://www.w3.org/TR/SVG/coords.html#TranslationDefined">http://www.w3.org/TR/SVG/coords.html#TranslationDefined</a>
</p></div></div><p>The more relevant part of this code is on line <code class="literal">I</code>, where the <code class="literal">d3.selection.call</code> function is used with the <code class="literal">axis</code> object being passed in as the parameter. The <code class="literal">d3.selection.call</code> function invokes the given function (in our case the <code class="literal">axis</code> object) with the current selection passed in as an argument. In other words, the function being passed into the <code class="literal">d3.selection.call</code> function should have the following form:</p><div class="informalexample"><pre class="programlisting">function foo(selection) {
  ...
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip35"/>Tip</h3><p>The <code class="literal">d3.selection.call</code> function also allows you to pass in additional arguments to the invoking function. For more information visit the following link:</p><p>
<a class="ulink" href="https://github.com/mbostock/d3/wiki/Selections#wiki-call">https://github.com/mbostock/d3/wiki/Selections#wiki-call</a>
</p></div></div><p>Once the D3 Axis component is called, it will take care of the rest and automatically create all necessary SVG elements for an axis (see line I). For example, the horizontal-bottom time axis in the example shown in this recipe shown in this recipe has the following complicated SVG structure automatically <a id="id283" class="indexterm"/>generated, which we don't really need to know much about:</p><div class="mediaobject"><img src="graphics/2162OS_05_03.jpg" alt="How it works..."/><div class="caption"><p>Horizontal bottom time Axis SVG structure</p></div></div></div></div>
<div class="section" title="Customizing ticks"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Customizing ticks</h1></div></div></div><p>We already saw how to use the <code class="literal">ticks</code> function<a id="id284" class="indexterm"/> in the previous recipe. This is the simplest ticks-related customization you can do on a D3 axis. In this recipe, we will cover some of the most common and useful ticks-related customizations with D3 axis.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec91"/>Getting Ready</h2></div></div></div><p>Open your local copy of the <a id="id285" class="indexterm"/>following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/ticks.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/ticks.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec92"/>How to do it...</h2></div></div></div><p>In the following code example, we will customize the sub-ticks, padding, and formatting of its label. Let's take a look at the code snippet first:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var height = 500, 
        width = 500, 
        margin = 25,
        axisWidth = width - 2 * margin;
    
    var svg = d3.select("body").append("svg")
            .attr("class", "axis")
            .attr("width", width)
            .attr("height", height);
    
var scale = d3.scale.linear()
        .domain([0, 100])
        .range([0, axisWidth]);
    
    var axis = d3.svg.axis()
            .scale(scale)
            .ticks(5)
            <span class="strong"><strong>.tickSubdivide(5) // &lt;-A</strong></span>
<span class="strong"><strong>            .tickPadding(10) // &lt;-B</strong></span>
<span class="strong"><strong>            .tickFormat(function(v){ // &lt;-C</strong></span>
<span class="strong"><strong>                return v + "%";</strong></span>
<span class="strong"><strong>            });</strong></span>
        
    svg.append("g")        
        .attr("transform", function(){
            return "translate(" + margin + "," + margin + ")";
        })
        .call(axis);
&lt;/script&gt;</pre></div><p>The preceding code generates the<a id="id286" class="indexterm"/> following visual output:</p><div class="mediaobject"><img src="graphics/2162OS_05_04.jpg" alt="How to do it..."/><div class="caption"><p>Customized Axis ticks</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec93"/>How it works...</h2></div></div></div><p>The focus of <a id="id287" class="indexterm"/>this recipe is the highlighted lines after the <code class="literal">ticks</code> function. As we have mentioned before, the <code class="literal">ticks</code> function<a id="id288" class="indexterm"/> provides D3 a hint on how many ticks an axis should contain. After setting the number of ticks, in this recipe, we continue to customize the ticks through further function calls. On line <code class="literal">A</code>, the <code class="literal">ticksSubdivide</code> function<a id="id289" class="indexterm"/> is used to similarly provide a hint to D3 on the number of subdivides an axis should render between each tick. Then on line <code class="literal">B</code>, the <code class="literal">tickPadding</code> functio<a id="id290" class="indexterm"/>n was used to specify the amount of space (in pixels) between tick labels and the axis. Finally, a custom function called <code class="literal">tickFormat</code> <a id="id291" class="indexterm"/>was provided on line <code class="literal">C</code> to append a percentage sign to the value.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>For more information on the aforementioned functions and other ticks-related customizations visit the D3 Wiki at the following URL:</p><p>
<a class="ulink" href="https://github.com/mbostock/d3/wiki/SVG-Axes#wiki-ticks">https://github.com/mbostock/d3/wiki/SVG-Axes#wiki-ticks</a>
</p></div></div></div></div>
<div class="section" title="Drawing grid lines"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Drawing grid lines</h1></div></div></div><p>Quite often, we need <a id="id292" class="indexterm"/>horizontal and vertical grid lines to be drawn in consistency with ticks on both <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> axes. As we have shown in the previous recipe, typically we don't have or don't want to have precise control of how ticks are rendered on D3 axes. Therefore, we might not know how many ticks are present and their values, before they are rendered. This is especially true if you are building a re-usable visualization library where it is impossible to know the tick configuration ahead of time. In this recipe, we will explore some useful techniques of drawing consistent grid lines on Axis without actually needing to know the tick values.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec94"/>Getting Ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/grid-line.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/grid-line.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec95"/>How to do it...</h2></div></div></div><p>First, let's take a look at how we draw grid lines in code:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var height = 500, 
        width = 500, 
        margin = 25;       
    
    var svg = d3.select("body").append("svg")
            .attr("class", "axis")
            .attr("width", width)
            .attr("height", height);
    
    function renderXAxis(){
        var axisLength = width - 2 * margin;
    
        var scale = d3.scale.linear()
                        .domain([0, 100])
                        .range([0, axisLength]);
        
        var xAxis = d3.svg.axis()
                .scale(scale)
                .orient("bottom");
                
        svg.append("g")       
            .attr("class", "x-axis")
<span class="strong"><strong>            .attr("transform", function(){ // &lt;-A</strong></span>
<span class="strong"><strong>                return "translate(" + margin + "," + (height - margin) + ")";</strong></span>
<span class="strong"><strong>            })</strong></span>
            .call(xAxis);
            
<span class="strong"><strong>        d3.selectAll("g.x-axis g.tick") // &lt;-B</strong></span>
<span class="strong"><strong>            .append("line") // &lt;-C</strong></span>
<span class="strong"><strong>                .classed("grid-line", true)</strong></span>
<span class="strong"><strong>                .attr("x1", 0) // &lt;-D</strong></span>
<span class="strong"><strong>                .attr("y1", 0)</strong></span>
<span class="strong"><strong>                .attr("x2", 0)</strong></span>
<span class="strong"><strong>                .attr("y2", - (height - 2 * margin));  // &lt;-E</strong></span>
    }
    
    function renderYAxis(){        
        var axisLength = height - 2 * margin;
    
        var scale = d3.scale.linear()
                        .domain([100, 0])
                        .range([0, axisLength]);
    
        var yAxis = d3.svg.axis()
                .scale(scale)
                .orient("left");
            
        svg.append("g")       
            .attr("class", "y-axis")
<span class="strong"><strong>            .attr("transform", function(){</strong></span>
<span class="strong"><strong>                return "translate(" + margin + "," + margin + ")";</strong></span>
<span class="strong"><strong>            })</strong></span>
            .call(yAxis);
            
<span class="strong"><strong>        d3.selectAll("g.y-axis g.tick")</strong></span>
<span class="strong"><strong>            .append("line")</strong></span>
<span class="strong"><strong>                .classed("grid-line", true)</strong></span>
<span class="strong"><strong>                .attr("x1", 0)</strong></span>
<span class="strong"><strong>                .attr("y1", 0)</strong></span>
<span class="strong"><strong>                .attr("x2", axisLength)</strong></span>
<span class="strong"><strong>                .attr("y2", 0);</strong></span>
    }   
    
    renderYAxis();
    renderXAxis();
&lt;/script&gt;</pre></div><p>The previous code <a id="id293" class="indexterm"/>generates the following visual output:</p><div class="mediaobject"><img src="graphics/2162OS_05_05.jpg" alt="How to do it..."/><div class="caption"><p>Axes and grid lines</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec96"/>How it works...</h2></div></div></div><p>In this recipe, two <a id="id294" class="indexterm"/>axes <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> were created in the <code class="literal">renderXAxis</code> and <code class="literal">renderYAxis</code> functions, respectively. Let's take a look at how the x axis was rendered.</p><p>Once we understand how to render <span class="emphasis"><em>x</em></span> axis and its grid lines, the logic used to render <span class="emphasis"><em>y</em></span> axis can be easily understood since they are almost identical. The <span class="emphasis"><em>x</em></span> axis and its scale were defined with no complications, as we have already demonstrated a number of times throughout this chapter. An <code class="literal">svg:g</code> element was created to contain the <span class="emphasis"><em>x</em></span> axis structures. This <code class="literal">svg:g</code> element was placed at the bottom of the chart using a translate transformation, as shown on line A:</p><div class="informalexample"><pre class="programlisting">.attr("transform", function(){ // &lt;-A
  return "translate(" + margin + "," + (height - margin) + ")";
})</pre></div><p>It is important to remember that the translate transformation changes the frame of reference for coordinates when it comes to any of its sub-elements. For example, within this <code class="literal">svg:g</code> element, if we create a point with its coordinates set as <code class="literal">(0, 0)</code>, then when we draw this point on the SVG canvas, it will be actually placed as <code class="literal">(margin, height – margin)</code>. This is because all subelements within the <code class="literal">svg:g</code> element are automatically transformed to this base coordinate, hence, the shift of the frame of reference. Equipped with this understanding, let's see how dynamic grid lines can be generated after the axis is rendered:</p><div class="informalexample"><pre class="programlisting">d3.selectAll("g.x-axis g.tick") // &lt;-B
            .append("line") // &lt;-C
                .classed("grid-line", true)
                .attr("x1", 0) // &lt;-D
                .attr("y1", 0)
                .attr("x2", 0)
                .attr("y2", - (height - 2 * margin));  // &lt;-E</pre></div><p>Once the axis has <a id="id295" class="indexterm"/>been rendered, we can select all the ticks elements on an axis by selecting the <code class="literal">g.tick</code>, since each of them is grouped by its own <code class="literal">svg:g</code> element (see line <code class="literal">B</code>). Then on line <code class="literal">C</code>, we append a new <code class="literal">svg:line</code> element to each <code class="literal">svg:g</code> tick element. SVG line element is the simplest shape provided by the SVG standard. It has four main attributes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>x1</strong></span> and <span class="strong"><strong>y1</strong></span> attributes define the point of origin of this line</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>x2</strong></span> and <span class="strong"><strong>y2</strong></span> attributes define the point of destination</li></ul></div><p>In our case, here we simply set x1, y1, and x2 to <code class="literal">0</code>, since each <code class="literal">g.tick</code> element has already been translated to its position on the axis, therefore, we only need to change the y2 attribute in order to draw a vertical grid line. The y2 attribute is set to <code class="literal">–(height – 2 * margin)</code>. The reason why the coordinate is negative was because the entire <code class="literal">g.x-axis</code> has been shifted down to <code class="literal">(height – margin)</code>, as mentioned in the previous code. Therefore, in absolute coordinate terms <code class="literal">y2 =</code> <code class="literal">(height – margin)</code> <code class="literal">– (height – 2 * margin) = margin</code>, which is the top of the vertical grid line we want to draw from the <span class="emphasis"><em>x</em></span> axis.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip36"/>Tip</h3><p>In SVG coordinates, <code class="literal">(0, 0)</code> denotes the top-left corner of the SVG canvas.</p></div></div><p>This is what the <span class="emphasis"><em>x</em></span> axis in SVG structure with associated grid line looks like:</p><div class="mediaobject"><img src="graphics/2162OS_05_06.jpg" alt="How it works..."/><div class="caption"><p>x axis with grid lines SVG structure</p></div></div><p>As we can see in the <a id="id296" class="indexterm"/>preceding screenshot, an <code class="literal">svg:line</code> element representing the grid line was added into the <span class="strong"><strong>"g.tick"</strong></span> <code class="literal">svg:g</code> container element as discussed earlier in this section.</p><p>The <span class="emphasis"><em>y</em></span> axis grid lines are generated using the <span class="strong"><strong>identical technique</strong></span>; the only difference is that instead of setting the <code class="literal">y2</code> attribute on the grid lines, as we did for the <span class="emphasis"><em>x</em></span> axis, we change the <code class="literal">x2</code> attribute, since the lines are horizontal (see line <code class="literal">F</code>):</p><div class="informalexample"><pre class="programlisting">d3.selectAll("g.y-axis g.tick")
            .append("line")
                .classed("grid-line", true)
                .attr("x1", 0)
                .attr("y1", 0)
                .attr("x2", axisLength) // &lt;-F
<span class="strong"><strong>                .attr("y2", 0);</strong></span>
</pre></div></div></div>
<div class="section" title="Dynamic rescaling of axes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Dynamic rescaling of axes</h1></div></div></div><p>In some cases, the scale used by axes might <a id="id297" class="indexterm"/>change when triggered by user interaction or changes from data feeds. For example, a user might change the time range for the visualization. This kind of change also needs to be reflected by rescaling the axes. In this recipe, we will explore how this can be achieved dynamically while also redrawing the grid lines associated with each tick.</p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec97"/>Getting Ready</h2></div></div></div><p>Open your local copy of the<a id="id298" class="indexterm"/> following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/rescaling.html">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter5/rescaling.html</a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec98"/>How to do it...</h2></div></div></div><p>Here is the code showing how to perform dynamic rescaling:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    var height = 500, 
        width = 500, 
        margin = 25,
        xAxis, yAxis, xAxisLength, yAxisLength;
    
    var svg = d3.select("body").append("svg")     
            .attr("class", "axis")    
            .attr("width", width)
            .attr("height", height);
    
    function renderXAxis(){
        xAxisLength = width - 2 * margin;
    
        var scale = d3.scale.linear()
                        .domain([0, 100])
                        .range([0, xAxisLength]);
        
        xAxis = d3.svg.axis()
                .scale(scale)
                .tickSubdivide(1)
                .orient("bottom");
                
        svg.append("g")       
            .attr("class", "x-axis")
            .attr("transform", function(){ 
                return "translate(" + margin + "," 
                           + (height - margin) + ")";
            })
            .call(xAxis);
    }
    
            
    function rescale(){ // &lt;-A
<span class="strong"><strong>        var max = Math.round(Math.random() * 100);</strong></span>
        
<span class="strong"><strong>        xAxis.scale().domain([0, max]); // &lt;-B</strong></span>
        svg.select("g.x-axis")
            .transition()
<span class="strong"><strong>            .call(xAxis); // &lt;-C</strong></span>
        
        renderXGridlines();
    }       
    
    function renderXGridlines(){
        var lines = d3.selectAll("g.x-axis g.tick")
                .select("line.grid-line")
<span class="strong"><strong>                .remove(); // &lt;-D</strong></span>
                
        lines = d3.selectAll("g.x-axis g.tick")
                .append("line") 
                .classed("grid-line", true)

        lines.attr("x1", 0) 
                .attr("y1", 0)
                .attr("x2", 0)
                .attr("y2", - yAxisLength); 
    }
    
    
<span class="strong"><strong>    renderXAxis();</strong></span>
<span class="strong"><strong>    renderXGridlines();</strong></span>
&lt;/script&gt;</pre></div><p>The preceding code <a id="id299" class="indexterm"/>generates the following effects:</p><div class="mediaobject"><img src="graphics/2162OS_05_07.jpg" alt="How to do it..."/><div class="caption"><p>Dynamic axes rescaling</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>Due to limited scope in this book, the <span class="emphasis"><em>y</em></span> axis-related code has been omitted from the code example in this recipe. See the code example available online for a complete reference.</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec99"/>How it works...</h2></div></div></div><p>As soon as you<a id="id300" class="indexterm"/> click the <span class="strong"><strong>ReScale</strong></span> button on the screen, you will notice both the axes rescale while all the ticks as well as grid lines get redrawn accompanied with a smooth transition effect. In this section, we will focus on how rescaling works and leave the transition effect for the next chapter <span class="emphasis"><em>Transition with Style</em></span>. Most of the heavy lifting in this recipe is done by the <code class="literal">rescale</code> function defined on line <code class="literal">A</code>.</p><div class="informalexample"><pre class="programlisting">function rescale(){ // &lt;-A
  var max = Math.round(Math.random() * 100);
        
  xAxis.scale().domain([0, max]); // &lt;-B
  svg.select("g.x-axis")
    .transition()
    .call(xAxis); // &lt;-C
        
  renderXGridlines();
}   </pre></div><p>To rescale an axis, we simply change its domain (see line <code class="literal">B</code>). If you recall, the scale domain represents the data domain, while its range corresponds to visual domain. Therefore, <a id="id301" class="indexterm"/>visual range should remain constant since we are not resizing the SVG canvas. Once updated, we call the <code class="literal">xAxis</code> again by passing in the <code class="literal">svg:g</code> element for the <span class="emphasis"><em>x</em></span> axis (see line <code class="literal">C</code>); this simple call will take care of the axis updating, hence, our job is done with the axis. In the next step, we also need to update and redraw all the grid lines since the domain change will also change all the ticks:</p><div class="informalexample"><pre class="programlisting">function renderXGridlines(){
        var lines = d3.selectAll("g.x-axis g.tick")
                .select("line.grid-line")
                .remove(); // &lt;-D
                
        lines = d3.selectAll("g.x-axis g.tick")
                .append("line") 
                .classed("grid-line", true)

        lines.attr("x1", 0) 
                .attr("y1", 0)
                .attr("x2", 0)
                .attr("y2", - yAxisLength); 
}</pre></div><p>This is achieved by removing every grid line by calling the<a id="id302" class="indexterm"/> <code class="literal">remove()</code> function, as shown on line <code class="literal">D</code>, and then recreating the grid lines for all the new ticks on rescaled axes. This approach effectively keeps all grid lines consistent with the ticks during rescaling.</p></div></div></body></html>