<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div class="chapter" title="Chapter 2. Digging into the API"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Digging into the API</h1></div></div></div><p>An <span class="strong"><strong>Application Programming Interface</strong></span> (<span class="strong"><strong>API</strong></span>) <a id="id70" class="indexterm"/>defines the operations, formats, and data structures available from a networked service. The developer writes code using the API to tell a server to accomplish a task. An API is built on top of an existing programming language, and uses the syntax and features of the language to make communications with a computer easier to code.</p><p>At one point, ESRI had three web-based APIs to communicate with ArcGIS Server: Flash, Silverlight, and JavaScript. With the rise of the mobile web and improvements in browsers, the ArcGIS JavaScript API won as the browser of choice. To make the best use of the ArcGIS Server map features, it's best to learn what's available from the JavaScript API. We're going to take a tour through the API, to become familiar with what it has to offer.</p><p>Unlike the other chapters in this book, this chapter provides more of a reference than a programming exercise. Short code snippets have been added to show how to use modules within the API. If you don't absorb every little crumb of information out of this chapter, don't worry. Just come back and reread parts of it for reference.</p><p>In this chapter, we'll learn about the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How maps are created and configured in the ArcGIS JavaScript API</li><li class="listitem" style="list-style-type: disc">How to display geographic data from ArcGIS Server through tiled, dynamic, and graphics layers</li><li class="listitem" style="list-style-type: disc">The building blocks of graphics on a map</li><li class="listitem" style="list-style-type: disc">How to communicate with ArcGIS Server services through tasks</li><li class="listitem" style="list-style-type: disc">How packaged UI controls called <span class="strong"><strong>dijits</strong></span> can save development time</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>For more information about the ArcGIS JavaScript API, including examples that you can build on your own, check out <span class="emphasis"><em>Building Web and Mobile ArcGIS Server Applications with JavaScript</em></span> by Eric Pimpler or <span class="emphasis"><em>ArcGIS Web Development</em></span> by Rene Rubalcava.</p></div></div><div class="section" title="Finding the ArcGIS JavaScript API documentation"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Finding the ArcGIS JavaScript API documentation</h1></div></div></div><p>You can<a id="id71" class="indexterm"/> find the documentation for the ArcGIS API for JavaScript by visiting <a class="ulink" href="https://developers.arcgis.com/javascript/jsapi/">https://developers.arcgis.com/javascript/jsapi/</a>. There, you'll find information on the latest version of the API, a list of changes since the previous version, and related documents to help you create apps. The organization is logical, and information is relatively easy to find with their layout.</p><div class="section" title="The documentation layout"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec16"/>The documentation layout</h2></div></div></div><p>The <a id="id72" class="indexterm"/>documentation for <a id="id73" class="indexterm"/>each element in the ArcGIS API is laid out in an organized fashion. Links to the API components are on the left-hand side. The documentation for each element defaults to the AMD style, but provides links to the older legacy development style. With the AMD style, the top of the page shows how to load the module into your code. Following that is a description of the module, a link to samples that use the module, and a class hierarchy diagram showing the modules the current module inherits.</p><div class="section" title="Object constructor"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec08"/>Object constructor</h3></div></div></div><p>If the <a id="id74" class="indexterm"/>module requires a JavaScript object to be constructed, the documentation provides information on what is needed to call the module's constructor. The documentation provides details on the parameters required to create the objects, including parameter names, object types, whether they're optional or not, and what they do.</p></div><div class="section" title="CSS classes and data- attributes"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec09"/>CSS classes and data- attributes</h3></div></div></div><p>Following any <a id="id75" class="indexterm"/>constructor information, the documentation provides data on the CSS class attributes for anything that the module may show on the map, as well as any HTML5 data-* attributes the module might employ. The CSS classes help you to modify the appearance of widgets and visual elements on the module, by giving you a class hook to modify with your custom styling. The <a id="id76" class="indexterm"/>data-* attributes give other JavaScript scripts access to information about your widget, without having to load the whole widget into memory. For instance, by clicking on a map graphic while using another library, you could access the geometry's type by looking at the element's data-geometry-type attribute.</p></div><div class="section" title="Properties"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec10"/>Properties</h3></div></div></div><p>When <a id="id77" class="indexterm"/>an ArcGIS API object is created using the constructor, it will have certain properties, or variable parameters assigned to the object. Some properties are set when the object is created. Other properties are set as the object is modified, or certain methods are run. The API documentation lists object properties that are actively maintained, and will not be removed without sufficient notice of depreciation.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>If you use web developer tools in your browser, such as Firebug for Firefox, or Chrome Developer tools, you might find that these ArcGIS API objects have more properties than are listed in the documentation. Many properties considered private will have one or two underscore (<code class="literal">_</code>) characters before the name. If the properties and methods are not listed in the documentation, they may not be there when the next version of the API is released. Don't count on undocumented properties and methods in your code.</p></div></div></div><div class="section" title="Methods"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec11"/>Methods</h3></div></div></div><p>Besides <a id="id78" class="indexterm"/>certain properties, objects created with the ArcGIS API modules will probably contain methods, which are JavaScript functions assigned to the object, often using other parts of the object they're assigned to. The documentation will list public methods attached to the object, as well as what parameters they accept, what values they return, and a description of what task or function they perform.</p></div><div class="section" title="Events"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec12"/>Events</h3></div></div></div><p>Many of <a id="id79" class="indexterm"/>the modules have documented events, where the module emits a notification that something has happened. These are similar to a HTML button's <code class="literal">onClick</code> event, or a browser's <code class="literal">onLoad</code> event. In older versions of the API, events were listened to using <code class="literal">dojo.connect</code>. But as the library has matured, Dojo is depreciating the connect function and replacing it <a id="id80" class="indexterm"/>with the <span class="strong"><strong>dojo/on</strong></span> library (<a class="ulink" href="http://dojotoolkit.org/reference-guide/1.10/dojo/on.html">http://dojotoolkit.org/reference-guide/1.10/dojo/on.html</a>). The <code class="literal">dojo/on</code> module actually delivers a function.</p><p>With the dojo/on function, you attach events by calling it with the following parameters: the HTML DOM elements or Dojo widgets you want to listen to, the name of the event as a string, and a function that will be called when the event occurs. If you want to stop the event, you need a variable to accept the returned value of the dojo/on call, ahead of time. When you're ready to stop listening, call that return variable's <code class="literal">remove()</code> method. Some modules contain their own <code class="literal">on()</code> method, which implements the <code class="literal">dojo/on</code> module for event handling. Here's an example code snippet using the <code class="literal">dojo/on</code> module:</p><div class="informalexample"><pre class="programlisting">require(["dojo/on", "dojo/dom", "dojo/domReady!"], 
function (on, dom) {
  var soupMe = on(dom.byId("deliver-soup"), "click", function () {
      alert("Here's your soup. NEXT!");
  });
  on(dom.byId("no-more-soup"), "click", function () {
      alert("NO SOUP FOR YOU!");
      soupMe.remove();
  });
});</pre></div><p>Now that<a id="id81" class="indexterm"/> we know what to expect when we're reading the documentation, let's look at the different tools available in the ArcGIS API for JavaScript. Since ArcGIS applications work with geographic data, we'll start off by looking at the map.</p></div></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Drawing a map"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Drawing a map</h1></div></div></div><p>When <a id="id82" class="indexterm"/>working with the ArcGIS JavaScript API, one of the first things you'll want to do is to create a map. The map transforms a simple div element into an interactive canvas where you can display, request, and even edit geographic data. The map is a complicated object, so we'll spend a significant amount of time focusing on it. Let's learn how to make a map in our scripts.</p><div class="section" title="Constructor options"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>Constructor options</h2></div></div></div><p>When a <a id="id83" class="indexterm"/>map <a id="id84" class="indexterm"/>is first created using the ArcGIS JavaScript API, the developer has numerous parameters that can be used to configure the map. We were exposed to some of those parameters in the previous chapter, when we created our first map application. Let's look into a few of them a little more closely.</p><div class="section" title="Autoresize"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec13"/>Autoresize</h3></div></div></div><p>The<a id="id85" class="indexterm"/> <span class="strong"><strong>Autoresize</strong></span> function, which by default is true, tells <a id="id86" class="indexterm"/>the map whether it should resize itself when the browser changes size or orientation. If you have a full screen map application, and you maximize or resize your browser, the map will automatically adjust and fill the space assigned to it. The map will keep the same zoom level, but more or less only the edges of the map will be visible when you resize your browser.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>If your application hides, moves, or animates your maps' appearance onto or off the screen, the autoresize functionality could lead to some strange behavior in the map. For example, if the map is made to slide in from the right, the mouse scroll and some zoom functionality may zoom to the center-left point, rather than the center of the map. With map animations on and off screen, it is best to set the autoresize to false.</p></div></div></div><div class="section" title="Basemap"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec14"/>Basemap</h3></div></div></div><p>The <a id="id87" class="indexterm"/><span class="strong"><strong>basemap</strong></span> is <a id="id88" class="indexterm"/>an optional string value that provides background imagery to lay your data on. ESRI serves a variety of background imagery, depending on how you want to frame your data. All of ESRI's basemaps are tiled images published in the Web Mercator projection (WKID 102100). For best performances, layers added on top of an ESRI basemap should be in the same projection. Otherwise, ArcGIS Server will have to reproject dynamic map services, and tiled map services may not show up if the spatial references do not match. You can see an example highlighted from the previous chapter in the following code snippet:</p><div class="informalexample"><pre class="programlisting">var map = new Map("map", {
<span class="strong"><strong>  basemap: "national-geographic",</strong></span>
  center: [-95, 45],
  zoom: 3
});</pre></div><p>The background imagery options available from ESRI include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">street</code>: An ESRI street map</li><li class="listitem" style="list-style-type: disc"><code class="literal">satellite</code>: Satellite/Aerial photography</li><li class="listitem" style="list-style-type: disc"><code class="literal">hybrid</code>: Combination of street map and satellite</li><li class="listitem" style="list-style-type: disc"><code class="literal">topo</code>: Topographic map with elevation and contours</li><li class="listitem" style="list-style-type: disc"><code class="literal">gray</code>: Light gray/minimalist background</li><li class="listitem" style="list-style-type: disc"><code class="literal">oceans</code>: Oceans and bathymetry background</li><li class="listitem" style="list-style-type: disc"><code class="literal">national-geographic</code>: National Geographic-themed</li><li class="listitem" style="list-style-type: disc"><code class="literal">osm</code>: OpenStreetMap-themed</li></ul></div></div><div class="section" title="Explaining the center, extent, zoom, and scale"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec15"/>Explaining the center, extent, zoom, and scale</h3></div></div></div><p>The<a id="id89" class="indexterm"/> <span class="strong"><strong>center</strong></span>, <span class="strong"><strong>extent</strong></span>, <span class="strong"><strong>zoom</strong></span>, and <span class="strong"><strong>scale</strong></span> parameters can be <a id="id90" class="indexterm"/>used to override the other <a id="id91" class="indexterm"/>map layer settings and set what area is displayed on the map. The <span class="emphasis"><em>center</em></span> can be either a two number array containing the longitude and the<a id="id92" class="indexterm"/> latitude of the center point, or an ESRI point. The <span class="emphasis"><em>extent</em></span> describes in map coordinates which edges of the map should be shown: right, left, top or bottom. If a tiled layer is present, the <span class="emphasis"><em>zoom</em></span> instructs which level of display, from furthest out to furthest in, the map should show. The <span class="emphasis"><em>scale</em></span> tells the map how many units of measure relate to one unit in reality (for example, a scale value of 500 means that 1 inch on the map represents 500 inches in real life).</p></div><div class="section" title="LODs"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec16"/>LODs</h3></div></div></div><p>When a map <a id="id93" class="indexterm"/>loads layers, the <span class="strong"><strong>levels of details</strong></span> (<span class="strong"><strong>LODs</strong></span>) are<a id="id94" class="indexterm"/> defined by the first tiled layer loaded in the map. You can override those LODs when creating a map, by passing an array of objects containing a level (number: 0, 1, 2, and so on), a scale (number: for 1:500 scale, you would use 500), and a corresponding resolution (number). This is helpful if you want to limit the user's ability to zoom way outside the view of your map, or if some of your tiled data has a finer resolution than your basemap will show.</p><p>Now that we've learned how adjust the parameters of a map object, let's look at its different parts.</p></div></div><div class="section" title="Properties"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>Properties</h2></div></div></div><p>The map object <a id="id95" class="indexterm"/>provides a number of properties that can be <a id="id96" class="indexterm"/>used in a mapping application. Some are read-only, and tell the status of the map. Others can be manipulated, and the changes can have significant impact on the map. While there are far more properties, we'll take a look at a few of them.</p><div class="section" title="loaded"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec17"/>loaded</h3></div></div></div><p>After you've <a id="id97" class="indexterm"/>created a map object, there are some things you can't do to the map until it has at least one layer <span class="strong"><strong>loaded</strong></span>. When a map loads its first layer, it sets its loaded property to true. Then you can manipulate the map, pan around, search for layers, and modify its behavior.</p><p>A common programming error is not testing whether the map is loaded before doing something to it, like adding search result graphics from a query. If you have an extremely fast internet connection, and your ArcGIS Server is right next to you, the map might be loaded right after you add a layer. But, for internet users outside your server room, the map may not load that quickly. It's best to check the loaded property before continuing, as in the following example:</p><div class="informalexample"><pre class="programlisting">if (map.loaded) {
  doSomethingwithMap(map);
} else {
  map.on("load", doSomethingwithMap);
}</pre></div></div><div class="section" title="layerIds"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec18"/>layerIds</h3></div></div></div><p>The <a id="id98" class="indexterm"/>map object keeps a list of references to the layers added to it. Map layer references are stored as an array of strings called <code class="literal">layerIds</code>. The first layerId in the list refers to the bottom most layer in the stack, while the last id string in the list refers to the top layer visible on the map. This is handy if you need to search for a particular layer in the list, or if you need to do something to all the layers loaded in the map.</p></div><div class="section" title="spatialReference"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec19"/>spatialReference</h3></div></div></div><p>The <a id="id99" class="indexterm"/>map's <code class="literal">spatialReference</code> property refers to the long list of mathematical equations used to represent a round earth on a flat map. This attribute is often (but not always) shared by the map and the layers and graphics contained within. We'll go into more depth studying spatial reference in the <span class="emphasis"><em>Geometry spatial reference</em></span> section.</p></div></div><div class="section" title="Methods"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Methods</h2></div></div></div><p>The <a id="id100" class="indexterm"/>map<a id="id101" class="indexterm"/> object has a number of useful methods, which are functions tied into the map object. These methods help you add items to the map, move around, zoom in and out, and manipulate map behavior. Let's take a look at some of them.</p><div class="section" title="Adding, removing, and retrieving layers"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec20"/>Adding, removing, and retrieving layers</h3></div></div></div><p>Layers <a id="id102" class="indexterm"/>can be added and removed from the map as needed. If you want to add <a id="id103" class="indexterm"/>one map layer at a time, you can call on the map's <code class="literal">addLayer()</code> method. To add multiple layers at once, you have to put all those layers in an array and call the map's <code class="literal">addLayers()</code> method. Map layers can be removed with the <code class="literal">removeLayer()</code> method.</p><p>Retrieving layers<a id="id104" class="indexterm"/> is as simple as calling the map's <code class="literal">getLayer()</code> method. The <code class="literal">getLayer()</code> method is passed an id string for the layer. A list of the valid ids can be found in the map's <code class="literal">layerIds</code> array, or in the map's <code class="literal">GraphicsLayerId</code> property. If no layers are found that match the <code class="literal">getLayer()</code> parameter, the method returns a null.</p></div><div class="section" title="Moving around the map"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec21"/>Moving around the map</h3></div></div></div><p>The <a id="id105" class="indexterm"/>map contains several methods for navigating the map. Some affect the location on the map, and others affect how zoomed in the user is. Here is a list of the most common methods used to manipulate your position on the map:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">setZoom()</code>: This sets<a id="id106" class="indexterm"/> the map zoom level, moving further in or further out.</li><li class="listitem" style="list-style-type: disc"><code class="literal">setScale()</code>: Similar<a id="id107" class="indexterm"/> to <code class="literal">setZoom()</code>, but tries to change the map's scale to match the value passed.</li><li class="listitem" style="list-style-type: disc"><code class="literal">setLevel()</code>: Similar<a id="id108" class="indexterm"/> to <code class="literal">setZoom()</code>, but works only in maps with a tiled service. Based on the integer passed into the function, the map will zoom to the corresponding zoom level, if the map has tiled layers.</li><li class="listitem" style="list-style-type: disc"><code class="literal">setExtent()</code>: When<a id="id109" class="indexterm"/> passed a bounding box, this message will attempt to set the map's boundaries to match the bounding box. This affects both zoom level and position.</li><li class="listitem" style="list-style-type: disc"><code class="literal">centerAndZoom()</code>: Accepts a<a id="id110" class="indexterm"/> center point and a zoom level, then centers the map on that point and attempts to zoom to the zoom level. This affects both position and zoom level.</li><li class="listitem" style="list-style-type: disc"><code class="literal">centerAt()</code>: When<a id="id111" class="indexterm"/> this function accepts a point, it attempts to pan the map over so that the point is in the center of the map.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Please note that, for the <code class="literal">setExtent()</code>, <code class="literal">centerAndZoom()</code>, and <code class="literal">centerAt()</code> methods, the points and bounding boxes need to be in the same coordinate system as the map.</p></div></div></div><div class="section" title="Updating settings"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec22"/>Updating settings</h3></div></div></div><p>There are <a id="id112" class="indexterm"/>many map navigation actions that can be enabled or disabled using map methods. You can control what happens when the user clicks, double-clicks, or shift-double-clicks on the map. You can enable or disable panning with the mouse, as well as scrolling with the scroll wheel. You can even disable an enable-all navigation event for the map. There may be times you want to disable navigation. For instance, if your map is navigated by clicking on links, you may not want the user to wander too far on your map.</p><p>Remember that these settings cannot be modified until the map is loaded. But if the map hasn't loaded yet, how are we supposed to know when it loads? For an answer, we'll look into a feature common to most JavaScript libraries, events.</p></div></div><div class="section" title="Events"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>Events</h2></div></div></div><p>Events<a id="id113" class="indexterm"/> are important when working with asynchronous programming in JavaScript. The map object has a number of events it fires before, during, and after it makes some important changes, or finishes certain tasks. These events can be listened to through the map's built-in <code class="literal">on()</code> function. Let's look at some of the more common events you'll be working with:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">load</code>: A <a id="id114" class="indexterm"/>map event that fires after the map has loaded its first layer.</li><li class="listitem" style="list-style-type: disc"><code class="literal">click</code>: This <a id="id115" class="indexterm"/>fires when the user clicks on the map. Among other event items, it returns the point the user clicked as a <code class="literal">mapPoint</code> property of the event object.</li><li class="listitem" style="list-style-type: disc"><code class="literal">extent-change</code>: This<a id="id116" class="indexterm"/> fires when the map either changes location, or changes zoom level. Both of these factor into calculating the map's extent.</li><li class="listitem" style="list-style-type: disc"><code class="literal">layer-add</code>: This<a id="id117" class="indexterm"/> fires when any new layer is added to the map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">layers-add-result</code>: This<a id="id118" class="indexterm"/> fires after multiple layers are loaded using the <code class="literal">addLayers()</code> method.</li><li class="listitem" style="list-style-type: disc"><code class="literal">mouse-over</code>: This <a id="id119" class="indexterm"/>fires when the mouse is moved over the map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">update-start</code>: This <a id="id120" class="indexterm"/>event fires before layers are loaded, either by adding new layers, or by moving around the map and triggering the map to download more map data.</li><li class="listitem" style="list-style-type: disc"><code class="literal">update-end</code>: This <a id="id121" class="indexterm"/>event fires after the map loads the data from its map services.</li></ul></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Layers</h1></div></div></div><p>No map<a id="id122" class="indexterm"/> is complete without data to show. Data is added to the map through layers. Layers refer to data sources that include geographic, symbolic, and even tabular data. The ArcGIS API for JavaScript contains a number of modules for interpreting different kinds of common geographic data sources. Some of the layer modules work with data provided by <a id="id123" class="indexterm"/>ArcGIS Server, and others can display data from other sources, such as KML, <span class="strong"><strong>Web Map Service</strong></span> (<span class="strong"><strong>WMS</strong></span>), and CSV files.</p><div class="section" title="Common ArcGIS Server layers"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Common ArcGIS Server layers</h2></div></div></div><p>ArcGIS Server provides <a id="id124" class="indexterm"/>map layer data through Map Services. Map Services provide data published from an ArcMap map document (<code class="literal">.mxd</code>). The visual map data, legend, and underlying data tables are served through ArcGIS Server, and can be consumed through the browser when the layer data source is loaded into the map. Different layer types have different functionalities. We will review those layers in the following sections.</p><div class="section" title="ArcGISDynamicMapServiceLayer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec23"/>ArcGISDynamicMapServiceLayer</h3></div></div></div><p>An <code class="literal">ArcGISDynamicMapServiceLayer</code> is the default type of map published through the ArcGIS Server. It is a dynamic map, meaning that its content is updated whenever the map<a id="id125" class="indexterm"/> is refreshed. Because it is dynamic, the data can also be reprojected to fit on another map layer that is not in the same spatial reference.</p><div class="informalexample"><pre class="programlisting">require(["esri/map", "esri/layers/ArcGISDynamicMapServiceLayer"], 
  function (Map, ArcGISDynamicMapServiceLayer) {
  …
  var map = new Map("mapdiv", {…});
  var layer = new ArcGISDynamicMapServiceLayer ("http://serv.er/arcgis/rest/services/MyDynamicLayer/mapserver");
  map.addLayer(layer);
});</pre></div><p>Because the data within an <code class="literal">ArcGISDynamicMapServiceLayer</code> is dynamic, ArcGIS Server redraws what the layer should look like every time the map looks at the data from a different location and zoom level. If this layer contains lots of labels, annotation, complicated graphics, or raster data (like aerial imagery, for instance), ArcGIS Server will require more system resources to render the map layer. This will lead to noticeably slower performance. Other services, like tiled map services, are recommended for that kind of data.</p></div><div class="section" title="ArcGISTiledMapServiceLayer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec24"/>ArcGISTiledMapServiceLayer</h3></div></div></div><p>ArcGIS Server allows <a id="id126" class="indexterm"/>map services to be tiled. An <code class="literal">ArcGISTiledMapServiceLayer</code> has its content already drawn into images at scales defined when the map service is published. These images are stored on a hard drive for quick retrieval. The benefit is that these pre-rendered tiles are served quickly and with little effort on the part of the server. More map services can be run from the same machine with little effect on performance. See an example in the following code snippet:</p><div class="informalexample"><pre class="programlisting">require(["esri/map", "esri/layers/ArcGISTiledMapServiceLayer"], 
  function (Map, ArcGISTiledMapServiceLayer) {
  …
  var map = new Map("mapdiv", {…});
  var layer = new ArcGISTiledMapServiceLayer ("http://serv.er/arcgis/rest/services/MyTiledLayer/mapserver");
  map.addLayer(layer);
});</pre></div><p>Tiled map services have some disadvantages. First, the data displayed through tiled map services doesn't change until the tiles are rebuilt. If a park boundary changes in the data, but the tiles aren't rebuilt, the service will still show the old boundary. Second, tiled map services restrict the map to specific zoom scales, with no easy way to view the map in between zoom scales. Third, if another tiled map is stacked on top of the first one, it not only has to be in <a id="id127" class="indexterm"/>the same spatial reference, but also the zoom scales have to overlap exactly within overlapping scale ranges. That means that a map built with scales of 1:500 and 1:1000 can be loaded with a map built with scales of 1:1000 and 1:2000, but a tiled layer with scales 1:750, 1:1500, and 1:3000 will not be seen.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>You cannot load a dynamic map service layer as an <code class="literal">ArcGISTiledMapServiceLayer</code>, or else it will throw an error. However, a tiled map service can be loaded as an <code class="literal">ArcGISDynamicMapServiceLayer</code>. You lose performance when zooming and panning, but it will help you view scales in between the tiled scales.</p></div></div><p>We've seen ArcGIS layers that provide image data. Let's turn our attention to layers that handle more vector data.</p></div></div><div class="section" title="GraphicsLayers and FeatureLayers"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>GraphicsLayers and FeatureLayers</h2></div></div></div><p>Sometimes you<a id="id128" class="indexterm"/> don't want to work with representative images of maps. Sometimes you want to work with the shape of your data directly. That's where <code class="literal">GraphicsLayers</code> and <code class="literal">FeatureLayers</code> come in. These layers render vector graphics directly in your browser. You can click on them, modify them, and even add data to an ArcGIS service through them. Let's look a little closer at them.</p><div class="section" title="GraphicsLayers"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec25"/>GraphicsLayers</h3></div></div></div><p>
<code class="literal">GraphicsLayers</code> <a id="id129" class="indexterm"/>provide a simple way to add custom vector graphics to your map. You can manage the graphics by calling <code class="literal">add()</code> and <code class="literal">remove()</code> methods on those graphics. You can also search through the list of graphics on the map by searching through the <code class="literal">GraphicsLayer.graphics</code> array.</p><p>As a side note, the map object has a built-in <code class="literal">GraphicsLayer</code>. You can access that <code class="literal">GraphicsLayer</code> through the <code class="literal">map.graphics</code> property.</p></div><div class="section" title="FeatureLayers"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec26"/>FeatureLayers</h3></div></div></div><p>
<code class="literal">FeatureLayers</code> <a id="id130" class="indexterm"/>are<a id="id131" class="indexterm"/> specialized layers built on a <code class="literal">GraphicsLayer</code> that provide much more functionality. They have the custom vector graphics of a <code class="literal">GraphicsLayer</code>, plus they have an ArcGIS Server data source to populate the data. You can query for data by either location or attributes, add it to the map using custom graphics, and control popup content and styling. You can even edit data on your server.</p><p>Unlike <a id="id132" class="indexterm"/>ArcGIS Tiled <a id="id133" class="indexterm"/>and dynamic layers, which can mash up multiple layers at once, each <code class="literal">FeatureLayer</code> can only work with one map service layer. <code class="literal">FeatureLayers</code> can work with individual layers in a map service, or special editable map services called <a id="id134" class="indexterm"/><span class="strong"><strong>Feature Services</strong></span>. Feature Services provide more details about the map layer, including endpoints for querying results. If ArcGIS Server is configured to allow editing on the features, and the map service is published to allow editing, <code class="literal">FeatureLayers</code> that consume these services will let you modify both shape and tabular data.</p><p>Because <code class="literal">FeatureLayers</code> query data from ArcGIS Server, they are limited in the number of features they can return. Typically, ArcGIS Server limits the number of results returned in a query to one or two thousand, depending on the version. Server settings can be altered to show more results, but more <code class="literal">FeatureLayer</code> graphics on the map mean more memory is consumed, and the app may be slow and unresponsive. Careful thought must be put into using the <code class="literal">FeatureLayer</code> with your data.</p><p>One way that the <code class="literal">FeatureLayer</code> refines the number of features returned is by setting its mode. The <code class="literal">FeatureLayer</code> has three primary modes of feature selection:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MODE_ONDEMAND</code>: Only<a id="id135" class="indexterm"/> features that fit within the map extent, time extent, and/or definition query are downloaded. This is the most common way of interacting with features visible within the map extent.</li><li class="listitem" style="list-style-type: disc"><code class="literal">MODE_SELECTION</code>: Only <a id="id136" class="indexterm"/>features that are selected by interacting with the map (by click, touch, or query, for instance) are downloaded and their data is shown on the map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">MODE_SNAPSHOT</code>: All<a id="id137" class="indexterm"/> features are initially downloaded into memory. This method is popular for smaller datasets, and requires fewer server calls.</li><li class="listitem" style="list-style-type: disc"><code class="literal">MODE_AUTO</code>: It <a id="id138" class="indexterm"/>automatically picks between <code class="literal">MODE_ONDEMAND</code> and <code class="literal">MODE_SNAPSHOT</code> and is fairly new to the ArcGIS API for JavaScript, depending on the size and content of the data.</li></ul></div><p>We will look into <code class="literal">FeatureLayers</code> more closely in <a class="link" href="ch05.html" title="Chapter 5. Editing Map Data">Chapter 5</a>, <span class="emphasis"><em>Editing Map Data</em></span> when we discuss editing.</p></div></div><div class="section" title="Other layer types"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Other layer types</h2></div></div></div><p>The <a id="id139" class="indexterm"/>ArcGIS API for JavaScript works well with data published through ArcGIS Server. But not all geographic data available in the world is published through ArcGIS Server. The API has a number of other layer types that can consume these different data sources. Some of the <a id="id140" class="indexterm"/>more common types are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">KMLLayer</code>: Services <a id="id141" class="indexterm"/>written with the <span class="strong"><strong>Keyhole Markup Language</strong></span> (<span class="strong"><strong>KML</strong></span>). KML <a id="id142" class="indexterm"/>was made<a id="id143" class="indexterm"/> famous by Google Earth. The format uses the markup to store and symbolize geographic data. Many services publish KML data, including the <a id="id144" class="indexterm"/><span class="strong"><strong>National Oceanic and Atmospheric Administration</strong></span> (<span class="strong"><strong>NOAA</strong></span>).</li><li class="listitem" style="list-style-type: disc"><code class="literal">CSVLayer</code>: A<a id="id145" class="indexterm"/> fairly recent addition, it transforms a <a id="id146" class="indexterm"/>comma-delimited text file into points on the map. To show the data on a map, the <code class="literal">CSVLayer</code> expects a latitude and longitude column to show the coordinates in decimal places. This tool, combined with HTML5's drag-and-drop API, could make it possible for you to map any compliant data you toss into a <code class="literal">.csv</code> file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">WMSLayer</code> and <code class="literal">WMTSLayer</code>: Web <a id="id147" class="indexterm"/>Map <a id="id148" class="indexterm"/>Services (<span class="strong"><strong>WMS</strong></span>) <a id="id149" class="indexterm"/>and <a id="id150" class="indexterm"/>Web Map Tiled Services (<span class="strong"><strong>WMTS</strong></span>) <a id="id151" class="indexterm"/>published <a id="id152" class="indexterm"/>using the <span class="strong"><strong>Open Geospatial Consortium</strong></span> (<span class="strong"><strong>OGC</strong></span>) compliant <a id="id153" class="indexterm"/>standards.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Please note that if you load the layer using just the URL of the OGC Web Map Service, you'll need to use a proxy (see <a class="link" href="ch01.html" title="Chapter 1. Your First Mapping Application">Chapter 1</a>, <span class="emphasis"><em>Your First Mapping Application</em></span>). This is because the module first requests <code class="literal">GetCapabilities</code> on the layer to grab metadata from the map service. This request requires a proxy. However, if you load the <code class="literal">WMSLayer</code> with an optional <code class="literal">resourceInfo</code> parameter, that automatically describes the service for you, and the proxy will not be necessary.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">StreamLayer</code>: A<a id="id154" class="indexterm"/> layer displaying live streaming data<a id="id155" class="indexterm"/> from an ArcGIS GeoEvent Processor Extension. <code class="literal">StreamLayer</code> takes advantage of the latest in HTML5 WebSockets, which provide real-time updates from the server to the client. You can view Twitter responses to specific events, or real-time locations of emergency response vehicles with tracking devices.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Note that most up-to-date modern browsers support WebSockets technology, but older browsers typically <a id="id156" class="indexterm"/>do not. You can visit <a class="ulink" href="http://www.websocket.org/echo.html">http://www.websocket.org/echo.html</a> to see if your browser supports WebSockets.</p></div></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Graphics"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Graphics</h1></div></div></div><p>A <a id="id157" class="indexterm"/>graphic object <a id="id158" class="indexterm"/>represents an individual point, line, or polygon feature drawn on the webmap. The graphic object has four main parts: its geometry, symbol, attributes, and <code class="literal">infoTemplate</code>. They are used in many parts of the API. If you draw something on the map, you create a graphic. If you query a map service for something, it returns a list of graphics. Some modules even accept lists of graphics as arguments for other functions.</p><p>The graphic object can be constructed with up to four optional arguments:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">geometry</code>: It<a id="id159" class="indexterm"/> describes the shape of the graphic drawn on the map</li><li class="listitem" style="list-style-type: disc"><code class="literal">symbol</code>: It describes<a id="id160" class="indexterm"/> the graphic's color, thickness, and features that affect the appearance of the graphic</li><li class="listitem" style="list-style-type: disc"><code class="literal">attribute</code>: A <a id="id161" class="indexterm"/>JavaScript object containing name-value pairs of tabular data that correspond with the feature</li><li class="listitem" style="list-style-type: disc"><code class="literal">infoTemplate</code>: It<a id="id162" class="indexterm"/> formats the look of the graphic attributes when highlighted by the map's <code class="literal">InfoWindow</code></li></ul></div><p>We'll look more closely at these graphic features in the following sections.</p></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Introducing geometry objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Introducing geometry objects</h1></div></div></div><p>Geometry objects<a id="id163" class="indexterm"/> are a collection of coordinates that describe where something is in the world. They give shape to the data we're looking for. They can be used for displaying graphics on a map, or to provide spatial data for queries, or even for geoprocessing services. Geometry objects come in five basic types: point, line, polygon, extent, and multipoint. Any shapes are built on these basic types. Let's take a closer look.</p><div class="section" title="Point"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Point</h2></div></div></div><p>In the <a id="id164" class="indexterm"/>ArcGIS API for JavaScript, a point is the simplest geometry object. It contains the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates of the point, as well as the point's spatial reference. A point can be constructed with <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates, plus a spatial reference. It can also be defined by longitude and latitude.</p></div><div class="section" title="Polyline"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Polyline</h2></div></div></div><p>A polyline <a id="id165" class="indexterm"/>geometry<a id="id166" class="indexterm"/> is a collection of one or more arrays of point coordinates. Each array of point coordinates is called a path, and would look like a line when drawn out. Multiple paths can be stored in the same geometry, giving the appearance of multiple lines. The individual point coordinates are stored as array of <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> values.</p></div><div class="section" title="Polygon"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>Polygon</h2></div></div></div><p>Polygons<a id="id167" class="indexterm"/> are <a id="id168" class="indexterm"/>made up of one or more arrays of points that loop back on themselves. Each array of points is referred to as a ring, and the first and last point in a ring must have the same coordinate. Polygons made up of more than one ring are referred to as multipart-polygons.</p><p>Among the many properties and methods that control the polygon's shape are two useful methods: <code class="literal">.getCentroid()</code> and <code class="literal">.contains()</code>,<code class="literal">.getCentroid()</code> returns a point that is roughly in the middle of the polygon. The formula used to calculate the centroid's position can be found on the <a id="id169" class="indexterm"/>Wikipedia page for centroids: (<a class="ulink" href="http://en.wikipedia.org/wiki/Centroid#Centroid_of_polygon">http://en.wikipedia.org/wiki/Centroid#Centroid_of_polygon</a>). The <code class="literal">.contains()</code> method takes a point as an input, and returns a <code class="literal">boolean</code> value based on whether the point is inside the polygon or not.</p></div><div class="section" title="Extent"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Extent</h2></div></div></div><p>An extent<a id="id170" class="indexterm"/> is a<a id="id171" class="indexterm"/> rectangular polygon, which only uses four numbers to describe its shape. The extent is described by its minimum <span class="emphasis"><em>x</em></span> value (<code class="literal">xmin</code>), maximum <span class="emphasis"><em>x</em></span> value (<code class="literal">xmax</code>), minimum <span class="emphasis"><em>y</em></span> value (<code class="literal">ymin</code>), and maximum <span class="emphasis"><em>y</em></span> value (<code class="literal">ymax</code>). When viewed on a map, extents typically look like a box.</p><p>Extents are used by many different parts of the API. All other geometry objects other than points have a <code class="literal">getExtent()</code> method, which is used to collect the bounding box of the geometry. You can zoom to a specific location on a map by setting the map's extent. Extents are also used to define an area of interest when identifying things on a map.</p></div><div class="section" title="Multipoint"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Multipoint</h2></div></div></div><p>Sometimes you <a id="id172" class="indexterm"/>need a cluster of points to show on the map. For that, the multipoint is your answer. You can add and remove points using the <code class="literal">addPoint()</code> and <code class="literal">removePoint()</code> methods. You can also get the general area the points cover with the <code class="literal">getExtent()</code> method. They're useful for collecting random points in an area, and for selecting unconnected features on a map.</p></div><div class="section" title="Geometry spatial reference"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/>Geometry spatial reference</h2></div></div></div><p>Besides<a id="id173" class="indexterm"/> coordinates of a geometry's location, the geometry object also packs information on the object's spatial reference. The spatial reference describes the mathematical models used to describe the Earth within the mapped region. Instead of containing all those formulas and constants, the spatial reference stores a reference to those formulas through either a<a id="id174" class="indexterm"/> <span class="strong"><strong>well-known ID</strong></span> (<span class="strong"><strong>WKID</strong></span>), or a <a id="id175" class="indexterm"/><span class="strong"><strong>well-known text</strong></span> (<span class="strong"><strong>WKT</strong></span>).</p><p>Spatial Reference plays<a id="id176" class="indexterm"/> a crucial role when displaying data on a map. Tiled map service layers must have the same spatial reference as the map, in order to be displayed. Dynamic map service layers must be reprojected, adding to the server time and workload. Graphics also need to be in the same spatial reference as the map to appear in the correct places on the map.</p></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Symbols and renderers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Symbols and renderers</h1></div></div></div><p>The ArcGIS API provides<a id="id177" class="indexterm"/> some basic graphics tools to define how features look on your map. If you are creating your own custom graphics, or modifying some existing ones, this portion of the API tells you how to define their <span class="strong"><strong>symbols</strong></span>. The API also provides custom <a id="id178" class="indexterm"/><span class="strong"><strong>renderers</strong></span>, which help you define what symbols are used, based on rules applied by the renderer.</p><div class="section" title="Simple symbols"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>Simple symbols</h2></div></div></div><p>The<a id="id179" class="indexterm"/> ArcGIS API uses symbols to define the colors, thicknesses, and <a id="id180" class="indexterm"/>other visual features of graphics, independent of their shape. In fact, without a symbol assigned, the graphics would not show up. The API defines three simple symbols to highlight points, line, and polygons. Let's look at the Simple Symbols.</p><div class="section" title="SimpleLineSymbol"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec27"/>SimpleLineSymbol</h3></div></div></div><p>The<a id="id181" class="indexterm"/> <code class="literal">SimpleLineSymbol</code> defines the symbology of line and polyline graphics added to the map. It may seem strange to start with line symbology, but the other two Simple symbols make use of a line symbol as well. The primary <code class="literal">SimpleLineSymbol</code>'s properties are its color, its width (in pixels), and its style. Styles include lines that are solid, dashed, dotted, and combinations of those as well.</p></div><div class="section" title="SimpleMarkerSymbol"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec28"/>SimpleMarkerSymbol</h3></div></div></div><p>The<a id="id182" class="indexterm"/> <code class="literal">SimpleMarkerSymbol</code> defines the symbology of point and multipoint graphics on the map. The symbol can generate different shapes, depending on the style that is set. While this symbol defaults to a circle, the <code class="literal">SimpleMarkerSymbol</code> can generate squares, diamonds, x's, and crosses. Other properties that can be manipulated within this symbol include the size in pixels, its outline as a <code class="literal">SimpleLineSymbol</code>, and its color.</p></div><div class="section" title="SimpleFillSymbol"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec29"/>SimpleFillSymbol</h3></div></div></div><p>
<code class="literal">SimpeFillSymbols</code> <a id="id183" class="indexterm"/>define the symbology of polygon graphics on the map. The style of the <code class="literal">SimpleFillSymbol</code> reflects how the inside of the shape is shown. It can be solid (completely filled in), null (completely empty), or have lines running horizontally, vertically, diagonally, or crossing. Please note that a graphic with a null-styled symbol does not respond to clicks in the center. The symbol can also be modified by a <code class="literal">SimpleLineSymbol</code> outline, and if the style of the <code class="literal">SimpleFillSymbol</code> is solid, its fill color can be modified as well.</p><p>Let's look a little further at the colors we'll use to define these symbols.</p></div></div><div class="section" title="esri/Color"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>esri/Color</h2></div></div></div><p>The <code class="literal">esri/Color</code> module<a id="id184" class="indexterm"/> allows you to customize the colors of the graphics you add to your map. The <code class="literal">esri/Color</code> module is an extension of the <code class="literal">dojo/_base/Color</code> module, and adds some unique tools to blend, create, and calculate color formats in different ways. Older versions of the library used the <code class="literal">dojo/_base/Color</code> module to set colors, and is still usable in the current version.</p><p>The constructor for the <code class="literal">esri/Color</code> module can accept a variety of values. You can assign common color names, such as "blue" or "red". You can use hex strings (for example <code class="literal">#FF00FF</code> for purple), like you would find in css colors. You can also create colors using three or four number arrays. The first three numbers in the array assign the red, green, and blue values from 0 to 255 ([0, 0, 0] is black, [255, 255, 255] is white). The fourth optional number in the array indicates the alpha, or the opacity of the color. Values in this range are from 0.0 to 1.0, with 1.0 being completely opaque, and 0.0 being completely transparent.</p><p>The <code class="literal">esri/Color</code> module has some interesting enhancements on the old <code class="literal">dojo/_base/Color</code> module. For instance, you can create a blend of two existing colors with the <code class="literal">blendColors()</code> method. It takes two colors, and a decimal number between 0.0 and 1.0, where 0.5 is an even blend of the two colors. This could be useful, for instance, on a voting map where green represents yes, and red represents no, and voting districts could be colored by percentages of yes or no votes.</p><p>The <code class="literal">esri/Color</code> modules also have ways to translate colors from one format to another. For instance, you could click on a feature, get its graphic color, and use <code class="literal">toHex()</code> or <code class="literal">toCss()</code> to get the color string. From there, you could apply that color to the background color of an information <code class="literal">&lt;div&gt;</code> which is used to show the attributes of that graphic.</p></div><div class="section" title="Picture symbols"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Picture symbols</h2></div></div></div><p>If pictures <a id="id185" class="indexterm"/>speak to you more than colors, you can use <a id="id186" class="indexterm"/>Picture Symbols in your graphics. With these symbols, you can use picture icons and custom graphics to add interesting and memorable data points on your graph. Points and polygons can be symbolized using Picture Symbols, using the modules <code class="literal">esri/symbols/PictureMarkerSymbol</code> and <code class="literal">esri/symbols/PictureFillSymbol</code> respectively.</p><p>The <code class="literal">PictureMarkerSymbol</code> module adds simple picture graphics for points on the map. It is typically constructed with three arguments, a URL pointing to the image file (such as <code class="literal">.jpg</code>, <code class="literal">.png</code>, or <code class="literal">.gif</code>), and an integer width and height in pixels.</p><p>The <code class="literal">PictureFillSymbol</code> module<a id="id187" class="indexterm"/> fills the content of a polygon with a repeating graphic. The <code class="literal">PictureFillSymbol</code> takes four arguments. The first is a URL string pointing to an image file. The second input is a line symbol, like the <code class="literal">esri/symbols/SimpleLineSymbol</code>. The final two arguments are integer width and the height of the image in pixels.</p></div><div class="section" title="Renderers"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Renderers</h2></div></div></div><p>Sometimes, you <a id="id188" class="indexterm"/>don't want to assign graphic symbols one at a time. If you know what type of graphics you're adding, and how the graphics should look ahead of time, it makes sense to assign the symbology ahead of time. That's where renderers come in. Renderers can be assigned to <code class="literal">GraphicsLayers</code> as a way to assign a common style to all graphics inside them. Renderers depend on a graphics layer accepting one geometry type (like all polygons, for instance).</p><p>As the ArcGIS API has matured, it has added a number of different renderers to its library. We'll take a look at three common ones: the <code class="literal">SimpleRenderer</code>, the <code class="literal">UniqueValueRenderer</code>, and the <code class="literal">ClassBreakRenderer</code>. Each has its appropriate use cases.</p><div class="section" title="SimpleRenderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec30"/>SimpleRenderer</h3></div></div></div><p>The <a id="id189" class="indexterm"/><code class="literal">SimpleRenderer</code> is<a id="id190" class="indexterm"/> the simplest of the renderers because it only assigns one symbol. It accepts a default symbol, and assumes that you'll only insert graphics of the same type as the symbol. Like other renderers, if you assign a <code class="literal">SimpleRenderer</code> to a <code class="literal">GraphicsLayer</code>, you can add Graphic objects to the <code class="literal">GraphicsLayer</code> without them having a symbol assigned. Let's look at a code snippet that shows how to create and apply a <code class="literal">SimpleRenderer</code> to the map's graphics layer:</p><div class="informalexample"><pre class="programlisting">require(["esri/map", "esri/renderers/SimpleRenderer",
  "esri/symbols/SimpleLineSymbol", "esri/Color", 
  "dojo/domReady!"],
function (Map, SimpleRenderer, LineSymbol, Color) {
  …
  Var map = new Map("map", {basemap: "OSM"});
  var symbol = new LineSymbol().setColor(new Color("#55aadd"));
  var renderer = new SimpleRenderer(symbol);
  …
  map.graphics.setRenderer(renderer);
});</pre></div><p>The<a id="id191" class="indexterm"/> <code class="literal">SimpleRenderer</code> has been expanded since version 3.7 of the API. Symbols can be modified in different ways, based on a range of expected values in a <a id="id192" class="indexterm"/>field. For instance, you can vary the symbol's color between two colors by setting the <code class="literal">colorInfo</code> property of the SimpleRenderer. You can also change the size of a point according to a field value by setting its <code class="literal">proportionSymbolInfo</code> property. Finally, you can rotate a symbol by its field value by setting its <code class="literal">rotationInfo</code> property.</p></div><div class="section" title="Unique Value Renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec31"/>Unique Value Renderer</h3></div></div></div><p>Sometimes you<a id="id193" class="indexterm"/> want to display different symbols for your graphics based on one of their attributes. You can do that with a Unique Value Renderer. Specific unique values can be highlighted, while values not in the list can be assigned a default symbol.</p><p>The constructor of the<a id="id194" class="indexterm"/> Unique Value Renderer accepts a default symbol, and up to three different fields to compare values against. If more than one field is used, a field delimiter string is required. Unique values and the associated symbols can then be loaded as objects within the renderer's info parameter. The info object requires the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A unique value (<code class="literal">value</code>)</li><li class="listitem" style="list-style-type: disc">A symbol associated with that value (<code class="literal">symbol</code>)</li><li class="listitem" style="list-style-type: disc">A symbol label (<code class="literal">label</code>)</li><li class="listitem" style="list-style-type: disc">A description of the unique value (<code class="literal">description</code>)</li></ul></div></div><div class="section" title="Class Break Renderer"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec32"/>Class Break Renderer</h3></div></div></div><p>Sometimes <a id="id195" class="indexterm"/>you want to classify your graphics by where they fit in certain ranges of values, like population or<a id="id196" class="indexterm"/> <span class="strong"><strong>Gross Domestic Product</strong></span> (<span class="strong"><strong>GDP</strong></span>). The Class Break Renderer helps you to organize the graphics in a visual manner. This renderer looks at a particular field value in a graphic, and finds which class break range graphic's field value fits between. It then assigns the corresponding symbol to that graphic.</p><p>When constructing a <a id="id197" class="indexterm"/>Class Break Renderer, you assign a default symbol, and the field that will be evaluated to modify the symbol. Class breaks are assigned through an info property of the renderer. The<a id="id198" class="indexterm"/> info array accepts a JavaScript object containing the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The minimum value of the class break (<code class="literal">minValue</code>)</li><li class="listitem" style="list-style-type: disc">The maximum value of the class break (<code class="literal">maxValue</code>)</li><li class="listitem" style="list-style-type: disc">The symbol (<code class="literal">symbol</code>)</li><li class="listitem" style="list-style-type: disc">A label describing the break (<code class="literal">label</code>)</li><li class="listitem" style="list-style-type: disc">A description of the class break (<code class="literal">description</code>)</li></ul></div></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="InfoTemplates"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>InfoTemplates</h1></div></div></div><p>
<code class="literal">InfoTemplates</code>, as <a id="id199" class="indexterm"/>we mentioned in <a class="link" href="ch01.html" title="Chapter 1. Your First Mapping Application">Chapter 1</a>, <span class="emphasis"><em>Your First Mapping Application</em></span>, describe how you want to display data in a popup. The <code class="literal">InfoTemplate</code> can be constructed using two strings, the title and the content. The title and content strings represent HTML templates, and you can substitute graphic attributes in the template. For a graphic's <code class="literal">infoTemplate</code>, if you wanted to display the graphic's total attribute, you would insert the value in the template with a <code class="literal">${total}</code>, which shows the field name inserted inside the brackets of the substitution string <code class="literal">${}</code>.</p><p>If you want to display a popup containing all the name/value pairs in the graphic's attributes, you can use a wildcard <code class="literal">${*}</code> in the content value, as follows:</p><div class="informalexample"><pre class="programlisting">graphic.infoTemplate = new InfoTemplate("Attributes", "<span class="strong"><strong>${*}</strong></span>");</pre></div><p>For the content, you can add HTML content to the string, including tables, lists, images, and links. For example, you might use something like the following to describe a marine habitat:</p><div class="informalexample"><pre class="programlisting">graphic.infoTemplate = new InfoTemplate("Marine Habitat 
  (<span class="strong"><strong>${name}</strong></span>)", "&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th&gt;Type: 
  &lt;/th&gt;&lt;td&gt;<span class="strong"><strong>${type}</strong></span>&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;th&gt;Ocean 
  zone:&lt;/th&gt;&lt;td&gt;<span class="strong"><strong>${zone}</strong></span>&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;img 
  src='<span class="strong"><strong>${imageSrc}</strong></span>' alt='<span class="strong"><strong>${name}</strong></span>' /&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;");</pre></div><p>In the preceding example, we added the name attribute of the graphic to the title, and created a two-column table that displays the type of the graphic, the zone where the graphic resides, and a two-column wide image connected to the map graphic.</p></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Toolbars"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Toolbars</h1></div></div></div><p>The <a id="id200" class="indexterm"/>ArcGIS API for JavaScript uses toolbars to handle controls that transform the cursor. The API has three different toolbars: one for map navigation, one for drawing graphics, and one for editing those graphics. These tools are turned on using the <code class="literal">activate()</code> method, which includes parameters describing what tool you want to use. The tools can be turned off using the <code class="literal">deactivate()</code> method; let's take a closer look at these tools.</p><div class="section" title="The navigation toolbar"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>The navigation toolbar</h2></div></div></div><p>The <a id="id201" class="indexterm"/>navigation toolbar<a id="id202" class="indexterm"/> handles advanced map navigation. By default, the map offers zoom sliders, and the ability to pan around the map. By activating the zoom in/zoom out features of the navigation toolbar, the user can draw a boxed extent where the map will either zoom in on, or zoom out at the same ratio as the zoom box to the map's current extent. This zoom in/out box is always on once you activate it, so you'll have to either develop something that turns it off, or let the user activate the pan tool, which disables the zoom in/out.</p><p>The navigation controls have three more actions that can be activated. The <code class="literal">zoomToFullExtent()</code> function, when called from the navigation toolbar, triggers the map to zoom to its original map extent. The toolbar also keeps track of how many zoom-ins, zoom-outs, and pans the user has done. By activating the <code class="literal">zoomToPreviousExtent()</code> function, the map extent goes back to previous extents. And if the map goes back to previous extents, the map can also zoom to future locations. With the <code class="literal">zoomToNextExtent()</code> function, the user can undo the zoom extent changes they made when they viewed the previous extent.</p></div><div class="section" title="The draw toolbar"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>The draw toolbar</h2></div></div></div><p>The <a id="id203" class="indexterm"/>draw toolbar<a id="id204" class="indexterm"/> allows the user to draw on the map to provide input. Depending on which draw tool was activated, the user can draw a shape on the map, and any event listener attached to the <code class="literal">draw-end</code> event is called, running a function that receives the shape the user drew. Multiple <code class="literal">draw-end</code> events can be attached to the event listener if needed. Common draw-end events might include adding a drawing to the map, measuring the shape drawn by the toolbar, or using the shape drawn in a query. The tools also modify the tooltip of the map, giving directions about how to draw with them.</p><p>The ArcGIS API provides numerous shapes to use when drawing on the map. The toolbar can be activated using simple drawing tool constants like point, polyline, and polygon, which are activated by clicking each point on the map and double-clicking to complete. There are freehand versions of the polyline and polygon, which allow you to click and drag the mouse to draw a continuous line or shape, and release the mouse to stop drawing. Also included in the API are drawing tools for common shapes such as triangles, rectangles, circles, ovals, and arrows, just to name a few.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>The different toolbars are not aware of each other. If you are not careful, you could activate both drawing and navigation tools at the same time, and their actions will occur simultaneously. You could draw a shape for a tool, and be zoomed into that area because the navigation tool wasn't told to deactivate. Plan ahead how you will disable one event when another is enabled.</p></div></div></div><div class="section" title="The edit toolbar"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>The edit toolbar</h2></div></div></div><p>What<a id="id205" class="indexterm"/> happens<a id="id206" class="indexterm"/> when you draw something on the map and you have made a mistake? How do you correct a graphic on the map? The edit toolbar allows you to change map graphics' shape, size, and orientation. It also works on text symbols, letting you change the text of a text graphic on the map.</p><p>When the edit toolbar is activated on a feature, it allows you to move, rotate, scale, or change the vertices of the feature. Moving lets you grab the feature and position it where you want. Rotating provides a point to click and drag around to re-orient the graphic. Scaling lets the user make the graphic larger or smaller. For editing vertices, the user can drag points around on the map, right-click to "delete" the point, and click between the graphic versions on "ghost points" to add new vertices to the map.</p><p>Please note that while the Edit Toolbar allows users to change graphics on the map, it doesn't have any features built in that let the user save their changes. When using the edit toolbar on graphics in an editable feature layer, you still will need a way to tell the feature layer to save changes. Graphics can be edited in the current session without saving the changes.</p></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Tasks"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Tasks</h1></div></div></div><p>As I mentioned <a id="id207" class="indexterm"/>in the previous chapter, some application items require resource-intense processes that are best left for the server. The ArcGIS API calls these actions tasks. There are a large variety of tasks. Some require the server to compute and/or return data, which is the case for the geometry service and the <code class="literal">QueryTask</code>. Others use the server to generate custom documents, like the Print Task. Still, others also do all this, and also require custom extensions not initially a part of ArcGIS Server. Let's take a look at what makes a good task.</p><div class="section" title="Tasks, parameters, and results"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Tasks, parameters, and results</h2></div></div></div><p>As we discussed in the previous chapter, a task is made up of three parts, the task constructor, the task parameters, and the task results. Typically, only the task constructor and the task parameters<a id="id208" class="indexterm"/> need to be loaded using AMD. The task results are automatically produced when the results return from the server. The format of the results is shown in the API documentation to show you how to access what you need when you successfully receive <a id="id209" class="indexterm"/>results. The common order of events with tasks is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The task and task parameters are constructed.</li><li class="listitem">The task parameters are filled in with the required information</li><li class="listitem">The task executes a server call using the task parameters.</li><li class="listitem">When the browser receives the results from the server, something is done with the results either through a <code class="literal">callback</code> function or a deferred value.</li></ol></div><p>It is worth noting that when tasks are executed, they return one of Dojo's <span class="strong"><strong>Deferred</strong></span> objects. These deferred results can be passed to another function to be run asynchronously when the browser receives the results.</p></div><div class="section" title="Common tasks"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>Common tasks</h2></div></div></div><p>There are <a id="id210" class="indexterm"/>many tasks commonly available on any installation <a id="id211" class="indexterm"/>of ArcGIS Server. Many rely on a published map service or geoprocessing service to act on. Some, like the <code class="literal">GeometryService</code>, are built into ArcGIS Server. Let's take a look at some of the common tasks available through the API.</p><div class="section" title="GeometryService"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec33"/>GeometryService</h3></div></div></div><p>
<code class="literal">GeometryService</code> <a id="id212" class="indexterm"/>provides multiple functions for manipulating geometry data. Typically, it is published as part of ArcGIS Server. Let's take a look at the Geometry Service functions available.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AreasAndLengths</code>: Finds<a id="id213" class="indexterm"/> areas and perimeters of polygon geometries</li><li class="listitem" style="list-style-type: disc"><code class="literal">AutoComplete</code>: Helps <a id="id214" class="indexterm"/>create polygons adjacent to other polygons by filling in gaps between them</li><li class="listitem" style="list-style-type: disc"><code class="literal">Buffer</code>: Creates <a id="id215" class="indexterm"/>a polygon whose edges are a set distance or distances from the source geometry</li><li class="listitem" style="list-style-type: disc"><code class="literal">ConvexHull</code>: Creates<a id="id216" class="indexterm"/> the smallest polygon shape necessary to contain all the input geometries</li><li class="listitem" style="list-style-type: disc"><code class="literal">Cut</code>: Splits <a id="id217" class="indexterm"/>a polyline or a polygon along a secondary polyline</li><li class="listitem" style="list-style-type: disc"><code class="literal">Difference</code>: Takes<a id="id218" class="indexterm"/> a list of geometries, and a secondary geometry (probably a polygon), and returns the first list any overlap against the secondary geometry is cut out</li><li class="listitem" style="list-style-type: disc"><code class="literal">Distance</code>: Finds<a id="id219" class="indexterm"/> the distance between geometries</li><li class="listitem" style="list-style-type: disc"><code class="literal">Generalize</code>: Draws <a id="id220" class="indexterm"/>a similar looking shape with much fewer points</li><li class="listitem" style="list-style-type: disc"><code class="literal">Intersect</code>: Given<a id="id221" class="indexterm"/> a list of geometries and another geometry, returns the geometries defined by where the first list intersected with the second</li><li class="listitem" style="list-style-type: disc"><code class="literal">Label Points</code>: Finds<a id="id222" class="indexterm"/> a point within a polygon which would be the best position to place a label</li><li class="listitem" style="list-style-type: disc"><code class="literal">Lengths</code>: For<a id="id223" class="indexterm"/> lines and polylines, finds the planar or geodesic distance from beginning to end</li><li class="listitem" style="list-style-type: disc"><code class="literal">Offset</code>: Given<a id="id224" class="indexterm"/> a geometry and a distance, will create a geometry the defined distance to the right of the original geometry if the distance is positive, or to the left of the geometry if negative</li><li class="listitem" style="list-style-type: disc"><code class="literal">Project</code>: Based<a id="id225" class="indexterm"/> on a geometry and a new spatial reference, it returns the original geometry in the new spatial reference</li><li class="listitem" style="list-style-type: disc"><code class="literal">Relation</code>: Based <a id="id226" class="indexterm"/>on two sets of geometries and a specified relationship parameter, returns a list of pairings showing how items in the two lists are related (for example: how many from list2 are inside list1)</li><li class="listitem" style="list-style-type: disc"><code class="literal">Reshape</code>: Given <a id="id227" class="indexterm"/>a line or a polygon, and a secondary line, it changes the shape of the first geometry based on the second one, adding to the original figure, or tossing some of it away</li><li class="listitem" style="list-style-type: disc"><code class="literal">Simplify</code>: Given<a id="id228" class="indexterm"/> a complicated polygon or line whose edges crosses itself, it returns simpler polygons where the crossed parts are undone</li><li class="listitem" style="list-style-type: disc"><code class="literal">TrimExtend</code>: Given<a id="id229" class="indexterm"/> a list of polylines, and a polyline to trim or extend to, it cuts lines in the list where they cross over the second polyline, and extend other polylines where they don't quite reach the secondary polyline</li><li class="listitem" style="list-style-type: disc"><code class="literal">Union</code>: Given a list<a id="id230" class="indexterm"/> of polygons, creates a unified geometry where all the polygons are dissolved along edges that overlap, creating one solid polygon</li></ul></div></div><div class="section" title="QueryTask"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec34"/>QueryTask</h3></div></div></div><p>The <code class="literal">QueryTask</code> <a id="id231" class="indexterm"/>provides a way to collect both shape and attribute data from features in a map service. You can request data on individual layers in a map service, defining your search area by geometry and/or limiting your results to attribute queries. The <code class="literal">QueryTask</code> is constructed with a URL parameter pointing to a single layer in a map service. The number of results returned from a successful query is limited by ArcGIS Server, typically to either 1,000 or 2,000 results.</p><p>Because results for<a id="id232" class="indexterm"/> a <code class="literal">QueryTask</code> can be limited by ArcGIS Server, the <code class="literal">QueryTask</code> object has been extended with multiple methods to collect data on its search results. Here are some of the methods available through the <code class="literal">QueryTask</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">execute()</code>: Accepts<a id="id233" class="indexterm"/> the <code class="literal">QueryTask</code> parameters, and requests features based on those parameters.</li><li class="listitem" style="list-style-type: disc"><code class="literal">executeForCount()</code>: Accepts <a id="id234" class="indexterm"/>the same parameters, and returns the number of results in the map service layer that match the query.</li><li class="listitem" style="list-style-type: disc"><code class="literal">executeForExtent()</code>: It is<a id="id235" class="indexterm"/> based on the parameters passed, returns the geographic extent that contains all the search results. Note that this is only valid on hosted feature services on <a class="ulink" href="http://www.arcgis.com">www.arcgis.com</a>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">executeForIds()</code>: With<a id="id236" class="indexterm"/> the parameters passed, the results return a list of <code class="literal">ObjectIds</code> for the features that match the search. Unlike the execute command, where the number of results are limited by ArcGIS Server, the <code class="literal">executeForIds()</code> method returns all the <code class="literal">ObjectIds</code> that match the search. That means, if there are 30,000 results that match the search, this method will return 30,000 <code class="literal">ObjectIds</code>, instead of the server limit of 1,000.</li></ul></div><p>The <code class="literal">QueryTask</code> parameters can be created using the <code class="literal">Query</code> module (<code class="literal">esri/tasks/query</code>). If you have experience with SQL, you'll see similarities between the <code class="literal">Query</code> parameters and SQL <code class="literal">Select</code> statements, while there are some <code class="literal">Query</code> parameters that are more specific to ArcGIS Server. A few of the common ones are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">where</code> (string): A <a id="id237" class="indexterm"/>legal where clause for a query.</li><li class="listitem" style="list-style-type: disc"><code class="literal">geometry</code> (esri/geometry): A <a id="id238" class="indexterm"/>shape to spatial select against.</li><li class="listitem" style="list-style-type: disc"><code class="literal">returnGeometry</code> (Boolean): Whether <a id="id239" class="indexterm"/>you want the geometry of the search result features. Setting this to false returns just attribute data.</li><li class="listitem" style="list-style-type: disc"><code class="literal">outFields</code> (array of strings): A <a id="id240" class="indexterm"/>list of fields to retrieve the search results. Assigning ["<code class="literal">*</code>"] to the <code class="literal">outFields</code> parameter returns all fields, which is equivalent to the SQL statement <code class="literal">SELECT * from</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">outSpatialReference</code> (<code class="literal">esri/SpatialReference</code>): The<a id="id241" class="indexterm"/> spatial reference you want the geometry to be drawn in. Typically, the map's spatial reference is assigned to this value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">orderByFields</code> (array of strings): A <a id="id242" class="indexterm"/>list of field values to sort the results by. Add <code class="literal">DESC</code> to the string if you want values returned in descending order.</li></ul></div><p>Results are returned from <code class="literal">QueryTask</code> in a form called <code class="literal">FeatureSet</code> (<code class="literal">esri/tasks/FeatureSet</code>). <code class="literal">FeatureSet</code> contains data about the results returned, including the geometry type of the results, the spatial reference, field aliases for the results, and a list of feature graphics that match the search results. The <code class="literal">featureSet</code> even returns whether or not the number of results that match the query exceeded the number that could be delivered by ArcGIS Server. The array of features within the features property of the <code class="literal">featureSet</code> can symbolized and added straight to a map's graphics layer to be seen and clicked.</p></div><div class="section" title="IdentifyTask"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec35"/>IdentifyTask</h3></div></div></div><p>The<a id="id243" class="indexterm"/> <code class="literal">IdentifyTask</code> <a id="id244" class="indexterm"/>provides a shortcut way to retrieve data from a map service for a popup. Unlike the <code class="literal">QueryTask</code>, which queries only one layer in the map service, the <code class="literal">IdentifyTask</code> can search through all layers in the map service. While the <code class="literal">QueryTask</code> has numerous methods to retrieve data on a search, the <code class="literal">IdentifyTask</code> is more simplified, with a single <code class="literal">execute()</code> command to retrieve server results.</p><p>The parameters passed to an <code class="literal">IdentifyTask</code> are referred to as <code class="literal">IdentifyParameters</code>. Because <code class="literal">IdentifyTasks</code> can search multiple layers, the <code class="literal">IdentifyParameters</code> focus on searching by geometry. To search by a <code class="literal">where</code> clause, a <code class="literal">layerDefinition</code> parameter must also be added to the parameters.</p><p>The results of an <code class="literal">IdentifyTask</code>, known as the <code class="literal">IdentifyResults</code>, differ somewhat from the <code class="literal">FeatureSet</code>. First, <code class="literal">IdentifyResults</code> are returned as an array of objects that contain a feature parameter that contains the result graphic, while the <code class="literal">FeatureSet</code> is a single object with an array of graphics in its features parameter. Secondly, <code class="literal">IdentifyResults</code> do not contain a list of field names and aliases like the <code class="literal">FeatureSet</code>, because the feature attributes of the <code class="literal">IdentifyResult</code> are name/value pairs where the name key is the alias. Finally, the <code class="literal">IdentifyResults</code> return the layer id and name of the layer they were retrieved from. These attributes makes the <code class="literal">IdentifyTask</code> favourable to quickly populate a map's popup on a click.</p></div><div class="section" title="FindTask"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec36"/>FindTask</h3></div></div></div><p>The ArcGIS API <a id="id245" class="indexterm"/>offers another tool for finding features on a map called a <a id="id246" class="indexterm"/><code class="literal">FindTask</code>. The <code class="literal">FindTask</code> accepts a text string, and searches for features in the map service that contain that value. On the database side, the <code class="literal">FindTask</code> queries through each layer in the map service, searching permitted fields for a text string with wildcards before and after it. If searching for the string "Doe", the <code class="literal">FindTask</code> would return a feature with the name value of "John <span class="emphasis"><em>Doe</em></span>", "<span class="emphasis"><em>Doe</em></span> Trail", or "<code class="literal">Fiddledee</code> <span class="emphasis"><em>doe</em></span> Studios", but would not return a feature containing "Do exit" because of the space.</p></div><div class="section" title="Locator"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec37"/>Locator</h3></div></div></div><p>A<a id="id247" class="indexterm"/> Locator <a id="id248" class="indexterm"/>provides either an approximate location for an address based on street addressing data, known as <a id="id249" class="indexterm"/><span class="strong"><strong>geocoding</strong></span>. The locator can also perform <a id="id250" class="indexterm"/><span class="strong"><strong>reverse geocoding</strong></span>, which provides an approximate address for a point on the map based on that same street data. ESRI provides geocoding services on a national and world level, but if you have more up-to-date street information, you can publish your own geocoding service on ArcGIS Server.</p><p>For address location, the locator accepts a parameter object containing either a single line input, or an object containing a Street, City, State, and Zone (zip code) parameter. The <code class="literal">callback</code> function that accepts the <code class="literal">Locator.execute()</code> results should accept a list of objects called <code class="literal">AddressCandidates</code>. These <code class="literal">AddressCandidates</code> include the possibly matching street <a id="id251" class="indexterm"/>address, the point location of the address, and a score from 0 to 100, where 100 is a perfect match. If no results return there were no matches for the address provided.</p></div></div><div class="section" title="Tasks requiring server extensions"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>Tasks requiring server extensions</h2></div></div></div><p>While <a id="id252" class="indexterm"/>ArcGIS Server packs a lot of functionality, ESRI also provides server extensions, or optional software that performs specific tasks through ArcGIS Server. This software can do a number of unique tasks, from providing driving directions to sifting through tweets in your area. You will need to know if your server has one or more of these extensions before trying to use them. We'll take a look at one of them, the Routing Task.</p><div class="section" title="Routing"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec38"/>Routing</h3></div></div></div><p>Routing Tasks <a id="id253" class="indexterm"/>can <a id="id254" class="indexterm"/>provide driving directions, calculate the most effective routes, and redirect users around known roadblocks. The Routing Tasks require the Network Analyst extension for ArcGIS Server. For Routing Parameters, you can add a <code class="literal">FeatureSet</code> into the stop parameter, and fill it with graphics defining the various stops our vehicle has to make. You can also supply barriers in the same way, which block certain roadways. When the Routing Task is executed, it returns a best route based on the street data provided to the service.</p></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Dijits"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Dijits</h1></div></div></div><p>The <a id="id255" class="indexterm"/>ArcGIS API for JavaScript also provides Dojo widgets, commonly referred to as <span class="strong"><strong>dijits</strong></span>. Many of these dijits offer a<a id="id256" class="indexterm"/> <span class="strong"><strong>user interface</strong></span> (<span class="strong"><strong>UI</strong></span>) with existing API modules working in the background. Using these dijits can cut development time by providing well-used and tested UI components. Dijit documentation also shows the CSS classes used to style the dijits, so that developers and designers can restyle them to fit the theme of the page. Let's take a look at the more commonly used dijits.</p><div class="section" title="Measurement"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Measurement</h2></div></div></div><p>The <a id="id257" class="indexterm"/>Measurement dijit<a id="id258" class="indexterm"/> provides a tool that can be used to measure distances, areas, and perimeters of locations on the map. It can also get the latitude and longitude of points on the map. The dijit uses the drawing toolbar to draw shapes on the map. From there, it sends a request to a <code class="literal">GeometryService</code>. Once the dijit has retrieved its results, it either displays the latitude and longitude of a point, shows the length of the line drawn on the map, or displays the area and perimeter of the polygon area drawn on the map.</p></div><div class="section" title="Print"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Print</h2></div></div></div><p>The <a id="id259" class="indexterm"/>Print dijit<a id="id260" class="indexterm"/> provides a dropdown control that lets the user select from a predefined list of print templates and parameters. The developer configures the dijit with a link to an ArcGIS Server print service, and a list of predefined print parameters. When the user selects from one of the dropdown choices, the <code class="literal">printTask</code> incorporated in the Print dijit fires off an <code class="literal">execute()</code> method with the corresponding print parameters. When the <code class="literal">printTask</code> receives a success response from the server, the dijit provides a link to click on to download the printout.</p><p>If you need more granularity in your print control, this dijit is not for you. This tool is not meant to handle every combination of print parameters. If you're required to support everything from Tabloid ANSI B Landscape <code class="literal">.pdf</code> documents to Letter ANSI A Portrait <code class="literal">.gif</code> images, and everything else in between, you should consider developing your own tool.</p></div><div class="section" title="Bookmarks"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Bookmarks</h2></div></div></div><p>The <a id="id261" class="indexterm"/>Bookmarks dijit<a id="id262" class="indexterm"/> allows the user to save custom areas on the map. You can pre-assign bookmarked areas in the configuration file that the user can click and zoom to. They can also add areas to a list, edit the names, and delete the custom areas they want to zoom to. The Bookmarks dijit does not save the map state, meaning that the layers that were turned on previously won't be automatically switched, and the selected graphics on the map may not be there.</p></div><div class="section" title="Basemaps"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>Basemaps</h2></div></div></div><p>The <a id="id263" class="indexterm"/>ArcGIS API provides a couple dijits for changing your basemaps. This can be useful when the data blends in or doesn't look right against the current background. The first tool the API provides is a <code class="literal">BasemapToggle</code>, which lets you switch between two <a id="id264" class="indexterm"/>basemaps. The second is the <code class="literal">BasemapGallery</code>, which offers more choices. Both provide thumbnail photos and captions describing the basemaps.</p><p>The <code class="literal">BasemapGallery</code> can be customized to show your custom basemaps, or show basemaps from ArcGIS Online. When constructing the <code class="literal">BasemapGallery</code>, the choice of incorporating ArcGIS Online basemaps can be modified by setting the <code class="literal">showArcGISBasemaps</code> option to true. Remember the rule about tiled map services, however. The ArcGIS Online basemaps are in Web Mercator Auxiliary Sphere (WKID 102100), which is the same projection as Google and Bing Maps. If your data is not in the same projection, you could have issues with accuracy and/or missing tiled layers.</p></div><div class="section" title="Popups and InfoWindows"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Popups and InfoWindows</h2></div></div></div><p>Popups <a id="id265" class="indexterm"/>and <a id="id266" class="indexterm"/><code class="literal">InfoWindows</code> provide a small window to view data about features on a map. There are four varieties of the <code class="literal">infoWindows</code> available: The legacy version that was replaced in version 3.4, a smaller version of the legacy <code class="literal">infoWindow</code> called <code class="literal">InfoWindowLite</code>, the current default popup control, and a lighter mobile version of the current popup.</p><p>The current popup exposes a number of elements that you can tap into to customize the user experience. The popup can select multiple features, and holds the graphics content of the selected items in a features array. It also has a paging control that lets the user click to see what other features have been selected. It also keeps track of which feature is selected through a <code class="literal">selectedIndex</code> parameter.</p></div><div class="section" title="Editing"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>Editing</h2></div></div></div><p>The <a id="id267" class="indexterm"/>editing dijits <a id="id268" class="indexterm"/>provide UI components and tools that you can use to edit features on the map. These tools work with editable <code class="literal">FeatureLayers</code>, allowing the user to edit shapes, add features on the map, change attributes, and save all those changes to the server. Let's look at some of the components that make up the editing tools.</p><div class="section" title="AttributeInspector"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec39"/>AttributeInspector</h3></div></div></div><p>The <a id="id269" class="indexterm"/><code class="literal">AttributeInspector</code><a id="id270" class="indexterm"/> allows the user to edit graphic attribute data from an HTML form. The inspector connects to the <code class="literal">FeatureLayer</code> and displays data on one of the features that is selected. The inspector also provides a previous and next button to search through the selected Features. The <code class="literal">AttributeInspector</code> also supplies a delete button to delete selected features.</p><p>The inspector then builds a form based on the requirements of the features. Dates will be given calendars, and domain-bound fields will show an HTML Select element with a dropdown list of domain choices. The user can type in and edit data, and the data can be saved server-side.</p></div><div class="section" title="TemplatePicker"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec40"/>TemplatePicker</h3></div></div></div><p>The <a id="id271" class="indexterm"/><code class="literal">TemplatePicker</code> <a id="id272" class="indexterm"/>provides a selector to select what feature types and subtypes you'll be editing. When a <code class="literal">featureLayer</code> is published as editable, it has to expose the symbology and preset styles through the REST service. The <code class="literal">TemplatePicker</code> then reads the exposed symbology and feature setup data to create a grid of valid editable choices. The user clicks on the templates like a button, and the symbology is passed to a drawing tool of some kind.</p></div><div class="section" title="An all-in-one Editor"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec41"/>An all-in-one Editor</h3></div></div></div><p>The ArcGIS API provides an <a id="id273" class="indexterm"/>all-in-one <span class="strong"><strong>Editor</strong></span> dijit<a id="id274" class="indexterm"/> to provide some basic editing needs. The dijit incorporates the <code class="literal">TemplatePicker</code> to select features types and subtypes to draw from. It also has a toolbar with various tools, pertaining to the editable features on the map. So, when you select a green line, the tool will show line-related drawing tools.</p><p>The Editor also generates an <code class="literal">AttributeInspector</code> in the <code class="literal">map.infoWindow</code>. You can edit field values from the popup. It is up to you how you implement saving changes.</p><p>The editor also provides undo and redo buttons in the toolbar. If you accidently delete a feature you wanted to save, you can use the undo button. If you realize that you really wanted to delete that feature, you can click the redo button.</p><p>Now that you have been exposed to most of the major features of the ArcGIS API for JavaScript, you are better prepared to write some more code using the API.</p></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec30"/>Summary</h1></div></div></div><p>In this chapter, we've taken a whirlwind tour of the ArcGIS API for JavaScript. We've gained familiarity with how the website and API is organized. We've studied the Map object in detail, looking at all its parts. We've looked over the other parts of the API, including layers, graphics, toolbars, tasks, and dijits. We've discussed how each of these are implemented, and some use cases for them. Now that we know more about the parts of the API, we can use these components to create custom applications and widgets in the next chapter.</p></div></div></div></body></html>