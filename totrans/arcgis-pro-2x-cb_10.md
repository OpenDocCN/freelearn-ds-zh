# 3D 地图和 3D 分析师

在本章中，我们将介绍以下食谱：

+   创建 3D 场景

+   启用数据存储 Z（高程）

+   从 2D 创建 Multipatch 特征

+   创建 3D 特征

+   计算多边形的体积

# 简介

从其 50 多年前的起源以来，GIS 一直依赖于 2D 地图。它们是我们创建和执行所有分析的地方。最近，这种情况正在改变。我们越来越多地需要考虑第三维，Z。这是因为世界变得越来越拥挤。我们的基础设施在地面以上和以下都堆叠起来。因此，跟踪和以 3D 形式查看数据的需求正在增加。支持技术，如 **光探测与测距**（**LiDAR**）、**无人机**（**Drones/UAS/UAV**）以及计算机能力的提高，也在推动这一趋势。

如您在完成本书前面的食谱时所见，ArcGIS Pro 是一种非常强大的可视化和分析数据工具。然而，到目前为止，我们一直在 2D 环境中工作。虽然我们可以在 2D 中做很多事情，但它确实有限制，因为我们生活在一个 3D 世界中。ArcGIS Pro 带来了我们之前桌面 GIS 应用程序中没有的新 3D 功能。它原生支持数据的 3D 查看、查询和有限分析。当您添加 3D Analyst 扩展时，您就打开了全新的可能性世界。

在 3D 中工作提供了更好的查看和管理我们基础设施的方法。我们可以开始看到我们维护、查看和分析的特征之间的真实空间关系。ArcGIS Pro 允许您使用核心应用程序创建 3D 地图，称为 **场景**，如下所示：

![图片](img/aa527a58-7554-4525-92dd-0b1eca5da934.png)

前一场景是使用 ArcGIS Pro 创建的。您可以看到建筑物、电线杆、路灯和消防栓，所有这些都以 3D 形式呈现。这使您能够看到诸如建筑物是否会挡住电线，或者建筑物是否会投射阴影，从而阻止某些植物生长的区域等问题。如果您添加了 3D Analyst 扩展，那么您就可以开始计算道路或管道的坡度，确定一栋建筑是否可能阻挡另一栋建筑的视线，等等。

不要将您的 3D 思维或显示限制在基础设施上。任何数据都可以以 3D 形式显示。这为您提供了全新的数据查看方式，如下面的地图所示：

![图片](img/080aea89-33fd-40d8-b1fa-f0f8b4bbae33.png)

如您所见，这两张地图与基础设施无关。相反，它们突出显示具有更高和更低值的区域。3D的使用使得这些具有更高和更低值的区域在视觉上更加突出，甚至比使用传统符号更加明显。这些地图还说明，您可以将传统的分类和定量符号与3D结合使用，以产生更具影响力的地图。这种功能包含在ArcGIS Pro的核心功能中。

*如果我需要做的不仅仅是可视化3D数据呢？如果我需要分析数据以便利用高程或高度信息呢？* 好吧，我们已经暗示过了。Esri为ArcGIS Pro提供了一个名为**3D Analyst**的扩展。这个扩展极大地增强了ArcGIS Pro在3D环境中的工作能力。3D Analyst扩展为您的工具箱添加了一个新的工具箱，其中包含11个工具集和100多个用于创建、转换和分析3D数据的工具。3D Analyst扩展不是ArcGIS Pro核心产品的一部分。它必须作为附加许可证购买。然而，它将与ArcGIS Pro的所有许可证级别兼容。要了解更多关于3D Analyst扩展的信息，请访问[https://www.esri.com/software/arcgis/extensions/3danalyst](https://www.esri.com/software/arcgis/extensions/3danalyst)。

在本章中，您将有机会探索ArcGIS Pro的一些3D功能。您将从创建一个3D场景开始。然后您将学习如何使您的要素类存储Z坐标，就像它存储*x*和*y*一样。然后您将进入更高级的概念，并开始使用3D Analyst扩展。

# 创建3D场景

正如我们所说，ArcGIS Pro允许您创建3D地图，这是其核心功能的一部分，无论许可证级别如何。所以您即将要做的事情就是如此。在这个场景中，您为一家工程公司工作，该公司正在处理一个可能将采石场改造成水库的项目。项目的首席工程师要求您创建一个3D地图，他将在向客户展示计划时使用。这将帮助客户和工程师在创建计划时可视化该区域。

在ArcGIS Pro中，3D地图被称为**场景**。在创建新的3D场景时，您需要确定的第一件事之一是哪些数据将作为地面。地面成为所有2D图层覆盖的画布。是的，3D场景将包括2D和3D图层。典型的2D图层可能包括航空照片、地块、政治边界和自然水特征。这些通常有助于将您的3D图层置于上下文中。地面也可以作为显示3D图层的起点。它可能为这些特征提供起始高程。然后它们从该表面向上或向下拉伸。Esri提供了一个地形模型，它是任何新3D场景的默认地面。此模型是通过ArcGIS Online发布的网络服务。您也可以使用您自己的高程或地形数据。这可以包括数字高程模型（**DEM**）、**不规则三角网**（**TIN**）或其他网络服务。

在此配方中，您将创建一个简单的3D场景，该场景包含项目区域。此场景将包括2D和3D图层。您为地图设置高程源，该地图将作为地面。您将通过创建一个包含本地场景的新项目来开始所有这些操作。

# 准备工作

此配方需要将样本数据安装到计算机上。建议您在开始此配方之前完成[第1章](45fda239-2b00-4355-9553-6c6c2b69b0ab.xhtml)中的配方，*ArcGIS Pro功能与术语*。这将确保您对如何添加图层、设置符号和在地图内导航有更好的基础理解。您可以使用任何ArcGIS Pro许可级别完成此配方。

还建议您验证您的计算机硬件是否足够用于处理3D数据。这比处理传统的2D地图需要更多的功率。建议您至少有一个i5或更好的处理器，8GB或更多RAM（如果您没有专用显卡，则为16GB），专用显卡带有**图形处理单元**（**GPU**），以及4GB视频RAM和12GB的空闲硬盘空间。如果您的计算机不符合或超过这些规格，您可能无法完成此配方和其他章节中的其他配方。

# 如何操作...

1.  您将首先启动ArcGIS Pro，就像您在之前的配方中所做的那样。在右侧的创建新项目面板中，选择`Local_Scene.aptx`，如图所示：

![](img/c4e3d84e-af88-48a8-bab3-48e5cde952f6.png)

1.  在出现的创建新项目窗口中，将您的新项目命名为`3DAnalyst`。

1.  点击位置单元格末尾的浏览按钮。然后在选择文件夹以存储项目的窗口的左侧面板中，点击计算机。

1.  在右侧的面板上，双击`C:`驱动器。有时它被标记为操作系统或本地驱动器。

1.  滚动并双击`Student`文件夹。然后对`ArcGISProCookbook`文件夹重复此操作。

1.  滚动并选择 `第 10 章` 文件夹。不要双击它。一旦选择，使得 `Chapter10` 显示为名称，点击确定。

记住，在这一部分创建新项目时，你是在选择新项目将存储的位置，而不是项目的名称。因此，你必须选择一个本地驱动器或网络共享上的现有文件夹。如果你双击而不是单击来选择，你需要回退一个文件夹。你可以通过点击位于左上角的“后退”按钮来完成。它看起来像是一个箭头在圆圈里面。

1.  确认你的创建新项目窗口看起来如下，并点击确定：

![图片](img/55c846df-0465-42fc-8950-b6a77f6f9781.png)

你刚刚创建了一个新项目。这个新项目包含一个单独的本地场景。现在你将需要向项目中添加数据和文件夹连接，以便添加图层和访问数据。

1.  在目录窗格中，右键单击文件夹文件夹并选择添加文件夹连接。

1.  在添加文件夹连接窗口的左侧面板中，选择计算机。然后双击 C: 驱动器。

1.  滚动并双击学生文件夹。

1.  通过单击选择 ArcGISProCookbook 文件夹并点击确定。

1.  在目录窗格中展开文件夹文件夹并回答以下问题。

**问题**：你看到了哪些文件夹连接到你的项目？

**答案**：

你应该会看到现在有两个文件夹已连接。第一个是你的项目文件夹。它具有你刚刚创建的项目相同的名称。第二个文件夹是你刚刚添加的连接。如果你展开 ArcGISProCookbook 文件夹连接，你会看到里面的所有其他文件夹。将连接添加到该文件夹允许你访问和使用该项目内部任何这些文件夹中的数据。现在你将连接到几个你将在本菜谱和未来的菜谱中需要的数据库。

1.  在目录窗格中右键单击数据库文件夹并选择添加数据库。

1.  点击位于选择现有地理数据库窗口左侧面板中的“项目”下的“文件夹”。你可能需要展开项目文件夹才能看到它。

1.  双击 ArcGISProCookbook 文件夹。

1.  滚动并双击数据库文件夹。

1.  选择 AthensQuarry.gdb 并点击确定。

你刚刚添加了连接到本菜谱中将使用的数据库。但由于你将使用此项目在本章的其他菜谱中，你将连接到稍后需要的 Trippville_GIS.gdb 地理数据库。

1.  重复相同的步骤将 Trippville_GIS.gdb 地理数据库添加到项目中。唯一的区别是你需要在点击确定之前选择 Trippville_GIS.gdb。

1.  右键单击 Local_Scene.gdb 数据库并点击移除。你将不会使用那个数据库，所以移除它可以清理项目。

1.  保存你的项目。

因此，您已将所需的数据库和文件夹连接添加到项目中。现在您已准备好开始配置您的3D场景。您首先需要为场景配置一些属性。

1.  在内容面板中，右键单击场景，并从出现的菜单中选择属性。

1.  在常规选项卡中，将场景重命名为`Quarry Project`。

1.  使用下拉箭头将显示单位设置为美国英尺。该项目位于美国东南部的乔治亚州。

1.  将高程单位设置为相同的值。

1.  在窗口的左侧面板中点击高程表面。

1.  展开窗口底部附近的位置的“高程源”选项。您应该会看到列出的WorldElevation3D/Terrain3D网络服务。这是用于新场景的默认表面。

1.  添加您自己的本地高程源，其精度高于Esri提供的源。点击添加高程源按钮。

1.  在添加高程源窗口的左侧面板中，点击数据库文件夹。

1.  在右侧面板中双击AthensQuarry.gdb地理数据库。

1.  选择quarry_dem并点击确定。这是一个由您在该项目中工作的公司测量员创建的数字高程模型。它基于项目现场的实地测量数据。

    您现在应该为该项目列出两个高程源。您也可能看到一个警告，告诉您应用了基准转换。这是正常的，因为您的DEM和Esri网络服务使用了两个不同的坐标系统和基准。如果您想了解更多信息，可以点击属性中的转换页面。

    一个场景拥有多个高程源并不罕见。这取决于项目和本地高程源覆盖的区域。ArcGIS Pro将重叠的高程源处理得就像内容面板中的图层一样。如果有两个或更多源重叠，它将使用覆盖相关区域的顶层。在这种情况下，它将使用您刚刚添加的本地DEM，直到达到DEM结束的空间边缘。然后它将使用Esri地形模型作为源。

1.  在左侧面板中点击坐标系统。工程师希望所有内容都在本地州平面坐标系中，因为测量数据就是在这个坐标系中收集的。

1.  点击添加坐标系统按钮，并选择如图所示的导入坐标系统：

![图片](img/47ca4b86-cb73-4f8e-ad36-ff90aa1e7eb9.png)

1.  在导入坐标系统时，从右侧面板中选择quarry_DEM。如果您看不到它，您需要导航到位于数据库项目文件夹中的AthensQuarry.gdb地理数据库。选择quarry_DEM后，点击确定。

1.  您可能会收到有关导入坐标系统的警告。如果有，请忽略它。现在您应该已经分配了当前XY和当前Z坐标系统，如图所示。如果您想将这些更改应用到场景属性中，请点击确定：

![图片](img/e2576e1f-f009-46cf-9659-3f0ea0947033.png)

您的场景将发生变化，地球看起来将呈椭圆形。这是因为您已经为地图分配了一个本地坐标系，该坐标系旨在尽可能在项目区域内保留数据。现在您将向场景添加图层。

1.  保存您的项目。

1.  点击图层组中的地图选项卡上的添加数据按钮。

1.  双击数据库文件夹，然后选择AthensQuarry.gdb。

1.  选择Bldg、HydroLine、HydroPoly和Parcels要素类。在选择了要素类后，点击确定。

在选择时按住*Ctrl*键，这将允许您选择多个要素类。

您添加的新图层应作为2D图层出现在您的地图中。您需要调整图层的绘制顺序和符号。

1.  在内容面板中，选择并拖动Lakes图层，使其位于Parcels之上。

1.  选择并拖动Bldg图层，使其位于Parcels图层之上。它可以是Lakes图层之上或之下。

所有图层现在都应可见于您的地图中。没有任何图层应隐藏在其他图层后面。现在，让我们来处理符号。

1.  点击位于Streams图层名称下方的符号修补块。这应该会打开符号面板。

1.  确保您正在查看图库，点击面板顶部的图库选项卡。选择预定义的水（线）符号。

1.  点击位于Lakes图层名称下方的符号修补块。然后在符号面板中选择预定义的水（区域）符号。

1.  点击Bldg图层名称下方的符号修补块。然后选择预定义的建筑足迹符号。如果您看到多个，请选择您想要使用的任何一个。

1.  点击位于Parcels图层名称下方的符号修补块。选择预定义的黑色轮廓符号。

1.  关闭符号面板。

    您的场景现在应该看起来像以下图形。到目前为止，您已经创建了一个包含3D场景的新项目。然后您配置了源高程，即场景的地面，使用的是本地数字高程模型。最后，您向场景中添加了几个图层。这些图层现在都显示为2D图层，这意味着它们只是覆盖了您指定的作为高程源的地形数据：

![图片](img/157b5c3a-4be1-4450-bd6e-7898caa36d63.png)

现在是时候将一个2D图层转换为3D图层了。这相当容易做到。

1.  在内容面板中选择Bldg图层。

1.  将其拖放到列表中的3D图层上。当您的鼠标指针位于其上时，3D图层将高亮显示蓝色。这是释放鼠标按钮的指示。现在Bldg图层应出现在3D图层下，表示它现在是一个3D图层。这意味着您将能够在场景中以3D对象的形式显示建筑物。

1.  在挤出组中，点击位于类型下方的下拉箭头。选择最小高度，如以下截图所示：

![图片](img/83cfba5a-ad7e-4f2f-b4ad-3c99be32116a.png)

1.  在类型选项旁边的单元格中，点击下拉箭头并从列表中选择[Est_HGT]，如图所示。这是Bldg层属性表中的一个字段：

![](img/a311c93b-a814-430d-8926-a261910a81dd.png)

你刚刚根据属性表中每个建筑的估计高度字段，在Bldg层中拉伸了建筑。让我们看看你工作的结果，以便你可以看到建筑确实是3D的。

1.  将鼠标指针放在场景的南部；南部任何地方都可以。

1.  按住鼠标中央的滚轮。在按住它的同时，将鼠标从你面前推开。这应该会绕着 *z* 轴旋转场景。旋转直到你可以开始看到地面以上的建筑高度和二维层。然后释放滚轮。

1.  滚动滚轮以便更近地放大，这样你可以看到建筑并验证它们是否显示在地面和二维层之上。

你的场景应该看起来类似于以下截图。你的可能略有不同，这取决于你沿Z轴旋转场景的程度以及你缩放的程度：

![](img/7d4e65f9-e6af-4f59-a364-fcbe4163be89.png)

1.  在功能区点击地图标签。然后点击图层组中的下拉箭头。从提供的列表中选择影像底图。这提供了更真实的3D视图，用于查看采石场项目区域。

如果你看不到影像底图，可能是因为你没有连接到ArcGIS Online，或者连接到了你的组织门户的ArcGIS。如果可能，使用您的登录详情连接到ArcGIS Online。如果您无法连接，请跳到 *步骤57*。

1.  保存你的项目。

1.  继续在场景中导航。尝试放大和缩小、平移以及沿所有轴旋转。确保检查采石场周围的区域。你应该能够详细看到所有的岩石堆和采石坑本身，如图所示：

![](img/d727bd1e-7bcb-4c67-a01b-f12dcef3af65.png)

如果你使用的是笔记本电脑上的轨迹球或触摸板，你还可以使用位于左下角的指南针在场景中导航。只需用指针点击环形即可平移视图。如果你点击指南针左上角的箭头，你可以访问更多控件。

1.  当你完成场景探索后，在内容窗格中右键点击Bldg层并选择缩放到图层。

1.  保存你的项目并关闭ArcGIS Pro。

您刚刚使用ArcGIS Pro中的核心功能创建了一个非常基本的3D场景。您所做的一切可以在ArcGIS Pro的所有许可级别上完成，并且不需要任何扩展。如果您想了解更多关于在ArcGIS Pro中创建3D场景的信息，您可能想查看Tripp Corbin，GISP所著的《Learning ArcGIS Pro》中的第5章“创建3D地图”，以及作者在YouTube上关于使用ArcGIS Pro创建3D地图的视频：[https://www.youtube.com/watch?v=CRWE-CXO58s&t=58s](https://www.youtube.com/watch?v=CRWE-CXO58s&t=58s)。

# 启用您的数据存储Z坐标（高程）

在第2章“创建和存储数据”中，我们了解到矢量数据、点、线和多边形使用特征的位置X和Y坐标来存储数据。这确定了它们的位置，然后显示在地图上。我们在第6章“投影和坐标系统基础”中进一步探讨了这一点，我们了解到这些X和Y坐标是指特定、现实世界的坐标系统中的位置，将我们的数据与地球联系起来。这使得我们可以将来自世界各地的数据带入我们的地图中，以便我们可以看到它们的空间关系。ArcGIS Pro会自动将不同坐标系统中的数据投影到一起，以便它们可以一起显示。然而，这仅代表二维。

您能在ArcGIS Pro中启用数据以存储Z坐标，即第三维度吗？当然可以。您通常在首次创建要素类或shapefile时这样做。某些格式，如AutoCAD DWG和DXF文件，始终启用Z坐标。ArcGIS Pro的3D Analyst扩展也包含允许您将现有2D数据转换为3D Z坐标启用数据的工具。

在这个菜谱中，您将继续使用在上一个菜谱中使用的采石场项目的数据。工程师现在关心附近的机场。他需要看到跑道与采石场的关系，可能还需要对采石场到这些跑道的径流进行计算。他已经获取了一个包含机场跑道、滑行道和停车区的shapefile。然而，它们没有启用Z坐标。您将在`Athens_Quarry`地理数据库中创建一个新的Z坐标启用的要素类。然后，您将从中导入shapefile中的数据。最后，您将根据在先前的菜谱中选定的作为地面高程的数字高程模型计算要素的高程。

# 准备工作

这个菜谱需要将样本数据安装在计算机上。您必须在开始这个菜谱之前完成先前的菜谱。您还需要拥有3D Analyst扩展才能完成这个菜谱。

要确定您是否有权访问3D Analyst扩展，请打开ArcGIS Pro。然后，打开您之前打开的任何项目。在功能区中点击项目选项卡。点击项目面板左侧的许可选项。这将告诉您您目前有权访问的许可级别和扩展，如图所示：

![图片](img/ab5e6509-9ad3-4d23-9f37-0181fa2c4c76.png)

如果您没有访问3D Analyst扩展的权限，首先联系您的管理员，看看他们是否能为您提供。如果您没有此扩展的许可证，您可以从Esri请求试用许可证，网址为[https://www.esri.com/arcgis/trial](https://www.esri.com/arcgis/trial)。

只要您有3D Analyst扩展，本菜谱可以用ArcGIS Pro的任何许可级别完成。

# 如何操作...

1.  启动ArcGIS Pro并打开您在上一菜谱中创建的`3D Analyst`项目。它应该出现在您最近打开的项目列表中。

1.  确保您在上一菜谱中创建的QuarryProject场景已打开。如果没有，请从目录面板中通过右键单击并选择打开本地视图来打开它。

1.  在目录面板中，展开数据库文件夹。右键单击AthensQuarry.gdb地理数据库。然后，转到新建和要素类，如图所示。这将在地理处理面板中打开创建新要素类地理处理工具：

![图片](img/fb736aa8-de58-4c3c-b6c9-ef4aef0c6a09.png)

1.  要素类位置应自动设置，因为您在创建新要素类时右键单击了地理数据库。在要素类名称中输入`Airport_Runways`。

1.  验证几何类型是否设置为多边形。如果不是，请使用下拉箭头选择它。

1.  对于模板要素类，点击单元格最右侧的浏览按钮。它看起来像是一个带有黑色加号的黄色文件夹。

1.  点击左侧面板中项目下的文件夹文件夹。

1.  双击窗口右侧面板中出现的3DAnalyst文件夹。

1.  您现在应该在这个文件夹中看到至少两个地理数据库和两个shapefile。选择Airport.shp并点击确定。

1.  使用下拉箭头将“有M”设置为否。

1.  确保“有Z”设置为是。如果不是，请使用下拉箭头设置它。

1.  点击位于坐标系右侧的线框地球仪。这将打开坐标系窗口，以便您可以设置新要素类将使用水平和（XY）以及垂直（Z）坐标系。

1.  点击位于“可用的XY坐标系”右侧带有绿色加号的线框地球仪，选择导入坐标系，如图所示：

![图片](img/55f807b3-c7ef-47d6-9219-c341b756f0ee.png)

1.  在导入坐标系窗口的左侧面板中，选择项目下的数据库文件夹。

1.  双击窗口右侧面板中的AthensQuarry.gdb地理数据库。

1.  选择quarry_DEM并点击“确定”。你可能收到关于导入坐标系统的警告。如果有，请忽略它。

1.  你的当前XY现在应设置为NAD_1983_StatePlane_Georgia_West_FIPS_1002_Feet水平坐标系，当前Z设置为NAVD88_height_(ftUS)垂直坐标系。如果是这样，请点击“确定”。

1.  确认你的“创建要素类”工具看起来如下，然后点击“运行”：

![图片](img/b31b21be-9e48-4ac1-99cd-cb124a499281.png)

当工具完成后，应该在新QuarryProject场景中出现一个新图层。这个新图层引用了你刚刚创建的新要素类。这个新要素类不仅会存储它包含的所有要素的X和Y坐标，而且还会允许你存储Z坐标。由于这是一个全新的要素类，它目前是空的。你接下来将导入你在创建新要素类时用作模板要素类的形状文件中的要素。你将使用追加工具来完成此操作。

1.  在地理处理面板中，点击位于左上角的“后退”按钮。这将带你回到你的收藏夹、工具箱或门户。

如果你完成创建新要素类工具后关闭了地理处理面板，你可以通过转到功能区中的“分析”标签并点击地理处理组中的“工具”按钮轻松重新打开它。

1.  在地理处理面板顶部点击“工具箱”标签。

1.  滚动工具箱列表到数据管理工具箱，并展开它，以便你可以看到其内容。

1.  展开通用工具集。注意该工具集中包含的各种工具。

1.  点击“追加”工具打开它。

1.  对于输入数据集，点击右侧的“浏览”按钮。

1.  在输入数据集窗口的左侧面板中，选择“项目”下的“文件夹”。

1.  双击3DAnalyst文件夹。

1.  选择Airport.shp形状文件并点击“确定”。这将设置你想要添加或导入到目标数据集中的数据集。

1.  使用下拉箭头将目标数据集设置为Airport_Runways。

你必须使用“浏览”按钮来设置输入数据集，因为Airport.shp形状文件尚未成为你地图中的一个图层。下拉箭头仅列出包含在活动地图或场景中的现有图层或表。

1.  由于你使用了形状文件作为新Airport_Runways要素类的模板，你应该能够将模式类型设置为“输入模式必须与目标模式匹配”。输入和目标模式应该是相同的。

1.  由于Airport_Runways要素类不包含子类型，你可以将该参数留空。确认你的“追加”工具看起来如下，然后点击“运行”：

![图片](img/1c9489c9-37fa-410e-b20a-370ef7746c6a.png)

对于那些过去可能使用过ArcMap的人来说，你可能使用过简单数据加载器或加载对象工具来完成此任务。ArcGIS Pro 2.1及更早版本不包括该功能。作者不确定Esri是否会将这些工具添加到ArcGIS Pro中。

当追加工具完成时，它将从shapefile复制特征到机场跑道要素类。你将看不到它们，因为它们的Z坐标目前仍然设置为`0`，因为shapefile是一个2D形状文件。接下来，你需要为与新的要素类中的特征相关联的每个顶点计算一个Z坐标。

你将使用3D Analyst扩展中的一个工具，该工具将根据它相对于你设置为地面表面的DEM的位置来计算顶点的*z*。

1.  点击打开追加工具的地理处理面板中的后退按钮。

1.  点击面板顶部的工具箱选项卡。

1.  展开3D Analyst工具箱，以便你可以看到其内容。

1.  展开3D要素工具集。

1.  滚动工具列表，直到你找到更新特征Z坐标的工具。点击此工具以打开它。此工具将根据输入表面计算特征的Z坐标。

1.  使用下拉箭头将输入特征设置为机场跑道。

1.  点击输入表面的浏览按钮。

1.  在输入表面窗口中，点击位于项目下的左侧面板中的数据库。

1.  在右侧面板中双击AthensQuarry.gdb地理数据库。

1.  在同一面板中选择quarry_DEM，然后点击确定。

1.  ArcGIS Pro将自动确定它认为最好的插值方法。接受ArcGIS Pro确定的那个。

1.  状态字段将被留空。你可以使用此字段来跟踪哪些特征没有更新新的Z坐标值。这通常是因为特征没有与表面重叠。在这种情况下，输入特征图层中的所有特征都与项目区域内的输入表面重叠，因此无需担心。一些跑道特征的部分位于项目区域之外，但这不是问题。

1.  验证你的更新特征Z工具看起来如下，然后点击运行：

![图片](img/68c5c03c-f41d-4cae-9d22-f927c3a701e1.png)

一旦工具完成，你应该开始看到机场跑道的部分图层。它们可能部分被世界影像底图所隐藏。这是因为两者处于相同的高度。无法看到图层上的所有特征并不是一个大问题。你能在之前看不到的地方看到一些特征，这证明了你成功地将Z坐标添加到了图层中的特征。

然而，我们将通过使用另一个工具来进一步验证工具的成功，该工具将添加和计算基于特征3D特性的几个属性字段。这是包含在3D Analyst扩展中的添加Z信息工具。

1.  保存你的项目。

1.  在包含你刚刚使用的更新要素Z工具的地理处理面板中，点击后退按钮。

1.  如果需要，请点击地理处理面板中的工具箱选项卡。

1.  展开三维分析师工具箱以查看其内容。

1.  展开三维要素工具集。然后点击添加Z信息工具以打开它。

1.  使用下拉箭头将输入要素设置为Airport_Runways。

1.  在输出属性选项下，选择以下内容：

+   +   最低Z

    +   最高Z

    +   平均Z

    +   平均坡度

1.  验证你的添加Z信息工具看起来如下，然后点击运行：

![](img/68c5c03c-f41d-4cae-9d22-f927c3a701e1.png)

在添加Z信息工具中检查的属性字段现在应添加到Airport_Runways的属性表中，并带有相应的值。现在，为了验证工具是否工作。

1.  关闭地理处理面板。

1.  右键单击Airport_Runways图层，从出现的菜单中选择属性表。然后回答以下问题。

**问题**：添加Z信息工具添加了哪些字段到属性表中？

**答案**：

**问题**：更新要素Z工具是否工作？

**答案**：

**问题**：你如何判断它是否工作？

**答案**：

希望你能识别出添加到Airport_Runways图层属性表中的四个字段。这些对应于你在工具中选择的选项。这些新添加字段中存储的值允许你看到更新要素Z工具是成功的，除了两个超出项目区域的要素。

1.  保存你的项目并关闭ArcGIS Pro。

你刚刚创建了一个新的Z启用要素类，并将来自2D形状文件的数据导入其中。然后你使用了更新要素Z坐标工具来计算新创建的要素类中所有顶点的Z坐标。接着你使用了添加Z信息工具来验证Z坐标是否已成功添加。

# 从2D创建多面体要素

在本章的食谱中工作，你已经学会了如何在3D中显示2D数据以及如何创建基本的Z启用图层。所有这些在3D中工作的方法都为ArcGIS Pro中的显示和分析能力打开了大门。然而，它们仍然都有局限性。将2D数据拉伸以在3D中显示确实允许我们以三维形式看到这些要素及其与其他要素的关系，但我们无法轻松地计算体积或定位拉伸要素中的垂直位置。将Z坐标添加到点、线或多边形中允许我们将它们放置在正确的空间中，但它们仍然只形成一个单一平面。我们需要什么来创建一个实体形状（即有体积的东西）？ArcGIS Pro支持一种更高级的3D数据格式，允许这样做。它被称为**多面体**。

多面体是一个真正的 3D 对象。它使用一系列在 3D 环境中绘制的平面或多边形构建。它们连接在一起形成一个 3D 要素。构成要素的平面或多边形也称为**补片**。因此，术语多面体。ArcGIS Pro 不是唯一允许显示和创建多面体要素的应用程序。大多数**计算机辅助设计和绘图**（**CADD**）软件也可以用来创建多面体要素。由于多面体要素的复杂性，你通常可以显示比简单挤出更多的细节。多面体要素类还增加了你可以从 3D Analyst 扩展中使用的分析工具的数量，用于计算视线等。

Trippville 市的城市规划师希望将视线要求纳入城市的发展法规中。他希望查看新建筑是否会不利于现有建筑对城市中关键元素（如公园和河流）的视线。许多这类计算需要使用多面体要素。在本例中，你将把建筑轮廓从挤出建筑转换为新的多面体要素类。

# 准备工作

要完成此配方，你需要访问 ArcGIS Pro 的 3D Analyst 扩展。在继续之前，你需要完成本章中的其他配方，并确保样本数据已安装。此配方可以使用 ArcGIS Pro 的所有许可级别完成。

# 如何操作...

1.  启动 ArcGIS Pro 并打开本章前面示例中使用的 `3DAnalyst.aprx` 项目。该项目应包含在你的最近打开的项目列表中。

1.  在目录窗格中，右键单击地图文件夹并选择新建场景。

1.  应在视图区域打开一个新的场景。除非你已更改默认选项，否则新场景将在全局视图中显示。由于你正在处理一个单一的小城市，你需要将其更改为本地视图。点击功能区中的视图选项卡。

1.  点击位于视图组中的本地按钮。这将使你的场景变为本地视图，如下面的截图所示：

![图片](img/136d9eb3-c7dd-48e5-a9c7-54215b6bded1.png)

场景可以是全局的或本地的。全局场景用于大范围 3D 地图，其中地球曲率可能会影响数据的显示和分析。本地场景适用于较小的区域，如城市、镇或县。在这些情况下，由于 3D 地图的规模，地球曲率的影响较小。本地场景通常使用投影坐标系，而全局场景使用地理坐标系。有关全局和本地场景的更多信息，请访问 [http://pro.arcgis.com/en/pro-app/help/mapping/map-authoring/scenes.htm](http://pro.arcgis.com/en/pro-app/help/mapping/map-authoring/scenes.htm)。

1.  设置高程源，这将作为此新场景的表面。在内容窗格中右键单击场景并从出现的菜单中选择属性。

1.  在地图属性窗口的左侧面板中点击“高程表面”。

1.  在窗口右侧面板的中间展开“高程源”选项。

1.  点击“添加高程源”按钮。

1.  在“添加高程源”窗口的左侧面板中点击数据库文件夹。

1.  在右侧面板中双击Trippville_GIS.gdb地理数据库。

1.  选择DEM并点击确定将其分配为高程源。你可能收到一个警告，说明应用了基准转换。这是因为DEM和Esri默认地形表面使用不同的水平和垂直基准。

1.  你现在将移除Esri Terrain作为高程源，因为它不再需要。点击此处所示位于Esri WorldElevation3D服务右侧的小红色X。

![图片](img/b06cd007-68e1-4a87-a835-98eda5dd020b.png)

1.  使用下拉箭头将表面颜色设置为无颜色。这将允许你看到表面下的图层。

1.  设置场景的坐标系统。在地图属性窗口的左侧面板中点击“坐标系统”选项。

1.  点击窗口右侧看起来像一个小线框地球仪并带有绿色加号符号的“添加坐标系统”按钮。

1.  从出现的菜单中选择导入坐标系统。

1.  在窗口的右侧面板中选择DEM并点击确定。如果你没有看到DEM列出来，使用你学到的技能导航到项目中的Trippville_GIS地理数据库。你可能还会看到关于导入坐标系统的警告。如果有，请忽略它。

1.  在窗口的左侧面板中点击“常规”选项。

1.  将场景命名为Trippville Buildings。

1.  使用下拉箭头将高程单位设置为美国英尺并点击确定。

点击确定后，你的地图视图现在可能看起来是空的。如果你看到这种情况，请不要担心，这是正常的。当你添加图层时，你将在视图中看到基础地图和新增的图层。

新的场景已经准备好开始添加图层。现在你将为新场景添加几个图层。

1.  保存你的项目。

提醒一下，你应该经常保存你的项目，因为ArcGIS Pro没有为项目提供自动保存选项。与3D场景一起工作需要比2D地图更多的资源。这使得它们更容易崩溃和失败。为了在你遇到这种情况时能够快速恢复，每次你对项目进行重大更改时，例如添加和配置新场景，都要保存你的项目。

1.  在功能区地图选项卡上的图层组中点击“添加数据”按钮。

1.  在“项目”下的“添加数据”窗口的左侧面板中点击数据库文件夹。

1.  在右侧面板中双击Trippville_GIS地理数据库。

1.  双击基础要素数据集。

1.  选择建筑物和地块要素类。按住*Ctrl*键选择两者。选择后点击确定。

这两个图层已作为二维图层添加到你的场景中。如果你的地图视图是空的，现在应该显示你刚刚添加的两个图层以及你的底图。现在我们将调整这两个图层的符号。

1.  在内容窗格中点击位于“地块层”名称下方的小符号块。

1.  在出现的符号面板中，确保你正在查看图库。图库包含预配置的符号。向下滚动，直到找到黑色轮廓（1pt）符号并选择它。

1.  在内容窗格中点击位于“建筑层”下方的小符号块。

1.  在符号列表中向下滚动，直到找到类别3中的深灰色建筑足迹符号。为你的建筑层选择该符号。

如果你将鼠标指针悬停在符号面板中的符号上，你会看到有关该符号的信息，包括其名称、存储的样式和其类别。符号面板顶部还有一个搜索功能，你可以使用它根据关键词定位预定义的符号。例如，你可以搜索“建筑”，它将返回所有与建筑相关的符号，包括你正在寻找的那个。

1.  关闭符号面板。

1.  在内容窗格中右键点击“建筑层”，然后选择“缩放到图层”。现在你的场景应该看起来非常类似于以下截图。比例可能因你的显示器大小和分辨率而异：

![图片](img/8b73c1ad-8b52-40f0-ae5a-de4b8a69cd83.png)

1.  将“建筑层”从二维图层拖放到三维图层。

1.  保存你的项目。

1.  在功能区点击“外观”标签。

1.  在拉伸组中点击“类型”下方的下拉箭头。从显示的列表中选择最大高度。

1.  确保单位设置为美国英尺。

1.  在类型按钮右侧的拉伸表达式单元格中，点击下拉箭头并从列表中选择[Est_HGT]字段。这将根据存储在图层属性表中的估计高度拉伸建筑。

1.  使用本章第一道菜谱中学到的技能，*创建3D地图*，放大市中心区域并旋转场景，使其看起来类似于以下截图：

![图片](img/d75a2502-53eb-4cb1-8fdf-f64a991bd6b5.png)

现在，你可以看到建筑被拉伸到它们的估计高度。虽然它们看起来是3D的，但它们仍然是沿着*z*轴人工扩展的二维特征，以看起来像是3D。现在你将它们转换为3D Multipatch特征。

1.  在功能区点击“分析”标签。

1.  点击地理处理组中的“工具”按钮以打开地理处理窗格。

1.  在地理处理窗格中点击工具箱标签。

1.  展开三维分析师工具箱。

1.  展开转换工具集并选择“图层3D到要素类”工具。

1.  使用下拉箭头将输入要素层设置为“建筑”。

1.  点击输出要素类的浏览按钮。

1.  在输出要素类窗口的左侧面板中，点击项目下的数据库文件夹。双击 Trippville_GIS 地理数据库。

1.  将名称设置为 Buildings_MP。点击保存。

1.  确认你的 Layer 3D to Feature Class 工具看起来如下，然后点击运行：

![图片](img/b92ac3b6-359d-4669-aa6d-6cbb3bc67332.png)

1.  关闭 Buildings 图层以确认你的转换是否成功。你应该仍然在地图上看到 3D 建筑物。这些就是你刚刚创建的 multipatch 特征。

1.  右键点击 Buildings_MP 图层并选择属性表。然后回答以下问题。

**问题**：你刚刚创建的图层的形状是什么？

**答案**:

如你所见，新图层是一个 Multipatch 形状。它不再是多边形。现在让我们看看 multipatch 允许你拥有的增强功能的一个例子。我们将使用你已熟悉的工具，Add Z Information。

1.  关闭 Buildings_MP 图层的属性表。

1.  在 3D Analyst 工具和 3D 特征工具集中打开 Add Z Information 工具，使用你已学到的技能。

1.  将输入要素设置为 Buildings_MP 图层。然后查看可用的输出属性选项。

1.  现在将输入要素设置为 Buildings 图层，并注意此图层可用的输出属性选项。

1.  回答以下问题：

**问题**：当它们被设置为输入要素时，两个图层之间的区别是什么？

**答案**：

当你将 Buildings_MP 作为 Add Z Information 工具的输入要素时，你会看到许多输出选项。你可以让工具计算每座建筑的体积、总面积等等。当你将 Buildings 图层作为输入时，你会看到没有选项。这是因为尽管该层在 3D 中显示，但它不是一个真正的 3D 层。因此，该工具不会与它一起工作。

1.  如果你愿意，可以使用 Buildings_MP 图层作为输入并选择你想要的任何输出属性选项来运行 Add Z Information 工具，以便查看结果。如果你这样做，当它完成时关闭地理处理面板。如果你不想尝试这一步，只需关闭地理处理面板。

1.  保存你的项目并关闭 ArcGIS Pro。

# 创建 3D 特征

到目前为止，你已经学会了如何从现有的 2D 特征创建 3D 特征。你学到的第一种方法是创建一个新的 Z 启用要素类，并将现有的 2D 特征导入其中。然后，根据高程表面更新 Z 坐标。接下来，你学习了如何将拉伸特征转换为新的 multipatch 要素类。那么，你是如何从头开始创建新的 3D 特征的呢？

就像在 ArcGIS Pro 中的大多数事情一样，你可以使用几种方法。你可以在 2D 地图或 3D 场景中创建新的 3D 特征。然后，你可以指定特定的 Z 坐标，或者让它们自动继承地面表面高程。

在本食谱中，您将创建一些新的3D要素。这些是基于Trippville市规划局长的请求。对于第一个，他希望充实城市的3D视图，因此包括栅栏。因此，您将开始数字化栅栏。您将从2D地图开始，然后移动到3D场景。接下来，局长关注一个新提议的建筑的建设。他相信这将阻挡从现有建筑到城市主要公园的视线。因此，他需要您建立一些观察点，您将在后面的食谱中使用这些观察点来建立视线并确定可见性。

# 准备工作

在开始本节之前，您必须完成本章中的其他食谱。这将确保您拥有完成此项目所需的工程、地图、场景和数据。这还将确认您对如何访问所需的工具以及完成此食谱所需的基本概念有良好的基础理解。

在继续之前，您还需要确保已安装示例数据。

# 如何操作...

1.  启动ArcGIS Pro并打开本章之前使用的`3DAnalyst.aprx`项目。此项目应包含在您最近打开的项目列表中。

1.  添加包含所需层的一个现有2D地图。在项目面板中右键单击地图文件夹，并从菜单中选择导入。

1.  在导入窗口中，展开左侧面板中的计算机文件夹。

1.  选择可能标记为OS或本地驱动器的`C:`驱动器。

1.  在右侧面板中滚动到学生文件夹，并双击它。

1.  在右侧面板中双击ArcGISProCookbook文件夹。

1.  滚动并双击Chapter10文件夹。

1.  选择Trippville_2Dd_Map.mapx文件并点击确定。这是一个地图文件。导入此文件将在您的项目中创建一个新的2D地图。

应该会向您的项目中添加一个新的2D地图。现在您应该在ArcGIS Pro界面的地图视图区域中看到这个新地图，如下面的截图所示：

![图片](img/1952bbb4-f354-4102-85bc-e1fe214e2360.png)

在您可以在2D地图中编辑3D数据之前，您需要确保它已分配了高程表面。接下来，您将确保新的2D地图使用Trippville市的DEM。

1.  保存您的项目。

1.  在内容面板顶部右键单击Trippville地图。

1.  从出现的菜单中选择属性。

1.  从地图属性窗口的左侧面板中选择高程表面选项。

1.  展开高程源选项。

1.  点击添加高程源按钮。

1.  在添加高程源窗口的左侧面板中点击数据库文件夹。

1.  在窗口的右侧面板中双击Trippville_GIS地理数据库。

1.  选择DEM并点击确定。

1.  确认您的地图属性窗口看起来如下面的截图所示，然后点击确定：

![图片](img/9dd9875b-79e6-4d41-b916-ff5c482c2f77.png)

1.  保存您的项目。

您已经准备好了二维地图，因此它允许您通过确保分配给它一个高程表面来编辑三维数据。有时在二维地图中编辑三维数据更容易，因为您更熟悉那些工具。现在，要数字化一个围栏。

1.  点击功能区中的“地图”标签以激活它。

1.  点击图层组中的书签按钮并选择“围栏1”书签。这将您缩放到您将数字化两个围栏的区域。

1.  放大以下截图所示的包裹区域。放大到你需要看到后院围栏的程度：

**![](img/1bf3d0a6-3ac2-4a84-a641-286d7e6c5d01.png)**

1.  点击内容面板顶部的“按编辑列表”按钮。它类似于一支铅笔。

1.  确保围栏层已启用编辑。

1.  在功能区中点击“编辑”标签。

1.  由于围栏层是Z启用的，您需要告诉ArcGIS Pro在您绘制新围栏时Z坐标将从哪里来。您需要配置Z模式来完成此操作。点击位于Z模式按钮下的小箭头。

1.  从出现的菜单中选择“表面”。这应该在按钮右下方的单元格中显示“地面”。这意味着每个顶点的Z值将基于您点击的地面表面高程来确定。

选择“常量”允许您手动输入一个将应用于您创建的所有新Z启用要素的常量Z值。

1.  在“编辑”标签的“要素”组中点击“创建”按钮。这将打开“创建要素”面板。

1.  在“创建要素”面板中选择围栏要素模板。

1.  通过点击以下截图所示的地点来数字化围栏：

**![](img/afb37d6d-5564-4183-84eb-67219a622aee.png)**

1.  点击位于“编辑”标签的“选择”组中的“属性”按钮。这将打开属性面板。您需要设置围栏的高度。

1.  在“高度”单元格中输入`6`并按*Enter*键，以显示这是一个6英尺高的围栏。

1.  点击属性面板中的“几何”选项卡并查看值。现在回答以下问题。

问题：当您只是在地图中点击一个二维位置时，Z值是如何被填充的？

答案：

如您所见，尽管您在二维地图中创建Z启用围栏要素，但ArcGIS Pro仍然能够确定Z坐标以及X和Y的值。它是通过比较您点击的位置与地面表面并插值该位置的Z值来做到这一点的。

1.  关闭属性面板。

1.  在“编辑”标签的“管理编辑”组中点击“保存”按钮以保存您的编辑。当被问及保存所有编辑时，点击是。

1.  点击“选择”组中的“清除”按钮以取消选择您刚刚创建的新围栏。

1.  点击您在之前的菜谱中使用的Trippville Buildings场景。它应该在视图区域的顶部。

如果您关闭了Trippville Buildings场景，您可以从项目面板重新打开它。只需在项目面板中找到地图文件夹中的场景。然后右键单击并选择打开本地视图。

1.  在功能区中激活地图选项卡。然后点击图层组中的底图按钮并选择影像底图。

1.  在地图选项卡中的图层组中点击添加数据按钮。

1.  点击位于`计算机`下的`C:`驱动器。然后导航到`C:\Student\ArcGISProCookbook\Chapter10`文件夹。

1.  选择`Fence_3D`图层文件，然后点击确定。栅栏层应该已经配置好符号并出现在您的场景中。

1.  点击书签按钮，然后选择Fences 1书签。这将使您缩放到与您在2D地图中刚刚工作的相同区域。

1.  点击探索工具并放大，直到您看到位于您刚刚绘制的栅栏包裹地块西北方向的带有游泳池的房屋。

1.  将视图放大到带有游泳池的房屋，直到您的视图看起来与以下截图相似：

**![](img/14b5a64c-0dac-43d3-b991-731a00780d4e.png)**

1.  在功能区中点击编辑选项卡。

1.  点击Z模式按钮下方的下拉箭头并查看您的选项。回答以下问题。

问题：在您正在工作的场景中，Z模式有哪些选项可用？

回答：

如您所见，表面选项被灰色显示。这是因为在一个3D场景中，地面表面会自动用于确定任何新特征的Z坐标。在创建场景中的新Z启用特征时，您不需要设置此选项，就像在2D地图中做的那样。

1.  创建要素平面应该仍然是从您在2D地图中创建第一个栅栏时打开的。如果不是，请点击创建按钮以打开它。

1.  选择栅栏要素模板，并在新栅栏中数字化，如图所示：

**![](img/8e284ad9-d9aa-4fe6-ab9b-e6c14456d52b.png)**

完成后，栅栏可能不可见。这是因为它没有高度。它与所有其他非拉伸层一起沿着地面运行。您现在将修复这个问题。

1.  在编辑选项卡的选择组中点击属性按钮。这将打开属性面板。

1.  在高度单元格中输入`8`以使新栅栏的高度显示为八英尺。您现在应该能在场景中看到栅栏。

1.  关闭属性和创建要素面板以释放屏幕空间。

1.  在功能区中的选择组中点击清除按钮。

1.  在管理编辑组中点击保存按钮以保存您刚刚创建的新栅栏。再次，当被问及是否要保存所有编辑时，请点击是。

1.  在功能区中的地图选项卡中激活探索工具。

1.  使用您在前面菜谱中学到的技能，旋转视图，以便您可以看到您刚刚创建的新3D栅栏。它应该看起来与以下图形相似：

**![](img/1b45ddca-0f66-48c6-858a-12d105082380.png)**

你可以看到，你创建的栅栏正在使用起始高程的 Z 坐标和拉伸来显示高度的方式以 3D 形式显示。你已经开始根据规划总监的要求创建和填充新的栅栏图层。然而，他真正想知道的是，那个提议中的新建筑是否会通过阻挡现有建筑的视线而给现有建筑造成问题。

因此，你将继续进行视线分析，其第一部分是从现有建筑中建立观测点。这些必须是 3D 点。你将首先创建一个新的 Z 启用点要素类。然后，你将数字化从规划总监关心的现有建筑中获取的新观测点。在下一个菜谱中，你将完成分析。

1.  在项目面板中，展开数据库文件夹以便查看其内容。

1.  右键点击 Trippville_GIS 地理数据库并选择新建。然后选择要素类，如下截图所示：

![](img/a402bb45-6265-43f8-a9bf-ef8877869f05.png)

1.  将新的要素类命名为 `Observ_PT`。

1.  使用下拉箭头将几何类型设置为点。

1.  由于这是一个全新的要素类，不是基于任何现有的要素类，因此你将不会指定模板要素类。所以，留空。

1.  使用下拉箭头将“有M”设置为否。

1.  如有必要，使用下拉箭头将“有Z”设置为是。

1.  点击坐标系统旁边的线框地球仪来设置新要素类的坐标系统，使其与 Trippville 数据的其余部分匹配。

1.  点击看起来像带有绿色加号的线框地球仪的添加坐标系统按钮，如下所示。选择导入坐标系统：

![](img/a74a9f13-1361-40d7-94cd-102cce00d958.png)

1.  在窗口的右侧面板中双击 Trippville_GIS 地理数据库。

1.  选择 DEM 并点击确定，将坐标系统设置从它导入到你正在创建的新要素类中。

1.  现在应该已经设置了当前 XY 和当前 Z 坐标系统，如下截图所示。如果与你的匹配，请点击确定：

![](img/2ad3f951-12c7-40b2-8e3f-c04338274995.png)

1.  确认你的创建要素类工具看起来如下，然后点击运行：

![](img/5dfab7af-5e80-4b3f-a86f-cd9243d6c2cb.png)

当创建要素类工具完成时，你应该能在内容面板中看到一个新图层出现。这个新图层引用了你刚刚创建的新要素类。现在你需要将一些点数字化到新图层中，这些点代表规划总监关心的观测位置。

1.  关闭包含创建要素类工具的地理处理面板。

1.  保存你的项目。

1.  现在，你需要将视图缩放到提议的建筑位置。你将通过选择提议的建筑然后缩放到它来完成此操作。在地图选项卡中，点击按属性选择按钮。

1.  使用下拉箭头将图层名称或表视图设置为“建筑”，并确保选择类型设置为“新选择”。

1.  点击“添加子句”按钮以构建您的SQL查询。

1.  使用您在先前的菜谱中学到的技能，将字段设置为“建筑状态”，运算符设置为“等于”，并将值设置为“Pr-Proposed”。根据您的ArcGIS Pro版本，您可能只能看到“Proposed”作为显示值。然后点击“添加”。

1.  确认您的“按属性选择层”工具看起来如下，然后点击“运行”：

![图片](img/6f3af91f-fbf1-4610-a43c-3974c2e39117.png)

1.  关闭包含“按属性选择层”工具的地理处理窗格。

1.  在内容窗格中右键单击Buildings层。然后转到“选择”并选择“缩放到选择”，如图所示：

![图片](img/29839127-2769-45e1-87f7-087a04468e1a.png)

场景将缩放到引起所有关注的拟建建筑的位置。您的场景现在应该看起来类似于以下截图。根据您的显示器大小和ArcGIS Pro应用程序的大小，您的可能略有不同：

**![图片](img/2475ae51-b42d-406f-bda8-fcc3f95f9a00.png)**

您仍然可以查询并缩放到已关闭且不可见的图层中的要素。

1.  使用您之前学到的技能，将位于Trippville_GIS地理数据库中的Parks要素类添加到场景中。这将允许您看到位于此建筑东北方向的华盛顿公园的位置。确保选择类型设置为“新选择”。

1.  放大并旋转您正在工作的Trippville Buildings场景，以便您可以看到拟建建筑的周围区域。以下截图所示的效果应该很好。您可能需要将Parks层拖到2D Layers组中才能看到它：

![图片](img/7ad77645-672e-40f2-a7ed-7d4d2ddc2a56.png)

拟建的建筑物是场景中心附近的浅灰色建筑。华盛顿公园是位于拟建建筑东北部的浅绿色区域。现在您需要为拟建建筑直接南边和西边的建筑数字化观测点。

1.  在内容窗格中，点击“按捕捉列表”按钮。确保Buildings_MP层设置为可捕捉。

1.  在内容窗格中点击“按编辑列表”按钮。右键单击Observ_PT层并选择“将此层设为唯一可编辑层”。

1.  在功能区中点击“编辑”标签。

1.  点击“创建”按钮以打开“创建要素”窗格。

1.  确保捕捉已开启，并设置为“边缘”、“顶点”、“端点”和“交点”。

1.  在“创建要素”窗格中选择Observ_PT要素模板。

1.  点击以下截图所示的地点。您可能需要放大以获取确切的位置：

![图片](img/1c7950e2-a5bb-4afc-bdeb-60512c2eca07.png)

1.  在功能区中点击“地图”标签并激活“探索”工具。

1.  旋转您的场景，以便您可以看到您刚刚数字化的新点的位置。它们应该与相关建筑的顶部对齐。

1.  如果它们是，请单击功能区中的“编辑”选项卡。然后单击“保存”按钮以保存您刚刚创建的新点。

1.  关闭创建要素面板。

1.  保存您的项目并关闭ArcGIS Pro。

在这个菜谱中，您创建了几个新的3D特征。您创建了两个新的围栏特征。新围栏从您使用地面作为参考点击的位置继承了Z坐标。然后，您为每个围栏指定了一个高度，然后将其拉伸，以便它们在地面以上显示其真实高度。然后，您创建了一个完全新的Z启用要素类来存储观测点，您将在下一个菜谱中使用这些观测点来分析从这些位置看到华盛顿公园的能力。这些新点的Z坐标由您对齐的建筑的角落确定。

# 计算视线

您已经学习了创建新3D特征的几种方法。现在，您需要调查一些可以使用这些特征进行的分析，这些分析您无法使用2D进行。一个常见的分析是确定视线。它有许多用途。它可以由财产评估员用来确定财产是否有一个良好的视线到一个关键特征，如河流或海洋，这可能会增加其价值。它被警方用来为特殊事件建立安全警戒线。它可能被用来帮助规划游行路线。所以，如您所见，这种分析有许多用途。

在这个菜谱中，您将使用在前一个菜谱中创建的观测点来确定是否可以看到华盛顿公园，或者提议的建筑是否会完全阻挡公园的视线。这将是有助于规划总监决定是否批准新建筑的几个决定性因素之一。这需要使用来自ArcGIS Pro 3D Analyst扩展的几个地理处理工具。

# 准备工作

您必须在开始此菜谱之前完成本章中的其他菜谱。这将确保您拥有完成此项目所需的所需项目、地图、场景和数据。它还将确认您对访问所需工具和完成此菜谱所需的基本概念有良好的基础理解。

您还必须在继续之前确保样本数据已安装，并且可以访问ArcGIS Pro的3D Analyst扩展。

# 如何操作...

1.  启动ArcGIS Pro并打开您在本章前一个菜谱中使用的`3DAnalyst.aprx`项目。该项目应包含在您最近打开的项目列表中。

1.  在功能区中单击“分析”选项卡。然后单击“地理处理”组中的“工具”按钮。

1.  在地理处理面板中单击工具箱选项卡。然后展开3D Analyst工具箱。

1.  滚动到可见性工具集并展开它，以便您可以看到其内容。

1.  选择构建视线工具以打开它。

1.  使用下拉箭头将观测点设置为Observ_PT层。

1.  使用下拉箭头将目标要素设置为Parks层。

1.  对于输出，点击浏览按钮，使用您从先前的菜谱中学到的技能导航到Trippville_GIS地理数据库。将新的输出要素类命名为Park_Sight_Lines，然后点击保存。

1.  确保观察者高度场和目标高度场均设置为Shape.Z。

1.  将采样距离设置为`200`。

1.  确认您的构建视线工具看起来如下，然后点击运行：

![图片](img/2804458a-b90f-42df-b6e8-2ea7a090107d.png)

在场景中会出现一个新层，它代表从观测点到公园的每个可能的视线，使用您在采样距离中指定的间隔。此工具忽略任何可能的障碍物。接下来，您将使用另一个工具来调查您创建的每个视线，以查看它们是否被地面或其他障碍物（如建筑物）阻挡。

1.  在内容面板中，关闭您刚刚创建的Park_Sight_Lines层。您不需要看到该层来用于进一步分析。

关闭您在追求的任何分析过程的最终结果中不需要看到的层，可以提高整体性能并减少地图杂乱。

1.  在包含构建视线工具的地理处理面板中点击后退按钮。这将带您回到工具箱视图。

1.  在3D Analyst工具箱中的可见性工具集中选择视线工具。

1.  点击输入表面的浏览按钮。导航到Trippville_GIS地理数据库并选择DEM。选择DEM后点击确定。

1.  使用下拉箭头将输入线要素设置为Park_Sight_Lines。

1.  使用下拉箭头将输入要素设置为Buildings_MP。

输入要素是一个包含您希望工具考虑的、可能阻挡视线沿视线的附加要素的层。这必须是一个基于多面体要素类的层。

1.  将输出要素类命名为`Buildings_to_Park_LOS`。

1.  您可以将输出障碍点要素类留空。这将创建一个新的点要素类，显示视图被阻挡的确切位置。对于这次分析，我们对此位置不感兴趣。

1.  确认您的视线工具看起来如下，然后点击运行：

![图片](img/c5a8261a-1ed1-4736-b10f-e88ad945038d.png)

当工具完成时，您将看到一个新层被添加，它已识别出哪些视线是可见的，哪些是不可见的，如下面的截图所示。请记住，此工具在确定可见和不可见时，会考虑地面以及建筑物：

![图片](img/f044a1e8-bb6c-446c-b2ca-d4d0cab99a07.png)

您现在可以轻松地看到哪些视线被提议的建筑物阻挡，哪些没有被阻挡。这正是规划总监需要的信息。

1.  关闭您的Geoprocessing面板。

1.  保存您的项目并关闭ArcGIS Pro。

现在您已经完成了您的第一个3D分析，以确定从指定点到现有特征的视线。这要求您拥有ArcGIS Pro的3D Analyst扩展。此外，您必须在能够执行此分析之前创建几个3D图层。这包括创建代表Trippville建筑和观测点的multipatch图层。

您可以在2D地图中执行此相同的分析。ArcGIS Pro仍然可以在2D地图中执行3D分析。然而，当在2D地图中显示时，结果可能不会那么有影响或信息丰富。

# 计算多边形的体积

另一个常见的3D分析任务是计算多边形要素覆盖区域的体积。这是通过将多边形要素叠加到表面之上，然后计算由多边形要素创建的平面与它们叠加的表面之间的体积来完成的。

在本食谱中，您将回到之前工作的采石场项目。项目工程师已经确定了最佳满水位并为您创建了一个多边形图层。他希望您确定填充采石场到这一水平所需的总水量（单位为加仑）。

您将使用3D Analyst扩展中的Polygon Volume工具来完成部分分析。然后，您将使用Calculate Field工具来计算填充采石场所需的总加仑数。

# 准备工作

在开始本节内容之前，您必须完成本章中的其他食谱。这将确保您拥有完成此项目所需的项目、地图、场景和数据。这还将确认您对如何访问所需工具以及完成此食谱所需的基本概念有良好的基础理解。

在继续并访问ArcGIS Pro的3D Analyst扩展之前，您还需要确保样本数据已安装。

# 如何操作...

1.  启动ArcGIS Pro，并打开本章之前食谱中使用的3DAnalyst.aprx项目。该项目应包含在您最近打开的项目列表中。

1.  关闭所有Trippville地图和场景。如果需要，重新打开采石场项目场景。

记住，您可以在目录面板中右键点击地图或场景来打开它。

1.  现在，您需要添加项目工程师创建的Full Pool Layer。在功能区地图选项卡上点击“添加数据”按钮。

1.  导航到`C:\Student\ArcGISProCookbook\Chapter10`文件夹，并选择`Full_Pool_Level.lyrx`图层文件。点击“确定”。应该有一个新的图层被添加到您的场景中，显示采石场填满时的水位，如下面的截图所示：

![图片](img/81571a17-9d69-405c-bc14-e735def0fff8.png)

1.  在功能区点击“分析”选项卡。

1.  在Geoprocessing面板中点击“工具”按钮和“工具箱”选项卡。

1.  展开三维分析工具箱。然后展开三角剖分表面工具集。

1.  点击多边形体积工具以打开它。

1.  点击输入表面的浏览按钮。

1.  在输入表面窗口的左侧面板中展开计算机文件夹。

1.  选择C:\驱动器。然后导航到Student\ArcGISProCookbook\Databases文件夹。

1.  选择quarry_tin并点击确定。

对于此工具，输入表面必须是TIN、LAS或地形数据集。它不接受DEM表面作为输入。

1.  使用下拉箭头将输入要素设置为全池水位。

1.  使用下拉箭头将高度字段设置为Z_Mean。

1.  确保参考平面设置为在平面下方计算。它所指的是由输入要素创建的平面。

1.  接受体积和表面积字段的默认值。

1.  确认您的多边形体积工具看起来如下，然后点击运行：

![图片](img/1b7150cf-597f-4f7a-a78c-3c825f277c17.png)

1.  工具成功完成后，关闭地理处理面板。

    这个特定的工具不会像您使用的许多其他工具那样创建新的要素类或图层。相反，它为输入要素的属性表添加了两个新字段。您现在将检查结果。

1.  右键单击全池水位并选择属性表。你应该看到已添加的两个字段：体积和S面积。

    体积以立方英尺为单位，因为您的图层水平和垂直单位设置为美国英尺。工程师需要知道以美国加仑为单位的体积。您现在将创建一个新字段来包含加仑体积，并使用计算字段工具填充它。

1.  在表视图中，点击添加字段按钮。它位于面板的左上角。

1.  将新字段命名为加仑，然后按*Tab*键移动到数据类型。

1.  使用下拉箭头将数据类型设置为浮点数。这将允许它存储小数值。

1.  确认您的表设计看起来如下，然后点击功能区字段选项卡上的更改组中的保存按钮：

![图片](img/566f78e7-d8bc-45cc-b644-68f5c7f2e168.png)

1.  关闭表的“设计视图”。

您刚刚为全池水位图层属性表添加了一个新字段。这个新字段将用于存储填充采石场所需的加仑数。

1.  右键单击表格视图中刚添加的加仑字段并选择计算字段。计算字段工具将在地理处理面板中打开。

1.  滚动以查看位于“代码块”一词上方空白单元格。您需要在此处输入转换表达式。

1.  在该单元格中输入以下值：`!Volume! * 7.48052`。数字`7.48052`是每立方英尺加仑的转换系数。

1.  确认您的计算字段工具看起来如下，然后点击运行：

![图片](img/18d06e84-cc0d-4687-9518-925bdee2477e.png)

1.  工具成功完成后，关闭地理处理面板。

1.  查看现在已填充到加仑字段中的数字。

1.  关闭全池水位的属性表。

1.  保存您的项目并关闭ArcGIS Pro。

你刚刚计算了一个多边形覆盖区域的体积。这需要你拥有两个数据集。你需要一个高程表面。你使用的多边形体积工具要求表面以TIN、地形或LAS格式存在。另一个你需要的数据集是一个多边形，它构成了用于叠加表面的平面。
