- en: Chapter 3. Finding and Fixing Broken Data Links
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Finding broken data sources in your map document and layer files
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fixing broken data sources with MapDocument.findAndReplaceWorkspacePaths()
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fixing broken data sources with MapDocument.replaceWorkspaces()
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fixing individual layer and table objects with replaceDataSource()
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finding broken data sources in all map documents in a folder
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It is not uncommon for your GIS data sources to move, migrate to a new data
    format, or be deleted. The result can be broken data sources in many map documents
    or layer files. These broken data sources can't be used until they're fixed, which
    can be an overwhelming process if the same changes need to be made across numerous
    map documents. You can automate the process of finding and fixing these data sources
    using `arcpy.mapping`, without ever having to open the affected map documents.
    Finding broken data sources is a simple process requiring the use of the `ListBrokenDataSources()`
    function, which returns a Python list of all broken data sources in a map document
    or layer file. Typically, this function is used as the first step in a script
    that iterates through the list and fixes the data source. Fixing broken data sources
    can be made in an individual data layer or across all layers in a common workspace.
  prefs: []
  type: TYPE_NORMAL
- en: Finding broken data sources in your map document and layer files
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Broken data sources are a very common problem with map document files. You can
    use `arcpy.mapping` to identify data sources that have moved, been deleted, or
    changed in their format.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In ArcMap, a broken data connection is signified by a red exclamation point
    just before the layer name. This is illustrated in the following screenshot. The
    `ListBrokenDataSources()` function in `arcpy.mapping` returns a list of layer
    objects from a map document or layer file that have a broken data connection:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Getting ready](img/B04314_03_1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Follow these steps to learn how to find broken data sources in a map document
    file.
  prefs: []
  type: TYPE_NORMAL
- en: Open `C:\ArcpyBook\Ch3\Crime_BrokenDataLinks.mxd` in ArcMap.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You will see that each of the data sources have been broken. In this case,
    the data has been moved to another folder, but you''d see the same indicator if
    the data had been deleted or migrated to a different format. For example, it is
    not uncommon to convert data from a personal geodatabase to a file geodatabase:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/B04314_03_2.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Close ArcMap.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **IDLE** and create a new script window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the `arcpy.mapping` module:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Reference the `Crime_BrokenDataLinks.mxd` map document file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Get a list of the broken data sources:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Iterate the list and print out the layer names:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The output will be printed as follows:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save your script as `FindFixBrokenData.py` in the `c:\ArcpyBook\Ch3` folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can check your work by examining the `c:\ArcpyBook\code\Ch3\FindFixBrokenData.py`
    solution file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `ListBrokenDataSources()` function returns a Python list of `Layer` objects
    that have a broken data source. We then use a `for` loop to iterate this list
    and perform some sort of action for each layer. In this case, we printed out the
    layer names simply to illustrate the data returned by this function. In a later
    recipe, we'll build on this code by fixing these broken data sources.
  prefs: []
  type: TYPE_NORMAL
- en: There's more…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In addition to returning a list of broken data sources from a map document file,
    the `ListBrokenDataSources()` function can also find broken data sources in a
    (`.lyr`) layer file. Simply pass the path to the layer file to have the function
    examine the file for broken data sources. Keep in mind that these functions are
    not needed with `Map` or `Layer` packages, since the data is bundled with these
    files unlike a layer file.
  prefs: []
  type: TYPE_NORMAL
- en: Fixing broken data sources with MapDocument.findAndReplaceWorkspacePaths()
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The `MapDocument.findAndReplaceWorkspacePaths()` method is used to perform global
    find and replace workspace paths for all the layers and tables in a map document.
    You can also replace the paths to multiple workspace types at once. For example,
    you might pass personal and file geodatabase workspace types at the same time.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We need to cover some definitions before examining the methods used to fix datasets.
    You'll see these terms used frequently when discussing the methods used to fix
    broken data sources, so you'll need to understand what they mean in this context.
    A **workspace** is simply a container for data. This can be a folder (in the case
    of shapefiles), personal geodatabase, file geodatabase, or an ArcSDE connection.
    A workspace provides the system path to the workspace. In the case of file geodatabases,
    this would include the name of the geodatabase. A **dataset** is simply a feature
    class or table within a workspace, and finally, a **data** **source** is the combination
    of the workspace and dataset names. Don't confuse a dataset with a feature dataset.
    The former is just a generic term for data, while the latter is an object within
    a geodatabase that serves as a container for feature classes and other datasets.
  prefs: []
  type: TYPE_NORMAL
- en: There are three `arcpy.mapping` classes involved in fixing broken data sources.
    They are `MapDocument`, `Layer`, and `TableView`. Each class contains methods
    that can be used to fix data sources. In this recipe, we'll examine how you can
    use the `findAndReplaceWorkspacePaths()` method in the `MapDocument` class to
    perform global find and replace operations in the layers and tables of a map document.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to learn how to fix layers and tables in a map document
    using `findAndReplaceWorkspacePaths()`:'
  prefs: []
  type: TYPE_NORMAL
- en: Open `c:\ArcpyBook\Ch3\Crime_BrokenDataLinks.mxd` in ArcMap.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on any of the layers and select **Properties**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Go to the **Source** tab and you will notice that the location for the layer
    is `ArcpyBook\Ch3\Data\OldData\CityOfSanAntonio.gdb`. This is a file geodatabase
    but the location no longer exists. It has moved to the `C:\ArcpyBook\data` folder.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **IDLE** and create a new script window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the `arcpy.mapping` module:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Reference the `Crime_BrokenDataLinks.mxd` map document file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Use `MapDocument.findAndReplaceWorkspacePaths()` to fix the source path for
    each data source in the map document. The `findAndReplaceWorksapcePaths()` method
    accepts the old path as the first parameter and the new path as the second parameter:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save the results to a new `.mxd` file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save the script as `C:\ArcpyBook\Ch3\MapDocumentFindReplaceWorkspacePath.py`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can check your work by examining the `c:\ArcpyBook\code\Ch3\MapDocumentFindReplaceWorkspacePath.py`
    solution file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the script.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In ArcMap, open the `C:\ArcpyBook\Ch3\Crime_DataLinksFixed.mxd` file. You will
    notice that all the data sources get fixed, as shown in the following screenshot:![How
    to do it…](img/B04314_03_3.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `MapDocument.findAndReplaceWorkspacePaths()` method performs global find
    and replace workspace paths for all layers and tables in a map document. You can
    replace the paths for multiple workspace types at once.
  prefs: []
  type: TYPE_NORMAL
- en: There's more…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `Layer` and `TableView` objects also have a `findAndReplaceWorkspacePaths()`
    method that performs the same type of operation. The difference is that this method,
    in the `Layer` and `TableView` objects, is used to fix an individual broken data
    source rather than a global find, along with the replacement of all broken data
    sources in a map document.
  prefs: []
  type: TYPE_NORMAL
- en: Fixing broken data sources with MapDocument.replaceWorkspaces()
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: During the course of normal GIS operations, it is a fairly common practice to
    migrate data from one file type to another. For example, many organizations migrate
    data from older personal geodatabase formats to the new file geodatabase types,
    or perhaps even enterprise ArcSDE geodatabases. You can automate the process of
    updating your datasets to a different format with `MapDocument.replaceWorkspaces()`.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`MapDocument.replaceWorkspaces()` is similar to `MapDocument.findAndReplaceWorkspacePaths()`,
    but it also allows you to switch from one workspace type to another. For example,
    you can switch from a file geodatabase to a personal geodatabase. However, it
    only works in one workspace at a time. In this recipe, we''ll use `MapDocument.replaceWorkspaces()`
    to switch our data source from a file geodatabase to a personal geodatabase.'
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to learn how to fix broken data sources using `MapDocument.replaceWorkspaces()`:'
  prefs: []
  type: TYPE_NORMAL
- en: Open `c:\ArcpyBook\Ch3\Crime_DataLinksFixed.mxd` in ArcMap.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Notice that all of the layers and tables are loaded from a file geodatabase
    called `CityOfSanAntonio.gdb`, as shown in the following screenshot:![How to do
    it…](img/B04314_03_4.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open **IDLE** and create a new script window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the `arcpy.mapping` module:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Reference the `Crime_DataLinksFixed.mxd` map document file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Call the `replaceWorkspaces()` method, passing a reference to the old geodatabase
    type as well as the new geodatabase type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save a copy of the map document file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save the script as `c:\ArcpyBook\Ch3\MapDocumentReplaceWorkspaces.py`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can check your work by examining the `c:\ArcpyBook\code\Ch3\MapDocumentReplaceWorkspaces.py`
    solution file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the script.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In ArcMap, open the `c:\ArcpyBook\Ch3\Crime_DataLinksUpdated.mxd` file. As shown
    in the following screenshot, all data sources now reference a personal geodatabase
    (note the `.mdb` extension):![How to do it…](img/B04314_03_5.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The `MapDocument.replaceWorkspaces()` method accepts several parameters including
    old and new workspace paths along with the old and new workspace types. Paths
    to the workspaces are self-explanatory, but some discussion of the workspace types
    is helpful. The workspace types are passed into the method as string keywords.
    In this case, the old workspace type was a file geodatabase so its keyword is
    `FILEGDB_WORKSPACE`. The new workspace type is `ACCESS_WORKSPACE`, which indicates
    a personal geodatabase. Personal geodatabases are stored in Microsoft Access files.
    There are a number of different workspace types that can store GIS data. Make
    sure you provide the workspace type that is appropriate for your dataset. The
    following is a list of valid workspace types (many people still work with shapefiles
    so, in this case, the workspace type would be `SHAPEFILE_WORKSPACE`):'
  prefs: []
  type: TYPE_NORMAL
- en: '`ACCESS_WORKSPACE`: This is a personal geodatabase or Access workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ARCINFO_WORKSPACE`: This is an ArcInfo coverage workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`CAD_WORKSPACE`: This is a CAD file workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`EXCEL_WORKSPACE`: This is an Excel file workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`FILEGDB_WORKSPACE`: This is a file geodatabase workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`NONE`: This is used to skip a parameter'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`OLEDB_WORKSPACE`: This is an OLE database workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`PCCOVERAGE_WORKSPACE`: This is a PC ARC/INFO Coverage workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`RASTER_WORKSPACE`: This is a raster workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SDE_WORKSPACE`: This is an SDE geodatabase workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SHAPEFILE_WORKSPACE`: This is a shapefile workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`TEXT_WORKSPACE`: This is a text file workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`TIN_WORKSPACE`: This is a TIN workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`VPF_WORKSPACE`: This is a VPF workspace'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When switching workspaces via the `replaceWorkspaces()` method, the dataset
    names must be identical. For example, a shapefile called `Highways.shp` can be
    redirected to a file geodatabase workspace only if the dataset name in the file
    geodatabase is also called `Highways`. Use the `replaceDataSource()` method on
    the `layer` or `TableView` objects if the dataset name is different.
  prefs: []
  type: TYPE_NORMAL
- en: Fixing individual layer and table objects with replaceDataSource()
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The previous recipes in this chapter have used various methods on the `MapDocument`
    object to fix broken data links. The `Layer` and `TableView` objects also have
    methods that can be used to fix broken data links at the individual object level
    rather than working on all datasets in a map document file. This recipe discusses
    the repairing of `Layer` and `TableView` objects.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Both the `Layer` and `TableView` classes have a `replaceDataSource()` method.
    This method changes the workspace path, workspace type, and/or dataset name for
    a single layer or table. In this recipe, you'll write a script that changes the
    workspace path and workspace type for a single layer. The `replaceDataSource()`
    method is available for the `Layer` and `TableView` classes. In the case of a
    layer, it can either be in a map document or layer file. For a table, it can refer
    to the map document only, since `TableView` objects can't be contained inside
    a layer file.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to learn how to fix individual `Layer` and `TableView` objects
    in a map document using `replaceDataSource()`:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open c`:\ArcpyBook\Ch3\Crime_DataLinksLayer.mxd` in ArcMap. The Crime data
    frame contains a layer called **Burglary**, which is a feature class in the `CityOfSanAntonio`
    file geodatabase. You''re going to replace this feature class with a shapefile
    layer containing the same data:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/B04314_03_6.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Open **IDLE** and create a new script window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the `arcpy.mapping` module:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Reference the `Crime_DataLinksLayer.mxd` map document file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Get a reference to the `Crime` data frame:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Find the **Burglary** layer and store it in a variable:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Call the `replaceDataSource()` method on the `Layer` object and pass the path
    to the shapefile. A keyword will indicate that this will be a shapefile workspace,
    and it also indicates the name of the shapefile:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save the results to a new map document file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save the script as `c:\ArcpyBook\Ch3\LayerReplaceDataSource.py`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can check your work by examining the `c:\ArcpyBook\code\Ch3\LayerReplaceDataSource.py`
    solution file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the script.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open `C:\ArcpyBook\Ch3\Crime_DataLinksNewLayer.mxd` in ArcMap. You should see
    that the **Burglary** layer now references a new workspace:![How to do it…](img/B04314_03_7.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click on the **Burglary** layer and select **Properties**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Source** tab and note the new workspace, workspace type, and
    dataset name:![How to do it…](img/B04314_03_8.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `replaceDataSource()` method accepts two required parameters and two optional
    parameters. The first two parameters define the workspace path and workspace type
    for the layer that will be used as the replacement. The third parameter, `dataset_name`,
    is an optional parameter that defines the name of the dataset that will be used
    as the replacement layer. This name must be an exact match. For example, in this
    recipe, we passed in a `dataset_name` attribute as `Burglaries_2009`, which is
    the name of the shapefile that will now be used as the replacement layer in the
    data frame. If a name is not provided, the method will attempt to replace the
    dataset by finding a table with the same name as the current layer's dataset property.
    The final optional parameter is `validate`. By default, this value is set to `True`.
    When set to `True`, a workspace will only be updated if the `workspace_path` value
    is a valid workspace. If it is not a valid workspace, then the workspace will
    not be replaced. If it's set to `False`, the method will set the source to match
    `workspace_path`, regardless of whether it is a valid match or not. This can result
    in a broken data source, but can be useful if you are creating or modifying a
    map document in preparation for data that does not yet exist.
  prefs: []
  type: TYPE_NORMAL
- en: There's more…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `Layer` and `TableView` classes also contain a `findAndReplaceWorkspacePath()`
    method. This method is very similar to the `MapDocument.findAndReplaceWorkspacePaths()`
    method. The only difference is that it works against a single `Layer` or `TableView`
    class instead of iterating the entire map document or layer file.
  prefs: []
  type: TYPE_NORMAL
- en: Finding broken data sources in all map documents in a folder
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A common scenario in many organizations involves the movement of data from one
    workspace to another or from one workspace type to another. When this happens,
    any map documents or layers that reference these data sources become broken. Finding
    each of these data sources can be a huge task if undertaken manually. Fortunately,
    you can create a geoprocessing script that will find all broken data sources in
    a folder or list of folders.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to recursively search directories for map
    document files, find any broken data sources within these map documents, and write
    the names of the broken data layers to a file.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps to learn how to find all broken data sources in all map
    documents in a folder:'
  prefs: []
  type: TYPE_NORMAL
- en: Open **IDLE** and create a new script window.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Import the `arcpy` and `os` packages:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Open a file that you will use to write the broken layer names:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Pass a path to the `c:\ArcpyBook` folder to use in the `os.walk()` method along
    with a `for` loop to walk the directory tree:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Inside the `for` loop, create a second `for` loop that loops through all the
    files returned and create a new `filename` variable. Remember to indent the `for`
    loop inside the first `for` loop:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Following the last line of code that you added, test the file extension to
    see if it is a map document file. If so, create a new map document object instance
    using the path, write the map document name, get a list of broken data sources,
    loop through each of the broken data sources, and write to the file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add a `print` statement to indicate that you are done and close the file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The entire script should appear as follows:![How to do it...](img/B04314_03_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can check your work by examining the `c:\ArcpyBook\code\Ch3\ListBrokenDataSources.py`
    solution file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run the script to generate the file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the file to see the results. Your output will vary depending upon the path
    you've defined. The following screenshot shows my output file:![How to do it...](img/B04314_03_9.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This script uses a combination of methods from the Python `os` package and the
    `arcpy.mapping` package. The `os.walk()` method walks a directory tree and returns
    the path, a list of directories, and a list of files for each directory starting
    with a root directory that you have defined as the `c:\ArcpyBook` directory. This
    root directory could have been any directory. The `os.walk()` method returns a
    three item tuple consisting of the root directory, a list of directories immediately
    contained within that root, as well as a list of files immediately contained within
    the root. We then loop through this list of files and test each one to see if
    it contains the `.mxd` string, which indicates a map document file. Files identified
    as map documents have their filenames written to a text file, and a new `MapDocument`
    object instance is created. The `ListBrokenDataSources()` method is then used
    with a reference to the map document to generate a list of broken data sources
    within the file, and these broken data sources are written to the file as well.
  prefs: []
  type: TYPE_NORMAL
