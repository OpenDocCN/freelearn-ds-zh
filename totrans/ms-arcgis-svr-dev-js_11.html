<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div class="chapter" title="Chapter 11. The Future of ArcGIS Development"><div class="titlepage"><div><div><h1 class="title"><a id="ch11"/>Chapter 11. The Future of ArcGIS Development</h1></div></div></div><p>What does the future hold for those who want to develop map applications for ArcGIS Server? After all, the direction of the Internet changes with each new technology, and what is popular today might not be popular tomorrow. The Flex and Silverlight APIs were quite popular at one point, and now they're only being maintained. What does the future hold for ArcGIS Server development with JavaScript?</p><p>If the latest releases from ESRI are any indication, JavaScript is still the development language of choice for the web. However, instead of letting users build applications from scratch, the ArcGIS platform has released new features that can jump start application development. Two of them, ArcGIS Online and Web AppBuilder, are based on the ArcGIS JavaScript API. We'll take a look at these technologies, and develop an application using a map created with ArcGIS Online.</p><p>In this chapter, we'll cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to use ArcGIS Online to create web maps</li><li class="listitem" style="list-style-type: disc">What Web AppBuilder is and how it relates to ArcGIS Online</li><li class="listitem" style="list-style-type: disc">How to use an ArcGIS Online web map in your ArcGIS JavaScript API application</li></ul></div><div class="section" title="ArcGIS Online"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec101"/>ArcGIS Online</h1></div></div></div><p>ArcGIS Online <a id="id871" class="indexterm"/>is ESRI's online tool for creating web maps in the cloud. ArcGIS Online provides a way for users to create web maps, mix and match map services and other data sources, modify popups, and share the resulting web maps, either with the general public or within their organizations. This is a screenshot of the ArcGIS Online page where you can add data from different sources into custom maps:</p><div class="mediaobject"><img src="graphics/6459OT_11_01.jpg" alt="ArcGIS Online" width="991" height="554"/></div><p>Besides referencing <a id="id872" class="indexterm"/>data through web maps, ArcGIS Online subscriptions allow you to upload and store data. Tiled map services can be created with tiled map packages generated through ArcGIS Server. Feature services can be created to store, update, and retrieve feature data. You can also use other ArcGIS Server extensions, such as geocoding and routing through ArcGIS Online. This means that you don't have to use your own hardware to host your data. You can maintain your feature data and tiled maps in the ArcGIS Online cloud.</p><p>Now, I'm sure you're wondering how ESRI can afford to offer these features. The more advanced services cost credits, which can be purchased through ESRI. Each simple transaction can cost a fraction of a credit, but repeated use can add up. Tiled and feature services also cost credits, and are charged by gigabytes of storage per month. Depending on the size of your organization, you get an allotted number of credits per year, with the option to purchase more. However, if you have a developer account, ArcGIS Online currently offers 50 credits a month for testing your applications.</p><div class="section" title="ArcGIS Portal"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec168"/>ArcGIS Portal</h2></div></div></div><p>If you work <a id="id873" class="indexterm"/>for an enterprise organization that doesn't want its data hosted through a public platform such as ArcGIS Online, there is a private version as well. ArcGIS Portal is an organization-centered version of ArcGIS Online that can work within a private or secured network. Logins can be verified through a number of common secure protocols such as SAML and oAuth2.</p><p>ArcGIS Portal has many of the same features as ArcGIS Online. You can create and share web maps. You can upload, catalog, and search for data sources in your organization and, using<a id="id874" class="indexterm"/> administrator access, you can set user roles and permissions. The primary difference is that the data you create and share is kept within the company network. What happens in ArcGIS Portal stays in ArcGIS Portal.</p></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Web AppBuilder"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec102"/>Web AppBuilder</h1></div></div></div><p>Developers <a id="id875" class="indexterm"/>have made the same map tools over and over for different sites. Almost all generic web mapping applications have a drawing tool, a measuring tool, a print tool, a legend, and so on. The developers at ESRI China have implemented an idea to create an application that builds JavaScript web mapping apps that use ArcGIS Online web maps. They call the tool <span class="strong"><strong>Web AppBuilder</strong></span>, that is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6459OT_11_02.jpg" alt="Web AppBuilder" width="981" height="539"/></div><p>Web AppBuilder creates full-page web mapping applications using the ArcGIS JavaScript API. The applications use responsive design elements and fit any screen. Publishers have a choice of color scheme, title text, logos, and an assortment of widgets. Web AppBuilder applications are published and hosted through ArcGIS Online, so you don't need your own hosting environment to create a web map application.</p><p>You can create generic Web Appbuilder applications straight from ArcGIS Online. Using an existing AGOL webmap, you<a id="id876" class="indexterm"/> can create an application, add several default widgets, such as printing, measuring, and queries. You can define titles, color schemes (from a list), and parameters for each of the widgets you use.</p><div class="section" title="Developer Edition"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec169"/>Developer Edition</h2></div></div></div><p>One issue <a id="id877" class="indexterm"/>with the default Web AppBuilder is that there is no room for custom development. If you don't like the way the <span class="strong"><strong>Query</strong></span> widget searches for results, you don't have anything better. ESRI recognized this, and released a developer edition for custom development.</p><p>The Web AppBuilder Developer Edition is a Node.js application that lets you generate web mapping applications using default widgets and any custom widgets you create. Widgets are based on Dojo's <code class="literal">dijit</code> system, and are easily added to the system. Web AppBuilder and the applications created with it are tied to an ArcGIS Online account.</p><p>Web AppBuilder Developer Edition generates the HTML, style sheets, and JavaScript necessary to run a freestanding website. Configuration data is stored in JSON files. Along with creating custom widgets, it is possible to create custom themes, modifying the style and position of elements to match your requirements.</p><p>Widgets made for the Web AppBuilder Developer Edition are highly extensible. Widget components can be written for international markets using <a id="id878" class="indexterm"/><span class="strong"><strong>i18n</strong></span> (internationalization) and localization principals. Configurations can store label names in the widget in multiple languages, which will be loaded correctly with the application. Widget configurations can also be modified prior to application deployment. Settings for the widgets can be written using dijit form elements, much like the application itself, to modify the configuration.</p><p>As of the time of writing, ArcGIS Online will not host applications created with the Developer Edition. Applications generated with the Developer Edition are hosted on the developer's own platform. Since the files generated through the Developer Edition are static HTML, JavaScript, CSS, and image files, they can be hosted with little or no server-side processing.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>For more information regarding Web AppBuilder, refer <a id="id879" class="indexterm"/>to the ESRI website at <a class="ulink" href="http://doc.arcgis.com/en/web-appbuilder/">http://doc.arcgis.com/en/web-appbuilder/</a>. For more information about Web AppBuilder <a id="id880" class="indexterm"/>Developer Edition, including download instructions and tutorials, visit <a class="ulink" href="https://developers.arcgis.com/web-appbuilder/">https://developers.arcgis.com/web-appbuilder/</a>.</p></div></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="More Node.js"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec103"/>More Node.js</h1></div></div></div><p>Speaking of <a id="id881" class="indexterm"/>Node.js, there are a number of tools for the ArcGIS JavaScript API that rely on Node.js. The ArcGIS API for JavaScript Web Optimizer is a Node.js project hosted by ESRI, which packages your custom modules along with a minimum set of ESRI and Dojo modules for a simplified build process. You can host through ESRI's <a id="id882" class="indexterm"/><span class="strong"><strong>content delivery network</strong></span> (<span class="strong"><strong>CDN</strong></span>), or download and host it yourself.</p><p>If you decide to focus more on the Web AppBuilder Developer Edition, there's a Node.js project for that, too. The <code class="literal">generator-esri-appbuilder-js</code> project generates a template Web AppBuilder widget with all the necessary files. It asks you for basic information, such as the widget name and author information, as well as what kinds of files the widget will require. The project is based on Yeoman, a Node.js template-generating tool.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>For more information on the<a id="id883" class="indexterm"/> ArcGIS API for JavaScript Web Optimizer, visit <a class="ulink" href="https://developers.arcgis.com/javascript/jshelp/inside_web_optimizer.html">https://developers.arcgis.com/javascript/jshelp/inside_web_optimizer.html</a>. For the <code class="literal">generator-esri-appbuilder-js</code> project, you can find it on NPM at <a class="ulink" href="https://www.npmjs.com/package/generator-esri-appbuilder-js">https://www.npmjs.com/package/generator-esri-appbuilder-js</a>, or view the source code at <a class="ulink" href="https://github.com/Esri/generator-esri-appbuilder-js">https://github.com/Esri/generator-esri-appbuilder-js</a>.</p></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Our application"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec104"/>Our application</h1></div></div></div><p>Now that we're up <a id="id884" class="indexterm"/>to speed on the latest and greatest from ESRI, let's return to our story. The Y2K society called and they love the work we've done with our application. They can't wait to share all that information with the general public.</p><p>The interesting thing is that the Y2K society has purchased a few ArcGIS Online licenses. Now they want you to store the web map data in that format, so they can manage and add new data about the year 2000 as they come across it.</p><p>Our goal is to create an ArcGIS Online webmap for the Y2K society and add it to our existing application. We will add the map layers, popup templates, and charts into the webmap. We'll then load the webmap into our existing application, cut out unnecessary features, and make the rest of the custom features work with the webmap.</p></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Creating a webmap"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec105"/>Creating a webmap</h1></div></div></div><p>We<a id="id885" class="indexterm"/> need to create a webmap to use in our application. If you haven't already set up a developer account for ArcGIS Online, go to <a class="ulink" href="https://developers.arcgis.com/en/sign-up/">https://developers.arcgis.com/en/sign-up/</a> to sign up for a developer account. Once you've signed in, click on <span class="strong"><strong>Map</strong></span> in the top menu. It will load an empty map much like the image at the beginning of the chapter.</p><p>We can start by <a id="id886" class="indexterm"/>saving a copy of our map. This will allow us to name the map, write descriptions, search terms, and so on. In the toolbar toward the top, click on the <span class="strong"><strong>Save</strong></span> dropdown and select <span class="strong"><strong>Save</strong></span>. This will create a dialog popup that will let us enter the name of our map, write a summary, and add tags that make it easier to search for our map. We can put the map in our base folder, or make a new one for the application. Add <code class="literal">Y2K Census Map</code> to the title, and give a brief description. It should look similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/6459OT_11_03.jpg" alt="Creating a webmap" width="521" height="265"/></div><p>Once you've clicked <span class="strong"><strong>SAVE MAP</strong></span>, the map should have a new name. If you look in the URL, you'll also notice some strange characters. Your webmap has now been assigned a new webmap ID (<code class="literal">?webmap=XXXXXXXXXXXXXXXXX</code>), which is a unique string that ArcGIS Online uses to reference your map. Keep this webmap ID handy, because we'll use it later in our application.</p><div class="section" title="Changing the basemap"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec170"/>Changing the basemap</h2></div></div></div><p>One <a id="id887" class="indexterm"/>of the<a id="id888" class="indexterm"/> best features of using ArcGIS Online to host your webmap is all the basemap backgrounds that are available. From satellite and aerial photos to simple grayscale maps, there's a good background available for your data.</p><p>In previous versions of our application, we used the national geographic basemap to frame our data. We can do the same for this webmap. Click <span class="strong"><strong>Basemap</strong></span> in the upper left-hand corner of the toolbar, and you'll be able to view a number of web map thumbnail images. Select<a id="id889" class="indexterm"/> the <span class="strong"><strong>National Geographic</strong></span> basemap, and the map should update. The basemap selector should<a id="id890" class="indexterm"/> look like the following screenshot:</p><div class="mediaobject"><img src="graphics/6459OT_11_04.jpg" alt="Changing the basemap" width="395" height="523"/></div></div><div class="section" title="Adding the census map service"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec171"/>Adding the census map service</h2></div></div></div><p>ArcGIS Online<a id="id891" class="indexterm"/> provides a number of ways to add layers to <a id="id892" class="indexterm"/>maps. Whether we have an ArcGIS Server map service or a simple CSV file, ArcGIS Online can accommodate a wide variety of data. To add layers to the map, click on the <span class="strong"><strong>Add</strong></span> button in the upper left-hand corner and select from the drop-down choices. Some of the different ways to add layers to webmaps are discussed in the following sections.</p><div class="section" title="Searching for layers"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec138"/>Searching for layers</h3></div></div></div><p>ArcGIS Online <a id="id893" class="indexterm"/>catalogs a wide variety of map layers for both public and organizational use. ArcGIS Online provides a search blank and a list of matching maps and layers to add to your webmap. If layers and services have been shared within your organization, you can search for keywords and tags to add that layer into your map. You can also add map services and layers that other people have marked as public data.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>If your web map contains layers that are restricted to either your organization, or to specific groups within your organization, anyone who views the webmap will be prompted to log in to prove they can view the layers. If login fails, the webmap may load, but the restricted data will not be loaded on the map.</p></div></div></div><div class="section" title="Browsing for ESRI layers"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec139"/>Browsing for ESRI layers</h3></div></div></div><p>ESRI has a<a id="id894" class="indexterm"/> large collection of its own map data available for public use. The data covers a wide range of topics and interests. You can filter by category, and click to add the map layer to your existing map. Currently, major categories include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Imagery</li><li class="listitem" style="list-style-type: disc">Basemaps</li><li class="listitem" style="list-style-type: disc">Historical maps</li><li class="listitem" style="list-style-type: disc">Demographics and lifestyles</li><li class="listitem" style="list-style-type: disc">Landscapes</li><li class="listitem" style="list-style-type: disc">Earth observations</li><li class="listitem" style="list-style-type: disc">Urban systems</li><li class="listitem" style="list-style-type: disc">Transportation</li><li class="listitem" style="list-style-type: disc">Boundaries and places</li></ul></div><p>While you might be tempted to grab census data from this location, remember that this shows more current data. Since we're using the Year 2000 data in this case, we'll ignore this option. However, we'll<a id="id895" class="indexterm"/> remember this, because it could be useful in other projects.</p></div><div class="section" title="Adding layers from the web"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec140"/>Adding layers from the web</h3></div></div></div><p>This <a id="id896" class="indexterm"/>option allows us to add from a number of web map services. While it's expected that we can add ArcGIS Server map services, some of the other choices may surprise you. Besides ArcGIS Server map and feature services, other layer types we can add include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">WMS Service</li><li class="listitem" style="list-style-type: disc">WMTS Service</li><li class="listitem" style="list-style-type: disc">Tiled Service</li><li class="listitem" style="list-style-type: disc">KML file</li><li class="listitem" style="list-style-type: disc">GeoRSS file</li><li class="listitem" style="list-style-type: disc">CSV file</li></ul></div><p>Note that the CSV file refers to one available online, more than likely through another service. If you have a CSV file to upload, you would select the next option.</p></div><div class="section" title="Adding layer from a file"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec141"/>Adding layer from a file</h3></div></div></div><p>Here, we get to <a id="id897" class="indexterm"/>upload a file and have ArcGIS Online render it for us. The dialog asks for a file to upload and, based on the file format, it will also ask for information to determine geographical locations. Acceptable files for adding geographical data include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A shape file with up to 1,000 features stored in a <code class="literal">.zip</code> folder</li><li class="listitem" style="list-style-type: disc">A tab or comma delimited text or CSV file</li><li class="listitem" style="list-style-type: disc">A <span class="strong"><strong>GPS Exchange Format</strong></span> (<span class="strong"><strong>GPX</strong></span>), which is available from many GPS units</li></ul></div></div><div class="section" title="Adding map notes"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec142"/>Adding map notes</h3></div></div></div><p>This option<a id="id898" class="indexterm"/> allows you to draw custom points, lines, and polygons on the map as notes for other users or applications. You can select from a number of predefined feature types with unique renderers. Based on the note template you pick, you can add points, lines, and polygons with custom symbols.</p></div><div class="section" title="Our application data source"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec143"/>Our application data source</h3></div></div></div><p>For our <a id="id899" class="indexterm"/>application data source, we'll add a layer from the web. After you choose to add a layer from the web, select the ArcGIS web service from the drop-down list, and either type or paste the 2000 census map service URL in the blank. Leave the <span class="strong"><strong>Use as Basemap</strong></span> checkbox unchecked. Finally, click <span class="strong"><strong>ADD LAYER</strong></span> to add it to the map. You can see a screenshot of the prompt in the following<a id="id900" class="indexterm"/> image:</p><div class="mediaobject"><img src="graphics/6459OT_11_05.jpg" alt="Our application data source" width="990" height="553"/></div></div><div class="section" title="Styling"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec144"/>Styling</h3></div></div></div><p>ArcGIS Online <a id="id901" class="indexterm"/>allows you to restyle many dynamic and feature layers, even if they weren't styled that way on the original map. You can add custom renderers to alter the color, transparency, and picture symbology of each layer. You can turn a simple map with no style into a custom map with unique value symbology, telling the story you want to tell.</p><p>For our web map, we see the simple black outlines of the states and counties on our map. We're going to change the style to make them look more appealing, and to blend them in with the National Geographic basemap background.</p><p>First, click on the census map service layer under <span class="strong"><strong>Contents</strong></span> to expand the map layer. You'll see the different sublayers that make up the layer, such as <span class="strong"><strong>States</strong></span>, <span class="strong"><strong>Counties</strong></span>, <span class="strong"><strong>Block Groups</strong></span>, and <span class="strong"><strong>Block Points</strong></span>. By clicking on each one, you can see the symbols for each layer.</p><p>We'll start changing the symbology for the <span class="strong"><strong>States</strong></span>. Click the little downward-pointing triangle to the right of <span class="strong"><strong>States</strong></span> and select <span class="strong"><strong>Change Style</strong></span>. The first menu will appear on the left, and let you select a label and symbol. Between the basemap and our popups, we'll have a good idea of what state we're in, so we'll leave the labels alone. Click on the <span class="strong"><strong>Options</strong></span> button in the <span class="strong"><strong>Single Symbol</strong></span> drawing under <span class="strong"><strong>Select a drawing style</strong></span>.</p><p>The next <a id="id902" class="indexterm"/>prompt lets you change the symbol and the visibility range of the layer on the map. If the layers are already set with minimum and maximum visibilities, this will not make those more lenient, but it can make them stricter. Click on the <span class="strong"><strong>Symbol</strong></span> link to get a color prompt. From here, you can set the color of the outline and the inside filling of the polygons. It should look something like the following screenshot:</p><div class="mediaobject"><img src="graphics/6459OT_11_06.jpg" alt="Styling" width="339" height="516"/></div><p>Change the color of the outline to a darker orange, and click <span class="strong"><strong>OK</strong></span>. We'll leave a transparent fill in the states. Repeat the same processes with the <span class="strong"><strong>Counties</strong></span> and <span class="strong"><strong>Block Groups</strong></span>, picking a lighter <a id="id903" class="indexterm"/>shade of orange each time.</p></div><div class="section" title="Creating popups"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec145"/>Creating popups</h3></div></div></div><p>Now that <a id="id904" class="indexterm"/>we've adjusted our layers, let's look at the popups. ArcGIS Online lets you create and configure popups for map layers and feature services on your webmap. They provide a number of popup configurations, including a list of feature attributes and a <a id="id905" class="indexterm"/><span class="strong"><strong>What You See Is What You Get</strong></span> (<span class="strong"><strong>WYSIWYG</strong></span>) rich text editor. Both allow some value formatting, such as thousand separators for numbers, or date formatting for dates. The WYSIWYG editor also allows you to use text colors and add links based on value attributes.</p><p>For our application, we're going to stick with displaying the list of attributes. Click on the <span class="strong"><strong>Options</strong></span> button for the <span class="strong"><strong>States</strong></span> (the little downward-pointing triangle), and select <span class="strong"><strong>Configure Popup</strong></span>. In the next menu on the left-hand side, we can modify the title and the contents. Remember that, in any of the blanks, field names are surrounded by brackets and will be replaced with values.</p><p>Next to the <span class="strong"><strong>Display</strong></span> dropdown, select <span class="strong"><strong>A list of field attributes</strong></span>. This will create a long list of all the field attributes. We don't want to see all of them, or even most of them, so we'll configure which fields we see. Click on the <span class="strong"><strong>Configure Attributes</strong></span> link under the list of fields.</p><p>You'll see a dialog with a list of fields available for viewing. Each field has a checkbox for visibility, a field name shown with brackets, and a field alias. Field aliases can be altered by clicking on them and typing in a different value. Unchecking a box here means that it won't appear in the popup. For numeric and date fields, extra formatting prompts appear to the right of the list when such a field is selected. Look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6459OT_11_07.jpg" alt="Creating popups" width="995" height="557"/></div><p>Since we see<a id="id906" class="indexterm"/> the state name in the title, we can uncheck everything but <span class="strong"><strong>Population for 2000</strong></span>, <span class="strong"><strong>Square Miles</strong></span>, and <span class="strong"><strong>Population per Square mile</strong></span>. We'll rename the aliases to make them more appealing. Finally, we'll click <span class="strong"><strong>OK</strong></span>. The list of attributes should reflect the three fields we've made visible at this point.</p></div><div class="section" title="Adding charts"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec146"/>Adding charts</h3></div></div></div><p>The <a id="id907" class="indexterm"/>popup configuration controls on ArcGIS Online also allow you to add images, charts, and graphs based on feature attributes. The images and graphs appear in the popups under the content we've displayed. These graphics are drawn using the <code class="literal">dojox/charting</code> libraries.</p><p>Going back to the <span class="strong"><strong>States</strong></span> layer, we'll add the graphs for the ethnicities, genders, and ages in the states. In the lower left, under <span class="strong"><strong>Popup Media</strong></span>, click on the <span class="strong"><strong>Add</strong></span> button. A dropdown will appear, letting you choose the image or chart you would like to see. For our ethnic graph, we'll select a pie graph.</p><p>In the next prompt, we're given the parameters required to configure the pie chart. It requires a title, a caption, and selected fields to add to the chart. We're also given the option to normalize the data against another field in our data. If we were comparing relative population levels between areas, it would be beneficial to normalize against the entire population, but since we're making pie charts, and the populations of each ethnic group should add up to 100 percent, we'll skip normalization. You can see an example of the prompt in the following screenshot:</p><div class="mediaobject"><img src="graphics/6459OT_11_08.jpg" alt="Adding charts" width="430" height="577"/></div><p>For the <a id="id908" class="indexterm"/><span class="strong"><strong>State</strong></span> popup, we'll give the graph a name of <code class="literal">Ethnic Graph</code>. We'll then add a caption to explain what the chart is all about. Finally, we'll make sure that the <span class="strong"><strong>WHITE</strong></span>, <span class="strong"><strong>BLACK</strong></span>, <span class="strong"><strong>AMERI_ES</strong></span>, <span class="strong"><strong>ASIAN</strong></span>, <span class="strong"><strong>HISPANIC</strong></span>, <span class="strong"><strong>MULT_RACE</strong></span>, <span class="strong"><strong>HAWN_PI</strong></span>, and <span class="strong"><strong>OTHER</strong></span> fields are checked. Note that, if you didn't reformat the names of the fields when configuring the popup field name attributes in the previous section, the attributes will appear just as you left them. You can edit the field aliases here as well. You don't necessarily have to make them visible in the popup to make them chartable (and format their aliases) here. Finally, click <span class="strong"><strong>OK</strong></span>, and you should see your <span class="strong"><strong>Ethnic Chart</strong></span> in the list of <span class="strong"><strong>Popup Media</strong></span>.</p><p>We'll repeat<a id="id909" class="indexterm"/> the steps for adding the gender and age charts. For the gender pie chart, we'll repeat the preceding steps to add another pie chart. We'll label it <code class="literal">Gender Chart</code>, and make sure that the <code class="literal">MALES</code> and <code class="literal">FEMALES</code> fields are checked. For the age bar chart, we'll select <span class="strong"><strong>Bar Chart</strong></span> from the first menu. In the second prompt, we'll title the chart <code class="literal">Age Chart</code> and add the <code class="literal">AGE_UNDER5</code>, <code class="literal">AGE_5_17</code>, <code class="literal">AGE_18_21</code>, <code class="literal">AGE_22_29</code>, <code class="literal">AGE_30_39</code>, <code class="literal">AGE_40_49</code>, <code class="literal">AGE_50_64</code>, and <code class="literal">AGE_65_UP</code> fields.</p><p>Once the charts have been configured, be sure to click on <span class="strong"><strong>SAVE POPUP</strong></span> on the bottom of the popup menu. This will reload the map with the new popup configurations. Click on a state to test that the popups appear. You should see the fields we added, and <span class="strong"><strong>Ethnic Chart</strong></span> in the <span class="strong"><strong>State</strong></span> popup. Arrows are also added to the right and left of the charts so that the user can view the gender and age graphs as well. Hovering over the graphs with your mouse will show the labels and numbers behind the graphs. They should appear like the popups shown in the following pictures.</p><p>This screenshot shows the <span class="strong"><strong>Ethnic Graph</strong></span>:</p><div class="mediaobject"><img src="graphics/6459OT_11_09.jpg" alt="Adding charts" width="420" height="448"/></div><p>This screenshot shows the <span class="strong"><strong>Gender Chart</strong></span>:</p><div class="mediaobject"><img src="graphics/6459OT_11_11.jpg" alt="Adding charts" width="447" height="450"/></div><p>This<a id="id910" class="indexterm"/> screenshot shows the <span class="strong"><strong>Age Chart</strong></span>:</p><div class="mediaobject"><img src="graphics/6459OT_11_10.jpg" alt="Adding charts" width="466" height="469"/></div></div></div><div class="section" title="Uses for an ArcGIS Online webmap"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec172"/>Uses for an ArcGIS Online webmap</h2></div></div></div><p>ArcGIS Online<a id="id911" class="indexterm"/> not <a id="id912" class="indexterm"/>only provides maps, but also tools with which you can perform analysis, collect data, and<a id="id913" class="indexterm"/> share maps with others. Some of the other features available in the preceding toolbar are as follows.</p><div class="section" title="Sharing"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec147"/>Sharing</h3></div></div></div><p>
<span class="strong"><strong>Sharing</strong></span> lets<a id="id914" class="indexterm"/> you control who has access to your webmap. You can share the map with the world, with those in your organization, or keep it to yourself. You can give other people access to the map by sharing the URL for it. You can also imbed the webmap in any website as an iframe, or create a web application using one of the web app templates.</p></div><div class="section" title="Printing"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec148"/>Printing</h3></div></div></div><p>The <span class="strong"><strong>Print</strong></span> control<a id="id915" class="indexterm"/> in the toolbar opens a printable copy of the webmap in a new tab on your browser. The printable copy shows the title, the map in its current extent, and the attribution data. The page is formatted to be printed on an ANSI (A letter-sized) piece of paper.</p></div><div class="section" title="Directions"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec149"/>Directions</h3></div></div></div><p>By clicking on <span class="strong"><strong>Directions</strong></span>, you'll get <a id="id916" class="indexterm"/>a Directions widget in the left-hand portion of the screen. The Directions widget lets you get directions from a starting point to a finishing point, with any number of stops in between. Directions and time can be calculated for a car, truck, or walking. You can also collect return trip data, as well as traffic data, on the route. Remember that directions and traffic routing cost credits to use.</p></div><div class="section" title="Measurements"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec150"/>Measurements</h3></div></div></div><p>The <a id="id917" class="indexterm"/>measurement widget here mimics the measurement <code class="literal">dijit</code> in <code class="literal">esri/dijit/Measurement</code>. You can draw points, lines, and polygons to collect coordinates, lengths, and areas respectively. You can also change the units of measurement into metric or English units. When collecting latitude and longitude with points, it displays them in decimal degrees, as well as degrees-minutes-seconds.</p></div><div class="section" title="Bookmarks"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec151"/>Bookmarks</h3></div></div></div><p>The <span class="strong"><strong>Bookmarks</strong></span> <a id="id918" class="indexterm"/>tool allows you to save locations on the webmap. The bookmarks widget captures the current map extent and gives it a name. When creating multiple bookmarks of areas on the map, you can quickly navigate to them by clicking on the bookmark names. You can also edit the names and delete unwanted bookmarks. Bookmark data is saved along with other features of the webmap.</p></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Developing against an ArcGIS Online webmap"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec106"/>Developing against an ArcGIS Online webmap</h1></div></div></div><p>If your <a id="id919" class="indexterm"/>organization is happy with the webmaps and tools offered by ArcGIS Online, you could potentially run your public facing GIS from the website and never develop another tool. Sometimes you need custom functionality. Sometimes you need an application that makes custom requests from other data sources when you click on a map. Maybe you need a complicated query page or a query builder to collect results. Whatever your specialized needs, you can bring the ArcGIS Online webmap to your custom app.</p><p>What does using an AGOL webmap do for your application? It cuts out many of the map configuration steps. All the tiled, dynamic, and feature layers we would normally hardcode in the application can now be mashed together in a webmap and loaded in our app. All the popups and <code class="literal">infoTemplate</code> that we had to assign through code can now be carried over from the we map. Whenever changes to the map service layers and popups are required, they can be made through ArcGIS Online, instead of changing the code and hoping that users aren't still running a cached copy of your configuration script. Configurations can be handled by someone else, giving you more time to code.</p><div class="section" title="Creating the webmap"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec173"/>Creating the webmap</h2></div></div></div><p>In order to <a id="id920" class="indexterm"/>bring in the webmap we created earlier, we need to update our <code class="literal">app.js</code> file. In the list of modules in the <code class="literal">app.js</code> file's <code class="literal">require()</code> method, we need to add a reference to the <code class="literal">esri/arcgis/utils</code> module. This will give us the tools we need to add the webmap to our application:</p><div class="informalexample"><pre class="programlisting">require([, "esri/arcgis/utils", ],function (, arcgisUtils, ) {

});</pre></div><p>Typically, we would use the <code class="literal">arcgisUtils.createMap()</code> method to construct our new webmap. It requires parameters similar to the <code class="literal">esri/map</code> constructor, including a reference to the HTML element <code class="literal">id</code> where the map should go, and an <code class="literal">options</code> object. However, the <code class="literal">arcgisUtils.createMap()</code> method also requires an ArcGIS Online webmap <code class="literal">id</code>. You can get this <code class="literal">id</code> by opening your webmap in ArcGIS Online to edit. If you look at the URL, you'll see the search parameter <code class="literal">webmap=XXXXXXXXXXXXXXX</code>, where those <span class="emphasis"><em>X</em></span>'s are replaced by alphanumeric characters. You can copy and paste the <code class="literal">id</code> numbers into your application to create a webmap, like so:</p><div class="informalexample"><pre class="programlisting">require([, "esri/arcgis/utils", ],function (, arcgisUtils, ) {
     arcgisUtils.createMap("450d4fb709294359ac8d03a3069e34d3", 
       "mapdiv", {});
});</pre></div><p>Options for the <code class="literal">arcgisUtils.createMap()</code> method<a id="id921" class="indexterm"/> include, but are not limited to the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">bingMapKey</code>: The unique key string provided in your subscription to Bing Maps.</li><li class="listitem" style="list-style-type: disc"><code class="literal">editable</code>: A <code class="literal">Boolean</code> value that you can use to disable any feature layer editing.</li><li class="listitem" style="list-style-type: disc"><code class="literal">geometryServiceURL</code>: URL link to ArcGIS Server geometry service.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ignorePopups</code>: A <code class="literal">Boolean</code> that will disable all popups if true.</li><li class="listitem" style="list-style-type: disc"><code class="literal">mapOptions</code>: The normal options you would pass to create a normal map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">usePopupManager</code>: A <code class="literal">Boolean</code> value that, when true, tells <code class="literal">InfoWindow</code> to retrieve all clicked features that have popup templates. When true, it also handles the popups visibility of map service sublayers whether the parent layer is visible or not. If false, popups on sublayers may or may not load if the parent layer is not turned on, and you will have to manually control popup visibility for complicated maps.</li></ul></div><p>The <code class="literal">arcgisUtils.createMap()</code> method will return a <code class="literal">dojo/Deferred</code> promise, which will fire a success callback using <code class="literal">then()</code> once the webmap data has been downloaded and the map has been created. The callback will return a response object that contains the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">map</code>: The <code class="literal">esri/map</code> object created</li><li class="listitem" style="list-style-type: disc"><code class="literal">itemInfo</code>: An object containing:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">item</code>: An object that contains the map title, a snippet to describe it, and the extent in a nested array form</li><li class="listitem" style="list-style-type: disc"><code class="literal">itemInfo</code>: A JSON object containing data about the map services, renderers, popups, bookmarks, and other map data used to create the web map</li><li class="listitem" style="list-style-type: disc"><code class="literal">errors</code>: An array of errors encountered when loading data and creating the map services</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">clickEventHandler</code> and <code class="literal">clickEventListener</code>: When populated, these control the map click events that show popups. If you ever need to turn off popups, you can run the following:<div class="informalexample"><pre class="programlisting">// response object was returned by arcgisUtils.createMap()
response.clickEventHandler.remove();</pre></div></li><li class="listitem" style="list-style-type: disc">To restore <a id="id922" class="indexterm"/>the popups, run the following line of code (assuming that you've loaded the <code class="literal">dojo/on</code> module:<div class="informalexample"><pre class="programlisting">response.clickEventHandler = dojoOn(map, "click",  response.clickEventListener);</pre></div></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>When creating the webmap, if you set the <code class="literal">usePopupManager</code> parameter to <code class="literal">true</code> (the default is <code class="literal">false</code>), the <code class="literal">clickEventHandler</code> and <code class="literal">clickEventListener</code> parameters will be null. In that case, popup visibility will be controlled through the <code class="literal">map.setInfoWindowOnClick(boolean)</code> method.</p></div></div><p>Since we incorporated the ESRI Bootstrap back in <a class="link" href="ch08.html" title="Chapter 8. Styling Your Map">Chapter 8</a>, <span class="emphasis"><em>Styling Your Map</em></span>, we need to use the ESRI Bootstrap version of the <code class="literal">createMap()</code> constructor in the <code class="literal">esri/arcgis/utils</code> module. Since the map may take time to load, we'll move the census widget loading inside the deferred callback. The code should look as follows:</p><div class="informalexample"><pre class="programlisting">  /* not used because we're using the boostrapMap version
  var deferred = arcgisUtils.createMap("450d4fb709294359ac8d03a3069e34d3", "map", {});  */

  var deferred = BootstrapMap.createWebMap("450d4fb709294359ac8d03a3069e34d3", "map", {});

  deferred.then(function (response) {
    // map and census widget definition moved inside deferred callback
    var map = response.map;

    var census = new Census({
      map: map,
      mapService: "http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/"
    }, "census-widget");

    dojoOn(dom.byId("census-btn"), "click", lang.hitch(census, census.show));
  });</pre></div></div><div class="section" title="In our census widget"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec174"/>In our census widget</h2></div></div></div><p>Now that we <a id="id923" class="indexterm"/>have defined many parts of our map in the webmap, we can remove a lot of the widget code that handled the same information. In the module reference of our census's <code class="literal">define</code> statement, we can remove references to the following modules:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>State</strong></span>, <span class="strong"><strong>County</strong></span>, <span class="strong"><strong>Block Group</strong></span>, and <span class="strong"><strong>Block Point</strong></span> templates</li><li class="listitem" style="list-style-type: disc"><code class="literal">IdentifyTask</code> and <code class="literal">IdentifyParameter</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">InfoTemplates</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">D3/d3</code></li></ul></div><p>Remember to delete the module references as well as their corresponding variables.</p><p>In the body of our widget, we can remove any references to the <code class="literal">identifytask</code> or map clicking, or <code class="literal">infowindow</code> selection events, since that controlled the popups. We can also remove all the methods that created the charts on our popups. All we're left with is a widget that populates the drop-down menus for states, counties, and block groups, to let us see that data.</p><p>Don't feel bad about deleting so much code. One of the joys of a developer's life is to delete lines of code, since they are possible sources of errors.</p></div><div class="section" title="Accessing webmap in our app"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec175"/>Accessing webmap in our app</h2></div></div></div><p>What would <a id="id924" class="indexterm"/>we do if we needed something from the ArcGIS Online webmap configuration?  If we want that information, the ArcGIS JavaScript API gives us the tools to retrieve it. By using the <code class="literal">esri/arcgis/utils</code> and <code class="literal">esri/request</code> modules, we can retrieve and work with our web map data.</p><p>To access our<a id="id925" class="indexterm"/> web map configuration data, we need two pieces of information: the URL of the site hosting the data and the web map ID. The URL of the service hosting the webmap data can be found in the <code class="literal">arcgisUrl</code> property of the <code class="literal">esri/arcgis/utils</code> module. By default, it points to <a class="ulink" href="http://www.arcgis.com/sharing/rest/content/items">http://www.arcgis.com/sharing/rest/content/items</a>, but if your webmaps are hosted in a private enterprise network in the ArcGIS portal, this URL string should be replaced with the appropriate URL for your portal service.</p><p>In our JavaScript code, we can combine the URL hosting the webmap data, along with the webmap ID, into a URL to access JSON data for our webmap. We can use the <code class="literal">esri/request</code> module to request the data from the URL and use it wherever we need in our application. A bit of sample code is shown in the following snippet:</p><div class="informalexample"><pre class="programlisting">require([…, "esri/arcgis/utils", "esri/request", …], 
  function (…, arcgisUtils, esriRequest, …) {
    …
    // replace fake webmapid value with real webmap id
    var webmapid = "d2klfnml2kjfklj2nfkjeh2ekrj";
    var url = arcgisUtils.arcgisUrl + "/" + webmapid + "/data";
    esriRequest({
      url: url,
      handleAs: "json", 
      content: {f: "json"}
    }).then(function (response) {
      console.log(response);
      // do something with the JSON data.
    });
    …
});</pre></div><p>If you look at the JSON results from our webmap, using either the map console or a JSON viewing plugin for the browser, you can see that the webmap data for our application includes map service layers, a background basemap, and even details about the configuration of our popups. There's a lot of potentially useful information in this response, should we need it.</p></div><div class="section" title="Interacting with the map through code"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec176"/>Interacting with the map through code</h2></div></div></div><p>In our <a id="id926" class="indexterm"/>previous version, we loaded <code class="literal">InfoTemplates</code> for each layer to define the format of the content displayed in the popups. Now that we have all that information defined through ArcGIS Online, we don't need to make the extra HTTP requests to load the HTML templates. You can click on the map and the popups will be ready to be used.</p><p>However, we run into a problem when we try to use our custom drop-down selectors to bring up the popups. In the older version, we would query the data, add an appropriate template, and insert it in the <code class="literal">InfoWindow</code>. Now, a user click pulls the appropriate data for us. But how can we click on the map without clicking on the map?</p><p>Using an <a id="id927" class="indexterm"/>undocumented trick, we can trigger a map-click event with our data. We could zoom to the feature extent on the map and trigger the map click event when it's done. This trick has been successfully deployed on a number of websites that use ArcGIS Online webmaps.</p><p>Look for the <code class="literal">_updateInfoWindowFromQuery()</code> method in the <code class="literal">Census.js</code> widget. It currently contains steps that set the map extent and fill in the contents of the map's <code class="literal">InfoWindow</code>. We'll keep the extent setting, but remove any references to <code class="literal">map.infoWindow</code>. Instead, inside the asynchronous callback function called after the map has changed extents, we'll add code to call the <code class="literal">map.onClick()</code> method to trigger the click event:</p><div class="informalexample"><pre class="programlisting">_updateInfoWindowFromQuery: function (results) {
  var resultExtent = graphicsUtils.graphicsExtent(results.features);
  <span class="strong"><strong>this.map.setExtent(resultExtent).then(lang.hitch(this, function () {</strong></span>
<span class="strong"><strong>  // do something</strong></span>
<span class="strong"><strong>  this.map.onClick();</strong></span>
<span class="strong"><strong>  }));</strong></span>
},</pre></div><p>The <code class="literal">map.onClick()</code> function requires an object with three properties: a graphic, a <code class="literal">mapPoint</code>, and a <code class="literal">screenPoint</code> that contains the coordinates of the point on the screen. We can use the first of our query results for the graphic that has been clicked. For a quick and dirty click location, we can use the center of the current extent, which we get from <code class="literal">resultExtent.getCenter()</code>. As for the corresponding <code class="literal">screenPoint</code> for our map point, the map has methods for converting geographic points to screen points and the other way around. We'll use the <code class="literal">map.toScreen()</code> method with the center point to get its coordinates on the screen. We'll then feed the results into the <code class="literal">map.onClick()</code> method, and test the application. The function should look like the following:</p><div class="informalexample"><pre class="programlisting">_updateInfoWindowFromQuery: function (results) {
  var resultExtent = graphicsUtils.graphicsExtent(results.features);
  this.map.setExtent(resultExtent).then(lang.hitch(this, function () {
  <span class="strong"><strong>var center = resultExtent.getCenter();</strong></span>
<span class="strong"><strong>  var centerScreen = this.map.toScreen(center);</strong></span>
  this.map.onClick(<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>      graphic: results.features[0],</strong></span>
<span class="strong"><strong>      mapPoint: center,</strong></span>
<span class="strong"><strong>      screenPoint: centerScreen</strong></span>
<span class="strong"><strong>    }</strong></span>);
  }));
},</pre></div><p>We can test the code by <a id="id928" class="indexterm"/>loading our application and clicking the <span class="strong"><strong>Census</strong></span> button. It should show our drop-down modals for the state, county, and block group data. When we select a state like California, it should query, zoom, and the popup should appear momentarily with the popups we configured earlier. Now, we have a fully functioning census application, while letting ArcGIS Online handle most of the work:</p><div class="mediaobject"><img src="graphics/6459OT_11_12.jpg" alt="Interacting with the map through code" width="792" height="511"/></div></div></div></div></div>
<div id="book-content"><div id="sbo-rt-content"><div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec107"/>Summary</h1></div></div></div><p>In this chapter, we have looked at the newest tools provided by ESRI for the ArcGIS platform: ArcGIS Online and Web AppBuilder. We have created a webmap using ArcGIS Online, adding layers, formatting them, and creating popups. We added the webmap to our own application.</p><p>Throughout this book, we've dived deep into the ArcGIS JavaScript API. We started by creating a simple webmap application, complete with click events and geographical data. You have learned how to use to tools provided by the API and the Dojo framework to build custom controls and modules that you could reuse from project to project. You then experimented with adding other JavaScript libraries, so that developers not so familiar with dojo could contribute. You learned how to edit geographical data through web applications. You also learned how to style your map applications for desktop and mobile use. You even learned how to unit test your code. Finally, you learned how ESRI is simplifying webmap development through ArcGIS Online and Web AppBuilder, bringing applications to the public faster. You have definitely come a long way.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>Where do you go from here? There are a number of great books, blogs, and other resources. You can find out about current trends in ArcGIS development through ESRI's forums at <a class="ulink" href="http://geonet.esri.com">http://geonet.esri.com</a>, or find support for the latest ArcGIS APIs at <a class="ulink" href="http://developers.arcgis.com">http://developers.arcgis.com</a>. For blogs, you can check out Dave Bouwman's blog at <a class="ulink" href="http://blog.davebouwman.com">http://blog.davebouwman.com</a>, or Rene Rubalcava at <a class="ulink" href="http://odoe.net">http://odoe.net</a>. For books, you may want learn about how to manage ArcGIS Server to serve your web maps with <span class="emphasis"><em>Managing ArcGIS for Server</em></span> by Hussein Nasser. You may also want to check out <span class="emphasis"><em>ArcGIS Web Development</em></span> by Rene Rubalcava, <span class="emphasis"><em>Developing Web and Mobile ArcGIS Server Applications with JavaScript</em></span> by Eric Pimpler, or <span class="emphasis"><em>Developing Mobile Web Applications</em></span> by Matthew Sheehan.</p></div></div></div></div></div></body></html>