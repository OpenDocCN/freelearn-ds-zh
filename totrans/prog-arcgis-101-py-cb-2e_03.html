<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 3. Managing Map Documents and Layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Managing Map Documents and Layers</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Referencing the current map document</li><li class="listitem" style="list-style-type: disc">Referencing map documents on disk</li><li class="listitem" style="list-style-type: disc">Accessing a data frame</li><li class="listitem" style="list-style-type: disc">Getting a list of layers in a map document</li><li class="listitem" style="list-style-type: disc">Restricting the list of layers</li><li class="listitem" style="list-style-type: disc">Changing the map extent</li><li class="listitem" style="list-style-type: disc">Getting a list of tables</li><li class="listitem" style="list-style-type: disc">Adding layers to a map document</li><li class="listitem" style="list-style-type: disc">Inserting layers into a map document</li><li class="listitem" style="list-style-type: disc">Updating layer symbology</li><li class="listitem" style="list-style-type: disc">Updating layer properties</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Introduction</h1></div></div></div><p>The ArcPy mapping module<a id="id210" class="indexterm"/> is new to ArcGIS 10<a id="id211" class="indexterm"/> and brings some really exciting features for mapping automation, including the ability to manage map documents and layer files as well as the data within these files. Support is provided for automating map export and printing, for the creation of PDF map books and publication of map documents to ArcGIS Server map services. This is an incredibly useful module for accomplishing many of the day-to-day tasks performed by GIS analysts.</p><p>In this chapter, you will learn how to use the ArcPy mapping module to manage map documents and layer files. You will learn how to add and remove geographic layers and tables from map document files, insert layers into data frames, and move layers around within the map document. Finally, you will learn how to update layer properties and symbology.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Referencing the current map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Referencing the current map document</h1></div></div></div><p>When running a geoprocessing script from the ArcGIS Python window or a custom script tool, you will often need to get a reference to the map document currently loaded in ArcMap. This is typically the first step in your script before you perform geoprocessing operations against layers and tables in a map document. In this recipe, you will learn how to reference the current <a id="id212" class="indexterm"/>
<a id="id213" class="indexterm"/>map document from your Python geoprocessing script.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Getting ready</h2></div></div></div><p>Before you can actually perform any operations on a map document file, you need to get a reference to it in your Python script. This is done by calling the <code class="literal">MapDocument()</code> method on the <code class="literal">arcpy.mapping</code> module. You can reference either the currently active document or a document at a specific location on disk. To reference the currently active document, you simply supply the keyword <code class="literal">CURRENT</code> as a parameter to the<a id="id214" class="indexterm"/> <code class="literal">MapDocument()</code> function. This gets the currently active document in ArcMap. The following code example shows how a reference to the currently active document is obtained:</p><div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>You can only use the <code class="literal">CURRENT</code> keyword<a id="id215" class="indexterm"/> when running a script from the ArcGIS Python window or a custom script tool. If you attempt to use this keyword when running a script from IDLE or any other development environment, it won't have access to the map document file currently loaded in ArcGIS. I should also point out that the <code class="literal">CURRENT</code> keyword is not case sensitive. You could just as easily use <code class="literal">current</code>.</p></div></div><p>To reference a map document on a local or remote drive, simply supply the path to the map document as well as the map document name as a parameter to <code class="literal">MapDocument()</code>. For example, you would reference the <code class="literal">crime.mxd</code> file in the <code class="literal">c:\data</code> folder with the following reference: <code class="literal">arcpy.mapping.MapDocument("C:/data/crime.mxd")</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec36"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to access the currently active map document in ArcMap:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module by typing the following into the Python window:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>) and assign the reference to a variable by typing the following into the Python Window below the first line of code that you added in the last step:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get the<a id="id216" class="indexterm"/><a id="id217" class="indexterm"/> title of the map document and print it out to the shell window. When the script executes, the title of the map document will be printed using the Python <code class="literal">print</code> statement:<div class="informalexample"><pre class="programlisting">print mxd.title</pre></div></li><li class="listitem">Set a new title for map document:<div class="informalexample"><pre class="programlisting">mxd.title = "Copy of Crime Project"</pre></div></li><li class="listitem">Save a copy of the map document file with the saveACopy() method.<div class="informalexample"><pre class="programlisting">mxd.saveACopy("c:/ArcpyBook/Ch3/crime_copy.mxd")</pre></div></li><li class="listitem">Run the script .</li><li class="listitem">In ArcMap open the <code class="literal">crime_copy.mxd</code> file that you just created and select <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Map Document Properties</strong></span> to view the new title you gave to the map document.</li></ol></div></div><div class="section" title="How it works"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec37"/>How it works</h2></div></div></div><p>
The <code class="literal">MapDocument</code> class<a id="id218" class="indexterm"/> has a constructor that creates an instance of this class. In object-oriented programming, an <span class="strong"><strong>instance</strong></span>
<a id="id219" class="indexterm"/> is also known as an <span class="strong"><strong>object</strong></span>
<a id="id220" class="indexterm"/>. The constructor for <code class="literal">MapDocument</code> can accept either the <code class="literal">CURRENT</code> keyword<a id="id221" class="indexterm"/> or a path to a map document file on a local or remote drive. The constructor creates an object and assigns it to the variable <code class="literal">mxd</code>. You can then access the properties and methods available on this object using dot notation. In this particular case, we've printed out the title of the map document file using the <code class="literal">MapDocument.title</code> property and we also used the <code class="literal">MapDocument.saveACopy()</code> method to save a copy of the map document file.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Referencing map documents on a disk"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Referencing map documents on a disk</h1></div></div></div><p>In addition to being <a id="id222" class="indexterm"/>
<a id="id223" class="indexterm"/>able to reference the currently active map document file in ArcMap, you can also access map document files stored on a local or remote drive using the <code class="literal">MapDocument()</code> method<a id="id224" class="indexterm"/>. In this recipe, you'll learn how to access these map documents.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Getting ready</h2></div></div></div><p>As I mentioned earlier, you can also reference a map document file that resides somewhere on your computer or a shared server. This is done simply by providing a path to the file. This is a more versatile way of obtaining a reference to a map document because it can be run outside the ArcGIS Python window or a custom script tool.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec39"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to access a map document stored on a local or remote drive:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the IDLE development environment from <span class="strong"><strong>Start</strong></span> | <span class="strong"><strong>Programs</strong></span> | <span class="strong"><strong>ArcGIS</strong></span> | <span class="strong"><strong>Python 2.7</strong></span> | <span class="strong"><strong>IDLE</strong></span>.</li><li class="listitem">Create a new IDLE script window by selecting <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>New Window</strong></span> from the IDLE shell window.</li><li class="listitem">Import <code class="literal">arcpy.mapping</code>:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the copy of the <code class="literal">crime</code> map document that you created in the last recipe:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("c:/ArcpyBook/Ch3/crime_copy.mxd")</pre></div></li><li class="listitem">Print the title of the map document:<div class="informalexample"><pre class="programlisting">print mxd.title</pre></div></li><li class="listitem">Run the script to see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Copy of Crime Project</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec40"/>How it works…</h2></div></div></div><p>The only difference between this recipe and the last is that we've provided a reference to a map document file on a local or remote drive rather than using the <code class="literal">CURRENT</code> keyword. This is the recommended way of referencing a map document file unless you know for sure that your geoprocessing script will be run inside ArcGIS, either in the Python window or as a custom script tool.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Accessing a data frame"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Accessing a data frame</h1></div></div></div><p>The ArcMap table of contents <a id="id225" class="indexterm"/>is composed of one or more data frames. Each data frame can contain layers and tables. Data frames can be used to filter lists that are returned from the various list functions such<a id="id226" class="indexterm"/> as <code class="literal">ListLayers()</code>. For example, a <code class="literal">DataFrame</code> object can be used as an input parameter to restrict the layers returned by the ListLayers() function to only those layers within a particular data frame. You can also use a DataFrame object to get or set the current map extent, which can be useful when creating map books. In this recipe you will learn how to access data frames from your Python scripts.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Getting ready</h2></div></div></div><p>The <code class="literal">ListDataFrames()</code> function<a id="id227" class="indexterm"/> returns a list of <code class="literal">DataFrame</code> objects. Each data frame can hold layers and tables and can be used to restrict the lists returned by the <code class="literal">ListLayers()</code> and<a id="id228" class="indexterm"/> <code class="literal">ListTablesViews()</code> functions. </p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec42"/>How to do it...</h2></div></div></div><p>Follow the steps below to learn how to get a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open c<code class="literal">:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Call the <code class="literal">ListDataFrames()</code> function and pass a reference to the map document along with a wildcard used to find only the data frames that begin with the letter <code class="literal">C</code>: <div class="informalexample"><pre class="programlisting">frames = mapping.ListDataFrames(mxd,"C*")</pre></div></li><li class="listitem">Start a <code class="literal">for</code> loop and print out the name of each layer in the map document:<div class="informalexample"><pre class="programlisting">for df in frames:
    print df.name</pre></div></li><li class="listitem">Run the script to see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Crime</strong></span>
<span class="strong"><strong>Crime_Inset</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec43"/>How it works...</h2></div></div></div><p>The<a id="id229" class="indexterm"/> <code class="literal">ListDataFrames()</code> function <a id="id230" class="indexterm"/>returns a list of all the data frames in the ArcMap table of contents. Like any other Python list, you can iterate through the contents of the list using a <code class="literal">for</code> loop. Inside the <code class="literal">for</code> loop, each data frame is dynamically assigned to the <code class="literal">df</code> variable and the name of the data frame is printed to the screen.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Getting a list of layers in a map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Getting a list of layers in a map document</h1></div></div></div><p>Frequently, one of the first steps in a geoprocessing script is to obtain a list of layers in the map document. Once obtained, your script might then cycle through each of the layers and perform some type of processing. The mapping module contains a <code class="literal">ListLayers()</code> function<a id="id231" class="indexterm"/> that provides the capability of obtaining this list of layers. In this recipe, you will learn how to get a list of layers contained within a map document.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Getting ready</h2></div></div></div><p>The <code class="literal">arcpy.mapping</code> module<a id="id232" class="indexterm"/>
<a id="id233" class="indexterm"/> contains various list functions to return lists of layers, data frames, broken data sources, table views, and layout elements. These list functions are normally the first step in a multi-step process, where the script needs to get one or more items from a list for further processing. Each of these list functions returns a Python list, which as you know from earlier in the book, is a highly functional data structure for storing information. </p><p>Normally, the list functions are used as part of a multi-step process, where creating a list is only the first step. Subsequent processing in the script will iterate over one or more of the items in this list. For example, you might obtain a list of layers in a map document and then iterate through each layer looking for a specific layer name, which will then be subject to further geoprocessing.</p><p>In this recipe, you will learn how to obtain a list of layers from a map document file.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec45"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to get a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Call the ListLayers() function and pass a reference to the map document: <div class="informalexample"><pre class="programlisting">layers = mapping.ListLayers(mxd)</pre></div></li><li class="listitem">Start a <code class="literal">for</code> loop and print out the name of each layer in the map document:<div class="informalexample"><pre class="programlisting">for lyr in layers:
    print lyr.name</pre></div></li><li class="listitem">Run the <a id="id234" class="indexterm"/><a id="id235" class="indexterm"/>script to see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Burglaries in 2009</strong></span>
<span class="strong"><strong>Crime Density by School District</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
<span class="strong"><strong>Test Performance by School District</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
<span class="strong"><strong>Texas Counties</strong></span>
<span class="strong"><strong>School_Districts</strong></span>
<span class="strong"><strong>Crime Surface</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec46"/>How it works…</h2></div></div></div><p>The <code class="literal">ListLayers()</code> function<a id="id236" class="indexterm"/> retrieves a list of layers in a map document, a specific data frame, or a layer file. In this case, we passed a reference to the current map document to the <code class="literal">ListLayers()</code> function, which will retrieve a list of all layers in the map document. The results will be stored in a variable called <code class="literal">layers</code>, which is a Python list that can be iterated with a <code class="literal">for</code> loop. This Python list contains one or more <code class="literal">Layer</code> objects.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec47"/>There's more…</h2></div></div></div><p>The <code class="literal">ListLayers()</code> function is only one of many list functions provided by the <code class="literal">arcpy mapping</code> module. Each of these functions returns a Python list containing data of some type. Some of the other list functions include<a id="id237" class="indexterm"/> <code class="literal"> ListTableViews()</code>, which returns a list of <code class="literal">Table</code> objects, <code class="literal"> ListDataFrames() </code> <a id="id238" class="indexterm"/>which returns a list of <code class="literal">DataFrame</code> objects, and <a id="id239" class="indexterm"/> <code class="literal">ListBookmarks()</code> which returns a list of bookmarks in a map document. There are additional list functions, many of which we'll cover later in the book.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Restricting the list of layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Restricting the list of layers</h1></div></div></div><p>In the previous recipe, you <a id="id240" class="indexterm"/>learned how to get a list of layers using the <code class="literal">ListLayers()</code> function. There will be times when you will not want a list of all the layers in a map document, but rather only a subset of the layers. The <a id="id241" class="indexterm"/> <code class="literal">ListLayers()</code> function allows you to restrict the list of layers that is generated. In this recipe, you will learn how to restrict the layers returned using a wildcard and a specific data frame from the ArcMap table of contents.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec48"/>Getting ready</h2></div></div></div><p>By default, if you only pass a reference to the map document or layer file, the <code class="literal">ListLayers()</code> function will return a list of all the layers in these files. However, you can restrict the list of layers returned by this function through the use of an optional wildcard parameter or by passing in a reference to a specific data frame.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>If you're working with a layer file (<code class="literal">.lyr</code>), you can't restrict layers with a data frame. Layer files don't support data frames.</p></div></div><p>In this recipe, you will learn how to restrict the list of layers returned by <code class="literal">ListLayers()</code> through the use of a wildcard and data frame.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec49"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to restrict a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a list of data frames in the map document and search for a specific data frame name of <code class="literal">Crime</code>. Please note that text strings can be surrounded by either single or double quotes:<div class="informalexample"><pre class="programlisting">for df in mapping.ListDataFrames(mxd):
  if (df.name == 'Crime'):</pre></div></li><li class="listitem">Call the <code class="literal">ListLayers()</code> function and pass a reference to the map document, a wildcard to restrict the search, and the data frame found in the last step to further restrict the search. The <code class="literal">ListLayers()</code> function should be indented inside the <code class="literal">if</code> statement you just created:<div class="informalexample"><pre class="programlisting">layers = mapping.ListLayers(mxd,'Burg',df)</pre></div></li><li class="listitem">Start a <code class="literal">for</code> loop and print out the name of each layer in the map document.<div class="informalexample"><pre class="programlisting">for layer in layers:
    print layer.name</pre></div></li><li class="listitem">The complete <a id="id242" class="indexterm"/>script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
for df in mapping.ListDataFrames(mxd):
  if (df.name == 'Crime'):
        layers = mapping.ListLayers(mxd,"'Burg*',df)
        for layer in layers:
      print layer.name</pre></div></li><li class="listitem">Run the script to see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Burglaries in 2009</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec50"/>How it works…</h2></div></div></div><p>As you learned in a previous recipe, the <code class="literal">ListDataFrames()</code> function<a id="id243" class="indexterm"/> is another list function provided by <code class="literal">arcpy mapping</code>. This function returns a list of all the data frames in a map document. We then loop through each of the data frames returned by this function, looking for a data frame that has the name <code class="literal">Crime</code>. If we do find a data frame that has this name, we call the <code class="literal">ListLayers()</code> function, passing in the optional wildcard value of <code class="literal">Burg*</code> as the second parameter, and a reference to the <code class="literal">Crime</code> data frame. The wildcard value passed in as the second parameter accepts any number of characters and an optional wildcard character (<code class="literal">*</code>). </p><p>In this particular recipe, we're searching for all the layers that begin with the characters <code class="literal">Burg</code> and that have a data frame name of <code class="literal">Crime</code>. Any layers found matching these restrictions are then printed. Keep in mind that all we're doing in this case is printing the layer names, but in most cases, you would be performing additional geoprocessing through the use of tools or other functions. </p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Changing the map extent"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Changing the map extent</h1></div></div></div><p>There will be many occasions<a id="id244" class="indexterm"/> when you will need to change the map extent. This is frequently the case when you are automating the map production process and need to create many maps of different areas or features. There are a number of ways that the map extent can be changed with <code class="literal">arcpy</code>. But, for this recipe, we'll concentrate on using a definition expression to change the extent.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec51"/>Getting ready</h2></div></div></div><p>The <code class="literal">DataFrame</code> class<a id="id245" class="indexterm"/> has an <code class="literal">extent</code> property<a id="id246" class="indexterm"/> that you can use to set the geographic extent. This is often used in conjunction with the <code class="literal">Layer.definitionQuery</code> property that is used to define a definition query for a layer. In this recipe, you will learn how to use these objects and properties to change the map extent. </p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec52"/>How to do it...</h2></div></div></div><p>Follow these steps to learn how to get a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>), and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Create a <code class="literal">for</code> loop that will loop through all the data frames in the map document:<div class="informalexample"><pre class="programlisting">for df in mapping.ListDataFrames(mxd):</pre></div></li><li class="listitem">Find the data frame called <code class="literal">Crime</code> and a specific layer that we'll apply the definition query against:<div class="informalexample"><pre class="programlisting">if (df.name == 'Crime'):
  layers = mapping.ListLayers(mxd,'Crime Density by 
  School District',df)</pre></div></li><li class="listitem">Create a <code class="literal">for</code> loop that will loop through the layers. There will only be one, but we'll create the loop anyway. In the <code class="literal">for</code> loop, create a definition query and set the new extent of the data frame:<div class="informalexample"><pre class="programlisting">for layer in layers:
  query = '"NAME" = \'Lackland ISD\''
  layer.definitionQuery = query
  df.extent = layer.getExtent()</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
for df in mapping.ListDataFrames(mxd):
  if (df.name == 'Crime'):
    layers = mapping.ListLayers(mxd,'Crime Density by School District',df)
  for layer in layers:
      query = '"NAME" = \'Lackland ISD\''
      layer.definitionQuery = query
      df.extent = layer.getExtent()</pre></div></li><li class="listitem">Save and run <a id="id247" class="indexterm"/>the script. The extent of the data view should update to visualize only the features matching the definition expression, as shown in the following screenshot:<div class="mediaobject"><img src="images/4445OT_03_14.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec53"/>How it works...</h2></div></div></div><p>This recipe used a definition query on a layer to update the map extent. Near the end of the script, you created a <a id="id248" class="indexterm"/>new variable called <code class="literal">query</code> that holds the definition expression. The definition expression is set up to find school districts with a name of <code class="literal">Lackland ISD</code>. This query string is then applied to the <code class="literal">definitionQuery</code> property. Finally, the <code class="literal">df.extent</code> property is set to the returned value of <code class="literal">layer.getExtent()</code>.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Getting a list of tables"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Getting a list of tables</h1></div></div></div><p>The <code class="literal">arcpy.mapping</code> module also has a <code class="literal">ListTableViews()</code> function<a id="id249" class="indexterm"/> that you can use to obtain a list of standalone tables that are contained within a map document. In this recipe, you will learn how to use the <code class="literal">ListTableViews()</code> function to create this list of tables.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec54"/>Getting ready</h2></div></div></div><p>In addition to providing the ability to<a id="id250" class="indexterm"/> generate a list of layers in a map document or data frame, the <code class="literal">arcpy mapping</code> module also provides a <code class="literal">ListTableViews()</code> function that generates a list of tables.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>
<code class="literal">ListTableViews()</code> only works with map document files and the data frames contained within. Layer files do not have the capability of holding tables.</p></div></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec55"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to get a list of standalone tables in a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>), and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Generate a list of tables in the map document:<div class="informalexample"><pre class="programlisting">for tableView in mapping.ListTableViews(mxd):
    print tableView.name</pre></div></li><li class="listitem">Run the script to see the following output:.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Crime2009Table</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec56"/>How it works…</h2></div></div></div><p>The <code class="literal">ListTableViews()</code> function<a id="id251" class="indexterm"/> is very similar to the other list functions provided by <code class="literal">arcpy.mapping</code>. As was the case <a id="id252" class="indexterm"/>with <code class="literal">ListLayers()</code>, the <code class="literal">ListTableViews()</code> function accepts a reference to a map document (but not a layer file), along with an optional wildcard and data frame parameters. The output is a list of tables that can be iterated with a <code class="literal">for</code> loop.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Adding layers to a map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Adding layers to a map document</h1></div></div></div><p>There will be many <a id="id253" class="indexterm"/>
<a id="id254" class="indexterm"/>situations where you will need to add a layer to a map document. The mapping module provides this functionality through the <code class="literal">AddLayer()</code> function<a id="id255" class="indexterm"/>. In this recipe, you will learn how to add a layer to a map document using this function.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec57"/>Getting ready</h2></div></div></div><p>
<code class="literal">arcpy.mapping</code> provides the ability to add layers or group layers into an existing map document file. You can take advantage of the ArcMap "auto-arrange" functionality, which automatically places a layer in the data frame for visibility. This is essentially the same functionality provided by the <span class="strong"><strong>Add Data</strong></span> button in ArcMap, which positions a layer in the data frame based on geometry type and layer weight rules. </p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Layers can't be added to a layer file (<code class="literal">.lyr</code>).</p></div></div><p>When adding a layer to a map document, the layer must reference an existing layer found in a layer file on disk, the same map document and data frame, the same map document with a different data frame, or a completely separate map document. A layer can be either a layer in a map document or a layer in a <code class="literal">.lyr</code> file. To add a layer to a map document, you must first create an instance of the <code class="literal">Layer</code> class and then call the <code class="literal">AddLayer()</code> function, passing in the new layer along with the data frame where it should be placed and rules for how it is to be positioned. </p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec58"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to add a layer to a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>), and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame, which is the first data frame in the list returned by <code class="literal">ListDataFrames()</code>. The <code class="literal">[0]</code> specified at the end of the code gets the first data frame returned from the <code class="literal">ListDataFrames()</code> method, which returns a list of data frames. Lists are zero-based, so to retrieve the first data frame we provide an index of <code class="literal">0</code>.<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd)[0]</pre></div></li><li class="listitem">Create a <code class="literal">Layer</code> object that references a <code class="literal">.lyr</code> file.<div class="informalexample"><pre class="programlisting">layer = mapping.Layer(r"C:\ArcpyBook\data\School_Districts.lyr")</pre></div></li><li class="listitem">Add the <a id="id256" class="indexterm"/><a id="id257" class="indexterm"/>layer to the data frame:<div class="informalexample"><pre class="programlisting">mapping.AddLayer(df,layer,"AUTO_ARRANGE")</pre></div></li><li class="listitem">Run the script. The <code class="literal">School_District.lyr</code> file will be added to the data frame, as shown in the following screenshot:<div class="mediaobject"><img src="images/4445_03_11.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec59"/>How it works…</h2></div></div></div><p>In the first two lines, <a id="id258" class="indexterm"/>
<a id="id259" class="indexterm"/>we simply reference the <code class="literal">arcpy.mapping</code> module and get a reference to the currently active map document. Next, we create a new variable called <code class="literal">df</code>, which holds a reference to the <code class="literal">Crime</code> data frame. This is obtained through the <code class="literal">ListDataFrames()</code> function<a id="id260" class="indexterm"/> that returns a list of data frame objects. We then use list access to return the first item in the list, which is the <code class="literal">Crime</code> data frame. A new <code class="literal">Layer</code> instance, called <code class="literal">layer</code> is then created from a <code class="literal">layer</code> file stored on disk. This <code class="literal">layer</code> file is called <code class="literal">School_Districts.lyr</code>. Finally, we call the <code class="literal">AddLayer()</code> function, passing in the data frame where the layer will reside along with a reference to the layer, and a parameter indicating that <a id="id261" class="indexterm"/>
<a id="id262" class="indexterm"/>we would like to use the <span class="strong"><strong>auto-arrange</strong></span> feature<a id="id263" class="indexterm"/>. In addition to allowing ArcMap to automatically place the layer into the data frame using auto-arrange, you can also specifically place the layer at either the top or bottom of the data frame or a group layer using the <code class="literal">BOTTOM</code> or <code class="literal">TOP</code> position.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec60"/>There's more…</h2></div></div></div><p>In addition to providing the capability of adding a layer to a map document, <code class="literal">arcpy.mapping</code> also provides an <code class="literal">AddLayerToGroup()</code> function<a id="id264" class="indexterm"/>, which can be used to add a layer to a group layer. The layer can be added to the top or bottom of the group layer or you can use auto-arrange for placement. You may also add layers to an empty group layer. However, just as with regular layer objects, group layers cannot be added to a layer file. </p><p>Layers can also be removed from a data frame or group layer. <code class="literal">RemoveLayer()</code> is the function used to remove a layer or group layer. In the event that two layers have the same name, only the first is removed unless your script is set up to iterate.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Inserting layers into a map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Inserting layers into a map document</h1></div></div></div><p>The <code class="literal">AddLayer()</code> function<a id="id265" class="indexterm"/> can be used to add a layer to a map document either through auto-arrange or as the first or last layer in a data frame. However, it doesn't provide the control you need for inserting a layer in a specific position within a data frame. For this added control, you can use the <code class="literal">InsertLayer()</code> function. In this recipe, you will learn how to control the placement of layers added to a data frame.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec61"/>Getting ready</h2></div></div></div><p>The <code class="literal">AddLayer()</code> function simply adds a <a id="id266" class="indexterm"/>
<a id="id267" class="indexterm"/>layer into a data frame or a group layer, and places the layer automatically using auto-arrange or specific placement at the top or bottom of the data frame or group layer. The <code class="literal">InsertLayer()</code> method<a id="id268" class="indexterm"/> allows for more precise positioning of a new layer into a data frame or a group layer. It uses a reference layer to specify a location and the layer is added either before or after the reference layer, as specified in your code. Since <code class="literal">InsertLayer()</code> requires the use of a reference layer, you can't use this method on an empty data frame. </p><p>This is illustrated in the following screenshot, where <code class="literal">District_Crime_Join</code> is the reference layer <code class="literal">and School_Districts</code> is the layer to be added. The <code class="literal">School_Districts</code> layer can be placed either before or after the reference layer using <code class="literal">InsertLayer()</code>.</p><div class="mediaobject"><img src="images/4445_03_1.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec62"/>How to do it…</h2></div></div></div><p>Follow these steps to<a id="id269" class="indexterm"/>
<a id="id270" class="indexterm"/> learn how to use <code class="literal">InsertLayer()</code> to insert a layer into a data frame:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>), and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Define the reference layer:<div class="informalexample"><pre class="programlisting">refLayer = mapping.ListLayers(mxd, "Burglaries*", df)[0]</pre></div></li><li class="listitem">Define the layer to be inserted relative to the reference layer:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>insertLayer = mapping.Layer(r"C:\ArcpyBook\data\CityOfSanAntonio.gdb\Crimes2009")</strong></span>
</pre></div></li><li class="listitem">Insert the layer into the data frame:<div class="informalexample"><pre class="programlisting">mapping.InsertLayer(df,refLayer,insertLayer,"BEFORE")</pre></div></li><li class="listitem">Run the script. The <code class="literal">Crimes2009</code> feature class will be added as a layer to the data frame as seen in the following screenshot:<div class="mediaobject"><img src="images/4445_03_12.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec63"/>How it works…</h2></div></div></div><p>After obtaining <a id="id271" class="indexterm"/>
<a id="id272" class="indexterm"/>references to the <code class="literal">arcpy.mapping</code> module, current map document file, and the <code class="literal">Crime</code> data frame, our script then defines a reference layer. In this case, we use the <code class="literal">ListLayers()</code> function<a id="id273" class="indexterm"/> with a wildcard of <code class="literal">Burglaries*</code>, and the <code class="literal">Crime</code> data frame to restrict the list of layers returned to only one item. This item will be the <span class="strong"><strong>Burglaries in 2009</strong></span> layer. We use Python list access with a value of <code class="literal">0</code> to retrieve this layer from the list and assign it to a <code class="literal">Layer</code> object. Next, we define the insert layer, which is a new <code class="literal">Layer</code> object that references the <span class="strong"><strong>Crimes2009</strong></span> feature class from the <code class="literal">CityOfSanAntonio</code> geodatabase database. Finally, we call the <code class="literal">InsertLayer()</code> function<a id="id274" class="indexterm"/> passing in the data frame, reference layer, layer to be inserted, and keyword indicating that the layer to be inserted should be placed before the reference layer. This is illustrated in the following screenshot:</p><div class="mediaobject"><img src="images/4445_03_2.jpg" alt="How it works…"/></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec64"/>There's more…</h2></div></div></div><p>You can also reposition a layer that is already in a data frame or a group layer. The <code class="literal">MoveLayer()</code> function<a id="id275" class="indexterm"/> provides the ability to reposition the layer within a data frame or a group layer. Movement of a layer must be within the same data frame. You can't move a layer from one data frame to another. Just as<a id="id276" class="indexterm"/> with <code class="literal">InsertLayer()</code>, <code class="literal">MoveLayer()</code> uses a reference layer to reposition the layer. </p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Updating layer symbology"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Updating layer symbology</h1></div></div></div><p>There may be times when<a id="id277" class="indexterm"/>
<a id="id278" class="indexterm"/> you will want to change the symbology of a layer in a map document. This can be accomplished through the use of the<a id="id279" class="indexterm"/> <code class="literal">UpdateLayer()</code> function, which can be used to change the symbology of a layer as well as various properties of a layer. In this recipe, you will use the <code class="literal">UpdateLayer()</code> function to update the symbology of a layer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec65"/>Getting ready</h2></div></div></div><p>The <code class="literal">arcpy.mapping</code> module also gives you the capability of updating layer symbology from your scripts by using the <code class="literal">UpdateLayer()</code> function. For example, you might want your script to update a layer's symbology from a graduated color to a graduated symbol, as illustrated in the following screenshot. <code class="literal">UpdateLayer()</code> can also be used to update various layer properties, but the default functionality is to update the symbology. Because <code class="literal">UpdateLayer()</code> is a robust function capable of altering both symbology and properties, you do need to understand the various parameters that can be supplied as an input.</p><div class="mediaobject"><img src="images/4445_03_3.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec66"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to update the symbology of a layer using <code class="literal">UpdateLayer()</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch3\Crime_Ch3.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar. </li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>), and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Define the layer that will be updated:<div class="informalexample"><pre class="programlisting">updateLayer = mapping.ListLayers(mxd,"Crime Density by School District",df)[0]</pre></div></li><li class="listitem">Define the layer that will be used to update the symbology:<div class="informalexample"><pre class="programlisting">sourceLayer = mapping.Layer(r"C:\ArcpyBook\data\CrimeDensityGradSym.lyr")</pre></div></li><li class="listitem">Call the <code class="literal">UpdateLayer()</code> function to update the symbology:<div class="informalexample"><pre class="programlisting">mapping.UpdateLayer(df,updateLayer,sourceLayer,True)</pre></div></li><li class="listitem">Run the <a id="id280" class="indexterm"/><a id="id281" class="indexterm"/>script. The <span class="strong"><strong>Crime Density by School District</strong></span> layer will now be symbolized with graduated symbols instead of graduated colors, as shown in the following screenshot:<div class="mediaobject"><img src="images/4445_03_13.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec67"/>How it works…</h2></div></div></div><p>In this recipe, we used the <code class="literal">UpdateLayer()</code> function<a id="id282" class="indexterm"/> to update the symbology of a layer. We didn't update any properties, but we'll do so in the next recipe. The <code class="literal">UpdateLayer()</code> function requires that you pass several parameters including a data frame, layer to be updated, and a reference layer from which the symbology will be pulled and applied to update the layer. In our code, the <code class="literal">updateLayer</code> variable holds a reference to the <span class="strong"><strong>Crime Density by School District</strong></span> layer, which will have its symbology updated. The source layer from which the symbology will be pulled and applied to the update layer is a layer file (<code class="literal">CrimeDensityGradSym.lyr</code>) containing graduated symbols. </p><p>To update the <a id="id283" class="indexterm"/>
<a id="id284" class="indexterm"/>symbology for a layer, you must first ensure that the update layer and the source layer have the same geometry (point, line, and polygon). You also need to check that the attribute definitions are the same, in some cases, depending upon the renderer. For example, graduated color symbology and graduated symbols are based on a particular attribute. In this case, both the layers have polygon geometry and have a <code class="literal">CrimeDens</code> field containing crime density information. </p><p>Once we have references to both layers, we call the<a id="id285" class="indexterm"/> <code class="literal">UpdateLayer()</code> function, passing in the data frame and layers along with a fourth parameter that indicates that we're updating symbology only. We've supplied a <code class="literal">True</code> value as this fourth parameter, indicating that we only want to update the symbology and not properties.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mapping.UpdateLayer(df,updateLayer,sourceLayer,True)</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>There's more...</h2></div></div></div><p>
<code class="literal">UpdateLayer()</code> also provides the ability to remove one layer and add another layer in its place. The layers can be completely unrelated, so there is no need to ensure the same geometry type and attribute field as you would when redefining the symbology of a layer. This switching of layers essentially executes a call to <code class="literal">RemoveLayer()</code> and then a call to <code class="literal">AddLayer()</code> as one operation. To take advantage of this functionality you must set the <code class="literal">symbology_only</code> parameter to <code class="literal">False</code>.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Updating layer properties"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Updating layer properties</h1></div></div></div><p>In the previous recipe, you <a id="id286" class="indexterm"/>
<a id="id287" class="indexterm"/>learned how to update the symbology of a layer. As I mentioned, <code class="literal">UpdateLayer()</code> can also be used to update various properties of a layer, such as field aliases, query definitions, and others. In this recipe, you will use <code class="literal">UpdateLayer()</code> to alter various properties of a layer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec69"/>Getting ready</h2></div></div></div><p>You can also use the <code class="literal">UpdateLayer()</code> function<a id="id288" class="indexterm"/> to update a limited number of layer properties. Specific layer properties, such as field aliases, selection symbology, query definitions, label fields, and others, can be updated using <code class="literal">UpdateLayer()</code>. A common scenario is to have a layer in many map documents that needs to have a specific property changed across all the instances of the layer in all map documents. To accomplish this, you will have to use ArcMap to modify the layer with the appropriate properties and save it to a layer file. This layer file then becomes the source layer, which will be used to update the properties of another layer called <code class="literal">update_layer</code>. In this recipe, you'll use ArcMap to alter the properties of a layer, save to a layer file (<code class="literal">.lyr</code>), and then use Python to write a script that uses <code class="literal">UpdateLayer()</code> to apply the properties to another layer.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec70"/>How to do it…</h2></div></div></div><p>Follow these steps to<a id="id289" class="indexterm"/>
<a id="id290" class="indexterm"/> learn how to update layer properties with <code class="literal">UpdateLayer()</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open c<code class="literal">:\ArcpyBook\Ch3\Crime_Ch3.mxd </code>with ArcMap. For this recipe, you will be working with the <span class="strong"><strong>Burglaries in 2009</strong></span> feature class, as shown in the following screenshot:<div class="mediaobject"><img src="images/4445_03_4.jpg" alt="How to do it…"/></div></li><li class="listitem">Double-click on the <span class="strong"><strong>Burglaries in 2009</strong></span> feature class in the <span class="strong"><strong>Crime</strong></span> data frame to display the <span class="strong"><strong>Layer Properties</strong></span> window, as shown in the following screenshot. Each of the tabs represents properties that can be set for the layer:<div class="mediaobject"><img src="images/4445_03_5_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on the <a id="id291" class="indexterm"/><a id="id292" class="indexterm"/><span class="strong"><strong>General</strong></span> tab and change the value in the <span class="strong"><strong>Layer Name</strong></span> textbox to the name shown in the following screenshot:<div class="mediaobject"><img src="images/4445_03_8_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on the <a id="id293" class="indexterm"/><a id="id294" class="indexterm"/> <span class="strong"><strong>Definition Query</strong></span> tab and define the query shown in the following screenshot. You can use the <span class="strong"><strong>Query Builder</strong></span> to define the query or simply type in the query:<div class="mediaobject"><img src="images/4445_03_6_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Change<a id="id295" class="indexterm"/><a id="id296" class="indexterm"/> the alias of the <code class="literal">OFFDESC</code> field to <code class="literal">Offense Description</code> as shown in the preceding screenshot.</li><li class="listitem">Click on the <span class="strong"><strong>Fields</strong></span> tab in <span class="strong"><strong>Layer Properties</strong></span> and make visible only those fields that are selected with a checkmark in the following screenshot. This is done by unchecking the fields you see in the following screenshot.<div class="mediaobject"><img src="images/4445_03_7.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on <a id="id297" class="indexterm"/><a id="id298" class="indexterm"/><span class="strong"><strong>OK</strong></span> to dismiss the <span class="strong"><strong>Layer Properties</strong></span> dialog.</li><li class="listitem">In the data frame, right-click on <span class="strong"><strong>Burglaries – No Forced Entry</strong></span> and select <span class="strong"><strong>Save as Layer File</strong></span>.</li><li class="listitem">Save the file as <code class="literal">c:\ArcpyBook\data\BurglariesNoForcedEntry.lyr</code>.</li><li class="listitem">Right-click on the <span class="strong"><strong>Burglaries – No Forced Entry</strong></span> layer and select <span class="strong"><strong>Remove</strong></span>.</li><li class="listitem">Using the <span class="strong"><strong>Add Data</strong></span> button in ArcMap, add the <span class="strong"><strong>Crimes2009</strong></span> feature class from the <code class="literal">CityOfSanAntonio</code> geodatabase. The <code class="literal">feature</code> class will be added to the data frame, as shown in the following screenshot:<div class="mediaobject"><img src="images/4445_03_9.jpg" alt="How to do it…"/></div></li><li class="listitem">Open the <a id="id299" class="indexterm"/><a id="id300" class="indexterm"/>Python window in ArcMap.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch3.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Define the layer that will be updated:<div class="informalexample"><pre class="programlisting">updateLayer = mapping.ListLayers(mxd,"Crimes2009",df)[0]</pre></div></li><li class="listitem">Define the layer that will be used to update the properties:<div class="informalexample"><pre class="programlisting">sourceLayer = mapping.Layer(r"C:\ArcpyBook\data\BurglariesNoForcedEntry.lyr")</pre></div></li><li class="listitem">Call the <code class="literal">UpdateLayer()</code> function to update the symbology:<div class="informalexample"><pre class="programlisting">mapping.UpdateLayer(df,updateLayer,sourceLayer,False)</pre></div></li><li class="listitem">Run the script.</li><li class="listitem">The <span class="strong"><strong>Crimes2009</strong></span> layer will be updated with the properties associated with the <code class="literal">BurglariesNoForcedEntry.lyr</code> file. This is illustrated in the following screenshot. Turn on the layer to view the definition query that has been applied. You can also open the <span class="strong"><strong>Layer Properties</strong></span> dialog to view the property <a id="id301" class="indexterm"/><a id="id302" class="indexterm"/>changes that have been applied to the <span class="strong"><strong>Crimes2009</strong></span> feature class:<div class="mediaobject"><img src="images/4445_03_10.jpg" alt="How to do it…"/></div></li></ol></div></div></div></div>
</body></html>