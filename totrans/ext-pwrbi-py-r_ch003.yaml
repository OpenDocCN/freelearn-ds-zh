- en: 2 Configuring R with Power BI
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2 配置 R 与 Power BI
- en: Power BI Desktop is not equipped with the analytical language engines presented
    in the previous chapter by default. Therefore, it is necessary to install these
    engines and properly configure Power BI Desktop to correctly interface with them.
    It is also recommended to install an **Integrated Development Environment** (**IDE**),
    enabling you to work in the way you are most comfortable.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Power BI Desktop 默认没有配备上一章中提到的分析语言引擎。因此，有必要安装这些引擎并正确配置 Power BI Desktop 以正确地与它们接口。还建议安装一个**集成开发环境**（**IDE**），让你能够以最舒适的方式工作。
- en: We’ll look at how to get those engines up and running and give you some general
    guidelines on how to pick the most appropriate one for your needs. After that,
    we'll look at how to make these engines interface with both Power BI Desktop and
    the Power BI service.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将探讨如何启动这些引擎，并给你一些关于如何根据你的需求选择最合适的引擎的一般指南。之后，我们将探讨如何使这些引擎与 Power BI Desktop
    和 Power BI 服务接口。
- en: Finally, we will give some important tips on how to overcome some stringent
    limitations of R visuals on the Power BI service.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将提供一些关于如何克服 Power BI 服务上 R 可视化严格限制的重要提示。
- en: 'In particular, this chapter will deal in detail with the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 尤其是本章将详细讨论以下主题：
- en: The available R engines
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用的 R 引擎
- en: Choosing an R engine to install
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择要安装的 R 引擎
- en: Installing an IDE for R development
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 R 开发用的 IDE
- en: Configuring Power BI Desktop to work with R
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 Power BI Desktop 以使用 R
- en: Configuring the Power BI service to work with R
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 Power BI 服务以使用 R
- en: Limitations of R visuals
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R 可视化的限制
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires you to have a working internet connection and **Power
    BI Desktop** already installed on your machine. It also requires you to have signed
    up for the Power BI service in the last part of the chapter (here’s a how-to:
    [http://bit.ly/signup-powerbiservice](http://bit.ly/signup-powerbiservice)). A
    **Power BI free** license is enough to test all the code in this book, as you
    will share reports only in your personal **workspace**.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求你有一个工作的互联网连接，并且你的机器上已经安装了**Power BI Desktop**。它还要求你在本章的最后部分注册了 Power BI
    服务（这里有一个教程：[http://bit.ly/signup-powerbiservice](http://bit.ly/signup-powerbiservice))。一个**Power
    BI 免费版**许可证就足够测试本书中的所有代码，因为你将仅在个人**工作区**中共享报告。
- en: The available R engines
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可用的 R 引擎
- en: There is more than one R distribution available on the market that you can use
    for free for your advanced analytics projects. In this section, we'll explore
    the main details of each of them.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 市面上有多个 R 发行版可供免费使用，你可以用于你的高级分析项目。在本节中，我们将探索每个的主要细节。
- en: The CRAN R distribution
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: CRAN R 发行版
- en: When it comes to installing the R engine, we almost always think of the open
    source software environment *par excellence*, developed by a collective of contributors
    over the years, known as **CRAN R**, also called **base R** ([https://cran.r-project.org](https://cran.r-project.org)).
    To be exact, the **Comprehensive R Archive Network** (**CRAN**) is a network of
    web servers and FTP servers around the world, whose goal is to preserve multiple
    identical and up-to-date versions of the R source code and the entire ecosystem
    of R packages developed by the community, along with all the R documentation.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 当提到安装 R 引擎时，我们几乎总是想到由一群贡献者多年共同开发的开源软件环境**出类拔萃**，这个环境被称为**CRAN R**，也称为**base
    R**([https://cran.r-project.org](https://cran.r-project.org))。更确切地说，**综合 R 存档网络**（**CRAN**）是一个全球范围内的网络，包括网页服务器和
    FTP 服务器，其目标是保存多个相同且最新的 R 源代码版本以及社区开发的整个 R 包生态系统，以及所有的 R 文档。
- en: One of the biggest advantages of CRAN R is its very active community of developers.
    Their contribution to the creation of new packages on CRAN is invaluable. That's
    why if you think you need a particular feature to process your data, it's almost
    certain that it has already been developed by the R community and released as
    a free usable R package.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: CRAN R 最大的优点之一是其非常活跃的开发者社区。他们对 CRAN 上新包创建的贡献是无价的。这就是为什么如果你认为你需要某个特定功能来处理你的数据，几乎可以肯定的是，它已经被
    R 社区开发并作为免费可用的 R 包发布。
- en: However, not everyone knows that CRAN R is not the only R distribution available
    on the market.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，并非每个人都了解 CRAN R 不是市场上唯一的 R 发行版。
- en: The Microsoft R Open distribution and MRAN
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 微软 R Open 发行版和 MRAN
- en: Even Microsoft has contributed to the community by releasing its own open source
    R "distro" for both Windows and Linux, under the terms of the *General Public
    License version 2*. Starting from 2016, Microsoft has released its own distributions
    of R, called **Microsoft R Open** (**MRO**) and sometimes referred to simply as
    **Microsoft R**, which reflects the same versions released by CRAN R and is 100%
    compatible with it.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 即使微软也通过发布适用于Windows和Linux的自己的开源R“发行版”，在**通用公共许可证版本2**的条款下对社区做出了贡献。从2016年开始，微软发布了其自己的R发行版，称为**Microsoft
    R Open**（**MRO**），有时简称为**Microsoft R**，它与CRAN R发布的版本相同，并且100%兼容。
- en: '**Important note**'
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: If you take any code written in CRAN R, using any CRAN package, and run it with
    the same version of the MRO engine, everything will work fine.
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果你使用任何CRAN包编写的代码，并使用相同版本的MRO引擎运行，一切都会正常工作。
- en: In addition, there are only a few Microsoft-owned functions (including **RevoUtils**
    and **RevoUtilsMath**) that return information about the engine installation (such
    as path and memory usage) and the maximum number of threads that the **Math Kernel
    Library** (**MKL**) can run.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，只有少数由微软拥有的函数（包括**RevoUtils**和**RevoUtilsMath**）返回有关引擎安装（如路径和内存使用）以及**数学内核库**（**MKL**）可以运行的最大线程数的信息。
- en: 'The benefit of the MRO release was that it brought important improvements for
    the R community:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: MRO发布的优势在于它为R社区带来了重要的改进：
- en: The multi-threaded **Intel MKL** included out of the box
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预装的多线程**Intel MKL**
- en: A high-performance mirror of the CRAN repository, called **Microsoft R Application
    Network** (**MRAN**, [https://mran.microsoft.com](https://mran.microsoft.com)),
    that gives you a “time machine” tool to get a snapshot of CRAN packages at the
    selected time
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Microsoft R应用程序网络**（**MRAN**，[https://mran.microsoft.com](https://mran.microsoft.com)）是CRAN仓库的高性能镜像，它提供了一个“时间机器”工具，让您能够获取选定时间的CRAN包快照'
- en: Let's see in detail what they are.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细看看它们是什么。
- en: Multi-threading in MRO
  id: totrans-29
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: MRO中的多线程
- en: Although CRAN R was created as single-threaded, it has the ability to link to
    the multi-threaded **Basic Linear Algebra Subprograms** (**BLAS**) and **Linear
    Algebra Package** (**LAPACK**) libraries too, but these are not straightforward
    activities to do manually.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然CRAN R最初是作为单线程创建的，但它也有能力链接到多线程的**基本线性代数子程序**（**BLAS**）和**线性代数包**（**LAPACK**）库，但这些手动操作并不简单。
- en: 'Installing MRO offers the advantage of having the engine already preconfigured
    and optimized for Intel processors thanks to MKL, with the purpose of performing
    mathematical calculations in parallel. To get an idea of the gain in computational
    time, take a look at the benchmark results obtained comparing R-3.4.1 and MRO
    3.4.1 in *Figure 2.1* (source:[http://bit.ly/msropen-bnchmrk](http://bit.ly/msropen-bnchmrk)):'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 安装MRO的好处是，由于MKL，引擎已经预先配置并针对英特尔处理器进行了优化，目的是并行执行数学计算。为了了解计算时间上的收益，请查看*图2.1*（来源：[http://bit.ly/msropen-bnchmrk](http://bit.ly/msropen-bnchmrk)）中比较R-3.4.1和MRO
    3.4.1的基准结果：
- en: '![Figure 2.1 – Total elapsed time for each of the benchmark tests on the same
    machine](img/file16.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![图2.1 – 同一台机器上每个基准测试的总耗时](img/file16.png)'
- en: Figure 2.1 – Total elapsed time for each of the benchmark tests on the same
    machine
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.1 – 同一台机器上每个基准测试的总耗时
- en: As you can easily see, the time taken by CRAN R (installed as-is without linking
    the BLAS libraries) in the matrix calculation is significantly higher than that
    taken by MRO. It is therefore strongly recommended to use MRO if you make heavy
    use of math routines for data science, engineering, financial analysis, and so
    on.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，CRAN R（未链接BLAS库直接安装）在矩阵计算中所需的时间显著高于MRO。因此，如果您在数据科学、工程、金融分析等领域大量使用数学函数，强烈建议使用MRO。
- en: Reproducing results with checkpoints
  id: totrans-35
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用检查点重现结果
- en: When performing complex analyses using R, it is very likely that the resulting
    script is based on one or more CRAN packages. One of the most common problems
    in R is the reproducibility of results, because packages on CRAN change every
    day. So, it can happen that suddenly a script that was working fine a few weeks
    ago strarts to generate errors never seen before after you update the packages,
    or when you run it on another machine. Even more insidious is the possibility
    of getting incorrect results without realizing it, again due to a package update.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用 R 进行复杂分析时，结果脚本很可能基于一个或多个 CRAN 软件包。R 中最常见的问题之一是结果的可重复性，因为 CRAN 上的软件包每天都在变化。因此，可能会发生这种情况：几周前运行良好的脚本在更新软件包后开始产生之前从未见过的错误，或者当您在另一台机器上运行它时。更隐蔽的是，由于软件包更新，可能会在不经意间得到错误的结果。
- en: 'For this reason, starting in September 2014, Microsoft put up its own distribution
    of CRAN''s R packages organized into daily snapshots of the entire repository,
    taken by the **checkpoint server** at midnight UTC and persisted on MRAN:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，从 2014 年 9 月开始，微软推出了自己的 CRAN R 软件包分发版，这些软件包按整个存储库的每日快照组织，由 **checkpoint 服务器**
    在 UTC 午夜进行快照并持久化在 MRAN 上：
- en: '![Figure 2.2 – The process of persisting a daily snapshot of CRAN in MRAN](img/file17.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.2 – 在 MRAN 中持久化 CRAN 每日快照的过程](img/file17.png)'
- en: Figure 2.2 – The process of persisting a daily snapshot of CRAN in MRAN
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.2 – 在 MRAN 中持久化 CRAN 每日快照的过程
- en: From that point on, the R community had the ability to access a specific snapshot
    of CRAN packages with their versions frozen to a specific date.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 从那时起，R 社区能够访问 CRAN 软件包的特定快照，其版本被冻结在特定日期。
- en: '**Important note**'
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-42
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: It is not necessary to use MRO to benefit from the free service offered by the
    checkpoint server. CRAN R users can also use it.
  id: totrans-43
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 您不需要使用 MRO 来利用 checkpoint 服务器提供的免费服务。CRAN R 用户也可以使用它。
- en: 'Usually, when you invoke `install.packages` to install one or more packages
    in R, the latest CRAN version of each specified package is installed. Using the
    `checkpoint` package, you have the ability to reference a specific snapshot of
    the CRAN repository on a specific day in the past, as follows:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，当您在 R 中调用 `install.packages` 来安装一个或多个软件包时，会安装每个指定软件包的最新 CRAN 版本。使用 `checkpoint`
    软件包，您有权引用过去某一天 CRAN 存储库的特定快照，如下所示：
- en: '[PRE0]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: With the preceding code example, both you and any other user are sure to always
    use the same version of the `dplyr` package downloaded from the CRAN repository
    snapshot you want to use.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前面的代码示例，您和任何其他用户都确保始终使用从您想要使用的 CRAN 存储库快照中下载的 `dplyr` 软件包的相同版本。
- en: 'The MRO installation includes the `checkpoint` package and by default sets
    the snapshot date as equal to the release date of the MRO version you are installing.
    You can easily verify the snapshot date that is set by the specific version of
    MRO in the **CRAN Time Machine** tool available on the MRAN portal ([https://mran.microsoft.com/timemachine](https://mran.microsoft.com/timemachine)):'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: MRO 安装包括 `checkpoint` 软件包，并默认将快照日期设置为正在安装的 MRO 版本的发布日期。您可以通过 MRAN 门户上可用的 **CRAN
    时间机器** 工具轻松验证由特定版本的 MRO 设置的快照日期（[https://mran.microsoft.com/timemachine](https://mran.microsoft.com/timemachine)）：
- en: '![Figure 2.3 – The process of persisting a daily snapshot of CRAN in MRAN](img/file18.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.3 – 在 MRAN 中持久化 CRAN 每日快照的过程](img/file18.png)'
- en: Figure 2.3 – The process of persisting a daily snapshot of CRAN in MRAN
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.3 – 在 MRAN 中持久化 CRAN 每日快照的过程
- en: 'You can also check the default package repository programmatically in the following
    way:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以按以下方式以编程方式检查默认软件包存储库：
- en: '[PRE1]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'And you’ll get something like this as output:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到类似以下输出：
- en: '[PRE2]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: With this example code, if you install any R package, the versions installed
    will be those that were present in CRAN at midnight on July 16, 2020.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此示例代码，如果您安装任何 R 软件包，安装的版本将是 2020 年 7 月 16 日午夜在 CRAN 中存在的版本。
- en: Microsoft R Client
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 微软 R 客户端
- en: 'Microsoft has also released another distribution of R, available for free for
    Windows and Linux, called **Microsoft R Client**. This distribution is entirely
    based on MRO, allowing you to run any code that works on CRAN R. In addition,
    there are some of Microsoft''s R function libraries ([http://bit.ly/ml-r-funcions](http://bit.ly/ml-r-funcions))
    that are not open sourced. These functions are multi-threaded and allow you to
    work even with datasets that normally could not be contained in the memory of
    the machine with Microsoft’s on-premises products (**SQL Server** and **Machine
    Learning Server**). Yes, that’s right: in case you didn''t know, Microsoft''s
    **Relational Database Management System** (**RDBMS**), SQL Server, lets you use
    R, Python, and Java code in its stored procedures. So, if your data source is
    SQL Server itself and you need to extract insights from the data that are persisted
    there, consider also the possibility of applying Advanced Analytics algorithms
    directly using stored procedures in SQL Server, embedding R and Python code within
    them.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 微软还发布了一个名为**Microsoft R客户端**的R版本，免费提供给Windows和Linux用户。这个版本完全基于MRO，允许您运行在CRAN
    R上运行的任何代码。此外，还有一些微软的R函数库([http://bit.ly/ml-r-funcions](http://bit.ly/ml-r-funcions))没有开源。这些函数是多线程的，允许您即使与通常无法包含在机器内存中的数据集（使用微软的本地产品**SQL
    Server**和**Machine Learning Server**）一起工作。是的，没错：如果您不知道，微软的关系型数据库管理系统（**RDBMS**）SQL
    Server允许您在其存储过程中使用R、Python和Java代码。因此，如果您的数据源是SQL Server本身，并且您需要从那里持久化的数据中提取洞察，请考虑直接使用SQL
    Server中的存储过程应用高级分析算法的可能性，将R和Python代码嵌入其中。
- en: Using Microsoft R Client, it is possible to delegate algorithms that require
    non-trivial computational complexity to SQL Server or Machine Learning Server
    thanks to the performant **MicrosoftML** and **RevoScale** packages mentioned
    previously.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Microsoft R客户端，由于之前提到的性能良好的**MicrosoftML**和**RevoScale**包，可以将需要非平凡计算复杂性的算法委托给SQL
    Server或Machine Learning Server。
- en: Unlike MRO, Microsoft R Client is not updated in parallel with each individual
    CRAN R release, but follows the MRO releases included at the time of Machine Learning
    Server releases. For example, as of today, CRAN R is at version 4.0.2, and MRO
    is at version 4.0.2 too, whereas Microsoft R Client is at version 3.5.2, which
    is the one supported by Machine Learning Server 9.4.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 与MRO不同，Microsoft R客户端不是与每个CRAN R版本并行更新，而是遵循在Machine Learning Server发布时包含的MRO版本。例如，截至今天，CRAN
    R是4.0.2版本，MRO也是4.0.2版本，而Microsoft R客户端是3.5.2版本，这是由Machine Learning Server 9.4支持的版本。
- en: Having described the main features of the most popular R distributions, let's
    move on to the selection of the engine to be installed on your machine.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在描述了最流行的R发行版的主要功能后，让我们继续选择要在您的机器上安装的引擎。
- en: Choosing an R engine to install
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选择要安装的R引擎
- en: The first question when installing an R engine is, *"Which distribution should
    I install? Do I choose the standard CRAN R, or do I opt for any Microsoft R distribution?"*
    The usual answer to these kinds of questions is, *"It depends!"* In our case,
    the goal is to use the R engine within Power BI, so we need to understand which
    engines are used by the different products that permit the use of R within them.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 安装R引擎时的第一个问题是，“我应该安装哪个版本？我是选择标准的CRAN R，还是选择任何Microsoft R版本？”这类问题的通常答案是，“视情况而定！”在我们的情况下，目标是使用Power
    BI中的R引擎，因此我们需要了解哪些引擎被允许在它们内部使用R的不同产品所使用。
- en: The R engines used by Power BI
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Power BI使用的R引擎
- en: 'We saw in *Chapter 1,* *Where and How to Use R and Python Scripts in Power
    BI,* that only two Power BI products are allowed to use scripts in R and Python:
    Power BI Desktop and the Power BI service (remember that Power BI Embedded is
    implicitly included when talking about the Power BI service). So, the answer *"It
    depends!"* takes on a clearer connotation now: if you need to share your reports
    with people inside your organization, then you have to install the engines that
    work well with the Power BI service; if, instead, you need to create reports for
    your own use, without even publishing it on **My Workspace**, you can install
    the engines suitable for Power BI Desktop.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第一章*，*在哪里以及如何使用Power BI中的R和Python脚本*中，我们了解到只有两个Power BI产品允许使用R和Python脚本：Power
    BI桌面版和Power BI服务（记住，当提到Power BI服务时，Power BI嵌入式是隐含包含在内的）。因此，答案“视情况而定！”现在有了更明确的含义：如果您需要与组织内部的人共享报告，那么您必须安装与Power
    BI服务兼容的引擎；如果您需要为自己创建报告，甚至不需要在**我的工作区**上发布，您也可以安装适合Power BI桌面版的引擎。
- en: There is a substantial difference in the use of analytic engines by these two
    products. **Power BI Desktop** relies on the R engine installed by the user on
    the same machine on which Power BI Desktop is running. It is the user who chooses
    which version of the engines and which packages to install. Power BI Desktop simply
    ensures that any R code entered through its interface runs directly on that engine.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个产品在分析引擎的使用上存在重大差异。**Power BI Desktop** 依赖于安装在运行 Power BI Desktop 的同一台机器上的
    R 引擎。用户选择安装哪些引擎版本和哪些包。Power BI Desktop 确保通过其界面输入的任何 R 代码都直接在该引擎上运行。
- en: The **Power BI service** is the **Software-as-a-Service** (**SaaS**) product
    among those covered by Power BI. The user doesn’t have to take on the maintenance
    of its underlying IT infrastructure, and nor can the user decide to install components
    on it at will.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**Power BI 服务** 是 Power BI 覆盖的 **软件即服务**（**SaaS**）产品之一。用户不需要承担其底层 IT 基础设施的维护工作，也不能随意决定在其上安装组件。'
- en: '**Important note**'
  id: totrans-66
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要注意事项**'
- en: ''
  id: totrans-67
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The R engine and the packages used by the Power BI service for **R visuals**
    are preinstalled on the cloud and therefore the user must adapt to the versions
    adopted by the service.
  id: totrans-68
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Power BI 服务用于 **R 可视化** 的 R 引擎和包是预先安装在云上的，因此用户必须适应服务采用的版本。
- en: It is also important to know exactly which R distribution is used by the R visuals
    in the Power BI service.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 确切了解 Power BI 服务中 R 可视化使用的 R 发行版也很重要。
- en: '**Important note**'
  id: totrans-70
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要注意事项**'
- en: ''
  id: totrans-71
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'To date, the Power BI service relies on the **MRO 3.4.4** runtime when implementing
    an R visual. It is important to always keep an eye on the version of the R engine
    and the packages provided by the Power BI service with each release to ensure
    that the reports to be published work properly. See the following link for more
    information: [http://bit.ly/powerbi-r-limits](http://bit.ly/powerbi-r-limits).'
  id: totrans-72
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 到目前为止，Power BI 服务在实现 R 可视化时依赖于 **MRO 3.4.4** 运行时。每次发布时，都要密切关注 R 引擎和 Power BI
    服务提供的包的版本，以确保要发布的报告能够正常工作。更多信息请见以下链接：[http://bit.ly/powerbi-r-limits](http://bit.ly/powerbi-r-limits)。
- en: If, instead, you have to do data ingestion or data transformation using R scripts
    and you need to refresh your data, the Power BI service does not use the same
    engine for R visuals in this case.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您必须使用 R 脚本进行数据摄取或数据转换，并且需要刷新您的数据，Power BI 服务在这种情况下不会使用相同的引擎用于 R 可视化。
- en: '**Important note**'
  id: totrans-74
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要注意事项**'
- en: ''
  id: totrans-75
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The R engine used by the Power BI service during the data refresh phase for
    *R scripts in Power Query* has to be installed on any machine of your choice outside
    the service, and on that same machine you have to install the **on-premises data
    gateway** in **personal mode**. Note that you must use external engines even if
    the data to be refreshed does not flow through the gateway, but comes from data
    sources not referenced by the gateway itself.
  id: totrans-76
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在数据刷新阶段，Power BI 服务用于 *Power Query 中的 R 脚本* 的 R 引擎必须在服务之外您选择的任何机器上安装，并且在该同一台机器上您必须安装
    **本地数据网关** 的 **个人模式**。请注意，即使要刷新的数据不通过网关流动，而是来自网关本身未引用的数据源，您也必须使用外部引擎。
- en: As long as the R engine to be referenced via the data gateway is only one, it
    is sufficient that both are installed on the same machine. Otherwise, the following
    note applies.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 只要要通过数据网关引用的 R 引擎只有一个，那么它们都安装在同一台机器上就足够了。否则，以下注意事项适用。
- en: '**Important note**'
  id: totrans-78
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要注意事项**'
- en: ''
  id: totrans-79
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: If you need to *use multiple R engines* installed on the machine for your Power
    Query transformations, you must *also install Power BI Desktop*. It allows you
    to switch the routing of the data gateway to the selected engine through its options,
    updating the configuration file `C:\Users\<your-username>\AppData\Local\PowerBIScripting\RSettings.xml`.
    This file allows the override of the R engine referenced by the data gateway by
    default.
  id: totrans-80
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果您需要在机器上安装的多个 R 引擎中为 Power Query 转换使用，您还必须安装 **Power BI Desktop**。它允许您通过其选项切换数据网关的路由到所选引擎，更新配置文件
    `C:\Users\<your-username>\AppData\Local\PowerBIScripting\RSettings.xml`。此文件允许覆盖数据网关默认引用的
    R 引擎。
- en: 'If you need to learn more about the on-premises data gateway (*Enterprise*
    and *personal* modes), we suggest reading the Microsoft Docs page at this link:
    [http://bit.ly/onprem-data-gateway](http://bit.ly/onprem-data-gateway).'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要了解更多关于本地数据网关（**企业**和**个人**模式）的信息，我们建议阅读以下链接的 Microsoft Docs 页面：[http://bit.ly/onprem-data-gateway](http://bit.ly/onprem-data-gateway)。
- en: In summary, with the preceding scenarios in mind, if you need to do reports
    for personal use on your desktop, you have no limitations on which R engine to
    use, so you can install the R versions and packages that suit you best. If, however,
    you know in advance that the reports you are going to create contain R visuals
    and are intended to be shared with colleagues on the Power BI service, there are
    stringent limitations on both the version and the packages to be pre-installed
    in the service.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，考虑到前面的场景，如果你需要在桌面上进行个人使用的报告，你对使用的 R 引擎没有任何限制，因此你可以安装最适合你的 R 版本和包。然而，如果你事先知道你将要创建的报告包含
    R 可视化，并且打算在 Power BI 服务中与同事共享，那么对版本和预安装在服务中的包都有严格的限制。
- en: Let's now move on to the installation of the engines.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们继续进行引擎的安装。
- en: Installing the suggested R engines
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装建议的 R 引擎
- en: Managing dependencies of R scripts injected within reports developed for the
    Power BI service can be complex in the long run. Keeping in mind that it is possible
    to install more than one R engine on the same machine, we suggest the following
    tip.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 长期来看，管理为 Power BI 服务开发的报告中注入的 R 脚本的依赖项可能很复杂。考虑到可以在同一台机器上安装多个 R 引擎，我们建议以下技巧。
- en: '**Tip**'
  id: totrans-86
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**提示**'
- en: ''
  id: totrans-87
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We recommend that you *dedicate a machine* to run only the R engines used by
    Power BI reports. Our suggestion is to install an R engine for each possible need
    that may arise when developing R scripts in Power Query or in R visuals.
  id: totrans-88
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们建议你 *专门为 Power BI 报告运行 R 引擎的机器*。我们的建议是为 Power Query 中开发 R 脚本或在 R 可视化中可能出现的每个可能的需求安装一个
    R 引擎。
- en: The R engine for data transformation
  id: totrans-89
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 数据转换的 R 引擎
- en: You have seen that R scripts used in Power Query to make changes to the data
    model must necessarily use an external R engine through the on-premises data gateway
    in personal mode, even if you use the Power BI service.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经看到，在 Power Query 中用于更改数据模型的 R 脚本必须通过个人模式中的本地数据网关使用外部 R 引擎，即使你使用 Power BI
    服务。
- en: '**Tip**'
  id: totrans-91
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**提示**'
- en: ''
  id: totrans-92
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We recommend installing the latest available version of either CRAN R or MRO.
    Since both distributions are interchangeable in terms of code operation given
    the same version, in our opinion it is better to install *MRO* to benefit from
    the performance advantages of the MKL library.
  id: totrans-93
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们建议安装 CRAN R 或 MRO 的最新可用版本。鉴于相同的版本在代码操作方面可以互换，我们认为安装 *MRO* 可以从 MKL 库的性能优势中受益。
- en: 'Installing MRO is very simple:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 MRO 非常简单：
- en: Go to [https://mran.microsoft.com/download](https://mran.microsoft.com/download).
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往 [https://mran.microsoft.com/download](https://mran.microsoft.com/download)。
- en: 'Click on the **Download** button corresponding to your OS. In my case, this
    is Windows:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击对应你操作系统的 **Download** 按钮。在我的情况下，这是 Windows：
- en: '![Figure 2.4 – Downloading MRO for Windows](img/file19.png)'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.4 – Windows 下载 MRO](img/file19.png)'
- en: Figure 2.4 – Downloading MRO for Windows
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.4 – Windows 下载 MRO
- en: Once the `microsoft-r-open-x.x.x.exe` file (where `x.x.x` corresponds to the
    actual version chosen) is downloaded, double-click on it and then click on **Continue**
    on the **Let’s get started** window that pops up.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载完 `microsoft-r-open-x.x.x.exe` 文件（其中 `x.x.x` 对应实际选择的版本）后，双击它，然后在弹出的 **Let’s
    get started** 窗口中点击 **Continue**。
- en: 'The next screen, **Configure the installation**, asks you to confirm or change
    the installation path, as well as select some installation options:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕，**配置安装**，要求你确认或更改安装路径，以及选择一些安装选项：
- en: '![Figure 2.5 – MRO installation options](img/file20.png)'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.5 – MRO 安装选项](img/file20.png)'
- en: Figure 2.5 – MRO installation options
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.5 – MRO 安装选项
- en: The only optional choice is to install **MKL**. For reasons you know well by
    now, we suggest installing it. Then click on **Continue**.
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 唯一的可选选择是安装 **MKL**。由于你现在已经非常清楚的原因，我们建议安装它。然后点击 **Continue**。
- en: In the next window, you can read the Microsoft license agreement to install
    MRO. After checking **I acknowledge the above licensing information**, click on
    **Continue**.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗口中，你可以阅读安装 MRO 的 Microsoft 许可协议。勾选 **I acknowledge the above licensing
    information** 后，点击 **Continue**。
- en: Similarly, in the next window you can read the license agreement for MKL. After
    ticking **I accept these terms**, click on **Continue**.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 类似地，在下一个窗口中，你可以阅读 MKL 的许可协议。勾选 **I accept these terms** 后，点击 **Continue**。
- en: A summary window now appears asking you to click on **Install** to begin installing
    MRO.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在出现一个摘要窗口，要求你点击 **Install** 以开始安装 MRO。
- en: At the end of the installation, an **All done** window will inform you that
    the installation was completed successfully.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装结束时，一个 **完成** 窗口将通知您安装已成功完成。
- en: And that’s it! You are now ready to be able to write and run your R code on
    MRO.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！您现在就可以在 MRO 上编写和运行您的 R 代码了。
- en: '**Important note**'
  id: totrans-109
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-110
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Usually, the Power BI Desktop installation on which you develop reports is located
    on a separate machine from the one selected as the Power BI service’s R engine
    machine, where the data gateway is also often installed. In that case, you must
    also install the R engine on the machine on which your Power BI Desktop instance
    is installed.
  id: totrans-111
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 通常，您在 Power BI Desktop 上开发报告的安装位置与选定的 Power BI 服务 R 引擎机器分开，数据网关也经常安装在该机器上。在这种情况下，您还必须在安装
    Power BI Desktop 实例的机器上安装 R 引擎。
- en: 'If you want, you can already write code on the very rudimentary GUI installed
    by default with MRO:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您愿意，您现在就可以在 MRO 默认安装的非常基础的 GUI 上编写代码：
- en: '![Figure 2.6 – The rGUI installed by MRO](img/file21.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.6 – MRO 安装的 rGUI](img/file21.png)'
- en: Figure 2.6 – The rGUI installed by MRO
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.6 – MRO 安装的 rGUI
- en: 'We’ll see later in this chapter how to install the IDE preferred by all R developers:
    **RStudio**.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章后面看到如何安装所有 R 开发者都偏好的 IDE：**RStudio**。
- en: The R engine for R visuals on the Power BI service
  id: totrans-116
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Power BI 服务上 R 可视化的 R 引擎
- en: As previously mentioned, R visual scripts published on the Power BI service
    run on a pre-installed R engine on the cloud, the version of which may change
    based on new releases of the Power BI service itself. Should you need to share
    a report containing an R visual with colleagues, you need to be sure that your
    R code works correctly on the pre-installed engine.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，在 Power BI 服务上发布的 R 可视化脚本在云中预安装的 R 引擎上运行，其版本可能会根据 Power BI 服务的最新发布而更改。如果您需要与同事分享包含
    R 可视化的报告，您需要确保您的 R 代码在预安装的引擎上正确运行。
- en: '**Tip**'
  id: totrans-118
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**提示**'
- en: ''
  id: totrans-119
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We strongly recommend that you also install on your machine the *same version*
    of MRO as that used for R visuals by the Power BI service.
  id: totrans-120
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们强烈建议您在自己的机器上也安装与 Power BI 服务用于 R 可视化的相同版本的 MRO。
- en: 'In order to install the same version of MRO provided by the Power BI service,
    the process is very simple:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 为了安装 Power BI 服务提供的相同版本的 MRO，过程非常简单：
- en: 'Go to [http://bit.ly/powerbi-r-limits](http://bit.ly/powerbi-r-limits) and
    check the actual version of MRO used by the Power BI service:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问 [http://bit.ly/powerbi-r-limits](http://bit.ly/powerbi-r-limits) 并检查 Power
    BI 服务使用的实际 MRO 版本：
- en: '![Figure 2.7 – The actual MRO version used by the Power BI service](img/file22.png)'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.7 – Power BI 服务使用的实际 MRO 版本](img/file22.png)'
- en: Figure 2.7 – The actual MRO version used by the Power BI service
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.7 – Power BI 服务使用的实际 MRO 版本
- en: 'Then go to [https://mran.microsoft.com/release-history](https://mran.microsoft.com/release-history)
    and check for the same MRO version you saw in *step 1* (in our case, **3.4.4**):'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后转到 [https://mran.microsoft.com/release-history](https://mran.microsoft.com/release-history)
    并检查与步骤 1 中看到的相同版本的 MRO（在我们的案例中，**3.4.4**）：
- en: '![Figure 2.8 – Downloading the selected MRO version](img/file23.png)'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.8 – 下载选定的 MRO 版本](img/file23.png)'
- en: Figure 2.8 – Downloading the selected MRO version
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.8 – 下载选定的 MRO 版本
- en: After downloading the executable, simply follow the steps outlined in the previous
    section to install this specific version of the MRO engine.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载可执行文件后，只需遵循上一节中概述的步骤来安装此特定版本的 MRO 引擎。
- en: What to do when the Power BI service upgrades the R engine
  id: totrans-129
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 当 Power BI 服务升级 R 引擎时应该做什么
- en: 'It may happen that you have already installed a version of MRO specifically
    to be aligned with the R visual engine on the Power BI service at a certain date,
    and after a while Microsoft updates the Power BI service, also upgrading the pre-installed
    R engine. This scenario causes two separate events:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 可能的情况是，您已经在某个日期安装了一个特定版本的 MRO，以与 Power BI 服务上的 R 可视化引擎保持一致，之后微软更新了 Power BI
    服务，同时也升级了预安装的 R 引擎。这种情况会导致两个独立的事件：
- en: The R engine is more up to date than its predecessor and may contain breaking
    changes that could make previously developed reports unusable. This is a very
    rare eventuality, since very often such changes are mitigated by the introduction
    of “deprecated” functions or parameters, thus ensuring backward compatibility.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R 引擎比其前身更新，可能包含可能导致先前开发的报告不可用的破坏性更改。这种情况非常罕见，因为通常通过引入“已弃用”函数或参数来缓解这些更改，从而确保向后兼容性。
- en: Many of the packages installed on the release date of the previous R engine
    will be updated to a later version, corresponding to the release date of the new
    version of the R engine. Updating a package to a newer version is one of the most
    frequent causes of errors due to the incompatibility of a script written for the
    previous version of the package.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在上一个 R 引擎发布日期安装的大多数包都将更新到较新版本，对应于新版本 R 引擎的发布日期。将包更新到新版本是因脚本与包的旧版本不兼容而导致错误的最常见原因之一。
- en: In this case, you should verify that all of your reports that have R visuals
    and are published to the Power BI service also work with the updates made to the
    service.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，您应验证所有包含 R 可视化并发布到 Power BI 服务的报告也能与对服务进行的更新兼容。
- en: '**Tip**'
  id: totrans-134
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**提示**'
- en: ''
  id: totrans-135
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In light of the preceding observations, and considering the fact that the pre-installed
    R engine of the Power BI service is very rarely updated, it is better to directly
    install the new version of MRO on your machine and test your reports making sure
    that Power BI Desktop references the new version of the engine. You need to fix
    any code issue in those R visuals that have some problems, after which you can
    publish those reports back to the Power BI service.
  id: totrans-136
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 考虑到前面的观察结果，以及预安装的 Power BI 服务 R 引擎很少更新的事实，最好直接在您的机器上安装新的 MRO 版本，并测试您的报告，确保 Power
    BI Desktop 引用了新版本的引擎。您需要修复那些 R 可视化中存在的任何代码问题，之后您可以将这些报告重新发布到 Power BI 服务。
- en: Once you’ve made sure that all of the preceding reports are working properly,
    it’s up to you to decide whether you want to uninstall the previous version of
    MRO to free up disk space and to avoid confusion in handling these particular
    reports.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您确认所有前面的报告都运行正常，您就可以决定是否要卸载 MRO 的旧版本以释放磁盘空间并避免在处理这些特定报告时产生混淆。
- en: At this point we can move on to install an IDE that has more features than the
    rGUI installed by default by MRO.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 到此为止，我们可以继续安装一个比 MRO 默认安装的 rGUI 功能更丰富的 IDE。
- en: Installing an IDE for R development
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 R 开发 IDE
- en: The need to install a state-of-the-art IDE for the development of code in Power
    BI comes from the need to have all the tools necessary to identify any bugs and
    to quickly test the results of code chunks on the fly.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Power BI 中开发代码需要安装最先进的 IDE，这源于需要所有必要的工具来识别任何错误，并快速测试代码片段的结果。
- en: '**Tip**'
  id: totrans-141
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**提示**'
- en: ''
  id: totrans-142
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: It is strongly suggested to test your R code in the IDE and verify the results
    before using it in Power BI.
  id: totrans-143
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 强烈建议在 IDE 中测试您的 R 代码并验证结果，然后再在 Power BI 中使用它。
- en: There are many IDEs for R development on the market. Some examples are **R-Brain
    IDE** (**RIDE**), **IntelliJ IDEA**, and **Jupyter Lab**, but it is estimated
    that over 90% of R programmers use **RStudio** as their primary IDE. That’s why
    we suggest you also use this IDE to test the code you’ll encounter throughout
    this book.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 市场上有很多用于 R 开发的 IDE。一些例子是 **R-Brain IDE**（**RIDE**）、**IntelliJ IDEA** 和 **Jupyter
    Lab**，但据估计，超过 90% 的 R 程序员使用 **RStudio** 作为他们的主要 IDE。这就是为什么我们建议您也使用这个 IDE 来测试本书中会遇到的所有代码。
- en: Installing RStudio
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装 RStudio
- en: 'Installing RStudio on your machine is very simple:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的机器上安装 RStudio 非常简单：
- en: 'Go to [https://rstudio.com/products/rstudio/download/](https://rstudio.com/products/rstudio/download/)
    and click on **Download** under the **RStudio Desktop** column:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往 [https://rstudio.com/products/rstudio/download/](https://rstudio.com/products/rstudio/download/)
    并在 **RStudio Desktop** 列表下点击 **下载**。
- en: '![Figure 2.9 – Go to the Download page of RStudio](img/file24.png)'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.9 – 前往 RStudio 下载页面](img/file24.png)'
- en: Figure 2.9 – Go to the Download page of RStudio
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.9 – 前往 RStudio 下载页面
- en: 'Then click on the **Download RStudio for Windows** button:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后点击 **下载 RStudio for Windows** 按钮：
- en: '![Figure 2.10 – Download RStudio for Windows](img/file25.png)'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.10 – 下载 RStudio for Windows](img/file25.png)'
- en: Figure 2.10 – Download RStudio for Windows
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.10 – 下载 RStudio for Windows
- en: After the download completes successfully, double-click on the executable and
    click on the **Next** button on the RStudio setup welcome window.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载成功完成后，双击可执行文件，并在 RStudio 安装欢迎窗口中点击 **下一步** 按钮。
- en: In the next window, you are asked for the folder in which to install RStudio.
    Leave the default one and click on **Next**.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个窗口中，您会被要求选择安装 RStudio 的文件夹。保留默认设置并点击 **下一步**。
- en: The following window asks you to select the Start menu folder in which to create
    the shortcuts. Leave the default one and click on **Install**.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下窗口会要求您选择创建快捷方式的开始菜单文件夹。保留默认设置并点击 **安装**。
- en: When the installation is complete, click on **Finish**.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，点击**完成**。
- en: 'Just to make sure you installed everything smoothly, check that you have the
    option to select one of the two newly installed R engines from the RStudio options:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保一切安装顺利，请检查你是否有从 RStudio 选项中选择两个新安装的 R 引擎之一的选项：
- en: 'Open the newly installed RStudio from the **Start** menu:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**开始**菜单打开新安装的 RStudio：
- en: '![Figure 2.11 – Run RStudio from the Start menu](img/file26.png)'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.11 – 从开始菜单运行 RStudio](img/file26.png)'
- en: Figure 2.11 – Run RStudio from the Start menu
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.11 – 从开始菜单运行 RStudio
- en: Once opened, you may be asked if you want to anonymously send any crash reports
    to RStudio to improve the product. Select **Yes** or **No** as your choice.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦打开，你可能会被问及是否希望匿名发送任何崩溃报告给 RStudio 以改进产品。根据你的选择选择**是**或**否**。
- en: 'As you can see, RStudio has already selected an R engine by default. In our
    case, it is the latest version installed on our machine. Also, note that MKL is
    up and running:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如你所见，RStudio 已经默认选择了一个 R 引擎。在我们的例子中，它是我们机器上安装的最新版本。此外，请注意 MKL 已经启动：
- en: '![Figure 2.12 – The default R engine selected in RStudio and Global Options](img/file27.png)'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.12 – RStudio 和全局选项中默认选择的 R 引擎](img/file27.png)'
- en: Figure 2.12 – The default R engine selected in RStudio and Global Options
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.12 – RStudio 和全局选项中默认选择的 R 引擎
- en: Now, click on the **Tools** menu and then **Global Options…** to see the available
    engines.
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，点击**工具**菜单，然后点击**全局选项…**以查看可用的引擎。
- en: 'In the **General** menu of the **Options** window, you have the possibility
    to select the engine you want to use in RStudio by clicking on **Change...** and
    then selecting one of the available engines:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选项**窗口的**常规**菜单中，你可以通过点击**更改...**然后选择一个可用的引擎来选择你想要在 RStudio 中使用的引擎：
- en: '![Figure 2.13 – Choose your preferred R engine to use with RStudio](img/file28.png)'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.13 – 选择您首选的 R 引擎与 RStudio 一起使用](img/file28.png)'
- en: Figure 2.13 – Choose your preferred R engine to use with RStudio
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.13 – 选择您首选的 R 引擎与 RStudio 一起使用
- en: Usually, we would not advise considering the engine containing `“C:\PROGRA~1\...”`
    as the root of the path. It is simply the engine that is currently selected in
    RStudio. Just select one of the other engines from the list.
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通常，我们不会建议将包含“`“C:\PROGRA~1\...”`”的引擎视为路径的根。它只是当前在 RStudio 中选择的引擎。只需从列表中选择其他引擎之一。
- en: For now, select the most recent version of R (in our case, 4.0.2) and click
    **OK** on the **Choose R Installation** window. You will be notified that you
    will need to restart RStudio for the selected changes to take effect.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，选择最新的 R 版本（在我们的例子中，是 4.0.2），然后在**选择 R 安装**窗口中点击**确定**。你将收到通知，表示你需要重启 RStudio
    以使所选更改生效。
- en: Click **OK** on the **Change R Version** window, and then **OK** on the **Options**
    window. Sometimes you’ll have the option to restart by selecting **Yes** in a
    dialog box that is shown immediately afterward. If not, just exit from RStudio
    and open it again.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**更改 R 版本**窗口中点击**确定**，然后在**选项**窗口中点击**确定**。有时你将有机会通过在随后显示的对话框中选择**是**来重启。如果没有，只需从
    RStudio 中退出并重新打开即可。
- en: Well done! Now you're ready to properly configure an R engine in Power BI Desktop
    and set up what you need to publish to the Power BI service.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 干得好！现在你已经准备好在 Power BI Desktop 中正确配置 R 引擎，并设置你需要发布到 Power BI 服务的相关内容。
- en: Configuring Power BI Desktop to work with R
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 Power BI Desktop 以与 R 一起工作
- en: 'Once you have installed the R engines necessary for the development of your
    reports and the RStudio IDE, you must configure Power BI Desktop so that it properly
    references these tools. This is really a very simple task:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你安装了用于报告开发和 RStudio IDE 的必要 R 引擎，你必须配置 Power BI Desktop 以正确引用这些工具。这实际上是一个非常简单的任务：
- en: 'In Power BI Desktop, go to the **File** menu, click on the **Options and settings**
    tab, and then click on **Options**:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Power BI Desktop 中，转到**文件**菜单，点击**选项和设置**选项卡，然后点击**选项**：
- en: '![Figure 2.14 – Opening the Power BI Desktop Options and settings window](img/file29.png)'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.14 – 打开 Power BI Desktop 选项和设置窗口](img/file29.png)'
- en: Figure 2.14 – Opening the Power BI Desktop Options and settings window
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.14 – 打开 Power BI Desktop 选项和设置窗口
- en: 'In the **Options** window, click on the **R scripting** tab on the left. The
    contents of the panel on the right will update, giving you the option to select
    the R engine to reference and the R IDE to use for R visuals:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选项**窗口中，点击左侧的**R 脚本**选项卡。右侧面板的内容将更新，为你提供选择要引用的 R 引擎和使用于 R 可视化的 R IDE 的选项：
- en: '![Figure 2.15 – Choosing the engine and the IDE to work with in Power BI Desktop](img/file30.png)'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.15 – 在 Power BI Desktop 中选择要使用的引擎和 IDE](img/file30.png)'
- en: Figure 2.15 – Choosing the engine and the IDE to work with in Power BI Desktop
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.15 – 在 Power BI Desktop 中选择要使用的引擎和 IDE
- en: As you can see, Power BI Desktop automatically identifies the installed R engines
    and IDEs. For the moment, select the latest version of the engine (in our case,
    it is 4.0.2), in order to be aligned with the one already selected in RStudio.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如您所见，Power BI Desktop 自动识别已安装的 R 引擎和 IDE。目前，请选择引擎的最新版本（在我们的例子中是 4.0.2），以确保与
    RStudio 中已选择的版本保持一致。
- en: You will see how to interact with the IDE from Power BI Desktop when we introduce
    the R and Python script visuals in *Chapter 12, Exploratory Data Analysis*.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们在 *第 12 章，数据探索分析* 中介绍 R 和 Python 脚本可视化时，您将了解如何从 Power BI Desktop 与 IDE 交互。
- en: Configuring the Power BI service to work with R
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 Power BI 服务以使用 R
- en: As you learned in the *The R engines used by Power BI* section of this chapter,
    the Power BI service uses different R engines depending on whether the scripts
    are used in R visuals or in Power Query for data transformation. In the first
    case, the engine is pre-installed on the cloud; in the second case, you need to
    install the **on-premises data gateway** in **personal mode** on any machine of
    your choice in order to make the Power BI service communicate with the R engine
    you installed on that machine.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 如您在本章的 *Power BI 使用的 R 引擎* 部分所学，Power BI 服务根据脚本是在 R 可视化中还是 Power Query 数据转换中使用，使用不同的
    R 引擎。在前一种情况下，引擎在云上预先安装；在后一种情况下，您需要在任何您选择的机器上以个人模式安装 **本地数据网关**，以便 Power BI 服务与您在该机器上安装的
    R 引擎通信。
- en: Installing the on-premises data gateway in personal mode
  id: totrans-185
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 以个人模式安装本地数据网关
- en: 'We have emphasized the fact that you will need to install the data gateway
    in personal mode for an important reason: R scripts are *not supported* for the
    on-premises data gateway in *Enterprise mode*.'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我们强调您需要以个人模式安装数据网关，这是出于一个重要原因：在 *企业模式* 下，*企业数据网关* 不支持 R 脚本。
- en: 'In your case, you will install the data gateway on the same laptop on which
    you have installed the R engines and Power BI Desktop. The steps to do this are
    as follows:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的情况下，您将在已安装 R 引擎和 Power BI Desktop 的同一台笔记本电脑上安装数据网关。执行此操作的步骤如下：
- en: 'Make sure you can log in to the Power BI service ([https://app.powerbi.com](https://app.powerbi.com)).
    You will see a home page like the following, customized with your company logo:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保您能登录到 Power BI 服务 ([https://app.powerbi.com](https://app.powerbi.com))。您将看到如下主页，带有您公司的标志：
- en: '![Figure 2.16 – The Power BI service home page](img/file31.png)'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.16 – Power BI 服务主页](img/file31.png)'
- en: Figure 2.16 – The Power BI service home page
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.16 – Power BI 服务主页
- en: 'On the top right-hand side of the home page, you''ll notice a downward-pointing
    arrow that allows you to access the download menu. Click on this, and then select
    **Data Gateway**:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页右上角，您会注意到一个向下指的箭头，允许您访问下载菜单。点击此箭头，然后选择 **数据网关**：
- en: '![Figure 2.17 – The Download menu on your the Power BI service home page](img/file32.png)'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.17 – Power BI 服务主页上的下载菜单](img/file32.png)'
- en: Figure 2.17 – The Download menu on your the Power BI service home page
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.17 – Power BI 服务主页上的下载菜单
- en: 'You will be redirected to a web page from which you can download the data gateway.
    Be sure to download the **personal mode** version:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将被重定向到一个网页，您可以从该网页下载数据网关。请确保下载 **个人模式** 版本：
- en: '![Figure 2.18: Download the personal mode version of the data gateway](img/file33.png)'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.18：下载数据网关的个人模式版本](img/file33.png)'
- en: 'Figure 2.18: Download the personal mode version of the data gateway'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.18：下载数据网关的个人模式版本
- en: 'Running the newly downloaded executable immediately opens an initial window
    that asks you to check the minimum installation requirements given in a link,
    set the installation folder of the software, and accept the terms of use for the
    software:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 立即运行新下载的可执行文件将打开一个初始窗口，要求您检查链接中给出的最小安装要求，设置软件的安装文件夹，并接受软件的使用条款：
- en: '![Figure 2.19 – The data gateway installation window](img/file34.png)'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 2.19 – 数据网关安装窗口](img/file34.png)'
- en: Figure 2.19 – The data gateway installation window
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 2.19 – 数据网关安装窗口
- en: You can leave the default folder selected, click on the terms of use acceptance
    check box, and click **Install** to move on.
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以选择默认文件夹，点击使用条款接受复选框，然后点击 **安装** 以继续。
- en: 'Once the data gateway installation is complete, a sign-in window will open
    where you will need to enter the email address with which you registered with
    the Power BI service, and then your password:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据网关安装完成后，将打开一个登录窗口，您需要输入您在Power BI服务上注册时使用的电子邮件地址，然后输入您的密码：
- en: '![Figure 2.20 – The data gateway sign-in window](img/file35.png)'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图2.20 – 数据网关登录窗口](img/file35.png)'
- en: Figure 2.20 – The data gateway sign-in window
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图2.20 – 数据网关登录窗口
- en: 'When the sign-in operation is successful, a green tick will appear with the
    words **The gateway is online and ready to be used**:'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当登录操作成功时，会出现一个绿色的勾选标记，并显示文字**网关已上线并准备好使用**：
- en: '![Figure 2.21 – The data gateway up and running](img/file36.png)'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图2.21 – 数据网关运行中](img/file36.png)'
- en: Figure 2.21 – The data gateway up and running
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图2.21 – 数据网关运行中
- en: You can close the on-premises data gateway window.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以关闭本地数据网关窗口。
- en: At this moment, the Power BI service is directly connected to your machine and
    can access it whenever there is a need to refresh a published dataset with which
    your newly installed data gateway is associated.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在此时刻，Power BI服务直接连接到您的机器，并在需要刷新与您新安装的数据网关关联的已发布数据集时可以访问它。
- en: '**Important note**'
  id: totrans-209
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-210
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Keep in mind that a Power BI user can *only have one* data gateway associated.
    If you try to install multiple on-premises data gateways in personal mode on several
    different machines, logging in on one of them will force a disconnect on all other
    data gateways.
  id: totrans-211
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 请记住，Power BI用户**只能关联一个**数据网关。如果您尝试在多台不同的机器上以个人模式安装多个本地数据网关，登录其中一台将强制断开所有其他数据网关的连接。
- en: Sharing reports that use R scripts in the Power BI service
  id: totrans-212
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Power BI服务中共享使用R脚本的报表
- en: In the previous sections you learned that, thanks to the data gateway newly
    installed in personal mode, you can publish a report that uses R scripts in the
    Power BI service to your personal workspace for sure. But, assuming you have a
    Pro license, can you also publish this report to shared workspaces? There is often
    a lot of confusion about this.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，您了解到，由于在个人模式下新安装的数据网关，您当然可以将使用R脚本的报表发布到您的个人工作区。但是，假设您拥有Pro许可证，您是否也可以将此报表发布到共享工作区？对此经常存在很多混淆。
- en: '**Important note**'
  id: totrans-214
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-215
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: No one forbids you from publishing your report on shared workspaces as well!
    Although you have used a data gateway in personal mode, other users can view your
    report. But not only that! Other users can also refresh the dataset behind the
    report. They will do this "on your behalf," pointing to the machine referenced
    by your data gateway. The important thing is that your machine is turned on!
  id: totrans-216
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 没有人禁止您在共享工作区发布您的报表！尽管您已在个人模式下使用数据网关，但其他用户可以查看您的报表。不仅如此！其他用户还可以刷新报表背后的数据集。他们将代表您这样做，指向由您的数据网关引用的机器。重要的是您的机器是开启的！
- en: But then, if you can still share your reports with others using a data gateway
    in personal mode, what is the advantage of using a data gateway in Enterprise
    mode?
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如果您仍然可以使用个人模式下的数据网关与他人共享报表，使用企业模式下的数据网关的优势是什么？
- en: Using *just one* data gateway in Enterprise mode, *multiple users* in your organization
    can access on-premises data to which they already have access permission. It goes
    without saying that other users can view and refresh your report, but they cannot
    develop their own reports using R code by referencing your machine with R engines
    through your personal data gateway. This one is the true limitation.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**单个**数据网关在企业模式下，您的组织中的**多个用户**可以访问他们已经具有访问权限的本地数据。不言而喻，其他用户可以查看和刷新您的报表，但他们不能通过使用R引擎通过您的个人数据网关引用您的机器来开发他们自己的报表。这是真正的限制。
- en: In light of the preceding, there is an **unofficial architecture**, frequently
    used in companies, that allows *all reports* that make use of R code in Power
    Query to reference a *single machine* on which the R engine has been installed
    using a personal data gateway.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于上述情况，公司中经常使用一种**非官方架构**，允许**所有使用R代码在Power Query中**的报表引用已使用个人数据网关安装R引擎的**单个机器**。
- en: '**Tip**'
  id: totrans-220
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**提示**'
- en: ''
  id: totrans-221
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: This unofficial architecture makes use of a personal data gateway associated
    not with a physical person, but with a *fictitious "service" user*. The credentials
    of this user are shared between all those analysts who use R code to transform
    data into their reports. Also, since the machine with the R engine referenced
    by the data gateway is shared, it must remain on during periods of scheduled activity.
    For this reason, an Azure Windows Virtual Machine on which both the R engine and
    the data gateway run is often used in this architecture.
  id: totrans-222
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 这种非官方架构利用了一个与物理人员无关的个人数据网关，而是与一个 *虚构的“服务”用户* 相关。该用户的凭据在所有使用 R 代码将数据转换为报告的分析员之间共享。此外，由于数据网关引用的
    R 引擎的机器是共享的，它必须在计划活动期间保持开启状态。因此，在这个架构中，经常使用一个同时运行 R 引擎和数据网关的 Azure Windows 虚拟机。
- en: 'Since a picture is worth a thousand words, *Figure 2.22* summarizes this architecture:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 由于“一图胜千言”，*图 2.22* 总结了此架构：
- en: '![Figure 2.22 – Enterprise architecture to use R for data transformations](img/file37.png)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![图 2.22 – 使用 R 进行数据转换的企业架构](img/file37.png)'
- en: Figure 2.22 – Enterprise architecture to use R for data transformations
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.22 – 使用 R 进行数据转换的企业架构
- en: Thanks to this architecture it is possible to allow a group of analysts to use
    R scripts in their reports, despite the limitations imposed by the on-premises
    data gateway in personal mode.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 多亏了这个架构，才使得一组分析师能够在他们的报告中使用 R 脚本，尽管个人模式下的本地数据网关施加了限制。
- en: That said, in addition to the limitations seen for R scripts in Power Query,
    there are some important ones to be aware of for R visuals as well.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，除了 Power Query 中 R 脚本的局限性之外，还有一些重要的局限性需要注意。
- en: R visuals limitations
  id: totrans-228
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: R 可视化局限性
- en: 'R visuals have some important limitations regarding the data they can handle,
    both as input and output:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: R 可视化在处理数据方面有一些重要的局限性，无论是作为输入还是输出：
- en: An R visual can handle a *dataframe with only 150,000 rows*. If there are more
    than 150,000 rows, only the first 150,000 rows are used and a relevant message
    is displayed on the image.
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R 可视化可以处理一个 *只有 150,000 行的 dataframe*。如果有超过 150,000 行，则只使用前 150,000 行，并在图像上显示相关消息。
- en: R visuals have an *output size limit of 2MB*.
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: R 可视化的 *输出大小限制为 2MB*。
- en: You must also be careful not to exceed the *5 minutes of runtime calculation*
    for an R visual in order to avoid a time-out error. Moreover, in order not to
    run into performance problems, note that *the resolution of the R visual plots
    is fixed at 72 DPI*.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 您还必须小心不要超过 R 可视化的 *5 分钟运行时计算*，以避免超时错误。此外，为了避免性能问题，请注意 *R 可视化图表的分辨率固定为 72 DPI*。
- en: As you can imagine, some limitations of R visuals are different depending on
    whether you run the visual on Power BI Desktop or the Power BI service.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所想象，R 可视化的局限性取决于您是在 Power BI Desktop 还是 Power BI 服务上运行该可视化。
- en: 'To create reports in *Power BI Desktop*, you can do any of the following:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 *Power BI Desktop* 中创建报告，您可以执行以下任何一项操作：
- en: Install any kind of package (CRAN, GitHub, or custom) in your engine for R visuals.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在您的引擎中为 R 可视化安装任何类型的软件包（CRAN、GitHub 或自定义）。
- en: Install only CRAN packages in your engine for custom R visuals (you will see
    an example in *Chapter 14, Interactive Custom Visuals in R*).
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在您的引擎中仅安装 CRAN 软件包以用于自定义 R 可视化（您将在 *第 14 章，R 中的交互式自定义可视化* 中看到一个示例）。
- en: Access the internet from both an R visual and a custom R visual.
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从 R 可视化和自定义 R 可视化访问互联网。
- en: 'When creating reports in *the Power BI service*, note the following:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *Power BI 服务* 中创建报告时，请注意以下事项：
- en: 'For both R visuals and custom R visuals, you can use *only the CRAN packages
    listed at this link*: [https://bit.ly/powerbi-r-limits](https://bit.ly/powerbi-r-limits).'
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 R 可视化和自定义 R 可视化，您可以使用 *此链接中列出的 CRAN 软件包*：[https://bit.ly/powerbi-r-limits](https://bit.ly/powerbi-r-limits)。
- en: You cannot access the internet from either R visuals or custom R visuals.
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您无法从 R 可视化或自定义 R 可视化访问互联网。
- en: As you may have noticed, although the CRAN packages that can be used in an R
    visual on the Power BI service are limited, you can still count more than 900
    packages in that list! In addition to the fact that R was the first analytical
    language introduced into Power BI, this shows that R is de facto considered one
    of the most versatile and professional languages for creating engaging visualizations.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 如您可能已经注意到的，尽管在 Power BI 服务上可用于 R 可视化的 CRAN 软件包有限，但您仍然可以数出列表中的 900 多个软件包！除了 R
    是第一个被引入 Power BI 的分析语言之外，这还表明 R 实际上被认为是创建引人入胜的可视化中最灵活和最专业的语言之一。
- en: As you probably already know, once one of your reports is published on the Power
    BI service, you can decide to share it on your blog, on one of your websites,
    or on social media via the **Publish to web** option. R visuals are not allowed
    to be published to the web.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所知，一旦你的报告在 Power BI 服务上发布，你可以决定通过“发布到网页”选项将其分享到你的博客、你的网站或社交媒体上。R 可视化不允许发布到网页。
- en: '**Important note**'
  id: totrans-243
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**重要提示**'
- en: ''
  id: totrans-244
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Custom R visual overcomes the limitation on punlishing to the web.
  id: totrans-245
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 自定义 R 可视化克服了发布到网页的限制。
- en: So, if you have to publish a report to the web, and that report contains a visualization
    created using R code, you must necessarily develop a custom R visual.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，如果你必须将报告发布到网页上，并且该报告包含使用 R 代码创建的可视化，你必须开发一个自定义 R 可视化。
- en: Summary
  id: totrans-247
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned about the most popular free R engines in the community.
    In particular, you learned what advantages have been introduced by Microsoft releasing
    its distribution of R to the market.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了社区中最受欢迎的免费 R 引擎。特别是，你了解了微软将其 R 分发版推向市场所引入的优势。
- en: Taking note of the unique features of Power BI Desktop and the Power BI service,
    you have learned how to properly choose the engines and how to install them.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到 Power BI Desktop 和 Power BI 服务的独特功能，你已经学会了如何正确选择引擎以及如何安装它们。
- en: You have also learned about the most popular IDE in the R community and how
    to install it.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 你还了解到了 R 社区中最受欢迎的集成开发环境（IDE）以及如何安装它。
- en: In addition, you were introduced to all of the best practices for properly configuring
    both Power BI Desktop and the Power BI service with R, whether in a development
    or enterprise environment.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你还了解了在开发或企业环境中，如何使用 R 正确配置 Power BI Desktop 和 Power BI 服务的最佳实践。
- en: Finally, you've learned some of the limitations on using R with Power BI, knowledge
    of which is critical to avoid making mistakes in developing and deploying reports.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你了解了一些使用 R 与 Power BI 相关的限制，这些知识对于避免在开发和部署报告时犯错误至关重要。
- en: In the next chapter, we'll see which Python engines and IDEs to install and
    configure in Power BI in order to develop and test Python scripts in comfort.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将看到在 Power BI 中需要安装和配置哪些 Python 引擎和 IDE，以便在舒适的环境中开发和测试 Python 脚本。
