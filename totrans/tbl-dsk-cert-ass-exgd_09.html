<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Tableau Table Calculations</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we learned how to create some simple calculations in Tableau. However, sometimes we might want to use the results of those calculations to create new insights. For instance, at this point in the book, we can use the knowledge we have gained thus far to create fields to show the total number of sales by customer and add calculations to show the average sales for a line item, but we can't use the results of the sales by customer to show the average overall sales by customer. This is where <strong>table calculations</strong> come in, enabling us to use the results of our prior calculations as input for new ones. </p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li><span>General table calculations and background</span></li>
<li><span>Creating quick table calculations</span></li>
<li>Customizing table calculations</li>
<li>Setting up manual table calculations</li>
<li>Practical examples</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>This chapter uses the Global Superstore dataset, which can be found at<span> </span><a href="http://www.tableau.com/sites/default/files/training/global_superstore.zip" target="_blank">http://www.tableau.com/sites/default/files/training/global_superstore.zip</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">General table calculations and background</h1>
                </header>
            
            <article>
                
<p><span>A table calculation is a way to take the results of usual calculations, as defined in the previous chapters, and perform additional calculations based on those results (and not on the underlying data). </span></p>
<p>Let's take an example of a table calculation that looks at the average of <kbd>SUM(Profit)</kbd> by <kbd>Year (Order Date)</kbd> (we will learn how to create such a calculation later in this chapter):</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c4ac2c17-3964-474c-9192-e930a93e358d.png" style="width:34.75em;height:31.00em;"/></p>
<p>In this instance, the average is calculated by looking at the aggregated marks (in this case, (<span class="packt_screen">$248,941+<span>$307,415</span></span>+<span class="packt_screen">$406,935</span>+<span class="packt_screen">$504,166</span>)/4 = <span><span class="packt_screen">$366,864</span></span><span>), not by averaging the profits in the underlying data.</span></p>
<p>There are two main components to a table calculation in Tableau. The first element is the calculation that we want to perform on those marks (in this case, a straight average on the marks). The second is the <strong>scope</strong> (or <strong>partition</strong>), which we will look at in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Structure of a view</h1>
                </header>
            
            <article>
                
<p>A Tableau worksheet view can be broken down into three main levels, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1457 image-border" src="assets/7c033118-9719-4c88-a810-93339c54fc6b.png" style="width:57.25em;height:20.83em;"/></p>
<p><span>While the </span><span class="packt_screen">Table</span><span> represents the entire view, a </span><span class="packt_screen">Pane</span><span> is the part of the view corresponding to an intersection of dimensions in the rows and columns that is delimited by a </span><strong>dividing line</strong><span>. For instance, in this example, there are 12 panes because there are 4 divided column sections and 3 row sections, and therefore, there are 12 intersections</span><span>.</span></p>
<p><span>Lastly, the </span><span class="packt_screen">Cell</span><span> is the smallest intersection of dimensions, and there are 180 of them in the preceding view. In this case, the cell consists of one single mark (a text value), but a cell can include multiple marks, as shown in the following screenshot:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/98cababe-f7c9-4af8-9aba-9d1adb195dcf.png" style="width:50.92em;height:21.58em;"/></p>
<p>Let's see how these different partitions interact with table calculations.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining the scope of a calculation</h1>
                </header>
            
            <article>
                
<p>Table calculations are always calculated within a particular scope, which is usually one of the three options that we looked at in the previous section (a <span class="packt_screen">Table</span>, <span class="packt_screen">Pane</span>, or <span class="packt_screen">Cell</span>); this enables Tableau to know when if or when to reset the calculation at a certain point.</p>
<p>Let's use our previous example and introduce <kbd>Segment</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/aece3b42-a42c-4c66-9dd4-5d33122fde6d.png" style="width:43.92em;height:27.42em;"/></p>
<p class="mce-root"/>
<p>In this case, the same calculation can take one value for the entire table (<span class="packt_screen">along Table</span>), or be calculated within every pane (<span class="packt_screen">along Pane</span>) or every cell (<span class="packt_screen">along Cell</span>).</p>
<p>Some options also include a direction: <span class="packt_screen">Down</span>, <span class="packt_screen">Across</span> (which resets when you get to the bottom or the right of the partition) or combinations, such as <span class="packt_screen">Across, then Down</span> (which continues with the next row, rather than stopping at the end of the current one, while within the scope).</p>
<p><span>Finally, table calculations are sometimes computed relative to another cell. </span><span>For instance, if we are calculating a percentage difference, we have to specify which cell is the reference for the calculation. T</span><span>his can be within the scope, the first or the last, the previous or the next, or the cell corresponding to a specific value of a dimension (for example, relative to the value associated with the year 2011). </span></p>
<p>To summarize, table calculations are further computations on the aggregated results of our simple calculations, defined within a certain scope. <span>Now that we have some context for table calculations, let's start to set some </span><span>up</span><span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating quick table calculations</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>The easiest way to create a table calculation is to start with the</span><span> </span><span class="packt_screen">Quick Table Calculations</span><span> </span><span>options.</span></p>
<p class="mce-root">Every pill representing a measure (including a count or distinct counts of dimensions), whether discrete or continuous, holds the <span class="packt_screen">Quick Table Calculation</span> option in its own menu:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dae967a3-8566-4af6-b39b-f774c00fbafd.png" style="width:27.25em;height:36.00em;"/></p>
<p>Using one of the options presented here will replace the current aggregation with a table calculation, and the pill will then include a <span class="packt_screen">Δ</span> sign to signify that the calculation is now a table calculation. Let's go through the different options available.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Different options for quick calculations</h1>
                </header>
            
            <article>
                
<p>There are 11 options in total to create quick table calculations:</p>
<ul>
<li><span class="packt_screen">Running Total</span> progressively sums the aggregated marks within the partition and along a direction (across or down).</li>
<li><span class="packt_screen">Difference</span> is the absolute difference between the mark and a reference mark: (Mark - Reference).</li>
<li><span class="packt_screen">Percent Difference</span> states the relative difference: (Mark - Reference) / Reference.</li>
<li><span class="packt_screen">Percent of Total</span> shows the contribution of the current mark to the total aggregation of marks within the scope.</li>
</ul>
<div class="packt_tip"><span class="packt_screen">Percent of Total</span><span> </span>calculations can also be turned on via<span> </span><span class="packt_screen">Analysis | Percentage Of | ...</span>, although this will affect all measures.</div>
<ul>
<li><span class="packt_screen">Rank</span> ranks the cells based on their value (with different options for how to differentiate between cells with equal values).</li>
<li><span class="packt_screen">Percentile</span><span> </span>represents how many cells within the scope are lower than the current value.</li>
<li><span class="packt_screen">Moving Average</span> averages a set number of previous and next values.</li>
</ul>
<p>Finally, there are four time-based quick table calculations:</p>
<ul>
<li><span class="packt_screen">YTD</span> (Year To Date) <span class="packt_screen">Total</span> is a running sum that restarts every year.</li>
<li><span class="packt_screen">Compound Growth Rate</span> computes the growth rate <em>r</em> relative to the first value so that <img class="fm-editor-equation" src="assets/c7f0f17b-8f20-4086-9c27-a162697d07d8.png" style="width:16.17em;height:1.58em;"/>. This is used to decide what the growth factor would have been, had the evolution been perfectly steady.</li>
<li><span class="packt_screen">Year Over Year Growth</span> calculates a percentage difference compared to the same period in the previous year.</li>
<li><span class="packt_screen">YTD Growth</span> creates a percentage difference compared to the <span class="packt_screen">YTD Total</span> in the previous year.</li>
</ul>
<p>It is important to note that <span class="packt_screen">YTD</span> <span>calculations require a</span> discrete date field <span>with granularity strictly finer than a year (for instance, Year, Quarter, Month, or Year, Month), while the</span> <span><span class="packt_screen">Year Over Year Growth</span> requires a discrete date field that can be a</span> <span>year</span> <span>or finer</span><span>.</span></p>
<div class="packt_tip"><span>It is possible to drag a pill that includes a table calculation back into the <span class="packt_screen">Data</span> pane to create a calculated field based on the current definition of the table calculation. Editing a table calculation created this way helps you understand how Tableau performs the calculation under the hood.</span></div>
<div>
<p><span>If at any point you want to revert to the original calculation, you can use the <span class="packt_screen">Clear Table Calculation</span> option when right-clicking the pill.</span></p>
<p>Now that a quick calculation has been turned on, let's see how we can change the different parameters to take control of this out-of-the-box calculation.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Customizing table calculations</h1>
                </header>
            
            <article>
                
<p>One of the first things that users want to do after creating a quick table calculation is to update the scope of the calculation, as the default choice was not necessarily what they had in mind.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adapting a % Difference Calculation</h1>
                </header>
            
            <article>
                
<p>Let's plot <kbd>Profit</kbd> by <kbd>Year(Order Date)</kbd> in rows and <kbd>Quarter(Order Date)</kbd> in columns, create a quick calculation for <span class="packt_screen">% Difference</span>, and add <kbd>Profit</kbd> back into the view by double-clicking on the field in the <span class="packt_screen">Data</span> pane (as the table calculation will take over the original <kbd>Profit</kbd> field, and it is not possible to add the same calculation twice):</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fe18c632-8084-483a-914a-67f2e70913bd.png" style="width:46.25em;height:32.25em;"/></p>
<p>Tableau's default choice was to compute this table calculation along <span class="packt_screen">Table (across)</span> and relative to the <span class="packt_screen">Previous</span> value, which shows us quarter-over-quarter growth, but not between Q4 and Q1. When Tableau runs across the table, its instructions are only to go across. When it can't go any further, it will reset and restart at the next row. If we wanted to see the growth relative to the first quarter of 2011 instead, we would need to perform two actions, which we will look at in the following sections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining a percent difference versus the first cell in the partition</h1>
                </header>
            
            <article>
                
<p>First, we should change the calculation so that it's relative to the <span class="packt_screen">First</span> rather than the <span class="packt_screen">Previous</span>. This can be achieved by right-clicking the pill under the <span class="packt_screen">Relative to</span> option, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1458 image-border" src="assets/f5d9554a-d019-4c7d-899f-2542867cffaf.png" style="width:21.00em;height:8.17em;"/></p>
<p>This will make it so that each line compares the current value to the first in the line (in this case, the <span class="packt_screen">Q1</span> of the given year). If we want it to compare all lines to the first value of the first line (that is, <span class="packt_screen">Q1 2011</span>) instead, we can change <span class="packt_screen">Compute Using</span> to <span class="packt_screen">Table (Down then Across)</span> in the same pill menu.</p>
<div class="packt_infobox"><span>Sometimes, some of the options for </span><span class="packt_screen">Compute using</span><span> (for instance </span><span class="packt_screen">Pane (across)</span><span>) will not appear. That is </span><span>because that option is not relevant to your current view, and is probably already covered by another choice, for example </span><span class="packt_screen">Table (across).</span></div>
<p>In this instance, you can also choose <span class="packt_screen">Down then Across:</span> as we are comparing with the first value in the table and not the previous or next, the order is less important:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/86ea983a-0eb1-4bed-a76e-c1a8464c54d2.png" style="width:29.92em;height:14.33em;"/></p>
<p>All calculations are now relative to Q1 2011, which is what we wanted.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using a different order</h1>
                </header>
            
            <article>
                
<p>If we changed the options to <span class="packt_screen">Compute Using Table (Down then Across)</span> and <span class="packt_screen">Relative to Next</span>, we could get drastically different results:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1459 image-border" src="assets/cf0956cf-7a67-4dba-b1d4-f2392253a5c0.png" style="width:44.83em;height:30.42em;"/></p>
<p>Because we are going <span class="packt_screen">Down then Across</span>, we are calculating a percentage <span><span>difference </span></span>for all quarters compared to the next year (going down takes us through the years for a given quarter). The exception is for Q1–Q3 2014, where we would get the difference compared to the next quarter in <em>2011</em>; because there is no following year for the given quarter, we are going across to the first year of the following quarter. In this case, we are comparing <span class="packt_screen">$85,110</span> in Q1 2014 to <span class="packt_screen">$48,501</span> in Q2 2011.</p>
<p>We cannot stress enough that the order is very important if we want to get meaningful results.</p>
<div class="packt_tip">It is also possible to change those options from the <span class="packt_screen">Edit Table Calculation</span> window, which you can find when right-clicking the pill.</div>
<p>Now that we've learned how to create quick table calculations, let's see if you can get more depth by creating manual table calculations, which will, for instance, allow us to compute an average of all the marks in the view.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up manual table calculations</h1>
                </header>
            
            <article>
                
<p>While it is possible to create some table calculations easily with the quick options, there are times when an off-the-shelf calculation cannot fit your needs. In this case, you need to create a manual table calculation. This is done by creating a calculated field.</p>
<p>As a reminde<span>r, you can create a calculated field by any one of the following three methods:</span></p>
<ul>
<li><span>Go to </span><span class="packt_screen">Analysis | Create Calculated Field...</span><span> in the menu bar.</span></li>
<li><span>Right-click any field in the </span><span class="packt_screen">Data</span><span> pane and use the </span><span class="packt_screen">Create | Calculated Field...</span><span> option.</span></li>
<li><span>Click the arrow next to the search icon in the </span><span class="packt_screen">Data</span><span> pane, close to </span><span class="packt_screen">Dimensions</span><span>, and use </span><span><span class="packt_screen">Create Calculated Field...</span></span>.</li>
</ul>
<p>There, you can define your function manually and choose <span class="packt_screen">Default Table Calculation</span> options once the calculation is valid. Let's go over the three main types of functions that are available to users.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating functions similar to quick table calculations</h1>
                </header>
            
            <article>
                
<p>There are two ranges of functions available that work in a very similar way to some of the quick options.</p>
<p>The first range is the <kbd>RUNNING</kbd> functions, including <kbd>RUNNING_SUM</kbd>, <kbd>RUNNING_COUNT</kbd>, and so on. These functions aggregate the results that are in cells in the current partition by starting with the first one and running along, updating the calculation and aggregating the results for each new cell. While the running sum is the most obvious example, and is one of the available quick calculations, it can sometimes be useful to use another running function to provide results. For instance, the <kbd>RUNNING_MAX</kbd> function is useful when keeping track of a record, as the function will update to the largest value up to the point of the calculation.</p>
<div class="packt_tip">When creating a table calculation, it is imperative that you use an aggregation inside of the function, as the syntax checker will remind you. </div>
<p><span>For instance, if we wanted to keep track of our record line profit, we could create</span> <kbd>Record Line Profit</kbd> <span>as</span> <kbd>RUNNING_MAX(MAX([Profit])</kbd> <span>and add it to a view with</span> <kbd>MAX(Profit)</kbd> <span>by</span> <kbd>Year (Order Date)</kbd><span> and</span> <kbd>Quarter (Order Date)</kbd>. This <span>will show the record to date for the largest line profit (</span><span class="packt_screen">$2,939</span> <span>until Q2 2011, then</span> <span class="packt_screen">$4,630</span> <span>until Q3 2013, and so on).</span></p>
<p>The second type of function that should be familiar is the <kbd>RANK</kbd> functions, including <kbd>RANK</kbd>, <kbd>RANK_DENSE</kbd>, and so on. These functions will, as their name suggests, rank the results in the cells based on a given order (either descending (the default) or ascending, as defined by the second argument of the function). Here is a quick summary of how the different functions will rank the same set of data (10, 10, 15, 20) in ascending order:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td style="width: 12%"><strong>Function</strong></td>
<td style="width: 26.7435%"><strong>How 10, 10, 15, 20 are ranked in ascending order</strong></td>
<td style="width: 30.2565%"><strong>Comment</strong></td>
</tr>
<tr>
<td style="width: 12%"><kbd>RANK</kbd></td>
<td style="width: 26.7435%">1, 1, 3, 4</td>
<td style="width: 30.2565%">Same rank (highest) for equal values</td>
</tr>
<tr>
<td style="width: 12%"><kbd>RANK_DENSE</kbd></td>
<td style="width: 26.7435%">1, 1, 2, 3</td>
<td style="width: 30.2565%"><span>Same rank (highest) for equal values; no gap</span></td>
</tr>
<tr>
<td style="width: 12%"><kbd>RANK_MODIFIED</kbd></td>
<td style="width: 26.7435%">2, 2, 3, 4</td>
<td style="width: 30.2565%"><span>Same rank (lowest) for equal values</span></td>
</tr>
<tr>
<td style="width: 12%"><kbd><span>RANK_UNIQUE</span></kbd></td>
<td style="width: 26.7435%"><span>1, 2, 3, 4</span></td>
<td style="width: 30.2565%"><span>Unique rank</span></td>
</tr>
<tr>
<td style="width: 12%"><kbd><span>RANK_PERCENTILE</span></kbd></td>
<td style="width: 26.7435%"><span>50, 50, 75, 100</span></td>
<td style="width: 30.2565%"><span>Percentile rank (% of values equal or below this)</span></td>
</tr>
</tbody>
</table>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Lookup function</h1>
                </header>
            
            <article>
                
<p>When Tableau computes a table calculation for <span class="packt_screen">Percent Difference</span> against the previous value, it actually uses one base table calculation function inside a more complicated calculation. If you wanted to drag and drop a <span class="packt_screen">Percent Difference</span> calculation into the <span class="packt_screen">Dimensions</span> pane and later <span class="packt_screen">Edit</span> that calculation, the resulting formula would look something like the following (simplified for our purposes):</p>
<p><kbd>( (SUM([Sales]) - LOOKUP(SUM([Sales]), -1) ) / LOOKUP(SUM([Sales]), -1)</kbd></p>
<p>Here, we can see that we are making the most of a function called <kbd>LOOKUP(expr, offset)</kbd>, which returns the value of the calculation specified by <kbd>expr</kbd> in a given cell, and more specifically of <span><kbd>LOOKUP(expr, -1)</kbd> to grab the results of the expression in the previous cell</span>.</p>
<p>When specifying the offset in the second part of the function to tell Tableau which cell to refer to, we can use simple numbers <em>relative</em> to the current cell, with negative numbers representing previous cells and positive ones representing the next cells. In the last example, we used <kbd>-1</kbd> for the previous cell, but it could also be <kbd>2</kbd> for the cell that is two rows after the current one. If there would be no such cells (because they would be out of bounds), the result would be <kbd>NULL</kbd>.</p>
<div class="packt_tip">Because the results of these can be <kbd>NULL</kbd>, Tableau generally uses a function called <kbd>ZN(expr)</kbd>, which returns the results of the expression if it is not <kbd>NULL</kbd>, and <kbd>0</kbd> otherwise. This would be the case when looking at the <span class="packt_screen">P</span><span class="packt_screen">ercent Difference</span> formula.</div>
<p>Finally, we also have the option of using <kbd>FIRST()</kbd> and <kbd>LAST()</kbd> for an <em>absolute</em> position, to specify that we are after the results that are in the first or last row of the current partition. For instance, <kbd>LOOKUP(SUM([Sales],LAST()-1)</kbd> would return the sales in the second to last row of the partition.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining Window functions</h1>
                </header>
            
            <article>
                
<p>The last type of function that is very useful in Tableau, and especially in the exam, are <kbd>Window</kbd> functions. These are a set of functions that includes <kbd>WINDOW_SUM</kbd>, <kbd>WINDOW_COUNT</kbd>, <kbd>WINDOW_AVERAGE</kbd>, and so on. These functions all work in a similar manner. The basic syntax for these functions is <kbd>WINDOW_SUM(expr, [start,end])</kbd>.</p>
<p>There are two main ways to use these functions. The first is to use the calculation without specifying a <kbd>start</kbd> or an <kbd>end</kbd> in the second part. In this case, the function will perform the specified aggregation, for instance <kbd>SUM</kbd>, against all rows that are currently in the partition (as defined by the <span class="packt_screen">Compute using</span> option when right-clicking the pill). We will use this technique in the second practical example at the end of this chapter.</p>
<p>Additionally, we can, of course, specify the start and end, which will calculate the specified option only within the desired range. For instance, <kbd>WINDOW_AVG(expr,-1,1)</kbd> will average the results of the previous, current, and next cell. We just created a moving average for three periods!</p>
<p>As was the case with <kbd>LOOKUP</kbd>, we can also make the most of the <kbd>FIRST()</kbd> and <kbd>LAST()</kbd> functions. For example, <kbd>WINDOW_SUM(expr,FIRST(),0)</kbd> will sum all cells between the first and the current cells. We just set up a running sum!</p>
<p>With this last set of useful manual alternatives, our exploration of the different options to create table calculations draws to a close. Let's now practice our newly acquired talents with some exercises.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Practical examples</h1>
                </header>
            
            <article>
                
<p>Before concluding this chapter, let's go over two quick examples that are based on questions that were used in real exams.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Moving average</h1>
                </header>
            
            <article>
                
<div class="packt_quote">Using Global Superstore, as of June 2012, what is the sum of the sales of the previous twelve months and the following twelve months, excluding the current month?</div>
<p>To do this, we start by plotting <kbd>SUM(Sales)</kbd> by <kbd>Month(Order Date)</kbd>. Then we create a quick table calculation for <span class="packt_screen">Moving Average</span> by right-clicking the pill.</p>
<div class="packt_tip">To add <kbd>Month(Order Date)</kbd> as shown in the following screenshot, you can drop <kbd>Order Date</kbd> in rows, then click on the pill menu for the second <span class="packt_screen">Month</span> option (the one that reads a month and year) and change the pill to <span class="packt_screen">Discrete</span> (in the pill menu).</div>
<p>The default calculation averages the values of the month in focus and the two previous ones, but we can go to <span class="packt_screen">Edit Table Calculation</span> in the pill menu to specify that we want a <span class="packt_screen">Sum</span> for the previous 12 values, and the next 12 values and untick <span class="packt_screen">Current value</span> to exclude it from the calculation.</p>
<p>Then we add <kbd>SUM(Sales)</kbd> again alongside the calculation:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1193 image-border" src="assets/3ce847b1-d245-43b9-8d93-8012bb0e4e5c.png" style="width:68.58em;height:44.25em;"/></p>
<p>From there, we can immediately see that the required sum was <span class="packt_screen">$5,481,129</span> for June 2012.</p>
<div class="packt_tip">Dropping the calculation in the data pane tells us that we could also have defined a manual table calculation that read<br/>
<kbd>WINDOW_SUM(SUM([Sales]), -12, -1) + WINDOW_SUM(SUM([Sales]), 1, 12)</kbd>,<br/>
which sums <kbd>Sales</kbd> for the previous 12 values (offset -12 to -1) and the next 12 values (offset 1 to 12).</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Difference in average profit</h1>
                </header>
            
            <article>
                
<div class="packt_quote">Using Global Superstore, what is the difference between the average profit for <span class="packt_screen">Furniture</span> orders for customer <span class="packt_screen">Aaron Bergman</span> and the lowest average profit worldwide for any customer/category combination?</div>
<div>
<p>We can <span>first</span><span> </span><span>plot the average</span><span> </span><kbd>Profit</kbd><span>, slicing by</span><span> </span><kbd>Category</kbd><span> </span><span>and</span><span> </span><kbd>Customer</kbd><span>. In this case, we want to compare the </span><span class="packt_screen">$79</span><span> average profit in </span><span class="packt_screen">Furniture</span><span> for this customer with the lowest average profit in the table. Because of the number of marks (more than 2,000), this is not a very easy task if we are just using the tools that we have learned about so far. Just showing</span> <kbd>MIN([Profit])</kbd> <span>will not help us, since this will just show us the lowest profit for a line item, not the lowest customer average.</span></p>
<p>Let's define <kbd>Lowest Average Profit</kbd> as <kbd>WINDOW_MIN(AVG([Profit]))</kbd> by creating a calculated field and adding it to the view. By default, the calculation shows the lowest value for the customer because the <span class="packt_screen">Compute using</span> is set as <span class="packt_screen">Table (across),</span> which means that the calculation restarts for every row. Changing this to <span class="packt_screen">Table (across then down)</span> will ensure that the calculation encompasses the entire table:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1194 image-border" src="assets/a5574eea-4aac-4fbc-9178-9c240ca3162a.png" style="width:43.42em;height:30.25em;"/></p>
<p>It is now easy to calculate that the required difference is <span class="packt_screen">$79</span> - <span class="packt_screen">($1,345)</span> = <span class="packt_screen">$1,424</span>. Should we not feel in the mood for this simple calculation, we can also define <kbd>Lowest Average Profit</kbd><span> as </span><kbd>AVG([Profit]) - WINDOW_MIN(AVG([Profit]))</kbd> instead, which will display the result immediately.</p>
<p>With this, we conclude this chapter on table calculations, having run through two examples illustrating some of the simple and more advanced options available.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we covered table calculations, which <span>enable us to use the results of our prior calculations as input for new ones. We learned how to create simple calculations with the click of a button, how to change their scope and customize them, and how to use them to create new and more complex calculations. After learning about simple aggregations in the previous chapter, this chapter serves as a good introduction to Tableau's most daunting element when coming from Excel or other BI tools: level of detail calculations. These will be covered in the next chapter, where we will learn how to make use of information that is not visible in the current views.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p>Answer the following questions to test your knowledge of the information in this chapter.</p>
<p>Q: Is it true that table calculations take into account the underlying data and can help create weighted averages?</p>
<p>A: No, table calculations use the results of prior aggregations as input for new ones, so a table calculation for an average will do a straight average of the results within the scope, not a weighted average. For an example, please refer to the first section of this chapter.</p>
<p>Q: One of the options for quick table calculations is <span class="packt_screen">Total Sum</span> of all values. True or False?</p>
<p>A: False. The different options are listed in the chapter, although you could use one of the manual <kbd>Window</kbd> functions to achieve this result.</p>
<p>Q: Table calculations can also be created on dimensions. True or False?</p>
<p>A: True. You can create table calculations on counts and distinct counts of dimensions.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>You can check out the following links for more information about the topics that were<br/>
covered in this chapter:</p>
<ul>
<li><strong>Different types of addressing</strong>: <a href="https://help.tableau.com/current/pro/desktop/en-us/calculations_tablecalculations.htm#table-across">https://help.tableau.com/current/pro/desktop/en-us/calculations_tablecalculations.htm#table-across</a></li>
<li><strong>Using specific dimensions</strong>: <a href="https://help.tableau.com/current/pro/desktop/en-us/calculations_tablecalculations.htm#specific-dimensions">https://help.tableau.com/current/pro/desktop/en-us/calculations_tablecalculations.htm#specific-dimensions</a></li>
<li><strong>Top 10 Table Calculations</strong>: <a href="https://www.tableau.com/about/blog/2019/11/top-10-tableau-table-calculations">https://www.tableau.com/about/blog/2019/11/top-10-tableau-table-calculations</a></li>
<li><strong>Table Calculations White Paper</strong>: <a href="https://www.tableau.com/sites/default/files/pages/table_calcs_in_tableau_6.pdf">https://www.tableau.com/sites/default/files/pages/table_calcs_in_tableau_6.pdf</a></li>
</ul>


            </article>

            
        </section>
    </body></html>