<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 5. Executing Geoprocessing Tools from Scripts"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Executing Geoprocessing Tools from Scripts</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Finding geoprocessing tools</li><li class="listitem" style="list-style-type: disc">Retrieving a toolbox alias</li><li class="listitem" style="list-style-type: disc">Executing geoprocessing tools from a script</li><li class="listitem" style="list-style-type: disc">Using the output of a tool as an input to another tool</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec43"/>Introduction</h1></div></div></div><p>ArcGIS for Desktop contains over 800 geoprocessing tools, which can be used in your Python scripts. Using geoprocessing tools from your Pythons scripts enables you to execute complex workflows and perform batch geoprocessing tasks. In this chapter, you will learn how to use these tools in your scripts. Each tool has unique characteristics. The syntax to execute each will differ depending upon the type of input required to successfully execute the tool. We'll examine how you can determine the input parameters for any tool by using the ArcGIS for Desktop help system. The execution of a tool results in the creation of one or more output datasets along with a set of messages that are generated while the tool is running. We'll examine how you can use these messages.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Finding geoprocessing tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec44"/>Finding geoprocessing tools</h1></div></div></div><p>Before using a<a id="id308" class="indexterm"/> tool in your geoprocessing script, you will need to make sure that you have access to this tool, based on the current license level of ArcGIS for Desktop that you are running or that your end users will run. In addition to this, any extensions you have licensed and enabled must be taken into consideration as well. This information is contained within the ArcGIS for Desktop help system.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec113"/>Getting ready</h2></div></div></div><p>The availability of geoprocessing tools for your script is dependent on the level of the ArcGIS license you are using. In version 10.3 of ArcGIS for Desktop, there are three license levels, namely basic, standard, and advanced. These were formerly known as <a id="id309" class="indexterm"/>
<span class="strong"><strong>ArcView</strong></span>, <a id="id310" class="indexterm"/>
<span class="strong"><strong>ArcEditor</strong></span>, and <a id="id311" class="indexterm"/>
<span class="strong"><strong>ArcInfo</strong></span>, respectively. It is important for you to understand the license level required for the tool that you want to use in your script. In addition to this, the use of extensions in ArcGIS for Desktop can result in the availability of additional tools for your script. There are two primary ways to find tools in ArcGIS for Desktop. The first is to use the search window and the second is to simply browse the contents of <a id="id312" class="indexterm"/>
<span class="strong"><strong>ArcToolbox</strong></span>. In this recipe, you will learn how to use the search window to find available geoprocessing tools that can be used in your scripts.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec114"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open<a id="id313" class="indexterm"/> <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap.</li><li class="listitem">From the <span class="strong"><strong>Geoprocessing</strong></span> menu item, select <span class="strong"><strong>Search For Tools</strong></span>. This will display the <span class="strong"><strong>Search</strong></span> window, as shown in the following screenshot. By default, you will be searching for <span class="strong"><strong>Tools</strong></span>:<div class="mediaobject"><img src="images/B04314_05_1.jpg" alt="How to do it…"/></div></li><li class="listitem">Type<a id="id314" class="indexterm"/> the <code class="literal">Clip</code> term into the search textbox. As you begin typing this word, the search textbox will automatically filter the results based on the first few letters you type. You'll notice that for <code class="literal">Clip</code>, there are three possible tools: <code class="literal">clip(analysis), clip(coverage)</code>, and <code class="literal">clip(data_management)</code>. There are a number of cases where there are several geoprocessing tools with the same name. To uniquely define a tool, the toolbox alias is attached to the tool name. We'll examine toolbox aliases in greater detail in the next recipe.</li><li class="listitem">For now, click on the search button to generate a list of matching tools. The search should generate a list similar to what you see in the following screenshot. Tools are indicated by a hammer icon in the search results. You'll also see a couple of other icons in the search results. The scroll icon indicates a Python script, and an icon containing multicolored squares indicates a model:<div class="mediaobject"><img src="images/B04314_05_2.jpg" alt="How to do it…"/></div></li><li class="listitem">Select <a id="id315" class="indexterm"/>the <span class="strong"><strong>Clip (Analysis)</strong></span> tool. This will open the dialog box for <span class="strong"><strong>the Clip (Analysis)</strong></span> tool. This isn't all that useful to you as a script programmer. You will probably be more interested in the help provided by ArcGIS for Desktop for a particular tool.</li><li class="listitem">Click on the <span class="strong"><strong>Tool Help</strong></span> button at the bottom of the tool dialog box to display detailed information about this particular tool:<div class="mediaobject"><img src="images/B04314_05_3.jpg" alt="How to do it…"/></div></li><li class="listitem">Scroll down to the bottom of the help page for the <span class="strong"><strong>Clip</strong></span> tool to examine the syntax for this particular tool.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec115"/>How it works…</h2></div></div></div><p>The <a id="id316" class="indexterm"/>help system contains a summary, illustration, usage, syntax, code samples, available environment variables, related topics, and licensing information for each tool. As a geoprocessing script programmer, you will primarily be interested in the syntax, code samples, and licensing information sections near the bottom.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>You should always examine the licensing information section at the bottom of the help documentation for each tool, to make sure you have the appropriate license level to use the tool.</p></div></div><p>The syntax section contains information about how this tool should be called from your Python script, including the name of the tool and the required and optional input parameters. All the parameters will be enclosed within parentheses. The required parameters for the <code class="literal">Clip</code> tool are <code class="literal">in_features</code>, <code class="literal">clip_features</code>, and <code class="literal">out_feature_class</code>. When you call this tool from your script, you will be required to provide these parameters to the tool for it to execute correctly. The fourth parameter is an optional parameter called <code class="literal">cluster_tolerance</code>. Parameters marked as optional in the syntax are surrounded by curly braces. The following screenshot provides an example of an optional parameter surrounded by curly braces. This doesn't mean that you enclose the parameter in curly braces when you call the tool. It is in the help section simply to indicate that this <a id="id317" class="indexterm"/>parameter is optional when being called from your geoprocessing script:</p><div class="mediaobject"><img src="images/B04314_05_4.jpg" alt="How it works…"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Retrieving a toolbox alias"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec45"/>Retrieving a toolbox alias</h1></div></div></div><p>All toolboxes have an<a id="id318" class="indexterm"/> alias which, when combined with the tool name, provides a unique reference to any tool in ArcGIS for Desktop. This alias is necessary because a number of tools have the same name. When referencing a tool from your Python script, it is necessary to reference both the tool name and alias.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec116"/>Getting ready</h2></div></div></div><p>In the last recipe, we looked at the <span class="strong"><strong>Clip</strong></span> tool. There are actually three <span class="strong"><strong>Clip</strong></span> tools, which can be found in the <span class="strong"><strong>Analysis Tools</strong></span>, <span class="strong"><strong>Coverage Tools</strong></span>, and <span class="strong"><strong>Data Management Tools</strong></span> toolboxes. Each <span class="strong"><strong>Clip</strong></span> tool performs a different function. For instance, the <span class="strong"><strong>Clip</strong></span> tool in the <span class="strong"><strong>Analysis Tools</strong></span> toolbox clips a vector feature class using an input feature, while the <span class="strong"><strong>Clip</strong></span> tool in the <span class="strong"><strong>Data Management Tools</strong></span> toolbox is used to create a spatial subset of a raster. Since it is possible to have multiple tools with the same name, we can uniquely identify a particular tool by providing both the tool name and the toolbox alias in which the tool resides. In this recipe, you will learn how to find the alias of a toolbox.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec117"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap.</li><li class="listitem">If necessary, <a id="id319" class="indexterm"/>open <span class="strong"><strong>ArcToolbox</strong></span>.</li><li class="listitem">Find the <span class="strong"><strong>Analysis Tools</strong></span> toolbox, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_05_5.jpg" alt="How to do it…"/></div></li><li class="listitem">Right-click on the <span class="strong"><strong>Analysis Tools</strong></span> toolbox and select <span class="strong"><strong>Properties</strong></span>. This will display the <span class="strong"><strong>Analysis Tools Properties</strong></span> dialog box, as shown in the following screenshot. The <span class="strong"><strong>Alias:</strong></span> textbox will contain the alias:<div class="mediaobject"><img src="images/B04314_05_6.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec118"/>How it works…</h2></div></div></div><p>You can follow<a id="id320" class="indexterm"/> this process to find the alias name of any toolbox. In a Python script, you can execute a tool by referring to the tool with the <code class="literal">&lt;toolname&gt;_&lt;toolbox alias&gt;</code> syntax. For example, if you were calling the <span class="strong"><strong>Buffer</strong></span> tool, it would be <code class="literal">Buffer_analysis</code>. Toolbox aliases are invariably simple. They are typically one word and do not include dashes or special characters. In the next recipe, we'll create a simple script that follows this format to execute a tool.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Executing geoprocessing tools from a script"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Executing geoprocessing tools from a script</h1></div></div></div><p>Once you have <a id="id321" class="indexterm"/>determined the toolbox alias and then<a id="id322" class="indexterm"/> verified the accessibility of the tool based on your current license level, you are ready to add the execution of the tool to a script.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec119"/>Getting ready</h2></div></div></div><p>Now that you understand how to find the tools that are available and how to uniquely reference them, the next step is to put this together and execute a tool from a geoprocessing script. In this recipe, you can then execute the tool from your script.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec120"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">C:\ArcpyBook\Ch5\Crime_Ch5.mxd</code> in ArcMap.</li><li class="listitem">Click on the <span class="strong"><strong>Add Data</strong></span> button and add the <code class="literal">EdgewoodSD.shp</code> file to the table of contents from the <code class="literal">c:\ArcpyBook\Ch5</code> folder.</li><li class="listitem">If needed, turn off the <span class="strong"><strong>Crime Density by School District</strong></span> and <span class="strong"><strong>Burglaries in 2009</strong></span> layers to get a better view of the <span class="strong"><strong>EdgewoodSD</strong></span> layer. There is only one polygon feature in this file. It represents the <span class="strong"><strong>Edgewood School District</strong></span>. Now, we're going to write a script that clips the <span class="strong"><strong>Burglaries in 2009</strong></span> features to this school district.</li><li class="listitem">Open the Python window in ArcMap.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div class="informalexample"><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Create a variable that references the input feature class to be clipped:<div class="informalexample"><pre class="programlisting">in_features = "c:/ArcpyBook/data/CityOfSanAntonio.gdb/Burglary"</pre></div></li><li class="listitem">Create a variable that references the layer to be used for the clip:<div class="informalexample"><pre class="programlisting">clip_features = "c:/ArcpyBook/Ch5/EdgewoodSD.shp"</pre></div></li><li class="listitem">Create a variable that references the output feature class:<div class="informalexample"><pre class="programlisting">out_feature_class = "c:/ArcpyBook/Ch5/ClpBurglary.shp"</pre></div></li><li class="listitem">Execute the <span class="strong"><strong>Clip</strong></span> tool from the <span class="strong"><strong>Analysis Tools</strong></span> toolbox:<div class="informalexample"><pre class="programlisting">arcpy.Clip_analysis(in_features,clip_features, out_feature_class)</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch5\ExecuteGeoprocessingTools.py</code> solution file.</li><li class="listitem">Run the script. The output feature class containing only those burglary points within the <span class="strong"><strong>EdgewoodSD</strong></span> school district should be added to the data frame, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_05_7.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec121"/>How it works…</h2></div></div></div><p>The primary line of <a id="id323" class="indexterm"/>code of interest in this recipe is the final<a id="id324" class="indexterm"/> line that executes the <span class="strong"><strong>Clip</strong></span> tool. Notice that we called this tool by specifying a syntax of <code class="literal">Clip_analysis</code>, which gives us a reference to the <span class="strong"><strong>Clip</strong></span> tool in the <span class="strong"><strong>Analysis Tools</strong></span> toolbox, which has an alias of <code class="literal">analysis</code>. We've also passed three parameters that reference the input feature class, clip feature class, and output feature class. I should point out that we hardcoded the paths to each of the datasets. This is not a good programming practice, but in this particular instance, I just wanted to illustrate how to execute a tool. A future chapter will show how you can remove the hardcoding in your scripts and make them much more versatile.</p><p>Most tools that you use will require paths to data sources. This path must be the same as the path reported on the ArcCatalog <span class="strong"><strong>Location:</strong></span> toolbar, as shown in the following screenshot:</p><div class="mediaobject"><img src="images/B04314_05_8.jpg" alt="How it works…"/></div><p>Tools use <a id="id325" class="indexterm"/>ArcCatalog to find geographic<a id="id326" class="indexterm"/> data using an ArcCatalog path. This path is a string and is unique to each dataset. The path can include folder locations, database connections, or a URL. So, it is important to check the path using ArcCatalog before attempting to write Python scripts against the data. ArcSDE paths require special consideration. Many ArcSDE users do not have standardized connection names, which can cause issues when running models or scripts.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec122"/>There's more...</h2></div></div></div><p>Geoprocessing tools<a id="id327" class="indexterm"/> are organized in two ways. You can access tools as functions on <code class="literal">arcpy</code> or as modules matching the toolbox alias name. In the first case, when tools are accessible as functions from <code class="literal">arcpy</code>, they are called in the format that you followed in this recipe. The tool name is followed by an underscore and then the toolbox alias. In the second form, tools are called as functions of a module, which takes the name of the toolbox alias. Here, <code class="literal">analysis</code> is the toolbox alias, so it becomes a module. <code class="literal">Clip</code> is a function of this module and is called as follows:</p><div class="informalexample"><pre class="programlisting">arcpy.analysis.Clip(in_features,clip_features,out_feature_class)</pre></div><p>Which method you use is really a matter of preference. They both accomplish the same thing, which is the execution of a geoprocessing tool.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Using the output of a tool as an input to another tool"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Using the output of a tool as an input to another tool</h1></div></div></div><p>There will be many occasions when you will need to use the output of one tool as input to another tool. This is called <a id="id328" class="indexterm"/>tool chaining. An example of tool chaining could involve buffering a <code class="literal">stream</code> layer and then finding all residential properties that fall within the buffer. In this case, the <code class="literal">Buffer</code> tool would output a new layer, which would then be used as an input to the <code class="literal">Select by Location</code> tool or one of the other overlay tools. In this recipe, you will learn how to obtain the output of a tool and use it as input to another tool.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec123"/>Getting ready</h2></div></div></div><p>The <code class="literal">Buffer</code> tool<a id="id329" class="indexterm"/> creates an output feature class from an input feature layer using a specified distance. This output feature class can be stored in a variable, which can then be used as an input to another tool, such as the <span class="strong"><strong>Select Layer by Location</strong></span> tool. In this recipe, you will learn how to use the output from the <code class="literal">Buffer</code> tool as an input to the <span class="strong"><strong>Select Layer by Location</strong></span> tool to find schools that are within a half mile of a stream.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec124"/>How to do it...</h2></div></div></div><p>Follow these steps to learn <a id="id330" class="indexterm"/>how to access the currently active map document<a id="id331" class="indexterm"/> in ArcMap:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open ArcMap with a new map document file (<code class="literal">.mxd</code>).</li><li class="listitem">Click on the <span class="strong"><strong>Add Data</strong></span> button and add the streams and schools shapefiles from <code class="literal">c:\ArcpyBook\data\TravisCounty</code>.</li><li class="listitem">Click on the Python window button.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div class="informalexample"><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "c:/ArcpyBook/data/TravisCounty"</pre></div></li><li class="listitem">Start a <code class="literal">try</code> statement and add variables for the streams, buffered streams layer, distance, and schools:<div class="informalexample"><pre class="programlisting">try:
  # Buffer areas of impact around major roads
  streams = "Streams.shp"
  streamsBuffer = "StreamsBuffer.shp"
  distance = "2640 Feet"
  schools2mile = "Schools.shp"
  schoolsLyrFile = 'Schools2Mile_lyr'</pre></div></li><li class="listitem">Execute the Buffer tool by passing in the input feature class, output feature class, distance, and several optional variables that control the look of the output buffer.<div class="informalexample"><pre class="programlisting">arcpy.Buffer_analysis(streams, streamsBuffer, distance,'FULL','ROUND','ALL')</pre></div></li><li class="listitem">Create <a id="id332" class="indexterm"/>a temporary layer for the<a id="id333" class="indexterm"/> schools by using the <code class="literal">MakeFeatureLayer</code> tool:<div class="informalexample"><pre class="programlisting">arcpy.MakeFeatureLayer_management(schools2mile, schoolsLyrFile)</pre></div></li><li class="listitem">Select all schools within a half mile of a stream by using the <code class="literal">SelectLayerByLocation</code> tool:<div class="informalexample"><pre class="programlisting">arcpy.SelectLayerByLocation_management(schoolsLyrFile, 'intersect', streamsBuffer)</pre></div></li><li class="listitem">Add the <code class="literal">except</code> block to catch any errors:<div class="informalexample"><pre class="programlisting">except Exception as e:
  print(e.message)</pre></div></li><li class="listitem">The entire script should appear as follows:<div class="mediaobject"><img src="images/B04314_05_10.jpg" alt="How to do it..."/></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch5\ToolOutputUsedAsInput.py</code> solution file.</li><li class="listitem">Run the script to view the results shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_05_11.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec125"/>How it works...</h2></div></div></div><p>The<a id="id334" class="indexterm"/> <code class="literal">Buffer</code> tool <a id="id335" class="indexterm"/>creates an output feature class, which <a id="id336" class="indexterm"/>we call <code class="literal">StreamsBuffer.shp</code> and is stored in a variable called <code class="literal">streamsBuffer</code>. The <code class="literal">streamsBuffer</code> variable is then used as an input to the <code class="literal">SelectLayerByLocation</code> tool as the third parameter being passed to the function. The creation of the <code class="literal">Schools2Mile_lyr</code> layer file accomplishes this output as an input parameter as well. Using the output of one tool simply requires that you create a variable to hold the output data and then it can be reused as needed in other tools.</p></div></div></div>
</body></html>