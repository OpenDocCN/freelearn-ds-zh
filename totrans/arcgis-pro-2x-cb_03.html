<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Linking Data together</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Joining two tables</li>
<li>Labeling features using a joined table</li>
<li>Querying data in a joined table</li>
<li>Creating and using a Relate</li>
<li>Joining features spatially</li>
<li>Creating and using a relationship class using existing data</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>You now know that GIS data includes more than just what you may see in a map. Each layer has additional information linked to it which is stored in an Attribute Table. Also, not all data you display in a map is stored in a traditional GIS format. Some may be stored in standalone tables or even spreadsheets. These can also be displayed in a map if they include an address or <em>x</em> and <em>y</em> coordinates.  </p>
<p>However, there is a lot data out there in various databases which may not have <em>x</em> and <em>y</em> coordinates, or an address, or even be part of our GIS, but we need to be able to use that information to perform queries, display information, or conduct analysis in the GIS. This data may come from other systems, such as tax appraisal, permitting, inspections, work order, and asset management systems. If we want to use data stored in these systems we must be able to link it to our GIS data. ArcGIS Pro provides a couple of methods to do this, Join and Relate.</p>
<p>At other times, we may need to transfer or link data together that is in our GIS. ArcGIS Pro supports several tools which allow you to do this, including a Spatial Join and creating relationship classes within a geodatabase.    </p>
<p>In this chapter, you will learn the steps needed to link data in ArcGIS Pro to increase the capabilities of your datasets. You will learn how to create and use joins and relates. You will perform a spatial join to combine attributes between two layers based on a spatial relationship. Lastly, you will learn how to create and configure a relationship class within a geodatabase. You will start with a simple relationship class by creating an annotation feature class which is linked to another layer. Then you will create a relationship class manually, which will link two feature classes together.   </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Joining two tables</h1>
                </header>
            
            <article>
                
<p>Join is one of two basic methods which can be used to link data in ArcGIS Pro. Joins link two datasets together to create a single virtual dataset within a single map in a project. This allows you to use the joined data to query, label, and symbolize using the information from both joined datasets.</p>
<p>In this recipe, you will join the Parcel layer to a table which contains a list of owner names. You will learn the requirements needed to join two tables and how to complete the join. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, you will need to ensure that you have installed the book data and have ArcGIS Pro installed. An ArcGIS Pro Basic license level will be sufficient for this recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>To begin, you will need to start ArcGIS Pro.</li>
<li>In the <span class="packt_screen">ArcGIS Pro</span> start window, click on <span class="packt_screen">Open another project</span>.</li>
<li>Select <span class="packt_screen">Computer</span> from the <span class="packt_screen">Open</span> window and then click <span class="packt_screen">Browse</span> in the area on the right:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-821 image-border" height="417" src="assets/387b3e86-65c1-4db8-a245-abaa85a2fd6c.png" width="584"/></div>
<ol start="4">
<li>Navigate to <kbd>C:\Student\ArcGISProCookbook\Chapter3\Joining Data</kbd> by clicking on <span class="packt_screen">C:\</span> in the area on the left of the <span class="packt_screen">Open Project</span> window. Then double-click on <span class="packt_screen">Student</span>, <span class="packt_screen">ArcGISProCookbook</span>, <span class="packt_screen">Chapter3</span>, and <span class="packt_screen">Joining Data</span> folders.</li>
<li>Select the <span class="packt_screen">Joining Data.aprx</span> project file and click <span class="packt_screen">OK</span>.</li>
</ol>
<p style="padding-left: 60px">The project will open with a single map named City of Thomasville. The map contains two layers, City Limits and Parcels, plus the Topographic basemap. First you will review the information contained in the Attribute Table for the Parcel layer.  </p>
<ol start="6">
<li>In the <span class="packt_screen">Contents</span> pane, right click on the <span class="packt_screen">Parcels</span> layer and select <span class="packt_screen">Attribute Table</span> from the menu that appears. The <span class="packt_screen">Attribute Table</span> for the <span class="packt_screen">Parcels</span> layer should open in a window located at the bottom of the map view.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="320" src="assets/eb92faeb-8057-4c50-ac0f-e29b6d558afc.png" width="588"/></div>
<ol start="7">
<li>Take a moment to look at the fields the <span class="packt_screen">Attribute Table</span> contains, and answer the following question:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What fields does the Parcels Attribute Table contain?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">As you can see, the table contains information about the parcel, such as the <strong>Parcel Identification Number</strong> (<span><strong>PIN</strong>), RealKey, OwnerKey, and more. It does not, however, contain any information about who owns the parcels. However, you do know that information is available in the <strong>Computer Aided Mass Appraisal</strong> (<strong>CAMA</strong>) system located in the Tax Appraisal Office for the County.</span></p>
<p style="padding-left: 60px">They have provided you with a table of all the land owners in the County. You now need to join it to your Parcels layer.</p>
<ol start="8">
<li>In the <span class="packt_screen">Catalog</span> pane, normally located on the right side of the interface, expand the <span class="packt_screen">Databases</span> folder by clicking on the small arrowhead to the left.</li>
<li>Expand the <span class="packt_screen">Thomaston.gbd</span> so that you can see its contents. You should see at least three feature classes (<span class="packt_screen">CityLimits</span>, <span class="packt_screen">Parcels</span>,<span class="packt_screen"> </span>and <span class="packt_screen">Street_CL</span>) and a couple of stand-alone tables (<span class="packt_screen">Owners</span> and <span class="packt_screen">Parcels_Sales</span>).</li>
<li>Right-click on the <span class="packt_screen">Owners</span> table and select <span class="packt_screen">Add to Current Map</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-822 image-border" height="360" src="assets/3740f774-d297-4758-b4dc-91d0a4a39cbc.png" width="377"/></div>
<p style="padding-left: 60px">The newly added table should appear in your <span class="packt_screen">Contents</span> pane at the bottom of the list. Now you will look at the data contained within this newly added table.</p>
<ol start="11">
<li>In the <span class="packt_screen">Contents</span> pane, right click on the <span class="packt_screen">Owner</span> table you just added and select <span class="packt_screen">Open</span>. The <span class="packt_screen">Owners</span> table should open in the same area as the <span class="packt_screen">Parcels Attribute Table</span>.</li>
<li>Review the <span class="packt_screen">Owners</span> table, paying close attention to what fields it contains. Then answer the following question:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What fields does the Owner table contain?</p>
<p><strong>Answer</strong>: </p>
</div>
<p style="padding-left: 60px">As you can see, this table does have information about all the land owners in the County. However, it does not have any information about the parcels they own. In order to join the Owner information to the Parcels, you must identify a <strong>key field</strong>. A key field is a field in each table which contains data common to the two tables you are attempting to link. Now you will identify a key field in each table, which you will use to link them together.</p>
<div class="packt_tip">
<p>Key fields are not required to have the same names in both tables. The names can be different. However, they must be the same data type and contain the same data values. By the same data values, that means they must be exactly the same. This includes capitalization and the number of spaces if the key fields contain text. This why it is often best to use numeric values if possible.</p>
</div>
<ol start="13">
<li>In the table view area, click on the tab at the top of the table which says <span class="packt_screen">Owners</span>. Hold your mouse button down and begin to drag it downward. A series of icons should appear in the middle of the table view. Drag your mouse to the icon which has the filled beige area located on the right side as shown ahead. Then release your mouse:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="319" src="assets/2e7744a1-9462-4f86-9efe-845ffb6fab57.png" width="616"/></strong></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Click on Owners tab and drag to docking icon</div>
<p style="padding-left: 60px">You should now see the two tables side by side, as shown in the following image. This allows you to see data in both tables at the same time. </p>
<div class="CDPAlignCenter CDPAlign"><strong><img height="204" src="assets/2bf17ff9-5db2-4513-b0cc-d8f1d38c3ac6.png" width="605"/></strong></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Two tables docked side by side</div>
<div class="packt_tip">
<p>In ArcGIS Pro, you can actually drag the tables out so that they are viewable individually in their own window. These individual windows can then be positioned anywhere in your display, including on other monitors. They can also be sized individually as well. This can make it easier to view the multiple tables at one time.  </p>
</div>
<ol start="14">
<li>In the <span class="packt_screen">Parcels</span> table, right click on the <span class="packt_screen">Ownerkey</span> field and select <span class="packt_screen">Sort Descending</span>.</li>
<li>In the <span class="packt_screen">Owners</span> table, right click on the <span class="packt_screen">OwnKey</span> field and select <span class="packt_screen">Sort Descending</span>.</li>
<li>Review and compare the values for these fields in each table, then answer the following question:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: These two fields appear to contain the same values?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">Now that you have verified the two fields contain like values, you need to verify the field types are the same.</p>
<ol start="17">
<li>Right-click on the <span class="packt_screen">OwnerKey</span> field in the <span class="packt_screen">Parcels</span> table and select <span class="packt_screen">Fields</span> from the menu that appears:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="274" src="assets/f34e048e-3b9c-42fc-bb18-23cadda19827.png" width="445"/></strong></div>
<ol start="18">
<li>Perform the same operation on the <span class="packt_screen">OwnKey</span> in the <span class="packt_screen">Owners</span> table.</li>
</ol>
<p style="padding-left: 60px">Your table view should now look like this:</p>
<div class="CDPAlignCenter CDPAlign"><strong><img height="194" src="assets/171f0e55-d9c6-495a-81b4-523b7db9c55d.png" width="575"/></strong></div>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref">Table design views side by side</div>
<ol start="19">
<li>Verify that the <span class="packt_screen">Data Type</span> is the same for the <span class="packt_screen">Ownerkey</span> field in the <span class="packt_screen">Parcels</span> table and the <span class="packt_screen">OwnKey</span> in the <span class="packt_screen">Owners</span> table.</li>
</ol>
<p style="padding-left: 60px">As you can see, the fields are both a Double data type. Since the fields contain the same data values and the field types are the same, these fields can be used to link the two tables. Now, it is time to link them.</p>
<ol start="20">
<li>Close the <span class="packt_screen">Tables</span> and the <span class="packt_screen">Fields</span> tab by clicking on the small <span class="packt_screen">X</span>.</li>
</ol>
<div class="packt_tip">
<p>It is not required to close the tables before joining them. You can leave them open if desired. It is just cleaner to close them before you join, to reduce screen clutter.</p>
</div>
<ol start="21">
<li>In the <span class="packt_screen">Contents</span> pane, right click on the <span class="packt_screen">Parcels</span> layer. Go to <span class="packt_screen">Joins</span> <span class="packt_screen">and</span> <span class="packt_screen">Relates</span> and select <span class="packt_screen">Add Join</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="503" src="assets/b6f9181e-aae6-43c7-8f81-6010b1342e21.png" width="472"/> </div>
<p style="padding-left: 60px">The <span class="packt_screen">Geoprocessing</span> pane should open with the <span class="packt_screen">Add Join</span> tool.</p>
<ol start="22">
<li>Verify that the <span class="packt_screen">Layer Name or Table View</span> in the <span class="packt_screen">Add Join</span> tool is set to <span class="packt_screen">Parcels</span>.</li>
<li>For the <span class="packt_screen">Input Join Field</span>, select <span class="packt_screen">OwnerKey</span>.</li>
</ol>
<ol start="24">
<li>For the <span class="packt_screen">Join Table</span>, select <span class="packt_screen">Owners</span> by clicking on the small drop-down arrow in the cell. The <span class="packt_screen">Owners</span> table may automatically be populated into the cell. If so, you do not need to change it.</li>
<li>Set the <span class="packt_screen">Output Join Field</span> to <span class="packt_screen">OwnKey</span> using the drop-down arrow if needed. It may be automatically set.</li>
<li>Verify that the <span class="packt_screen">Add Join</span> tool looks like the following screenshot. If it does, click <span class="packt_screen">Run</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-823 image-border" height="361" src="assets/63eebde1-5cbb-4cac-8a83-fd10a74cb019.png" width="363"/></div>
<ol start="27">
<li>Close the <span class="packt_screen">Geoprocessing</span> pane once the <span class="packt_screen">Add Join</span> tool has completed successfully by clicking on the small <span class="packt_screen">X</span> in the upper-right corner of the pane.</li>
<li>Right-click on the <span class="packt_screen">Parcels</span> layer in the <span class="packt_screen">Contents</span> pane and select <span class="packt_screen">Attribute Table</span>.</li>
<li>Using the scroll bar at the bottom of the <span class="packt_screen">Parcels</span> table, scroll through the table fields.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What do you see now that you have joined the Parcel and Owners table?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">As you can see, the fields that were on the Owners table have now been added to the Parcels Attribute Table. Now that those fields have been added, you can use that information to locate all parcels owned by a specific owner, or label parcels with the owner. Let’s put that to the test.  You will start with labeling the parcels with fields from the joined table in the next recipe.</p>
<ol start="30">
<li>Close the <span class="packt_screen">Parcels</span> table by clicking on the small <span class="packt_screen">X</span> in the tab which shows the table name.</li>
<li>Click on the <span class="packt_screen">Project</span> tab in the ribbon, and click on <span class="packt_screen">Save</span>, located in the panel on the left side.</li>
<li>If you are continuing to the next recipe, keep ArcGIS Pro open. If you are not you may close ArcGIS Pro.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>In this recipe, you joined the <span class="packt_screen">Owners</span> table to the <span class="packt_screen">Parcels</span> table. ArcGIS Pro links these two tables together, based on a key field in each table. The key fields are not required to have the same name, but must have the exact same values and be the same data type. ArcGIS Pro then compares the two tables and where the values are identical, it adds those fields and values to the primary table in the map. Where the values are not identical, it leaves the field values for the joined fields blank or null.</p>
<p>The <span class="packt_screen">Join</span> only exists in the map in which you create it. It will not be applied to other maps within the ArcGIS Pro project. It is also not permanently applied to the feature class or table. <span class="packt_screen">Join</span> works best when you want to link data which comes from other systems or datasets which will not be maintained in your GIS directly, such as the <span class="packt_screen">Owners</span> table, which is maintained in the County’s CAMA system. You just get an updated download of the data on a regular basis and replace the old table with the new one, so that when you open the map which contains the join, you always see the most current available information.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Labeling features using a joined table</h1>
                </header>
            
            <article>
                
<p>Now that you have learned how to join tables, and seen how it links them to provide more information, what can you do with that information? In short, you can do anything with the joined information that you can do with the normal attributes in the layers Attribute Table.  </p>
<p>In this recipe, you will learn how you label features using the data from the joined table. You will label each parcel with its PIN and Owner Name. You will use the new Arcade language to do this. You will learn more about Arcade in <a href="6de6f9c1-9e73-4d0d-98b3-1b27818c49c5.xhtml">Chapter 11</a>, <em>Introducing Arcade</em>.   </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You will need to have completed the previous recipe before you can begin this one.    </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>If you closed ArcGIS Pro after completing the previous recipe, open the <kbd>Joining Data.aprx</kbd> project by following the same instructions as shown in the beginning of the previous recipe.</li>
<li>Click on <span class="packt_screen">Bookmarks</span> on the <span class="packt_screen">Map</span> tab in the ribbon. Select the <span class="packt_screen">Labeling</span> bookmark. This will zoom you in to an area located in the center of the City.</li>
<li>Select the <span class="packt_screen">Parcels</span> layer in the <span class="packt_screen">Contents</span> pane so that the <span class="packt_screen">Feature Layer Contextual</span> menu appears with three new tabs.</li>
<li>Click on the <span class="packt_screen">Labeling</span> tab in the ribbon.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="121" src="assets/6e656114-1fcd-4477-8f18-49cb5b9e4490.png" width="615"/></div>
<ol start="5">
<li>Click on the <span class="packt_screen">Label</span> button located in the <span class="packt_screen">Layer</span> group on the <span class="packt_screen">Labeling</span> tab. It should be the located on the far-left side of the ribbon.</li>
</ol>
<p style="padding-left: 60px">Text will appear in the map showing the PIN for each parcel. The values being displayed are being pulled from the <span class="packt_screen">Attribute Table</span> for the <span class="packt_screen">Parcels</span> layer. If you look in the <span class="packt_screen">Label Class</span> group on the <span class="packt_screen">Labeling</span> tab, you will see a setting for <span class="packt_screen">Field</span>. It is set to <span class="packt_screen">Parcels.PIN</span>. This means that the values being displayed are those found in the <span class="packt_screen">PIN</span> field from the original <span class="packt_screen">Parcels</span> table. You will now build an expression using the Arcade language, which will label each parcel with its <span class="packt_screen">PIN</span> from the <span class="packt_screen">Parcels</span> table and with its owner from the joined <span class="packt_screen">Owners</span> table.</p>
<ol start="6">
<li>Click on the Expression button located to the right of the <span class="packt_screen">Field</span> cell in the <span class="packt_screen">Label Class</span> group. The <span class="packt_screen">Label Class</span> pane should appear on the right of the interface. This is where you will build your labeling expression:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="110" src="assets/703bf266-1bf9-42d3-8cdf-c74ed89bdbce.png" width="336"/></strong></div>
<ol start="7">
<li>Click in form of <kbd>$feature[‘Parcels.Pin’]</kbd>, the expression area in the <span class="packt_screen">Label Class</span> pane. Type <kbd>“PIN: “+</kbd> in the expression area, as shown ahead:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="281" src="assets/841e32ec-0c3d-42d1-9cd0-7ad57dec8c84.png" width="357"/></strong></div>
<ol start="8">
<li>Click on the <span class="packt_screen">Validate</span> button located at the bottom of the expression area. It looks like a green check mark. If it says <span class="packt_screen">Expression is valid</span>, continue. If it does not, double check your expression against the previous graphic to make sure you typed in the correct syntax.</li>
<li>In the expression area, add the following to the end of the expression you have already created: <kbd>+Textformatting.Newline+"Owner: "</kbd>.</li>
<li>In the <span class="packt_screen">Fields</span> window in the <span class="packt_screen">Labeling Class</span> pane, scroll down until you see <span class="packt_screen">Owners.LASTNAME</span>. Double click on <span class="packt_screen">Owners.LASTNAME</span> to add it to the expression.</li>
</ol>
<p style="padding-left: 60px">Your full labeling expression should now say:</p>
<pre>"PIN: "+$feature['Parcels.PIN']+Textformatting.Newline+"Owner: "+$feature['Owners.LASTNAME']</pre>
<ol start="11">
<li>Click on the <span class="packt_screen">Validate</span> button once again to verify your syntax. If it says, <span class="packt_screen">Your expression is valid</span>, click <span class="packt_screen">Apply</span>. If it does not, verify your expression. If you continue to have issues, read the following tip:</li>
</ol>
<div class="packt_tip">
<p>If you are having issues creating the expression, you can load one that has already been created. Just click on the Import button located next to the validate button and navigate to <kbd>C:\Student\ArcGISProCookbook\Chapter3\Joining Data. Select the PIN_Owner_Label_Expression.lxp</kbd>. Then click <span class="packt_screen">OK</span> to import the expression.</p>
</div>
<ol start="12">
<li>Save your project.</li>
</ol>
<p style="padding-left: 60px">You have just labeled each parcel using the <span class="packt_screen">PIN</span> field found in the original <span class="packt_screen">Parcels Attribute Table</span> and the <span class="packt_screen">LastName</span> field from the <span class="packt_screen">Owners</span> table. You also added descriptive text to the label to make it easier to know what the labels were. Now you will clean up your labels so they are easier to read.</p>
<div>
<p style="padding-left: 60px">ArcGIS Pro supports several languages for writing labeling expressions. In addition to Arcade, you can write expressions using Python, VBScript, and Jscript. Labeling expressions written for ArcMap and saved to expression files (<kbd>.exp</kbd>) are not compatible with ArcGIS Pro.</p>
</div>
<ol start="13">
<li>Click on the <span class="packt_screen">Position</span> tab in the <span class="packt_screen">Label Class</span> pane, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-824 image-border" height="149" src="assets/6c74fb81-07a0-401a-b85a-010b520f83a9.png" width="296"/></div>
<ol start="14">
<li>Click on the <span class="packt_screen">Position</span> button in the <span class="packt_screen">Position</span> tab in the <span class="packt_screen">Label Class</span> pane.</li>
<li>If required, expand the <span class="packt_screen">Placement</span> option and select <span class="packt_screen">Land Parcel placement</span> from the drop-down menu.</li>
<li>Locate where it says <span class="packt_screen">Horizontal</span> <span class="packt_screen">in polygon</span> and click on the drop-down arrow. Select <span class="packt_screen">Straight in polygon</span>.</li>
<li>Click on the Fitting Strategy button located at the top of the <span class="packt_screen">Labeling Class</span> pane. It looks like a Knight chess piece.</li>
<li>Expand <span class="packt_screen">Reduce size</span> by clicking on the small arrowhead.</li>
<li>Click on the box next to <span class="packt_screen">Reduce font size</span> to enable this function.</li>
<li>Set the following parameters:
<ul>
<li>Font size reduction:
<ul>
<li><span class="packt_screen">Lower limit</span>: <span class="packt_screen">4.0</span></li>
<li><span class="packt_screen">Step interval</span>: <span class="packt_screen">1.0</span></li>
</ul>
</li>
<li>Font width compression:
<ul>
<li><span class="packt_screen">Lower limit</span>: <span class="packt_screen">60</span></li>
<li><span class="packt_screen">Step interval</span>: <span class="packt_screen">5.0</span></li>
</ul>
</li>
</ul>
</li>
</ol>
<p style="padding-left: 60px">The <span class="packt_screen">Label Class</span> pane should now look like the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-825 image-border" height="442" src="assets/3324d95e-3cb8-46d8-966d-26631e334ba7.png" width="387"/></div>
<ol start="21">
<li>Click on the <span class="packt_screen">Labeling</span> tab in the ribbon.</li>
</ol>
<ol start="22">
<li>In the <span class="packt_screen">Visibility Range</span> group, click on the drop-down arrow for <span class="packt_screen">Out Beyond</span> and select <span class="packt_screen">&lt;</span><span class="packt_screen">Current&gt;</span>. This will mean that the labels you just configured will only appear when you zoom in to the current scale of your map. If you zoom out to show a larger area, the labels will not be displayed.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img src="assets/88526b58-be13-4b03-b9b4-b2717817bdc0.png"/></strong></div>
<ol start="23">
<li>Save your project.</li>
</ol>
<p>In this recipe, you labeled the parcels in the map with values from the <span class="packt_screen">PIN</span> field in the <span class="packt_screen">Parcels Attribute Table</span> and the <span class="packt_screen">LASTNAME</span> field in the <span class="packt_screen">Owners</span> table which you had joined to the parcels in the last recipe. You did this using Esri’s new Arcade expression language.</p>
<p>In the first part of your expression, you added descriptive text which allowed users to know what the labeled values were. You did this in Arcade by using double quotes. This tells ArcGIS Pro to simply display the text values found inside the double quotes. For example, your expression contained <kbd>“PIN: “</kbd>. This produced a label which showed up in the map a <kbd>PIN:</kbd> .</p>
<p>This was then followed up with a reference to a database field. In Arcade, you did this using the <kbd>+</kbd> to indicate another part of the expression, followed by <kbd>$feature[‘Parcels.PIN]</kbd>. This displays the value found in the <span class="packt_screen">PIN</span> field within the <span class="packt_screen">Parcels Attribute Table</span>. The <kbd>+</kbd> sign must be used between each part of the expression. You then displayed the owner name on another line in the label using <kbd>Textformatting.Newline</kbd> in your expression.  Once you set the owner name to be displayed on a separate line, you add more descriptive text by including <kbd>“Owner: “</kbd> in your expression. Lastly, you displayed the owners name by calling to the <span class="packt_screen">LASTNAME</span> field in the joined <span class="packt_screen">Owners</span> table by including <kbd>$feature[‘Owners.LASTNAME’]</kbd> at the end of your expression. This produced a label for each parcel that looked like this in the map:</p>
<ul>
<li><span class="packt_screen">PIN</span>: <kbd>T22 028</kbd></li>
<li><span class="packt_screen">Owner</span>: <kbd>Unknown</kbd></li>
</ul>
<p>You then adjusted several configuration settings for the labels in the <span class="packt_screen">Label Class</span> pane to make the labels fit in the parcels better and to be easier to read. You did this by setting the placement option to Land parcel placement. This automatically applies some settings that are preconfigured in ArcGIS Pro for placing text within a parcel. This cleaned up several of the overlapping labels, but left many parcels without a label.</p>
<p>So, next you set the positioning to be <span class="packt_screen">Straight in a polygon</span> as opposed to the default <span class="packt_screen">Horizontal in a polygon</span>. This allows ArcGIS Pro to fit labels diagonally within the polygon if needed, first adjusting the size of the font. This allowed ArcGIS Pro to label a few more parcels, but still not all of them.</p>
<p>Next, you moved over to the Fitting Strategy to adjust the font size for your labels. You enabled <span class="packt_screen">Reduce font size</span>. This allowed ArcGIS Pro to automatically resize the font within the parameters you designated to help fit the label within the parcels. By making this adjustment you were able to get all the parcels in the view labeled.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Querying data in a joined table</h1>
                </header>
            
            <article>
                
<p>Labeling is not the only thing you can do with a joined table. You can also use the joined information to perform queries and analysis. In this recipe, you will perform a query to locate all the parcels owned by the City of Thomaston. You will then export that information to a spreadsheet using a geoprocessing tool.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You must have completed the recipe titled <em>Joining two tables</em> from this chapter before you can perform this recipe. You will also need to have Microsoft Excel or a similar application installed which will open a spreadsheet.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>If you closed ArcGIS Pro after completing the previous recipe, open the <kbd>Joining Data.aprx</kbd> project by following the same instructions as shown in the beginning of the previous recipe. Otherwise continue with this recipe.</li>
<li>Click on the <span class="packt_screen">Map</span> tab in the ribbon.</li>
<li>Click on the Full Extent button in the <span class="packt_screen">Navigate</span> group on the <span class="packt_screen">Map</span> tab. It looks like a small globe.</li>
<li>Click on the <span class="packt_screen">Select by Attributes</span> tool in the <span class="packt_screen">Selection</span> group on the <span class="packt_screen">Map</span> tab in the ribbon. This will open the <span class="packt_screen">Select Layer by Attribute</span> tool in the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>Set the <span class="packt_screen">Layer Name or Table View</span> to <span class="packt_screen">Parcels</span> using the drop-down arrow.</li>
<li>Ensure the <span class="packt_screen">Selection</span> <span class="packt_screen">type</span> is set to <span class="packt_screen">New selection</span>.</li>
<li>Under <span class="packt_screen">Expression</span>, click on the <span class="packt_screen">Add Clause</span> button.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-826 image-border" height="340" src="assets/2a5f234f-3a7c-4624-a409-f49480993b76.png" width="339"/></div>
<ol start="8">
<li>Set the <span class="packt_screen">Field</span> to <span class="packt_screen">LASTNAME</span> using the drop-down arrow.</li>
<li>Ensure the operator is set to <span class="packt_screen">is Equal to</span>.</li>
<li>In the last cell, either type City of Thomaston, or pick it from the list of values shown with the drop-down arrow.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="117" src="assets/a9389df5-ddf7-4aa2-b418-2687d6a5a844.png" width="446"/></strong></div>
<ol start="11">
<li>Verify that your clause looks like the preceding screenshot and click <span class="packt_screen">Add</span>.</li>
<li>Click the Verify button located below the Expression to make sure your syntax is correct. The Verify button looks like a green check mark.</li>
<li>If your SQL expression is valid, click <span class="packt_screen">Run</span>.</li>
<li>Click on the List by Selection button located at the top of the <span class="packt_screen">Contents</span> pane. The button is three polygons, one blue and two white. Look at the number to the right of <span class="packt_screen">Parcels</span>. Verify that you have selected <span class="packt_screen">84 parcels</span>.</li>
</ol>
<p style="padding-left: 60px">You have just selected all the parcels owned by the City of Thomaston using a <span class="packt_screen">Select by Attributes</span> query. You were able to do that using data from the joined <span class="packt_screen">Owners</span> table.</p>
<div class="packt_tip">
<p>If you are already familiar with writing SQL where clauses, you can click on the small <span class="packt_screen">SQL</span> button located under <span class="packt_screen">Expression</span> and manually type the query you just built. The proper syntax would be <kbd>Owners.LASTNAME = 'City of Thomaston'</kbd>.</p>
</div>
<ol start="15">
<li>Click on the small arrow in a circle located at the top of the <span class="packt_screen">Geoprocessing</span> pane.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-827 image-border" height="291" src="assets/a4481b26-8d5a-4767-b87a-f4be979f1018.png" width="433"/></div>
<ol start="16">
<li>Click on the <span class="packt_screen">Toolboxes</span> tab located near the top of the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>Expand the <span class="packt_screen">Conversion Tools</span> toolbox by clicking on the small arrowhead.</li>
<li>Expand the <span class="packt_screen">Excel</span> toolset using the same method.</li>
<li>Double-click on the <span class="packt_screen">Table to Excel python script</span>.</li>
</ol>
<div class="packt_infobox">
<p>In the toolboxes, different icons indicate different types of tools. Hammers indicate system tools. Scrolls indicate python scripts. Series of connected squares indicate models created with ModelBuilder.</p>
</div>
<ol start="20">
<li>Set the <span class="packt_screen">Input Table</span> to <span class="packt_screen">Parcels</span> using the drop-down arrow.</li>
<li>For the <span class="packt_screen">Output Excel File</span>, click on the <span class="packt_screen">Browse</span> button located at the end of the cell.</li>
<li>In the <span class="packt_screen">Save As</span> window that appears, navigate to the <span class="packt_screen">MyProjects</span> folder located in <kbd>C:\Student\ArcGISProCookbook\</kbd>.</li>
<li>Type <kbd>Parcels owned by Thomaston</kbd> into the <span class="packt_screen">File Name</span> cell.</li>
<li>Verify that your <span class="packt_screen">Save As</span> window looks similar to the following screenshot and click <span class="packt_screen">Save</span>. The folders you see in the <span class="packt_screen">MyProject</span> folder will be different.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="325" src="assets/29f1fe79-7f1e-4d43-8eda-97c82e7cded7.png" width="577"/></div>
<ol start="25">
<li>Your <span class="packt_screen">Table to Excel</span> tool should look like the following. If it does, click <span class="packt_screen">Run</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-828 image-border" height="306" src="assets/2023bb4e-cbed-4924-994f-8cb7745b86d5.png" width="536"/></div>
<div class="packt_infobox">
<p>When you run a geoprocessing tool with features selected, the tool only works on the selected features. So, in this case, you only exported the parcels which are owned by the City of Thomaston to a spreadsheet.</p>
</div>
<ol start="26">
<li>Open <span class="packt_screen">File Explorer</span>. It is normally located on your taskbar near the Start button, and looks like a file folder in a holder.</li>
<li>In the tree on the left, select <span class="packt_screen">This PC</span> or <span class="packt_screen">My Computer</span> depending on what operating system you are running.</li>
<li>Double-click on your <span class="packt_screen">C:\</span> drive.</li>
<li>Navigate to <kbd>C:\Student\ArcGISProCookbook\MyProjects</kbd>. You should see the spreadsheet you just created from ArcGIS Pro.</li>
<li>Double-click on the <span class="packt_screen">Parcels_owned_by_Thomaston.xls</span> file to open it. Take a moment to explore the spreadsheet to see what you have created.</li>
<li>When you are done reviewing the spreadsheet, close it and return to ArcGIS Pro.</li>
<li>Click back on the <span class="packt_screen">Map</span> tab in ArcGIS Pro.</li>
<li>Click on the <span class="packt_screen">Clear</span> button in the <span class="packt_screen">Selection</span> group on the <span class="packt_screen">Map</span> tab in the ribbon. This deselects all selected features.</li>
</ol>
<ol start="34">
<li>Close the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>Save your project and close ArcGIS Pro.</li>
</ol>
<p>In this recipe, you queried all the parcels owned by the City of Thomaston and then exported the selected list to a spreadsheet. To query the parcels owned by the City, you created an SQL where clause using the query builder. This allows you to create SQL expressions without having to know SQL.</p>
<p><strong>SQL</strong> stands for <strong>Structured Query Language</strong>. SQL is the standard language used by databases to communicate. It allows you to perform many functions within a relational database. Where clauses allow you to select records (or features within a GIS) which meet specific criteria. In the recipe you just completed, the criteria was where the Parcels owner equaled the City of Thomaston, thus why it is called a where clause. Like all languages, SQL has a specific syntax which must be followed to work. The ArcGIS Pro query builder you used knows the syntax and automatically creates the proper expression based on the parameters you provide. You used the <span class="packt_screen">Create Feature Class</span> geoprocessing tool to generate the new shapefile. After you created the new shapefile, you added attribute fields to the table, which will store additional information about the street signs.</p>
<p>After you selected the parcels owned by the City of Thomaston, you exported them to a spreadsheet using the <span class="packt_screen">Table to Excel</span> python script tool found in the <span class="packt_screen">Conversion</span> toolbox and <span class="packt_screen">Excel</span> toolset. Python is a scripting language which has been heavily integrated in to the ArcGIS platform. Python scripts can be created to assist with automating and streamlining workflows. To learn more about using Python with ArcGIS, we recommend <em>Programming ArcGIS with Python Cookbook, 2nd Edition</em> by Eric Pimpler from Packt Publishing.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and using a Relate</h1>
                </header>
            
            <article>
                
<p>A Join is just one of the basic methods you can use in ArcGIS Pro to link data together. Another method is a Relate. A Relate links two tables together, but unlike a Join, which adds information to the primary table, the two tables remain separate when related. This allows you to see all the related records in the linked table.</p>
<p>A Relate works best when you have one record in your primary table which matches to multiple records in the linked table, or when you have multiple records in the primary that match multiple records in the linked table. In these situations, a Join would not work as well because it would have multiple records which match.   </p>
<p>In this recipe, you will create a Relate between the Parcels and a land sales table. The land sales table contains all parcels sales which have occurred over the last several years. This table also comes from the County’s CAMA system, like the Owners table did. Once you relate the two tables, you will see how you can view all the sales for a selected parcel.   </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You will need to ensure that ArcGIS Pro and the book data is installed. This recipe is not based on previous recipes, so, you are not required to have completed any previous recipes before starting this one.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Start ArcGIS Pro and open the <kbd>Creating and using a Relate.aprx</kbd> project, located in <kbd>C:\Student\ArcGISProCookbook\Chapter3\Creating and using a Relate</kbd>.</li>
<li>In the <span class="packt_screen">Catalog</span> pane located on the right of the ArcGIS Pro interface, expand <span class="packt_screen">Databases</span> by clicking on the small arrowhead.</li>
<li>Expand the <span class="packt_screen">Thomaston.gdb</span> geodatabase so you can see its contents.</li>
<li>Right-click on the <span class="packt_screen">Parcels_Sales</span> <span class="packt_screen">table</span> and select <span class="packt_screen">Add to Current Map</span>. The table should then appear at the bottom of the list in the <span class="packt_screen">Contents</span> pane.</li>
<li>Right-click on the <span class="packt_screen">Parcels</span> layer and select <span class="packt_screen">Attribute Table</span>.</li>
<li>Right-click on the <span class="packt_screen">Parcels_Sales</span> table and select <span class="packt_screen">Open</span>.</li>
<li>Using the skills you learned in the previous recipe, try to determine the key field in each table which you will use to link the two tables together. Remember the key fields must contain the same data values and be the same field data type. The field names do not need to be the same.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What is the key field in each table?</p>
<p><strong>Answer</strong>: </p>
</div>
<p style="padding-left: 60px">After reviewing each table, the key field should be fairly easy to pick out. The Realkey is the only field in each table which has the same data values and the same data type. </p>
<ol start="8">
<li>In the <span class="packt_screen">Parcels Attribute Table</span>, right-click on the <span class="packt_screen">Realkey</span> field and select <span class="packt_screen">Sort Descending</span>.</li>
<li>In the <span class="packt_screen">Parcels Attribute Table</span>, locate the records with a Realkey value of <span class="packt_screen">15812</span>.</li>
</ol>
<p style="padding-left: 60px">You could also use the <span class="packt_screen">Select by Attribute</span> tool to create a query which would select all parcels with a Realkey value of <span class="packt_screen">15812</span>.</p>
<div class="packt_infobox">
<p><strong>Question</strong>: How many rows in the table contain a Realkey value of 15812?</p>
<p><strong>Answer</strong>:</p>
</div>
<ol start="10">
<li>In the <span class="packt_screen">Parcels_Sales</span> table, right-click on the <span class="packt_screen">REALKEY</span> field and select <span class="packt_screen">Sort Descending</span>.</li>
<li>In the <span class="packt_screen">Parcels_Sales</span> table, locate the rows with a REALKEY value of <span class="packt_screen">15812</span>. You will need to scroll down until you see that value, or you could use the <span class="packt_screen">Select by Attribute</span> tool to select the records.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: How many records in the Parcels_Sales table have a REALKEY value of 15812?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">You should now know that there is one parcel and two sales records which have a realkey value of 15812. This means that you have a one to many cardinality, which works well with a Relate. Now you need to configure the Relate to link the Parcels to the Parcels_Sales table.  </p>
<div class="packt_infobox">
<p><strong>Cardinality</strong> refers to how many records in one table match to records in another table, based on a comparison of values found in a key field. There are four types of cardinality, one to one, one to many, many to one, and many to many. This relationship between records in the two tables can impact how you are able to work with them. Traditionally, with older Esri software such as ArcMap, if you had a one to one or a many to many, you would always want to use a Join. If you had a one to many or a many to many, you would always want to use a Relate. This is not the case with ArcGIS Pro. ArcGIS Pro offers more flexibility so you can choose either a Join or a Relate depending on how you need to use the data.  </p>
</div>
<ol start="12">
<li>Right-click on the <span class="packt_screen">Parcels</span> layer in the <span class="packt_screen">Contents</span> pane. Go to <span class="packt_screen">Joins and Relates</span> and select <span class="packt_screen">Add Relate</span>. The <span class="packt_screen">Add Relate</span> tool should open the <span class="packt_screen">Geoprocessing</span> pane on the right-hand side of the ArcGIS Pro interface.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="367" src="assets/35216cda-4ef2-4f75-b216-f8c5d5f09c1f.png" width="392"/></strong></div>
<ol start="13">
<li>Ensure the <span class="packt_screen">Layer Name or Table View</span> is set to <span class="packt_screen">Parcels</span>. Since you right-clicked on the <span class="packt_screen">Parcels</span> layer to add the Relate, this should be automatically populated.</li>
<li>Set the <span class="packt_screen">Input Relate Field</span> to <span class="packt_screen">Realkey</span> using the drop-down arrow.</li>
<li>The <span class="packt_screen">Relate Table</span> and <span class="packt_screen">Output Relate Field</span> should automatically populate because you have no other standalone tables in your map. </li>
<li>Change the <span class="packt_screen">Relate Name</span> to <kbd>Parcel Sales</kbd></li>
<li>Verify that your <span class="packt_screen">Add Relate</span> tool looks like the following image. If it does click <span class="packt_screen">Run</span>.</li>
</ol>
<p> </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-829 image-border" height="340" src="assets/e8763e61-05fc-4f3f-857e-cf831673e55b.png" width="322"/></div>
<ol start="18">
<li>Once the <span class="packt_screen">Add Relate</span> tool has completed successfully, close the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>Save your project.</li>
<li>Select the <span class="packt_screen">Map</span> tab in the ribbon.</li>
</ol>
<ol start="21">
<li>Activate the <span class="packt_screen">Explore</span> tool by clicking on it. Move your mouse point to the approximate center of the City and zoom in by pushing your scroll wheel away from you until your map looks similar in scale to the following.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="285" src="assets/d9b44b7f-9e45-4823-881f-85fa0881d48e.png" width="541"/></strong></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Center on town square and zoom to 1:2,900 +/-</div>
<ol start="22">
<li>Click on the <span class="packt_screen">Parcels Attribute Table</span> in the table view.</li>
<li>Click on the <span class="packt_screen">List by Selection</span> button near the top of the <span class="packt_screen">Contents</span> pane.</li>
<li>If it is checked, click on the small box located next to the <span class="packt_screen">CityLimits</span> layer to make it not selectable.</li>
<li>Select the <span class="packt_screen">Parcels</span> layer in the <span class="packt_screen">Contents</span> pane.</li>
<li>On the <span class="packt_screen">Map</span> tab in the ribbon, select the <span class="packt_screen">Select</span> tool.</li>
</ol>
<ol start="27">
<li>Click on the parcel indicated in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="221" src="assets/392561b5-7493-4923-aaca-07a5a43275e2.png" width="287"/></strong></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Select parcel due west of town square</div>
<ol start="28">
<li>Click on the <span class="packt_screen">Data</span> tab in the ribbon.</li>
<li>Click on the <span class="packt_screen">Related Data</span> button and select <span class="packt_screen">Parcel_Sales:Parcel_Sales</span> as shown ahead:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><strong><img height="142" src="assets/8bf8cbe9-22b2-4c05-b48f-f5664c14837b.png" width="259"/></strong></div>
<p style="padding-left: 60px">The records which show the two times that the selected parcel has been sold should be displayed in the <span class="packt_screen">Parcels_Sales</span> table. So, as you can see, the two tables are linked but still remain separate.</p>
<ol start="30">
<li>Try selecting a few other Parcels and see if they have been sold multiple times. Some parcels may not have been sold even once. You may need to click the <span class="packt_screen">Related Data</span> button with each selection to see the related records.</li>
<li>Save your project.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There is more….</h1>
                </header>
            
            <article>
                
<p>As was mentioned earlier in this recipe, the cardinality was a major consideration when choosing whether you should use a Join or a Relate to link tables when using older Esri applications such as ArcMap. In ArcMap, you should always use a Join if you have a one to one or a many to one cardinality. However, if you have a one to many or many to many, you should use a relate in ArcMap otherwise you will miss data because the result would be a joined table that contained Null values or just the values from the first record it finds that matches.</p>
<p>ArcGIS Pro does not work that way. You can Join two tables regardless of the cardinality as long as they are in the same database. If you join two tables in ArcGIS Pro that have a one to many or a many to many cardinality, you see all the matched records. ArcGIS Pro does this by creating virtual records in the table view for each match, as shown ahead:</p>
<div class="CDPAlignCenter CDPAlign"><img height="404" src="assets/97e5d7bf-fff1-4de8-851e-281aa94a4848.png" width="482"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Single parcel selected but two records displayed in Attribute Table</div>
<p>As you can see, you have a single parcel selected but two records are shown in the table view for the layer. This is because the Parcels_Sales table was joined to the Parcels Attribute Table. As you saw in the recipe, there is a one to many cardinality between these tables. So, there are two sales associated with the selected parcel in the Parcel_Sales table, and both are displayed.</p>
<p>In ArcGIS Pro, this method of joining tables with one to many and many to many has other advantages. You are able to label features with values from each record in the joined table. This is something ArcMap users are unable to do. However, remember this only works with tables in the same database. If the tables are in two different databases or are different formats such as linking a spreadsheet to a geodatabase feature class, then the normal rules about when to use a join and when to use a relate still apply.</p>
<p>If you wish, use the skills you have learned in this and the previous recipe to join the Parcel_Sales table to the Parcels layer. Then explore how this join works by selecting several parcels while looking at the Attribute Table.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Joining features spatially</h1>
                </header>
            
            <article>
                
<p>So in the previous recipes, you have seen how you can link external data to layers or other tables using a Join or a Relate. However, what if you want to transfer data from one layer to another but there is no key field to use to link the data. Maybe the two layers in question overlap one another, or are next to one another, or share some other spatial relationship, surely there should be some way to link or join the two layers together based on a spatial relationship.</p>
<p>You can join two layers together based on a spatial relationship. This is called a <strong>Spatial Join</strong>. A Spatial Join creates a new feature class which adds the attributes from the joined feature class to the target feature class based on a spatial relationship you define when you run the tool. It is not required that the target and joined feature classes be the same type. You can spatially join lines with polygons, or points with lines, or points with polygons, as well as those of the same feature type.</p>
<p> When you run the Spatial Join tool you can specify the Join Operation. This determines how joins between the target features and join features will be handled in the output feature class if multiple join features are found that have the same spatial relationship with a single target feature. The options for this include:</p>
<ul>
<li><span class="packt_screen">JOIN_ONE_TO_ONE</span>: When this option is chosen, if a single feature in the target layer matches to multiple features in the join layer because they have the same spatial relationship, the attributes from all the matched join features will be aggregated based on the field map merger rule you configure. For example, if you set the target layer to be the road centerlines and a road centerline crosses two wetland polygons which are in your join layer, the attributes from the two wetland polygons will be aggregated before being transferred to the output line feature class. If one wetland polygon has an area value of 2 acres and the other has an area value of 5 acres, and a Mean merge rule is specified, the aggregated value in the output feature class will be 3.5.</li>
<li><span class="packt_screen">JOIN_ONE_TO_MANY</span>: When this option is chosen, if a single feature in the target layer is found to match with multiple features in the join layer because they have same spatial relationship, the resulting output feature class will contain multiple records representing the single target feature and each match it has with features in the join layer. Using the same example as previous, if a single road centerline crosses two wetland polygons, the output feature class will contain two road centerlines: one will have the attributes from one of the wetland polygons it crossed and the second will have the attributes from the other.</li>
</ul>
<p>In this recipe, you have been asked to assign each sewer line and sewer manhole the name of the watershed it is located within. This is for an annual report the sewer superintendent must submit to the state every year. You have the boundary of the existing watersheds in your area and you have layers for the sewer lines and sewer manholes, so you will use the Spatial Join geoprocessing tool to assign the name of each watershed to the sewer features that are inside it.   </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe can be completed with any license level of ArcGIS Pro. Completion of any other recipes is not required, though it is recommend that you complete the recipes in <a href="45fda239-2b00-4355-9553-6c6c2b69b0ab.xhtml">Chapter 1</a>, <em>ArcGIS Pro Capabilities and Terminology</em>. This will ensure that you have the basic skills required to successfully complete this recipe. Of course, you must install the sample data before you begin. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Start ArcGIS Pro and open the <kbd>Spatial Join.aprx</kbd> project located in <kbd>C:\Student\ArcGISProCookbook\Chapter3\Spatial Join\</kbd>.</li>
<li>Right-click on the <span class="packt_screen">Sewer Manholes</span> layer in the <span class="packt_screen">Contents</span> pane and click <span class="packt_screen">Attribute Table</span>.</li>
<li>Explore the <span class="packt_screen">Attribute Table</span> for the <span class="packt_screen">Sewer Manholes</span> layer and answer the following question:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What fields do you see in the Attribute Table for the Sewer Manholes?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">You will notice that it does not indicate which watershed each manhole is located in. So, you need to add this attribute to each manhole. Luckily you do have a watershed layer which shows the boundary of each watershed and its name. You will be able to use the Spatial Join to add this information to the manholes. First you will explore the Attribute Table for the Watersheds layer. Then you will use the Spatial Join tool.</p>
<ol start="4">
<li>Right-click on the <span class="packt_screen">Watersheds</span> layer and select <span class="packt_screen">Attribute Table</span>.</li>
</ol>
<ol start="5">
<li>Explore the fields contained in the <span class="packt_screen">Attribute Table</span> for the <span class="packt_screen">Watersheds</span> layer.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What fields do you see in the Attribute Table for the Watersheds layer?</p>
<p><strong>Answer</strong>: </p>
</div>
<ol start="6">
<li>Click on the <span class="packt_screen">Analysis</span> tab in the ribbon.</li>
</ol>
<ol start="7">
<li>Select the <span class="packt_screen">Spatial Join</span> tool from the <span class="packt_screen">Tools</span> group on the <span class="packt_screen">Analysis</span> tab in the ribbon. This will open the <span class="packt_screen">Geoprocessing</span> pane with the <span class="packt_screen">Spatial Join</span> tool.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="88" src="assets/57d33fa0-9647-46c5-903c-a4b6e48ee511.png" width="727"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Select Spatial Join tool</div>
<ol start="8">
<li>Set the <span class="packt_screen">Target Features</span> to <span class="packt_screen">Sewer Manholes</span> using the drop-down arrow.</li>
<li>Set the <span class="packt_screen">Join Features</span> to <span class="packt_screen">Watersheds</span> using the drop-down arrow.</li>
<li>For the <span class="packt_screen">Output Feature Class</span>, click the <span class="packt_screen">Browse</span> button. Then select the <span class="packt_screen">Databases</span> folder located under <span class="packt_screen">Project</span> in the tree on the left side of the <span class="packt_screen">Output Feature Class</span> dialog window.</li>
<li>Double-click on the <span class="packt_screen">Spatial Join.gdb</span>.</li>
<li>In the <span class="packt_screen">Name</span> cell, type <kbd>Sewer_Manholes_Watersheds</kbd> and click <span class="packt_screen">Save</span>.</li>
<li>Set the <span class="packt_screen">Join Operation</span> to <span class="packt_screen">Join one to one</span> using the drop-down arrow.</li>
<li>Set the <span class="packt_screen">Match Option</span> to <span class="packt_screen">Within</span>. This is the spatial relationship which will join the watershed name to each manhole that is inside the watershed.</li>
</ol>
<ol start="15">
<li>Verify that your <span class="packt_screen">Spatial Join</span> tool looks like the following and click <span class="packt_screen">Run</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-830 image-border" height="609" src="assets/48808d95-139e-48d2-bba1-7c4596f42cb7.png" width="491"/></div>
<ol start="16">
<li>When the <span class="packt_screen">Spatial Join</span> tool is complete, close the <span class="packt_screen">Geoprocessing</span> pane.</li>
</ol>
<ol start="17">
<li>A new layer should have been added to your map, called <span class="packt_screen">Sewer_Manhole_Watersheds</span>. Right-click on this new layer and select <span class="packt_screen">Attribute Table</span>.</li>
</ol>
<div class="packt_infobox"><strong>Question</strong>: What fields does the Attribute Table for this new layer contain?<br/>
<br/>
<strong><br/>
Answer</strong>:<br/>
<br/>
<strong>Question</strong><span>: </span>How does the new table compare to the Attribute Table for the Sewer Manhole and the Watersheds layers?<br/>
<strong><br/>
<br/>
Answer</strong><span>:</span></div>
<p style="padding-left: 60px">As you should hopefully see, the new layer contains the combined attributes of both the sewer manholes and watersheds layers. The output was a new point layer because the target was the sewer manholes, which was a point layer.</p>
<ol start="18">
<li>Close the <span class="packt_screen">Attribute Table</span> and save your project.</li>
<li>Now, using the same process perform a spatial join between the sewer lines and the watersheds. However, this time set the <span class="packt_screen">Match Option</span> to <span class="packt_screen">Intersect</span> and the <span class="packt_screen">Output Feature Class</span> to <kbd>Sewer_Lines_Watersheds</kbd>.</li>
<li>Your <span class="packt_screen">Spatial Join</span> tool should look like this. If it does, click <span class="packt_screen">Run</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-831 image-border" height="555" src="assets/bdaf73ad-f33f-4e69-a680-01a93d241ef2.png" width="448"/></div>
<ol start="21">
<li>The <span class="packt_screen">Crimes_2014</span> table should appear in the <span class="packt_screen">Contents</span> pane. Right-click on the table and click <span class="packt_screen">Open</span>.</li>
</ol>
<ol start="22">
<li>Once the tool is complete, close the <span class="packt_screen">Geoprocessing</span> pane and save your project.</li>
</ol>
<p style="padding-left: 60px">When the tool completes, the new layer you created should be added to the map. If you open the Attribute Table you will see it too contains the combined attributes from both the inputs. This time, the output was a line layer instead of a point because the target layer was the sewer lines layer, which, as the name indicates, is a line layer.</p>
<ol start="23">
<li>Close ArcGIS Pro.</li>
</ol>
<p>You have now seen how a spatial join can be used to merge data in two different layers into a single layer or feature class. This can increase the types of analysis you can perform on the data or how you can display it. Remember, when you perform a spatial join, it does create a new data layer. This means that your original data is still intact for you to use as well. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating feature linked annotation</h1>
                </header>
            
            <article>
                
<p>You have now seen how to link data together based on a common key field using a Join or Relate, based on a spatial relationship. These methods are extremely useful. However, they do have limitations. Joins and Relates only exist in a single map and do not transfer easily to other maps or projects. Spatial Joins create new feature classes or tables while still leaving the original data unaltered. So, is there a way to permanently link two tables or two feature classes together?</p>
<p>The answer is yes, if the data is all in the same geodatabase. In a geodatabase, you can create a relationship class. A relationship class permanently links data together and the link carries over into any map, scene, or project you use the data in. You can create a relationship class between two feature classes, two standalone tables, or a feature class and a standalone table.</p>
<p>Relationship classes provide greater flexibility than the other methods we have looked at in previous recipes. Not only can you link data together so you can access the additional information, the related data can also impact the behavior or contents. For example, if I relate a sewer line feature class to a manhole feature class, the relationship class can be configured to allow information such as an attribute value from one feature class to also pass to another, or if I delete a feature in one feature class it deletes the connected feature in the other feature class. </p>
<p>One of the easiest relationship classes to create is called <strong>Feature Linked Annotation</strong>. In this recipe, you will create feature linked annotation and then explore its behavior.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To complete this recipe, you will need a Standard or Advanced license of ArcGIS Pro. A Basic license does not support this level of functionality. If you are not sure what license you have, you can check it by doing the following. Open ArcGIS Pro, and on the bottom left of the start window, where you would normally select a project to open, click on <span class="packt_screen">About ArcGIS Pro</span>. Then select <span class="packt_screen">Licensing</span> from the list on the left. This will display the license level available to you and any extensions you may have access to as well.</p>
<p>If you only have a Basic license, check with your account administrator to see if they can assign you a Standard or Advanced license at least temporarily. If a higher license is not available, you can request a trial license from Esri by going to their website, at <a href="http://www.esri.com/arcgis/trial">http://www.esri.com/arcgis/trial</a>. This will provide you with access to an Advanced license for ArcGIS Pro and more.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>You will begin by starting ArcGIS Pro. Then open the <kbd>FeatureLinkedAnno.aprx</kbd> located in <kbd>C:\Student\ArcGISProCookbook\Chapter3\FeatureLinkedAnno</kbd>.</li>
<li>The project should open with a single map called <kbd>Trippville</kbd>. Click on the <span class="packt_screen">Bookmarks</span> button located in the <span class="packt_screen">Navigate</span> group on the <span class="packt_screen">Map</span> tab. Select <span class="packt_screen">Labeling Area</span> to zoom to the middle of Trippville.</li>
<li>In the <span class="packt_screen">Contents</span> pane, select the <span class="packt_screen">Street Centerline</span> layer.</li>
<li>From the ribbon, select the <span class="packt_screen">Labeling</span> tab, which appears in the <span class="packt_screen">Feature Layer</span> contextual tab.</li>
<li>In the <span class="packt_screen">Map</span> group on the <span class="packt_screen">Labeling</span> tab, select the <span class="packt_screen">More</span> drop-down.</li>
<li>Click on the <span class="packt_screen">Label</span> button located on the far-left side of the <span class="packt_screen">Labeling</span> tab to turn on the labels for the <span class="packt_screen">Street Centerlines</span> layer. Ensure <span class="packt_screen">Use Maplex Labeling Engine</span> is not checked. If it is, click on it to deactivate. If you get a warning about switching the labeling engine, click <span class="packt_screen">Yes</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="75" src="assets/8055569d-35c1-46a1-a3df-00c9d0879acc.png" width="632"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Select Label button on far left</div>
<ol start="7">
<li>Set the <span class="packt_screen">Field</span> locate in the <span class="packt_screen">Label Class</span> group on the <span class="packt_screen">Labeling</span> tab to <span class="packt_screen">ST_NAME</span> using the drop-down arrow to scroll to the field.</li>
<li>In the <span class="packt_screen">Label Placement</span> group on the <span class="packt_screen">Labeling</span> tab, select <span class="packt_screen">Curved Line</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/65992a45-8d25-4acf-a6b3-8f87f55dd397.png"/></div>
<ol start="9">
<li>Verify that your font is set to <span class="packt_screen">Tahoma</span>, size <span class="packt_screen">10</span>, and color is black in the <span class="packt_screen">Text Symbol</span> group on the <span class="packt_screen">Labeling</span> tab.</li>
</ol>
<p style="padding-left: 60px">You have added labels for the street names to the map. If you configured everything, your map should now look very similar to the following image. Yours may not be an exact match due to the size of your monitor being different or you may have other panes open.</p>
<div class="CDPAlignCenter CDPAlign"><img height="335" src="assets/adf4521f-b84e-4fb3-b688-8754b1212e13.png" width="473"/></div>
<ol start="10">
<li>Click on the <span class="packt_screen">Map</span> tab in the ribbon.</li>
<li>At the far-right end of the <span class="packt_screen">Map</span> tab, click on the <span class="packt_screen">Convert To Annotation</span> button. This will open the <span class="packt_screen">Convert Labels</span> <span class="packt_screen">to Annotation</span> tool in the <span class="packt_screen">Geoprocessing</span> pane.</li>
</ol>
<div class="packt_infobox">
<p>ArcGIS Pro supports two types of text display in a map or scene. The first is labels. Labels are dynamic text which is tied to a specific layer and attributes associated with that layer. The user can configure some settings which the computer will use when trying to determine where to place the label or if one will be placed at all. However, users are not able to individually place a label and guarantee it will always appear or be in a consistent location. The computer makes the final decision. Labels are extremely useful because they do automatically adjust as your map view changes in size or location. Annotation is the other method for displaying text. Annotation is fixed text, which can be individually placed and modified. This provides much greater control over the text, allowing you to put it exactly where and how you want it. Its big disadvantage is that it is more labor intensive to maintain and will not work at all scales. Feature Linked Annotation is the best of both worlds. It provides the control of annotation with some of the dynamic behavior of labels, as you will see in this recipe.</p>
</div>
<ol start="12">
<li>Verify that the <span class="packt_screen">Input Map</span> is set to <span class="packt_screen">Trippville</span>.</li>
<li>Click on the <span class="packt_screen">Browse</span> button located to the right of the <span class="packt_screen">Output Geodatabase</span>. Click on the <span class="packt_screen">Databases</span> folder in the panel on the left side of the <span class="packt_screen">Output Geodatabase</span> window that appears. Double-click on the <span class="packt_screen">Trippville_GIS.gdb</span>. Select the <span class="packt_screen">Base feature</span> dataset and click <span class="packt_screen">OK</span>.</li>
<li>For the <span class="packt_screen">Extent</span>, select the <span class="packt_screen">Street Centerlines</span> layer from the list using the drop-down arrow.</li>
</ol>
<ol start="15">
<li>Enable <span class="packt_screen">Create Feature Linked Annotation</span> by clicking on the box next to it. Two other options will appear, <span class="packt_screen">Create Annotation</span> when new features are added and Update annotation when features shape is modified. Ensure they are both enabled.</li>
<li>Change the <span class="packt_screen">Output Layer</span> to <span class="packt_screen">StreetNames</span>.</li>
<li>Verify <span>that </span>your <span class="packt_screen">Convert Labels to Annotation</span> looks like the following graphic, and click <span class="packt_screen">Run</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-832 image-border" height="500" src="assets/8ff71dff-5a81-4095-91ce-a4cf2cf266e2.png" width="404"/></div>
<ol start="18">
<li>The new <span class="packt_screen">StreetNames</span> layer you just created should appear in the <span class="packt_screen">Contents</span> pane if the tool runs successfully. If the new layer does appear, close the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>Now, let’s look at what you created. In the <span class="packt_screen">Contents</span> pane, expand the <span class="packt_screen">StreetNames</span> layer by clicking on the small arrow located next to the layer name.</li>
<li>Select the <span class="packt_screen">Street_CenterlinesAnno</span> layer. Right-click on it and select <span class="packt_screen">Properties</span> from the bottom of the context menu that appears.</li>
<li>Select the <span class="packt_screen">Source</span> option from the list on the left panel in the <span class="packt_screen">Layer Properties</span> window, then answer the following questions:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong>: What is the data type and feature type for the new layer?</p>
<p><strong>Answer</strong>:</p>
<p><strong>Question</strong><span>: </span><span>What database is the feature class that the layer references named and where is it located?</span></p>
<p><span><strong>Answer</strong><span>:</span></span></p>
<p><strong>Question</strong><span>: </span><span>What is the name of the feature class you created which is referenced by the new layer?</span></p>
<p><span><strong>Answer</strong><span>:</span></span></p>
</div>
<p style="padding-left: 60px">As you can see when you answer the preceding questions, the <span class="packt_screen">Convert to Annotation</span> tool created not only a new layer in your map, but also a new feature class within the geodatabase. It is an annotation feature class which is a specialized version of a standard Polygon feature class; basically it acts like a text box. Like all feature classes, an annotation feature class is another form of vector data. As such, it has both the spatial component as well as an attribute component.</p>
<ol start="22">
<li>Click <span class="packt_screen">OK</span> to close the <span class="packt_screen">Layer Properties</span> window.</li>
<li>Right-click on the <span class="packt_screen">Street_CenterlinesAnno</span> layer in the <span class="packt_screen">Contents</span> pane. Select <span class="packt_screen">Attribute Table</span> from the context menu which appears.</li>
<li>Take a moment to explore the <span class="packt_screen">Attribute Table</span> for the new layer you just created, then answer the following question:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong><span>: </span>What attribute fields are in the table for the Street_CenterlineAnno layer?</p>
<p><strong>Answer</strong><span>:</span></p>
</div>
<ol start="25">
<li>Click on the List by Selection button located near the top of the <span class="packt_screen">Contents</span> pane. It looks like three polygons, one of which has a blue fill.</li>
<li>Set the <span class="packt_screen">Street Centerlines</span> and <span class="packt_screen">Street_CenterlinesAnno</span> layers as selectable and all others as not selectable. Those with a check mark in the box are selectable layers and those without a check mark are not. To change the status from selectable or not selectable simply click on the box next to the layer name.</li>
<li>Click on the <span class="packt_screen">Select</span> tool in the <span class="packt_screen">Map</span> tab in the ribbon. If you click on the drop-down arrow, select <span class="packt_screen">Rectangle</span>.</li>
<li>Click just to the southeast of Pine St, in the map. Continue to hold your mouse button down and move your pointer just to the northwest of Pine St as shown in the following screenshot, so you select both the street centerline and the road name.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="193" src="assets/6ccc0aad-e30d-49cd-ac22-82c98283019e.png" width="290"/></div>
<ol start="29">
<li>Right-click on the <span class="packt_screen">Street Centerline</span> layer in the <span class="packt_screen">Contents</span> pane and select <span class="packt_screen">Attribute Table</span> from the context menu that appears.</li>
<li>At the bottom of the table view, click on the <span class="packt_screen">Show Selected Records</span> button to only display the attributes for the street centerline you have selected.</li>
<li>Look at the attribute values for the selected street. Pay special attention to the value for the ObjectID.</li>
</ol>
<ol start="32">
<li>Ensure the <span class="packt_screen">Street Centerlines</span> layer is still selected in the <span class="packt_screen">Content</span> pane, then click on the <span class="packt_screen">Data</span> tab in the <span class="packt_screen">Feature Layer</span> contextual menu in the ribbon.</li>
<li>Select the <span class="packt_screen">Related Data</span> button in the <span class="packt_screen">Relationship</span> group on the <span class="packt_screen">Data</span> tab in the ribbon. Choose the <span class="packt_screen">Anno_80_85:Street_CenterlinesAnno</span> option that appears. The numbers identifying the relationship may be different. This should open the <span class="packt_screen">Attribute Table</span> for the <span class="packt_screen">Street_CenterlinesAnno</span> layer and select the <span class="packt_screen">related annotation record</span>.</li>
<li>Review the attribute values for the selected record, then answer the following question:</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong><span>: </span>Which fields for the Street_CenterlinesAnno layer contain similar values as those for the street centerline you have selected?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">Your comparison of the values for the selected street centerline and the related annotation should have revealed that the Object ID for the street centerline matched the FeatureID value for the annotation, and the ST_NAME value for the street centerline matched the TextString value for the annotation.</p>
<p style="padding-left: 60px">The two feature classes are linked to one another in the relationship class using the ObjectID of the Street Centerlines and the FeatureID of the Annotation as the key field, similar to how you used a key field to create both a join and a relate in previous recipes. As you will see next, the ST_NAME field and TextString fields are also linked as part of the relationship class.</p>
<ol start="35">
<li>Ensure that you still have the <span class="packt_screen">Pine St centerline</span> selected, and then click on the <span class="packt_screen">Edit</span> tab in the ribbon.</li>
<li>Click on the <span class="packt_screen">Attributes</span> button located in the <span class="packt_screen">Selection</span> group on the <span class="packt_screen">Edit</span> tab.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="124" src="assets/5173fcda-9e0f-4892-b303-f851a7047989.png" width="348"/></div>
<ol start="37">
<li>In the window at the top of the <span class="packt_screen">Attributes</span> pane, select the <span class="packt_screen">Street Centerlines</span> layer. This should display a list of all attributes associated with Pine St in the area below where you selected the layer.</li>
<li>Click in the cell located next to <span class="packt_screen">ST_NAME</span>, which currently contains the value <kbd>PINE ST</kbd> and type <kbd>OAK AVE</kbd>. Hit your <em>Enter</em> key when done.</li>
</ol>
<p style="padding-left: 60px">Notice what happens to the annotation for the street name in the map. It should have also changed because the ST_NAME field is linked to the TextString field for the annotation layer. Changing the ST_NAME value in the Street Centerlines layer automatically updates the value for the annotation layer because of the relationship class you created. For feature linked annotation, this is a one way relationship. This means the change is only pushed from the Street Centerlines layer to the Street_CenterlinesAnno layer, but not from the Street_CenterlinesAnno layer to the Street Centerlines.</p>
<ol start="39">
<li>While on the <span class="packt_screen">Edit</span> tab, click the <span class="packt_screen">Clear</span> button in the <span class="packt_screen">Selection</span> group to clear your selection.</li>
<li>In the <span class="packt_screen">Contents</span> pane, right-click on the <span class="packt_screen">Street Centerlines</span> layer and select <span class="packt_screen">Make this the only selectable layer</span>.</li>
</ol>
<div class="packt_tip">
<p>You may need to make sure you are still looking at the List by Selection option in the Contents pane.</p>
</div>
<ol start="41">
<li>Choose the <span class="packt_screen">Selection</span> tool from the <span class="packt_screen">Selection</span> group in the <span class="packt_screen">Edit</span> tab on the ribbon.</li>
<li>Click on the street centerline for the newly renamed Oak Ave, which was formerly Pine St.</li>
<li>With <span class="packt_screen">Oak Ave</span> selected and <span class="packt_screen">only</span> <span class="packt_screen">Oak Ave</span> selected, press your <em>Delete</em> key or click on the <em>Delete</em> button in the <span class="packt_screen">Features</span> group on the <span class="packt_screen">Edit</span> tab in the ribbon.</li>
</ol>
<p style="padding-left: 60px">Notice that the annotation is also deleted when you delete the street centerline for Oak Ave. The relationship class not only links fields together, but also creates a link between the features in each feature class, so that by deleting the centerline it also deletes all related annotation features. Like the field relationship you explored earlier, this is only a one-way relationship. This means that if you were to delete the annotation it would not delete the related street centerline.</p>
<div class="packt_infobox">
<p>Not all relationship classes are a one-way relationship. Feature linked annotation is just one example of how a relationship class works. They can be configured in several different ways, depending on what you wish to accomplish.</p>
</div>
<ol start="44">
<li>On the <span class="packt_screen">Edit</span> tab in the <span class="packt_screen">Manage Edits</span> group, select <span class="packt_screen">Discard</span> to discard all edits you have made.</li>
<li>In the <span class="packt_screen">Catalog</span> pane, expand the <span class="packt_screen">Databases</span> folder so you see the two geodatabases connected to the project.</li>
<li>Expand the <span class="packt_screen">Trippville_GIS.gdb</span> geodatabase to see its contents.</li>
<li>Now expand the <span class="packt_screen">Base feature dataset</span> and examine its contents. You should see the two feature classes which were referenced by the two layers you have been working with, <span class="packt_screen">Street_Centerlines</span> and <span class="packt_screen">Street_CenterlinesAnno</span>. You should also see the relationship class which you created when you created the feature linked annotation layer, <span class="packt_screen">Anno_80_85</span>. Again, the name of your relationship class may have different numbers.</li>
</ol>
<p>Because the feature classes and relationship classes exist as objects in your geodatabase, they may be used in other maps, scenes, or projects. This provides much greater flexibility than the joins and relates you performed in past recipes.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>As you saw in this recipe, feature linked annotation links text in one layer to the features in another layer. It does this using a relationship class. Like joins and relates, the relationship class relies on a key field from the Attribute Tables for both feature classes to establish a basic link between the text features in the annotation layer and the feature that the text references in the other feature class. In the case of feature linked annotation, the key field was automatically determined and the relationship class configured when you converted the labels for the street centerlines to annotation using the Convert to Annotation tool.</p>
<p>Feature Linked annotation takes advantage of the additional functionality the relationship class allows.  In addition to relating the two features classes together so you can located related features or records, it also allows you to push changes from the feature to the annotation. This is called a <strong>composite relationship</strong>. In a composite relationship, the existence or values of the origin feature controls or changes the existence or values of the destination feature or record. You saw this demonstrated when you changed the street name for the centerline and deleted the centerline, which caused changes to the street annotation layer.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and using a relationship class using existing data</h1>
                </header>
            
            <article>
                
<p>You have seen the power of a relationship class in the previous recipe. You saw how linking two feature classes together allowed you to not only access information about the linked features but also control some behavior. However, this was all automatically set up by the Convert to Annotation tool. In many cases, the data you wish to link together already exists. So how do you create a relationship class which would link that existing data together?</p>
<p>In this recipe, you will create a relationship class between a feature class and a standalone table. This will be between the same parcel layer and sales table you related in the <em>Creating and using a Relate</em> recipe earlier in this chapter.  However, once you establish the relationship class, the link becomes permanent, unlike the relate which is limited to the map in which it was created.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To complete this recipe, you will need a Standard or Advanced license of ArcGIS Pro. A Basic license does not support this level of functionality. If you are not sure what license you have, you can check it by doing the following. Open ArcGIS Pro, and on the bottom left of the start window, where you would normally select a project to open, click on <span class="packt_screen">About ArcGIS Pro</span>. Then select <span class="packt_screen">Licensing</span> from the list on the left. This will display the license level available, to you and any extensions you may have access to as well.</p>
<p>If you only have a Basic license, check with your account administrator to see if they can assign you a Standard or Advanced license at least temporarily. If a higher license is not available you can request a trial license from Esri by going to their website, at <a href="http://www.esri.com/arcgis/trial">http://www.esri.com/arcgis/trial</a>. This will provide you with access to an Advanced license for ArcGIS Pro and more.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>As normal, you will need to start ArcGIS Pro and then open the <kbd>RelationshipClass.aprx</kbd> located in <kbd>C:\Student\ArcGISProCookbook\Chapter3\RelationshipClass\</kbd>. The project should open with a single map called Thomaston. If you completed the previous <em>Creating and using Relates</em> recipe it should look familiar.</li>
</ol>
<ol start="2">
<li>In the <span class="packt_screen">Contents</span> pane, you need to verify that you see the <span class="packt_screen">Parcels</span> layer and the <span class="packt_screen">Parcels_Sales</span> table. If not, use skills you have learned to add them to the map from the <span class="packt_screen">Thomaston.gdb</span> geodatabase which is connected to the project.</li>
<li>In order to create a relationship class between the <span class="packt_screen">Parcels</span> layer and the <span class="packt_screen">Parcels_Sales</span> table, you need to determine two things: a key field in each table and the cardinality. If you completed the <em>Creating and using a Relate</em> recipe, you will be using the same key field and should already know the cardinality, so you can skip to <em>step 12</em> and continue from there. If you did not complete that recipe, continue to the next step.</li>
<li>Right-click on the <span class="packt_screen">Parcels</span> layer and select <span class="packt_screen">Attribute Table</span>.</li>
<li>Right-click on the <span class="packt_screen">Parcels_Sales</span> table and select <span class="packt_screen">Open</span>.</li>
<li>Click on the name of the <span class="packt_screen">Parcels_Sales</span> located at the top of the table view, and drag it until your mouse point is over the docking icon, as shown ahead:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="261" src="assets/8b5f72a6-16d1-4e51-91b7-df224960a91a.png" width="585"/></div>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref">Drag and dock the tables so they can be seen side by side</div>
<p style="padding-left: 60px">The two tables should now appear side by side so you can more easily assess each one:</p>
<div class="CDPAlignCenter CDPAlign"><img height="289" src="assets/befa1460-1203-415f-b89b-ff35089930f7.png" width="661"/></div>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref">Tables viewed side by side</div>
<ol start="7">
<li>Review each table to determine the key field in each table that you will use to link the two tables together. Remember the key fields must contain the same data values and be the same field data type. The field names do not need to be the same.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong><span>: </span>What is the key field in each table?</p>
<p><strong>Answer</strong>:</p>
</div>
<p style="padding-left: 60px">After reviewing each table, the key field should be easy to pick out. The <span class="packt_screen">Realkey</span> is the only field in each table which has the same data values and the same data type.  </p>
<ol start="8">
<li>In the <span class="packt_screen">Parcels Attribute Table</span>, right-click on the <span class="packt_screen">Realkey</span> field and select <span class="packt_screen">Sort Descending</span>.</li>
<li>In the <span class="packt_screen">Parcels Attribute Table</span>, locate the records with a Realkey value of <span class="packt_screen">15812</span>.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong><span>: </span>How many rows in the table contain a Realkey value of 15812?</p>
<p><strong>Answer</strong>:</p>
</div>
<ol start="10">
<li>In the <span class="packt_screen">Parcels_Sales</span> table, right-click on the <span class="packt_screen">REALKEY</span> field and select <span class="packt_screen">Sort Descending</span>.</li>
<li>In the <span class="packt_screen">Parcels_Sales</span> table, locate the rows with a REALKEY value of <span class="packt_screen">15812</span>. You will need to scroll down until you see that value or you could use the <span class="packt_screen">Select by Attribute</span> tool to select the records.</li>
</ol>
<div class="packt_infobox">
<p><strong>Question</strong><span>: </span>How many records in the Parcels_Sales table have a REALKEY value of 15812?</p>
<p><strong>Answer</strong>:</p>
</div>
<ol start="12">
<li>Close both tables by clicking on the small <span class="packt_screen">X</span> next to their name in the table view.</li>
<li>Click the <span class="packt_screen">Clear</span> button located in the <span class="packt_screen">Selection</span> group on the <span class="packt_screen">Map</span> tab if you selected any records in either table.</li>
</ol>
<p style="padding-left: 60px">You should now know that there is one parcel and two sales records which have a realkey value of 15812. This means you have a one to many cardinality. So, you know the key field and the cardinality you will need to create the relationship class which will link the Parcels layer to the Parcels_Sales table.</p>
<ol start="14">
<li>In the <span class="packt_screen">Catalog</span> pane, expand the <span class="packt_screen">Database</span> folder so you can see the two databases which are connected to the project.</li>
<li>Expand the <span class="packt_screen">Thomaston.gdb</span> geodatabase, then right-click on it and select <span class="packt_screen">Relationship</span>. The <span class="packt_screen">Create Relationship</span> tool should open in the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>Set the <span class="packt_screen">Origin Table</span> to <span class="packt_screen">Parcels</span> using the drop-down arrow. This establishes the Parcels as the primary table for the relationship.</li>
<li>Set the <span class="packt_screen">Destination Table</span> to <span class="packt_screen">Parcels_Sales</span> using the drop-down arrow. This establishes it as the secondary or child table for the relationship.</li>
<li>The <span class="packt_screen">Output Relationship Class</span> should be automatically populated with <span class="packt_screen">Parcels_Parcels_Sales</span>. You can change the name if you desire, or accept the default.</li>
<li>Both the <span class="packt_screen">Forward Path Label</span> and <span class="packt_screen">Backward Path Label</span> should be automatically populated as well. Accept these default values.</li>
</ol>
<ol start="20">
<li>Set the <span class="packt_screen">Message Direction</span> to <span class="packt_screen">None</span> using the drop-down arrow, since we just want to be able to view related records between the tables. We are not trying to have one table control the information in the other.</li>
<li>Using the drop-down arrow, set the <span class="packt_screen">Cardinality</span> to <span class="packt_screen">One to Many (1:M)</span>, since this was what you determined the cardinality to be previously.</li>
<li>Set the <span class="packt_screen">Origin Primary Key</span> to <span class="packt_screen">Realkey</span> and set the <span class="packt_screen">Origin Foreign Key</span> to <span class="packt_screen">REALKEY</span>.</li>
<li>Verify that your <span class="packt_screen">Create Relationship</span> <span class="packt_screen">Class</span> looks like the following image. If it does, click <span class="packt_screen">Run</span>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-833 image-border" height="448" src="assets/d24c6ae4-90bf-4aef-a8f1-1143ebe49620.png" width="361"/></div>
<div class="mce-root CDPAlignCenter CDPAlign packt_figref">Create Relationship Class window in Geoprocessing pane</div>
<ol start="24">
<li>Once the tool has completed successfully, close the <span class="packt_screen">Geoprocessing</span> pane.</li>
<li>In the <span class="packt_screen">Catalog</span> pane, look at the contents of the <span class="packt_screen">Thomaston.gdb</span> geodatabase. You should see the new relationship class you just created.</li>
<li>Right-click on the <span class="packt_screen">Relationship</span> class in the <span class="packt_screen">Catalog</span> pane and select <span class="packt_screen">Properties</span>.</li>
<li>Take a moment to review the properties. They should reflect the settings you defined in the <span class="packt_screen">Create Relationship Class</span> tool.</li>
<li>Click <span class="packt_screen">OK</span> when done reviewing the properties.</li>
<li>Now to see if the new <span class="packt_screen">Relationship</span> class you create works. Select the <span class="packt_screen">Parcels</span> layer in the <span class="packt_screen">Contents</span> pane.</li>
<li>Using the <span class="packt_screen">Explore</span> tool, zoom into the center of the City of Thomaston. Zoom in so you can easily see the boundary of the individual parcels. This should be somewhere close to a scale of <kbd>1:4800</kbd>.</li>
<li>On the <span class="packt_screen">Map</span> tab in the ribbon, activate the <span class="packt_screen">Select</span> tool and click on a single parcel in the map. The selected parcel should have a blue highlighted boarder around it.</li>
<li>Click on the <span class="packt_screen">Data</span> tab in the <span class="packt_screen">Feature Layer</span> contextual menu in the ribbon.</li>
<li>Select the <span class="packt_screen">Related Data</span> button and the <span class="packt_screen">Parcels_Parcels_Sales: Parcels</span> option that is displayed. The <span class="packt_screen">Parcels_Sales</span> table should open, displaying any sales associated with the parcel you selected. If no sales are displayed, try selecting another parcel.</li>
</ol>
<div class="packt_tip">
<p>You will need to click on the <span class="packt_screen">Related Data</span> button each time you select a new parcel to refresh the table view.</p>
</div>
<ol start="34">
<li>Once you have verified that the relationship class is working, close the table view.</li>
<li>Save your project and close ArcGIS Pro.</li>
</ol>
<p>In this recipe, you created a Relationship class which linked the Parcels feature class to the Parcels_Sales standalone table. This permanently linked these two objects in the geodatabase so that you were able to select a parcel in the map and easily see each time it had been sold from the Parcels_Sales table.</p>
<p>This link was established using a key field you identified in each table. The key field used by a Relationship class, like a Relate or a Join, must contain the same exact values and be the same field type (text, long integer, short integer, and others). However, the field names are not required to be the same. ArcGIS Pro is then able to find records in both tables that have the same value and link those together, as you saw demonstrated in this recipe.</p>
<p>Unlike a Join or a Relate, a relationship class is part of your geodatabase. This means that anytime you add the Parcels feature class to a map in any project, you will have access to the data in the Parcels_Sales table automatically through the Related Data function.</p>
<p>Once you create a relationship class, you are not able to change how it is configured. If you wanted to change a simple relationship to a composite for example, you would have to create a completely new relationship class.</p>


            </article>

            
        </section>
    </body></html>