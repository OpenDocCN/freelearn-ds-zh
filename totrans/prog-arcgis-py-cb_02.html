<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 2. Managing Map Documents and Layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Managing Map Documents and Layers</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Referencing the current map document</li><li class="listitem" style="list-style-type: disc">Referencing map documents on a disk</li><li class="listitem" style="list-style-type: disc">Getting a list of layers in a map document</li><li class="listitem" style="list-style-type: disc">Restricting the list of layers</li><li class="listitem" style="list-style-type: disc">Zooming in to selected features</li><li class="listitem" style="list-style-type: disc">Changing the map extent</li><li class="listitem" style="list-style-type: disc">Adding layers to a map document</li><li class="listitem" style="list-style-type: disc">Inserting layers into a map document</li><li class="listitem" style="list-style-type: disc">Updating layer symbology</li><li class="listitem" style="list-style-type: disc">Updating layer properties</li><li class="listitem" style="list-style-type: disc">Working with time-enabled layers in a data frame</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/>Introduction</h1></div></div></div><p>The ArcPy mapping module provides some really exciting features for mapping automation, including the ability to manage map documents and layer files, as well as the data within these files. Support is provided to automate map export and print, to create PDF map books, and publish map documents to ArcGIS Server map services. This is an incredibly useful module for accomplishing many of the day-to-day tasks performed by GIS analysts.</p><p>In this chapter, you will learn how to use the ArcPy mapping module to manage map documents and layer files. You will also learn how to add and remove geographic layers and tables from map document files, insert layers into data frames, and move layers around within the map document. Finally, you will learn how to update layer properties and symbology.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Referencing the current map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Referencing the current map document</h1></div></div></div><p>When<a id="id84" class="indexterm"/> running a geoprocessing script from the ArcGIS Python window or a custom script tool, you will often need to make a reference to the map document which is currently loaded in ArcMap. This is typically the first step in your script before you perform geoprocessing operations against layers and tables in a map document. In this recipe, you will learn how to reference the current map document from your Python geoprocessing script.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Getting ready</h2></div></div></div><p>Before you can actually perform any operations on a map document file, you need to make a reference to it in your Python script. This is done by calling the <code class="literal">MapDocument()</code> method on the <code class="literal">arcpy.mapping</code> module. You can reference either the currently running document or a document at a specific location on disk. To reference the currently active document, you simply supply the keyword <code class="literal">CURRENT</code> as a parameter to the <code class="literal">MapDocument()</code> function. This loads the currently active document in ArcMap. The following code example shows how a reference to the current active document is obtained:</p><div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>You can only use the <code class="literal">CURRENT</code> keyword when running a script from the ArcGIS Python window or a custom script tool in ArcToolbox. If you attempt to use this keyword when running a script from IDLE or any other development environment, it won't have access to the map document file that is currently loaded in ArcGIS. I should also point out that the <code class="literal">CURRENT</code> keyword is not case sensitive. You could just as easily use <code class="literal">"current"</code>.</p></div></div><p>To reference a map document on a local or remote drive, simply supply the path to the map document as well as the map document name as a parameter to <code class="literal">MapDocument()</code>. For example, you would reference the <code class="literal">crime.mxd</code> file in the <code class="literal">c:\data</code> folder with the following reference: <code class="literal">arcpy.mapping.MapDocument("C:/data/crime.mxd")</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to access the currently active map document in ArcMap:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button located on the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module by typing the following into the Python window. Here, and in future recipes, we'll assign the <code class="literal">arcpy.mapping</code> module to a variable called <code class="literal">mapping</code>. This will make your code easier to read and cut down on the amount of code you have to write. Instead of having to prefix all your code with <code class="literal">arcpy.mapping</code>, you can just refer to it as mapping. It is not required that you follow this form, but it does make your code cleaner and faster to write. Furthermore, you can name the variable as you wish. For example, instead of calling it <code class="literal">mapping</code> you may call it <code class="literal">MAP</code> or <code class="literal">mp</code> or whatever makes sense.<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference <a id="id85" class="indexterm"/>the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable by typing the following into the Python Window below the first line of code that you added in the last step:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Set a title for map document:<div class="informalexample"><pre class="programlisting">mxd.title = "Crime Project"</pre></div></li><li class="listitem">Save a copy of the map document file with the <code class="literal">saveACopy()</code> method:<div class="informalexample"><pre class="programlisting">mxd.saveACopy("c:/ArcpyBook/Ch2/crime_copy.mxd")</pre></div></li><li class="listitem">Navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Map Document Properties</strong></span>, in order to view the new title you gave to the map document.</li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch2\ReferenceCurrentMapDocument.py</code> solution file.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>How it works…</h2></div></div></div><p>The <code class="literal">MapDocument</code> class<a id="id86" class="indexterm"/> has a constructor that creates an instance of this class. In object-oriented programming, an<a id="id87" class="indexterm"/> <span class="strong"><strong>instance</strong></span> is also known as an <a id="id88" class="indexterm"/>
<span class="strong"><strong>object</strong></span>. The constructor for <code class="literal">MapDocument</code> can accept either the <code class="literal">CURRENT</code> keyword or a path to a map document file on a local or remote drive. The constructor creates an object and assigns it to the variable <code class="literal">mxd</code>. You can then access the properties and methods available on this object using dot notation. In this particular case, we printed out the title of the map document file using the <code class="literal">MapDocument.title</code> property and we also used the <code class="literal">MapDocument.saveACopy()</code> method to save a copy of the map document file.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Referencing map documents on a disk"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Referencing map documents on a disk</h1></div></div></div><p>In addition to being able to reference the currently active map document file in ArcMap, you can also access <a id="id89" class="indexterm"/>map document files that are stored on a local or remote drive by using the <code class="literal">MapDocument()</code> constructor. In this recipe, you'll learn how to access these map documents.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Getting ready</h2></div></div></div><p>As I mentioned earlier, you can also reference a map document file that resides somewhere on your computer or a shared server. This is done simply by providing a path to the file. This is a more versatile way of obtaining a reference to a map document because it can be run outside the ArcGIS Python window. Later, when we will discuss parameters in a script, you'll understand that you can make this path a parameter so that the script is even more versatile, with the ability to input a new path each time it is needed.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to access a map document stored on a local or remote drive:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the IDLE development environment from <span class="strong"><strong>Start</strong></span> | <span class="strong"><strong>All Programs</strong></span> | <span class="strong"><strong>ArcGIS</strong></span> | <span class="strong"><strong>Python 2.7</strong></span> | <span class="strong"><strong>IDLE</strong></span>.</li><li class="listitem">Create a new IDLE script window by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Window</strong></span> from the IDLE shell window.</li><li class="listitem">Import <code class="literal">arcpy.mapping</code>:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the copy of the <code class="literal">crime</code> map document that you created in the last recipe:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("c:/ArcpyBook/Ch2/crime_copy.mxd")</pre></div></li><li class="listitem">Print the title of the map document:<div class="informalexample"><pre class="programlisting">print(mxd.title)</pre></div></li><li class="listitem">Run the script, and you will see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Crime Project</strong></span>
</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch2\ReferenceMapDocumentOnDisk.py</code> solution file.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How it works…</h2></div></div></div><p>The only difference between this recipe and the last one is that we provided a reference to a map<a id="id90" class="indexterm"/> document file on a local or remote drive rather than using the <code class="literal">CURRENT</code> keyword. This is the recommended way of referencing a map document file unless you know for sure that your geoprocessing script will be run inside ArcGIS, either in the Python window or as a custom script tool.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Getting a list of layers in a map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Getting a list of layers in a map document</h1></div></div></div><p>Frequently, one of the first <a id="id91" class="indexterm"/>steps in a geoprocessing script is to obtain a list of layers in the map document. Once obtained, your script may then cycle through each of the layers and perform some type of processing. The <a id="id92" class="indexterm"/>mapping module contains a <code class="literal">ListLayers()</code> function, which provides the capability of obtaining this list of layers. In this recipe, you will learn how to get a list of layers contained within a map document.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>Getting ready</h2></div></div></div><p>The <code class="literal">arcpy.mapping</code> module contains various list functions to return lists of layers, data frames, broken data sources, table views, and layout elements. These list functions normally function as the first step in a multistep process, in which the script needs to get one or more items from a list for further processing. Each of these list functions returns a Python list, which, as you know from earlier in the book, is a highly functional data structure for storing information.</p><p>Normally, the list functions are used as a part of a multistep process, in which creating a list is only the first step. Subsequent processing in the script will iterate over one or more of the items in this list. For example, you might obtain a list of layers in a map document and then iterate through each layer looking for a specific layer name, which will then be subjected to further geoprocessing.</p><p>In this recipe, you will learn how to obtain a list of layers from a map document file.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to get a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Call the <code class="literal">ListLayers()</code> function and pass a reference to the map document:<div class="informalexample"><pre class="programlisting">layers = mapping.ListLayers(mxd)</pre></div></li><li class="listitem">Start a <code class="literal">for</code> loop<a id="id93" class="indexterm"/> and print out the name of each layer in the map document:<div class="informalexample"><pre class="programlisting">for lyr in layers:
    print(lyr.name)</pre></div></li><li class="listitem">Run <a id="id94" class="indexterm"/>the script to see the following output (you can check your work by examining the <code class="literal">c:\ArcpyBook\code\Ch2\GetListLayers.py</code> solution file):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Burglaries in 2009</strong></span>
<span class="strong"><strong>Crime Density by School District</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
<span class="strong"><strong>Test Performance by School District</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
<span class="strong"><strong>Texas Counties</strong></span>
<span class="strong"><strong>School_Districts</strong></span>
<span class="strong"><strong>Crime Surface</strong></span>
<span class="strong"><strong>Bexar County Boundary</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>How it works…</h2></div></div></div><p>The <code class="literal">ListLayers()</code> function<a id="id95" class="indexterm"/> retrieves a list of layers in a map document, specific data frame, or layer file. In this case, we passed a reference to the current map document to the <code class="literal">ListLayers()</code> function, which should retrieve a list of all the layers in the map document. The results are stored in a variable called <code class="literal">layers</code>, which is a Python list that can be iterated with a <code class="literal">for</code> loop. This Python list contains one or more <code class="literal">Layer</code> objects.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>There's more…</h2></div></div></div><p>The <code class="literal">ListLayers()</code> function<a id="id96" class="indexterm"/> is only one of the many list functions provided by the <code class="literal">arcpy.mapping</code> module. Each of these functions returns a Python list containing data of some type. Some of the other list functions include <code class="literal">ListTableViews()</code>, which returns a list of <code class="literal">Table</code> objects; <code class="literal">ListDataFrames()</code>, which returns a list of <code class="literal">DataFrame</code> objects; and <code class="literal">ListBoomarks()</code>, which returns a list of bookmarks in a map document. There are additional list functions, many of which we'll cover later in this book.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Restricting the list of layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Restricting the list of layers</h1></div></div></div><p>In the previous<a id="id97" class="indexterm"/> recipe, you learned how to get a list of layers by using the <code class="literal">ListLayers()</code> function. There will be times when you will not want a list of all the layers in a map document, but rather only a subset of the layers. The <code class="literal">ListLayers()</code> function allows you to restrict the list of layers that is generated. In this recipe, you will learn how to restrict the layers returned using a wildcard and a specific data frame from the ArcMap table of contents.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Getting ready</h2></div></div></div><p>By default, if you only pass a reference to the map document or layer file, the <code class="literal">ListLayers()</code> function will return a list of all the layers in these files. However, you can restrict the list of layers returned by this function by using an optional wildcard parameter or by passing in a reference to a specific data frame. A wildcard is a character that will match any character or sequence of characters in a search. This will be demonstrated in this recipe.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>If you're working with a layer file (<code class="literal">.lyr</code>), you can't restrict layers with a data frame. Layer files don't support data frames.</p></div></div><p>In this recipe, you will learn how to restrict the list of layers returned by <code class="literal">ListLayers()</code> through the use of a wildcard and data frame.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to restrict a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a list of data frames in the map document and search for a specific data frame named <code class="literal">Crime</code> (please note that text strings can be surrounded by either single or double quotation marks):<div class="informalexample"><pre class="programlisting">for df in mapping.ListDataFrames(mxd):
  if df.name == 'Crime':</pre></div></li><li class="listitem">Call the <code class="literal">ListLayers()</code> function and pass a reference to the map document, a wildcard to restrict the search, and the data frame found in the last step to further restrict the search. The <code class="literal">ListLayers()</code> function should be indented inside the <code class="literal">if</code> statement you just created:<div class="informalexample"><pre class="programlisting">layers = mapping.ListLayers(mxd,'Burg*',df)</pre></div></li><li class="listitem">Start a <a id="id98" class="indexterm"/>for loop and print out the name of each layer in the map document:<div class="informalexample"><pre class="programlisting">for layer in layers:
    print(layer.name)</pre></div></li><li class="listitem">The complete script should appear as follows or you can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\RestrictLayers.py</code>:<div class="mediaobject"><img src="images/B04314_02_22.jpg" alt="How to do it…"/></div></li><li class="listitem">Run the script to see the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Burglaries in 2009</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>How it works…</h2></div></div></div><p>The <code class="literal">ListDataFrames()</code> function<a id="id99" class="indexterm"/> is another list function that is provided by <code class="literal">arcpy.mapping</code>. This function returns a list of all the data frames in a map document. We then loop through each of the data frames returned by this function, looking for a data frame that has the name <code class="literal">Crime</code>. If we do find a data frame that has this name, we call the <code class="literal">ListLayers()</code> function, passing in the optional wildcard value of <code class="literal">Burg*</code> as the second parameter, and a reference to the <code class="literal">Crime</code> data frame. The wildcard value passed in as the second parameter accepts any number of characters and an optional wildcard character (<code class="literal">*</code>).</p><p>In this particular recipe, we searched for all the layers that begin with the characters <code class="literal">Burg</code> and have a data frame named <code class="literal">Crime</code>. Any layers found matching these restrictions were then printed. Keep in mind that all we did in this case was print the layer names, but in most cases, you would be performing additional geoprocessing with the use of tools or other functions, and having a shorter list will speed up your script and will keep things neat and tidy.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Zooming in to selected features"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Zooming in to selected features</h1></div></div></div><p>Creating<a id="id100" class="indexterm"/> selection sets in ArcMap is a common task. Selection sets are often created as the result of an attribute or spatial query, but they can also occur when a user manually selects features and sometimes, under some additional circumstances. To better visualize selection sets, users often zoom to the extent of the selected feature. This can be accomplished programmatically with Python in several ways. In this recipe, you will learn how to zoom to all the selected features in a data frame as well as an individual layer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>Getting ready</h2></div></div></div><p>The <code class="literal">DataFrame.zoomToSelectedFeatures</code> property<a id="id101" class="indexterm"/> zooms to the extent of all the selected features from all the layers in the data frame. Essentially, it performs the same operation as the <span class="strong"><strong>Selection</strong></span> | <span class="strong"><strong>Zoom to Selected Features</strong></span> operation. One difference is that it will zoom to the full extent of all the layers if no features are selected.</p><p>Zooming to the extent of selected features in an individual layer requires you to use the <code class="literal">Layer</code> object. The <code class="literal">Layer</code> object includes a <code class="literal">getSelectedExtent()</code> method that you can call to zoom to the extent of the selected records. This returns an <code class="literal">Extent</code> object, which you can then use as a parameter that is passed into the <code class="literal">DataFrame.panToExtent()</code> method.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to get and set the active data frame and active view ArcMap:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">In the ArcMap <span class="strong"><strong>Table Of Contents</strong></span> pane, make sure that <code class="literal">Crime</code> is the active data frame.</li><li class="listitem">In the <span class="strong"><strong>Table Of Contents</strong></span> pane, click on the <span class="strong"><strong>List By Selection</strong></span> button.</li><li class="listitem">Make the <span class="strong"><strong>Bexar County Boundaries</strong></span> layer unselectable by clicking on the toggle button just to the right of the layer name:<div class="mediaobject"><img src="images/B04314_02_20.jpg" alt="How to do it…"/></div></li><li class="listitem">Click <a id="id102" class="indexterm"/>on the <span class="strong"><strong>List By Source</strong></span> button in the <span class="strong"><strong>Table Of Contents</strong></span> pane. Using the <span class="strong"><strong>Select Features</strong></span> tool, drag a box around the cluster of burglaries inside the <span class="strong"><strong>Northside ISD</strong></span> boundary. This should select the boundaries of a specific school district along with some burglaries as shown in the following diagram:<div class="mediaobject"><img src="images/B04314_02_21.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on <a id="id103" class="indexterm"/>the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get the active data frame (<code class="literal">Crime</code>) and zoom to the selected features:<div class="informalexample"><pre class="programlisting">mxd.activeDataFrame.zoomToSelectedFeatures()</pre></div></li><li class="listitem">If no records have been selected, a call to <code class="literal">zoomToSelectedFeatures()</code> will zoom to the extent of all the records in the data frame. Clear the selected features by navigating to <span class="strong"><strong>Selection</strong></span> | <span class="strong"><strong>Clear Selected Features</strong></span>. This will clear the selection set. Now, execute the same line of code again to see how this affects the operation of the <code class="literal">zoomToSelectedFeatures()</code> method:<div class="informalexample"><pre class="programlisting">mxd.activeDataFrame.zoomToSelectedFeatures()</pre></div></li><li class="listitem">Now, we'll zoom to the extent of the selected features in a specific layer. Using the <span class="strong"><strong>Select Features</strong></span> tool, drag a box around the cluster of burglaries inside the <span class="strong"><strong>Northside ISD</strong></span> boundary.</li><li class="listitem">First, get a reference to the <code class="literal">Crime</code> data frame. Calling the <code class="literal">ListDataFrames()</code> function and passing in a wildcard of <code class="literal">Crime</code> will return a Python list containing a single item. We pull this item out using <code class="literal">[0]</code>, which returns the first and only item in the list:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Now, we'll <a id="id104" class="indexterm"/>get a reference to the <code class="literal">Burglaries</code> layer, which contains some selected features. The following code uses a wildcard <code class="literal">*</code> to search for the <span class="strong"><strong>Burglaries in 2009</strong></span> layer within the data frame that we referenced in the last line of code. The <code class="literal">ListLayers()</code> function returns a Python list and we use <code class="literal">[0]</code> to pull out the first and only layer containing the word <code class="literal">Burglaries</code>:<div class="informalexample"><pre class="programlisting">layer = mapping.ListLayers(mxd,"Burglaries*",df)[0]</pre></div></li><li class="listitem">Finally, we'll set the extent of the data frame by getting the extent of the selected features in the layer:<div class="informalexample"><pre class="programlisting">df.extent = layer.getSelectedExtent</pre></div></li><li class="listitem">The complete script for zooming to the selected features of a layer should appear as follows or you can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\ZoomSelectedExtent.py</code>:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping
mxd = mapping.MapDocument("CURRENT")
df = mapping.ListDataFrames(mxd, "Crime")[0]
layer = mapping.ListLayers(mxd,"Burglaries*",df)[0]
df.extent = layer.getSelectedExtent</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>How it works…</h2></div></div></div><p>In this recipe, you learned how to zoom to the extent of all the selected records from all the layers in a data frame as well as how to zoom to the extent of all the selected records from a specific layer in a data frame. Zooming to the extent of all the selected records from all the layers in a data frame simply requires that you get a reference to the active data frame and then call <code class="literal">zoomToSelectedFeatures()</code>.</p><p>Zooming to the extent of the selected records within a specific layer requires a little more coding. After importing the <code class="literal">arcpy.mapping</code> module and getting a reference to the map document, we then got a reference to the <code class="literal">Crime</code> data frame. Using the <code class="literal">ListLayers()</code> function we passed in a reference to the data frame as well as a wildcard that searched for the layers that begin with the text <code class="literal">Burglaries</code>. The <code class="literal">ListLayers()</code> function returned a Python list and since we knew that we only had one layer that matched the wildcard search, we pulled out the first layer and assigned it to a variable called <code class="literal">layer</code>. Finally, we set the extent of the data frame using <code class="literal">layer.getSelectedExtent</code>.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Changing the map extent"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Changing the map extent</h1></div></div></div><p>There will be<a id="id105" class="indexterm"/> many occasions when you will need to change the map extent. This is frequently the case when you are automating the map production process and need to create many maps of different areas or features. There are a number of ways that the map extent can be changed with <code class="literal">arcpy</code>. However, for this recipe, we'll concentrate on using a definition expression to change the extent.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Getting ready</h2></div></div></div><p>The <code class="literal">DataFrame</code> class has an <code class="literal">extent</code> property that you can use to set the geographic extent. This is often used in conjunction with the <code class="literal">Layer.definitionQuery</code> property that is used to define a definition query for a layer. In this recipe, you will learn how to use these objects and properties to change the map extent.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How to do it...</h2></div></div></div><p>Follow these steps to learn how to get a list of layers from a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Create a <code class="literal">for</code> loop that will loop through all the data frames in the map document:<div class="informalexample"><pre class="programlisting">for df in mapping.ListDataFrames(mxd):</pre></div></li><li class="listitem">Find the data frame called <code class="literal">Crime</code> and a specific layer that we'll apply the definition query against:<div class="informalexample"><pre class="programlisting">if df.name == 'Crime':
  layers = mapping.ListLayers(mxd,'Crime Density by School District',df)</pre></div></li><li class="listitem">Create a <code class="literal">for</code> loop that will loop through the layers. There will only be one, but we'll create the loop anyway. In the <code class="literal">for</code> loop, create a definition query and set the new extent of the data frame:<div class="informalexample"><pre class="programlisting">for layer in layers:
  query = '"NAME" = \'Lackland ISD\''
  layer.definitionQuery = query
  df.extent = layer.getExtent()</pre></div></li><li class="listitem">The entire script should appear as follows or you can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\ChangeMapExtent.py</code>:<div class="mediaobject"><img src="images/B04314_02_23.jpg" alt="How to do it..."/></div></li><li class="listitem">Save and<a id="id106" class="indexterm"/> run the script. The extent of the data view should update so that it visualizes only the features matching the definition expression, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_14.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How it works...</h2></div></div></div><p>This recipe used a <a id="id107" class="indexterm"/>definition query on a layer to update the map extent. Near the end of the script, you created a new variable called <code class="literal">query</code> that held the definition expression. The definition expression was set up to find school districts with a name of <span class="strong"><strong>Lackland ISD</strong></span>. This query string was then applied to the <code class="literal">definitionQuery</code> property. Finally, the <code class="literal">df.extent</code> property was set to the returned value of <code class="literal">layer.getExtent()</code>.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Adding layers to a map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Adding layers to a map document</h1></div></div></div><p>There will be <a id="id108" class="indexterm"/>many situations where you will need to add a layer to a map <a id="id109" class="indexterm"/>document. The mapping module provides this functionality through the <a id="id110" class="indexterm"/>
<code class="literal">AddLayer()</code> function. In this recipe, you will learn how to add a layer to a map document using this function.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Getting ready</h2></div></div></div><p>The <code class="literal">arcpy.mapping</code> module<a id="id111" class="indexterm"/> provides the ability to add layers or group layers into an existing map document file. You can take advantage of the ArcMap <span class="emphasis"><em>auto-arrange</em></span> functionality, which automatically places a layer in the data frame for visibility. This is essentially the same functionality as is provided by the <span class="strong"><strong>Add Data</strong></span> button in ArcMap, which positions a layer in the data frame based on geometry type and layer weight rules.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Layers can't be added to a layer file (<code class="literal">.lyr</code>).</p></div></div><p>When adding a layer to a map document, the layer must reference an existing layer found in a layer file on disk, the same map document and data frame, the same map document with a different data frame, or a completely separate map document. A layer can be either a layer in a map document or a layer in a <code class="literal">.lyr</code> file. To add a layer to a map document, you must first create an instance of the <code class="literal">Layer</code> class and then call the <code class="literal">AddLayer()</code> function, passing in the new layer along with the data frame where it should be placed and rules for how it is positioned.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to add a layer to a map document:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a<a id="id112" class="indexterm"/> reference to the <code class="literal">Crime</code> data frame, which is the first data frame in the list returned by <code class="literal">ListDataFrames()</code>. The <code class="literal">[0]</code> value, specified at the end of the code, gets the first <a id="id113" class="indexterm"/>data frame returned from the <code class="literal">ListDataFrames()</code> method, which returns a list of data frames. Lists are 0-based, so in order to retrieve the first data frame, we provide an index of <code class="literal">0</code>:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd)[0]</pre></div></li><li class="listitem">Create a <code class="literal">Layer</code> object that references a <code class="literal">.lyr</code> file:<div class="informalexample"><pre class="programlisting">layer = mapping.Layer(r"C:\ArcpyBook\data\School_Districts.lyr")</pre></div></li><li class="listitem">Add the layer to the data frame:<div class="informalexample"><pre class="programlisting">mapping.AddLayer(df,layer,"AUTO_ARRANGE")</pre></div></li><li class="listitem">You can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\AddLayersMapDocument.py</code>. Run the script. The <code class="literal">School_Districts.lyr</code> file will be added to the data frame, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_11.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>How it works…</h2></div></div></div><p>In the first <a id="id114" class="indexterm"/>two lines, we <a id="id115" class="indexterm"/>simply referenced the <code class="literal">arcpy.mapping</code> module and got a reference to the currently active map document. Next, we created a new variable called <code class="literal">df</code>, which held a reference to the <code class="literal">Crime</code> data frame. This was obtained through the <code class="literal">ListDataFrames()</code> function that returned a list of data frame objects. We then used list access to return the first item in the list, which is the <code class="literal">Crime</code> data frame. A new <code class="literal">Layer</code> instance, called <code class="literal">layer</code>, was then created from a <code class="literal">layer</code> file stored on disk. This <code class="literal">layer</code> file was called <code class="literal">School_Districts.lyr</code>. Finally, we called the <code class="literal">AddLayer()</code> function, passing in the data frame where the layer should ideally reside along with a reference to the layer, and a parameter indicating that we wanted to use the <a id="id116" class="indexterm"/>
<span class="strong"><strong>auto-arrange</strong></span> feature. In addition to allowing ArcMap to automatically place the layer into the data frame using auto-arrange, you can also specifically place the layer at either the top or bottom of the data frame or a group layer using the <code class="literal">BOTTOM</code> or <code class="literal">TOP</code> position.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>There's more…</h2></div></div></div><p>In addition to providing the capability of adding a layer to a map document, <code class="literal">arcpy.mapping</code> also provides an <code class="literal">AddLayerToGroup()</code> function, which can be used to add a layer to a group layer. The <a id="id117" class="indexterm"/>layer can be added to the top or bottom of the group layer or you can use auto-arrange for placement. You may also add layers to an empty group layer. However, just as with regular layer objects, group layers cannot be added to a layer file.</p><p>Layers can also<a id="id118" class="indexterm"/> be removed from a data frame or group layer. <code class="literal">RemoveLayer()</code> is the function used to remove a layer or group layer. In the event that two layers have the same name, only the first is removed, unless your script is set up to iterate.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Inserting layers into a map document"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Inserting layers into a map document</h1></div></div></div><p>The <code class="literal">AddLayer()</code> function<a id="id119" class="indexterm"/> can be used to add a layer to a <a id="id120" class="indexterm"/>map document either through auto-arrange or as the first or last layer in a data frame. However, it doesn't provide the control you need for inserting a layer in a specific position within a data frame. For this added control, you can use the <a id="id121" class="indexterm"/>
<code class="literal">InsertLayer()</code> function. In this recipe, you will learn how to control the placement of layers that are added to a data frame.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>Getting ready</h2></div></div></div><p>The <code class="literal">AddLayer()</code> function simply adds a layer into a data frame or a group layer and places the layer automatically using auto-arrange. You can choose to have the layer placed at the top or bottom of either. The <code class="literal">InsertLayer()</code> method allows you to have more precise positioning of a new layer into a data frame or a group layer. It uses a reference layer to specify a location and the layer is added either before or after the reference layer, as specified in your code. Since <code class="literal">InsertLayer()</code> requires the use of a reference layer, you can't use this method on an empty data frame. This is illustrated in the following screenshot, where <span class="strong"><strong>District_Crime_Join</strong></span> is the reference layer and <span class="strong"><strong>School_Districts</strong></span> is the layer to be added. The <span class="strong"><strong>School_Districts</strong></span> layer can be placed either before or after the reference layer using <code class="literal">InsertLayer()</code>:</p><div class="mediaobject"><img src="images/B04314_02_1.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>How to do it…</h2></div></div></div><p>Follow<a id="id122" class="indexterm"/> these<a id="id123" class="indexterm"/> steps to learn how to use <code class="literal">InsertLayer()</code> to insert a layer into a data frame:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Define the reference layer:<div class="informalexample"><pre class="programlisting">refLayer = mapping.ListLayers(mxd, "Burglaries*", df)[0]</pre></div></li><li class="listitem">Define the layer to be inserted relative to the reference layer:<div class="informalexample"><pre class="programlisting">insertLayer = mapping.Layer(r"C:\ArcpyBook\data\CityOfSanAntonio.gdb\Crimes2009")</pre></div></li><li class="listitem">Insert the layer into the data frame:<div class="informalexample"><pre class="programlisting">mapping.InsertLayer(df,refLayer,insertLayer,"BEFORE")</pre></div></li><li class="listitem">You can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\InsertLayerMapDocument.py</code> to verify the accuracy of your code.</li><li class="listitem">Run the <a id="id124" class="indexterm"/>script. The <span class="strong"><strong>Crimes2009</strong></span> feature class will be added as a layer to the data frame, as seen in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_12.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>How it works…</h2></div></div></div><p>After obtaining<a id="id125" class="indexterm"/> references to the <code class="literal">arcpy.mapping</code> module, current map document file, and the <span class="strong"><strong>Crime</strong></span> data frame, our script then defines a reference layer. In this case, we used the <code class="literal">ListLayers()</code> function with a wildcard of <code class="literal">Burglaries*</code>, and the <span class="strong"><strong>Crime</strong></span> data frame to restrict the list of layers returned to only one item. This item should be the <span class="strong"><strong>Burglaries in 2009</strong></span> layer. We used Python list access with a value of <code class="literal">0</code> to retrieve this layer from the list and assigned it to a Layer object. Next, we defined the <code class="literal">insert</code> layer, a new <code class="literal">Layer</code> object that references the <span class="strong"><strong>Crimes2009</strong></span> feature class from the <code class="literal">CityOfSanAntonio</code> geodatabase. Finally, we called the <code class="literal">InsertLayer()</code> function<a id="id126" class="indexterm"/> passing in the data frame, reference layer, layer<a id="id127" class="indexterm"/> to be inserted, and keyword indicating that the layer to be inserted should be placed before the reference layer. This is illustrated in the following screenshot:</p><div class="mediaobject"><img src="images/B04314_02_2.jpg" alt="How it works…"/></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>There's more…</h2></div></div></div><p>You can also reposition a layer that is already in a data frame or a group layer. The <code class="literal">MoveLayer()</code> function provides the ability to reposition the layer within a data frame or a group layer. Movement of a layer must be within the same data frame. You can't move a layer from one data frame to another. Just as with <code class="literal">InsertLayer()</code>, <code class="literal">MoveLayer()</code> uses a reference layer to reposition the layer.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Updating layer symbology"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Updating layer symbology</h1></div></div></div><p>There may<a id="id128" class="indexterm"/> be times when you will want to change the symbology of a layer in a map document. This can be accomplished through the use of the <a id="id129" class="indexterm"/>
<code class="literal">UpdateLayer()</code> function, which can be used to change the symbology of a layer as well as various properties of a layer. In this recipe, you will use the <code class="literal">UpdateLayer()</code> function to update the symbology of a layer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>Getting ready</h2></div></div></div><p>The <code class="literal">arcpy.mapping</code> module also gives you the capability of updating layer symbology from your scripts by using the <code class="literal">UpdateLayer()</code> function. For example, you might want your script to <a id="id130" class="indexterm"/>update a layer's symbology from a graduated color to a graduated symbol, as illustrated in the following screenshot. <code class="literal">UpdateLayer()</code> can also be used to update various layer properties, but the default functionality is to update the symbology. Since <code class="literal">UpdateLayer()</code> is a robust function that is capable of altering both symbology and properties, you do need to understand the various parameters that can be supplied as an input:</p><div class="mediaobject"><img src="images/B04314_02_3.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to update the symbology of a layer using <code class="literal">UpdateLayer()</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">Click on the Python window button from the main ArcMap toolbar.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Define the layer that will be updated:<div class="informalexample"><pre class="programlisting">updateLayer = mapping.ListLayers(mxd,"Crime Density by School District",df)[0]</pre></div></li><li class="listitem">Define the layer that will be used to update the symbology:<div class="informalexample"><pre class="programlisting">sourceLayer = mapping.Layer(r"C:\ArcpyBook\data\CrimeDensityGradSym.lyr")</pre></div></li><li class="listitem">Call <a id="id131" class="indexterm"/>the <code class="literal">UpdateLayer()</code> function to update the symbology:<div class="informalexample"><pre class="programlisting">mapping.UpdateLayer(df,updateLayer,sourceLayer,True)</pre></div></li><li class="listitem">You can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\UpdateLayerSymbology.py</code> to verify the accuracy of your code.</li><li class="listitem">Run the script. The <span class="strong"><strong>Crime Density by School District</strong></span> layer will now be symbolized with graduated symbols instead of graduated colors, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_13.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>How it works…</h2></div></div></div><p>In this recipe, we used the <code class="literal">UpdateLayer()</code> function to update the symbology of a layer. We didn't update any properties, but we'll do so in the next recipe. The <code class="literal">UpdateLayer()</code> function requires that you pass several parameters including a data frame, layer to be updated, and a reference layer from which the symbology will be pulled and applied to update the layer. In our code, the <code class="literal">updateLayer</code> variable holds a reference to the <span class="strong"><strong>Crime Density by School District</strong></span> layer, which will have its symbology updated. The source layer from which the symbology will be pulled and applied to the updated layer is a layer file (<code class="literal">CrimeDensityGradSym.lyr</code>), containing graduated symbols.</p><p>To update the symbology for a layer, you must first ensure that the update layer and the source layer have the same geometry (point, line, or polygon). You also need to check that the attribute definitions are the same in some cases, depending upon the renderer. For example, graduated color symbology and graduated symbols are based on a particular attribute. In this case, both the layers had polygon geometry and a <code class="literal">CrimeDens</code> field containing crime density information.</p><p>Once we had<a id="id132" class="indexterm"/> references to both the layers, we called the <code class="literal">UpdateLayer()</code> function, passing in the data frame and layers along with a fourth parameter that indicated that we're updating symbology only. We supplied a <code class="literal">True</code> value as this fourth parameter, indicating that we were only updating the symbology and not properties:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mapping.UpdateLayer(df,updateLayer,sourceLayer,True)</strong></span>
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec55"/>There's more...</h2></div></div></div><p>The <code class="literal">UpdateLayer()</code> function <a id="id133" class="indexterm"/>also provides the ability to remove one layer and add another layer in its place. The layers can be completely unrelated, so there is no need to ensure that the geometry type and attribute field are the same as you would when redefining the symbology of a layer. This switching of layers essentially executes a call to <code class="literal">RemoveLayer()</code> and then a call to <code class="literal">AddLayer()</code> as one operation. To take advantage of this functionality, you must set the <code class="literal">symbology_only</code> parameter to <code class="literal">False</code>.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Updating layer properties"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Updating layer properties</h1></div></div></div><p>In the previous <a id="id134" class="indexterm"/>recipe, you learned how to update the symbology of a layer. As I mentioned, <code class="literal">UpdateLayer()</code> can also be used to update various properties of a layer, such as field aliases, query definitions, and others. In this recipe, you will use <code class="literal">UpdateLayer()</code> to alter various properties of a layer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec56"/>Getting ready</h2></div></div></div><p>You can also use the <code class="literal">UpdateLayer()</code> function to update a limited number of layer properties. Specific layer properties, such as field aliases, selection symbology, query definitions, label fields, and others, can be updated using <code class="literal">UpdateLayer()</code>. A common scenario is to have a layer in many map documents that needs to have a specific property changed across all the instances of the layer in all map documents. To accomplish this, you will have to use ArcMap to modify the layer with the appropriate properties and save it to a layer file. This layer file then becomes the source layer, which will be used to update the properties of another layer called <code class="literal">update_layer</code>. In this recipe, you'll use ArcMap to alter the properties of a layer, save to a layer file (<code class="literal">.lyr</code>) and then use Python to write a script that uses <code class="literal">UpdateLayer()</code> to apply the properties to another layer.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec57"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to update layer properties with <code class="literal">UpdateLayer()</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap. For this recipe, you will<a id="id135" class="indexterm"/> be working with the <span class="strong"><strong>Burglaries in 2009</strong></span> feature class, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_4.jpg" alt="How to do it…"/></div></li><li class="listitem">Double-click on the <span class="strong"><strong>Burglaries in 2009</strong></span> feature class in the <span class="strong"><strong>Crime</strong></span> data frame to display the <span class="strong"><strong>Layer Properties</strong></span> window, as shown in the following screenshot. Each of the tabs represents properties that can be set for this layer:<div class="mediaobject"><img src="images/B04314_02_5.jpg" alt="How to do it…"/></div></li><li class="listitem">Click <a id="id136" class="indexterm"/>on the <span class="strong"><strong>General</strong></span> tab and change the value in the <span class="strong"><strong>Layer Name:</strong></span> textbox to the name, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_8.jpg" alt="How to do it…"/></div></li><li class="listitem">Click on <a id="id137" class="indexterm"/>the <span class="strong"><strong>Definition Query</strong></span> tab and define the query, as shown in the following screenshot. You can use the <span class="strong"><strong>Query Builder…</strong></span> button to define the query or simply type in the query:<div class="mediaobject"><img src="images/B04314_02_6.jpg" alt="How to do it…"/></div></li><li class="listitem">Change<a id="id138" class="indexterm"/> the alias of the <code class="literal">OFFDESC</code> field to <code class="literal">Offense Description</code>, as shown in the next screenshot.</li><li class="listitem">Click on the <span class="strong"><strong>Fields</strong></span> tab in <span class="strong"><strong>Layer Properties</strong></span> and make visible only those fields that are selected with a checkmark in the following screenshot. This is done by unchecking the fields that you see in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_7.jpg" alt="How to do it…"/></div></li><li class="listitem">Click <a id="id139" class="indexterm"/>on <span class="strong"><strong>OK</strong></span> to dismiss the <span class="strong"><strong>Layer Properties</strong></span> dialog.</li><li class="listitem">In the data frame, right-click on <span class="strong"><strong>Burglaries – No Forced Entry</strong></span> and select <span class="strong"><strong>Save as Layer File</strong></span>.</li><li class="listitem">Save the file as <code class="literal">c:\ArcpyBook\data\BurglariesNoForcedEntry.lyr</code>.</li><li class="listitem">Right-click on the <span class="strong"><strong>Burglaries – No Forced Entry</strong></span> layer and select <span class="strong"><strong>Remove</strong></span>.</li><li class="listitem">Using the <span class="strong"><strong>Add Data</strong></span> button in ArcMap, add the <code class="literal">Crimes2009</code> feature class from the <code class="literal">CityOfSanAntonio</code> geodatabase. The feature class will be added to the data frame, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_9.jpg" alt="How to do it…"/></div></li><li class="listitem">Open <a id="id140" class="indexterm"/>the Python window in ArcMap.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>) and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Get a reference to the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Define the layer that will be updated:<div class="informalexample"><pre class="programlisting">updateLayer = mapping.ListLayers(mxd,"Crimes2009",df)[0]</pre></div></li><li class="listitem">Define the layer that will be used to update the properties:<div class="informalexample"><pre class="programlisting">sourceLayer = mapping.Layer(r"C:\ArcpyBook\data\BurglariesNoForcedEntry.lyr")</pre></div></li><li class="listitem">Call the <code class="literal">UpdateLayer()</code> function to update the symbology:<div class="informalexample"><pre class="programlisting">mapping.UpdateLayer(df,updateLayer,sourceLayer,False)</pre></div></li><li class="listitem">You can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\UpdateLayerProperties.py</code> to verify the accuracy of your code.</li><li class="listitem">Run the script.</li><li class="listitem">The <span class="strong"><strong>Crimes2009</strong></span> layer will be updated with the properties associated with the <code class="literal">BurglariesNoForcedEntry.lyr</code> file. This is illustrated in the following screenshot. Turn <a id="id141" class="indexterm"/>on the layer to view the definition query that has been applied. You can also open the <span class="strong"><strong>Layer Properties</strong></span> dialog to view the property changes that have been applied to the <span class="strong"><strong>Crimes2009</strong></span> feature class:<div class="mediaobject"><img src="images/B04314_02_10.jpg" alt="How to do it…"/></div></li></ol></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Working with time-enabled layers in a data frame"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Working with time-enabled layers in a data frame</h1></div></div></div><p>In this recipe, you <a id="id142" class="indexterm"/>will learn how to time-enable a layer and data frame. You will then write a script that cycles through the time <a id="id143" class="indexterm"/>range for the layer and exports a PDF map showing crimes through time in seven-day intervals.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec58"/>Getting ready</h2></div></div></div><p>The <code class="literal">DataFrameTime</code> object <a id="id144" class="indexterm"/>provides access to time management operations for time-enabled layers in a data frame. This object is returned when you reference the <code class="literal">DataFrame.time</code> property, and includes properties for retrieving the current time, end time, start time, time step interval, and others that are established by using the <span class="strong"><strong>Time Slider Options</strong></span> dialog box and then saved with the map document. One or more layers in a data frame must be time-enabled for this functionality to be operational.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec59"/>How to do it...</h2></div></div></div><p>Follow <a id="id145" class="indexterm"/>these steps<a id="id146" class="indexterm"/> to learn how to work with time-enabled layers:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">c:\ArcpyBook\Ch2\Crime_Ch2.mxd</code> with ArcMap.</li><li class="listitem">In the ArcMap <span class="strong"><strong>Table Of Contents</strong></span> make sure <code class="literal">Crime</code> is the active data frame.</li><li class="listitem">Open the <span class="strong"><strong>Layer Properties</strong></span> dialog box for <span class="strong"><strong>Burglaries in 2009</strong></span> by right-clicking on the layer and selecting <span class="strong"><strong>Properties</strong></span>. Select the <span class="strong"><strong>Time</strong></span> tab, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_15.jpg" alt="How to do it..."/></div><p>Enable time for the layer by clicking on the <span class="strong"><strong>Enable time on this layer</strong></span> checkbox.</p></li><li class="listitem">Under <a id="id147" class="indexterm"/><span class="strong"><strong>Time properties</strong></span>, select <span class="strong"><strong>Each feature has a single time field</strong></span> for <span class="strong"><strong>Layer Time:</strong></span>. Select the <span class="strong"><strong>SPLITDT</strong></span> field for the <span class="strong"><strong>Time Field:</strong></span>. Define a <span class="strong"><strong>Time Step Interval:</strong></span> of <span class="strong"><strong>7.00 Days</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_16.jpg" alt="How to do it..."/></div><p>Define<a id="id148" class="indexterm"/> the <span class="strong"><strong>Layer Time Extent:</strong></span> by clicking the <span class="strong"><strong>Calculate</strong></span> button, circled in the following screenshot:</p><div class="mediaobject"><img src="images/B04314_02_19.jpg" alt="How to do it..."/></div></li><li class="listitem">Check<a id="id149" class="indexterm"/> the <span class="strong"><strong>Time Step Interval:</strong></span> field. You may need to reset that to <span class="strong"><strong>7 Days</strong></span>.</li><li class="listitem">Click<a id="id150" class="indexterm"/> on <span class="strong"><strong>Apply</strong></span> and then <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">In the ArcMap <span class="strong"><strong>Tools</strong></span> toolbar, select the time slider options button to display the <span class="strong"><strong>Time Slider Options</strong></span> dialog as shown in the following screenshot:<div class="mediaobject"><img src="images/B04314_02_17.jpg" alt="How to do it..."/></div></li><li class="listitem">On the <span class="strong"><strong>Time Display</strong></span> tab of the <span class="strong"><strong>Time Slider Options</strong></span> dialog, make sure <span class="strong"><strong>Time step interval:</strong></span> is set to <span class="strong"><strong>7.0 days.</strong></span> If not, set it to <span class="strong"><strong>7.0 days</strong></span>. Do the same for the <span class="strong"><strong>Time window:</strong></span> option.<div class="mediaobject"><img src="images/B04314_02_18.jpg" alt="How to do it..."/></div></li><li class="listitem">Click<a id="id151" class="indexterm"/> on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">Save <a id="id152" class="indexterm"/>your map document. It's very important that you save the time-enabled data with your map document. The code you write next won't work unless you do so.</li><li class="listitem">Open the Python Window.</li><li class="listitem">Import the <code class="literal">arcpy.mapping</code> module:<div class="informalexample"><pre class="programlisting">import arcpy.mapping as mapping</pre></div></li><li class="listitem">Reference the currently active document (<code class="literal">Crime_Ch2.mxd</code>), and assign the reference to a variable:<div class="informalexample"><pre class="programlisting">mxd = mapping.MapDocument("CURRENT")</pre></div></li><li class="listitem">Retrieve the <code class="literal">Crime</code> data frame:<div class="informalexample"><pre class="programlisting">df = mapping.ListDataFrames(mxd, "Crime")[0]</pre></div></li><li class="listitem">Generate the <code class="literal">DataFrameTime</code> object:<div class="informalexample"><pre class="programlisting">dft = df.time</pre></div></li><li class="listitem">Set the <code class="literal">DataFrameTime.currentTime</code> property to the <code class="literal">DataFrameTime.startTime</code> property:<div class="informalexample"><pre class="programlisting">dft.currentTime = dft.startTime</pre></div></li><li class="listitem">Start a <code class="literal">while</code> loop that will loop through the time while the <code class="literal">currentTime</code> is less than or equal to the <code class="literal">endTime</code>:<div class="informalexample"><pre class="programlisting">while dft.currentTime &lt;= dft.endTime:</pre></div></li><li class="listitem">Inside<a id="id153" class="indexterm"/> the while loop, create a <a id="id154" class="indexterm"/>file for each PDF that will be created, export the PDF, and reset the <code class="literal">currentTime</code> property. The entire <code class="literal">while</code> loop should appear as follows:<div class="informalexample"><pre class="programlisting">while dft.currentTime &lt;= dft.endTime:
       fileName = str(dft.currentTime).split(" ")[0] + ".pdf"
       mapping.ExportToPDF(mxd,os.path.join(r"C:\ArcpyBook\Ch2", fileName), df)
       print("Exported " + fileName)
       dft.currentTime = dft.currentTime + dft.timeStepInterval</pre></div></li><li class="listitem">The entire script should appear as follows. You can consult the solution file at <code class="literal">c:\ArcpyBook\code\Ch2\TimeEnabledLayers.py</code> to verify the accuracy of your code:<div class="mediaobject"><img src="images/B04314_02_24.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec60"/>How it works…</h2></div></div></div><p>The <a id="id155" class="indexterm"/>
<code class="literal">DataFrameTime</code> object <a id="id156" class="indexterm"/>provides access to time management operations in a data frame. Several<a id="id157" class="indexterm"/> properties of <code class="literal">DataFrameTime</code>, including <code class="literal">currentTime</code>, <code class="literal">startTime</code>, <code class="literal">endTime</code>, and <code class="literal">timeStepInterval</code>, are used in this recipe. Initially, we set the <code class="literal">currentTime</code> property equal to the <code class="literal">startTime</code> property. The initial <code class="literal">startTime</code> was calculated when you set the <span class="strong"><strong>Time Step Interval:</strong></span> properties in ArcMap. The <code class="literal">while</code> loop was set up to loop as long as the <code class="literal">currentTime</code> property is greater than the <code class="literal">endTime</code> property. Inside the loop, we created a <code class="literal">fileName</code> variable that is set to the <code class="literal">currentTime</code> property, plus an extension of <code class="literal">.pdf</code>. We then called the <code class="literal">ExportToPDF()</code> function, passing in a path and the filename. This should ideally export the page layout view to the PDF file. Finally, we updated the <code class="literal">currentTime</code> property by the <code class="literal">timeStepInterval</code> property that was set to <span class="strong"><strong>7.0 days</strong></span> in in the <span class="strong"><strong>Time Step Interval:</strong></span> properties dialog.</p></div></div></div>
</body></html>