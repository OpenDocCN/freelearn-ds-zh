<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Level of Detail Expressions</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we covered table calculations, which are extremely useful when we want to aggregate information using exactly the data that is in the view, but sometimes we want to use more (or less) than the information that can be seen on the screen. For instance, if you want to show the average spend by customer, you don't want to show all customers and their value to compute an average. This is where <strong>Level of Detail</strong> <strong>(LOD)</strong> <span>calculations</span><span>, which we will introduce in this chapter, can be used, because they help us change the level of aggregation.</span></p>
<p class="mce-root"><span>The following topics will be covered in this chapter:</span></p>
<ul>
<li>Tableau's order of operations</li>
<li><kbd>FIXED</kbd> LOD calculations</li>
<li><kbd>INCLUDE</kbd> LOD calculations</li>
<li><kbd>EXCLUDE</kbd> LOD calculations</li>
<li>Data source constraints for LOD</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>This chapter uses the Global Superstore dataset, which can be found at<span> </span><a href="http://www.tableau.com/sites/default/files/training/global_superstore.zip" target="_blank">http://www.tableau.com/sites/default/files/training/global_superstore.zip</a>.<a href="http://www.tableau.com/sites/default/files/training/global_superstore.zip" target="_blank"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Tableau's order of operations</h1>
                </header>
            
            <article>
                
<p>Before delving deeper into LOD calculations, it is first important to understand Tableau's order of operations, as this will guide our conversation, seeing where this new topic fits in.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Surprising results</h1>
                </header>
            
            <article>
                
<p>Especially when coming to Tableau from Excel or other BI tools, one is sometimes at a loss when dealing with Tableau's order of operations. What can seem intuitive is not always what is reflected. Applying the wrong type of filter, or not using the proper calculation, will result in meaningless results.</p>
<p>The following is one such scenario. In the Global Superstore dataset, we create a data source filter for <kbd>Country</kbd> to show United Kingdom orders only, a dimension filter for <kbd>State</kbd> Wales and a <strong>Top 10 Customer Names by Sales</strong> filter.</p>
<div class="packt_tip">As a reminder, you can set up a <strong>Top</strong> filter by using the <span class="packt_screen">Top</span> option of the <span class="packt_screen">Filter</span> window, and in this case selecting <span class="packt_screen">By Field</span>, <span class="packt_screen">Top 10</span>, <span class="packt_screen">Sales</span>, and <span class="packt_screen">Sum</span>.</div>
<p class="mce-root"><span>Why should there be only one customer in the results</span> when we have set a filter for the top 10?</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/efaf9963-a6ad-4416-a791-42bd79ca7e13.png" style="width:38.92em;height:27.83em;"/></p>
<p class="mce-root"/>
<p><span>We will determine why we're not seeing the desired top 10 customers using the order of operations in the next section.</span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The order</h1>
                </header>
            
            <article>
                
<p>In order to interpret this, let's look at the infamous order of operations with the elements that we are already familiar with at this point in the book:</p>
<ol>
<li>Extract filters</li>
<li>Data source filters</li>
<li>Context filters</li>
<li>Sets, conditional, and top N filters</li>
<li>Dimension filters</li>
<li>Data blending</li>
<li>Measure filters</li>
<li>Totals</li>
<li>Table calculations</li>
</ol>
<p>Operations in Tableau are performed in this order, starting from the top and making their way down.</p>
<p>First, we have <strong>data source</strong> or <strong>extract</strong> filters (depending on the type of connection used, whether <span class="packt_screen">Live</span> or <span class="packt_screen">Extract</span>), as described in <a href="">Chapter 1</a>, <em>Building Your Data Model</em><span>.</span> These affec<span>t the entirety of your dataset at workbook level, before any specific filters that can be applied at worksheet level. As far as Tableau computation is concerned in the workbook, the filtered-out data doesn't even exist.</span></p>
<p><em>Context</em> filters are similar to data source or extract filters, but are view-specific. They are generally used to speed up processing, because they can further reduce the scope of data, as if creating a temporary subset of it before generating the view. These are mainly useful to improve the performance of a view that will be category-specific (for example, sales of Copiers only), within a very large dataset that can't be filtered at workbook level.</p>
<div class="packt_tip">Context filters can be created by selecting an existing dimension filter in the filters pane, and clicking the <span class="packt_screen">Add to context</span> option. The blue pill will turn gray to signify that the filter is now a context filter.</div>
<p><em>Sets</em>, <em>dimension</em>, and <em>measure</em> filters (including <em>conditional</em> and <em>top N</em> filters) have been described at length in <a href=""/><a href="">Chapter 1</a>, <em>Building Your Data Model</em>, and <a href="6ebf2184-6a4e-42de-8741-4c9f71f652d3.xhtml">Chapter 2</a>, <em>Working with Worksheets</em>, as is the case for <em>data blending</em> in <a href="786fd5d5-eb79-4216-bd9a-96d0a59374ea.xhtml">Chapter 1</a>, <em>Building Your Data Model</em>. Please refer to these chapters to clear up any remaining doubts on these subjects.</p>
<p class="mce-root"/>
<p>With the order of operations as it currently stands, it's worth realizing that table calculations (as described in the previous chapter) come last in the order, after totals (which represent the usual calculations used in Tableau). For example, if we are using a rank table calculation on <strong>Customer Name</strong> in a given <strong>State</strong>, the rank will include orders in that state and that state only, as table calculations come after dimension filters. The biggest customer in the dataset might just be the 10th customer in a particular region.</p>
<p>Now that we know about the order, let's go back to our previous example.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Explaining the surprising results</h1>
                </header>
            
            <article>
                
<p>We now hold the tools to understand why only one customer shows up:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d069bfb3-4bf5-44f2-8831-7cbeb38f4e2a.png" style="width:38.58em;height:27.58em;"/></p>
<p>If we take a look at the order of operations, the top N filter comes before the dimension filter (in this case, for <kbd>State</kbd> Wales), but after the data Source filters (here, <kbd>Country</kbd> United Kingdom).</p>
<p>The sales shown in the results are therefore sales in Wales for customers that are in the top 10 <em>UK-wide</em>, not just in Wales. Nine of those customers have no sales in Wales, just in the other parts of the UK, and don't appear in our results.</p>
<p>If one wanted to see the top 10 customers in Wales for sales occurring there only, it is possible to promote the filter on <kbd>State</kbd> to be a context filter, moving it back up in the order of operations:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c936ff6e-faa0-4b31-93bd-692953d44b09.png" style="width:37.50em;height:27.67em;"/></p>
<p>Now that we've covered the order of operations, let's dive into LOD functions, which are going to allow us to change levels of aggregation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">FIXED LOD calculations</h1>
                </header>
            
            <article>
                
<p><kbd>FIXED</kbd> is the first of three LOD calculations we will study in this chapter. It is used to make a calculation regardless of any dimension or measure filters that are applied in the workbook. <span>The syntax of <kbd>FIXED</kbd> is the following: </span><kbd>{FIXED [dim1[, dim2]…] : aggregate-expression}</kbd><span>, with </span><kbd>[dim1[, dim2]…]</kbd><span> a list of dimensions along which the aggregation is to be calculated. </span></p>
<div class="packt_infobox"><span>Please note the use of curly brackets. The syntax will be the same for all three LOD expressions we describe in this chapter.</span></div>
<p>For instance, let's look at the date of first order for a given customer. While a <kbd>MIN([Date])</kbd> calculation will give the first date <em>in the filtered dataset</em> with <strong>Customer Name</strong> used as a row or column, <kbd>{FIXED [Customer ID] :MIN([Date])}</kbd> will give the first date for a customer <em>in the entire dataset</em>, filters notwithstanding, for each <kbd>Customer ID</kbd>. As a result, if we look at orders in 2013 in the Global Superstore dataset, we notice that the <kbd>First Order Date</kbd> can be in 2011:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1198 image-border" src="assets/10c22e96-0244-42e5-8b47-39ca89ec2437.png" style="width:37.42em;height:18.25em;"/></p>
<p>Let's now take a look at how this will be affected by the order of operations.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Order of operations</h1>
                </header>
            
            <article>
                
<p>The place of this calculation in the order of operations is therefore the following:</p>
<ol>
<li>Extract/data source filters</li>
<li>Context filters</li>
<li>Sets, conditional, and top N Filters,<span> </span><kbd>FIXED</kbd><span> </span>LOD calculations</li>
<li>Dimension filters</li>
<li>Data blending</li>
<li>Measure filters</li>
<li>Totals</li>
<li>Table calculations</li>
</ol>
<p>Let's consider three examples to understand how to use this calculation.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 1 – lifetime sales value</h1>
                </header>
            
            <article>
                
<p>Using the Global Superstore dataset, we want to represent the lifetime sales value of our low-profit subcategories in 2013.</p>
<p>We define a new calculated field, <kbd>Lifetime Sales Value</kbd>, as <kbd>{FIXED [Subcategories] : SUM([Sales])}</kbd>. This will calculate the total sales by subcategory, regardless of any dimension filters set. Therefore, if we filter for orders placed in 2013 as a dimension filter, and compute <kbd>Profit Ratio</kbd> (defined as <kbd>SUM([Profit]) / SUM([Sales])</kbd>), <kbd>Sales</kbd>, and <kbd>Lifetime Sales Value</kbd>, we have the following:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1199 image-border" src="assets/154b0b59-5bac-46d8-8b5d-89054162cd48.png" style="width:44.25em;height:28.92em;"/></p>
<p>While the <span class="packt_screen">Tables</span> subcategory is not profitable in 2013, with sales of $202,364, it generated $757,042 in sales across the whole dataset.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 2 – contributions</h1>
                </header>
            
            <article>
                
<p><span>Using the </span>Global Superstore <span>dataset</span><span>, w</span>e want to see the contribution of units ordered by country in the LATAM market, against <span>both</span><span> </span><span>that region only and the whole company.</span></p>
<p>The list of dimensions in the <kbd>FIXED</kbd> syntax is optional. We can therefore define <kbd>Total Quantity</kbd> as <kbd>{FIXED:SUM([Quantity])}</kbd>. This will be the equivalent of having a quantity that is equal to the total units for each calculation. This will be a value that will never change regardless of the level of aggregation of our view.</p>
<p>We can then define <kbd>Worldwide Qty Contribution</kbd> as <kbd>SUM([Quantity]) / ATTR([Total Quantity])</kbd> (as <kbd>Total Quantity</kbd> needs no aggregation).</p>
<div class="packt_infobox">Here, we use <kbd>ATTR</kbd>, because otherwise we would get an error due to mixing aggregates and non-aggregates.</div>
<p>Showing <kbd>Quantity</kbd>, a window calculation for <span class="packt_screen">Percent of Total</span> for <kbd>Quantity</kbd> that we can call <kbd>Region Qty Contribution</kbd> (along <span class="packt_screen">Table (down)</span>) and the newly defined <kbd><span>Worldwide Qty</span> Contribution</kbd>, and filtering for market <span class="packt_screen">LATAM</span>, we get the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6a2f90c0-5ad7-454a-92d0-405707b176e7.png" style="width:33.00em;height:28.58em;"/></p>
<p>The results are different between the last two columns here because the table calculation only considers data in LATAM (because it comes after dimension filters in the order of operations), while the LOD calculation considers the entire dataset.</p>
<p>If we want to go a level further, we can make this a map view: remove the first two measures to keep only <kbd>Worldwide Qty Contribution</kbd>, click on <span class="packt_screen">Show Me</span> &gt; <span class="packt_screen">Maps</span>, and finally choose the <span class="packt_screen">Analysis</span> &gt; <span class="packt_screen">Show Mark Labels</span> options:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7d7aebde-4933-44fa-940f-2b978ec83bdd.png" style="width:40.17em;height:26.25em;"/></p>
<p>If we further filter the countries, we will still see their contribution to the worldwide market, contrary to a table calculation, which will consider only the filtered dataset.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 3 – cohorts</h1>
                </header>
            
            <article>
                
<p><span>Using the </span>Global Superstore <span>dataset, w</span>e want to see how many sales were generated in 2012 for customers (<kbd>Customer ID</kbd>) making their first purchase (<kbd>Order Date</kbd>) in that year. This is what is usually called a <strong>cohort analysis</strong>, and is often seen in the exam.</p>
<p class="CDPAlignLeft CDPAlign">For each customer, we first have to define their earliest date of purchase. To do so, we create a calculated <kbd>First Order Date</kbd> <span>field </span>as <kbd>{FIXED [Customer ID] : MIN([Order Date])}</kbd>. This will take the earliest <kbd>Order Date</kbd> in the entire dataset for each <kbd>Customer ID</kbd>.</p>
<p>We can then create a visualization with <kbd>Year([Order Date])</kbd> as columns, <kbd>Year([First Order Date])</kbd> as rows, and <kbd>SUM([Sales])</kbd> as measures. This gives the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/72c7aad7-b21c-4e55-b893-19c75da124c4.png" style="width:34.42em;height:21.42em;"/></p>
<p>Customers making their first order in 2012 have therefore spent $128,828 in that year.</p>
<p>To summarize, we use the <kbd>FIXED</kbd> LOD<span> to make a calculation regardless of any dimension or measure filters that are applied in the workbook, which is helpful for contributions, cohorts, or any calculation that has to take the entire dataset into account. Let's carry on with the second LOD calculation.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">INCLUDE LOD calculations</h1>
                </header>
            
            <article>
                
<p>The <kbd>INCLUDE</kbd> LOD calculation is used to add a layer of aggregation that will not be used as part of the dimensions. For instance, you might want to see the average customer's lifetime value in different markets. Under normal circumstances, you would need to first aggregate at customer level, and then use the results of that aggregation to compute an average. In the SQL world, we would use a subquery. Simply averaging all sales will not yield the same results, as it will be computed at the line item level and will therefore give the average value of a line item.</p>
<p>We can understand this by saying that we want to aggregate at a level that includes both the dimensions already in the view and another set of additional dimensions. This means that we have data that is more granular than what will be shown in the view, and therefore that we will need to further aggregate the results of that calculation to show them in the view. While the results of a <kbd>FIXED</kbd> calculation don't need to be aggregated, the results of an <kbd>INCLUDE</kbd> statement do.</p>
<p>As a reminder, the syntax is similar to <kbd>FIXED</kbd> statements: <kbd>{INCLUDE [dim1[, dim 2]…] : aggregate-expression}</kbd>. While the dimensions are technically optional parameters, there is no gain in using an <kbd>INCLUDE</kbd> function in that case, it is just computing the usual aggregation with no added granularity.</p>
<p>As for <kbd>FIXED</kbd>, it's important to see where this sits in the order of operations to optimize its use, before we carry on with examples.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Order of operations</h1>
                </header>
            
            <article>
                
<p>This particular LOD function, as well as the<span> </span><kbd>EXCLUDE</kbd><span> </span>LOD calculation that will shortly follow, comes between data blending and measure filters. They are thus computed later than the<span> </span><kbd>FIXED</kbd><span> </span>calculation:</p>
<ol>
<li>Extract/data source filters</li>
<li>Context filters</li>
<li>Sets, conditional, and top N filters,<span> </span><kbd>FIXED</kbd><span> </span>LOD calculations</li>
<li>Dimension filters</li>
<li>Data blending</li>
<li><kbd>INCLUDE</kbd><span> </span>and<em> </em><kbd>EXCLUDE</kbd><span> </span>LOD calculations</li>
<li>Measure filters</li>
<li>Totals</li>
<li>Table calculations</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 1 – average customer lifetime value</h1>
                </header>
            
            <article>
                
<p>Using the Global Superstore dataset, for the <span class="packt_screen">Technology</span> category, we want to see the average lifetime sales value of customers, split by <kbd>Segment</kbd> and <kbd>Market</kbd>.</p>
<p>If we just calculate a straight <kbd>AVG([Sales])</kbd>, we get the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/872d070a-456b-4720-8baf-1140ad17d7ed.png" style="width:32.08em;height:23.50em;"/></p>
<p>However, that is representing the average sales to customers <em>at the line item level</em>, not the lifetime value. If customer A has two orders for $100 and $200 and customer B has a sale for $300, the average sale is $200, but the average lifetime sales value is $300, as both customers have a lifetime value of $300. Here, we need to first compute the sales at customer level, and then average the results.</p>
<p>The dimension we're missing in the view is <kbd>Customer Name</kbd>. We will therefore create an <kbd>INCLUDE</kbd> statement as <kbd>{INCLUDE [Customer Name]:SUM([Sales])}</kbd>, which will create an intermediary calculation at customer level. The results of that calculation can then be aggregated using an <kbd>AVG</kbd> to yield the correct results:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7a8a4b55-dbc1-4a6a-b9a7-3fdc930aefd8.png" style="width:34.75em;height:24.92em;"/></p>
<div class="CDPAlignLeft CDPAlign packt_infobox">It is worth noting that if we are always going to average the lifetime sales value of a customer, we can enclose the <kbd>INCLUDE</kbd> statement in an <kbd>AVG</kbd> inside the <strong>Calculated field</strong>, and Tableau will recognize how to aggregate this without needing to specify it every time: <kbd>AVG({INCLUDE [Customer Name]:SUM([Sales])})</kbd>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 2 – median of average days to ship by customer</h1>
                </header>
            
            <article>
                
<p>The Global Superstore company is worried that some orders are being shipped late, and about the impact it might have on its customers. Let's look at <kbd>Average Days to Ship</kbd> by <kbd>Customer Name</kbd> for late orders.</p>
<div class="packt_infobox">If not already defined in the workbook, <kbd>Average Days to Ship</kbd> is calculated as <kbd>DATEDIFF('day',[Order Date],[Ship Date])</kbd>, and <kbd>Ship Status</kbd> as <kbd>IF [Days to Ship (Actual)] &gt; [Days to Ship (Scheduled)] THEN "Shipped Late"</kbd><br/>
<kbd>ELSEIF [Days to Ship (Actual)] = [Days to Ship (Scheduled)] THEN "Shipped On Time"</kbd><br/>
<kbd>ELSE "Shipped Early" END</kbd>.</div>
<p>As seen in previous chapters, we can create a quick distribution plot by <kbd>Segment</kbd> and <kbd>Market</kbd>, using <kbd>Customer Name</kbd> as a <span class="packt_screen">Detail</span> mark to see each individual customer, filtering for orders where <kbd>Ship Status</kbd> is <span class="packt_screen">Shipped Late</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e35f5ab8-6e3d-4002-b648-87b9faf55ecf.png"/></p>
<p>While it is sometimes worthwhile to see each customer, a top-line number for each quadrant can be a good indicator of performance. Let's choose the median as one such indicator. We now need to remove <kbd>Customer Name</kbd> as a dimension, but still keep it in the calculation to find the median.</p>
<p>Here, we can define <kbd>MEDIAN({INCLUDE [Customer Name] : AVG([Days to Ship (Actual)])})</kbd>.</p>
<p>Let's deconstruct this, starting from the right. Look at average days to ship. The view includes <strong>Segment</strong> and <strong>Region</strong>, so the aggregation would normally be performed at that level. However, we want to calculate this at customer level, so we create the <kbd>INCLUDE</kbd> statement, specifying that we want to add <kbd>Customer Name</kbd> to the list of dimensions even though it is not part of our view. Having results that are now too granular to be shown in the view, we choose to finally aggregate by taking the median of those results. If we create a quick view of that measure by <kbd>Segment</kbd> and <kbd>Market</kbd>, using the <span class="packt_screen">Measure Values</span> as <span class="packt_screen">Color</span> and the <span class="packt_screen">Analysis &gt; Show Mark Labels</span> option, we get the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/65b4f7db-4d7d-440b-9fdf-168abced73be.png" style="width:41.92em;height:31.25em;"/></p>
<p>To summarize, we can use the <kbd>INCLUDE</kbd> LOD to first aggregate a level that is higher than the view, including some dimensions that are not present in it, that we can then aggregate back to the view level. This is useful when trying to extract and summarize order-level data from a dataset of item-level data. Let's study one last LOD calculation before closing off this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">EXCLUDE LOD calculations</h1>
                </header>
            
            <article>
                
<p class="mce-root">While <kbd>INCLUDE</kbd> LOD calculations enabled us to calculate along the view dimensions and the further dimensions specified, <kbd>EXCLUDE</kbd> LOD calculations enable users to make calculations omitting one of the dimensions that have been used in the view. For instance, we can use <kbd>EXCLUDE</kbd> to calculate the total sum of profits for one category across regions, even if <kbd>Region</kbd> is used as a row. This is especially useful when dealing with contributions to a total.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 1 – contribution to total</h1>
                </header>
            
            <article>
                
<p><span>Using the </span>Global Superstore d<span>ataset, </span>we want to show contributions to total profit for the South region of the EU market, slicing by country, category, and subcategory. What is the contribution of the <strong>Fasteners</strong> <span>subcategory </span>in <strong>Italy</strong> to the overall Fasteners business in the South?</p>
<p>We can first plot profit by <kbd>Country</kbd> and <kbd>Sub-category</kbd> in the South, adding totals:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a6d928b5-cfb4-4dd5-8dd8-5a06c88c2132.png" style="width:42.17em;height:36.67em;"/></p>
<p>In the case of <strong>Fasteners</strong> in Italy, we want to see that it represents $578/$898 = 64% of the profit.</p>
<p>We have two ways of calculating that contribution. We can add a quick table calculation for <span class="packt_screen">Percent of Total</span> for <kbd>SUM(Profit)</kbd>, with computation along <span class="packt_screen">Table (across)</span>.</p>
<p>We can also use an LOD, calculating the overall profit for a subcategory as <kbd>{EXCLUDE [Country]: Sum([Profit])}</kbd>, which will remove the dependency on <kbd>Country</kbd>, but not on <kbd>Sub-category</kbd>. As a result, we can further define <kbd>SUM([Profit]) / ATTR({EXCLUDE [Country]: Sum([Profit])})</kbd> as the contribution of one country to the overall region:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/991a2016-c825-4728-80e8-2f624602d43f.png"/></p>
<p>As expected, both calculations yield the same results. We can also roll up to category or drill down to product name without having to redefine the field. Regardless of how we slice the data, we will always show contributions to the overall region.</p>
<p class="CDPAlignLeft CDPAlign">The only difference between those two calculations resides in the order of operations. While <kbd>EXCLUDE</kbd> LOD calculations come before measure filters, table calculations come after. As a result, if we filter on measures, the table calculations will reflect only the values in the table, while the <kbd>EXCLUDE</kbd> LOD calculation will continue to show the same results.</p>
<p class="CDPAlignLeft CDPAlign">For instance, if we filter on <kbd>SUM(Profit)</kbd> to show only profitable quadrants (that is, <kbd>SUM(Profit) &gt; 0</kbd>), we get the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/57d97620-ce5a-4045-a37e-7357c394573c.png" style="width:48.50em;height:36.75em;"/></p>
<p>We can see that the <kbd>EXCLUDE</kbd> LOD calculations have not changed, while <kbd>Table Calc</kbd> now reflects only the data shown on the screen.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Example 2 – difference in average profit</h1>
                </header>
            
            <article>
                
<p><span>Using the</span> Global Superstore da<span>taset, f</span>or profitable orders, we want to know the difference between the average profit per line by category and market, compared to the average for the entire category. For example, what is the difference between the average profit for Office Supplies orders in Africa and the average profit for any order in Africa?</p>
<p>We can first define <kbd>Order Profitable?</kbd> as <kbd>IF {FIXED [Order ID]:SUM([Profit])} &gt; 0 THEN 'Profitable' ELSE 'Not Profitable' END</kbd>, which will calculate the overall profit for each Order ID and make for a quick filter.</p>
<p>We can then plot the average <kbd>Profit</kbd>, slicing by <kbd>Category</kbd> and <kbd>Market</kbd>, filtering for profitable orders, turning on <span class="packt_screen">Grand Total</span> for rows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cdc7f423-6cfb-48fb-a89a-24d072aeb8dd.png" style="width:42.83em;height:27.58em;"/></p>
<p>In this case, we want to compare the $25 average profit in Office Supplies to the $50 average profit for orders in Africa.</p>
<p>Thus, we can define <kbd>{Exclude [Category]: AVG([Profit])}</kbd> as the average profit omitting the <kbd>Category</kbd> dimension (which is equal in this view to the <strong>Grand Total</strong> for a given market), and a further calculation for <kbd>AVG([Profit]) - ATTR({EXCLUDE [Category]: AVG([Profit])})</kbd> will show us the required difference:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/80fdf08e-eea3-4829-9f64-b2e8524a7193.png"/></p>
<p>In this case, we can see that orders for Office Supplies in Africa are $25 less profitable than the average order line in this market. Again, we can change the dimensions without having to change the definition of our field, <span>for instance by </span><kbd>Segment</kbd>, as long as we keep slicing by <kbd>Category</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/97b876a7-ee7e-4a47-ba10-6ddcb62143c5.png" style="width:44.67em;height:31.33em;"/></p>
<p>However, if we were to remove <strong>Category</strong> altogether, this calculation would be no different to a simple <kbd>AVG([Profit])</kbd>, and would lose its value.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Data source constraints for LOD</h1>
                </header>
            
            <article>
                
<p>While LOD calculations are in general supported in Tableau, there are a few constraints on certain data source types. At the time of writing, here are the most notable exceptions to the rule:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr style="height: 64px">
<td style="width: 55.0509%">
<p><strong>Data source</strong></p>
</td>
<td style="width: 44.3381%">
<p><strong>Support</strong></p>
</td>
</tr>
<tr style="height: 96px">
<td style="width: 55.0509%">
<p>Google Big Query</p>
</td>
<td style="width: 44.3381%">
<p>Supported for standard SQL, not supported for legacy SQL</p>
</td>
</tr>
<tr style="height: 64px">
<td style="width: 55.0509%">
<p>Microsoft Access</p>
</td>
<td style="width: 44.3381%">
<p>Not supported</p>
</td>
</tr>
<tr style="height: 90.7813px">
<td style="width: 55.0509%">
<p>Microsoft Jet-based connections (legacy connectors for Microsoft Excel, Microsoft Access, and text)</p>
</td>
<td style="width: 44.3381%">
<p>Not supported</p>
</td>
</tr>
<tr style="height: 64px">
<td style="width: 55.0509%">
<p>Microsoft SQL Server</p>
</td>
<td style="width: 44.3381%">
<p>SQL Server 2005 and later</p>
</td>
</tr>
<tr style="height: 64px">
<td style="width: 55.0509%">
<p>Mongo DB</p>
</td>
<td style="width: 44.3381%">
<p>Not supported</p>
</td>
</tr>
<tr style="height: 64px">
<td style="width: 55.0509%">
<p>Oracle</p>
</td>
<td style="width: 44.3381%">
<p>Supported version 9i and later</p>
</td>
</tr>
<tr style="height: 64px">
<td style="width: 55.0509%">
<p>PostgreSQL</p>
</td>
<td style="width: 44.3381%">
<p>Supported version 7 and later</p>
</td>
</tr>
</tbody>
</table>
<p class="mce-root"/>
<p class="mce-root"><span>A complete and up-to-date version of this list can be found at </span><a href="https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm">https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm</a>.<a href="https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we covered the three types of LOD expressions available in Tableau (<kbd>FIXED</kbd>, <kbd>INCLUDE</kbd>, and <kbd>EXCLUDE</kbd>) and studied how we can use them to aggregate data at a level that is either more granular (in the case of <kbd>INCLUDE</kbd><span>) or less granular than the dimensions already in the view. We also looked at the order of operations to explain the differences between these calculations and the ones seen previously (such as table calculations).</span> <span>For instance, we now hold the tools to calculate contributions to a total, create cohorts based on first order date, and aggregate customer-level information starting from item-level data.</span></p>
<p>Here is a quick reminder:</p>
<table style="border-collapse: collapse;width: 100%" border="1">
<tbody>
<tr>
<td/>
<td><strong>FIXED</strong></td>
<td><strong>INCLUDE</strong></td>
<td><strong>EXCLUDE</strong></td>
</tr>
<tr>
<td>Order of operations</td>
<td>Before dimension filters</td>
<td>After dimension filters</td>
<td>After dimension filters</td>
</tr>
<tr>
<td>Purpose</td>
<td>Calculate across the dataset along selected dimensions</td>
<td>Calculate results using a dimension that is not part of the view</td>
<td>
<p class="mce-root">Calculate results excluding one of the dimensions that is part of the view</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>This chapter closes a three-chapter journey into the different calculations that we can use in Tableau, and we are now ready to use some of the analytical tools to add some insights to our worksheets. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p>Answer the following questions to test your knowledge of the information in this chapter. </p>
<p>Q: If I'm not using any dimension filters, is there a difference between using a <span class="packt_screen">Percent of Total</span> table calculation and using <kbd>FIXED</kbd>/<kbd>EXCLUDE</kbd> calculations?</p>
<p>A: While they will, in general, yield the same results, there a few exceptions that we have discussed in this chapter, and the main reason for the differences is the order of operations. <kbd>FIXED</kbd> calculations will remain unchanged by dimension and measure filters, <kbd>EXCLUDE</kbd> calculations will remain unchanged by measure filters (but not by dimension filters), and table calculations will be affected by both dimension and measure filters.</p>
<p>Q: Do LOD calculations have to use fields that are already included in the view? Can LOD calculations aggregate at a different level than the one determined by the fields chosen in the view?</p>
<p>A: As seen in the example of <kbd>INCLUDE</kbd> calculations, LOD calculations can be used to aggregate on fields that are not present in the view.</p>
<p>Q: Do LOD calculations always yield measures?</p>
<p>A: Not necessarily. In the example of cohorts in the second part of this chapter, we can use a <kbd>FIXED</kbd> LOD calculation to create a first purchase date, which will be treated as a dimension.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>You can check out the following links for more information about the topics that were covered in this chapter:</p>
<ul>
<li><em>Top 15 Tableau LOD Expressions</em>: <a href="https://www.tableau.com/about/blog/LOD-expressions">https://www.tableau.com/about/blog/LOD-expressions</a></li>
<li><em>Data Source Constraints for Level of Detail Expressions</em>: <a href="https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm">https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_constraints.htm</a></li>
<li><em>Which calculation is right for your analysis: simple, table, or LOD?</em> <a href="https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_understand_which.htm">https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_understand_which.htm</a></li>
</ul>


            </article>

            
        </section>
    </body></html>