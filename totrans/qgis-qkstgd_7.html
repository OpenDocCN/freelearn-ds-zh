<html><head></head><body>
        

                            
                    <h1 class="header-title">Expanding QGIS 3</h1>
                
            
            
                
<p>In this final chapter, we will look at expanding QGIS. We will look at combining tools into a model using the model builder. This effectively allows us to build our own reusable model, using parameters we either hardcode in or leave to the user to adjust. We will look at the ever-increasing range of plugins, before finally taking a brief look at the Python command line, where we can create scripts in the future as confidence grows with QGIS.</p>
<p>These are the topics covered in this chapter:</p>
<ul>
<li>Model builder</li>
<li>Plugins</li>
<li>Python command line</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Model builder</h1>
                
            
            
                
<p>You may recall that in the <a href="6cd8f808-67bd-4788-8e7a-ccd3ce12a11d.xhtml">Chapter 6</a>, <em>Spatial Processing</em> we ran several tools to utilize the zonal histogram answer to the distribution of terrains (<kbd>Landcover</kbd>) in a buffered pipeline corridor. Open a new QGIS project and load in the <kbd>Pipeline</kbd> layer and the <kbd>Landcover</kbd>.</p>
<p class="mce-root"/>
<p>To create a model, go to Processing | Graphical Modeler to open the modeler, where we can select from different Inputs and Algorithms for our model. Graphical Modeler is shown in the following screenshot:</p>
<div><img src="img/5cc0a689-e513-4988-9565-9f11659ea914.png"/></div>
<p>The Graphical Modeler</p>
<p class="mce-root"/>
<p>Select the Inputs tab and choose Vector Layer. Add a new parameter called <kbd>Pipeline</kbd> and set Geometry type to Line; this is shown in the following screenshot:</p>
<div><img src="img/6bd57ef8-e2be-480f-abeb-ed1858b71cf8.png"/></div>
<p>Creating a Pipeline attribute as a Geometry typeâ€”Line</p>
<p>Click on OK. Now, add Raster Layer and call it <kbd>Landcover</kbd>. In the Algorithms tab, we can use the filter at the top to narrow down our search for the correct algorithm. Search for <kbd>buffer</kbd> and double-click to open the algorithm. Fill in Distance as <kbd>15000</kbd> and check the box to make sure the layer is dissolved.</p>
<p class="mce-root"/>
<p>Now, search for and open the Zonal histogram tool and change the prefix to <kbd>Terrain_</kbd>. This is our final output so tell the model it is the final result. The final output is what is returned to the user once the model has been successfully run. The inputs should look like the following dialog box:</p>
<div><img src="img/6d2a6fa6-7ea6-4bca-b182-d24ffc0b69ff.png"/></div>
<p>Zonal histogram tool</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p class="mceNonEditable"/>
<p>Click on OK. To finish the model, we need to enter a model Name (<kbd>Pipeline_impact_terrain</kbd>) and a Group name (<kbd>QuickStart_QGIS</kbd>). Processing will use the Group name to organize all the models that we create into different toolbox groups. The model is now complete. The finished model will look like this:</p>
<div><img src="img/80bf9e3a-9161-49d0-ad73-c56161178457.png"/></div>
<p>The Graphical Modeler with the model displayed</p>
<p>Click the save icon and save as <kbd>terrain_stats.model3</kbd>. Click on the green triangle or press <em>F5</em> to run the model. A dialog box should appear as follows:</p>
<div><img src="img/45aceba5-6655-4259-b05f-d6d4643e95cf.png" style=""/></div>
<p>The model represented as a tool</p>
<p>Click on Run to execute the model. The pipeline output will appear in the QGIS map window. After closing the modeler, we can run the saved models from the toolbox like any other tool. Look in Processing Toolbox under Models. This newly created model will appear there, as shown in the following screenshot. It is even possible to use one model as a building block for another model:</p>
<div><img src="img/c14ff5a8-243f-49e0-b087-51465a8b43c4.png" style=""/></div>
<p>Model appears in the Processing Toolbox under Models</p>
<p>Another useful feature is that we can specify a layer style that needs to be automatically applied to the processing results. This default style can be set by right-clicking and selecting Edit, rendering styles for outputs in the context menu of the created model in the toolbox. This means that you can automate building maps if you wish.</p>
<p>You can share your models by giving the <kbd>.model3</kbd> file to others. This is the first step in expanding the use of QGIS. Save your project.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Plugins in QGIS</h1>
                
            
            
                
<p>We briefly touched on plugins in <a href="2481b8d1-b60c-4839-bb1c-c8654cd792b2.xhtml">Chapter 5</a>, <em>Creating Maps</em>. We used qgis2web to convert our Alaska map into a web map. The top plugins by download are listed here: <a href="https://plugins.qgis.org/plugins/popular/">https://plugins.qgis.org/plugins/popular/</a>. You can use this page to search for plugins or look at tags to view the different plugins and their capabilities.</p>
<p>Plugins are accessed via the Plugins menu. Some plugins are experimental. By experimental, we mean they could be unstable or in the early stages of development, but it is worth turning these on in case a plugin is available that might help your workflows; just use them with caution. From the Plugins dialog, choose Settings and check the box next to Show also experimental plugins:</p>
<div><img src="img/c1d4dcd8-92cb-4d88-89b1-15ad4e24a450.png"/></div>
<p>Plugin settings</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Semi-Automatic Classification Plugin</h1>
                
            
            
                
<p>The <strong>Semi-Automatic Classification Plugin</strong> (<strong>SCP</strong>) for QGIS allows for the supervised classification of remote sensing images, providing tools for the downloading, preprocessing, and postprocessing of satellite images (<a href="https://plugins.qgis.org/plugins/SemiAutomaticClassificationPlugin/">https://plugins.qgis.org/plugins/SemiAutomaticClassificationPlugin/)</a>. It is an amazingly powerful tool that significantly extends Remote Sensing functionality into QGIS.</p>
<p>In this example, we will use the SCP to download a <kbd>Sentinel-2</kbd> image that covers the part of Alaska that we digitized: Fire Island. At this point, please make sure you have an account with the <strong>Copernicus Open Data Hub</strong>. You can do this at: <a href="https://scihub.copernicus.eu/dhus/#/self-registration">https://scihub.copernicus.eu/dhus/#/self-registration</a>.</p>
<p>Open a new QGIS project and add the <kbd>OpenStreeMap</kbd> data from <kbd>XYZ Tiles</kbd> in the Browser panel, and then add the <kbd>Island_Outline</kbd> layer from the <kbd>Fire_Island</kbd> GeoPackage that we created in <a href="0e2ba9ae-3346-4444-b28a-389d22737646.xhtml">Chapter 3</a>, <em>Creating Data</em>. Make sure that the map project in the status bar is set to EPSG 3857.</p>
<p>To install the SCP, select Plugins | Manage and Install Plugins. Click on the All tab, search for SCP, and click on Install plugin. Two new toolbars and one new panel will appear. In this example, we will look only at the SCP working toolbar, as shown as follows:</p>
<div><img src="img/e824f2a9-8f5c-439e-ac9c-d3160e0b2ddf.png"/></div>
<p>SCP Working Toolbar</p>
<p>Click on the button on the far left of this toolbar; this will open a dialog box, shown in the following screenshot:</p>
<div><img src="img/1312f6e9-1cae-42a0-ba8b-1819896cd3e8.png"/></div>
<p>Semi-Automatic Classification Plugin dialog box</p>
<p>Assuming that you have an account set up with the Copernicus Open Data Hub, then click on the Download products menu and select the Login data tab. Here, enter your username and password. Next, select the Search tab and select <kbd>Sentinel-2</kbd> from Products list, set the date range to November 01, 2018, to December 01, 2018, and the cloud cover to 25%, as shown in the following screenshot:</p>
<div><img src="img/890cd41c-c821-4c9e-9ecc-2e8f6f68bc53.png"/></div>
<p>Setting the Search parameters</p>
<p>To define the area we are searching, click on the button with plus sign with an orange background, minimize the window, and return to the main QGIS screen. Left-click to get the <strong>Upper Left</strong> (<strong>UL</strong>) and right-click to get the <strong>Lower Right</strong> (<strong>LR</strong>). You should get a box drawn on your map as follows:</p>
<div><img src="img/a5a67d9c-ea0c-4cee-acb3-eb8ffda41f93.png"/></div>
<p>An overview of defining the search area</p>
<p>Go to the plugin (you can click the plugin button as before, or just maximize the SCP plugin window). If you are happy with Search parameters, click on the button next to Find. The results will be returned in Product list. You can click each one to find the best image. This is shown in the following screenshot:</p>
<div><img src="img/1711546a-fb37-4952-ae38-94d5adadeec1.png"/></div>
<p>Selecting an image</p>
<p class="mce-root"/>
<p>If you uncheck the Only if preview in Layers option, at this point you could click on Run (bottom-right-hand corner). That will go ahead and download a large amount of data and preprocess it (correct for atmospheric effects). In this example, to save on download size, select Download options and choose only band 2, 3, and 4 and the ancillary data. This will allow us to create a true color satellite image. I have also turned off the Preprocess images options to simplify this walk-through. These options are shown in the following screenshot:</p>
<div><img src="img/e0d48a71-2883-4161-9490-12887d4cb166.png"/></div>
<p>Specify the download options</p>
<p>Back in the Search tab, I have turned on the Only if preview in Layers option and clicked on the Display preview of highlighted images in map button. This has added my selected product to my map. This is shown in the following screenshot:</p>
<div><img src="img/aa2d92ca-eaad-48b9-8f33-ecd6fb7b4e9e.png"/></div>
<p>Displaying a preview in the layers via the dialog box</p>
<p>Finally, click on the RUN button, select the folder you wish to save the data in, and let the data download. When finished, you should have your <kbd>Sentinel-2</kbd> images loaded as layers in QGIS. There is significantly more functionality in this plugin than covered here. If you are interested in exploring the available functionality further, including classification of satellite data with QGIS, then please visit <a href="https://fromgistors.blogspot.com/p/semi-automatic-classification-plugin.html">https://fromgistors.blogspot.com/p/semi-automatic-classification-plugin.html</a> for extensive documentation, videos, and guides.</p>
<p>The satellite data should be loaded into QGIS. Using Raster Toolbar, stretch one of the bands until you can see it (sometimes images are loaded dark, especially if there is a large amount of sea in them). Your screen should look as follows:</p>
<div><img src="img/d6f51586-4bd3-4e7b-9727-51c23a2b05b7.png"/></div>
<p>Downloaded satellite image appears in QGIS</p>
<p>There are many more plugins available; use Plugin Manager to search for and explore new tools to work with.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using the Python command line</h1>
                
            
            
                
<p>From the Plugins toolbar, select the Python Console button, or press <em>Ctrl</em> + <em>Alt</em> + <em>P</em>, or select Python Console from the Plugins menu.</p>
<p>Python has become the programming language of choice for GIS. In this book, we will just look at the basics of the QGIS API. As you become more advanced, you can use Python to develop your own plugins and custom scripts. Eventually, you could use the QGIS Python library (PyQGIS), external to QGIS, to build applications.</p>
<p>Open a new empty QGIS project.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Loading a layer</h1>
                
            
            
                
<p>To load a vector layer, we use the <kbd>addVectorLayer()</kbd> function of <kbd>iface</kbd>. The <kbd>iface</kbd> class is used to access the graphical part of the QGIS interface. In the following example, I am adding <kbd>airport.shp</kbd> to the map. This is shown in one line of code, as follows:</p>
<pre>Airport_layer = iface.addVectorLayer('D:/QGIS_quickstart/qgis_sample_data/shapefiles/airports.shp','airports','ogr')</pre>
<p>Press the <em>Enter</em> key and the <kbd>airports</kbd> layer is now loaded (change the path to your Shapefile):</p>
<div><img src="img/416c361d-04a1-4981-8718-709c6bd74a55.png"/></div>
<p>The airports Shapefile loaded into the QGIS map</p>
<p>Add another layer:</p>
<pre>Alaska_layer = iface.addVectorLayer('D:/QGIS_quickstart/qgis_sample_data/shapefiles/alaska.shp','alaska','ogr')</pre>
<p>We now have the <kbd>alaska</kbd> boundary and the <kbd>airports</kbd> layer added to the map.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Inspecting the layer</h1>
                
            
            
                
<p>We can look at each layer by accessing some of the properties. To get the name of the layer, use the <kbd>.name()</kbd> function:</p>
<pre><strong>Airport_layer.name()</strong></pre>
<p>The output is as follows:</p>
<pre><strong>'airports'</strong></pre>
<p>To count the number of records in the layer, use the <kbd>featureCount()</kbd> function:</p>
<pre><strong>Airport_layer.featureCount()</strong></pre>
<p>The output is as follows:</p>
<pre><strong>76</strong></pre>
<p>To print the attributes for all these <kbd>76</kbd> layers, use a <kbd>for</kbd> loop:</p>
<pre>airportFeatures = Airport_layer.getFeatures()<br/>for feature in airportFeatures:<br/>    print (feature.attributes()</pre>
<p>Remember to use the indentation. The result will look similar to this:</p>
<div><img src="img/b52990bf-9ff0-40da-bb5e-400304fc916c.png"/></div>
<p>The QGIS Python Console printing out the attribute table</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Scripts</h1>
                
            
            
                
<p>The command line can get confusing. It is better to build scripts and test on the command line. Let's convert these command-line calls into a Python script. Close this project and open a new QGIS project. Open the Python Console. </p>
<p>Click on the Show Editor button to open a scripting window. This is shown in the following screenshot:</p>
<div><img src="img/589671a7-84fe-4b2b-87db-01b5637c6820.png" style=""/></div>
<p>The Python Console</p>
<p>Copy the following code into the script editor:</p>
<pre>Airport_layer = iface.addVectorLayer('D:/QGIS_quickstart/qgis_sample_data/shapefiles/airports.shp','airports','ogr')<br/><br/>Alaska_layer = iface.addVectorLayer('D:/QGIS_quickstart/qgis_sample_data/shapefiles/alaska.shp','alaska','ogr')<br/><br/>print (Airport_layer.name())

print (Airport_layer.featureCount())<br/><br/>## print the attribute table<br/><br/>airportFeatures = Airport_layer.getFeatures()<br/><br/>for feature in airportFeatures:<br/>    print (feature.attributes())</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>Or, alternatively, you can download data from <a href="https://github.com/PacktPublishing/QGIS-Quick-Start-Guide/blob/master/Chapter_07/01_Loading_Data.py">https://github.com/PacktPublishing/QGIS-Quick-Start-Guide/blob/master/Chapter07/01_Loading_Data.py</a>. Be sure to re point to your data location. Click on the Save As button in the editor to save the file to your project as <kbd>01_Loading_data.py</kbd>. Then, click Run (the green triangle). The result should look like the following screenshot:</p>
<div><img src="img/b8402042-f526-459c-a64a-da0e82e9bef0.png"/></div>
<p>The script in the Python Console</p>
<p>To learn more about the vector class, have a look at the documentation here: <a href="https://qgis.org/api/classQgsVectorLayer.html">https://qgis.org/api/classQgsVectorLayer.html</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Loading raster data</h1>
                
            
            
                
<p>Let's build another script to load raster data. Copy the following code:</p>
<pre>Hillshade_layer = iface.addRasterLayer('D:/QGIS_quickstart/qgis_sample_data/raster/SR_50M_alaska_nad.tif','Hillshade')<br/><br/>Landcover_layer = iface.addRasterLayer('D:/QGIS_quickstart/qgis_sample_data/raster/landcover.img','Landcover')<br/><br/>## print the layer names<br/><br/>print (Hillshade_layer.name())<br/><br/>print (Landcover_layer.name())<br/><br/>## print the image dimensions<br/><br/>print (Hillshade_layer.width(), Hillshade_layer.height())<br/><br/>print (Landcover_layer.width(), Landcover_layer.height())</pre>
<p>The code in this script is loading in two layers, <kbd>Hillshade</kbd> and <kbd>Landcover</kbd>, printing the names to the console, and printing the image dimensions.</p>
<p>You can download data from here: <a href="https://github.com/PacktPublishing/QGIS-Quick-Start-Guide/blob/master/Chapter_07/02_Loading_data_raster.py">https://github.com/PacktPublishing/QGIS-Quick-Start-Guide/blob/master/Chapter07/02_Loading_data_raster.py</a>. Be sure to repoint to your data location if different to the script. Click on the Save As button in the editor to save the file to your project as <kbd>02_Loading_data_raster.py</kbd>. Then, click Run (the green triangle). The result should look like the following screenshot:</p>
<div><img src="img/611d78a4-b338-4d5e-907d-c65daf4e1633.png"/></div>
<p>The script in the Python Console</p>
<p>To explore more about the <kbd>Raster</kbd> class, have a look at the documentation here: <a href="https://qgis.org/api/classQgsRasterLayer.html">https://qgis.org/api/classQgsRasterLayer.html</a>.<a href="https://qgis.org/api/classQgsRasterLayer.html"/></p>
<p>We can write scripts to automate many processes in QGIS from rendering, map creation, and processing. In fact, all parts of this book could be automated. Let's finish this section on Python and scripting with one last spatial processing script. This time, we will buffer the <kbd>airports</kbd> layers.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Buffer script</h1>
                
            
            
                
<p>Open a new project in QGIS. Copy the following code to the editor:</p>
<pre>## Buffering<br/><br/>Airport_layer = iface.addVectorLayer('D:/QGIS_quickstart/qgis_sample_data/shapefiles/airports.shp','airports','ogr')<br/><br/>param = { 'INPUT' : Airport_layer, 'DISTANCE' : 15000, 'SEGMENTS' : 5, 'END_CAP_STYLE' : 0, 'JOIN_STYLE' : 0, 'MITER_LIMIT' : 2, 'DISSOLVE' : False, 'OUTPUT' : 'memory:' }<br/><br/>algoOutput = processing.run("qgis:buffer", param)<br/><br/>Airport_buffer = QgsProject.instance().addMapLayer(algoOutput['OUTPUT'])</pre>
<p>The code in this script loads the <kbd>airports</kbd> layer, sets the buffering parameters (<kbd>param</kbd>), calls the <kbd>qgis</kbd> buffer with the <kbd>processing.run</kbd> command, and then adds a layer called <kbd>OUTPUT</kbd> to the map.</p>
<p>You can download data from here: <a href="https://github.com/PacktPublishing/QGIS-Quick-Start-Guide/blob/master/Chapter_07/03_Buffer_Airport.py">https://github.com/PacktPublishing/QGIS-Quick-Start-Guide/blob/master/Chapter07/03_Buffer_Airport.py</a>. Be sure to repoint to your data location. Save the file to your project as <kbd>03_Buffer_airport.py</kbd>. Then, click Run (the green triangle). The result should look like the following screenshot:</p>
<p class="mce-root"/>
<p class="mce-root"/>
<div><img src="img/11ff0a02-32cc-44f4-b318-dac8a92db02b.png"/></div>
<p>The script in the Python Console</p>
<div><p>If you wish to learn more about programming with Python in QGIS, this is a good resource with plenty of script examples: <a href="https://docs.qgis.org/testing/pdf/en/QGIS-testing-PyQGISDeveloperCookbook-en.pdf">https://docs.qgis.org/testing/pdf/en/QGIS-testing-PyQGISDeveloperCookbook-en.pdf</a>.</p>
</div>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this final chapter, we have looked at extending QGIS. We looked at three options: building models using the model builder, accessing plugins, and the Python Console. The ability to extend QGIS is perhaps the most convincing reason to use the software. You can customize it to your needs, you can download plugins that others have written, and you can automate the boring repetitive stuff. Models, scripts, and Plugins are all shareable.</p>


            

            
        
    </body></html>