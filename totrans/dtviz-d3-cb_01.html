<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with D3.js</h1></div></div></div><p>In this chapter we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Setting up a simple D3 development environment</li><li class="listitem" style="list-style-type: disc">Setting up an NPM-based development environment</li><li class="listitem" style="list-style-type: disc">Understanding D3-style JavaScript</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Introduction</h1></div></div></div><p>This chapter is designed to get you up and running with D3.js, covering fundamental aspects, such as what D3.js is, and how to set up a typical D3.js data visualization environment. One particular section is also devoted in covering some lesser known areas of JavaScript that D3.js relies heavily on.</p><p>What is D3? D3<a id="id0" class="indexterm"/> refers to <strong>Data-Driven Documents</strong>, and according to the official D3 Wiki:</p><div><blockquote class="blockquote"><p>D3.js <a id="id1" class="indexterm"/>is a JavaScript library for manipulating documents based on data. D3 helps you bring data to life using HTML, SVG, and CSS. D3's emphasis on web standards gives you the full capabilities of modern browsers without tying yourself to a proprietary framework, combining powerful visualization components and a data-driven approach to DOM manipulation.</p><p>D3 Wiki (2013, August)</p></blockquote></div><p>In a sense, D3 is a specialized JavaScript library that allows you to create amazing data visualizations <a id="id2" class="indexterm"/>using a simpler (data driven) approach by leveraging existing web standards. D3.js was created by Mike Bostock (<a class="ulink" href="http://bost.ocks.org/mike/">http://bost.ocks.org/mike/</a>) and superseded his previous work on a different JavaScript data visualization library called <a id="id3" class="indexterm"/>Protovis. For more information on how D3 was created and on the theory that influenced both Protovis and D3.js, please check out links in the following information box. Here in this book we will focus more on how to use D3.js to power your visualization. Initially, some aspects of D3 may be a bit confusing due to its different approach to data visualization using JavaScript. I hope that over the course of this book, a large number of topics, both basic and advanced, will make you comfortable and effective with D3. Once properly understood, D3 can improve your productivity and expressiveness with data visualizations by orders of magnitude.</p><div><div><h3 class="title"><a id="note02"/>Note</h3><p>For more formal introduction to the idea <a id="id4" class="indexterm"/>behind D3 see the <em>Declarative Language Design for Interactive Visualization</em> paper published by Mike Bostock on IEEE InfoVis 2010 <a class="ulink" href="http://vis.stanford.edu/papers/protovis-design">http://vis.stanford.edu/papers/protovis-design</a>.</p><p>If you are interested to know how D3 came about, I recommend you to check out the <em>D3: Data-Driven Document</em> paper published by Mike Bostock on IEEE InfoVis 2011 at <a class="ulink" href="http://vis.stanford.edu/papers/d3">http://vis.stanford.edu/papers/d3</a>.</p><p>Protovis, the <a id="id5" class="indexterm"/>predecessor of D3.js, also created by Mike Bostock and Jeff Heer of the Stanford Visualization Group can be found at <a class="ulink" href="http://mbostock.github.io/protovis/">http://mbostock.github.io/protovis/</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Setting up a simple D3 development environment</h1></div></div></div><p>First thing you need when starting a D3 powered data visualization project is a working development environment. In this recipe, we will show you how a simple D3 development environment can be set up within minutes.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Getting Ready</h2></div></div></div><p>Before we start, make<a id="id6" class="indexterm"/> sure you have your favorite text editor installed and ready on your computer.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How to do it...</h2></div></div></div><p>We'll start by<a id="id7" class="indexterm"/> downloading D3.js:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the latest stable version of D3.js from <a class="ulink" href="http://d3js.org/">http://d3js.org/</a>. You can download the archived, older releases from <a class="ulink" href="https://github.com/mbostock/d3/tags">https://github.com/mbostock/d3/tags</a>. Additionally, if you are interested in trying out the bleeding edge D3 build on master branch, then you can fork <a class="ulink" href="https://github.com/mbostock/d3">https://github.com/mbostock/d3</a>.</li><li class="listitem">Once downloaded and unzipped, you will find three <a id="id8" class="indexterm"/>files <code class="literal">d3.v3.js</code>, <code class="literal">d3.v3.min.js</code>, and <a id="id9" class="indexterm"/>its license in the extracted folder. For development it is recommended to use <code class="literal">d3.v3.js</code>, the "non-uglified" (minimized) version, since it can help you trace and debug JavaScript inside D3 library. Once extracted place the <code class="literal">d3.v3.js</code> file in the same folder with an <code class="literal">index.html</code> file containing the following HTML:<div><pre class="programlisting">&lt;!-- index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Simple D3 Dev Env&lt;/title&gt;
    &lt;script type="text/javascript" src="img/d3.v3.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;/html&gt;</pre></div></li></ol></div><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>If you download D3 from a source or a tagged version, the JavaScript file name will be slightly different. Instead of <code class="literal">d3.v3.js</code>, it will simply be called <code class="literal">d3.js</code>. </p></div></div><p>This is all <a id="id10" class="indexterm"/>you need to create, in its simplest form, a D3-powered data visualization development environment. With this setup you can essentially open the HTML file using your favorite text editor to start your development and also view your visualization by opening the file in your browser.</p><div><div><h3 class="title"><a id="note03"/>Note</h3><p>The source code for this recipe can be found at <a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/tree/master/src/chapter1/simple-dev-env">https://github.com/NickQiZhu/d3-cookbook/tree/master/src/chapter1/simple-dev-env</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How it works...</h2></div></div></div><p>D3 JavaScript library is very self-sufficient. It has no dependency on any JavaScript library than other what your browser already provides. In fact, it can even be used in a non-browser environment such as <strong>Node.js</strong>
<a id="id11" class="indexterm"/> with some minimum setup (I will cover this in more detail in later chapters).</p><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>If your visualization's target browser environment includes Internet Explorer 9, it is recommended to use the compatibility library <a id="id12" class="indexterm"/>
<strong>Aight</strong>, which can be found<a id="id13" class="indexterm"/> at <a class="ulink" href="https://github.com/shawnbot/aight">https://github.com/shawnbot/aight</a>, and <a id="id14" class="indexterm"/>
<strong>Sizzle selector engine</strong>
<a id="id15" class="indexterm"/> at <a class="ulink" href="http://sizzlejs.com/">http://sizzlejs.com/</a>.</p></div></div><p>Having the following character encoding instruction in header section is critical:</p><div><pre class="programlisting">    &lt;meta charset="utf-8"&gt;</pre></div><p>The character encoding instructs browsers and validators what set of characters to use when rendering web pages. Otherwise your browser will not be able to load D3 JavaScript library since D3 uses utf-8 character for certain symbols such as π.</p><div><div><h3 class="title"><a id="note04"/>Note</h3><p>D3 is completely open source, and it is open sourced under a custom license agreement created by its author Michael Bostock. This license is pretty similar to the popular MIT license with only one exception where it explicitly states that Michael Bostock's name cannot be used to endorse or promote products derived from this software without permission.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>There's more...</h2></div></div></div><p>Throughout this cookbook numerous recipe code examples will be provided. All example source code are provided and hosted on <a id="id16" class="indexterm"/>GitHub (<a class="ulink" href="https://github.com/">https://github.com/</a>) a popular<a id="id17" class="indexterm"/> open source social coding repository platform.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>How to get source code</h3></div></div></div><p>The easiest way <a id="id18" class="indexterm"/>to get all the recipe source code that you need is to clone the Git repository (<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook">https://github.com/NickQiZhu/d3-cookbook</a>) for this book. If you are not planning to set up a development environment for the recipes then you can safely skip this section.</p><div><div><h3 class="title"><a id="tip04"/>Tip</h3><p>If you are not familiar <a id="id19" class="indexterm"/>with Git, clone is similar to the check-out concept in other versions of control software. However cloning does a lot more than simply checking out the files. It also copies all branches and histories to your local machine effectively cloning the entire repository to your local machine so you can work completely offline with this cloned repository in your own environment.</p></div></div><p>First install a Git client on your computer. You can find a list of Git client software here <a class="ulink" href="http://git-scm.com/downloads">http://git-scm.com/downloads</a>, and a detailed guide on how to install it on different operating systems here <a class="ulink" href="http://git-scm.com/book/en/Getting-Started-Installing-Git">http://git-scm.com/book/en/Getting-Started-Installing-Git</a>.</p><div><div><h3 class="title"><a id="tip05"/>Tip</h3><p>Another popular way to get Git and GitHub working is to install the GitHub client, which gives you a richer set of features than simply Git. However, at the time of writing, GitHub only offered client software for Windows and Mac OS.</p><p>GitHub for <a id="id20" class="indexterm"/>Windows: <a class="ulink" href="http://windows.github.com/">http://windows.github.com/</a>.</p><p>GitHub for <a id="id21" class="indexterm"/>Mac: <a class="ulink" href="http://mac.github.com/">http://mac.github.com/</a>.</p></div></div><p>Once the Git client <a id="id22" class="indexterm"/>is installed, simply issuing the following command will download all recipe source code to your computer:</p><div><pre class="programlisting">
<strong>&gt; git clone git://github.com/NickQiZhu/d3-cookbook.git</strong>
</pre></div><div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>Or if you choose to use GitHub client, then simply click the <strong>Fork</strong> button on the repository page <a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook">https://github.com/NickQiZhu/d3-cookbook</a>. This will make this repository appear in your GitHub client.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Setting up an NPM-based development environment</h1></div></div></div><p>When you are working on a more complex data visualization project that requires the use of a number of JavaScript libraries, the simple solution we discussed before might become a bit clumsy and unwieldy. In this section, we will demonstrate an improved setup using <strong>Node Packaged Modules</strong> (<strong>NPM</strong>)—a de facto JavaScript library <a id="id23" class="indexterm"/>repository management system. If you are as impatient as me and want to get to the meaty part of the book—the recipes—you can safely skip this section and come back when you need to set up a more production-ready environment for your project.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Getting Ready</h2></div></div></div><p>Before we start <a id="id24" class="indexterm"/>please make sure you have NPM properly installed. NPM comes as part of the Node.js installation. You can download Node.js from<a id="id25" class="indexterm"/> <a class="ulink" href="http://nodejs.org/download/">http://nodejs.org/download/</a>. Select the correct Node.js binary build for your OS. Once installed the <code class="literal">npm</code> command<a id="id26" class="indexterm"/> will become available in your terminal console.</p><div><pre class="programlisting">
<strong>&gt; npm -v </strong>
<strong>1.2.14</strong>
</pre></div><p>The preceding command prints out the version number of your NPM client indicating the installation is successful.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How to do it...</h2></div></div></div><p>With NPM installed, now we can create a package descriptor file to automate some of the manual setup steps.</p><div><ol class="orderedlist arabic"><li class="listitem">First, under <a id="id27" class="indexterm"/>your project folder, create a file named <code class="literal">package.json</code> containing the following code:<div><pre class="programlisting">{
  "name": "d3-project-template",
  "version": "0.1.0",
  "description": "Ready to go d3 data visualization project template",
  "keywords": [
    "data visualization",
    "d3"
  ],
  "homepage": "&lt;project home page&gt;",
  "author": {
    "name": "&lt;your name&gt;",
    "url": "&lt;your url&gt;"
  },
  "repository": {
    "type": "git",
    "url": "&lt;source repo url&gt;"
  },
  "dependencies": {
      "d3":"3.x"
  },
  "devDependencies": {
      "uglify-js": "2.x"
  }
}</pre></div></li><li class="listitem">Once the <code class="literal">package.json</code> file<a id="id28" class="indexterm"/> is defined, you can simply run:<div><pre class="programlisting">&gt; npm install</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How it works...</h2></div></div></div><p>Most of the fields in the <code class="literal">package.json</code> file are for informational purpose only, such as the name, description, homepage, author, and the repository. The name and version field will be used if you decide to publish your library into an NPM repository in the future. What we really care about, <a id="id29" class="indexterm"/>at this point, is the <code class="literal">dependencies</code> and <code class="literal">devDependencies</code> fields.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">dependencies</code> field<a id="id30" class="indexterm"/> describes the runtime library dependencies that your project has, meaning the libraries your project needs to run properly in a browser. In this simple example we only have one dependency on d3. <code class="literal">d3</code> is the name that D3 library is published under in the NPM repository. The version number <code class="literal">3.x</code> signifies that this project is compatible with any version 3 releases, and NPM should retrieve the latest stable version 3 build to satisfy this dependency.<div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>D3 is a self-sufficient library with zero external runtime dependency. However, this does not mean that it cannot work with other popular JavaScript libraries. I regularly use D3 with other libraries to make my job easier, for example, <a id="id31" class="indexterm"/>JQuery,<a id="id32" class="indexterm"/> Zepto.js,<a id="id33" class="indexterm"/> Underscore.js, and <a id="id34" class="indexterm"/>Backbone.js.</p></div></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">devDependencies</code> field<a id="id35" class="indexterm"/> describes development time (compile time) library dependencies. What this means is that, libraries specified under this category are only required in order to build this project, and not required for running your JavaScript project.</li></ul></div><div><div><h3 class="title"><a id="note05"/>Note</h3><p>Detailed NPM package JSON file documentation<a id="id36" class="indexterm"/> can be found at <a class="ulink" href="https://npmjs.org/doc/json.html">https://npmjs.org/doc/json.html</a>.</p></div></div><p>Executing the <code class="literal">npm install</code> command<a id="id37" class="indexterm"/> will automatically trigger NPM to download all dependencies that your project requires including your dependencies' dependencies recursively. All dependency libraries will be downloaded into <code class="literal">node_modules</code> folder under your project root folder. When this is done you can just simply create your HTML file as it has been shown in the previous recipe, and load your D3 JavaScript library directly from <code class="literal">node_modules/d3/d3.js</code>.</p><p>The source code for this recipe with an automated build script can be found at <a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/tree/master/src/chapter1/npm-dev-env">https://github.com/NickQiZhu/d3-cookbook/tree/master/src/chapter1/npm-dev-env</a>.</p><p>Relying on NPM is a simple and yet effective way to save you from all the trouble of downloading JavaScript libraries manually and the constant need of keeping them up-to-date. However, an astute reader might have already noticed that with this power we can easily push our environment setup to the next level. Imagine if you are building a large visualization project where thousands of lines of JavaScript code will be created, obviously our simple setup described here is no longer sufficient. However modular JavaScript development by itself can fill an entire book; therefore we are not going to try to cover this topic since our focus is on data visualization and D3. If you are interested please refer the source code for this recipe where it is demonstrated how a more modular approach can be implemented on top of what we described here with a simple automated build script. In later chapters, when unit test related recipes are discussed, we will expand the coverage on this<a id="id38" class="indexterm"/> topic to show how our setup can be enhanced to run automated unit tests.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>There's more...</h2></div></div></div><p>Though in previous sections, it was mentioned that you can just open the HTML page that you have created using your browser to view your visualization result directly, this approach does have its limitations. This simple approach stops working once we need to load data from separate data file (this is what we will do in later chapters and it is also the most likely case in your daily working environment) due to the browser's built-in security policy. To get around this security constraint it is highly recommended that you set up a local HTTP server so your HTML page and the data file can be served from this server instead of loaded from file system directly.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Setup a local HTTP server</h3></div></div></div><p>There are <a id="id39" class="indexterm"/>probably a dozen <a id="id40" class="indexterm"/>ways to set up an HTTP server on your computer based on which operating system you use and which software package you decide to use to act as an HTTP server. Here I will attempt to cover some of the most popular setups.</p><div><div><div><div><h4 class="title"><a id="ch01lvl4sec01"/>Python Simple HTTP Server</h4></div></div></div><p>This is my favorite for <a id="id41" class="indexterm"/>development and fast<a id="id42" class="indexterm"/> prototyping. If you have Python installed on your OS, which is usually the case with any Unix/Linux/Mac OS distro, then you can simply type this command in your terminal:</p><div><pre class="programlisting">
<strong>&gt; python –m SimpleHTTPServer 8888</strong>
</pre></div><p>Or with newer Python distribution:</p><div><pre class="programlisting">
<strong>&gt; python –m http.server </strong>
</pre></div><p>This little python program will launch an <a id="id43" class="indexterm"/>HTTP server and start serving any file right from the folder where this program is launched. This is by far the easiest <a id="id44" class="indexterm"/>way to get an HTTP server running on any OS.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>If you don't have python installed on your computer yet, you can get it from <a class="ulink" href="http://www.python.org/getit/">http://www.python.org/getit/</a>. It works on all modern OS including Windows, Linux and Mac.</p></div></div></div><div><div><div><div><h4 class="title"><a id="ch01lvl4sec02"/>Node.js HTTP Server</h4></div></div></div><p>If you have <a id="id45" class="indexterm"/>Node.js installed, <a id="id46" class="indexterm"/>perhaps as part of the development environment setup exercise we did in the previous section, then you can simply install the <a id="id47" class="indexterm"/>
<strong>http-server</strong> module. Similar to Python Simple HTTP Server, this module will allow you to launch a lightweight HTTP server from any folder and starting serving pages right away.</p><p>First install the <a id="id48" class="indexterm"/>http-server module:</p><div><pre class="programlisting">
<strong>&gt; npm install http-server –g</strong>
</pre></div><p>The <code class="literal">-g</code> option in this command will install http-server module globally so it will become available in your command line terminal automatically. Once this is done, then you can launch the server from any folder you are in by simply issuing the following command:</p><div><pre class="programlisting">
<strong>&gt; http-server .</strong>
</pre></div><p>This command will launch a Node.js powered HTTP server on the default port 8080 or if you want you can use the <code class="literal">–p</code> option to provide a custom port number for it.</p><div><div><h3 class="title"><a id="tip08"/>Tip</h3><p>If you are running the <code class="literal">npm install</code> command<a id="id49" class="indexterm"/> on Linux/Unix/Mac OS, you will need to run the command in <code class="literal">sudo</code> mode or as root in order to use the <code class="literal">–g</code> global installation option.</p></div></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Understanding D3-style JavaScript</h1></div></div></div><p>D3 is designed and built using functional style JavaScript which might come as to seem unfamiliar or even alien to someone who is more comfortable with the procedural or object-oriented JavaScript styles. This recipe is designed to cover some of the most fundamental concepts in functional JavaScript required to make sense of D3, and furthermore enable you to write <a id="id50" class="indexterm"/>your visualization code in D3 style.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:<a class="ulink" href="http:// https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter1/functional-js.html"> https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter1/functional-js.html</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it...</h2></div></div></div><p>Let's dig a little deeper into the good part of JavaScript—the more functional side. Take a look at the following code snippet:</p><div><pre class="programlisting">function SimpleWidget(spec) {
  var instance = {}; // &lt;-- A

  var headline, description; // &lt;-- B

  instance.render = function () {
    var div = d3.select('body').append("div");

    div.append("h3").text(headline); // &lt;-- C

    div.attr("class", "box")
    .attr("style", "color:" + spec.color) // &lt;-- D
      .append("p")
      .text(description); // &lt;-- E

    return instance; // &lt;-- F
  };

  instance.headline = function (h) {
    if (!arguments.length) h; // &lt;-- G
      headline = h;
    return instance; // &lt;-- H
  };

  instance.description = function (d) {
    if (!arguments.length) d;
      description = d;
    return instance;
  };

  return instance; // &lt;-- I
}

  var widget = SimpleWidget({color: "#6495ed"})
    .headline("Simple Widget")
    .description("This is a simple widget demonstrating functional javascript.");
  widget.render();</pre></div><p>This code snippet generates the following simple widget on your web page:</p><div><img src="img/2162OS_01_01.jpg" alt="How to do it..."/><div><p>A Simple Widget with functional JavaScript</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How it works...</h2></div></div></div><p>Despite its simplicity, the<a id="id51" class="indexterm"/> interface of this widget has this undeniable similarity to D3 style of JavaScript. This is not by coincidence but rather by leveraging a JavaScript programming paradigm called functional objects. Like many interesting topics, this is another topic that can fill an entire book by itself; nevertheless I will try to cover the most important and useful aspects of this particular paradigm in this section so you the reader cannot only understand D3's syntax but will also be able to create a library in this fashion. As stated on D3's project Wiki this functional programming style gives D3 much of its flexibility:</p><div><blockquote class="blockquote"><p>D3's functional style allows code reuse through a diverse collection of components and plugins.</p><p>D3 Wiki (2013, August)</p></blockquote></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Functions are objects</h3></div></div></div><p>Functions in <a id="id52" class="indexterm"/>JavaScript are objects. Like any other object, function is just a collection of name and value pair. The only difference between a function object and a regular object is that function can be invoked and additionally associated with two hidden properties: function context and function code. This might come as a surprise and unnatural, especially if you are coming from a more procedural programming background. Nevertheless this is the critical insight most of us need, to make sense of some of the strange ways that D3 uses function.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>JavaScript in its current form is generally considered not very object oriented, however, function object is probably one aspect where it outshines some of the other more object-oriented cousins.</p></div></div><p>Now with this insight in mind, let's take a look at the code snippet again:</p><div><pre class="programlisting">  var instance = {}; // &lt;-- A

  var headline, description; // &lt;-- B

  instance.render = function () {
    var div = d3.select('body').append("div");

    div.append("h3").text(headline); // &lt;-- C

    div.attr("class", "box")
      .attr("style", "color:" + spec.color) // &lt;-- D
      .append("p")
      .text(description); // &lt;-- E

    return instance; // &lt;-- F
  };</pre></div><p>At line marked as A, B, and C we can clearly see that <code class="literal">instance</code>, <code class="literal">headline</code>, and <code class="literal">description</code> are all internal private variables belonging to the <code class="literal">SimpleWidget</code> function object. While the <code class="literal">render</code> function is a function associated with the <code class="literal">instance</code> object which itself is defined as an object literal. Since functions are just an object it can also be stored in an object/function, other variables, arrays, and being passed as function arguments. The result of the execution of function <code class="literal">SimpleWidget</code> is the returning of object instance at line I.</p><div><pre class="programlisting">function SimpleWidget(spec) {
...
  return instance; // &lt;-- I
}</pre></div><div><div><h3 class="title"><a id="note08"/>Note</h3><p>The <code class="literal">render</code> function<a id="id53" class="indexterm"/> uses some of the D3 functions that we have not covered yet, but let's not pay too much attention to them for now since we will cover each of them in depth in the next couple of chapters. Also they basically just render the visual representation of this widget, not having much to do with our topic on hand.</p></div></div><div><div><h3 class="title"><a id="tip09"/>Tip</h3><p>
<strong>Downloading the example code</strong>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Static variable scoping</h3></div></div></div><p>Curious readers are probably <a id="id54" class="indexterm"/>asking by now how the variable <a id="id55" class="indexterm"/>scoping is resolved in this example since the render function has seemingly strange access to not only the <code class="literal">instance</code>, <code class="literal">headline</code>, and <code class="literal">description</code> variables but also the <code class="literal">spec</code> variable that is passed into the base <code class="literal">SimpleWidget</code> function. This seemingly strange variable scoping is actually determined by a simple static scoping rule. This rule can be thought as the following: whenever searching for a variable reference, variable search will be first performed locally. When variable declaration is not found (as in the case of <code class="literal">headline</code> on line C) then the search continues to the parent object (in this case <code class="literal">SimpleWidget</code> function is its static parent and <code class="literal">headline</code> variable declaration is found at line B). If still not found, then this process will continue recursively to the next static parent so on and so forth till it reaches global variable definition, if still not found then a reference error will be generated for this variable. This scoping behavior is very different from variable resolution rules in some of the most popular languages such as Java and C#; it might take some time to get used to, however don't worry too much about it if you still find it confusing. With more practice and keeping static scoping rule in mind you will be comfortable with this kind of scoping in no time.</p><div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>One word of caution here—again for folks from Java and C# backgrounds—is that JavaScript does not implement block scoping. The static scoping rule we described only applies to function/object but not at the block level.</p></div></div><div><pre class="programlisting">for(var i = 0; i &lt; 10; i++){
  for(var i = 0; i &lt; 2; i++){
    console.log(i);
  }
}</pre></div><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>You might be inclined to think this code should produce 20 numbers. However in JavaScript this code creates an infinite loop. This is because JavaScript does not implement block scoping so the <code class="literal">i</code> in the inner loop is the same <code class="literal">i</code> used by the the outer loop. Therefore it gets reset by the inner loop thus and can never end the outer loop.</p></div></div><p>This pattern is usually referred as functional when compared with the more popular prototype-based <a id="id56" class="indexterm"/>
<strong>Pseudo-classical pattern</strong>. The advantage of the functional pattern is that it provides a much better mechanism for information hiding and <a id="id57" class="indexterm"/>encapsulation since the private variables—in our case the <code class="literal">headline</code> and <code class="literal">description</code> variables—are only accessible by nested functions via the<a id="id58" class="indexterm"/> static scoping rule therefore the object returned by the <code class="literal">SimpleWidget</code> function is flexible yet more tamper-proof and durable.</p><div><blockquote class="blockquote"><p>If we create an object in the functional style, and if all of the methods of the object make no use of this, then the object is durable. A durable object is simply a collection of functions that act as capabilities.</p><p>(Crockfort D. 2008)</p></blockquote></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Variable-parameter function</h3></div></div></div><p>Something <a id="id59" class="indexterm"/>strange happens on line G:</p><div><pre class="programlisting">instance.headline = function (h) {
  if (!arguments.length) h; // &lt;-- G
  headline = h;
  return instance; // &lt;-- H
};</pre></div><p>You might be asking where<a id="id60" class="indexterm"/> this <code class="literal">arguments</code> variable on line G came from. It was never defined anywhere in this example. The <code class="literal">arguments</code> variable is a built-in hidden parameter that is available to functions when they are invoked. The <code class="literal">arguments</code> variable contains all arguments for a function invocation in an array.</p><div><div><h3 class="title"><a id="tip12"/>Tip</h3><p>In fact, <code class="literal">arguments</code> is not really a JavaScript array object. It has length and can be accessed using an index, however it does not have many of the methods associated with a typical JavaScript array object such as <code class="literal">slice</code> or <code class="literal">concat</code>. When you need to use a standard JavaScript array method on <code class="literal">arguments</code>, you need to use the apply invocation pattern:</p><div><pre class="programlisting">var newArgs = Array.prototype.slice.apply(arguments);</pre></div></div></div><p>This hidden parameter when combined with the ability to omit function argument in JavaScript allows you to write a function like <code class="literal">instance.headline</code> with unspecified number of parameters. In this case, we can either have one argument <code class="literal">h</code> or none. Because <code class="literal">arguments.length</code> returns 0 when no parameter is passed; therefore the <code class="literal">headline</code> function returns <code class="literal">h</code> if no parameter is passed, otherwise it turns into a setter if parameter <code class="literal">h</code> is provided. To <a id="id61" class="indexterm"/>clarify this explanation let's take a look at the following code snippet:</p><div><pre class="programlisting">var widget = SimpleWidget({color: "#6495ed"})
    .headline("Simple Widget"); // set headline
console.log(widget.headline()); // prints "Simple Widget"</pre></div><p>Here you can see how <a id="id62" class="indexterm"/>headline function can be used as both setter and getter with different parameters.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec06"/>Function chaining</h3></div></div></div><p>The next interesting<a id="id63" class="indexterm"/> aspect of this particular example is the <a id="id64" class="indexterm"/>capability of chaining functions to each other. This is also the predominant function invocation pattern that the D3 library deploys since most of the D3 functions are designed to be chainable to provide a more concise and contextual programming interface. This is actually quite simple once you understand the variable-parameter function concept. Since a variable-parameter function—such as the <code class="literal">headline</code> function—can serve as setter and getter at the same time, then returning the <code class="literal">instance</code> object when it is acting as a setter allows you to immediately invoke another function on the invocation result; hence the chaining.</p><p>Let's take a look at the following code:</p><div><pre class="programlisting">var widget = SimpleWidget({color: "#6495ed"})
  .headline("Simple Widget")
  .description("This is ...")
  .render();</pre></div><p>In this example, the <code class="literal">SimpleWidget</code> function returns the <code class="literal">instance</code> object (as on line I). Then, the <code class="literal">headline</code> function is invoked as a setter, which also returns the <code class="literal">instance</code> object (as on line H). The <code class="literal">description</code> function can then be invoked directly on return which again returns the <code class="literal">instance</code> object. Then finally the <code class="literal">render</code> function can be called.</p><p>Now with the knowledge of functional JavaScript and a working ready-to-go D3 data visualization development environment, we are ready to dive into the rich concepts and techniques that D3 has to offer. However before we take off, I would like to cover a few more important areas—how to find and share code and how to get help when you are stuck.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>There's more...</h2></div></div></div><p>Let's take a look at some additional helpful resources.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Finding and sharing code</h3></div></div></div><p>One of the great things about D3<a id="id65" class="indexterm"/> when compared with other visualization options is that it <a id="id66" class="indexterm"/>offers a wealth of examples and tutorials that you can draw your inspiration from. During the course of creating my own open source visualization charting library and the creation of this book, I had drawn heavily on these resources. I am going to list some of the most popular options available in this aspect. This list is by no means a comprehensive directory but rather a starting place for you to explore:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The D3 gallery<a id="id67" class="indexterm"/> (<a class="ulink" href="https://github.com/mbostock/d3/wiki/Gallery">https://github.com/mbostock/d3/wiki/Gallery</a>) contains some of the most interesting <a id="id68" class="indexterm"/>examples that you can find online regarding D3 usage. It contains examples on different visualization charts, specific techniques, and some interesting visualization implementations in the wild, among others.</li><li class="listitem" style="list-style-type: disc">BioVisualize<a class="ulink" href="http://(http://biovisualize.github.io/d3visualization">(http://biovisualize.github.io/d3visualization</a>) is another D3 gallery with <a id="id69" class="indexterm"/>categorization, to help you find your desired <a id="id70" class="indexterm"/>visualization example online quickly.</li><li class="listitem" style="list-style-type: disc">The D3 tutorials page (<a class="ulink" href="https://github.com/mbostock/d3/wiki/Tutorials">https://github.com/mbostock/d3/wiki/Tutorials</a>) contains a collection of <a id="id71" class="indexterm"/>tutorials, talks and slides created by various <a id="id72" class="indexterm"/>contributors over time, to demonstrate in detail how to use a lot of D3 concepts and techniques.</li><li class="listitem" style="list-style-type: disc">D3 plugins (<a class="ulink" href="https://github.com/d3/d3-plugins">https://github.com/d3/d3-plugins</a>). Maybe some features are missing in <a id="id73" class="indexterm"/>D3 for your visualization needs? Before you<a id="id74" class="indexterm"/> decide to implement your own, make sure to check out D3 plugin repository. It contains a wide variety of plugins that provide some of the common and, sometimes, uncommon features in the visualization world.</li><li class="listitem" style="list-style-type: disc">The D3 API (<a class="ulink" href="https://github.com/mbostock/d3/wiki/API-Reference">https://github.com/mbostock/d3/wiki/API-Reference</a>) is very <a id="id75" class="indexterm"/>well <a id="id76" class="indexterm"/>documented. This is where you can find detailed explanations for every function and property that the D3 library has to offer.</li><li class="listitem" style="list-style-type: disc">Mike Bostok's Blocks (<a class="ulink" href="http://bl.ocks.org/mbostock">http://bl.ocks.org/mbostock</a>) is a D3 example site, where some of the more intriguing visualization example can be found and which is maintained by its author Mike Bostock.</li><li class="listitem" style="list-style-type: disc">JS Bin (<a class="ulink" href="http://jsbin.com/ugacud/1/edit">http://jsbin.com/ugacud/1/edit</a>) is a pre-built D3 test and experiment <a id="id77" class="indexterm"/>environment <a id="id78" class="indexterm"/>completely hosted online. You can easily prototype a simple script using this tool or share your creation with other members in the community.</li><li class="listitem" style="list-style-type: disc">JS Fiddle (<a class="ulink" href="http://jsfiddle.net/qAHC2/">http://jsfiddle.net/qAHC2/</a>) is<a id="id79" class="indexterm"/> similar to JS Bin; it<a id="id80" class="indexterm"/> also is a hosted-online JavaScript code prototyping and sharing platform.</li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec08"/>How to get help</h3></div></div></div><p>Even with all the<a id="id81" class="indexterm"/> examples, tutorial, and cookbook like this, you might still run into challenges when creating your visualization. Good news here is that D3 has a broad and active support community. Simply "googling" your question can most often yield a satisfying answer. Even if it does not, don't worry; D3 has a robust community-based support:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">D3.js on Stack<a id="id82" class="indexterm"/> Overflow (<a class="ulink" href="http://stackoverflow.com/questions/tagged/d3.js">http://stackoverflow.com/questions/tagged/d3.js</a>): Stack Overflow<a id="id83" class="indexterm"/> is the most popular community-based free Q&amp;A site for technologists. D3 is a specific category on the Stack Overflow site to help you reach the experts and get an answer to your question quickly.</li><li class="listitem" style="list-style-type: disc">The <a id="id84" class="indexterm"/>D3 Google group (<a class="ulink" href="https://groups.google.com/forum/?fromgroups#!forum/d3-js">https://groups.google.com/forum/?fromgroups#!forum/d3-js</a>): This is the <a id="id85" class="indexterm"/>official user group for not just D3 but also other related libraries in its ecosystem.</li></ul></div></div></div></div></body></html>