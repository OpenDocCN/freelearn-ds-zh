<html><head></head><body><div><div><h1 id="_idParaDest-15"><a id="_idTextAnchor014"/>Chapter 1: Getting Started with spaCy</h1>
			<p>In this chapter, we will have a comprehensive introduction to <strong class="bold">natural language processing</strong> (<strong class="bold">NLP</strong>) application development with Python and <strong class="bold">spaCy</strong>. First, we will see how NLP development goes hand in hand with <strong class="bold">Python</strong>, along with an overview of what <strong class="bold">spaCy</strong> offers as a Python library. </p>
			<p>After the warm-up, you will quickly get started with spaCy by downloading the library and loading the models. You will then explore spaCy's popular visualizer <strong class="bold">displaCy</strong> by visualizing several features of spaCy. </p>
			<p>By the end of this chapter, you will know what you can achieve with spaCy and how to plan your journey with spaCy code. You will be also settled with your development environment, having already installed all the necessary packages for NLP tasks in the upcoming sections. </p>
			<p> We're going to cover the following main topics in this chapter:</p>
			<ul>
				<li>Overview of spaCy</li>
				<li>Installing spaCy</li>
				<li>Installing spaCy's statistical models</li>
				<li>Visualization with displaCy</li>
			</ul>
			<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>Technical requirements </h1>
			<p>The chapter code can be found at the book's GitHub repository: <a href="https://github.com/PacktPublishing/Mastering-spaCy/tree/main/Chapter01">https://github.com/PacktPublishing/Mastering-spaCy/tree/main/Chapter01</a></p>
			<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Overview of spaCy</h1>
			<p>Before getting started<a id="_idIndexMarker000"/> with the spaCy code, we will first have an overview of NLP applications in real life, NLP with Python, and NLP with spaCy. In this section, we'll find out the reasons to use Python and spaCy for developing NLP applications. We will first see how Python goes hand-in-hand with text processing, then we'll understand spaCy's place in the Python NLP libraries. Let's start our tour with the close-knit relationship between Python and NLP. </p>
			<h2 id="_idParaDest-18"><a id="_idTextAnchor017"/>Rise of NLP</h2>
			<p>Over the past few years, most of <a id="_idIndexMarker001"/>the branches of AI created a lot of buzz, including NLP, computer vision, and predictive analytics, among others. But just what is NLP? How can a machine or code solve human language? </p>
			<p>NLP is a subfield of AI that analyzes text, speech, and other forms of human-generated language data. Human language is complicated – even a short paragraph contains references to the previous words, pointers to real-world objects, cultural references, and the writer's or speaker's personal experiences. <em class="italic">Figure 1.1</em> shows such an example sentence, which includes a reference to a relative date (<em class="italic">recently</em>), phrases that can be resolved only by another person who knows the speaker (regarding the city that the speaker's parents live in) and who has general knowledge about the world (a city is a place where human beings live together): </p>
			<div><div><img src="img/B16570_01_01.jpg" alt="Figure 1.1 – An example of human language, containing many cognitive and cultural aspects &#13;&#10;" width="1042" height="601"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.1 – An example of human language, containing many cognitive and cultural aspects </p>
			<p>How do we process such a complicated structure then? We have our weapons too; we model natural language with statistical models, and we process linguistic features to turn the text into a well-structured representation. This book provides all the necessary background and tools for you to extract the meaning out of text. By the end of this book, you will possess statistical and linguistic knowledge to process text by using a great tool – the spaCy library.</p>
			<p>Though NLP gained popularity recently, processing human language has been present in our lives via many real-world applications, including search engines, translation services, and recommendation engines.</p>
			<p>Search engines such as <a id="_idIndexMarker002"/>Google Search, Yahoo Search, and Microsoft Bing are an integral part of our daily lives. We look for homework help, cooking recipes, information about celebrities, the latest episodes of our favorite TV series; all sorts of information that we use in our daily lives. There is even a verb in English (also in many other languages), <em class="italic">to google</em>, meaning <em class="italic">to look up some information on the Google search engine</em>.</p>
			<p>Search engines use advanced NLP techniques including mapping queries into a semantic space, where similar queries are represented by similar vectors. A quick trick is called <strong class="bold">autocomplete</strong>, where query<a id="_idIndexMarker003"/> suggestions appear on the search bar when we type the first few letters. Autocomplete looks tricky but indeed the algorithm is a combination of a search tree walk and character-level distance calculation. A past query is represented by a sequence of its characters, where each character corresponds to a<a id="_idIndexMarker004"/> node in the search tree. The <strong class="bold">arcs</strong> between the characters are assigned weights according to the popularity of this past query. </p>
			<p>Then, when a new query comes, we compare the current query string to past queries by walking on the tree. A fundamental <strong class="bold">Computer Science</strong> (<strong class="bold">CS</strong>) data structure, the tree, is used to represent a list of queries, who would have thought that? <em class="italic">Figure 1.2</em> shows a walk on the character tree:</p>
			<div><div><img src="img/B16570_01_02.jpg" alt="Figure 1.2 – An autocomplete example&#13;&#10;" width="420" height="285"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.2 – An autocomplete example</p>
			<p>This is a simplified<a id="_idIndexMarker005"/> explanation; the real algorithms blend several techniques usually. If you want to learn more about this subject, you can read the great articles about the data structures: <a href="http://blog.notdot.net/2010/07/Damn-Cool-Algorithms-Levenshtein-Automata">http://blog.notdot.net/2010/07/Damn-Cool-Algorithms-Levenshtein-Automata</a> and <a href="http://blog.notdot.net/2007/4/Damn-Cool-Algorithms-Part-1-BK-Trees">http://blog.notdot.net/2007/4/Damn-Cool-Algorithms-Part-1-BK-Trees</a>.</p>
			<p>Continuing with search engines, search engines also know how to transform unstructured data to structured and linked data. When we type <code>Diana Spencer</code> into the search bar, this is what comes up:</p>
			<p class="figure-caption"> </p>
			<div><div><img src="img/B16570_01_03.jpg" alt="Figure 1.3 – Search results for the query &quot;Diana Spencer&quot;&#13;&#10;" width="577" height="409"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.3 – Search results for the query "Diana Spencer"</p>
			<p>How did the search <a id="_idIndexMarker006"/>engine link <code>Diana Spencer</code> to her well-known<a id="_idIndexMarker007"/> name <em class="italic">Princess Diana</em>? This is called <strong class="bold">entity linking</strong>. We link entities that mention the same real-world entity. Entity-linking algorithms concern representing semantic relations and knowledge in general. This area of NLP is called the <strong class="bold">Semantic Web</strong>. You can<a id="_idIndexMarker008"/> learn more about this at <a href="https://www.cambridgesemantics.com/blog/semantic-university/intro-semantic-web/">https://www.cambridgesemantics.com/blog/semantic-university/intro-semantic-web/</a>. I worked as a knowledge engineer at a search engine company at the beginning of my career and really enjoyed it. This is a fascinating subject in NLP.</p>
			<p>There is really no limit to what you can develop: search engine algorithms, chatbots, speech recognition<a id="_idIndexMarker009"/> applications, and user sentiment recognition applications. NLP problems are challenging yet fascinating. This book's mission is to provide you a toolbox with all the necessary tools. The first step of NLP development is choosing the programming language we will use wisely. In the next section, we will explain why Python is the weapon of choice. Let's move on to the next section to see the string bond of NLP and Python. </p>
			<h2 id="_idParaDest-19"><a id="_idTextAnchor018"/>NLP with Python</h2>
			<p>As we remarked before, NLP is a <a id="_idIndexMarker010"/>subfield of AI that analyzes text, speech, and other forms of human-generated language data. As an industry professional, my first choice for manipulating text data is Python. In general, there are many benefits to using Python:</p>
			<ul>
				<li>It is easy to read and looks very similar to pseudocode.</li>
				<li>It is easy to produce and test code with.</li>
				<li>It has a high level of abstraction. </li>
			</ul>
			<p>Python is a great choice for<a id="_idIndexMarker011"/> developing NLP systems because of the following:</p>
			<ul>
				<li><strong class="bold">Simplicity</strong>: Python is easy to learn. You can focus on NLP rather than the programming language details.</li>
				<li><strong class="bold">Efficiency</strong>: It allows for easier development of quick NLP application prototypes.</li>
				<li><strong class="bold">Popularity</strong>: Python is one of the most popular languages. It has huge community support, and installing new libraries with pip is effortless.</li>
				<li><strong class="bold">AI ecosystem presence</strong>: A significant number of open source NLP libraries are available in Python. Many <strong class="bold">machine learning </strong>(<strong class="bold">ML</strong>) libraries<a id="_idIndexMarker012"/> such as PyTorch, TensorFlow, and Apache Spark also provide Python APIs.</li>
				<li><code>sentenc.split()</code>, which can be quite painful in other languages, such as C++, where you have to deal with stream objects for this task.</li>
			</ul>
			<p>When we put all the preceding points together, the following image appears – Python intersects with string<a id="_idIndexMarker013"/> processing, the AI ecosystem, and ML libraries to provide us the best NLP development experience:</p>
			<div><div><img src="img/B16570_01_04.jpg" alt="Figure 1.4 – NLP with Python overview&#13;&#10;" width="938" height="804"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.4 – NLP with Python overview</p>
			<p>We will use Python 3.5+ throughout this book. Users who do not already have Python installed can follow the instructions at <a href="https://realpython.com/installing-python/">https://realpython.com/installing-python/</a>. We recommend downloading and using the latest version of Python 3.</p>
			<p>In Python 3.x, the default<a id="_idIndexMarker014"/> encoding is <strong class="bold">Unicode</strong>, which means that we can use Unicode text without worrying much about the encoding. We won't go into details of encodings here, but you can think of Unicode as an extended set of ASCII, including more characters such as German-alphabet umlauts and the accented characters of the French alphabet. This way we can process German, French, and many more languages other than English.</p>
			<h2 id="_idParaDest-20"><a id="_idTextAnchor019"/>Reviewing some useful string operations</h2>
			<p>In Python, the<a id="_idIndexMarker015"/> text is represented by <code>str</code> class. Strings are immutable sequences of characters. Creating a string object is easy – we enclose the text in quotation marks:</p>
			<pre> word = 'Hello World'</pre>
			<p>Now the <code>word</code> variable contains the string <code>Hello World</code>. As we mentioned, strings are sequences of characters, so we can ask for the first item of the sequence:</p>
			<pre> print (word [0])
H</pre>
			<p>Always remember to use parentheses with <code>print</code>, since we are coding in Python 3.x. We can similarly access other indices, as long as the index doesn't go out of bounds:</p>
			<pre> word [4]
'o'</pre>
			<p>How about string length? We can use the <code>len</code> method, just like with <code>list</code> and other sequence types:</p>
			<pre> len(word)
11</pre>
			<p>We can also iterate over the characters of a string with sequence methods:</p>
			<pre> for ch in word:
               print(ch)
H
e
l
l
o
W
o
r
l
d</pre>
			<p class="callout-heading">Pro tip</p>
			<p class="callout">Please mind the indentation throughout the book. Indentation in Python is the way we determine the control blocks and function definitions in general, and we will apply this convention in this book. </p>
			<p>Now let's go over the more <a id="_idIndexMarker016"/>string methods such as counting characters, finding a substring, and changing letter case.</p>
			<p><code>count</code> counts the number of occurrences of a character in the string, so the output is <code>3</code> here:</p>
			<pre> word.count('l')
3</pre>
			<p>Often, you need to find the index of a character for a number of substring operations such as cutting and slicing the string:</p>
			<pre> word.index(e)
1</pre>
			<p>Similarly, we can search for substrings in a string with the <code>find</code> method:</p>
			<pre> word.find('World')
6</pre>
			<p><code>find</code> returns <code>–1</code> if the substring is not in the string:</p>
			<pre> word.find('Bonjour')
-1</pre>
			<p>Searching for the last occurrence of a substring is also easy:</p>
			<pre> word.rfind('l')
9</pre>
			<p>We can change letter case by the <code>upper</code> and <code>lower</code> methods:</p>
			<pre> word.upper()
'HELLO WORLD'</pre>
			<p>The <code>upper</code> method changes all <a id="_idIndexMarker017"/>characters to uppercase. Similarly, the <code>lower</code> method changes all characters to lowercase:</p>
			<pre> word.lower()
'hello world'</pre>
			<p>The <code>capitalize</code> method capitalizes the first character of the string:</p>
			<pre> 'hello madam'.capitalize()
'Hello madam'</pre>
			<p>The <code>title</code> method makes the string title case. Title case literally means <em class="italic">to make a title</em>, so each word of the string is capitalized:</p>
			<pre> 'hello madam'.title()
'Hello Madam'</pre>
			<p>Forming new strings from other strings can be done in several ways. We can concatenate two strings by adding them:</p>
			<pre> 'Hello Madam!' + 'Have a nice day.'
'Hello Madam!Have a nice day.'</pre>
			<p>We can also multiply a string with an integer. The output will be the string concatenated to itself by the number of times specified by the integer:</p>
			<pre> 'sweet ' * 5
'sweet sweet sweet sweet '</pre>
			<p><code>join</code> is a frequently used method; it takes a list of strings and joins them into one string:</p>
			<pre> ' '.join (['hello', 'madam'])
'hello madam'</pre>
			<p>There is a variety of<a id="_idIndexMarker018"/> substring methods. Replacing a substring means changing all of its occurrences with another string:</p>
			<pre> 'hello madam'.replace('hello', 'good morning')
'good morning madam'</pre>
			<p>Getting a substring by<a id="_idIndexMarker019"/> index is called <strong class="bold">slicing</strong>. You can slice a string by specifying the start index and end index. If we want only the second word, we can do the following: </p>
			<pre> word = 'Hello Madam Flower'
 word [6:11]
'Madam'</pre>
			<p>Getting the first word is similar. Leaving the first index blank means the index starts from zero:</p>
			<pre> word [:5]
'Hello'</pre>
			<p>Leaving the second index blank has a special meaning as well – it means the rest of the string:</p>
			<pre> word [12:]
'Flower'</pre>
			<p>We now know some of the Pythonic NLP operations. Now we can dive into more of spaCy.</p>
			<h2 id="_idParaDest-21"><a id="_idTextAnchor020"/>Getting a high-level overview of the spaCy library</h2>
			<p>spaCy is an open source Python library for <a id="_idIndexMarker020"/>modern NLP. The <a id="_idIndexMarker021"/>creators of spaCy describe their work as <strong class="bold">industrial-strength NLP</strong>, and as a contributor I can assure you it is true. spaCy is shipped with pretrained language models and word vectors for 60+ languages.</p>
			<p>spaCy is focused on production and shipping code, unlike its more academic predecessors. The most famous and frequently used Python predecessor is <strong class="bold">NLTK</strong>. NLTK's main focus was providing students and researchers an idea of language processing. It never put any claims on efficiency, model accuracy, or being an industrial-strength library. spaCy focused on providing production-ready code from the first day. You can expect models to perform on real-world data, the code to be efficient, and the ability to process a huge amount of text data in a reasonable time. The following table is an efficiency comparison from the spaCy documentation (https://spacy.io/usage/facts-figures#speed-comparison):</p>
			<div><div><img src="img/B16570_01_05.jpg" alt="Figure 1.5 – A speed comparison of spaCy and other popular NLP frameworks&#13;&#10;" width="1355" height="544"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.5 – A speed comparison of spaCy and other popular NLP frameworks</p>
			<p>The spaCy code is also <a id="_idIndexMarker022"/>maintained in a professional way, with issues sorted by labels and new releases covering as many fixes as possible. You can always raise an issue on the spaCy GitHub repo at https://github.com/explosion/spaCy, report a bug, or ask for help from the community.</p>
			<p>Another predecessor is <strong class="bold">CoreNLP</strong> (also known as <strong class="bold">StanfordNLP</strong>). CoreNLP is implemented in Java. Though <a id="_idIndexMarker023"/>CoreNLP competes in terms of efficiency, Python won by easy prototyping and spaCy is<a id="_idIndexMarker024"/> much more professional as a software package. The code is well maintained, issues are tracked on GitHub, and every issue is marked with some labels (such as bug, feature, new project). Also, the installation of the library code and the models is easy. Together with providing backward compatibility, this makes spaCy a professional software project. Here is a detailed comparison from the spaCy documentation at https://spacy.io/usage/facts-figures#comparison:</p>
			<div><div><img src="img/B16570_01_06.jpg" alt="Figure 1.6 – A feature comparison of spaCy, NLTK, and CoreNLP &#13;&#10;" width="1460" height="1298"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.6 – A feature comparison of spaCy, NLTK, and CoreNLP </p>
			<p>Throughout this book, we will<a id="_idIndexMarker025"/> be using spaCy's latest releases, <em class="italic">v2.3 </em>and <em class="italic">v3.0</em> (the versions used at the time of writing this book) for all our computational linguistics and ML purposes. The following are the features in the latest release:</p>
			<ul>
				<li>Original data preserving tokenization.</li>
				<li>Statistical sentence segmentation.</li>
				<li>Named entity recognition.</li>
				<li><strong class="bold">Part-of-Speech</strong> (<strong class="bold">POS</strong>) tagging.</li>
				<li>Dependency parsing.</li>
				<li>Pretrained word vectors.</li>
				<li>Easy integration with popular deep learning libraries. spaCy's ML library <code>Thinc</code> provides thin wrappers around PyTorch, TensorFlow, and MXNet. spaCy also provides <a id="_idIndexMarker026"/>wrappers for <code>HuggingFace</code> Transformers by <code>spacy-transformers</code> library. We'll see more of the <code>Transformers</code> in <a href="B16570_09_Final_JM_ePub.xhtml#_idTextAnchor158"><em class="italic">Chapter 9</em></a><em class="italic">, spaCy and Transformers</em>.</li>
				<li>Industrial-level speed.</li>
				<li>A built-in visualizer, displaCy.</li>
				<li>Support for 60+ languages.</li>
				<li>46 state-of-the-art statistical models for 16 languages.</li>
				<li>Space-efficient string data structures.</li>
				<li>Efficient serialization.</li>
				<li>Easy model packaging and usage.</li>
				<li>Large community support.</li>
			</ul>
			<p>We had a quick glance around spaCy as an NLP library and as a software package. We will see what spaCy offers in detail throughout the book.</p>
			<h2 id="_idParaDest-22"><a id="_idTextAnchor021"/>Tips for the reader</h2>
			<p>This book is a practical guide. In order to get the most out of the book, I recommend readers replicate the code in their own Python shell. Without following and performing the code, it is not possible to get a proper understanding of NLP concepts and spaCy methods, which is why we have arranged the upcoming chapters in the following way:</p>
			<ul>
				<li>Explanation of the language/ML concept</li>
				<li>Application code with spaCy</li>
				<li>Evaluation of the outcome</li>
				<li>Challenges of the methodology</li>
				<li>Pro tips and tricks to overcome the challenges</li>
			</ul>
			<h1 id="_idParaDest-23"><a id="_idTextAnchor022"/>Installing spaCy</h1>
			<p>Let's get started by installing and <a id="_idIndexMarker027"/>setting up spaCy. spaCy is compatible with 64-bit Python 2.7 and 3.5+, and can run on Unix/Linux, macOS/OS X, and Windows. <code>pip</code> (https://pypi.org/) and <code>conda</code> (https://conda.io/en/latest/). <code>pip</code> and <code>conda</code> are two of the most popular distribution packages.  </p>
			<p><code>pip</code> is the most painless choice as it installs all the dependencies, so let's start with it.</p>
			<h2 id="_idParaDest-24"><a id="_idTextAnchor023"/>Installing spaCy with pip</h2>
			<p>You can install spaCy with<a id="_idIndexMarker029"/> the following command:</p>
			<pre>$ pip install spacy</pre>
			<p>If you have more than one Python version installed in your system (such as Python 2.8, Python 3.5, Python 3.8, and so on), then select the <code>pip</code> associated with Python you want to use. For instance, if you want to use spaCy with Python 3.5, you can do the following:</p>
			<pre>$ pip3.5 install spacy</pre>
			<p>If you already have spaCy installed on your system, you may want to upgrade to the latest version of spaCy. We're using <em class="italic">spaCy 2.3</em> in this book; you can check which version you have with the following command:</p>
			<pre>$ python –m spacy info</pre>
			<p>This is how a version info output looks like. This has been generated with the help of my Ubuntu machine:</p>
			<div><div><img src="img/B16570_01_07.jpg" alt="Figure 1.7 – An example spaCy version output&#13;&#10;" width="471" height="75"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.7 – An example spaCy version output</p>
			<p>Suppose you want to <a id="_idIndexMarker030"/>upgrade your spaCy version. You can upgrade your spaCy version to the latest available version with the following command:</p>
			<pre>$ pip install –U spacy</pre>
			<h2 id="_idParaDest-25"><a id="_idTextAnchor024"/>Installing spaCy with conda</h2>
			<p><code>conda</code> support is<a id="_idIndexMarker031"/> provided by the conda community. The command for installing spaCy with <code>conda</code> is as follows:</p>
			<pre>$ conda install -c conda-forge spacy </pre>
			<h2 id="_idParaDest-26"><a id="_idTextAnchor025"/>Installing spaCy on macOS/OS X</h2>
			<p>macOS and OS X already <a id="_idIndexMarker032"/>ship with Python. You only need to install a recent version of the Xcode IDE. After installing Xcode, please run the following:</p>
			<pre>$ xcode-select –install</pre>
			<p>This installs the command-line development tools. Then you will be able to follow the preceding <code>pip</code> commands.</p>
			<h2 id="_idParaDest-27"><a id="_idTextAnchor026"/>Installing spaCy on Windows</h2>
			<p>If you have a Windows system, you <a id="_idIndexMarker033"/>need to install a version of Visual<a id="_idIndexMarker034"/> C++ Build Tools or Visual Studio Express that matches your Python distribution. Here are the official distributions and their matching versions, taken from the spaCy installation guide (https://spacy.io/usage#source-windows):</p>
			<div><div><img src="img/B16570_01_08.jpg" alt="Figure 1.8 – Visual Studio and Python distribution compatibility table&#13;&#10;" width="1179" height="421"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.8 – Visual Studio and Python distribution compatibility table</p>
			<p>If you didn't encounter any problems so far, then that means spaCy is installed and running on your system. You should be able to import spaCy into your Python shell:</p>
			<pre> import spacy</pre>
			<p>Now you successfully installed <a id="_idIndexMarker035"/>spaCy – congrats and welcome to the spaCy universe! If you have installation problems please continue to the next section, otherwise you can move on to language model installation.</p>
			<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/>Troubleshooting while installing spaCy</h2>
			<p>There might be cases where <a id="_idIndexMarker036"/>you get issues popping up during the installation process. The good news is, we're using a very popular library so most probably other developers have already encountered the same issues. Most of the issues are listed on <em class="italic">Stack Overflow</em> (<a href="https://stackoverflow.com/questions/tagged/spacy">https://stackoverflow.com/questions/tagged/spacy</a>) and the <em class="italic">spaCy GitHub</em> Issues section (<a href="https://github.com/explosion/spaCy/issues">https://github.com/explosion/spaCy/issues</a>) already. However, in this section, we'll go over the most common issues and their solutions.</p>
			<p>Some of the most common issues are as follows:</p>
			<ul>
				<li><strong class="bold">The Python distribution is incompatible</strong>: In this case please upgrade your Python version accordingly and then do a fresh installation.</li>
				<li><strong class="bold">The upgrade broke spaCy</strong>: Most probably there are some leftover packages in your installation directories. The best solution is to first remove the spaCy package completely by doing the following:<pre><strong class="bold"> pip uninstall spacy</strong></pre><p>Then do a fresh installation by following the installation instructions mentioned.</p></li>
				<li><strong class="bold">You're unable to install spaCy on a Mac</strong>: On a Mac, please make sure that you don't skip the following to make sure you correctly installed the Mac command-line tools and enabled pip:<pre><strong class="bold">$ xcode-select –install</strong></pre></li>
			</ul>
			<p>In general, if you have the correct Python dependencies, the installation process will go smoothly.</p>
			<p>We're all set up <a id="_idIndexMarker037"/>and ready for our first usage of spaCy, so let's go ahead and start using spaCy's language models.</p>
			<h1 id="_idParaDest-29"><a id="_idTextAnchor028"/>Installing spaCy's statistical models</h1>
			<p>The spaCy<a id="_idIndexMarker038"/> installation doesn't come with the statistical language models needed for the spaCy pipeline tasks. spaCy language models contain knowledge about a specific language collected from a set of resources. Language models let us perform a variety of NLP tasks, including <strong class="bold">POS tagging</strong> and <strong class="bold">named-entity recognition</strong> (<strong class="bold">NER</strong>). </p>
			<p>Different languages have different models and are language specific. There are also different models available for the same language. We'll see the differences between those models in detail in the <em class="italic">Pro tip</em> at the end of this section, but basically the training data is different. The underlying statistical algorithm is the same. Some of the currently supported languages are as follows:</p>
			<div><div><img src="img/B16570_01_09.jpg" alt="Figure 1.9 – spaCy models overview&#13;&#10;" width="1461" height="1614"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.9 – spaCy models overview</p>
			<p>The number<a id="_idIndexMarker039"/> of supported languages grows rapidly. You can follow the list of supported languages on the <strong class="bold">spaCy Models and Languages</strong> page (<a href="https://spacy.io/usage/models#languages">https://spacy.io/usage/models#languages</a>). </p>
			<p>Several pretrained models are available for different languages. For English, the following models are available for download: <code>en_core_web_sm</code>, <code>en_core_web_md</code>, and <code>en_core_web_lg</code>. These models use the following naming convention:</p>
			<ul>
				<li><code>en</code> for English, <code>de</code> for German, and so on.</li>
				<li><code>core</code> means a general-purpose model for the vocabulary, syntax, entities, and vectors.</li>
				<li><code>web</code><em class="italic"> </em>(Wikipedia), <code>news</code> (news, media) <code>Twitter</code>, and so on.</li>
				<li><code>lg</code> for large, <code>md</code> for medium, and <code>sm</code> for small. </li>
			</ul>
			<p>Here is what a typical language model looks like:</p>
			<div><div><img src="img/B16570_01_10.jpg" alt="Figure 1.10 – The small-sized spaCy English web model &#13;&#10;" width="1638" height="986"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.10 – The small-sized spaCy English web model </p>
			<p>Large models can require a lot of disk space, for example <code>en_core_web_lg</code> takes up 746 MB, while <code>en_core_web_md</code> needs 48MB and <code>en_core_web_sm</code> takes only 11MB. Medium-sized models work well for many development purposes, so we'll use the English <code>md</code><em class="italic"> </em>model throughout the book.</p>
			<p class="callout-heading">Pro tip</p>
			<p class="callout">It is a good practice to match model genre to your text type. We recommend picking the genre as close as possible to your text. For example, the vocabulary in the social media genre will be very different from that in the Wikipedia genre. You can pick the web genre if you have social media posts, newspaper articles, financial news – that is, more language from daily life. The Wikipedia genre is suitable for rather formal articles, long documents, and technical documents. In case you are not sure which genre is the most suitable, you can download several models and test some example sentences from your own corpus and see how each model performs. </p>
			<p>Now that we're<a id="_idIndexMarker041"/> well-informed about how to choose a model, let's download our first model. </p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>Installing language models</h2>
			<p>Since v1.7.0, spaCy offers a great <a id="_idIndexMarker042"/>benefit: installing the models as Python packages. You can install spaCy models just like any other Python module and make them a part of your Python application. They're properly versioned, so they can go into your <code>requirements.txt</code> file as a dependency. You can install the models from a download URL or a local director manually, or via <code>pip</code>. You can put the model data anywhere on your local filesystem.</p>
			<p>You can download a model via spaCy's <code>download</code> command. <code>download</code> looks for the most compatible model for your spaCy version, and then downloads and installs it. This way you don't need to bother about any potential mismatch between the model and your spaCy version. This is the easiest way to install a model:</p>
			<pre>$ python -m spacy download en_core_web_md</pre>
			<p>The preceding command selects and downloads the most compatible version of this specific model for your local spaCy version. Another option is to do the following:</p>
			<pre>$ python -m spacy download en
$ python –m spacy download de
$ python –m spacy download fr</pre>
			<p>These commands install the most compatible <em class="italic">default </em>model for each language and create a shortcut link. To download the exact model version, the following is what needs to be done (though you often don't need it):</p>
			<pre>$ python -m spacy download en_core_web_lg-2.0.0 --direct</pre>
			<p>The <code>download</code> command deploys <code>pip</code> behind the scenes. When you make a download, <code>pip</code> installs the package and places it in your <code>site-packages</code> directory just as any other installed <a id="_idIndexMarker043"/>Python package.</p>
			<p>After the download, we can load the packages via spaCy's <code>load ()</code> method.</p>
			<p>This is what we did so far:</p>
			<pre>$ pip install spacy
$ python –m spacy download en
 import spacy
 nlp = spacy.load('en_core_web_md')
 doc = nlp('I have a ginger cat.')</pre>
			<p>Alternatively, we can provide the full model name:</p>
			<pre>$ pip install spacy
$ python -m spacy download en_core_web_md
 import spacy
 nlp = spacy.load('en_core_web_md')
 doc = nlp('I have a ginger cat.')</pre>
			<p>We can also download models via <code>pip</code>:</p>
			<ol>
				<li>First, we need the link to the model we want to download. </li>
				<li>We navigate to the model releases (https://github.com/explosion/spacy-models/releases), find the model, and copy the archive file link. </li>
				<li>Then, we do a <code>pip install</code> with the model link. </li>
			</ol>
			<p>Here is an example command for downloading with a custom URL:</p>
			<pre>$ pip install https://github.com/explosion/spacy-models/releases/download/en_core_web_lg-2.0.0/en_core_web_lg-2.0.0.tar.gz</pre>
			<p>You can install a local file as follows:</p>
			<pre>$ pip install /Users/yourself/en_core_web_lg-2.0.0.tar.gz</pre>
			<p>This installs the model into your <code>site-packages</code> directory. Then we run <code>spacy.load()</code> to load the <a id="_idIndexMarker044"/>model via its package name, create a shortcut link to give it a custom name (usually a shorter name), or import it as a module.</p>
			<p>Importing the language model as a module is also possible:</p>
			<pre> import en_core_web_md
 nlp = en_core_web_md.load()
 doc = nlp('I have a ginger cat.')</pre>
			<p class="callout-heading">Pro tip</p>
			<p class="callout">In professional software development, we usually download models as part of an automated pipeline. In this case, it's not feasible to use spaCy's <code>download</code> command; rather, we use <code>pip</code> with the model URL. You can add the model into your <code>requirements.txt</code> file as a package as well.</p>
			<p>How you like to load your models is your choice and also depends on the project requirements you're working on. </p>
			<p>At this point, we're ready to explore the spaCy world. Let's now learn about spaCy's powerful visualization tool, <strong class="bold">displaCy</strong>.</p>
			<h1 id="_idParaDest-31"><a id="_idTextAnchor030"/>Visualization with displaCy</h1>
			<p><strong class="bold">Visualization</strong> is an important tool that should <a id="_idIndexMarker045"/>be in every data scientist's toolbox. Visualization is the easiest way to explain some concepts to your colleagues, your boss, and any technical or non-technical audience. Visualization of language data is specifically useful and allows you to identify patterns in your data at a glance.</p>
			<p>There are many Python libraries and plugins such as <em class="italic">Matplotlib</em>, <em class="italic">seaborn</em>, <em class="italic">TensorBoard</em>, and so on. Being an industrial library, spaCy comes with its own visualizer – <code>Doc</code> object. We'll start by exploring the easiest way – using displaCy's interactive demo.</p>
			<h2 id="_idParaDest-32"><a id="_idTextAnchor031"/>Getting started with displaCy</h2>
			<p>Go ahead <a id="_idIndexMarker046"/>and navigate to <a href="https://explosion.ai/demos/displacy">https://explosion.ai/demos/displacy</a> to use the interactive demo. Enter your text in the <strong class="bold">Text to parse</strong> box and then click the search icon on the right to<a id="_idIndexMarker047"/> generate the visualization. The result might look like the following:</p>
			<div><div><img src="img/B16570_01_11.jpg" alt="Figure 1.11 – displaCy's online demo&#13;&#10;" width="1123" height="597"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.11 – displaCy's online demo</p>
			<p>The visualizer performs two syntactic parses, POS tagging, and a <strong class="bold">dependency parse</strong>, on the submitted text to visualize the sentence's syntactic structure. Don't worry about how POS tagging and dependency parsing work, as we'll explore them in the upcoming chapters. For now, just think of the result as a sentence structure.</p>
			<p>You'll notice two tick boxes, <strong class="bold">Merge Punctuation</strong> and <strong class="bold">Merge Phrases</strong>. Merging punctuation merges the punctuation tokens into the previous token and serves a more compact visualization (it works like a charm on long documents). </p>
			<p>The second option, <code>They were beautiful and healthy kids with strong appetites.</code> It contains two noun phrases, <code>beautiful and healthy kids</code> and <code>strong appetite</code>. If we merge them, the result is as follows:</p>
			<div><div><img src="img/B16570_01_12.jpg" alt="Figure 1.12 – An example parse with noun phrases merged&#13;&#10;" width="1043" height="463"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.12 – An example parse with noun phrases merged</p>
			<p>Without merging, every<a id="_idIndexMarker048"/> adjective and noun are shown individually:</p>
			<div><div><img src="img/B16570_01_13.jpg" alt="Figure 1.13 – A parse of the same sentence, unmerged&#13;&#10;" width="1386" height="661"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.13 – A parse of the same sentence, unmerged</p>
			<p>The second parse is a bit too <a id="_idIndexMarker049"/>cumbersome and difficult to read. If you work on a text with long sentences such as law articles or Wikipedia entries, we definitely recommend merging.</p>
			<p>You can choose a statistical model from the <strong class="bold">Model</strong> box on the right for the currently supported languages. This option allows you to play around with the language models without having to download and install them on your local machine.</p>
			<h2 id="_idParaDest-33"><a id="_idTextAnchor032"/>Entity visualizer</h2>
			<p>displaCy's entity visualizer highlights the named <a id="_idIndexMarker050"/>entities in your text. The online demo lives at <a href="https://explosion.ai/demos/displacy-ent/">https://explosion.ai/demos/displacy-ent/</a>. We didn't go through named entities yet, but you can think of them as proper nouns for important entities such as people's names, company names, dates, city and country names, and so on. Extracting entities will be covered in <a href="B16570_03_Final_JM_ePub.xhtml#_idTextAnchor055"><em class="italic">Chapter 3</em></a>,<em class="italic"> Linguistic Features</em>, and <a href="B16570_04_Final_JM_ePub.xhtml#_idTextAnchor069"><em class="italic">Chapter 4</em></a>,<em class="italic"> Rule-Based Matching</em>, in detail.</p>
			<p>The online demo works <a id="_idIndexMarker051"/>similar to the syntactic parser demo. Enter your text into the textbox and hit the search button. Here is an example:</p>
			<div><div><img src="img/B16570_01_14.jpg" alt="Figure 1.14 – An example entity visualization&#13;&#10;" width="505" height="252"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.14 – An example entity visualization</p>
			<p>The right side contains tick boxes for entity types. You can tick the boxes that match your text type such as, for instance, <strong class="bold">MONEY</strong> and <strong class="bold">QUANTITY</strong> for a financial text. Again, just like in the syntactic parser demo, you can choose from the available models. </p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/>Visualizing within Python</h2>
			<p>With the introduction <a id="_idIndexMarker052"/>of the latest version of spaCy, the displaCy visualizers are integrated into the core library. This means that you can start using displaCy immediately after installing spaCy on your machine! Let's go through some examples.</p>
			<p>The following code segment is the easiest way to spin up displaCy on your local machine:</p>
			<pre> import spacy
 from spacy import displacy
 nlp = spacy.load('en_core_web_md')
 doc= nlp('I own a ginger cat.')
 displacy.serve(doc, style='dep')</pre>
			<p>As you can see from the<a id="_idIndexMarker053"/> preceding snippet, the following is what we did:</p>
			<ol>
				<li value="1">We import <code>spaCy</code>. </li>
				<li>Following that, we import <code>displaCy</code> from the core library.</li>
				<li>We load the English model that we downloaded in the <em class="italic">Installing spaCy's statistical models</em> section. </li>
				<li>Once it is loaded, we create a <code>Doc</code> object to pass to <code>displaCy</code>.</li>
				<li>We then started the <code>displaCy</code> web server via calling <code>serve()</code>.</li>
				<li>We also passed <code>dep</code> to the <code>style</code> parameter to see the dependency parsing result.</li>
			</ol>
			<p>After firing up this code, you should see a response from displaCy as follows:</p>
			<div><div><img src="img/B16570_01_15.jpg" alt="Figure 1.15 – Firing up displaCy locally&#13;&#10;" width="481" height="86"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.15 – Firing up displaCy locally</p>
			<p>The response is added along with a link, <code>http://0.0.0.0:5000</code>, this is the local address where displaCy renders your graphics. Please click the link and navigate to the web page. You should see the following:</p>
			<div><div><img src="img/B16570_01_16.jpg" alt="Figure 1.16 – View the result visualization in your browser&#13;&#10;" width="382" height="202"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.16 – View the result visualization in your browser</p>
			<p>This means that displaCy <a id="_idIndexMarker054"/>generated a dependency parse result visualization and rendered it on your localhost. After you're finished with displaying the visual and you want to shut down the server, you can press <em class="italic">Ctrl </em>+<em class="italic">C</em> to shut down the displaCy server and go back to the Python shell:</p>
			<div><div><img src="img/B16570_01_17.jpg" alt="Figure 1.17 – Shutting down the displaCy server&#13;&#10;" width="495" height="102"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.17 – Shutting down the displaCy server</p>
			<p>After shutting down, you won't be able to visualize more examples, but you'll continue seeing the results you already generated.</p>
			<p>If you wish to use another port or you get an error because the port <code>5000</code> is already in use, you can use the <code>port</code> parameter of displaCy with another port number. Replacing the last line of the preceding code block with the following line will suffice:</p>
			<pre>displacy.serve(doc, style='dep', port= '5001')</pre>
			<p>Here, we provide the port number <code>5001</code> explicitly. In this case, displaCy will render the graphics on <code>http://0.0.0.0:5001</code>.</p>
			<p>Generating an entity recognizer is <a id="_idIndexMarker055"/>done similarly. We pass <code>ent</code> to the <code>style</code> parameter instead of <code>dep</code>:</p>
			<pre> import spacy
 from spacy import displacy
 nlp = spacy.load('en_core_web_md')
 doc= nlp('Bill Gates is the CEO of Microsoft.')
 displacy.serve(doc, style='ent')</pre>
			<p>The result should look like the following:</p>
			<div><div><img src="img/B16570_01_18.jpg" alt="Figure 1.18 – The entity visualization is displayed on your browser&#13;&#10;" width="385" height="154"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.18 – The entity visualization is displayed on your browser</p>
			<p>Let's move on to other platforms we can use for displaying the results.</p>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/>Using displaCy in Jupyter notebooks</h2>
			<p>Jupyter notebook is an<a id="_idIndexMarker056"/> important part of daily data science work. Fortunately, displaCy can spot whether you're currently coding in a Jupyter notebook environment and returns markup that can be directly displayed in a cell. </p>
			<p>If you don't have Jupyter notebook installed on your system but wish to use it, you can follow the instructions at <a href="https://test-jupyter.readthedocs.io/en/latest/install.html">https://test-jupyter.readthedocs.io/en/latest/install.html</a>.</p>
			<p>This time we'll call <code>render()</code> instead of <code>serve()</code>. The rest of the code is the same. You can type/paste the following code into your Jupyter notebook:</p>
			<pre>import spacy
from spacy import displacy
nlp = spacy.load('en_core_web_md')
doc= nlp('Bill Gates is the CEO of Microsoft.')
displacy.render(doc, style='dep')</pre>
			<p>The result should look like the following:</p>
			<div><div><img src="img/B16570_01_19.jpg" alt="Figure 1.19 – displaCy rendering results in a Jupyter notebook&#13;&#10;" width="815" height="690"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.19 – displaCy rendering results in a Jupyter notebook</p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/>Exporting displaCy graphics as an image file</h2>
			<p>Often, we need to <a id="_idIndexMarker057"/>export the graphics that we generated with displaCy as image files to place them into presentations, articles, or papers. We can call displaCy in this case as well:</p>
			<pre> import spacy
 from spacy import displacy
 from pathlib import Path
 nlp = spacy.load('en_core_web_md')
 doc = nlp('I'm a butterfly.')
 svg = displacy.render(doc, style='dep', jupyter=False)
 filename = 'butterfly.svg'
  output_path = Path ('/images/' + file_name)
 output_path.open('w', encoding='utf-8').write(svg)</pre>
			<p>We import <code>spaCy</code> and <code>displaCy</code>. We load the English language model, then create a <code>Doc</code> object as usual. Then we call <code>displacy.render()</code> and capture the output to the <code>svg</code> variable. The rest is writing the <code>svg</code> variable to a file called <code>butterfly.svg</code>.</p>
			<p>We have reached the <a id="_idIndexMarker058"/>end of the visualization chapter here. We created good-looking visuals and learned the details of creating visuals with displaCy. If you wish to find out how to use different background images, background colors, and fonts, you can visit the displaCy documentation at <a href="http://spacy.io/usage/visualizers">http://spacy.io/usage/visualizers</a>. </p>
			<p>Often, we need to create visuals with different colors and styling, and the displaCy documentation contains detailed information about styling. The documentation also includes how to embed displaCy into your web applications. spaCy is well documented as a project and the documentation contains everything we need!</p>
			<h1 id="_idParaDest-37"><a id="_idTextAnchor036"/>Summary</h1>
			<p>This chapter gave you an introduction to NLP with Python and spaCy. You now have a brief idea about why to use Python for language processing and the reasons to prefer spaCy for creating your NLP applications. We also got started on our spaCy journey by installing spaCy and downloading language models. This chapter also introduced us to the visualization tool – displaCy.</p>
			<p>In the next chapter, we will continue our exciting spaCy journey with spaCy core operations such as tokenization and lemmatization. It'll be our first encounter with spaCy features in detail. Let's go ahead and explore more together!</p>
		</div>
	</div></body></html>