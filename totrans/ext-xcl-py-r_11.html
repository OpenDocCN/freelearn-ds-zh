<html><head></head><body>
		<div id="_idContainer130">
			<h1 id="_idParaDest-196" class="chapter-number"><a id="_idTextAnchor215"/>11</h1>
			<h1 id="_idParaDest-197"><a id="_idTextAnchor216"/>Calling R/Python Locally from Excel Directly or via an API</h1>
			<p>In this chapter, we are going to discuss calling R and Python from within Excel. You may ask yourself why you would want to do that when there are many functions inside of Excel that one can use or, if so desired, can write with the VBA portion of the application. One reason why you might want to call R or Python from Excel is to leverage the power and flexibility of these programming languages for data analysis and visualization. Excel is a widely used spreadsheet application that can handle large datasets and perform basic calculations and functions. However, Excel has some limitations when it comes to more advanced or customized tasks, such as statistical modeling, machine learning, web scraping, natural language processing, and so on. By calling R or Python from Excel, you can access the rich libraries and packages that these languages offer and use them to manipulate, transform, and visualize your data in more sophisticated ways. You can also automate your workflows and create reproducible reports and dashboards. Calling R or Python from Excel can enhance your productivity and efficiency, as well as expand your <span class="No-Break">analytical capabilities.</span></p>
			<p>We will be a bit different here. In this chapter, we will cover two (very) different methods for calling R and Python from Excel: local calls, where R or Python is installed on the same machine, and running and using API calls, where the R or Python functionality is deployed to a server as an API endpoint. For the latter, we will have a look at open-source tools and some of the most popular <span class="No-Break">commercial solutions.</span></p>
			<h1 id="_idParaDest-198"><a id="_idTextAnchor217"/>Technical requirements</h1>
			<p>In this chapter, you can find all the code on GitHub at the following <span class="No-Break">link: </span><a href="https://github.com/PacktPublishing/Extending-Excel-with-Python-and-R/tree/main/Chapter%2011"><span class="No-Break">https://github.com/PacktPublishing/Extending-Excel-with-Python-and-R/tree/main/Chapter%2011</span></a><span class="No-Break">.</span></p>
			<p>You will need to install the following <span class="No-Break">external software:</span></p>
			<ul>
				<li>BERT, which can be found <span class="No-Break">here: </span><a href="http://bert-toolkit.com/download-bert"><span class="No-Break">http://bert-toolkit.com/download-bert</span></a></li>
				<li>Python and <strong class="source-inline">xlwings</strong> (refer to the <em class="italic">Setting up an </em><span class="No-Break"><em class="italic">environment </em></span><span class="No-Break">section)</span></li>
				<li><strong class="source-inline">plumber </strong><span class="No-Break">for R</span></li>
				<li>FastAPI <span class="No-Break">for Python</span></li>
			</ul>
			<p>Let’s begin with the <span class="No-Break">first part.</span></p>
			<h1 id="_idParaDest-199"><a id="_idTextAnchor218"/>Calling R and Python from Excel locally</h1>
			<p>In this first part of the<a id="_idIndexMarker897"/> chapter, we are going to learn about<a id="_idIndexMarker898"/> using the +or Excel that can interface with R directly, along with <strong class="source-inline">xlwings </strong>to interact with Python from Excel. We will also quickly show how one can use a VBA script to call R from Excel. In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Why you would want to call R/Python from <span class="No-Break">Excel locally</span></li>
				<li>Setting up <span class="No-Break">an environment</span></li>
				<li>Calling R/Python directly <span class="No-Break">from Excel</span></li>
			</ul>
			<p><span class="No-Break">Let’s begin!</span></p>
			<h1 id="_idParaDest-200"><a id="_idTextAnchor219"/>Why you would want to call R/Python from Excel locally</h1>
			<p>As we discussed in the opening, it is possible<a id="_idIndexMarker899"/> to do a wide variety of analysis<a id="_idIndexMarker900"/> and programming in Excel via the use of VBA. However, this can be tedious to write and difficult to implement. By harnessing the power of <strong class="source-inline">BERT </strong>and <strong class="source-inline">xlwings</strong>, you can use an already rich landscape of functions that are ready to go or write your own in those languages and use them <span class="No-Break">in Excel.</span></p>
			<p>With <strong class="source-inline">BERT</strong>, you get the power of R in Excel: R is a powerful statistical programming language with a wide range of capabilities. <strong class="source-inline">BERT </strong>allows you to use these capabilities directly in Excel without having to switch to a separate R environment. This can be very convenient if you are already working in Excel and don’t want to leave <span class="No-Break">the application.</span></p>
			<p><strong class="source-inline">BERT </strong>allows you to write R functions that can be used as custom Excel functions. This can be useful for creating functions that are not available in Excel or for improving the performance of existing Excel functions. For example, you can create a Brownian motion by using <strong class="source-inline">BERT </strong>to call a function built inside of R, which is going to be much easier to code in R than it would <span class="No-Break">in Excel.</span></p>
			<p>What <strong class="source-inline">BERT </strong>is for R, <strong class="source-inline">xlwings </strong>is for Python. The benefits<a id="_idIndexMarker901"/> are analogous<a id="_idIndexMarker902"/> as well: create your solution in Python and call it from <span class="No-Break">Excel directly.</span></p>
			<p>Let’s start with setting up your environment so you can get your <span class="No-Break">hands dirty!</span></p>
			<h1 id="_idParaDest-201"><a id="_idTextAnchor220"/>Setting up an environment</h1>
			<p>Since setting up an environment for <strong class="source-inline">BERT</strong> and <strong class="source-inline">xlwings</strong> is non-trivial, we will walk you through the process in detail in the <span class="No-Break">coming subsections.</span></p>
			<h2 id="_idParaDest-202"><a id="_idTextAnchor221"/>Steps to set up BERT for R</h2>
			<p>In this section, we will cover<a id="_idIndexMarker903"/> the installation<a id="_idIndexMarker904"/> of <strong class="source-inline">BERT</strong> for Windows so that we can utilize <strong class="source-inline">BERT </strong>to manipulate Excel from inside of R. The first thing that we will have to do is download the <strong class="source-inline">BERT </strong>installer, which<a id="_idIndexMarker905"/> can be obtained from <span class="No-Break">here: </span><a href="https://bert-toolkit.com/download-bert"><span class="No-Break">https://bert-toolkit.com/download-bert</span></a><span class="No-Break">.</span></p>
			<p>Once this is downloaded, you can then install it as you would any other program. Once installed, you can then use the <strong class="bold">Add-ins </strong>ribbon from Excel to open the <strong class="bold">BERT Console</strong>, as <span class="No-Break">shown here:</span></p>
			<div>
				<div id="_idContainer118" class="IMG---Figure">
					<img src="image/B19142_11_01.jpg" alt="Figure 11.1 – BERT Console from the Add-ins ribbon in Excel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – BERT Console from the Add-ins ribbon in Excel</p>
			<p>Once you see it, click<a id="_idIndexMarker906"/> the button, and the console<a id="_idIndexMarker907"/> will open, as <span class="No-Break">shown here:</span></p>
			<div>
				<div id="_idContainer119" class="IMG---Figure">
					<img src="image/B19142_11_02.jpg" alt="Figure 11.2 – The BERT Console"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – The BERT Console</p>
			<p>Now, let’s move <span class="No-Break">to Python.</span></p>
			<h2 id="_idParaDest-203"><a id="_idTextAnchor222"/>Steps to set up xlwings for Python</h2>
			<p>In this subsection, we will cover<a id="_idIndexMarker908"/> the steps<a id="_idIndexMarker909"/> required to set <span class="No-Break">up </span><span class="No-Break"><strong class="source-inline">xlwings</strong></span><span class="No-Break">:</span></p>
			<h3>Installing Python</h3>
			<p>Ensure that Python<a id="_idIndexMarker910"/> is installed on your machine. You can download the latest version<a id="_idIndexMarker911"/> from the official Python website (<a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a>). During installation, you can check the box that says <strong class="bold">Add Python to PATH </strong>for <span class="No-Break">easier access.</span></p>
			<h4>Installing Excel add-ins:</h4>
			<p>Follow these simple steps<a id="_idIndexMarker912"/> to get started <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">xlwings</strong></span><span class="No-Break">:</span></p>
			<ol>
				<li>Open a command prompt and run <span class="No-Break">the following:</span><pre class="source-code">
<strong class="bold">pip install xlwings</strong></pre><p class="list-inset">You may receive a warning along the lines of this: <strong class="source-inline">WARNING: The script xlwings.exe is installed in '&lt;folder&gt;' which is not on PATH</strong>. If you do, you will have to specify the full path to be able to call <strong class="source-inline">xlwings </strong>in the <span class="No-Break">next step.</span></p></li>				<li>To install the add-in, use the <span class="No-Break">command-line client:</span><pre class="source-code">
<strong class="bold">xlwings addin install(Re)start Excel</strong></pre></li>				<li>In Excel, open the VBA editor, then go to the <strong class="bold">Tools </strong>menu, open <strong class="bold">References </strong>and click the checkbox for <strong class="bold">xlwings</strong>. Click <strong class="bold">OK </strong>and head back to Excel. This step is not necessary for every user; first, check if the ribbon is already available after <span class="No-Break">restarting Excel!</span><p class="list-inset">The <strong class="source-inline">xlwings</strong> add-in will appear<a id="_idIndexMarker913"/> after the <strong class="bold">Help </strong>menu in <span class="No-Break">the toolbar:</span></p></li>
			</ol>
			<div>
				<div id="_idContainer120" class="IMG---Figure">
					<img src="image/B19142_11_03.jpg" alt="Figure 11.3 – xlwings in the ribbon in Excel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – xlwings in the ribbon in Excel</p>
			<h4>Configuring the Excel and Python environment</h4>
			<p>Configure <strong class="source-inline">xlwings</strong> by specifying the Python<a id="_idIndexMarker914"/> interpreter path in the Excel add-ins settings. However, this is typically done automatically <span class="No-Break">by </span><span class="No-Break"><strong class="source-inline">xlwings</strong></span><span class="No-Break">.</span></p>
			<p>To verify the setup, run any of the examples given in the <span class="No-Break">next section.</span></p>
			<h4>Troubleshooting</h4>
			<p>If you encounter issues, refer<a id="_idIndexMarker915"/> to the documentation for <strong class="source-inline">xlwings</strong> (<a href="https://docs.xlwings.org/en/stable/">https://docs.xlwings.org/en/stable/</a>). Check for common troubleshooting<a id="_idIndexMarker916"/> tips <span class="No-Break">and solutions.</span></p>
			<p>This step-by-step guide ensures a smooth setup of your local environment, enabling Excel and Python to work seamlessly together. Following these instructions will provide a solid foundation for the subsequent<a id="_idIndexMarker917"/> chapters, allowing you to harness the combined power of Excel <span class="No-Break">and Python.</span></p>
			<p>Now that you have set up, let’s get to the meat of how to actually use <span class="No-Break">these tools!</span></p>
			<h1 id="_idParaDest-204"><a id="_idTextAnchor223"/>Calling R/Python directly from Excel</h1>
			<p>In this section, we will dig<a id="_idIndexMarker918"/> into the ways<a id="_idIndexMarker919"/> you can call R and Python from Excel using the tools set up in the previous section. We will cover several ways of achieving this and give examples so that you can try them out <span class="No-Break">as well.</span></p>
			<h2 id="_idParaDest-205"><a id="_idTextAnchor224"/>Executing R with VBA and BERT</h2>
			<p>Another great way of calling<a id="_idIndexMarker920"/> R from Excel<a id="_idIndexMarker921"/> is via the VBA<a id="_idIndexMarker922"/> macro. This requires<a id="_idIndexMarker923"/> that a workbook be saved as a macro-enabled workbook. Since BERT is designed to work from Excel to R, the syntax of an R expression can be written in the VBA console and called with the following <span class="No-Break">in VBA:</span></p>
			<pre class="console">
Application.Run "BERT.Exec", r</pre>			<p>Let’s look at an <span class="No-Break">easy example:</span></p>
			<pre class="source-code">
Sub PlotNormalDensity()
    r = "plot(density(rnorm(1000)))"
    Application.Run "BERT.Exec", r
End Sub</pre>			<p>This will end up producing a plot<a id="_idIndexMarker924"/> of the density<a id="_idIndexMarker925"/> of a random<a id="_idIndexMarker926"/> normal<a id="_idIndexMarker927"/> distribution. Let’s see <span class="No-Break">the output:</span></p>
			<div>
				<div id="_idContainer121" class="IMG---Figure">
					<img src="image/B19142_11_04.jpg" alt="Figure 11.4 – Using BERT to call R from VBA"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Using BERT to call R from VBA</p>
			<h2 id="_idParaDest-206"><a id="_idTextAnchor225"/>Interacting with Excel via BERT</h2>
			<p>It is possible to manipulate<a id="_idIndexMarker928"/> Excel with BERT<a id="_idIndexMarker929"/> using the <strong class="bold">Excel Scripting Interface</strong>. You may ask yourself, “Why would<a id="_idIndexMarker930"/> I want to do such a thing”? Well, remember, with BERT, you have access to not only Excel but R as well. This means that you can use R functions that may not exist in Excel to generate data; let’s see an example. This was done in the <span class="No-Break">left pane.</span></p>
			<p>First, we will define <span class="No-Break">a range:</span></p>
			<pre class="source-code">
rng &lt;- EXCEL$Application$get_Range( "A1:B4" )</pre>			<p>This will define a range<a id="_idIndexMarker931"/> in R for the<a id="_idIndexMarker932"/> cells <strong class="source-inline">A1:B4 </strong>and will place it in the global environment as a variable called <strong class="source-inline">rng</strong>. This was typed into BERT’s R interface. Now that this range is defined, it is possible to see how many range commands are at your fingertips and what some of <span class="No-Break">them are:</span></p>
			<pre class="source-code">
&gt; length(ls(rng))
[1] 234
&gt; head(ls(rng))
[1] "Activate"                        "AddComment"
                   "AddCommentThreaded"
[4] "AdvancedFilter"         "AllocateChanges"       "ApplyNames"</pre>			<p>So, we see that there are 234 range commands available. By calling <strong class="source-inline">ls(rng)</strong>, the R console will print out all of the commands; here, we use <strong class="source-inline">head()</strong> so that only the first few are shown. Here, we are going to use the <strong class="source-inline">RAND()</strong> Excel command to place random numbers into the <span class="No-Break">defined range:</span></p>
			<pre class="source-code">
rng$put_Formula("=RAND()");</pre>			<p>Let’s take a look at the output in the <span class="No-Break">Excel file:</span></p>
			<div>
				<div id="_idContainer122" class="IMG---Figure">
					<img src="image/B19142_11_05.jpg" alt="Figure 11.5 – Using the RAND() function from BERT in Excel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Using the RAND() function from BERT in Excel</p>
			<p>If we want to stay inside of BERT<a id="_idIndexMarker933"/> and see the values that were sent to Excel, we can<a id="_idIndexMarker934"/> do <span class="No-Break">the following:</span></p>
			<pre class="source-code">
&gt; rng$get_Value()
                        [,1]            [,2]
[1,] 0.63474248 0.7993663
[2,] 0.55409965 0.4134328
[3,] 0.86992109 0.7948257
[4,] 0.07100827 0.9219299</pre>			<p>Now that we have gone over some basics of how to work with Excel via R, it is time to see how we can achieve similar things <span class="No-Break">in Python.</span></p>
			<h1 id="_idParaDest-207"><a id="_idTextAnchor226"/>Calling Python from Excel using xlwings</h1>
			<p>You have three options<a id="_idIndexMarker935"/> to call Python from Excel <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">xlwings</strong></span><span class="No-Break">:</span></p>
			<ul>
				<li>The <strong class="source-inline">Run</strong> button under the <strong class="source-inline">xlwings </strong>tab of <span class="No-Break">the ribbon</span></li>
				<li>Macros: These call Python <span class="No-Break">from Excel</span></li>
				<li><strong class="bold">User Defined Functions </strong>(<strong class="bold">UDFs</strong>) (<span class="No-Break">Windows only)</span></li>
			</ul>
			<p>Let’s have a look at the pros and cons of all three, as well as <span class="No-Break">an example!</span></p>
			<h2 id="_idParaDest-208"><a id="_idTextAnchor227"/>The Run button</h2>
			<p>The <strong class="source-inline">Run</strong> button expects<a id="_idIndexMarker936"/> a function called <strong class="source-inline">main </strong>in a Python<a id="_idIndexMarker937"/> module with the same name as your workbook. This is a quote from the documentation and a hard prerequisite. The main benefit of this method is that there is no VBA and no macros; you can use a normal XLSX file, which can be very useful in security-restricted situations where XLSM files are <span class="No-Break">not allowed.</span></p>
			<p>To try out the <strong class="source-inline">Run </strong>button, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Create a Python module called <strong class="source-inline">sumitup.py </strong>with the <span class="No-Break">following code:</span><pre class="source-code">
import xlwings as xw
def main():
            wb = xw.Book.caller()
            a = wb.sheets[0]['A1'].value
            b = wb.sheets[0]['A2'].value
            wb.sheets[0]['A3'].value = a + b
            pass</pre></li>				<li>Open Excel and fill cell A1 with <strong class="source-inline">2 </strong>and cell A2 <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">3</strong></span><span class="No-Break">.</span></li>
				<li>Save the Excel sheet as <strong class="source-inline">sumitup.xlsx</strong> in the same folder where <strong class="source-inline">sumitup.py</strong> <span class="No-Break">is saved.</span></li>
				<li>Click the <strong class="source-inline">Run </strong>button in the <strong class="source-inline">xlwings</strong> menu in <span class="No-Break">the Ribbon.</span></li>
			</ol>
			<p>The cons of this method are the strict naming convention and file placement, and the lack of flexibility; only the function <strong class="source-inline">main()</strong> will be called, and the Python code needs to encode which fields will be used as input and where the output will go, meaning you cannot pass on inputs<a id="_idIndexMarker938"/> to the function<a id="_idIndexMarker939"/> from the <span class="No-Break">Excel side.</span></p>
			<h2 id="_idParaDest-209"><a id="_idTextAnchor228"/>Macros</h2>
			<p>If you require more<a id="_idIndexMarker940"/> flexibility, and you<a id="_idIndexMarker941"/> can use a macro (and save your file as XLSM), you can use <strong class="source-inline">RunPython</strong> <span class="No-Break">from VBA.</span></p>
			<p>In this example, <strong class="source-inline">RunPython</strong> will import the <strong class="source-inline">world </strong>module and run the <strong class="source-inline">helloworld() </strong>function from that module. To run this example, try the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Create a <strong class="source-inline">.xlsm </strong>file and save it <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">world.xlsm</strong></span><span class="No-Break">.</span></li>
				<li>Open the VBA editor and try <span class="No-Break">the following:</span><ol><li class="upper-roman">Open <strong class="bold">References </strong>from the <strong class="bold">Tools </strong>menu and make sure <strong class="source-inline">xlwings </strong><span class="No-Break">is checked:</span></li></ol></li>
			</ol>
			<p class="IMG---Figure">    </p>
			<div>
				<div id="_idContainer123" class="IMG---Figure">
					<img src="image/B19142_11_06.jpg" alt="Figure 11.6 – Adding the xlwings reference to the VBA project"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Adding the xlwings reference to the VBA project</p>
			<ol>
				<li class="upper-roman" value="2">Create a new macro<a id="_idIndexMarker942"/> in the file<a id="_idIndexMarker943"/> with <strong class="source-inline">Sub</strong> <span class="No-Break">as follows:</span><pre class="source-code">
  Sub HelloWorld()
           RunPython "import world; world.helloworld()"
End Sub</pre></li>			</ol>
			<ol>
				<li value="3">Create the <strong class="source-inline">hello.py</strong> module in the same folder where you saved the <strong class="source-inline">.xlsm</strong> file with the <span class="No-Break">following content:</span><pre class="source-code">
import xlwings as xw
def helloworld():
    wb = xw.Book.caller()
    wb.sheets[0]['A1'].value = 'Hello World!'</pre></li>				<li>Now, you can run the macro in <strong class="source-inline">world.xlsm</strong> and see <span class="No-Break">the results!</span></li>
			</ol>
			<p>As you can see, using macros addresses one of the cons of the <strong class="source-inline">Run </strong>button, namely the location and name of the Python module(s) and function(s) used. However, you still cannot pass on inputs directly from the Excel file; the inputs have to be in pre-determined cells in the Excel file, and the output cell(s) have to be pre-determined <span class="No-Break">as well.</span></p>
			<p>Note that you can change both the name of the module (to not match the name of the Excel file) and the location<a id="_idIndexMarker944"/> of the module (i.e., have it saved in a different folder than the <strong class="source-inline">.xlsm</strong> file). From the <strong class="source-inline">xlwings</strong> documentation, it reads<a id="_idIndexMarker945"/> that “<em class="italic">Per default, RunPython expects world.py in the same directory as the Excel file with the same name, but you can change both of these things: if your Python file is in a different folder, add that folder to the PYTHONPATH in the config. If the file has a different name, change the RunPython </em><span class="No-Break"><em class="italic">command accordingly</em></span><span class="No-Break">.”</span></p>
			<h2 id="_idParaDest-210"><a id="_idTextAnchor229"/>UDFs</h2>
			<p>User-defined functions<a id="_idIndexMarker946"/> allow the user to extend Excel<a id="_idIndexMarker947"/> to add custom functions that can be used in the same way as <strong class="source-inline">SUM()</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">IF()</strong></span><span class="No-Break">.</span></p>
			<p>Writing a UDF in Python with <strong class="source-inline">xlwings</strong> is as easy, as <span class="No-Break">seen here:</span></p>
			<pre class="source-code">
import xlwings as xw
import numpy as np
@xw.func
@xw.arg('x', np.array, ndim=2)
@xw.arg('y', np.array, ndim=2)
def matrix_add(x, y):
    return x + y</pre>			<p>In the preceding example, we specify that the inputs are both <strong class="source-inline">numpy</strong> array instances and define the function for <span class="No-Break">matrix addition.</span></p>
			<p>To integrate Python functions into Excel using <strong class="source-inline">xlwings</strong>, you’ll need to set up your Python source file in a specific way. By default, <strong class="source-inline">xlwings</strong> expects a Python source file to be located in the same directory as your Excel file and to have the same name as the Excel file but with a <strong class="source-inline">.py</strong> extension instead <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">.xlsm</strong></span><span class="No-Break">.</span></p>
			<p>Alternatively, you can specify a specific module via the <strong class="bold">UDF Modules </strong>feature in the <span class="No-Break"><strong class="source-inline">xlwings</strong></span><span class="No-Break"> ribbon.</span></p>
			<p>Once you’ve prepared your Python<a id="_idIndexMarker948"/> source file, you can import<a id="_idIndexMarker949"/> the functions into Excel by following <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Save an Excel file with the same name as your Python module and save it as a <strong class="source-inline">.xlsm</strong> file in the same folder where the Python module <span class="No-Break">is located.</span></li>
				<li>In Excel, go to the <strong class="source-inline">xlwings</strong> tab and click on <strong class="bold">Import Python UDFs </strong>to pick up the changes made to your <span class="No-Break">Python module.</span></li>
				<li>Enter the data into two ranges in your Excel sheet (ensure that the dimensions of the ranges are appropriate for <span class="No-Break">matrix multiplication).</span></li>
				<li>In a cell, enter the formula <strong class="source-inline">=matrix_add([range1]</strong>, <strong class="source-inline">[range2])</strong>, where <strong class="source-inline">[range1] </strong>and <strong class="source-inline">[range2]</strong> are the ranges where you have <span class="No-Break">entered data.</span><p class="list-inset">You should see the correct result displayed in <span class="No-Break">the cell:</span></p></li>
			</ol>
			<div>
				<div id="_idContainer124" class="IMG---Figure">
					<img src="image/B19142_11_07.jpg" alt="Figure 11.7 – Using the matrix_add function from xlwings to Excel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Using the matrix_add function from xlwings to Excel</p>
			<p>The pro of this method is self-evident: the Excel user<a id="_idIndexMarker950"/> can determine what inputs<a id="_idIndexMarker951"/> to use and where the output should go without actually interacting with Python (or you, the <span class="No-Break">Python developer).</span></p>
			<p>The con of the method is the generic one for <strong class="source-inline">xlwings</strong> and all similar solutions; for a local Python (or R) installation, all the dependencies must be correctly set up and the correct version must be made available to <span class="No-Break">all users.</span></p>
			<p>Please be aware that UDFs do not work with Python, which is available from the <span class="No-Break">Microsoft Store.</span></p>
			<p>It is noteworthy that alternatives exist, particularly PyXLL, which is a popular alternative to <strong class="source-inline">xlwings</strong>. It provides similar functionality with similar restrictions (including but not limited to not working with Python installed from the <span class="No-Break">Microsoft Store).</span></p>
			<p>In this chapter, you have learned about why and how to call R and Python directly from Excel using the tools <strong class="source-inline">BERT</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">xlwings</strong></span><span class="No-Break">.</span></p>
			<p>In the next part of the chapter, we will look at another way of enacting such integration without the need for a local installation and staying in full control of the code and its version (which can be handy in enterprise settings) but with a need<a id="_idIndexMarker952"/> for a server<a id="_idIndexMarker953"/> <span class="No-Break">environment instead.</span></p>
			<h1 id="_idParaDest-211"><a id="_idTextAnchor230"/>Calling R and Python from Excel via an API</h1>
			<p>An <strong class="bold">API</strong>, or <strong class="bold">Application Programming Interface</strong>, serves as a bridge between<a id="_idIndexMarker954"/> different software<a id="_idIndexMarker955"/> applications, allowing them to communicate and share data in a standardized way. It’s like a waiter at a restaurant who takes your order and conveys it to the kitchen, bringing back the meal once <span class="No-Break">it’s ready.</span></p>
			<p>In the digital world, an API specifies how software components should interact. It defines the methods and data formats that applications can use to request and exchange information. APIs can be used for various purposes, such as accessing web services, databases, or even <span class="No-Break">hardware devices.</span></p>
			<p>One fundamental use of APIs is enabling third-party developers to integrate their applications with existing services or platforms. In the context of your coding interests in R and Python, APIs can be utilized for data retrieval and for exposing your models to other software, <span class="No-Break">including Excel.</span></p>
			<p>The beauty of APIs lies in their versatility. They abstract the complexity of underlying systems, providing a standardized way for developers to interact with them. This abstraction allows for more straightforward development and integration processes, fostering collaboration <span class="No-Break">and innovation.</span></p>
			<p>In essence, APIs are the unsung heroes of the digital world, facilitating seamless communication between diverse software components and enabling the creation of more powerful and interconnected applications. Whether you’re working with data, web services, or other software, understanding and effectively using APIs can significantly enhance your capabilities as <span class="No-Break">a programmer.</span></p>
			<p>In this section, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>An introduction <span class="No-Break">to APIs</span></li>
				<li>Open-source solutions for exposing R and Python as <span class="No-Break">API endpoints</span></li>
				<li>Calling APIs from Excel <span class="No-Break">for integration</span></li>
			</ul>
			<h1 id="_idParaDest-212"><a id="_idTextAnchor231"/>An introduction to APIs</h1>
			<p>You can think of APIs<a id="_idIndexMarker956"/> as a set of rules that will allow one piece of software to interact with another. A quick example of the usage of an API would be the weather app on a smartphone connecting with the weather system to get the current weather or a forecast of <span class="No-Break">the weather.</span></p>
			<p>An easy way to think of an API, besides a mechanism for different systems to communicate, is to think of a contract. The documentation of an API will specify how a system can connect with and talk with the system, what it is allowed to do, and <span class="No-Break">how often.</span></p>
			<p>Systems that maintain an API will often act as a sort of client and server type arrangement. A REST API<a id="_idIndexMarker957"/> is one of the most popular types of API today. <strong class="bold">REST </strong>stands for <strong class="bold">representational state transfer</strong>. The major pro of this type of API is that it is stateless. Statelessness means that servers do not save client data between requests. The requests that are sent to the server will remind you of a URL. A generic REST API call might look like <span class="No-Break">the following:</span></p>
			<pre class="console">
 GET https://example.com/api/v1/users</pre>			<p>You could think of the preceding as obtaining a list of users, and you might think that you would obtain a list because this was a <strong class="source-inline">GET</strong> request. Here is a generic <span class="No-Break"><strong class="source-inline">POST</strong></span><span class="No-Break"> request:</span></p>
			<pre class="source-code">
POST https://example.com/api/v1/users
Content-Type: application/json
{
  "name": "John Doe",
  "email": "john.doe@example.com"
}</pre>			<p>Here, you have posted (<strong class="source-inline">POST</strong>) data to the server. So, with a REST API, think of posting and getting information from and to <span class="No-Break">the server.</span></p>
			<p>Now that we understand what an API is and some of the types and use cases they have, we can now move on to taking a look at open-source solutions for exposing R/Python as an <span class="No-Break">API endpoint.</span></p>
			<h1 id="_idParaDest-213"><a id="_idTextAnchor232"/>Open source solutions for exposing R as API endpoints</h1>
			<p>We are going to start off by first<a id="_idIndexMarker958"/> showing how to expose<a id="_idIndexMarker959"/> R as an API endpoint via the plumber package. The plumber package and its associated documentation<a id="_idIndexMarker960"/> can be found at the following <span class="No-Break">URL: </span><a href="https://www.rplumber.io/index.html"><span class="No-Break">https://www.rplumber.io/index.html</span></a><span class="No-Break">.</span></p>
			<p>The first thing we will do is build out a very simple single-argument API to obtain the histogram of a standard normal distribution. Let’s take a look at the code; we will then discuss what is happening inside <span class="No-Break">of it:</span></p>
			<pre class="source-code">
#* Plot out data from a random normal distribution
#* @param .mean The mean of the standard normal distribution
#* @get /plot
#* @serializer png
function(.mean) {
  mu &lt;- as.numeric(.mean)
  hist(rnorm(n = 1000, mean = mu, sd = 1))
}</pre>			<p>The lines starting with <strong class="source-inline">#* </strong>are comments. In the plumber API, these comments are special and are used for documentation. They describe what the API endpoint does and provide information about the parameters. The first comment introduces the purpose of the API endpoint. It states that the API will generate a plot based on data from a random normal distribution. The line <strong class="source-inline">#* @param .mean The mean of the standard normal deviation </strong>describes a parameter called <strong class="source-inline">.mean</strong>, representing the mean of the standard normal distribution. Parameters in plumber APIs are like inputs that can be passed to the API when making <span class="No-Break">a request.</span></p>
			<p>The following <strong class="source-inline">#* @get /plot </strong>comment specifies that this API endpoint can be accessed using an <strong class="source-inline">HTTP GET </strong>request, and the endpoint path is <strong class="source-inline">/plot</strong>. In simpler terms, if you want to use this API, you’d request something like <a href="http://your-api-url/plot">http://your-api-url/plot</a>. The function is defined as follows: <strong class="source-inline">function(.mean)</strong>; here, the actual R function starts. It takes a parameter, <strong class="source-inline">.mean</strong>, which is the mean of the standard normal distribution. In order for the argument to be passed to the <strong class="source-inline">rnorm() </strong>function itself, we must make sure that we declare it as a numeric data type. We do this internally as follows: <strong class="source-inline">mu &lt;- as.numeric(.mean)</strong>, where the parameter <strong class="source-inline">.mean </strong>is converted to a numeric value and stored in a variable called <strong class="source-inline">mu</strong>. After we convert the argument into a numeric, we can pass it off to <strong class="source-inline">rnorm() </strong>and <strong class="source-inline">hist() </strong>in order to create <span class="No-Break">the plot.</span></p>
			<p>Finally, we are at the point where we generate and plot the data. This is done with the following bit of code: <strong class="source-inline">hist(rnorm(n = 1000, mean = mu, sd = 1))</strong>: This line generates <strong class="source-inline">1000 </strong>random numbers from a normal distribution with the specified mean (<strong class="source-inline">mu</strong>) and standard deviation (<strong class="source-inline">sd = 1</strong>). Then, it creates a histogram of these numbers. Essentially, it’s generating random data and plotting <span class="No-Break">a histogram.</span></p>
			<p>In summary, this plumber<a id="_idIndexMarker961"/> API, when deployed, creates<a id="_idIndexMarker962"/> an endpoint (<strong class="source-inline">/plot</strong>) that, when accessed with a mean value, generates a histogram plot based on random data from a normal distribution. The mean is a parameter that you provide when making a request to this API. It’s a simple yet powerful example of how you can use R and plumber to expose data processing capabilities over <span class="No-Break">the web.</span></p>
			<p>Now that we have generated the code that will produce the API, let’s look at the output once the code is run. To do so, let’s see the <span class="No-Break">following script:</span></p>
			<pre class="source-code">
# Library Load
library(plumber)
# Set dir and file path
wd &lt;- getwd()
sub_dir &lt;- paste0("/Chapter 11/")
full_dir &lt;- paste0(wd, sub_dir)
f &lt;- "plumber_api.R"
f_path &lt;- paste0(full_dir, f)
# Initiate root
root &lt;- pr(f_path)
root
# Plumber router with 1 endpoint, 4 filters, and 0 sub-routers.
# Use `pr_run()` on this object to start the API.
├──[queryString]
├──[body]
├──[cookieParser]
├──[sharedSecret]
└──/plot (GET)</pre>			<p>Let’s give a <span class="No-Break">line-by-line explanation:</span></p>
			<pre class="source-code">
# Library Load
library(plumber)</pre>			<p>This line loads the <strong class="source-inline">plumber</strong> package, which is required to create <span class="No-Break">plumber APIs:</span></p>
			<pre class="source-code">
# Set dir and file path
wd &lt;- getwd()
sub_dir &lt;- paste0("/Chapter 11/")
full_dir &lt;- paste0(wd, sub_dir)
f &lt;- "plumber_api.R"
f_path &lt;- paste0(full_dir, f)</pre>			<p>These lines set<a id="_idIndexMarker963"/> the directory <a id="_idIndexMarker964"/>and file path of the <strong class="source-inline">plumber </strong>API file. The <strong class="source-inline">getwd() </strong>function returns the working directory, which is the current directory that R is using. The <strong class="source-inline">paste0(</strong>) function is used to concatenate strings, so the <strong class="source-inline">sub_dir </strong>variable contains the string <strong class="source-inline">/Chapter11/</strong>, and the <strong class="source-inline">full_dir </strong>variable contains the path to the <strong class="source-inline">/Chapter12/ </strong>directory. The <strong class="source-inline">f </strong>variable contains the filename of the plumber API file, which is <strong class="source-inline">plumber_api.R</strong>. The <strong class="source-inline">f_path </strong>variable contains the full path to the plumber API file, which is the combination of the <strong class="source-inline">full_dir </strong>and <span class="No-Break"><strong class="source-inline">f</strong></span><span class="No-Break"> variables:</span></p>
			<pre class="source-code">
# Initiate root
root &lt;- pr(f_path)</pre>			<p>This line initiates the plumber API by calling the <strong class="source-inline">pr() </strong>function with the <strong class="source-inline">f_path </strong>variable as the argument. The <strong class="source-inline">pr() </strong>function reads the plumber API file and creates a plumber <span class="No-Break">API object:</span></p>
			<pre class="source-code">
root</pre>			<p>This line simply returns the <strong class="source-inline">root </strong>variable, which is the plumber API object. The R code provided creates a plumber API from a file called <strong class="source-inline">plumber_api.R</strong>. The plumber API can then be used to expose R functions as <span class="No-Break">web endpoints.</span></p>
			<p>Let’s use a simple analogy: Imagine<a id="_idIndexMarker965"/> that you have a restaurant<a id="_idIndexMarker966"/> and want to offer a delivery service. You could create a simple website that allows customers to order food online. The website would need to be able to communicate with your restaurant’s kitchen to place orders. In this analogy, the plumber API is like the website, and the R functions are like the restaurant’s kitchen. The plumber API allows you to expose R functions to the outside world so that other applications can communicate with them. Now let’s run the API and see what happens; we do this with the following <span class="No-Break">code: </span><span class="No-Break"><strong class="source-inline">pr_run(root)</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer125" class="IMG---Figure">
					<img src="image/B19142_11_08.jpg" alt="Figure 11.8 – plumber GET API"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – plumber GET API</p>
			<p>We see that when we run<a id="_idIndexMarker967"/> the preceding code, we get a screen<a id="_idIndexMarker968"/> back that will allow us to test out the API; so, let’s do <span class="No-Break">just that.</span></p>
			<p>To do that, we can click on the <strong class="bold">GET </strong>button, as this is a GET API call. When we do that, we get the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer126" class="IMG---Figure">
					<img src="image/B19142_11_09.jpg" alt="Figure 11.9 – Enter arguments for API"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – Enter arguments for API</p>
			<p>We see that we can enter<a id="_idIndexMarker969"/> an argument<a id="_idIndexMarker970"/> to the parameter of <strong class="source-inline">.mean</strong>; let’s enter <strong class="source-inline">10</strong>. First, click the <strong class="bold">Try it out </strong>button, and then you can enter a value; then, you can hit <strong class="bold">Execute</strong>, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer127" class="IMG---Figure">
					<img src="image/B19142_11_10.jpg" alt="Figure 11.10 – Enter the argument and click Execute"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – Enter the argument and click Execute</p>
			<p>Now, let’s hit that <strong class="bold">Execute </strong>button and check<a id="_idIndexMarker971"/> out the output. We get<a id="_idIndexMarker972"/> a couple of things; one is the <span class="No-Break"><strong class="source-inline">curl</strong></span><span class="No-Break"> request:</span></p>
			<pre class="console">
curl -X GET "http://127.0.0.1:9220/plot?.mean=10" -H "accept: image/png"</pre>			<p>Next, we get the <span class="No-Break">request URL:</span></p>
			<pre class="console">
http://127.0.0.1:9220/plot?.mean=10</pre>			<p>Last but not least, we get <span class="No-Break">the histogram:</span></p>
			<div>
				<div id="_idContainer128" class="IMG---Figure">
					<img src="image/B19142_11_11.jpg" alt="Figure 11.11 – The histogram generated by the API call"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – The histogram generated by the API call</p>
			<p>Now that we have learned<a id="_idIndexMarker973"/> how to build and use<a id="_idIndexMarker974"/> the API for R, we will learn how to do the same for Python in the <span class="No-Break">next section.</span></p>
			<h1 id="_idParaDest-214"><a id="_idTextAnchor233"/>Open-source solutions for exposing Python as an API endpoint</h1>
			<p><strong class="source-inline">FastAPI </strong>is a modern, fast (high-performance) web framework<a id="_idIndexMarker975"/> for building APIs<a id="_idIndexMarker976"/> with Python 3.7+ based on standard Python-type hints. It’s easy to use and allows you to create robust <span class="No-Break">APIs quickly.</span></p>
			<p>You can install FastAPI <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">pip</strong></span><span class="No-Break">:</span></p>
			<pre class="console">
pip install fastapi</pre>			<p>The following is a simplified example of creating a <strong class="source-inline">FastAPI </strong>endpoint to expose a <span class="No-Break">Python function:</span></p>
			<pre class="source-code">
from fastapi import FastAPI, Query
app = FastAPI()
@app.get("/api/add")
def add_numbers(
    num1: int = Query(..., description="First number"),
    num2: int = Query(..., description="Second number"),
):
    result = num1 + num2
    return {"result": result}</pre>			<p>In this example, the <strong class="source-inline">add_numbers </strong>function available at the <strong class="source-inline">/api/add </strong>endpoint takes two query parameters (<strong class="source-inline">num1 </strong>and <strong class="source-inline">num2</strong>), representing the numbers to be added. The <strong class="source-inline">Query </strong>function from FastAPI is used to define these parameters with optional descriptions. The result is then calculated, and a JSON response containing the result <span class="No-Break">is returned.</span></p>
			<p>With this example, you can now send a <strong class="source-inline">GET </strong>request to /<strong class="source-inline">api/add?num1=3&amp;num2=4 </strong>to get the result. The <strong class="source-inline">num1 </strong>and <strong class="source-inline">num2 </strong>parameters are specified in the query string of <span class="No-Break">the URL.</span></p>
			<p><strong class="source-inline">FastAPI </strong>automatically generates OpenAPI and JSON Schema documentation, making it convenient for users to understand and interact with <span class="No-Break">your API.</span></p>
			<p>To run the development server, run the following from the <span class="No-Break">command line:</span></p>
			<pre class="console">
uvicorn your_app_name:app --reload</pre>			<p>Replace <strong class="source-inline">your_app_name </strong>with the name of your Python file, keeping in mind that the python file name should be different<a id="_idIndexMarker977"/> than <strong class="source-inline">fastapi</strong> or similar to the previously<a id="_idIndexMarker978"/> <span class="No-Break">installed module.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Ensure that your API is secured, especially if it’s accessible over the internet. <strong class="source-inline">FastAPI </strong>provides features for handling authentication <span class="No-Break">and authorization.</span></p>
			<p>We have covered creating an API for both R and Python. It is time to call the API we have created <span class="No-Break">from Excel!</span></p>
			<h1 id="_idParaDest-215"><a id="_idTextAnchor234"/>Calling APIs from Excel VBA</h1>
			<p>Now, we are going<a id="_idIndexMarker979"/> to go over the code<a id="_idIndexMarker980"/> that will allow us to use a <strong class="source-inline">curl </strong>request to obtain the image from the API that was generated from the <strong class="source-inline">plumber_api.R </strong>file. In order to do this, you will have to run the code from the previous section: <strong class="source-inline">root |&gt; pr_run()</strong>; this is the portion that will open up the swagger dialogue and give you the URL that is running from <strong class="source-inline">plumber</strong>. For me, at the time of this writing, it is as <span class="No-Break">follows: </span><span class="No-Break"><strong class="source-inline">http://127.0.0.1:6855</strong></span><span class="No-Break">.</span></p>
			<p>In this section, we are going to specifically execute the <strong class="source-inline">GET </strong>request via a <strong class="source-inline">curl</strong> command in VBA. Here is the code that will run, and the explanation <span class="No-Break">will follow:</span></p>
			<pre class="source-code">
Sub MakeCurlRequestAndInsertImage()
       ' Define the curl command
       Dim curlCommand As String
       curlCommand = "curl -X GET ""http://127.0.0.1:6855/plot?.mean=0"" -H ""accept: image/png"" -o " &amp; Environ("TEMP") &amp; "\temp_image.png"
       ' Run the curl command using Shell
       Shell "cmd /c " &amp; curlCommand, vbHide
       ' Create a new worksheet or refer to an existing one (Sheet1)
       Dim ws As Worksheet
       Set ws = ActiveWorkbook.Worksheets("Sheet1")
       ' Clear previous content in Sheet1
       ws.Cells.Clear
       ' Insert the image into the worksheet
       ws.Pictures.Insert(Environ("TEMP") &amp; "\temp_image.png").Select
End Sub</pre>			<p>Let’s break down<a id="_idIndexMarker981"/> the code step by step<a id="_idIndexMarker982"/> in <span class="No-Break">simple terms:</span></p>
			<p>Define the <span class="No-Break"><strong class="source-inline">curl</strong></span><span class="No-Break"> command:</span></p>
			<pre class="console">
Dim curlCommand As String
curlCommand = "curl -X GET ""http://127.0.0.1:6855/plot?.mean=0"" -H ""accept: image/png"" -o " &amp; Environ("TEMP") &amp; "\temp_image.png"</pre>			<p>This part creates a variable (<strong class="source-inline">curlCommand</strong>) to store a command-line instruction. The command is essentially telling the computer to use <strong class="source-inline">curl </strong>(a command-line tool for making HTTP requests) to get an image<a id="_idIndexMarker983"/> from the specified web<a id="_idIndexMarker984"/> address (<strong class="source-inline">http://127.0.0.1:6855/plot?.mean=0</strong>). All of this goes on a single line in the VBA editor. The <strong class="source-inline">-H </strong>flag specifies an HTTP header, in this case, telling the server that we accept an image in PNG format. The <strong class="source-inline">-o</strong> flag specifies the output file, and it’s set to save the image in the temporary folder with the <span class="No-Break">name </span><span class="No-Break"><strong class="source-inline">temp_image.png</strong></span><span class="No-Break">.</span></p>
			<p>Run the <strong class="source-inline">curl</strong> command <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">Shell</strong></span><span class="No-Break">:</span></p>
			<pre class="console">
Shell "cmd /c " &amp; curlCommand, vbHide</pre>			<p>This line executes the <strong class="source-inline">curlCommand</strong> using the Windows Command Prompt (<strong class="source-inline">cmd /c</strong>).  The <strong class="source-inline">vbHide</strong> at the end means that the command prompt window will not be visible <span class="No-Break">while executing:</span></p>
			<pre class="source-code">
Create or refer to a worksheet (Sheet1):
Dim ws As Worksheet
Set ws = ActiveWorkbook.Worksheets("Sheet1")</pre>			<p>This part creates a variable (<strong class="source-inline">ws</strong>) to represent a worksheet in Excel. It either creates a new worksheet named <strong class="source-inline">"Sheet1"</strong> or refers to an existing one in the <span class="No-Break">active workbook.</span></p>
			<p>Clear the previous content <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">Sheet1</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
ws.Cells.Clear</pre>			<p>This line removes any existing content in the specified <span class="No-Break">worksheet (</span><span class="No-Break"><strong class="source-inline">"Sheet1"</strong></span><span class="No-Break">).</span></p>
			<p>Insert the image into <span class="No-Break">the worksheet:</span></p>
			<pre class="source-code">
ws.Pictures.Insert(Environ("TEMP") &amp; "\temp_image.png").Select</pre>			<p>This line inserts the image downloaded by the <strong class="source-inline">curl</strong> command into the specified worksheet (<strong class="source-inline">"Sheet1"</strong>). <strong class="source-inline">Environ("TEMP") </strong>refers to the system’s temporary folder. <strong class="source-inline">"\temp_image.png"</strong> is the name of the image file downloaded by the <span class="No-Break"><strong class="source-inline">curl</strong></span><span class="No-Break"> command.</span></p>
			<p>In summary, this VBA code automates the process of using the <strong class="source-inline">curl</strong> command to download an image from a web address and then inserts that image into an Excel worksheet named <strong class="source-inline">Sheet1</strong>. The worksheet<a id="_idIndexMarker985"/> is cleared first to ensure<a id="_idIndexMarker986"/> no previous <span class="No-Break">content remains.</span></p>
			<p>Now, let’s see the output from the <span class="No-Break">VBA script:</span></p>
			<div>
				<div id="_idContainer129" class="IMG---Figure">
					<img src="image/B19142_11_12.jpg" alt="Figure 11.12 – Histogram generated by R from VBA"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Histogram generated by R from VBA</p>
			<p>In this section, you have learned how to create an API via the plumber package in R. You have also learned how to call this API via a curl request inside of an Excel <span class="No-Break">VBA macro.</span></p>
			<p>The beauty of an API-based solution is that Excel (and, in turn, your end-user) does not have to know that the code behind the API is written in R. The same macro could call an API written in Python without <span class="No-Break">any changes!</span></p>
			<p>So, what are the pros and cons of <span class="No-Break">this approach?</span></p>
			<p>The pros have been spelled out previously: no local installation, no need to maintain the R/Python environment for every user, and full control over the code running behind the API. Should you need to update anything, from the R/Python version via the package dependencies to the code itself, you can do this on the server side without involving your <span class="No-Break">end user.</span></p>
			<p>One con is general to all API-based solutions: it requires a server to be set up and maintained, which usually is both too difficult and not allowed for data analysts and data scientists. This means dedicated IT resources <span class="No-Break">are needed.</span></p>
			<p>A con specific to open source solutions for API hosting is one general to all open source solutions: what you save on license fees you pay in having to do more yourself. Open-source API solutions expect you to handle security (see the note at the end of the FastAPI section), the integration with the enterprise landscape (such as user management), and, generally, do <span class="No-Break">everything yourself.</span></p>
			<p>Finally, a con of both <strong class="source-inline">plumber</strong> and <strong class="source-inline">FastAPI</strong> is the need to write custom code to define your API endpoints and functionality. In a single-person team, this is not a big issue other than the hours needed, but in larger teams, this often leads to a fractured landscape where it is difficult<a id="_idIndexMarker987"/> to enforce naming conventions<a id="_idIndexMarker988"/> <span class="No-Break">and standardization.</span></p>
			<p>In the next section of this chapter, we will have a look at some of the most commonly used commercial solutions for hosting R and Python API endpoints and see how they address <span class="No-Break">these questions.</span></p>
			<h2 id="_idParaDest-216"><a id="_idTextAnchor235"/>Commercial API solutions for R and Python</h2>
			<p>In this section, we will cover some of the most commonly used commercial API solutions for R <span class="No-Break">and Python.</span></p>
			<h3>Azure Functions (and similar solutions from the other large cloud providers)</h3>
			<p><strong class="bold">Azure Functions </strong>is a serverless computing service<a id="_idIndexMarker989"/> offered by Microsoft<a id="_idIndexMarker990"/> Azure. It allows you to run event-triggered code without explicitly provisioning or managing infrastructure. You can build APIs, respond to events, and perform various tasks using a wide range of supported languages, including Python <span class="No-Break">and JavaScript:</span></p>
			<ul>
				<li><strong class="bold">Use cases</strong>: Ideal for building lightweight, event-driven<a id="_idIndexMarker991"/> APIs or microservices. Integration with other Azure services provides scalability <span class="No-Break">and flexibility.</span></li>
				<li><strong class="bold">Pro</strong>: A “serverless” infrastructure means<a id="_idIndexMarker992"/> minimal need for <span class="No-Break">IT involvement.</span></li>
				<li><strong class="bold">Con</strong>: Limited flexibility (e.g., choice of R/Python version) and difficulty<a id="_idIndexMarker993"/> in migrating to other<a id="_idIndexMarker994"/> <span class="No-Break">cloud providers.</span></li>
			</ul>
			<h3>Posit Connect</h3>
			<p><strong class="bold">Posit Connect </strong>is a commercial solution designed<a id="_idIndexMarker995"/> to connect R and Python<a id="_idIndexMarker996"/> to Excel. It facilitates the integration of analytics and data science directly into Excel workbooks, allowing users to leverage the power of R and Python within the familiar <span class="No-Break">Excel interface.</span></p>
			<ul>
				<li><strong class="bold">Use cases</strong>: Particularly suitable for organizations<a id="_idIndexMarker997"/> where Excel is a primary tool for data analysis, providing a seamless way to enhance Excel’s capabilities with <span class="No-Break">advanced analytics.</span></li>
				<li><strong class="bold">Pro</strong>: A deeply integrated <a id="_idIndexMarker998"/>ecosystem for Posit solutions, including RStudio, Quarto, and <span class="No-Break">Shiny Pro.</span></li>
				<li><strong class="bold">Con</strong>: It utilizes plumber and FastAPI/Flask, so<a id="_idIndexMarker999"/> you will need to write custom code to define your API, leading to the drawbacks discussed under the open source API solutions. Only Linux servers are supported, both on-premise <span class="No-Break">and in-cloud.</span></li>
			</ul>
			<h3>ownR Infinity platform</h3>
			<p><strong class="bold">ownR Infinity </strong>is a versatile platform designed<a id="_idIndexMarker1000"/> to empower R and Python<a id="_idIndexMarker1001"/> functionalities within a user-friendly environment. Enabling the creation of personalized functions and models transforms them into accessible APIs, with a particular focus on seamless integration <span class="No-Break">within Excel.</span></p>
			<ul>
				<li><strong class="bold">Use cases</strong>: Suited for organizations<a id="_idIndexMarker1002"/> heavily reliant on R and Python for advanced data analytics. Perfect for users seeking to augment Excel’s capabilities with statistical and data <span class="No-Break">analysis features.</span></li>
				<li><strong class="bold">Pros</strong>: Provides a user-friendly interface<a id="_idIndexMarker1003"/> for leveraging the capabilities of R and Python without extensive programming knowledge. Enables seamless integration of R and Python functionalities across <span class="No-Break">various environments.</span></li>
				<li><strong class="bold">Con</strong>: Only Linux servers are<a id="_idIndexMarker1004"/> supported, both on-premises <span class="No-Break">and in-cloud.</span></li>
			</ul>
			<p>For an example of how to use an ownR API from Excel, you can download an example workbook from <span class="No-Break">here: </span><a href="https://bitbucket.org/functionalanalytics/examples/src/master/ccy%20converter%20Excel%20demo%20button.xlsm"><span class="No-Break">https://bitbucket.org/functionalanalytics/examples/src/master/ccy%20converter%20Excel%20demo%20button.xlsm</span></a><span class="No-Break">.</span></p>
			<p>The example uses a hosted<a id="_idIndexMarker1005"/> API for the following code <span class="No-Break">base: </span><a href="https://bitbucket.org/functionalanalytics/converter/src/master/"><span class="No-Break">https://bitbucket.org/functionalanalytics/converter/src/master/</span></a></p>
			<p>Note that there is no need to write custom code beyond the pure Python code (or R code) and no need to add security, deployment, and other considerations manually, as these are automatically added <span class="No-Break">by ownR.</span></p>
			<p>These commercial solutions provide high levels of integration and features for connecting Python and R with Excel and other frontends, catering to diverse use cases and preferences within the analytics and data <span class="No-Break">science community.</span></p>
			<p>The pros of commercial solutions compared to open source ones boil down to the level of support and handholding with things such as out-of-the-box security, deeper and easier integration with the wider enterprise landscape, and a dedicated support organization in case <span class="No-Break">of problems.</span></p>
			<p>The con is an obvious one: these solutions <a id="_idIndexMarker1006"/>have license fees that require a dedicated<a id="_idIndexMarker1007"/> budget. While all these companies aim at pricing in a way that the reduction of manual work and increased added value justify the price tag, a discussion with the budget holders is <span class="No-Break">never easy.</span></p>
			<h1 id="_idParaDest-217"><a id="_idTextAnchor236"/>Summary</h1>
			<p>In this chapter, you have learned ways to call R and Python from Excel instead of the other way around to empower your end users even further. We have covered the reasons for doing so and two very different approaches: calling R and Python locally and via an <span class="No-Break">API endpoint.</span></p>
			<p>For locally calling R and Python, we covered <strong class="source-inline">BERT</strong> and <strong class="source-inline">xlwings</strong> in detail, from setting up and testing the environment via creating R and Python solutions up to and including how to call those solutions from Excel using the various methods provided by <strong class="source-inline">BERT</strong> and <strong class="source-inline">xlwings</strong>, such as VBA code <span class="No-Break">and UDFs.</span></p>
			<p>Next, you learned about API endpoints and the benefits of using an API endpoint to connect Python and R to Excel. We discussed the pros and cons of such a setup and then delved into the two flavors of API hosting: open source tools and commercial solutions. We have covered the two most used open source setups: plumber for R and FastAPI for Python. Finally, we had a look at commercial solutions for hosting R and Python <span class="No-Break">API endpoints.</span></p>
			<p>The next (and last) chapter will cover a more domain-oriented topic: data analysis and visualization with Python and R <span class="No-Break">in Excel.</span></p>
		</div>
	

		<div id="_idContainer131" class="Content">
			<h1 id="_idParaDest-218" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor237"/>Part 5: Data Analysis and Visualization with R and Python for Excel Data – A Case Study</h1>
		</div>
		<div id="_idContainer132">
			<p>Delve into the world of data analysis and visualization within Excel using the power of Python and R. Through a captivating case study, you will discover how to leverage these versatile programming languages to uncover insights, visualize data, and drive informed decision-making directly <span class="No-Break">within Excel.</span></p>
			<p>This part has the <span class="No-Break">following chapter:</span></p>
			<ul>
				<li><a href="B19142_12.xhtml#_idTextAnchor238"><em class="italic">Chapter 12</em></a>, <em class="italic">Data Analysis and Visualization with R and Python in Excel – A Case Study</em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer133">
			</div>
		</div>
		<div>
			<div id="_idContainer134" class="Basic-Graphics-Frame">
			</div>
		</div>
	</body></html>