["```py\n> library(catdata)\n> data(deathpenalty)\n> library(vcdExtra)\n> deathpenalty.expand <- expand.dft(deathpenalty)\n> binom.model.0 <- glm(DeathPenalty ~ DefendantRace,\n+   data = deathpenalty.expand, family = binomial)\n> summary(binom.model.0)\n\nDeviance Residuals: \n Min       1Q   Median       3Q      Max \n-0.4821  -0.4821  -0.4821  -0.4044   2.2558 \n\nCoefficients:\n Estimate Std. Error z value Pr(>|z|) \n(Intercept)    -2.4624     0.2690  -9.155   <2e-16 ***\nDefendantRace   0.3689     0.3058   1.206    0.228 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n Null deviance: 440.84  on 673  degrees of freedom\nResidual deviance: 439.31  on 672  degrees of freedom\nAIC: 443.31\n\nNumber of Fisher Scoring iterations: 5\n\n```", "```py\n> exp(cbind(OR = coef(binom.model.0), confint(binom.model.0)))\n OR      2.5 %    97.5 %\n(Intercept)   0.08522727 0.04818273 0.1393442\nDefendantRace 1.44620155 0.81342472 2.7198224\n\n```", "```py\n> binom.model.1 <- update(binom.model.0, . ~ . + VictimRace)\n> summary(binom.model.1)\n\nDeviance Residuals: \n Min       1Q   Median       3Q      Max \n-0.7283  -0.4899  -0.4899  -0.2326   2.6919 \n\nCoefficients:\n Estimate Std. Error z value Pr(>|z|) \n(Intercept)    -3.5961     0.5069  -7.094 1.30e-12 ***\nDefendantRace  -0.8678     0.3671  -2.364   0.0181 * \nVictimRace      2.4044     0.6006   4.003 6.25e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n Null deviance: 440.84  on 673  degrees of freedom\nResidual deviance: 418.96  on 671  degrees of freedom\nAIC: 424.96\n\nNumber of Fisher Scoring iterations: 6\n\n> exp(cbind(OR = coef(binom.model.1), confint(binom.model.1)))\n OR       2.5 %      97.5 %\n(Intercept)    0.02743038 0.008433309  0.06489753\nDefendantRace  0.41987565 0.209436976  0.89221877\nVictimRace    11.07226549 3.694532608 41.16558028\n\n```", "```py\n> prop.table(table(factor(deathpenalty.expand$VictimRace,\n+              labels = c(\"VictimRace=0\", \"VictimRace=1\")),\n+            factor(deathpenalty.expand$DefendantRace, \n+              labels = c(\"DefendantRace=0\", \"DefendantRace=1\"))), 1)\n\n DefendantRace=0 DefendantRace=1\n VictimRace=0      0.89937107      0.10062893\n VictimRace=1      0.09320388      0.90679612\n\n```", "```py\n> library(lmtest)\n> lrtest(binom.model.1)\nLikelihood ratio test\n\nModel 1: DeathPenalty ~ DefendantRace + VictimRace\nModel 2: DeathPenalty ~ 1\n #Df  LogLik Df  Chisq Pr(>Chisq) \n1   3 -209.48 \n2   1 -220.42 -2 21.886  1.768e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n```", "```py\n> library(BaylorEdPsych)\n> PseudoR2(binom.model.1)\n McFadden     Adj.McFadden        Cox.Snell       Nagelkerke \n 0.04964600       0.03149893       0.03195036       0.06655297\nMcKelvey.Zavoina           Effron            Count        Adj.Count \n 0.15176608       0.02918095               NA               NA \n AIC    Corrected.AIC \n 424.95652677     424.99234766 \n\n```", "```py\n> lrtest(binom.model.0, binom.model.1)\nLikelihood ratio test\n\nModel 1: DeathPenalty ~ DefendantRace\nModel 2: DeathPenalty ~ DefendantRace + VictimRace\n #Df  LogLik Df Chisq Pr(>Chisq) \n1   2 -219.65 \n2   3 -209.48  1 20.35   6.45e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n```", "```py\n> dfa <- readRDS('SMART_2013.RData')\n\n```", "```py\n> (ct <- xtabs(~model+failure, data=dfa))\n failure\nmodel             0    1    2    3    4    5    8\n HGST          136    1    0    0    0    0    0\n Hitachi      2772   72    6    0    0    0    0\n SAMSUNG       125    0    0    0    0    0    0\n ST1500DL001    38    0    0    0    0    0    0\n ST1500DL003   213   39    6    0    0    0    0\n ST1500DM003    84    0    0    0    0    0    0\n ST2000DL001    51    4    0    0    0    0    0\n ST2000DL003    40    7    0    0    0    0    0\n ST2000DM001    98    0    0    0    0    0    0\n ST2000VN000    40    0    0    0    0    0    0\n ST3000DM001   771  122   34   14    4    2    1\n ST31500341AS 1058   75    8    0    0    0    0\n ST31500541AS 1010  106    7    1    0    0    0\n ST32000542AS  803   12    1    0    0    0    0\n ST320005XXXX  209    1    0    0    0    0    0\n ST33000651AS  323   12    0    0    0    0    0\n ST4000DM000   242   22   10    2    0    0    0\n ST4000DX000   197    1    0    0    0    0    0\n TOSHIBA       126    2    0    0    0    0    0\n WDC          1874   27    1    2    0    0    0\n\n```", "```py\n> dfa <- dfa[dfa$model %in% names(which(rowSums(ct) - ct[, 1] > 0)),]\n\n```", "```py\n> library(ggplot2)\n> ggplot(rbind(dfa, data.frame(model='All', dfa[, -1] )), \n+   aes(failure)) + ylab(\"log(count)\") + \n+   geom_histogram(binwidth = 1, drop=TRUE, origin = -0.5)  + \n+   scale_y_log10() + scale_x_continuous(breaks=c(0:10)) + \n+   facet_wrap( ~ model, ncol = 3) +\n+   ggtitle(\"Histograms by manufacturer\") + theme_bw()\n\n```", "```py\n> poiss.base <- glm(failure ~ model, offset(log(freq)),\n+   family = 'poisson', data = dfa)\n> summary(poiss.base)\n\nDeviance Residuals: \n Min       1Q   Median       3Q      Max \n-2.7337  -0.8052  -0.5160  -0.3291  16.3495 \n\nCoefficients:\n Estimate Std. Error z value Pr(>|z|) \n(Intercept)        -5.0594     0.5422  -9.331  < 2e-16 ***\nmodelHitachi        1.7666     0.5442   3.246  0.00117 ** \nmodelST1500DL003    3.6563     0.5464   6.692 2.20e-11 ***\nmodelST2000DL001    2.5592     0.6371   4.017 5.90e-05 ***\nmodelST2000DL003    3.1390     0.6056   5.183 2.18e-07 ***\nmodelST3000DM001    4.1550     0.5427   7.656 1.92e-14 ***\nmodelST31500341AS   2.7445     0.5445   5.040 4.65e-07 ***\nmodelST31500541AS   3.0934     0.5436   5.690 1.27e-08 ***\nmodelST32000542AS   1.2749     0.5570   2.289  0.02208 * \nmodelST320005XXXX  -0.4437     0.8988  -0.494  0.62156 \nmodelST33000651AS   1.9533     0.5585   3.497  0.00047 ***\nmodelST4000DM000    3.8219     0.5448   7.016 2.29e-12 ***\nmodelST4000DX000  -12.2432   117.6007  -0.104  0.91708 \nmodelTOSHIBA        0.2304     0.7633   0.302  0.76279 \nmodelWDC            1.3096     0.5480   2.390  0.01686 * \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n Null deviance: 22397  on 9858  degrees of freedom\nResidual deviance: 17622  on 9844  degrees of freedom\nAIC: 24717\n\nNumber of Fisher Scoring iterations: 15\n\n```", "```py\n> contrasts(dfa$model, sparse = TRUE)\nHGST         . . . . . . . . . . . . . .\nHitachi      1 . . . . . . . . . . . . .\nST1500DL003  . 1 . . . . . . . . . . . .\nST2000DL001  . . 1 . . . . . . . . . . .\nST2000DL003  . . . 1 . . . . . . . . . .\nST3000DM001  . . . . 1 . . . . . . . . .\nST31500341AS . . . . . 1 . . . . . . . .\nST31500541AS . . . . . . 1 . . . . . . .\nST32000542AS . . . . . . . 1 . . . . . .\nST320005XXXX . . . . . . . . 1 . . . . .\nST33000651AS . . . . . . . . . 1 . . . .\nST4000DM000  . . . . . . . . . . 1 . . .\nST4000DX000  . . . . . . . . . . . 1 . .\nTOSHIBA      . . . . . . . . . . . . 1 .\nWDC          . . . . . . . . . . . . . 1\n\n```", "```py\n> exp(1.7666)\n[1] 5.850926\n\n```", "```py\n> lrtest(poiss.base)\nLikelihood ratio test\n\nModel 1: failure ~ model\nModel 2: failure ~ 1\n #Df LogLik  Df  Chisq Pr(>Chisq) \n1  15 -12344 \n2   1 -14732 -14 4775.8  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n```", "```py\n> library(MASS)\n> model.negbin.0 <- glm.nb(failure ~ model,\n+  offset(log(freq)), data = dfa)\n\n```", "```py\n> lrtest(poiss.base,model.negbin.0)\nLikelihood ratio test\n\nModel 1: failure ~ model\nModel 2: failure ~ model\n #Df LogLik Df Chisq Pr(>Chisq) \n1  15 -12344 \n2  16 -11950  1 787.8  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n```", "```py\n> model.negbin.1 <- update(model.negbin.0, . ~ . + capacity_bytes + \n+   age_month + temperature)\n> model.negbin.2 <- update(model.negbin.1, . ~ . + PendingSector)\n> lrtest(model.negbin.0, model.negbin.1, model.negbin.2)\nLikelihood ratio test\n\nModel 1: failure ~ model\nModel 2: failure ~ model + capacity_bytes + age_month + temperature\nModel 3: failure ~ model + capacity_bytes + age_month + temperature + \n PendingSector\n #Df LogLik Df  Chisq Pr(>Chisq) \n1  16 -11950 \n2  19 -11510  3 878.91  < 2.2e-16 ***\n3  20 -11497  1  26.84  2.211e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n```", "```py\n> summary(model.negbin.2)\n\nDeviance Residuals: \n Min       1Q   Median       3Q      Max \n-2.7147  -0.7580  -0.4519  -0.2187   9.4018 \n\nCoefficients:\n Estimate Std. Error z value Pr(>|z|) \n(Intercept)       -8.209e+00  6.064e-01 -13.537  < 2e-16 ***\nmodelHitachi       2.372e+00  5.480e-01   4.328 1.50e-05 ***\nmodelST1500DL003   6.132e+00  5.677e-01  10.801  < 2e-16 ***\nmodelST2000DL001   4.783e+00  6.587e-01   7.262 3.81e-13 ***\nmodelST2000DL003   5.313e+00  6.296e-01   8.440  < 2e-16 ***\nmodelST3000DM001   4.746e+00  5.470e-01   8.677  < 2e-16 ***\nmodelST31500341AS  3.849e+00  5.603e-01   6.869 6.49e-12 ***\nmodelST31500541AS  4.135e+00  5.598e-01   7.387 1.50e-13 ***\nmodelST32000542AS  2.403e+00  5.676e-01   4.234 2.29e-05 ***\nmodelST320005XXXX  1.377e-01  9.072e-01   0.152   0.8794 \nmodelST33000651AS  2.470e+00  5.631e-01   4.387 1.15e-05 ***\nmodelST4000DM000   3.792e+00  5.471e-01   6.931 4.17e-12 ***\nmodelST4000DX000  -2.039e+01  8.138e+03  -0.003   0.9980 \nmodelTOSHIBA       1.368e+00  7.687e-01   1.780   0.0751 . \nmodelWDC           2.228e+00  5.563e-01   4.006 6.19e-05 ***\ncapacity_bytes     1.053e-12  5.807e-14  18.126  < 2e-16 ***\nage_month          4.815e-02  2.212e-03  21.767  < 2e-16 ***\ntemperature       -5.427e-02  3.873e-03 -14.012  < 2e-16 ***\nPendingSectoryes   2.240e-01  4.253e-02   5.267 1.39e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for Negative Binomial(0.8045) family taken to be 1)\n\n Null deviance: 17587  on 9858  degrees of freedom\nResidual deviance: 12525  on 9840  degrees of freedom\nAIC: 23034\n\nNumber of Fisher Scoring iterations: 1\n\n Theta:  0.8045 \n Std. Err.:  0.0525 \n\n 2 x log-likelihood:  -22993.8850.\n\n```", "```py\n> exp(data.frame(exp_coef = coef(model.negbin.2)))\n exp_coef\n(Intercept)       2.720600e-04\nmodelHitachi      1.071430e+01\nmodelST1500DL003  4.602985e+02\nmodelST2000DL001  1.194937e+02\nmodelST2000DL003  2.030135e+02\nmodelST3000DM001  1.151628e+02\nmodelST31500341AS 4.692712e+01\nmodelST31500541AS 6.252061e+01\nmodelST32000542AS 1.106071e+01\nmodelST320005XXXX 1.147622e+00\nmodelST33000651AS 1.182098e+01\nmodelST4000DM000  4.436067e+01\nmodelST4000DX000  1.388577e-09\nmodelTOSHIBA      3.928209e+00\nmodelWDC          9.283970e+00\ncapacity_bytes    1.000000e+00\nage_month         1.049329e+00\ntemperature       9.471743e-01\nPendingSectoryes  1.251115e+00\n\n```", "```py\n> dfa$model <- relevel(dfa$model, 'WDC')\n\n```", "```py\n> model.negbin.3 <- update(model.negbin.2, data = dfa)\n> library(broom)\n> format(tidy(model.negbin.3), digits = 4)\n term   estimate std.error statistic    p.value\n1        (Intercept) -5.981e+00 2.173e-01 -27.52222 9.519e-167\n2          modelHGST -2.228e+00 5.563e-01  -4.00558  6.187e-05\n3       modelHitachi  1.433e-01 1.009e-01   1.41945  1.558e-01\n4   modelST1500DL003  3.904e+00 1.353e-01  28.84295 6.212e-183\n5   modelST2000DL001  2.555e+00 3.663e-01   6.97524  3.054e-12\n6   modelST2000DL003  3.085e+00 3.108e-01   9.92496  3.242e-23\n7   modelST3000DM001  2.518e+00 9.351e-02  26.92818 1.028e-159\n8  modelST31500341AS  1.620e+00 1.069e-01  15.16126  6.383e-52\n9  modelST31500541AS  1.907e+00 1.016e-01  18.77560  1.196e-78\n10 modelST32000542AS  1.751e-01 1.533e-01   1.14260  2.532e-01\n11 modelST320005XXXX -2.091e+00 7.243e-01  -2.88627  3.898e-03\n12 modelST33000651AS  2.416e-01 1.652e-01   1.46245  1.436e-01\n13  modelST4000DM000  1.564e+00 1.320e-01  11.84645  2.245e-32\n14  modelST4000DX000 -1.862e+01 1.101e+03  -0.01691  9.865e-01\n15      modelTOSHIBA -8.601e-01 5.483e-01  -1.56881  1.167e-01\n16    capacity_bytes  1.053e-12 5.807e-14  18.12597  1.988e-73\n17         age_month  4.815e-02 2.212e-03  21.76714 4.754e-105\n18       temperature -5.427e-02 3.873e-03 -14.01175  1.321e-44\n19  PendingSectoryes  2.240e-01 4.253e-02   5.26709  1.386e-07\n\n```", "```py\n> library(data.table)\n> dfa <- data.table(dfa)\n> dfa[, temp6 := cut2(temperature, g = 6)]\n> temperature.weighted.mean <- dfa[, .(wfailure = \n+     weighted.mean(failure, freq)), by = temp6] \n> ggplot(temperature.weighted.mean, aes(x = temp6, y = wfailure)) + \n+     geom_bar(stat = 'identity') + xlab('Categorized temperature') +\n+     ylab('Weighted mean of disk faults') + theme_bw()\n\n```", "```py\n> model.negbin.4 <- update(model.negbin.0, .~. + capacity_bytes +\n+   age_month + temp6 + PendingSector, data = dfa)\n> AIC(model.negbin.3,model.negbin.4)\n df      AIC\nmodel.negbin.3 20 23033.88\nmodel.negbin.4 24 22282.47\n\n```", "```py\n> weighted.means <- rbind(\n+     dfa[, .(l = 'capacity', f = weighted.mean(failure, freq)),\n+         by = .(v = capacity_bytes)],\n+     dfa[, .(l = 'age', f = weighted.mean(failure, freq)),\n+         by = .(v = age_month)])\n\n```", "```py\n> ggplot(weighted.means, aes(x = l, y = f)) + geom_step() +\n+   facet_grid(. ~ v, scales = 'free_x') + theme_bw() +\n+   ylab('Weighted mean of disk faults') + xlab('')\n\n```", "```py\n> dfa[, capacity_bytes := as.factor(capacity_bytes)]\n> dfa[, age8 := cut2(age_month, g = 8)]\n> model.negbin.5 <- update(model.negbin.0, .~. + capacity_bytes +\n+   age8 + temp6 + PendingSector, data = dfa)\n\n```", "```py\n> AIC(model.negbin.5, model.negbin.4)\n df      AIC\nmodel.negbin.5 33 22079.47\nmodel.negbin.4 24 22282.47\n\n```", "```py\n> format(tidy(model.negbin.5), digits = 3)\n term estimate std.error statistic   p.value\n1                  (Intercept)  -6.1648  1.84e-01 -3.34e+01 2.69e-245\n2                    modelHGST  -2.4747  5.63e-01 -4.40e+00  1.10e-05\n3                 modelHitachi  -0.1119  1.21e-01 -9.25e-01  3.55e-01\n4             modelST1500DL003  31.7680  7.05e+05  4.51e-05  1.00e+00\n5             modelST2000DL001   1.5216  3.81e-01  3.99e+00  6.47e-05\n6             modelST2000DL003   2.1055  3.28e-01  6.43e+00  1.29e-10\n7             modelST3000DM001   2.4799  9.54e-02  2.60e+01 5.40e-149\n8            modelST31500341AS  29.4626  7.05e+05  4.18e-05  1.00e+00\n9            modelST31500541AS  29.7597  7.05e+05  4.22e-05  1.00e+00\n10           modelST32000542AS  -0.5419  1.93e-01 -2.81e+00  5.02e-03\n11           modelST320005XXXX  -2.8404  7.33e-01 -3.88e+00  1.07e-04\n12           modelST33000651AS   0.0518  1.66e-01  3.11e-01  7.56e-01\n13            modelST4000DM000   1.2243  1.62e-01  7.54e+00  4.72e-14\n14            modelST4000DX000 -29.6729  2.55e+05 -1.16e-04  1.00e+00\n15                modelTOSHIBA  -1.1658  5.48e-01 -2.13e+00  3.33e-02\n16 capacity_bytes1500301910016 -27.1391  7.05e+05 -3.85e-05  1.00e+00\n17 capacity_bytes2000398934016   1.8165  2.08e-01  8.73e+00  2.65e-18\n18 capacity_bytes3000592982016   2.3515  1.88e-01  1.25e+01  8.14e-36\n19 capacity_bytes4000787030016   3.6023  2.25e-01  1.60e+01  6.29e-58\n20                 age8[ 5, 9)  -0.5417  7.55e-02 -7.18e+00  7.15e-13\n21                 age8[ 9,14)  -0.0683  7.48e-02 -9.12e-01  3.62e-01\n22                 age8[14,19)   0.3499  7.24e-02  4.83e+00  1.34e-06\n23                 age8[19,25)   0.7383  7.33e-02  1.01e+01  7.22e-24\n24                 age8[25,33)   0.5896  1.14e-01  5.18e+00  2.27e-07\n25                 age8[33,43)   1.5698  1.05e-01  1.49e+01  1.61e-50\n26                 age8[43,60]   1.9105  1.06e-01  1.81e+01  3.59e-73\n27                temp6[22,24)   0.7582  5.01e-02  1.51e+01  8.37e-52\n28                temp6[24,27)   0.5005  4.78e-02  1.05e+01  1.28e-25\n29                temp6[27,30)   0.0883  5.40e-02  1.64e+00  1.02e-01\n30                temp6[30,33)  -1.0627  9.20e-02 -1.15e+01  7.49e-31\n31                temp6[33,50]  -1.5259  1.37e-01 -1.11e+01  1.23e-28\n32            PendingSectoryes   0.1301  4.12e-02  3.16e+00  1.58e-03\n\n```", "```py\n> tmnb5 <- tidy(model.negbin.5)\n> str(terms <- tmnb5$term[tmnb5$p.value < 0.05][-1])\n chr [1:22] \"modelHGST\" \"modelST2000DL001\" \"modelST2000DL003\" ...\n\n```", "```py\n> library(plyr)\n> ci <- ldply(terms, function(t) confint(model.negbin.5, t))\n\n```", "```py\n> names(ci) <- c('min', 'max')\n> ci$term <- terms\n> ci$variable <- sub('[A-Z0-9\\\\]\\\\[,() ]*$', '', terms, perl = TRUE)\n\n```", "```py\n> ggplot(ci, aes(x = factor(term), color = variable)) + \n+     geom_errorbar(ymin = min, ymax = max) + xlab('') +\n+     ylab('Coefficients (95% conf.int)') + theme_bw() + \n+     theme(axis.text.x = element_text(angle = 90, hjust = 1),\n+         legend.position = 'top')\n\n```", "```py\n> PseudoR2(model.negbin.6 )\n McFadden     Adj.McFadden        Cox.Snell       Nagelkerke \n 0.3352654        0.3318286        0.4606953        0.5474952 \nMcKelvey.Zavoina           Effron            Count        Adj.Count \n NA        0.1497521        0.9310444       -0.1943522 \n AIC    Corrected.AIC \n 12829.5012999    12829.7044941 \n\n```"]