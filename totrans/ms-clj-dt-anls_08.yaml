- en: Chapter 8. A/B Testing – Statistical Experiments for the Web
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章。A/B 测试 – 网络的统计实验
- en: One of the most common uses of statistics on the Internet right now is **A/B
    testing**. This acts as an aid to design and increase interactions with users
    in a data-driven way. It's used all over the Web, and there have been some high-profile
    instances of these techniques being written about in blogs and articles online.
    For instance, there were several descriptions of how Baraka Obama's 2012 US Presidential
    campaign used A/B testing to increase both donations and how many people signed
    up for the e-mail updates.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 目前在互联网上，统计学最常见的一种应用就是**A/B 测试**。它作为一种辅助工具，以数据驱动的方式设计和增加与用户的互动。它在整个网络上都得到了应用，并且一些关于这些技术被在线博客和文章报道的高知名度实例。例如，有几篇描述了巴拉克·奥巴马2012年美国总统竞选如何使用A/B测试来增加捐款以及有多少人注册了电子邮件更新。
- en: 'Over the course of this chapter, we''ll look at the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的整个过程中，我们将探讨以下主题：
- en: Defining A/B testing
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义 A/B 测试
- en: Conducting an A/B test
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进行 A/B 测试
- en: Analyzing the results
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析结果
- en: By the end, we'll have simulated a small A/B test to measure a click-through
    on two different versions of text for a button.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将模拟一个小型的A/B测试来衡量按钮两个不同版本文本的点击率。
- en: Defining A/B testing
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定义 A/B 测试
- en: At its most fundamental level, A/B testing just involves creating two different
    versions of a web page. Sometimes, the changes are major redesigns of the site
    or the user experience, but usually, the changes are as simple as changing the
    text on a button. Then, for a short period of time, new visitors are randomly
    shown one of the two versions of the page. The site tracks their behavior, and
    the experiment determines whether one version or the other increases the users'
    interaction with the site. This may mean more click-through, more purchases, or
    any other measurable behavior.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在最基本层面上，A/B 测试只是创建两个不同的网页版本。有时，这些变化是网站或用户体验的重大重新设计，但通常，这些变化只是简单地更改按钮上的文本。然后，在短时间内，新访客随机看到页面的两个版本之一。网站跟踪他们的行为，实验确定哪个版本或另一个版本增加了用户与网站的互动。这可能意味着更多的点击率，更多的购买，或任何其他可衡量的行为。
- en: This is similar to other methods in other domains that use different names.
    The basic framework randomly tests two or more groups simultaneously and is sometimes
    called random-controlled experiments or online-controlled experiments. It's also
    sometimes referred to as split testing, as the participants are split into two
    groups.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 这与其他领域使用不同名称的其他方法类似。基本框架随机测试两个或多个组同时进行，有时被称为随机对照实验或在线对照实验。它有时也被称为拆分测试，因为参与者被分成两组。
- en: These are all examples of **between-subjects experiment design**. Experiments
    that use these designs all split the participants into two groups. One group,
    the control group, gets the original environment. The other group, the test group,
    gets the modified environment that those conducting the experiment are interested
    in testing.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 这些都是**被试间实验设计**的例子。使用这些设计的所有实验都将参与者分成两组。一组是对照组，得到原始环境。另一组是测试组，得到实验者感兴趣测试的修改后的环境。
- en: Experiments of this sort can be **single-blind** or **double-blind**. In single-blind
    experiments, the subjects don't know which group they belong to. In double-blind
    experiments, those conducting the experiments also don't know which group the
    subjects they're interacting with belong to. This safeguards the experiments against
    biases that can be introduced by participants being aware of which group they
    belong to. For example, participants could get more engaged if they believe they're
    in the test group because this is *newer* in some way. Or, an experimenter could
    treat a subject differently in a subtle way because of the group that they belong
    to.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 这种类型的实验可以是**单盲**或**双盲**。在单盲实验中，受试者不知道自己属于哪个组。在双盲实验中，进行实验的人也不知道他们互动的受试者属于哪个组。这可以保护实验免受参与者意识到自己属于哪个组可能引入的偏差。例如，如果参与者认为他们属于测试组，因为这在某种程度上是“新的”，他们可能会更加投入。或者，实验者可能会因为受试者所属的组而微妙地以不同的方式对待他们。
- en: As the computer is the one that directly conducts the experiment, and because
    those visiting your website aren't aware of which group they belong to, website
    A/B testing is generally an example of double-blind experiments.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 由于计算机是直接进行实验的，而且访问你网站的人并不知道自己属于哪个组，因此网站A/B测试通常是一个双盲实验的例子。
- en: Of course, this is an argument for only conducting the test on new visitors.
    Otherwise, the user might recognize that the design has changed and throw the
    experiment away. For example, the users may be more likely to click on a new button
    when they recognize that the button is, in fact, new. However, if they are new
    to the site as a whole, then the button itself may not stand out enough to warrant
    extra attention.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这是一个只对新访客进行测试的论点。否则，用户可能会意识到设计已经改变，从而放弃实验。例如，当用户意识到按钮实际上是新的时，他们更有可能点击这个新按钮。然而，如果他们对整个网站都是新手，那么按钮本身可能不足以引起额外的注意。
- en: In some cases, these subjects can test more variant sites. This divides the
    test subjects into more groups. There needs to be more subjects available in order
    to compensate for this. Otherwise, the experiment's statistical validity might
    be in jeopardy. If each group doesn't have enough subjects, and therefore observations,
    then there is a larger error rate for the test, and results will need to be more
    extreme to be significant.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，这些受试者可以测试更多变种的网站。这会将测试受试者分成更多组。为了补偿这一点，需要更多的受试者。否则，实验的统计有效性可能会受到威胁。如果每个组都没有足够的受试者，因此观察结果不足，那么测试的误差率会更高，结果需要更加极端才能具有显著性。
- en: In general, though, you'll want to have as many subjects as you reasonably can.
    Of course, this is always a trade-off. Getting 500 or 1000 subjects may take a
    while, given the typical traffic of many websites, but you still need to take
    action within a reasonable amount of time and put the results of the experiment
    into effect. So we'll talk later about how to determine the number of subjects
    that you actually need to get a certain level of significance.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，总的来说，你希望尽可能多地拥有受试者。当然，这始终是一个权衡。考虑到许多网站的典型流量，获取500或1000个受试者可能需要一段时间，但你仍然需要在合理的时间内采取行动，并将实验结果付诸实施。因此，我们稍后将会讨论如何确定你需要多少受试者才能达到一定水平的显著性。
- en: Another wrinkle that is you'll want to know as soon as possible is whether one
    option is clearly better or not so that you can begin to profit from it early.
    In the multi-armed bandit problem, this is a problem of *exploration* versus *exploitation*.
    This refers to the tension in the experiment design (and other domain) between
    exploring the problem space and exploiting the resources you've found in the experiment
    so far. We won't get into this further, but it is a factor to stay aware of as
    you perform A/B tests in the future.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个你希望尽快知道的问题是，一个选项是否明显优于另一个，这样你就可以尽早从中获利。在多臂老虎机问题中，这是一个*探索*与*利用*的问题。这指的是实验设计（以及其他领域）中探索问题空间与利用你在实验中找到的资源之间的紧张关系。我们不会进一步探讨这个问题，但这是你在未来进行A/B测试时需要保持警觉的一个因素。
- en: Because of the power and simplicity of A/B testing, it's being widely used in
    a variety of domains. For example, marketing and advertising make extensive use
    of it. Also, it has become a powerful way to test and improve measurable interactions
    between your website and those who visit it online.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 由于A/B测试的力量和简单性，它被广泛应用于各个领域。例如，营销和广告广泛使用它。此外，它已经成为测试和改进网站与在线访问者之间可测量交互的一种强大方式。
- en: The primary requirement is that the interaction be somewhat limited and very
    measurable. Interesting would not make a good metric; the *click-through rate*
    or *pages visited*, however, would. Because of this, A/B tests validate changes
    in the placement or in the text of buttons that call for action from the users.
    For example, a test might compare the performance of **Click for more!** against
    **Learn more now!**. Another test may check whether a button placed in the upper-right
    section increases sales versus one in the center of the page.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 主要要求是交互应该有一定的限制并且非常可测量。有趣并不构成一个好的指标；然而，*点击率*或*访问页面数*则可以。正因为如此，A/B测试验证了按钮位置或文本中引起用户行动的变化。例如，一个测试可能比较“点击了解更多！”与“现在了解更多！”的表现。另一个测试可能检查放置在页面右上角的按钮是否比放置在页面中心的按钮能增加销售额。
- en: These changes are all incremental, and you probably don't want to break a large
    site redesign into pieces and test all of them individually. In a larger redesign,
    several changes may work together and reinforce each other. Testing them incrementally
    and only applying the ones that increase some metric can result in a design that's
    not aesthetically pleasing, is difficult to maintain, and costs you users in the
    long run. In these cases, A/B testing is not recommended.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 这些变化都是渐进的，你可能不想将大型网站重设计拆分成多个部分并单独测试它们。在更大规模的重新设计中，几个变化可能可以相互配合并相互加强。渐进式测试并仅应用那些提高某些指标的变化可能会导致设计不美观、难以维护，并最终导致用户流失。在这些情况下，不建议使用A/B测试。
- en: 'Some other things that are regularly tested in A/B tests include the following
    parts of a web page:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在A/B测试中经常测试的一些其他内容包括网页的以下部分：
- en: The wording, size, and placement of a call-to-action button
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 呼吁行动按钮的文字、大小和位置
- en: The headline and product description
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标题和产品描述
- en: The length, layout, and fields in a form
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 表单的长度、布局和字段
- en: The overall layout and style of the website as a larger test, which is not broken
    down
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为更大规模测试的网站的整体布局和风格，没有拆分
- en: The pricing and promotional offers of products
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 产品的定价和促销优惠
- en: The images on the landing page
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 着陆页上的图片
- en: The amount of text on a page
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 页面上的文本量
- en: Now that we have an understanding of what A/B testing is and what it can do
    for us, let's see what it will take to set up and perform an A/B test.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了A/B测试是什么以及它能为我们做什么，让我们看看设置和执行A/B测试需要哪些步骤。
- en: Conducting an A/B test
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进行A/B测试
- en: In creating an A/B test, we need to decide several things, and then we need
    to put our plan into action. We'll walk through those decisions here and create
    a simple set of web pages that will test the aspects of design that we are interested
    in changing, based upon the behavior of the user.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建A/B测试时，我们需要决定几件事情，然后我们需要将我们的计划付诸行动。我们将在这里讨论这些决定，并创建一组简单的网页，以测试我们感兴趣改变的设计方面，基于用户的行为。
- en: Before we start building stuff, though, we need to think through our experiment
    and what we'll need to build.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在我们开始构建东西之前，我们需要仔细思考我们的实验以及我们需要构建的内容。
- en: Planning the experiment
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 规划实验
- en: For this chapter, we're going to pretend that we have a website to sell widgets
    (or rather, looking at the **Widgets!** website).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这一章，我们将假装我们有一个网站来销售小工具（或者更确切地说，是查看**小工具！**网站）。
- en: '![Planning the experiment](img/4139OS_08_01.jpg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![规划实验](img/4139OS_08_01.jpg)'
- en: The web page in this screenshot is the **control page**. Currently, we're getting
    24 percent click-through on it from the **Learn more!** button.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这张截图中的网页是**控制页面**。目前，我们从**了解更多**按钮上获得了24%的点击率。
- en: We're interested in the text of the button. If it read **Order now!** instead
    of **Learn more!**, it might generate more click-through. (Of course, actually
    explaining what the product is and what problems it solves might be more effective,
    but one can't have everything.) This will be the **test page**, and we're hoping
    that we can increase the click-through rate to 29 percent (a five percent absolute
    increase).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对按钮的文本感兴趣。如果它显示的是**立即订购**而不是**了解更多**，可能会产生更多的点击量。（当然，实际上解释产品是什么以及它解决了什么问题可能更有效，但不可能拥有一切。）这将是我们将要测试的**测试页面**，我们希望可以将点击率提高到29%（绝对增加了5%）。
- en: Now that we have two versions of the page to experiment with, we can frame the
    experiment statistically and figure out how many subjects we'll need for each
    version of the page in order to achieve a statistically meaningful increase in
    the click-through rate on that button.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了两个版本的页面可以进行实验，我们可以从统计上构建实验，并确定我们需要为每个版本的页面招募多少受试者，以便在按钮上实现统计上有意义的点击率增加。
- en: Framing the statistics
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建统计框架
- en: 'First, we need to frame our experiment in terms of the **null-hypothesis test**.
    In this case, the null hypothesis would look something like this:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要用**零假设检验**来构建我们的实验。在这种情况下，零假设可能看起来像这样：
- en: '*Changing the button copy from **Learn more!** to **Order now!** Would not
    improve the click-through rate.*'
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*将按钮文本从**了解更多**改为**立即订购**不会提高点击率。*'
- en: Remember, this is the statement that we're hoping to disprove (or fail to disprove)
    in the course of this experiment.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，这是我们希望在实验过程中试图推翻（或未能推翻）的陈述。
- en: 'Now we need to think about the sample size. This needs to be fixed in advance.
    To find the sample size, we''ll use the standard error formula, which will be
    solved to get the number of observations to make for about a 95 percent confidence
    interval in order to get us in the ballpark of how large our sample should be:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要考虑样本量。这需要在事先确定。为了找到样本量，我们将使用标准误差公式，这将解决以获得大约95%置信区间的观察数量，以便我们大致了解样本应该有多大：
- en: '![Framing the statistics](img/4139OS_08_02.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![Framing the statistics](img/4139OS_08_02.jpg)'
- en: In this, *δ* is the minimum effect to detect and *σ²* is the sample variance.
    If we are testing for something like a percent increase in the click-through,
    the variance is *σ² = p(1 – p)*, where *p* is the initial click-through rate with
    the control page.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*δ* 是要检测的最小效应，*σ²* 是样本方差。如果我们正在测试类似点击率百分比增加的东西，方差是 *σ² = p(1 – p)*，其中 *p*
    是控制页的初始点击率。
- en: So for this experiment, the variance will be *0.24(1-0.24)* or *0.1824*. This
    would make the sample size for each variable *16(0.1824 / 0.05²)* or almost *1170*.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，对于这个实验，方差将是 *0.24(1-0.24)* 或 *0.1824*。这将使每个变量的样本量 *16(0.1824 / 0.05²)* 或几乎
    *1170*。
- en: 'The code to compute this in Clojure is fairly simple:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在Clojure中计算这段代码相当简单：
- en: '[PRE0]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Running the code from the prompt gives us the response that we expect:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 从提示符中运行代码会给我们预期的响应：
- en: '[PRE1]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Part of the reason to calculate the number of participants needed is that monitoring
    the progress of the experiment and stopping it prematurely can invalidate the
    results of the test because it increases the risk of false positives where the
    experiment says it has disproved the null hypothesis when it really hasn't.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 计算所需参与者数量的部分原因是为了监控实验进度并提前终止实验可能会使测试结果无效，因为它增加了实验声称已经反驳了零假设但实际上并没有的风险。
- en: This seems counterintuitive, doesn't it? Once we have significant results, we
    should be able to stop the test. Let's work through it.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 这似乎有些不合逻辑，不是吗？一旦我们得到显著结果，我们应该能够停止测试。让我们来分析一下。
- en: Let's say that in actuality, there's no difference between the control page
    and the test page. That is, both sets of copy for the button get approximately
    the same click-through rate. If we're attempting to get *p ≤ 0.05*, then it means
    that the test will return a false positive five percent of the time. It will incorrectly
    say that there is a significant difference between the click-through rates of
    the two buttons five percent of the time.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 假设实际上控制页和测试页之间没有差异。也就是说，按钮的两组副本获得的大约相同的点击率。如果我们试图得到 *p ≤ 0.05*，那么这意味着测试将五次返回假阳性。它五次错误地说两个按钮的点击率之间存在显著差异。
- en: 'Let''s say that we''re running the test and planning to get 3,000 subjects.
    We end up checking the results of every 1,000 participants. Let''s break down
    what might happen:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们在进行测试并计划招募3,000名受试者。我们最终会检查每1,000名受试者的结果。让我们分析一下可能会发生的情况：
- en: '| Run | A | B | C | D | E | F | G | H |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| Run | A | B | C | D | E | F | G | H |'
- en: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
- en: '| **1000** | No | No | No | No | Yes | Yes | Yes | Yes |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| **1000** | No | No | No | No | Yes | Yes | Yes | Yes |'
- en: '| **2000** | No | No | Yes | Yes | No | Yes | No | Yes |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| **2000** | No | No | Yes | Yes | No | Yes | No | Yes |'
- en: '| **3000** | No | Yes | No | Yes | No | No | Yes | Yes |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| **3000** | No | Yes | No | Yes | No | No | Yes | Yes |'
- en: '| **Final** | No | Yes | No | Yes | No | No | Yes | Yes |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| **Final** | No | Yes | No | Yes | No | No | Yes | Yes |'
- en: '| **Stopped** | No | Yes | Yes | Yes | Yes | Yes | Yes | Yes |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| **Stopped** | No | Yes | Yes | Yes | Yes | Yes | Yes | Yes |'
- en: Let's read this table. Each lettered column represents a scenario for how the
    significance of the results may change over the run of the test. The rows represent
    the number of observations that have been made. The row labeled *Final* represents
    the experiment's true finishing result, and the row labeled *Stopped* represents
    the result if the experiment is stopped as soon as a significant result is seen.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们阅读这个表格。每个字母列代表测试运行过程中结果显著性可能变化的场景。行代表已进行的观察数量。标有 *Final* 的行代表实验的真实完成结果，而标有
    *Stopped* 的行代表实验一看到显著结果就停止的结果。
- en: The final results show us that out of eight different scenarios, the final result
    would be significant in four cases (B, D, G, and H). However, if the experiment
    is stopped prematurely, then it will be significant in seven cases (all but A).
    The test could drastically over-generate false positives.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 最终结果显示，在八个不同的场景中，最终结果在四种情况下（B、D、G和H）是显著的。然而，如果实验提前停止，那么在七种情况下（除了A之外的所有情况）将是显著的。测试可能会极大地产生假阳性。
- en: In fact, most statistical tests assume that the sample size is fixed before
    the test is run.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，大多数统计测试都假设在测试运行之前样本大小是固定的。
- en: It's exciting to get good results, so we'll design our system so that we can't
    easily stop it prematurely. We'll just take that temptation away.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 获得良好的结果令人兴奋，因此我们将设计我们的系统，使其无法轻易提前停止。我们将只是消除这种诱惑。
- en: With this in mind, let's consider how we can implement this test.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这一点，让我们考虑如何实施这个测试。
- en: Building the experiment
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建实验
- en: There are several options to actually implement the A/B test. We'll consider
    several of them and weigh their pros and cons. Ultimately, the option that works
    best for you really depends on your circumstances. However, we'll pick one for
    this chapter and use it to implement the test for it.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上实施A/B测试有几个选项。我们将考虑其中几个，权衡它们的优缺点。最终，最适合您的选项实际上取决于您的具体情况。然而，我们将为这一章选择一个选项并使用它来实施测试。
- en: Looking at options to build the site
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 考虑构建网站的选择
- en: The first way to implement A/B testing is to use a server-side implementation.
    In this case, all of the processing and tracking is handled on the server, and
    visitors' actions would be tracked using GET or POST parameters on the URL for
    the resource that the experiment is attempting to drive traffic towards.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 实施A/B测试的第一种方式是使用服务器端实现。在这种情况下，所有处理和跟踪都在服务器上完成，并且访客的行为将通过实验试图推动流量向其资源URL的GET或POST参数进行跟踪。
- en: 'The steps for this process would go something like the following ones:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 此过程的步骤可能如下所示：
- en: A new user visits the site and requests for the page that contains the button
    or copy that is being tested.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 新用户访问网站并请求包含待测试按钮或复制的页面。
- en: The server recognizes that this is a new user and assigns the user a tracking
    number.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器识别这是一个新用户，并为用户分配一个跟踪号。
- en: It assigns the user to one of the test groups.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统将用户分配到测试组中的一个。
- en: It adds a row in a database that contains the tracking number and the test group
    that the user is part of.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它在包含跟踪号和用户所属的测试组的数据库中添加一行。
- en: It returns the page to the user with the copy, image, or design that is reflective
    of the control or test group.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它将包含复写、图像或反映控制组或测试组的副本、图像或设计的页面返回给用户。
- en: The user views the returned page and decides whether to click on the button
    or link or not.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用户查看返回的页面并决定是否点击按钮或链接。
- en: If the server receives a request for the button's or link's target, it updates
    the user's row in the tracking table to show us that the interaction was a success,
    that is, that the user did a click-through or made a purchase.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果服务器收到对按钮或链接目标的请求，它将更新跟踪表中的用户行，以显示交互是成功的，即用户进行了点击或进行了购买。
- en: This way of handling it keeps everything on the server, so it allows more control
    and configuration over exactly how you want to conduct your experiment.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 这种处理方式将所有内容保持在服务器上，因此它允许您对如何进行实验有更多的控制和配置。
- en: 'A second way of implementing this would be to do everything using JavaScript
    (or ClojureScript, [https://github.com/clojure/clojurescript](https://github.com/clojure/clojurescript)).
    In this scenario, the code on the page itself would randomly decide whether the
    user belonged to the control or the test group, and it would notify the server
    that a new observation in the experiment was beginning. It would then update the
    page with the appropriate copy or image. Most of the rest of this interaction
    is the same as the one in previous scenario. However, the complete steps are as
    follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 实现此功能的第二种方式是使用JavaScript（或ClojureScript，[https://github.com/clojure/clojurescript](https://github.com/clojure/clojurescript)）。在这种情况下，页面上的代码将随机决定用户属于控制组还是测试组，并将通知服务器实验中开始了一个新的观察。然后，它将使用适当的复写或图像更新页面。其余的大部分交互与上一个场景相同。然而，完整的步骤如下：
- en: A new user visits the site and requests for the page that contains the button
    or copy being tested.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 新用户访问网站并请求包含待测试按钮或复制的页面。
- en: The server inserts some JavaScript to handle the A/B test into the page.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器将一些JavaScript插入页面以处理A/B测试。
- en: As the page is being rendered, the JavaScript library generates a new tracking
    number for the user.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当页面正在渲染时，JavaScript库为用户生成一个新的跟踪号。
- en: It assigns the user to one of the test groups.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它将用户分配到测试组中的一个。
- en: It renders that page for the group that the user belongs to, which is either
    the control group or the test group.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它为用户所属的组渲染该页面，该组要么是对照组，要么是测试组。
- en: It notifies the server of the user's tracking number and the group.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它通知服务器用户的跟踪号和组。
- en: The server takes this notification and adds a row for the observation in the
    database.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器接收此通知并在数据库中为观察添加一行。
- en: The JavaScript in the browser tracks the user's next move either by directly
    notifying the server using an AJAX call or indirectly using a GET parameter in
    the URL for the next page.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览器中的JavaScript通过直接使用AJAX调用通知服务器或间接使用下一页URL中的GET参数来跟踪用户的下一步操作。
- en: The server receives the notification whichever way it's sent and updates the
    row in the database.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器接收通知，无论其发送方式如何，都会更新数据库中的行。
- en: The downside of this is that having JavaScript take care of rendering the experiment
    might take slightly longer and may throw off the experiment. It's also slightly
    more complicated, because there are more parts that have to communicate. However,
    the benefit is that you can create a JavaScript library, easily throw a small
    script tag into the page, and immediately have a new A/B experiment running.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的缺点是，让JavaScript处理实验的渲染可能会稍微慢一些，并可能影响实验。它也稍微复杂一些，因为需要更多部分进行通信。然而，好处是你可以创建一个JavaScript库，轻松地将一个小脚本标签放入页面，并立即运行一个新的A/B测试实验。
- en: In reality, though, you'll probably just use a service that handles this and
    more for you. However, it still makes sense to understand what they're providing
    for you, and that's what this chapter tries to do by helping you understand how
    to perform an A/B test so that you can be make better use of these A/B testing
    vendors and services.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，实际上，你可能只是使用一个为你处理这些事情以及更多服务的服务。然而，了解他们为你提供的内容仍然是有意义的，这正是本章试图通过帮助你了解如何执行A/B测试来实现的，这样你就可以更好地利用这些A/B测试供应商和服务。
- en: Implementing A/B testing on the server
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在服务器上实施A/B测试
- en: For the purposes of this chapter, we'll implement the A/B test on the server.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 为了本章的目的，我们将在服务器上实施A/B测试。
- en: 'First, we''ll create a new project using **Leiningen 2** ([http://leiningen.org/](http://leiningen.org/))
    and the **Luminus web framework** ([http://www.luminusweb.net/](http://www.luminusweb.net/)).
    We''ll include some options to include the **H2 embedded database** ([http://www.h2database.com/](http://www.h2database.com/))
    and **ClojureScript support** ([https://github.com/clojure/clojurescript](https://github.com/clojure/clojurescript)).
    We do this with the following command line:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将使用**Leiningen 2** ([http://leiningen.org/](http://leiningen.org/))和**Luminus
    Web框架** ([http://www.luminusweb.net/](http://www.luminusweb.net/))创建一个新的项目。我们将包括一些选项来包含**H2嵌入式数据库**
    ([http://www.h2database.com/](http://www.h2database.com/))和**ClojureScript支持**
    ([https://github.com/clojure/clojurescript](https://github.com/clojure/clojurescript))。我们使用以下命令行来完成此操作：
- en: '[PRE2]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This command creates the scaffolding for a website. We'll first get familiar
    with what the scaffolding provides, and then we'll fill in the parts of the site
    with the core site. Next, we'll add the A/B testing, and finally, we'll add a
    couple of pages to view the results.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令为网站创建脚手架。我们首先熟悉脚手架提供的内容，然后我们将使用核心网站填充网站的各个部分。接下来，我们将添加A/B测试，最后，我们将添加几个页面来查看结果。
- en: Understanding the scaffolded site
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 理解构建的网站
- en: Luminus is a web framework that is built by combining other libraries and tying
    them together. For database access and models, it uses **Korma** ([http://sqlkorma.com/](http://sqlkorma.com/)).
    For HTML templates, it uses **Selmer** ([https://github.com/yogthos/Selmer](https://github.com/yogthos/Selmer)),
    which is a port of Django-style templates. For routing, controllers, sessions,
    and everything else, it uses **lib-noir** ([http://yogthos.github.io/lib-noir/](http://yogthos.github.io/lib-noir/))
    and **Compojure** ([https://github.com/weavejester/compojure/](https://github.com/weavejester/compojure/)).
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Luminus 是一个通过组合其他库并将它们结合在一起构建的 Web 框架。对于数据库访问和模型，它使用 **Korma** ([http://sqlkorma.com/](http://sqlkorma.com/))。对于
    HTML 模板，它使用 **Selmer** ([https://github.com/yogthos/Selmer](https://github.com/yogthos/Selmer))，这是一个
    Django 风格模板的移植。对于路由、控制器、会话以及其他一切，它使用 **lib-noir** ([http://yogthos.github.io/lib-noir/](http://yogthos.github.io/lib-noir/))
    和 **Compojure** ([https://github.com/weavejester/compojure/](https://github.com/weavejester/compojure/))。
- en: 'Everything in the directory that contains a Luminus project will be a consistent
    set of subdirectories named after the project. For instance, in the project that
    we just created for this (`web-ab`), the primary directories would be as follows:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 包含 Luminus 项目的目录中的所有内容都将是一组一致的子目录，这些子目录以项目命名。例如，在我们为这个项目创建的（`web-ab`）中，主要目录如下：
- en: '`resources` is the directory of static resources. It contains the CSS, JavaScript,
    and image files for the site.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`resources` 是静态资源的目录。它包含网站的 CSS、JavaScript 和图像文件。'
- en: '`src` is the directory of Clojure files. Several of the subdirectories in this
    directory tree are important too, so I''ll list them separately.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`src` 是 Clojure 文件的目录。这个目录树中的几个子目录也非常重要，所以我会单独列出它们。'
- en: '`src/web_ab/models/` is the directory that contain the Clojure files that define
    the model and interact with the database.'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`src/web_ab/models/` 是包含定义模型并与数据库交互的 Clojure 文件的目录。'
- en: '`src/web_ab/routes/` is the directory that lists the routes in a web application.
    Each module under this defines the routes and handlers for a particular subsection
    of the site.'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`src/web_ab/routes/` 是列出 Web 应用程序路由的目录。这个目录下的每个模块都定义了网站特定子部分的路由和处理程序。'
- en: '`src/web_ab/views/templates/` is the directory that contains the Selmer templates.'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`src/web_ab/views/templates/` 是包含 Selmer 模板的目录。'
- en: '`test/web_ab/test/` is the directory that contains the `clojure.test` tests
    for the site''s handlers.'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`test/web_ab/test/` 是包含网站处理程序 `clojure.test` 测试的目录。'
- en: We'll primarily deal with the directories under `src/web-ab/`. We'll define
    the models, define the routes and handlers, and fill in the templates.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将主要处理 `src/web-ab/` 目录下的目录。我们将定义模型、定义路由和处理程序，并填写模板。
- en: 'As we work, we can view the site as we''re developing it by using the development
    server. You can start this using the following Leiningen command:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们工作的过程中，我们可以通过使用开发服务器来查看我们正在开发的网站。你可以使用以下 Leiningen 命令来启动它：
- en: '[PRE3]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Once this server is executed, we can view the site by pointing our browser to
    `http://localhost:3000/`.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦这个服务器执行，我们可以通过将浏览器指向 `http://localhost:3000/` 来查看网站。
- en: Building the test site
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建测试网站
- en: 'First, we need to add in the content for the main page. The file that we''ll
    want to change will be in `src/web_ab/views/templates/home.html`. We''ll add the
    following HTML content to that page. (There are a lot more CSS and images involved
    in creating the site that we saw in the screenshot earlier. All this is listed
    in the code download for this chapter.) Take a look at the following code:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要为主页添加内容。我们将要更改的文件将位于 `src/web_ab/views/templates/home.html`。我们将向该页面添加以下
    HTML 内容。（创建我们之前在截图中所看到的网站还涉及大量的 CSS 和图像。所有这些都在本章的代码下载中列出。）请看以下代码：
- en: '[PRE4]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: When the time comes to add in the A/B testing features, we'll change this a
    little, but most of this is good as it is.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 当需要添加 A/B 测试功能时，我们会稍作修改，但大部分内容都是好的。
- en: 'We''ll also need a page to direct the users to if they want to buy a widget.
    We''ll first define a route for this page in the `src/web_ab/routes/home.clj`
    file. The following is the route and the controller:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果用户想要购买小部件，我们还需要一个页面来引导他们。我们首先在 `src/web_ab/routes/home.clj` 文件中定义这个页面的路由。以下是这个路由和控制器：
- en: '[PRE5]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The view is defined in the `src/web_ab/views/templates/purchase.html` file.
    This file is very similar to the preceding template file, except that it's considerably
    simpler. It just contains a thank you message for the left panel, and there's
    no button or link on the right-hand side. For more details about this page, see
    the code download.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 视图定义在`src/web_ab/views/templates/purchase.html`文件中。此文件与前面的模板文件非常相似，只是它简单得多。它只包含一个左面板的感谢信息，右侧没有按钮或链接。有关此页面的更多详细信息，请参阅代码下载。
- en: '![Building the test site](img/4139OS_08_03.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![构建测试站点](img/4139OS_08_03.jpg)'
- en: In fact, this is enough to define the base, control site in this project. Now
    let's look at what we need to do to define the A/B testing features.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，这已经足够定义本项目的基础，控制站点。现在让我们看看我们需要做什么来定义A/B测试功能。
- en: Implementing A/B testing
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实施A/B测试
- en: 'Adding A/B testing into the site that we have so far will be pretty straightforward
    web development. We''ll need to define a model and functions that implement the
    test framework''s basic functionality. We can then incorporate them into the site''s
    existing controllers and views:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 将A/B测试添加到我们迄今为止拥有的站点将非常直接的网络开发。我们需要定义一个模型和实现测试框架基本功能的函数。然后我们可以将它们集成到站点的现有控制器和视图中：
- en: 'The code that defines the data and the database settings will go into the `src/web_ab/models/schema.clj`
    file. It will start with the following namespace declaration:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义数据和数据库设置的代码将放入`src/web_ab/models/schema.clj`文件中。它将以下列命名空间声明开始：
- en: '[PRE6]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The first facet of this section of the site that we''ll define is the model.
    We''ll add a table to the database schema that defines a table to track the A/B
    participants:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将在本节定义的第一个方面是模型。我们将在数据库模式中添加一个表来跟踪A/B参与者：
- en: '[PRE7]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now, in the `src/web_ab/models/db.clj` file, we''ll define some low-level functions
    to work with the rows in this table. For this file, we''ll use the following namespace
    declaration:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在`src/web_ab/models/db.clj`文件中，我们将定义一些低级函数来处理该表中的行。对于此文件，我们将使用以下命名空间声明：
- en: '[PRE8]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The first function in this namespace will take a group keyword (`:control`
    or `:test`) and insert a row into the database with a code that represents that
    group and the default values for the starting time (the current time) and the
    time in which the interaction succeeds (`NULL`):'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该命名空间中的第一个函数将接受一个组关键字（`:control` 或 `:test`）并将一行插入数据库，该行包含代表该组的代码以及起始时间（当前时间）和交互成功时间的默认值（`NULL`）：
- en: '[PRE9]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Next, we''ll create a function that sets an `abtracking` object''s succeed
    field to the current time. This will mark the interaction as a success:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将创建一个函数，将`abtracking`对象的`succeed`字段设置为当前时间。这将标记交互为成功：
- en: '[PRE10]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: These, along with a few other functions that you can find in the code download
    for this chapter, will form a low-level interface with this data table. Most of
    the time, however, we'll deal with A/B testing using a slightly higher-level interface.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这些，以及你可以在本章代码下载中找到的几个其他函数，将形成一个与该数据表的低级接口。然而，大多数时候，我们将使用稍微高级一点的接口来处理A/B测试。
- en: 'This interface will live in the `src/web_ab/ab_testing.clj` file. It will contain
    the following namespace declaration:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 此接口将位于`src/web_ab/ab_testing.clj`文件中。它将包含以下命名空间声明：
- en: '[PRE11]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'To understand the code in this module, we need to first talk about how the
    A/B testing system will work. We have the following number of requirements that
    we need to make sure are implemented:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 要理解此模块中的代码，我们首先需要谈谈A/B测试系统将如何工作。我们需要确保以下要求得到实现：
- en: If the users have visited the site before the A/B test, they should see the
    control version of the site. We assume that there's a tracking cookie already
    being used for this. In this case, the cookie will be named *visits*, and it will
    simply track the number of times a user has visited the home page of the site.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果用户在A/B测试之前访问过该网站，他们应该看到网站的控件版本。我们假设已经使用了一个跟踪cookie。在这种情况下，cookie将被命名为*visits*，它将简单地跟踪用户访问网站主页的次数。
- en: If this is the users' first visit to the site, they will be randomly assigned
    to the control group or the test group, and they'll be shown the appropriate page
    for that group. Also, they'll receive a tracking cookie for the observation that
    they are, and we'll insert the tracking information for them into the database.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果这是用户第一次访问该网站，他们将被随机分配到控制组或测试组，并显示该组的适当页面。此外，他们还将收到一个跟踪cookie，以观察他们，我们将为他们插入数据库中的跟踪信息。
- en: If the users have visited the site earlier and are participants in the A/B test,
    they should see the same version of the site that they saw previously.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果用户之前访问过网站并且是 A/B 测试的参与者，他们应该看到之前看到的相同版本的网站。
- en: Finally, when a user who is a participant in the experiment visits the purchase
    page, that observation in the experiment will be marked as a success.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，当实验参与者访问购买页面时，实验中的观察结果将被标记为成功。
- en: We'll write functions for most of these cases as well as a function to route
    the user to the right branch whenever one visits the front page. We'll write another
    function to handle item number four.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将为这些情况中的大多数编写函数，以及一个函数，用于在访问主页时将用户路由到正确的分支。我们还将编写另一个函数来处理第四项。
- en: 'For the first function, we''ll implement what''s necessary to start a new observation
    in the experiment. We''ll enter the functions into the database and insert the
    tracking cookie into the session:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 对于第一个函数，我们将实现启动实验中新的观察所需的内容。我们将函数输入数据库并插入跟踪cookie到会话中：
- en: '[PRE12]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The functions in the `db` namespace (aliased from `web-ab.models.db`) are from
    the low-level model interface that we just defined. In fact, the implementation
    for `create-abtracking` is listed on the preceding page.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '`db` 命名空间中的函数（从 `web-ab.models.db` 别名）来自我们刚刚定义的低级模型接口。实际上，`create-abtracking`
    的实现列在前面页面。'
- en: The `c/put!` function is from the `noir.cookies` namespace. It inserts the cookie
    value into the session. In this case, it inserts the tracking instance's database
    ID under the `abcode` key.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '`c/put!` 函数来自 `noir.cookies` 命名空间。它将cookie值插入会话中。在这种情况下，它将跟踪实例的数据库ID插入到 `abcode`
    键下。'
- en: Finally, `new-test` returns the text that should be used on the page.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`new-test` 返回应在页面上使用的文本。
- en: 'The next function for this level of abstraction is `get-previous-copy`. This
    is used whenever a user who is already a participant in the experiment visits
    the page again. It takes a database ID and the different versions of the site
    that are being used in the current test, and it retrieves the row from the database
    and looks up the right copy text to be used on the page, given whether the observation
    is in the control group or the test group:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个抽象级别的下一个函数是 `get-previous-copy`。这个函数在用户已经是实验参与者并再次访问页面时使用。它接受一个数据库ID和当前测试中使用的网站的不同版本，并从数据库中检索行，根据观察是在控制组还是测试组，查找要在页面上使用的正确副本文本：
- en: '[PRE13]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This function simply runs the input through a number of conversions. First,
    this function converts it to a full data row tuple based on the database ID. Next,
    it selects the `testgroup` field, and it translates it into a group keyword. This
    is finally translated into the appropriate text for the page, based on the group
    keyword.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这个函数只是将输入通过一系列转换。首先，这个函数根据数据库ID将其转换为完整的数据行元组。接下来，它选择 `testgroup` 字段，并将其转换为组关键字。最后，根据组关键字将文本转换为页面上适当的文本。
- en: 'The next function that we''re going to look at ties the two previous functions
    together with item number one from the preceding list (where the returning visitors
    are shown the control page without being entered into the experiment):'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 我们接下来要查看的下一个函数将前两个函数与前面列表中的第一项（返回访客在没有进入实验的情况下显示控制页面）结合起来：
- en: '[PRE14]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'First, this function expects three parameters: the cookie name for the counter,
    the default text for the control page, and a map from the group keywords to page
    text. This function looks at the value of the counter cookie and the *abtest*
    cookie, both of which will be `-1` or `0` if they''re not set, and it decides
    what should be displayed for the user as well as inserts whatever needs to be
    inserted into the database.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，这个函数期望三个参数：计数器的cookie名称、控制页面的默认文本以及从组关键字到页面文本的映射。这个函数查看计数器cookie和 *abtest*
    cookie的值，如果它们未设置，这两个值都将为 `-1` 或 `0`，并决定向用户显示什么以及需要插入数据库的内容。
- en: In the preceding code snippet, we can see that the calls to the two functions
    that we've just looked at are highlighted in the code listing.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码片段中，我们可以看到我们刚刚查看的两个函数的调用在代码列表中被突出显示。
- en: 'Also, here we define a function that looks for the *abtest* cookie and, if
    it''s found, we mark it as having succeeded, shown as follows:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们在这里定义了一个函数，用于查找 *abtest* 钩子，如果找到，则将其标记为成功，如下所示：
- en: '[PRE15]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Finally, once the experiment is over, we need to perform the analysis that
    determines whether the control page performed better or the test page:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，一旦实验结束，我们需要执行分析，以确定控制页面是否表现更好还是测试页面：
- en: '[PRE16]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: To perform the actual analysis, we use the t-test function from `incanter.stats`
    in the **Incanter** library ([http://incanter.org/](http://incanter.org/)). We'll
    get into this analysis in more detail later in the chapter. For now, let's just
    pay attention to how the data flows through this function. The `t-test` function
    returns a map that contains a lot of numbers. For the output, we need to select
    some of this information and rename the keys for some of the data that we will
    use. We use the core `select-keys` function to select only the information that
    we need, and we use `clojure.set`/`rename-keys` to give the rest of the names
    that will fit our current domain in a better manner.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 为了执行实际分析，我们使用来自**Incanter**库（[http://incanter.org/](http://incanter.org/)）的`incanter.stats`中的t-test函数。我们将在本章后面更详细地介绍这种分析。现在，让我们只关注数据如何通过此函数流动。`t-test`函数返回一个包含许多数字的映射。对于输出，我们需要选择一些这些信息，并为我们将使用的一些数据重命名键。我们使用核心的`select-keys`函数来选择我们需要的所有信息，并使用`clojure.set`/`rename-keys`以更好地适应我们当前领域的方式为其余的名称提供更好的命名。
- en: To the results of the analysis, we'll also add a couple of other pieces of data.
    One will be the alpha value, that is, the target value for p that we're trying
    to improve upon. The other depends on whether the results are significant or not.
    This is found by testing the value of p against the significance level that we're
    trying for.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 对于分析结果，我们还将添加一些其他数据。其中之一将是alpha值，即我们试图改进的p的目标值。另一个取决于结果是否具有显著性。这是通过将p的值与我们要达到的显著性水平进行比较来确定的。
- en: With the low-level and high-level interfaces to the A/B testing process in place,
    we can turn our attention to actually using it. First, we need to update the view
    template for the home page from what we listed in the preceding snippet.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在A/B测试过程的低级和高级接口就绪后，我们可以将注意力转向实际使用它。首先，我们需要更新主页视图模板，从前面代码片段中列出的内容。
- en: 'Remember, the file is in `src/web_ab/views/templates/home.html`. We want to
    simply change the name of the link to go to the purchase page. It needs to be
    a parameter that we can use to insert a value into the template. For instance,
    the following snippet contains the updated version of the right-hand panel, including
    the highlighted line that we can use to insert the text into the page:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，文件位于`src/web_ab/views/templates/home.html`。我们只想简单地更改链接的名称，以便跳转到购买页面。它需要是一个我们可以用来向模板插入值的参数。例如，以下代码片段包含右侧面板的更新版本，包括我们可以用来将文本插入页面的突出显示行：
- en: '[PRE17]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The controllers will also need to change. They need to trigger the appropriate
    stages in the test participant's lifecycle, and they need to pass the button text
    into the template.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器也需要进行更改。它们需要触发测试参与者的生命周期中的适当阶段，并且需要将按钮文本传递到模板中。
- en: 'The controller for the home page does this as part of one form. It calls `start-test`,
    and builds the template parameters using its output directly. This addition to
    the controller is highlighted as follows:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 首页的控制器将此操作作为表单的一部分来完成。它调用`start-test`，并直接使用其输出构建模板参数。以下是对控制器此新增功能的突出显示：
- en: '[PRE18]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The controller for the purchase page just incorporates a call to `mark-succeed`
    in its normal flow:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 购买页面的控制器只是在其正常流程中调用`mark-succeed`：
- en: '[PRE19]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: At this point, everything is in place to actually conduct the test; however,
    we cannot tell when it's over or look at the results. We can add this section
    of the website in the next stage.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，一切准备就绪，可以实际进行测试；然而，我们无法知道何时结束或查看结果。我们可以在下一阶段添加此网站的部分。
- en: Viewing the results
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 查看结果
- en: We'll add the A/B test result's views as separate pages in a separate section
    of the site. It will use the same `abtracking` model as the rest of the A/B testing,
    but we'll define more controllers and views.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在网站的单独部分添加A/B测试结果的视图作为单独的页面。它将使用与A/B测试的其余部分相同的`abtracking`模型，但我们将定义更多的控制器和视图。
- en: 'One of the primary features of this part of the site is that we don''t want
    to display some information before the test is complete. In order to decide this,
    we''ll first define a map that specifies how many observations from each group
    we need:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 该网站这部分的主要特点之一是我们不希望在测试完成之前显示某些信息。为了决定这一点，我们首先定义一个映射，指定我们需要每个组多少个观测值：
- en: '[PRE20]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'We can use these values to define a predicate that tests whether enough participants
    have been registered in order to call the experiment complete. It reads the participants
    from the database and categorizes them by the experiment group. It compares the
    counts of these groups to the target counts:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用这些值来定义一个谓词，以测试是否已注册足够的参与者以调用实验完成。它从数据库中读取参与者并将他们按实验组分类。它将这些组的计数与目标计数进行比较：
- en: '[PRE21]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'We can use this to go a step further. We''ll define a function that takes the
    list of rows from the `abtracking` table and a function that renders a page. It
    tests whether the experiment has been performed. If it is complete, it passes
    the on processing to that function. If it''s not, it displays a standard page
    that informs the user that the experiment has not been completed yet:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以利用这一点更进一步。我们将定义一个函数，该函数接受来自`abtracking`表的行列表和一个渲染页面的函数。它测试实验是否已执行。如果已完成，它将处理传递给该函数。如果没有完成，它将显示一个标准页面，通知用户实验尚未完成：
- en: '[PRE22]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Now, with these utilities in place, we can define a couple of pages. The first
    one will list the participants from the `abtracking` table. You can find the controller
    function and the view template in the code download. Both are relatively straightforward.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，有了这些实用工具，我们可以定义几个页面。第一个将列出`abtracking`表中的参与者。您可以在代码下载中找到控制器函数和视图模板。两者都相对简单。
- en: 'The other is slightly more interesting for a couple of reasons. First, it uses
    the `when-is-over` function that we just saw, and second, it performs the statistical
    test to determine whether the control page performed better or the test page:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个则稍微有趣一些，原因有几个。首先，它使用了我们刚刚看到的`when-is-over`函数，其次，它执行统计测试以确定控制页面是否表现更好或测试页面：
- en: '[PRE23]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: As mentioned, this function uses the `when-is-over` function that we just defined
    in order to bypass this page and display a standard page that just says that the
    experiment has not been finished yet.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，此函数使用我们刚刚定义的`when-is-over`函数来绕过此页面并显示一个标准页面，该页面仅说明实验尚未完成。
- en: The statistical test, which is highlighted, calls the `perform-test` function
    that we talked about earlier.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 突出的统计测试调用我们之前提到的`perform-test`函数。
- en: The template for these primarily displays the results in a grid. It also has
    a colored alert at the top of the page, which indicates whether the control performed
    better or the test groups.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 此模板主要在网格中显示结果。它还在页面顶部有一个彩色警报，指示控制组是否表现更好或测试组。
- en: Looking at A/B testing as a user
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 以用户视角看待A/B测试
- en: Now that all the parts are together, let's walk through the user's interaction
    with the site. Most people who visit your site won't know that there are two different
    versions of the site, so they should interact with your site as they normally
    would.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 现在所有部分都已就绪，让我们回顾一下用户与网站的互动。大多数访问您网站的人不会知道有网站的两个不同版本，因此他们应该像平时一样与您的网站互动。
- en: When they first visit your site, users should see the following screen. The
    text on the button in the lower-right section might be different, but the rest
    should be the same for everyone.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户首次访问您的网站时，他们应该看到以下屏幕。右下角按钮上的文本可能不同，但其余部分对每个人来说都应该是相同的。
- en: '![Looking at A/B testing as a user](img/4139OS_08_04.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![以用户视角看待A/B测试](img/4139OS_08_04.jpg)'
- en: 'Once the user clicks on **Learn more!** (in this case), they complete the purchase,
    and all the users should see the following page:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦用户点击**了解更多**（在这种情况下），他们完成购买，所有用户都应该看到以下页面：
- en: '![Looking at A/B testing as a user](img/4139OS_08_05.jpg)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![以用户视角看待A/B测试](img/4139OS_08_05.jpg)'
- en: However, the more interesting part of this isn't what happens with the user
    but what happens afterwards when we can look at and analyze the results. We'll
    see some details about this in the next section.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，更有趣的部分不是用户发生的事情，而是在我们能够查看和分析结果之后的后续情况。我们将在下一节中看到一些关于此的细节。
- en: Analyzing the results
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析结果
- en: Obviously, we're not going to be able to get a few thousand people to visit
    our website and purchase the widgets. In place of actual participants, I've populated
    the database with random data. This should allow us to see how the analysis section
    of the website works and what it means.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，我们不可能让几千人访问我们的网站并购买小部件。作为实际参与者的替代，我在数据库中填充了随机数据。这应该允许我们看到网站的分析部分是如何工作的以及它的含义。
- en: Throughout the experiment, we can get a list of the participants by visiting
    `http://localhost:3000/ab-testing/` on the local development server. This allows
    us to track the experiment's progress without really getting into the results
    and without having direct access to the counts.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在整个实验过程中，我们可以通过访问本地开发服务器上的`http://localhost:3000/ab-testing/`来获取参与者列表。这允许我们跟踪实验的进度，而无需真正深入了解结果，也无需直接访问计数。
- en: '![Analyzing the results](img/4139OS_08_06.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![分析结果](img/4139OS_08_06.jpg)'
- en: While the experiment is running, we don't really want to get more information
    than this page displays. This is where the `when-is-over` function, which we previously
    saw, comes into play. When we visited the page earlier, we had sufficient participants
    in the experiment, and then we got a page that explained that the experiment was
    not done and gave some indication as to how much longer it has to go on for.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 当实验进行时，我们并不真的希望得到比这个页面显示的更多信息。这就是我们之前看到的`when-is-over`函数发挥作用的地方。当我们之前访问页面时，实验中有足够的参与者，然后我们得到了一个页面，解释说实验尚未完成，并给出了一些关于实验还需要进行多长时间的指示。
- en: 'For example, the following screenshot has about all the information we want
    to provide at this point in the experiment:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下截图包含了我们在实验的这个阶段想要提供的几乎所有信息：
- en: '![Analyzing the results](img/4139OS_08_07.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![分析结果](img/4139OS_08_07.jpg)'
- en: Of course, once the experiment is complete, we'd like to be able to see the
    final results, including whether the results allow us to reject the null hypothesis,
    that is, whether the test group performed better than the control group in a statistically
    significant way or not.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，一旦实验完成，我们希望能够看到最终结果，包括结果是否允许我们拒绝零假设，也就是说，测试组是否以统计显著的方式比对照组表现更好。
- en: 'So when the experiment is complete, we get the following page:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，当实验完成后，我们得到以下页面：
- en: '![Analyzing the results](img/4139OS_08_08.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![分析结果](img/4139OS_08_08.jpg)'
- en: There's more information included on this page. The following is a table that
    contains the rest of the data and a short explanation of what they are. We'll
    go into more detail on them in the next section, where we talk about the t-test.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 这个页面还包括更多信息。以下是一个包含其余数据和它们简要说明的表格。我们将在下一节中更详细地讨论它们，其中我们将讨论t检验。
- en: '| Name | Value | Explanation |'
  id: totrans-198
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 值 | 说明 |'
- en: '| --- | --- | --- |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| :control-mean | 252 | The average of the control group. |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| :control-mean | 252 | 对照组的平均值。 |'
- en: '| :control-n | 1226 | The number of observations in the control group. |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| :control-n | 1226 | 对照组中的观察值数量。 |'
- en: '| :control-p | 0.20555 | The conversion rate of the control group. |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
  zh: '| :control-p | 0.20555 | 对照组的转化率。 |'
- en: '| :control-variance | 200.20228 | The variance for the control group. |'
  id: totrans-203
  prefs: []
  type: TYPE_TB
  zh: '| :control-variance | 200.20228 | 对照组的方差。 |'
- en: '| :df | 2401.10865 | The degrees of freedom. |'
  id: totrans-204
  prefs: []
  type: TYPE_TB
  zh: '| :df | 2401.10865 | 自由度。 |'
- en: '| :p-target | 0.05 | The alpha value for the test: the maximum p-value for
    the test. |'
  id: totrans-205
  prefs: []
  type: TYPE_TB
  zh: '| :p-target | 0.05 | 测试的alpha值：测试的最大p值。 |'
- en: '| :p-value | 0.00000 | The actual p value for the t-test. |'
  id: totrans-206
  prefs: []
  type: TYPE_TB
  zh: '| :p-value | 0.00000 | t检验的实际p值。 |'
- en: '| :se | 0.59806 | The standard error. |'
  id: totrans-207
  prefs: []
  type: TYPE_TB
  zh: '| :se | 0.59806 | 标准误差。 |'
- en: '| :significant | TRUE | Checking whether the results statistically significant
    |'
  id: totrans-208
  prefs: []
  type: TYPE_TB
  zh: '| :significant | TRUE | 检查结果是否具有统计学意义 |'
- en: '| :t-value | 108.68414 | The results of the t-test. |'
  id: totrans-209
  prefs: []
  type: TYPE_TB
  zh: '| :t-value | 108.68414 | t检验的结果。 |'
- en: '| :test-mean | 317.00000 | The mean of the test group. |'
  id: totrans-210
  prefs: []
  type: TYPE_TB
  zh: '| :test-mean | 317.00000 | 测试组的平均值。 |'
- en: '| :test-n | 1200 | The number of observations in the test group. |'
  id: totrans-211
  prefs: []
  type: TYPE_TB
  zh: '| :test-n | 1200 | 测试组中的观察值数量。 |'
- en: '| :test-p | 0.26417 | The conversion rate of the test group. |'
  id: totrans-212
  prefs: []
  type: TYPE_TB
  zh: '| :test-p | 0.26417 | 测试组的转化率。 |'
- en: '| :test-variance | 233.25917 | The variance for the test group. |'
  id: totrans-213
  prefs: []
  type: TYPE_TB
  zh: '| :test-variance | 233.25917 | 测试组的方差。 |'
- en: These values are given in another table further down the page in the preceding
    screenshot. To understand the statistical values in a better manner, let's dig
    more into exactly what test we used.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 这些值在页面下方另一个表格中给出。为了更好地理解统计值，让我们更深入地了解我们到底使用了哪种测试。
- en: Understanding the t-test
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 理解t检验
- en: First, we need to understand the statistical nature of the test that we're performing.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要了解我们正在进行的测试的统计性质。
- en: Fundamentally, the experiment is pretty simple; each observation has one of
    two outcomes. In many ways, this is a series of coin flips. Each flip can be heads
    or tails. Each site interaction can succeed or fail.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，实验相当简单；每个观察值有两种结果之一。在许多方面，这是一系列抛硬币的过程。每次抛掷可以是正面或反面。每个站点交互可以成功或失败。
- en: 'This kind of value is known as a binomial random variable. It can take one
    of two values, which vary according to a set probability. Binomial random variables
    have a number of assumptions that must be met:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 这种类型的值被称为二项随机变量。它可以取两个值之一，这些值根据一组概率而变化。二项随机变量必须满足一些假设：
- en: There are a fixed number of observations (*n*).
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 观察的数量是固定的（*n*）。
- en: Each observation will have one of the two possible outcomes.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个观察结果将有两种可能的结果之一。
- en: The n observations are independent, that is, the outcome of one observation
    does not in any way influence the probability of any other observation.
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: n个观察结果是独立的，也就是说，一个观察结果的结果不会以任何方式影响其他观察结果的概率。
- en: The probability of the outcomes stays constant over time, that is, the probability
    of the outcome X (*P(X)*) will always be, say, 0.5\. You can easily violate that
    in the design of the experiment by running the control page and the test page
    consecutively instead of running them simultaneously. If they're not run together,
    one page could be used during a busier time to get better results.
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 结果的概率在时间上保持恒定，也就是说，结果X的概率（*P(X)*）将始终是，比如说，0.5。你很容易在实验设计中违反这一点，通过连续运行控制页面和测试页面而不是同时运行它们。如果它们没有一起运行，一个页面可能在较忙的时候被使用以获得更好的结果。
- en: A common example of a binomial random variable is testing coin tosses. Let's
    use this as a first example, and then we'll apply what we've learned to our A/B
    test.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 二项随机变量的一个常见例子是测试抛硬币。让我们以此作为第一个例子，然后我们将把所学应用到我们的A/B测试中。
- en: Testing coin tosses
  id: totrans-224
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 测试抛硬币
- en: Specifically, we'll have a coin that we know is fair and we'll test another
    coin that we suspect is biased against it. The null hypothesis is that there is
    no difference between the two coins and that both are true.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 具体来说，我们将有一个我们知道是公平的硬币，我们将测试另一个我们怀疑对其有偏见的硬币。零假设是两个硬币之间没有差异，并且它们都是真实的。
- en: 'The following steps show us how this experiment will fulfill the assumptions
    of a binomial test:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤展示了这个实验如何满足二项测试的假设：
- en: We'll flip each coin 100 times.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将分别抛掷每个硬币100次。
- en: Each coin toss (each observation) can be heads or tails.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每次抛硬币（每个观察结果）可以是正面或反面。
- en: Each coin toss is independent. Its probability isn't influenced by the probability
    of any other coin toss.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每次抛硬币都是独立的。它的概率不会受到其他任何抛硬币概率的影响。
- en: The probability of heads or tails won't change over time. The probability of
    heads (P(heads)) and the probability of tails (P(tails)) will be 0.5 during the
    entire test, or for the true coin, at least.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 正面或反面的概率不会随时间改变。在整个测试过程中，正面（P(正面)）和反面（P(反面)）的概率将是0.5，或者对于真正的硬币来说至少是如此。
- en: First, let's think about what will happen when we flip the true coin. We know
    that P(heads) = 0.5\. Theoretically, every time we flip the coin for 100 times,
    we expect to get 50 heads and 50 tails. Of course, that isn't what happens in
    real life. Sometimes, we'll get 57 heads and 43 tails. Sometimes, we may get 44
    heads and 56 tails. In extremely rare cases, we may get 100 heads and no tails.
    The distribution of coin tosses will form a binomial distribution, which is the
    number of successes in a series of yes/no experiments; however, as the number
    of coin tosses approaches infinity, the probability of all of these cases can
    be approximated by a normal distribution around the theoretical, expected probability
    of 50 heads and 50 tails.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们思考当我们抛掷真实的硬币时会发生什么。我们知道P(正面) = 0.5。理论上，每次我们抛掷硬币100次，我们预计会得到50次正面和50次反面。当然，现实生活中并不总是这样。有时，我们可能会得到57次正面和43次反面。有时，我们可能会得到44次正面和56次反面。在极其罕见的情况下，我们可能会得到100次正面而没有反面。抛硬币的分布将形成一个二项分布，这是一系列是/否实验中的成功次数；然而，当抛硬币的次数接近无穷大时，所有这些情况的可能性可以近似为围绕理论预期概率50次正面和50次反面的正态分布。
- en: For this experiment, let's say that we flipped a true coin 100 times, and we
    get heads 53 times.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个实验，让我们假设我们抛掷了一个真实的硬币100次，并且得到53次正面。
- en: Now, let's think about what will happen when we flip the other coin. It may
    be true, or it may be biased. If it is biased, we don't know it's biased by how
    much. So, when we flip it 100 times, and we get heads 58 times, we don't know
    if it's because P(heads) = 0.58 or because P(heads) = 0.5, P(heads) = 0.6, or
    something else, and we're slightly off this result on a normal distribution.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们思考当我们抛掷另一枚硬币时会发生什么。它可能是真实的，也可能是有偏见的。如果它是有偏见的，我们不知道它偏了多少。所以，当我们抛掷它100次，并且得到58次正面时，我们不知道这是否是因为P(正面)
    = 0.58，还是因为P(正面) = 0.5，P(正面) = 0.6，或者其他什么，并且我们在正态分布上稍微偏离了这个结果。
- en: So we're interested in two things here. Primarily, we're interested in the difference
    between the two probabilities. Or, to express it in terms of the experiment, we're
    interested in the difference of means. We want to know whether the difference
    between 0.53 and 0.58 (0.05) is significant. The following graph illustrates the
    relationship that we're looking at in a continuous form. The actual data here
    is discrete, of course, but the continuous graph makes the relationship a little
    more clear.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们在这里关注两件事。首先，我们关注两个概率之间的差异。或者，用实验的术语来说，我们关注均值之间的差异。我们想知道0.53和0.58（0.05）之间的差异是否显著。以下图表以连续形式说明了我们正在观察的关系。当然，这里的数据是离散的，但连续图使关系更加清晰。
- en: '![Testing coin tosses](img/4139OS_08_09.jpg)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![Testing coin tosses](img/4139OS_08_09.jpg)'
- en: 'The expected number of successes of a binomial random variable is given by
    the following formula:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 二项随机变量的期望成功次数由以下公式给出：
- en: '![Testing coin tosses](img/4139OS_08_10.jpg)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![Testing coin tosses](img/4139OS_08_10.jpg)'
- en: 'The Clojure code for the sample mean of a binomial variable is similarly straightforward:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 对于二项变量样本均值的Clojure代码同样简单明了：
- en: '[PRE24]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: So, for the control group (the known true coins), the mean is 53, and for the
    test group (the possibly biased coins), it's 58.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，对于对照组（已知为真硬币的硬币），平均值为53，而对于测试组（可能存在偏差的硬币），平均值为58。
- en: 'In order to answer whether the difference is significant, we also have to be
    interested in something else: the possibility that we''re wrong. We can assume
    that the actual means are somewhat different than the actual numbers we''re dealing
    with, but how far off are they?'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 为了回答差异是否显著，我们还必须关注另一件事：我们可能是错误的可能。我们可以假设实际均值与实际处理的数据略有不同，但它们偏离了多少？
- en: To answer this, we need to be able to calculate the standard error for our figures.
    Given a normal distribution, what's the probability that the figures are so far
    off that they'd give us the wrong result? To be able to answer this, we need to
    know something about how much variance the distribution has, that is, how wide
    the curve of the distribution's graph is.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 为了回答这个问题，我们需要能够计算我们数据的标准误差。给定一个正态分布，出现如此大的偏差以至于给出错误结果的概率是多少？为了回答这个问题，我们需要了解分布的方差有多大，也就是说，分布图曲线有多宽。
- en: Like the mean, the variance for a binomial random variable is pretty simple.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 就像均值一样，二项随机变量的方差相当简单。
- en: '![Testing coin tosses](img/4139OS_08_11.jpg)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
  zh: '![Testing coin tosses](img/4139OS_08_11.jpg)'
- en: 'The Clojure function for this is a little more complicated, but it''s still
    clear:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 这个Clojure函数稍微复杂一些，但仍然清晰：
- en: '[PRE25]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: This gives us variances of 24.91 and 24.36.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 这给出了24.91和24.36的方差。
- en: 'With the variance, we can calculate the standard error of the difference. This
    is an estimate of the standard deviation of all sample means, and it gives us
    some idea of how far off our means might be, given how variable the data is and
    how much data we''re looking at. The following is the formula for that:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 通过方差，我们可以计算差异的标准误差。这是所有样本均值的标准差的估计，它让我们对均值可能偏离的程度有一个大概的了解，考虑到数据的变异性和我们观察的数据量。以下是这个公式的计算：
- en: '![Testing coin tosses](img/4139OS_08_12.jpg)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![Testing coin tosses](img/4139OS_08_12.jpg)'
- en: 'The standard error function in Clojure is as follows:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: Clojure中的标准误差函数如下：
- en: '[PRE26]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: For the coin flipping experiment, our standard error is 0.702.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 对于抛硬币实验，我们的标准误差是0.702。
- en: We finally get to the **t-value**. This measures the difference between the
    means, scaled by how variable the groups are.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最终得到了**t值**。这衡量了均值之间的差异，并按组的变化性进行了缩放。
- en: '![Testing coin tosses](img/4139OS_08_13.jpg)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![Testing coin tosses](img/4139OS_08_13.jpg)'
- en: 'Like the formula, the Clojure function for this builds upon all of the functions
    that we''ve just defined:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 就像公式一样，Clojure函数也是基于我们刚刚定义的所有函数构建的：
- en: '[PRE27]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: So the t-value of our coin flipping experiment is 7.123.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们抛硬币实验的t值是7.123。
- en: The output values of this formula follow a t distribution. This is very similar
    to a normal distribution, but the peak is smaller and the tails are heavier. However,
    as the degrees of freedom grow, it comes closer to a normal distribution. You
    can use the cumulative density function for the t-distribution or look in a table
    for the p value of this number.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 这个公式的输出值遵循t分布。这非常类似于正态分布，但峰值更小，尾部更重。然而，随着自由度的增加，它越来越接近正态分布。你可以使用t分布的累积密度函数或查找表格来查找这个数字的p值。
- en: We'll use Incanter's cumulative distribution functions to look up the probabilities
    of the particular t-values. In order to calculate this, we need to calculate the
    degrees of freedom for the test. When the variances of both the groups are equal,
    the formula is simple. However, for this, that will rarely be the case. For unequal
    variances, we'll use the Welch-Satterthwaite equation. It's a bit complicated,
    but it's what we have to work with.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 Incanter 的累积分布函数来查找特定 t 值的概率。为了计算这个值，我们需要计算测试的自由度。当两组的方差相等时，公式很简单。然而，对于这种情况，这种情况很少发生。对于不等方差，我们将使用
    Welch-Satterthwaite 方程。它有点复杂，但这是我们必须要处理的。
- en: '![Testing coin tosses](img/4139OS_08_14.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![测试抛硬币](img/4139OS_08_14.jpg)'
- en: In this equation, *s²* is the variation, *N* is the sample size, and *v* is
    *N-1*.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个公式中，*s²* 是方差，*N* 是样本大小，*v* 是 *N-1*。
- en: 'The Clojure code for this is only slightly less complicated:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 这个 Clojure 代码仅略复杂一些：
- en: '[PRE28]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Now, from REPL, we can test to see whether the coin toss test can reject the
    null hypothesis, that is, whether the second coin is biased:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，从 REPL 中，我们可以测试抛硬币测试是否可以拒绝零假设，即第二个硬币是否有偏差：
- en: '[PRE29]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: So we can see that in the case of the coin flips, the coin is in fact biased
    and significantly so.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们可以看到，在抛硬币的情况下，硬币实际上是有偏差的，并且偏差显著。
- en: Testing the results
  id: totrans-267
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试结果
- en: 'Let''s take this same process and apply it again to the A/B test that we just
    conducted. This will help us see where the statistics in the preceding table came
    from:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将同样的过程再次应用到我们刚刚进行的 A/B 测试中。这将帮助我们了解前表中统计数据的来源：
- en: 'First, we''ll create the data sets by taking the number of observations and
    successes from each group:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将通过从每个组中获取观察次数和成功次数来创建数据集：
- en: '[PRE30]'
  id: totrans-270
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Now, we can compute the mean and variance for each group:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以计算每个组的平均值和方差：
- en: '[PRE31]'
  id: totrans-272
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'This allows us to find the standard error:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这允许我们找到标准误差：
- en: '[PRE32]'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Finally, we can get the t-value, degrees of freedom, and the p-value.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们可以得到 t 值、自由度和 p 值。
- en: '[PRE33]'
  id: totrans-276
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: This gives us the probability that the test results did not occur randomly.
    We're looking for them to be over 0.95, and they clearly are.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 这给出了测试结果并非随机发生的概率。我们希望这个概率超过 0.95，而且它们确实如此。
- en: If this data occurred naturally, the very high p value makes us suspect that
    we may have a **type one error** or a false positive. However, in this case, the
    data wasn't generated completely randomly. In the code download, I've combined
    all of these into one function that gets called to perform the statistical test.
    This is what is used to generate the data for the table on the results page.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这些数据是自然发生的，非常高的 p 值让我们怀疑我们可能有一个**第一类错误**或假阳性。然而，在这种情况下，数据并不是完全随机生成的。在代码下载中，我已经将这些合并成一个函数，该函数被调用来执行统计测试。这是用于生成结果页面表格数据的工具。
- en: Summary
  id: totrans-279
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Over the course of this chapter, we've seen how to conceive of, create, and
    analyze the results of an A/B test.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们看到了如何构思、创建和分析 A/B 测试的结果。
- en: The statistics themselves are really a continuation of the null-hypothesis testing
    that we saw in [Chapter 7](ch07.html "Chapter 7. Null Hypothesis Tests – Analyzing
    Crime Data"), *Null Hypothesis Tests – Analyzing Crime Data*. A/B testing provides
    a nice, complete, useful example of the workflow involved in using null-hypothesis
    testing and of the power and the help in the decision-making that it provides.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 这些统计数据本身实际上是我们在[第 7 章](ch07.html "第 7 章。零假设检验 – 分析犯罪数据")中看到的零假设检验的延续，*零假设检验
    – 分析犯罪数据*。A/B 测试提供了一个很好的、完整的、有用的例子，说明了使用零假设检验的工作流程，以及它在决策制定中提供的力量和帮助。
- en: This allows us to use a standard and widely used way of testing exactly what
    variations on a website drive more interactions and allow us to identify and serve
    the site's users in a better manner. It allows us to decide on changes to the
    site in structured, testable ways.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 这允许我们使用一种标准且广泛使用的方法来测试网站上哪些变化能驱动更多互动，并使我们能够更好地识别和为网站用户提供服务。它允许我们以结构化和可测试的方式决定网站的改变。
- en: Of course, in actuality, we'll probably want to use an existing service. There
    are several services out there, from bare bones but free services such as Google
    Analytics Content Experiments to full-featured for-pay services that cover all
    aspects of A/B testing, such as **Optimizely**, **Visual Website Optimizer**,
    or **Maxymiser**. However, knowing what's involved in A/B testing and what the
    best practices are means that we can evaluate and use these services and get the
    most from them in a better manner.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，实际上我们可能更倾向于使用现有的服务。市面上有各种各样的服务，从基础免费服务如Google Analytics Content Experiments，到功能齐全的付费服务，这些服务涵盖了A/B测试的所有方面，例如**Optimizely**、**Visual
    Website Optimizer**或**Maxymiser**。然而，了解A/B测试的涉及内容以及最佳实践意味着我们可以更好地评估和使用这些服务，从而更有效地从中获益。
- en: In the next chapter, we'll look at applying the data analysis to another part
    of the Web; we'll analyze how people participate in social sites by looking at
    patterns of participation in the **Stackoverflow** ([http://stackoverflow.com/](http://stackoverflow.com/))
    data dumps.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨将数据分析应用于Web的另一个部分；我们将通过分析**Stackoverflow**([http://stackoverflow.com/](http://stackoverflow.com/))数据中的参与模式来了解人们如何在社交网站上参与。
