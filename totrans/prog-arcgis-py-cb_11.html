<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 11. Error Handling and Troubleshooting"><div class="titlepage"><div><div><h1 class="title"><a id="ch11"/>Chapter 11. Error Handling and Troubleshooting</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Exploring the default Python error message</li><li class="listitem" style="list-style-type: disc">Adding Python exception handling structures (try/except/else)</li><li class="listitem" style="list-style-type: disc">Retrieving tool messages with GetMessages()</li><li class="listitem" style="list-style-type: disc">Filtering tool messages by the level of severity</li><li class="listitem" style="list-style-type: disc">Testing for and responding to specific error messages</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec77"/>Introduction</h1></div></div></div><p>Various messages are returned during the execution of ArcGIS geoprocessing tools and functions. These messages can be informational in nature or indicate warning or error conditions that can result in the tool not creating the expected output or result in outright failure of the tool to be executed. These messages do not appear as message boxes. Instead, you will need to retrieve them by using various ArcPy functions. Up to this point in the book, we have ignored the existence of these messages, warnings, and errors. This is mainly due to the fact that I wanted you to concentrate on learning some basic concepts, without adding the extra layer of code complexity that is necessary to create robust geoprocessing scripts that can handle error situations gracefully. This being said, it's now time that you learn how to create geoprocessing and Python exception handling structures that will enable you to create versatile geoprocessing scripts. These scripts can handle messages that indicate warnings, errors, and general information, which are generated while your script is running. These code details will help make your scripts more flexible and less error prone. You've already used the basic <code class="literal">try</code> and <code class="literal">except</code> blocks to perform some basic error handling. However, in this chapter, we'll go into more detail about why and how these structures are used.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Exploring the default Python error message"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec78"/>Exploring the default Python error message</h1></div></div></div><p>By default, Python<a id="id603" class="indexterm"/> will generate an error message whenever it encounters a problem in your script. These error messages will not always be very informative to the end user who is running the script. However, it is valuable to take a look at these raw messages. In later recipes, we'll use Python error handling structures to get a cleaner look at the errors and respond as required.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec202"/>Getting ready</h2></div></div></div><p>In this recipe, we will create and run a script that intentionally contains error conditions. We will not include any geoprocessing or Python exception handling techniques in the script. We are doing this intentionally because we want you to see the error information returned by Python.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec203"/>How to do it…</h2></div></div></div><p>Follow these steps to see a raw Python error message, which is generated when an error occurs while a tool is being executed in a script:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <span class="strong"><strong>IDLE</strong></span> and create a new script.</li><li class="listitem">Save the script to <code class="literal">C:\ArcpyBook\Ch11\ErrorHandling.py</code>.</li><li class="listitem">Import the <code class="literal">arcpy</code> module:<div class="informalexample"><pre class="programlisting">import arcpy</pre></div></li><li class="listitem">Set the workspace:<div class="informalexample"><pre class="programlisting">arcpy.env.workspace = "c:/ArcpyBook/data"</pre></div></li><li class="listitem">Call the <code class="literal">Buffer</code> tool. The <code class="literal">Buffer</code> tool requires a buffer distance be entered as one of its parameters. In this code block, we have intentionally left out the distance parameter:<div class="informalexample"><pre class="programlisting">arcpy.Buffer_analysis("Streams.shp","Streams_Buff.shp")</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch11\ErrorHandling1.py</code> solution file.</li><li class="listitem">Run the script. You should see the following error message:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Runtime error Traceback (most recent call last): File "&lt;string&gt;", line 1, in &lt;module&gt; File "c:\program files (x86)\arcgis\desktop10.1\arcpy\arcpy\analysis.py", line 687, in Buffer  raise e ExecuteError: Failed to execute. Parameters are not valid. ERROR 000735: Distance [value or field]: Value is required Failed to execute (Buffer).</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec204"/>How it works…</h2></div></div></div><p>This <a id="id604" class="indexterm"/>output error message isn't terribly informative. If you are a fairly experienced programmer, you'll generally be able to make out what the problem is in this case (it did not include buffer distance). However, in many cases, the returned error message will not give you much information that you can use to resolve the problem. Errors in your code are simply a fact of life in programming. However, how your code responds to these errors, also called exceptions, is very important. You should plan to handle errors gracefully through the use of Python error handling structures, which examine <code class="literal">arcpy</code> generated exceptions and act accordingly. Without these structures in place, your scripts will fail immediately, frustrating your users in the process.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Adding Python exception handling structures (try/except/else)"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec79"/>Adding Python exception handling structures (try/except/else)</h1></div></div></div><p>Python has <a id="id605" class="indexterm"/>built-in exception handling structures that allows you to capture error messages that are generated. Using this error information, you can then display a more appropriate message to the end user and respond to the situation as needed.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec205"/>Getting ready</h2></div></div></div><p>Exceptions are unusual or error conditions that occur in your code. Exception statements in Python enable you to trap and handle errors in your code, allowing you to gracefully recover from error conditions. In addition to error handling, exceptions can be used for a variety of other things, including event notification and handling of special cases.</p><p>Python exceptions occur in two ways. Exceptions in Python can either be intercepted or triggered. When an error condition occurs in your code, Python automatically triggers an exception, which may or may not be handled by your code. It is up to you as a programmer to catch an automatically triggered exception. Exceptions can also be triggered manually by your code. In this case, you would also provide an exception handling routine to catch these manually triggered exceptions. You can manually trigger an exception by using the <code class="literal">raise</code> statement.</p><p>The <code class="literal">try</code>/<code class="literal">except</code> statement<a id="id606" class="indexterm"/> is a complete, compound Python statement, which is used to handle exceptions. This variety of <code class="literal">try</code> statement starts with a <code class="literal">try</code> header line followed by a block of indented statements, then one or more optional <code class="literal">except</code> clauses that name exceptions to be caught, and an optional <code class="literal">else</code> clause at the end.</p><p>The <code class="literal">try</code>/<code class="literal">except</code>/<code class="literal">else</code> statement<a id="id607" class="indexterm"/> works as follows. Once inside a <code class="literal">try</code> statement, Python marks the fact that you are in a <code class="literal">try</code> block and knows that any exception condition that occurs within this block will be forwarded to the various <code class="literal">except</code> statements for handling.</p><p>Each statement inside the <code class="literal">try</code> block<a id="id608" class="indexterm"/> is executed. Assuming there aren't any conditions in which exceptions occur, the code pointer will then jump to the <code class="literal">else</code> statement and execute the code block contained within the <code class="literal">else</code> statement before moving to the next line of code below the <code class="literal">try</code> block. If an exception occurs inside the <code class="literal">try</code> block, Python searches for a matching exception code. If a matching exception is found, the code block inside the <code class="literal">except</code> block is executed. The code then reappears below the full <code class="literal">try</code> statement. The <code class="literal">else</code> statements <a id="id609" class="indexterm"/>are not executed in this case. If a matching exception header is not found, Python will propagate the exception to a <code class="literal">try</code> statement above this code block. In the event that no matching <code class="literal">except</code> header is found, the exception comes out of the top level of the process. This results in an unhandled exception and you wind up with the type of error message that we saw in our first recipe in this chapter. This is illustrated in the following figure:</p><div class="mediaobject"><img src="images/B04314_11_03.jpg" alt="Getting ready"/></div><p>In this recipe, we're going to add in some basic Python exception handling structures. There are several<a id="id610" class="indexterm"/> variations of the <code class="literal">try</code>/<code class="literal">except</code>/<code class="literal">else</code>/<code class="literal">finally</code>
<a id="id611" class="indexterm"/> exception handling structure. In this recipe, we'll start with a very simple <code class="literal">try</code>/<code class="literal">except</code> structure.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec206"/>How to do it…</h2></div></div></div><p>Follow these steps to add Python error handling structures to a script.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If necessary, open the <code class="literal">C:\ArcpyBook\Ch11\ErrorHandling.py</code> file in <span class="strong"><strong>IDLE</strong></span>.</li><li class="listitem">Alter your script to include a <code class="literal">try</code>/<code class="literal">except</code> block:<div class="informalexample"><pre class="programlisting">import arcpy
try:
  arcpy.env.workspace = "c:/ArcpyBook/data"
  arcpy.Buffer_analysis("Streams.shp","Streams_Buff.shp")
except:
  print("Error")</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch11\ErrorHandling2.py</code> solution file.</li><li class="listitem">Save and run the script. You should see the simple <code class="literal">Error</code> message. This is no more helpful than the output we received in our first recipe. In fact, it's even less useful. However, the point of this recipe is simply to introduce you to the <code class="literal">try</code>/<code class="literal">except</code> error handling structure.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec207"/>How it works…</h2></div></div></div><p>This<a id="id612" class="indexterm"/> is an extremely simple structure. The <code class="literal">try</code> block indicates that everything indented under the <code class="literal">try</code> statement will be subject to exception handling. If an exception of any type is found, control of the code processing jumps to the <code class="literal">except</code> section and prints the error message(s), which in this case is simply <code class="literal">Error</code>. Now, as I mentioned, this is hardly informative to your users, but hopefully, it gives you a basic idea of how the <code class="literal">try</code>/<code class="literal">except</code> blocks work, and as a programmer you will better understand any errors reported by your users. In the next recipe, you'll learn how to add tool-generated messages to this structure.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec208"/>There's more…</h2></div></div></div><p>The other type of <code class="literal">try</code> statement is the <code class="literal">try</code>/<code class="literal">finally</code> statement, which allows for finalization actions. When a <code class="literal">finally</code> clause is used in a <code class="literal">try</code> statement, its block of statements always run at the very end, whether an error condition occurs or not. This is how the <code class="literal">try</code>/<code class="literal">finally</code> statement works: if an exception occurs, Python runs the <code class="literal">except</code> block, then the <code class="literal">finally</code> block. If an exception does not occur during execution, Python runs the <code class="literal">try</code> block, and then the <code class="literal">finally</code> block. This is useful when you want to make sure that an action takes place after a code block runs, regardless of whether or not an error condition occurs.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Retrieving tool messages with GetMessages()"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec80"/>Retrieving tool messages with GetMessages()</h1></div></div></div><p>ArcPy includes a <code class="literal">GetMessages()</code> function<a id="id613" class="indexterm"/> that you<a id="id614" class="indexterm"/> can use to retrieve messages generated when an ArcGIS tool is executing. Messages can include informational messages, such as the start and ends times of a tool execution as well as warnings and errors, which can result in something less than the desired result or complete failure of the tool to execute to completion.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec209"/>Getting ready</h2></div></div></div><p>During the execution <a id="id615" class="indexterm"/>of a tool, various messages are generated. These messages include informational messages, such as the start and end times of a tool execution, parameter values passed to the tool, and progress information. In addition to this, warnings and errors can also <a id="id616" class="indexterm"/>be generated by the tool. These messages can be read by your Python script, and your code can be designed to appropriately handle any warnings or errors that have been generated.</p><p>ArcPy stores the messages from the last tool that was executed and you can retrieve these messages using the <code class="literal">GetMessages()</code> function, which returns a single string containing all messages from the tool that was last executed. You can filter this string in terms of severity to return only certain types of messages such as warnings or errors. The first message will always include the name of the tool executed, and the last message is the start and end time.</p><p>In this recipe, you will add a line of code to the <code class="literal">except</code> statement, which will print more descriptive information about the current tool run.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec210"/>How to do it…</h2></div></div></div><p>Follow these steps to learn how to add a <code class="literal">GetMessages()</code> function to your script that generates a list of messages from the tool that was last executed:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If necessary, open the <code class="literal">C:\ArcpyBook\Ch11\ErrorHandling.py</code> file in IDLE.</li><li class="listitem">Alter your script to include the <code class="literal">GetMessages()</code> function:<div class="informalexample"><pre class="programlisting">import arcpy
try:
  arcpy.env.workspace = "c:/ArcpyBook/data"
  arcpy.Buffer_analysis("Streams.shp","Streams_Buff.shp")
except:
  print(arcpy.GetMessages())</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch11\ErrorHandling3.py</code> solution file.</li><li class="listitem">Save and run the script. This time, the error message should be much more informative. Also notice that there are other types of messages that are generated including the start and end times of the script's execution:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Executing: Buffer c:/ArcpyBook/data\Streams.shp c:/ArcpyBook/data\Streams_Buff.shp # FULL ROUND NONE #</strong></span>
<span class="strong"><strong>Start Time: Tue Nov 13 22:23:04 2012</strong></span>
<span class="strong"><strong>Failed to execute. Parameters are not valid.</strong></span>
<span class="strong"><strong>ERROR 000735: Distance [value or field]: Value is required</strong></span>
<span class="strong"><strong>Failed to execute (Buffer).</strong></span>
<span class="strong"><strong>Failed at Tue Nov 13 22:23:04 2012 (Elapsed Time: 0.00 seconds)</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec211"/>How it works…</h2></div></div></div><p>The <code class="literal">GetMessages()</code> function <a id="id617" class="indexterm"/>returns all the messages <a id="id618" class="indexterm"/>generated by the last tool that was run. I want to emphasize that it only returns messages from the last tool that was run. Keep this in mind if you have a script with multiple tools that are being run. Historical tool messages are not accessible through this function. However, there is a <code class="literal">Result</code> object that you can use if you need to retrieve historical tool messages.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Filtering tool messages by the level of severity"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec81"/>Filtering tool messages by the level of severity</h1></div></div></div><p>As I mentioned in the<a id="id619" class="indexterm"/> last recipe, all tools generate a number of messages that can be classified as information, warnings, or error messages. The <code class="literal">GetMessages()</code> method accepts a parameter that allows you to filter the messages that are returned. For example, you may not be interested in the informative or warning messages in your script. However, you will certainly be interested in error messages as they indicate a fatal error that will not allow a tool to successfully execute. Using <code class="literal">GetMessages()</code>, you can filter the returned message to include only error messages.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec212"/>Getting ready</h2></div></div></div><p>Messages are classified into one of three types, which are indicated by the level of severity. <span class="strong"><strong>Informational messages</strong></span>
<a id="id620" class="indexterm"/> provide descriptive information concerning things, such as a tools progress, start and end times of the tool, output data characteristics, and much more. The severity of an informational message is indicated by a value of <code class="literal">0</code>. <span class="strong"><strong>Warning messages</strong></span> <a id="id621" class="indexterm"/>are generated when a problem has occurred during execution that may affect the output. Warnings are indicated with a severity level of <code class="literal">1</code> and don't normally stop a tool from running. The last type of message is an <a id="id622" class="indexterm"/>
<span class="strong"><strong>error message</strong></span>, which is indicated by a numeric value of <code class="literal">2</code>. These indicate fatal events that prevent a tool from running. Multiple messages may be generated during the execution of a tool, and these are stored in a list. More information about the severity of message is provided in the following image. In this recipe, you will learn how to filter the messages generated by the <code class="literal">GetMessages()</code> function:</p><div class="mediaobject"><img src="images/B04314_11_01.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec213"/>How to do it…</h2></div></div></div><p>Filtering the messages<a id="id623" class="indexterm"/> returned by a tool is really quite simple. You simply provide the severity level you'd like to return as a parameter for the <code class="literal">GetMessages()</code> function.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If necessary, open the <code class="literal">C:\ArcpyBook\Ch11\ErrorHandling.py</code> file in IDLE.</li><li class="listitem">Alter the <code class="literal">GetMessages()</code> function so that you pass in a value of <code class="literal">2</code> as the only parameter:<div class="informalexample"><pre class="programlisting">import arcpy
try:
  arcpy.env.workspace = "c:/ArcpyBook/data"
  arcpy.Buffer_analysis("Streams.shp","Streams_Buff.shp")
except:
  print(arcpy.GetMessages(2))</pre></div></li><li class="listitem">You can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch11\ErrorHandling4.py</code> solution file.</li><li class="listitem">Save and run the script to see the output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Failed to execute. Parameters are not valid.</strong></span>
<span class="strong"><strong>ERROR 000735: Distance [value or field]: Value is required</strong></span>
<span class="strong"><strong>Failed to execute (Buffer).</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec214"/>How it works…</h2></div></div></div><p>As I mentioned earlier, the <code class="literal">GetMessages()</code> method can accept an integer argument of <code class="literal">0</code>, <code class="literal">1</code>, or <code class="literal">2</code>. Passing a value of <code class="literal">0</code> indicates that all messages should be returned, while passing a value of <code class="literal">1</code> indicates<a id="id624" class="indexterm"/> that you wish to see warnings. In our case, we have passed a value of <code class="literal">2</code>, which indicates that we only want to see error messages. Therefore, you won't see any of the other information messages, such as the start and end times of the script.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Testing for and responding to specific error messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec82"/>Testing for and responding to specific error messages</h1></div></div></div><p>All errors and warnings <a id="id625" class="indexterm"/>generate a specific error code. It is possible to<a id="id626" class="indexterm"/> check for specific error codes in your scripts and perform some type of action based on these errors. This can make your scripts even more versatile.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec215"/>Getting ready</h2></div></div></div><p>All errors and warnings generated by a geoprocessing tool contain both a six-digit code and a description. Your script can test for specific error codes and respond accordingly. You can get a listing of all the available error messages and codes in the ArcGIS for Desktop help system by navigating to <span class="strong"><strong>Geoprocessing</strong></span> | <span class="strong"><strong>Tool errors and warnings</strong></span>. This is illustrated in the following screenshot. All errors have a unique page that briefly describes the error by the code number:</p><div class="mediaobject"><img src="images/B04314_11_02.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec216"/>How to do it…</h2></div></div></div><p>Follow these <a id="id627" class="indexterm"/>steps to <a id="id628" class="indexterm"/>learn how to write code that responds to specific error codes generated by the execution of a geoprocessing tools:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the ArcGIS for Desktop help system by navigating to <span class="strong"><strong>Start</strong></span> | <span class="strong"><strong>All Programs</strong></span> | <span class="strong"><strong>ArcGIS</strong></span> | <span class="strong"><strong>ArcGIS for Desktop Help</strong></span></li><li class="listitem">Navigate to <span class="strong"><strong>Geoprocessing</strong></span> | <span class="strong"><strong>Tool errors and warnings</strong></span> | <span class="strong"><strong>Tool errors 1-10000</strong></span> | <span class="strong"><strong>Tool errors and warnings 701-800</strong></span>.</li><li class="listitem">Select <span class="strong"><strong>000735:&lt;value&gt;:Value is required</strong></span>. This error indicates that a parameter required by the tool has not been provided. You'll recall from running this script earlier that we have not provided the buffer distance and the resulting error message generated, as a result, contains the error code that we are viewing in the help system. In the following code, you will find the full text of the error message. Notice the error code:<div class="informalexample"><pre class="programlisting">ERROR000735:Distance[valueorfield]:Valueisrequired</pre></div></li><li class="listitem">If necessary, open the <code class="literal">C:\ArcpyBook\Ch11\ErrorHandling.py</code> file in IDLE.</li><li class="listitem">In your script, alter the <code class="literal">except</code> statement so that it appears as follows:<div class="informalexample"><pre class="programlisting">import arcpy
try:
  arcpy.env.workspace = "c:/ArcpyBook/data"
  arcpy.Buffer_analysis("Streams.shp", "Streams_Buff.shp")
except:
  print("Error found in Buffer tool \n")
  errCode = arcpy.GetReturnCode(3)
  if str(errCode) == "735":
    print("Distance value not provided \n")
    print("Running the buffer again with a default valuevalue \n")
    defaultDistance = "100 Feet"
    arcpy.Buffer_analysis("Streams.shp", "Streams_Buff", defaultDistance)
    print("Buffer complete")</pre></div></li><li class="listitem">You <a id="id629" class="indexterm"/>can check your work by examining the <code class="literal">C:\ArcpyBook\code\Ch11\ErrorHandling5.py</code> solution file.</li><li class="listitem">Save and run the script. You should see various messages printed, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Error found in Buffer tool</strong></span>
<span class="strong"><strong>Distance value not provided for buffer</strong></span>
<span class="strong"><strong>Running the buffer tool again with a default distance value</strong></span>
<span class="strong"><strong>Buffer complete</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec217"/>How it works…</h2></div></div></div><p>What you've done<a id="id630" class="indexterm"/> in this code block is use the <code class="literal">arcpy.GetReturnCode()</code> function to return the error code generated by the tool. Then, an <code class="literal">if</code> statement is used to test whether the error code contains the <code class="literal">735</code> value, which is the code that indicates that a required parameter has not been provided to the tool. You then provided a default value for the buffer distance and called the <code class="literal">Buffer</code> tool again, providing the default buffer value this time.</p></div></div></div>
</body></html>