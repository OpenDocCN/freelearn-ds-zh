<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;3.&#xA0;Editing Vector Data"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03" class="calibre1"/>Chapter 3. Editing Vector Data</h1></div></div></div><p class="calibre9">In this chapter, we will cover the following recipes:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Creating a vector layer in memory</li><li class="listitem">Adding a point feature to a vector layer</li><li class="listitem">Adding a line feature to a vector layer</li><li class="listitem">Adding a polygon feature to a vector layer</li><li class="listitem">Adding a set of attributes to a vector layer</li><li class="listitem">Adding a field to a vector layer</li><li class="listitem">Joining a shapefile attribute table to a CSV file</li><li class="listitem">Moving vector layer geometry</li><li class="listitem">Changing a vector layer attribute</li><li class="listitem">Deleting vector layer geometry</li><li class="listitem">Deleting a vector layer field</li><li class="listitem">Deleting vector layer attributes</li><li class="listitem">Reprojecting a vector layer</li><li class="listitem">Converting a shapefile to Keyhole Markup Language (KML)</li><li class="listitem">Merging shapefiles</li><li class="listitem">Splitting a shapefile</li><li class="listitem">Generalizing a vector layer</li><li class="listitem">Dissolving vector shapes</li><li class="listitem">Performing a union on vector shapes</li><li class="listitem">Rasterizing a vector layer</li></ul></div></div>

<div class="book" title="Chapter&#xA0;3.&#xA0;Editing Vector Data">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch03lvl1sec36" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre9">This chapter details how to edit QGIS vector data using the Python API. The <code class="literal">QgsVectorLayer</code> object<a id="id156" class="calibre1"/> contains the basics of adding, editing, and deleting features. All other geospatial operations are accessed through the <a id="id157" class="calibre1"/>
<span class="strong"><strong class="calibre2">Processing Toolbox</strong></span> or even through custom scripts.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating a vector layer in memory"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec37" class="calibre1"/>Creating a vector layer in memory</h1></div></div></div><p class="calibre9">Sometimes, you need to create a temporary data set for quick output or as an intermediate step in a more complex operation without the overhead of actually writing a file to disk. PyQGIS employs <span class="strong"><strong class="calibre2">memory layers</strong></span><a id="id158" class="calibre1"/> that allow you to create a complete vector data set, including the geometry, fields, and attributes, virtually. Once the memory layer is created, you can work with it <a id="id159" class="calibre1"/>in the same way you would work with a vector layer <a id="id160" class="calibre1"/>loaded from disk.</p></div>

<div class="book" title="Creating a vector layer in memory">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec95" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">This recipe entirely runs inside the PyQGIS console, so no preparation or external resources are required.</p></div></div>

<div class="book" title="Creating a vector layer in memory">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec96" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will create a <code class="literal">Point</code> vector layer, named <code class="literal">Layer 1</code> with a few fields and then validate it:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">In the Python console, create a <code class="literal">QgsVectorLayer</code>, including fields, and specify it as a memory data provider:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('Point?crs=epsg:4326&amp;field=city:string(25)&amp;field=population:nt', 'Layer 1' , "memory")</strong></span>
</pre></div></li><li class="listitem" value="4">Now, validate the layer and ensure that the console returns <code class="literal">True</code>:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Creating a vector layer in memory">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec97" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The <code class="literal">QgsVectorLayer</code> requires three <a id="id161" class="calibre1"/>arguments. The last argument specifies the type, which in this case is <code class="literal">memory</code>. The second argument specifies the layer name. Normally, the first argument is the path to the file on disk, which is used to create the layer. In the case of the memory layer, the first argument becomes the construction string for the layer. The format uses query parameters that follow the convention <code class="literal">key = value</code>. We first specify the coordinate reference system and then specify the fields we want. In this case, we specify the <a id="id162" class="calibre1"/>first field, a string for city names, and then an integer<a id="id163" class="calibre1"/> field for population.</p></div></div>

<div class="book" title="Creating a vector layer in memory">
<div class="book" title="There's more…"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec98" class="calibre1"/>There's more…</h2></div></div></div><p class="calibre9">You can easily see how describing a layer's attribute table structure in a string can become unwieldy. You can also use a Python-ordered dictionary<a id="id164" class="calibre1"/> to build the string<a id="id165" class="calibre1"/> dynamically, as shown in the following steps.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, you need to import the <code class="literal">OrderedDict</code> container, which remembers the order in which keys are inserted:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">from collections import OrderedDict</strong></span>
</pre></div></li><li class="listitem" value="2">Then, build an ordered dictionary that contains attribute names and types:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">fields = OrderedDict([('city','str(25)'),('population','int')])</strong></span>
</pre></div></li><li class="listitem" value="3">Next, build a string by joining the output of a Python list comprehension that loops through the ordered dictionary:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">path = '&amp;'.join(['field={}:{}'.format(k,v) for k,v in fields.items()])</strong></span>
</pre></div></li><li class="listitem" value="4">Finally, use this string to define the layer:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('Point?crs=epsg:4326&amp;' + path, 'Layer 1' , "memory")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a point feature to a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec38" class="calibre1"/>Adding a point feature to a vector layer</h1></div></div></div><p class="calibre9">This recipe performs the<a id="id166" class="calibre1"/> simplest possible edit to a vector layer <a id="id167" class="calibre1"/>instantiated from a shapefile. We will add a point to an existing point layer.</p></div>

<div class="book" title="Adding a point feature to a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec99" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, download the zipped shapefile<a id="id168" class="calibre1"/> from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract the <code class="literal">.shp</code>, <code class="literal">.shx</code>, and <code class="literal">.dbf</code> files to the <code class="literal">/qgis_data/nyc</code> directory.</p></div></div>

<div class="book" title="Adding a point feature to a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec100" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will load the vector layer from the shapefile, create a new geometry object as a point, create a new feature, set the geometry, and add it to the layer's data provider. Finally, we will update the extent of the layer to make sure that the bounding box of the layer encapsulates the new point:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load the layer:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
</pre></div></li><li class="listitem" value="4">Now, will access the layer's data provider:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr = vectorLyr.dataProvider()</strong></span>
</pre></div></li><li class="listitem" value="5">Next, create a new point using the <code class="literal">QgsGeometry</code> object:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">pnt = QgsGeometry.fromPoint(QgsPoint(-74.80,40.549))</strong></span>
</pre></div></li><li class="listitem" value="6">Now, will create a new <code class="literal">QgsFeature</code> object to house the geometry:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f = QgsFeature()</strong></span>
</pre></div></li><li class="listitem" value="7">Next, set the geometry of the feature using our point:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f.setGeometry(pnt)</strong></span>
</pre></div></li><li class="listitem" value="8">Then, place the features into the layer's feature list:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr.addFeatures([f])</strong></span>
</pre></div></li><li class="listitem" value="9">Finally, update the layer's extent to complete the addition:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.updateExtents()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Adding a point feature to a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec101" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">PyQGIS<a id="id169" class="calibre1"/> abstracts<a id="id170" class="calibre1"/> the points within a layer into four levels. At the<a id="id171" class="calibre1"/> lowest level is the <code class="literal">QgsPoint</code> object, which contains nothing more than the coordinates of the point. This object is added to an abstract <code class="literal">QgsGeometry</code> object. This object becomes the geometric part of a <code class="literal">QgsFeature</code> object, which also has the ability to store and manage attributes. All the features are managed by the <code class="literal">QgsDataProvider</code> object. The data provider manages the geospatial aspect of a layer to separate that aspect from styling and other presentation-related portions. QGIS has another editing approach in Python, which is called an <a id="id172" class="calibre1"/>
<span class="strong"><strong class="calibre2">editing buffer</strong></span>. When you use an editing buffer, the changes can be displayed, but they are not permanent until you commit them. The most common use case for this editing method is in GUI applications where the user may decide to roll back the changes by cancelling the editing session. The <span class="strong"><em class="calibre10">PyQGIS Developer Cookbook</em></span> has an example of using and<a id="id173" class="calibre1"/> editing buffers in Python, and is available at <a class="calibre1" href="http://docs.qgis.org/2.6/en/docs/pyqgis_developer_cookbook/vector.html">http://docs.qgis.org/2.6/en/docs/pyqgis_developer_cookbook/vector.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a line feature to a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec39" class="calibre1"/>Adding a line feature to a vector layer</h1></div></div></div><p class="calibre9">Adding a line to a vector layer in QGIS is identical to adding a single point, but here you just have to add more points to the <code class="literal">QgsGeometry</code> object.</p></div>

<div class="book" title="Adding a line feature to a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec102" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, you will need to download a zipped line shapefile<a id="id174" class="calibre1"/> that contains two line features from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/paths.zip">https://geospatialpython.googlecode.com/svn/paths.zip</a>.</p><p class="calibre9">Extract the ZIP file to a directory named <code class="literal">paths</code> in your <code class="literal">/qgis_data</code> directory.</p></div></div>

<div class="book" title="Adding a line feature to a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec103" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">In this recipe, we will <a id="id175" class="calibre1"/>load the line layer from the shapefile, build a list of <a id="id176" class="calibre1"/>points, create a new geometry object, and add the points as a line. We will also create a new feature, set the geometry, and add it to the layer's data provider. Finally, we will update the extent of the layer to make sure that the bounding box of the layer encapsulates the new feature:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load the line layer and ensure that it is valid:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/paths/paths.shp', 'Paths' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Next, access the layer's data provider:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr = vectorLyr.dataProvider()</strong></span>
</pre></div></li><li class="listitem" value="5">Now, build our list of points for a new line:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">points = []</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(430841,5589485))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(432438,5575114))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(447252,5567663))</strong></span>
</pre></div></li><li class="listitem" value="6">Then, create a geometry object from the line:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">line = QgsGeometry.fromPolyline(points)</strong></span>
</pre></div></li><li class="listitem" value="7">Create a feature and set its geometry to the line:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f = QgsFeature()</strong></span>
<span class="strong"><strong class="calibre2">f.setGeometry(line)</strong></span>
</pre></div></li><li class="listitem" value="8">Finally, add the feature to the layer data provider and update the extent:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr.addFeatures([f])</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.updateExtents()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Adding a line feature to a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec104" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">As with all the geometry<a id="id177" class="calibre1"/> in QGIS, we use the four-step process of building<a id="id178" class="calibre1"/> points, geometry, feature, and data provider to add the line. Interestingly, the <code class="literal">QgsGeometry</code> object accepts Python lists for the collection of points instead of creating a formal object, as is done with the <code class="literal">QgsPoint</code> object.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a polygon feature to a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec40" class="calibre1"/>Adding a polygon feature to a vector layer</h1></div></div></div><p class="calibre9">In this recipe, we'll add a <a id="id179" class="calibre1"/>polygon to a layer. A polygon is the most <a id="id180" class="calibre1"/>complex kind of geometry. However, in QGIS, the API is very similar to a line.</p></div>

<div class="book" title="Adding a polygon feature to a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec105" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, we'll use a <a id="id181" class="calibre1"/>simple polygon shapefile, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/files/polygon.zip">https://geospatialpython.googlecode.com/files/polygon.zip</a>.</p><p class="calibre9">Extract this shapefile to a folder called <code class="literal">polygon</code> in your <code class="literal">/qgis_data</code> directory.</p></div></div>

<div class="book" title="Adding a polygon feature to a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec106" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">This recipe will follow the standard PyQGIS process of loading a layer, building a feature, and adding it to the layer's data provider, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load the layer and validate it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/polygon/polygon.shp', 'Polygon' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Next, access the layer's data provider:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr = vectorLyr.dataProvider()</strong></span>
</pre></div></li><li class="listitem" value="5">Now, build a list of points for the polygon:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">points = []</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(-123.26,49.06))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(-127.19,43.07))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(-120.70,35.21))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(-115.89,40.02))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(-113.04,48.47))</strong></span>
<span class="strong"><strong class="calibre2">points.append(QgsPoint(-123.26,49.06))</strong></span>
</pre></div></li><li class="listitem" value="6">Next, create a<a id="id182" class="calibre1"/> geometry object and ingest the <a id="id183" class="calibre1"/>points as a polygon. We nest our list of points in another list because a polygon can have inner rings, which will consist of additional lists of points being added to this list:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">poly = QgsGeometry.fromPolygon([points])</strong></span>
</pre></div></li><li class="listitem" value="7">Next, build the feature object and add the points:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f = QgsFeature()</strong></span>
<span class="strong"><strong class="calibre2">f.setGeometry(poly)</strong></span>
</pre></div></li><li class="listitem" value="8">Finally, add the feature to the layer's data provider and update the extents:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr.addFeatures([f])</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Adding a polygon feature to a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec107" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">Adding a polygon is very similar to adding a line, with one key difference that is a common pitfall. The last point must be identical to the first point in order to close the polygon. If you don't repeat the first point, you won't receive any errors, but the polygon will not be displayed in QGIS, which can be difficult to troubleshoot.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a set of attributes to a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec41" class="calibre1"/>Adding a set of attributes to a vector layer</h1></div></div></div><p class="calibre9">Each QGIS feature has two parts, the geometry and the attributes. In this recipe, we'll add an attribute for a layer from an existing dataset.</p></div>

<div class="book" title="Adding a set of attributes to a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec108" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">We will use a point<a id="id184" class="calibre1"/> shapefile with museum data for New <a id="id185" class="calibre1"/>York City, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract this shapefile to the <code class="literal">/qgis_data/nyc</code> directory.</p></div></div>

<div class="book" title="Adding a set of attributes to a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec109" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">A feature must have geometry, but it does not require attributes. So, we will create a new feature, add some attributes, and then add everything to the layer, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> <a id="id186" class="calibre1"/>menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load <a id="id187" class="calibre1"/>the layer and validate it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Next, access the layer's data provider so that we can get the list of fields:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr = vectorLyr.dataProvider()</strong></span>
</pre></div></li><li class="listitem" value="5">Now, create a point geometry, which in this case is a new museum:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">pnt = QgsGeometry.fromPoint(QgsPoint(-74.13401,40.62148))</strong></span>
</pre></div></li><li class="listitem" value="6">Next, get the <code class="literal">fields</code> object for the layer that we'll need to create a new feature for:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">fields = vpr.fields()</strong></span>
</pre></div></li><li class="listitem" value="7">Then, create a new feature and initialize the attributes:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f = QgsFeature(fields)</strong></span>
</pre></div></li><li class="listitem" value="8">Now, set the geometry of our new museum feature:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f.setGeometry(pnt)</strong></span>
</pre></div></li><li class="listitem" value="9">Now, we are able to add a new attribute. Adding an attribute is similar to updating a Python dictionary, as shown here:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">f['NAME'] = 'Python Museum'</strong></span>
</pre></div></li><li class="listitem" value="10">Finally, we add the feature to the layer and update the extents:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr.addFeatures([f])</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.updateExtents()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Adding a set of attributes to a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec110" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">PyQGIS attributes are defined as an ordered <code class="literal">array</code>. The syntax for referencing a field is similar to the syntax for a Python dictionary. We use the layer's data provider object to perform the actual editing. When we use this approach, no signals are triggered at the layer object level. If we are just trying to edit data on the filesystem, that's okay, but if the layer is going to be added to the map canvas for display or user interaction, then you should use the editing buffer in the <code class="literal">QgsVectorLayer</code> object. This editing buffer allows you to commit or roll back<a id="id188" class="calibre1"/> changes and also keeps track of the state of the layer when things are <a id="id189" class="calibre1"/>changed.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding a field to a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec42" class="calibre1"/>Adding a field to a vector layer</h1></div></div></div><p class="calibre9">This recipe demonstrates <a id="id190" class="calibre1"/>how to add a new field to a layer. Each field represents a new<a id="id191" class="calibre1"/> column in a dataset for which each feature has a new attribute. When you add a new attribute, all the features are set to <code class="literal">NULL</code> for that field index.</p></div>

<div class="book" title="Adding a field to a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec111" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">We will use the New York City museums' shapefile<a id="id192" class="calibre1"/> used in other recipes, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract this shapefile to <code class="literal">/qgis_data/nyc</code>.</p></div></div>

<div class="book" title="Adding a field to a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec112" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">All the data management for a layer is handled through the layer's data provider and the fields are no different. We will load the layer, access the data provider, define the new field, and finalize the change, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, you must import the <code class="literal">Qt</code> library's data types, which PyQGIS uses to specify the layer field's data types:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">from PyQt4.QtCore import QVariant</strong></span>
</pre></div></li><li class="listitem" value="4">Next, load and validate the layer:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="5">Then, access the layer data provider:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr = vectorLyr.dataProvider()</strong></span>
</pre></div></li><li class="listitem" value="6">Now, add a Python list of <code class="literal">QgsField</code> objects, which defines the field name and type. In this case, we'll add one field named <code class="literal">Admission</code> as a <code class="literal">Double</code>:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vpr.addAttributes([QgsField("Admission", QVariant.Double)])</strong></span>
</pre></div></li><li class="listitem" value="7">Finally, update the fields to complete the change:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.updateFields()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Adding a field to a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec113" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The nomenclature used <a id="id193" class="calibre1"/>for the <code class="literal">fields</code> and <code class="literal">attributes</code> in QGIS is a<a id="id194" class="calibre1"/> little inconsistent and can be confusing if you've used other GIS packages. In QGIS, a column is a <code class="literal">field</code> that has a name and a type. The <code class="literal">attribute table</code> holds a value for each <code class="literal">field</code> column and each <code class="literal">feature</code> row. However, in the <code class="literal">QgsVectorDataProvider</code> object, you use the <code class="literal">addAttributes()</code> method to add a new <code class="literal">field</code> column. Also, in other GIS software, you may see the use of the word <code class="literal">field</code> and <code class="literal">attribute</code> reversed.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Joining a shapefile attribute table to a CSV file"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec43" class="calibre1"/>Joining a shapefile attribute table to a CSV file</h1></div></div></div><p class="calibre9">Joining attribute tables to other<a id="id195" class="calibre1"/> database tables allows you to use a <a id="id196" class="calibre1"/>spatial dataset in order to reference a dataset without any geometry, using a common key between the data tables. A very common use case for this is to join a vector dataset of census attributes to a more detailed census attribute dataset. The use case we will demonstrate here links a US census track file to a detailed CSV file that contains more in-depth information.</p></div>

<div class="book" title="Joining a shapefile attribute table to a CSV file">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec114" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, you will need a census <code class="literal">tract</code> shapefile and a CSV file containing the appropriate census data<a id="id197" class="calibre1"/> for the shapefile. You can download the sample data set from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/census.zip">https://geospatialpython.googlecode.com/svn/census.zip</a>.</p><p class="calibre9">Extract this data to a directory named <code class="literal">/qgis_data/census</code>.</p></div></div>

<div class="book" title="Joining a shapefile attribute table to a CSV file">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec115" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">The join operation is quite involved. We'll perform this operation and save the layer as a new shapefile with the joined attributes. Then we'll load the new layer and compare the field count to the original layer to ensure that the join occurred. We'll use the terms <code class="literal">target layer</code> and <code class="literal">join layer</code>. The <code class="literal">target layer</code> will be the shapefile, and the <code class="literal">join layer</code> will be a CSV with some additional fields we want to add to the shapefile. To do this, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load the county's <code class="literal">census</code> track layer and validate it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/census/hancock_tracts.shp', 'Hancock' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Now, load the CSV file as a layer and validate it as well:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">infoLyr = QgsVectorLayer('/qgis_data/census/ACS_12_5YR_S1901_with_ann.csv', 'Census' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">infoLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="5">Once this is done, you must add both the layers to the map registry for the two layers to interact for the join. However, set the visibility to <code class="literal">False</code>, so the layers do not appear on the map:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">QgsMapLayerRegistry.instance().addMapLayers([vectorLyr,infoLyr], False)</strong></span>
</pre></div></li><li class="listitem" value="6">Next, you must <a id="id198" class="calibre1"/>create a special join<a id="id199" class="calibre1"/> object:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">info = QgsVectorJoinInfo()</strong></span>
</pre></div></li><li class="listitem" value="7">The join object needs the layer ID of the CSV file:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">info.joinLayerId = infoLyr.id()</strong></span>
</pre></div></li><li class="listitem" value="8">Next, specify the key field from the CSV file whose values correspond to the values in the shapefile:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">info.joinFieldName = "GEOid2"</strong></span>
</pre></div></li><li class="listitem" value="9">Then, specify the corresponding field in the shapefile:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">info.targetFieldName = "GEOID"</strong></span>
</pre></div></li><li class="listitem" value="10">Set the <code class="literal">memoryCache</code> property to <code class="literal">True</code> in order to speed up access to the joined data:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">info.memoryCache = True</strong></span>
</pre></div></li><li class="listitem" value="11">Add the join to the layer now:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.addJoin(info)</strong></span>
</pre></div></li><li class="listitem" value="12">Next, write out the joined shapefile to a new file on disk:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">QgsVectorFileWriter.writeAsVectorFormat(vectorLyr, "/qgis_data/census/joined.shp", "CP120", None, "ESRI Shapefile")</strong></span>
</pre></div></li><li class="listitem" value="13">Now, load the new shapefile back in as a layer for verification:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">joinedLyr =  QgsVectorLayer('/qgis_data/census/joined.shp', 'Joined' , "ogr")</strong></span>
</pre></div></li><li class="listitem" value="14">Verify that the field count in the original layer is <code class="literal">12</code>:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.dataProvider().fields().count()</strong></span>
</pre></div></li><li class="listitem" value="15">Finally, verify that the new layer has a field count of <code class="literal">142</code> from the join:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">joinedLyr.dataProvider().fields().count()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Joining a shapefile attribute table to a CSV file">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec116" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">This recipe reaches <a id="id200" class="calibre1"/>out to the very edge of the PyQGIS API, forcing<a id="id201" class="calibre1"/> you to use some workarounds. Most recipes for data manipulation can be performed programmatically without writing data to disk or loading layers onto the map, but joins are different. Because the <code class="literal">QgsVectorJoinInfo</code> object needs the layer ID of the CSV layer, we must add both the layers to the map layer registry. Fortunately, we can do this without making them visible, if we are just trying to write a data manipulation script. A <code class="literal">join</code> is designed to be a temporary operation to query a dataset. Oddly, PyQGIS lets you create the <code class="literal">join</code>, but you cannot query it. This limitation is the reason why if you want to work with the joined data, you must write it to a new shapefile and reload it. Fortunately, PyQGIS allows you to do that.</p></div></div>

<div class="book" title="Joining a shapefile attribute table to a CSV file">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec117" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre9">You can find an alternate method that works around the PyQGIS limitation in a Processing Toolbox script, which manually matches the joined data in Python, at <a class="calibre1" href="https://github.com/rldhont/Quantum-GIS/blob/master/python/plugins/processing/algs/qgis/JoinAttributes.py">https://github.com/rldhont/Quantum-GIS/blob/master/python/plugins/processing/algs/qgis/JoinAttributes.py</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Moving vector layer geometry"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec44" class="calibre1"/>Moving vector layer geometry</h1></div></div></div><p class="calibre9">Sometimes, you need to<a id="id202" class="calibre1"/> change the location of a feature. You can do this by deleting and re-adding the feature, but PyQGIS provides a simple way to change the geometry.</p></div>

<div class="book" title="Moving vector layer geometry">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec118" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">You will need the New York City museums' shapefile<a id="id203" class="calibre1"/>, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract this shapefile to<code class="literal"> /qgis_data/nyc.</code>
</p></div></div>

<div class="book" title="Moving vector layer geometry">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec119" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will load the shapefile as a vector layer, validate it, define the feature ID we want to change, create the new geometry, and change the feature in the layer. To do this, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load the layer and validate it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Next, define the feature ID we are interested in changing:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">feat_id = 22</strong></span>
</pre></div></li><li class="listitem" value="5">Now, create the new point geometry, which will become the new location:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">geom = QgsGeometry.fromPoint(QgsPoint(-74.20378,40.89642))</strong></span>
</pre></div></li><li class="listitem" value="6">Finally, change the geometry and replace it with our new geometry, specifying the feature ID:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.dataProvider().changeGeometryValues({feat_id : geom})</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Moving vector layer geometry">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec120" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The <code class="literal">changeGeometryValues()</code> method<a id="id204" class="calibre1"/> makes <a id="id205" class="calibre1"/>editing a snap of the fingers. If we had to delete and then re-add the feature, we would have to go through the trouble of reading the attributes, preserving them, and then re-adding them with the new feature. You must, of course, know the feature ID of the feature you want to change. How you determine this ID depends on your application. Typically, you will query the attributes to find a specific value, or you can do a spatial operation of some sort.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Changing a vector layer feature's attribute"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec45" class="calibre1"/>Changing a vector layer feature's attribute</h1></div></div></div><p class="calibre9">The process to change an <a id="id206" class="calibre1"/>attribute in a feature is straightforward and well-supported <a id="id207" class="calibre1"/>by the PyQGIS API. In this recipe, we'll change a single attribute, but you can change as many attributes of a feature as desired at once.</p></div>

<div class="book" title="Changing a vector layer feature's attribute">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec121" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">You will need the New York City <a id="id208" class="calibre1"/>museums' shapefile used in other recipes, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract this shapefile to<code class="literal"> /qgis_data/nyc</code>.</p></div></div>

<div class="book" title="Changing a vector layer feature's attribute">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec122" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will load the shapefile as<a id="id209" class="calibre1"/> a vector layer, validate it, define the feature IDs of the fields we want to change, get the index of the field names that we will change, define the new attribute value as an attribute index and value, and change the feature in the layer. To do this, we need to perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load the layer and validate it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Next, define the feature IDs you want to change:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">fid1 = 22</strong></span>
<span class="strong"><strong class="calibre2">fid2 = 23</strong></span>
</pre></div></li><li class="listitem" value="5">Then, get the index of the <a id="id210" class="calibre1"/>fields you want to change, which are the telephone number and city name:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">tel = vectorLyr.fieldNameIndex("TEL")</strong></span>
<span class="strong"><strong class="calibre2">city = vectorLyr.fieldNameIndex("CITY")</strong></span>
</pre></div></li><li class="listitem" value="6">Now, create the Python dictionary for the attribute index and the new value, which in this case is an imaginary phone number:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">attr1 = {tel:"(555) 555-1111", city:"NYC"}</strong></span>
<span class="strong"><strong class="calibre2">attr2 = {tel:"(555) 555-2222", city:"NYC"}</strong></span>
</pre></div></li><li class="listitem" value="7">Finally, use the layer's data provider to update the fields:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.dataProvider().changeAttributeValues({fid1:attr1, fid2:attr2})</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Changing a vector layer feature's attribute">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec123" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">Changing attributes is very<a id="id211" class="calibre1"/> similar to changing the geometry within a feature. We <a id="id212" class="calibre1"/>explicitly name the feature IDs in this example, but in a real-world program, you would collect these IDs as a part of some other process output, such as a spatial selection. An example of this type of spatial selection is available in the <span class="strong"><em class="calibre10">Filtering a layer by Geometry</em></span> recipe, in <a class="calibre1" title="Chapter 2. Querying Vector Data" href="part0028_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre10">Querying Vector Data</em></span>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting a vector layer feature"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec46" class="calibre1"/>Deleting a vector layer feature</h1></div></div></div><p class="calibre9">In this recipe, we'll completely remove a <a id="id213" class="calibre1"/>feature, including the geometry and attributes, from a layer.</p></div>

<div class="book" title="Deleting a vector layer feature">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec124" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">You will need the <a id="id214" class="calibre1"/>New York City museums' shapefile used in other recipes, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract this shapefile to <code class="literal">/qgis_data/nyc</code>.</p></div></div>

<div class="book" title="Deleting a vector layer feature">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec125" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">All we need to do is load the layer and then delete the desired features by ID, using the layer's data provider:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load and validate the layer:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Next, specify a Python list containing feature IDs. In this case, we have two:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.dataProvider().deleteFeatures([ 22, 95 ])</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Deleting a vector layer feature">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec126" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">This operation cannot be simpler or better designed. There are a number of ways in which we can programmatically fill a Python list with feature IDs. For example, we can use the <a class="calibre1" title="Chapter 2. Querying Vector Data" href="part0028_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre10">Filtering a Layer by Attributes</em></span> in this recipe. Then, we just pass this list to the layer's data provider and we are done.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Deleting a vector layer attribute"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec47" class="calibre1"/>Deleting a vector layer attribute</h1></div></div></div><p class="calibre9">In this recipe, we'll wipe out an <a id="id215" class="calibre1"/>entire attribute and all the feature fields for a vector layer.</p></div>

<div class="book" title="Deleting a vector layer attribute">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec127" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">You will need the <a id="id216" class="calibre1"/>New York City museums' shapefile used in other recipes, which you can download as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip">https://geospatialpython.googlecode.com/svn/NYC_MUSEUMS_GEO.zip</a>.</p><p class="calibre9">Extract this shapefile to<code class="literal"> /qgis_data/nyc</code>.</p></div></div>

<div class="book" title="Deleting a vector layer attribute">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec128" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">This operation is straight forward. We'll load and validate the layer, use the layer's data provider to delete the attribute by index, and finally, we will update all the fields to remove the orphaned values. To do this, we need to perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, load and validate the layer:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/nyc/NYC_MUSEUMS_GEO.shp', 'Museums' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Then, delete the first attribute:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.dataProvider().deleteAttributes([1]) </strong></span>
</pre></div></li><li class="listitem" value="5">Finally, update the fields:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr.updateFields()</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Deleting a vector layer attribute">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec129" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">Because we are changing the actual structure of the layer data, we must call the <code class="literal">updateFields()</code> method of the layer to remove the field values which no longer have an attribute.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Reprojecting a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec48" class="calibre1"/>Reprojecting a vector layer</h1></div></div></div><p class="calibre9">We will use the Processing <a id="id217" class="calibre1"/>Toolbox in QGIS to reproject a layer to a different coordinate system.</p></div>

<div class="book" title="Reprojecting a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec130" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, we'll need the Mississippi cities' shapefile<a id="id218" class="calibre1"/> in the Mississippi Trans Mercator projection (EPSG 3814), which can be downloaded as a ZIP file from <a class="calibre1" href="https://geospatialpython.googlecode.com/files/MSCities_MSTM.zip">https://geospatialpython.googlecode.com/files/MSCities_MSTM.zip</a>.</p><p class="calibre9">Extract the zipped shapefile to a directory named /<code class="literal">qgis_data/ms</code>.</p></div></div>

<div class="book" title="Reprojecting a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec131" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">To reproject the layer, we'll simply call the <code class="literal">qgis:reprojectlayer</code> processing algorithm, specifying the input shapefile, the new projection, and the output file name. To do this, perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First, you need to import the processing module:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="4">Next, run the reprojection alogoritm, as follows:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runalg("qgis:reprojectlayer", "/qgis_data/ms/MSCities_MSTM.shp", "epsg:4326", "/qgis_data/ms/MSCities_MSTM_4326.shp")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Reprojecting a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec132" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The source data starts out in<a id="id219" class="calibre1"/> EPSG 3814, but we want to project it to WGS 84 Geographic, which is commonly used to deal with global datasets and is usually the default coordinate reference system for GPS devices. The target EPSG code is 4326. Dealing with map projections can be quite complex. This QGIS tutorial<a id="id220" class="calibre1"/> has some more examples and explains more about map projections at <a class="calibre1" href="http://manual.linfiniti.com/en/vector_analysis/reproject_transform.html">http://manual.linfiniti.com/en/vector_analysis/reproject_transform.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Converting a shapefile to KML"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec49" class="calibre1"/>Converting a shapefile to KML</h1></div></div></div><p class="calibre9">In this recipe, we'll convert a layer to <a id="id221" class="calibre1"/>KML. KML is an <span class="strong"><strong class="calibre2">Open Geospatial Consortium</strong></span> (<span class="strong"><strong class="calibre2">OGC</strong></span>)<a id="id222" class="calibre1"/> standard <a id="id223" class="calibre1"/>and is supported by the underlying OGR library used by QGIS.</p></div>

<div class="book" title="Converting a shapefile to KML">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec133" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, download the following zipped shapefile and extract it to a directory named <code class="literal">/qgis_data/hancock</code>:</p><p class="calibre9">
<a class="calibre1" href="https://geospatialpython.googlecode.com/files/hancock.zip">https://geospatialpython.googlecode.com/files/hancock.zip</a>
</p></div></div>

<div class="book" title="Converting a shapefile to KML">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec134" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">To convert a shapefile to the KML XML format, we'll load the layer and then use the <code class="literal">QgsVectorFileWriter</code> object to save it as KML:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">First load the layer and validate it:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">vectorLyr =  QgsVectorLayer('/qgis_data/hancock/hancock.shp', 'Hancock' , "ogr")</strong></span>
<span class="strong"><strong class="calibre2">vectorLyr.isValid()</strong></span>
</pre></div></li><li class="listitem" value="4">Then, establish the destination CRS. KML should always be in EPS:4326:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">dest_crs = QgsCoordinateReferenceSystem(4326)</strong></span>
</pre></div></li><li class="listitem" value="5">Next, use the file writer to save it as a KML file by specifying the file type as KML:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">QgsVectorFileWriter.writeAsVectorFormat(vectorLyr, "/qgis_data/hancock/hancock.kml", "utf-8", dest_crs, "KML")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Converting a shapefile to KML">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec135" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">You will end up with a KML file in the directory next to your shapefile. KML supports styling information. QGIS uses some default styling information that you can change, either by hand using a text editor, or programmatically using an XML library such as Python's ElementTree. KML is one of many standard vector formats you can export using this method.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Merging shapefiles"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec50" class="calibre1"/>Merging shapefiles</h1></div></div></div><p class="calibre9">Merging shapefiles with matching <a id="id224" class="calibre1"/>projections and attribute structures is a very common operation. In QGIS, the best way to merge vector datasets is to use another GIS system included with QGIS on Windows and OSX called <span class="strong"><strong class="calibre2">SAGA</strong></span>. On other platforms, you must install SAGA separately and activate it in the Processing Toolbox configuration. In PyQGIS, you can access SAGA functions through the Processing Toolbox. <span class="strong"><strong class="calibre2">SAGA</strong></span> is yet another open source GIS that is similar to QGIS. However, both packages have strengths and weaknesses. By using SAGA through the Processing Toolbox, you can have the best of both systems.</p></div>

<div class="book" title="Merging shapefiles">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec136" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">In this recipe, we'll merge some building footprint shapefiles from adjoining areas into a single shapefile. You can download the sample dataset from <a class="calibre1" href="https://geospatialpython.googlecode.com/files/tiled_footprints.zip">https://geospatialpython.googlecode.com/files/tiled_footprints.zip</a>.</p><p class="calibre9">Extract the zipped shapefiles to a directory named <code class="literal">/qgis_data/tiled_footprints</code>.</p></div></div>

<div class="book" title="Merging shapefiles">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec137" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will locate all the <code class="literal">.shp</code> files in the data directory and hand them to the <code class="literal">saga:mergeshapeslayers object i</code>n order to merge them.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">Import the Python <code class="literal">glob</code> module for wildcard file matching:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import glob</strong></span>
</pre></div></li><li class="listitem" value="4">Next, import the processing module for the merge algorithm:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="5">Now, specify the path of our data directory:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">pth = "/qgis_data/tiled_footprints/"</strong></span>
</pre></div></li><li class="listitem" value="6">Locate all the .shp files:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">files = glob.glob(pth + "*.shp")</strong></span>
</pre></div></li><li class="listitem" value="7">Then, specify the output name of the merged shapefile:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">out = pth + "merged.shp"</strong></span>
</pre></div></li><li class="listitem" value="8">Finally, run the algorithm that will load the merged shapefile on to the map:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runandload("saga:mergeshapeslayers",files.pop(0),";".join(files),out)</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Merging shapefiles">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec138" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The algorithm accepts a <a id="id225" class="calibre1"/>base file and then a semicolon-separated list of additional files to be merged, and it finally accepts the output filename. The <code class="literal">glob</code> module creates a list of the files. To get the base file, we use the list <code class="literal">pop()</code> method to get the first filename. Then, we use the Python string's <code class="literal">join()</code> method to make the required delimited list for the rest.</p></div></div>

<div class="book" title="Merging shapefiles">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec139" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre9">QGIS has its own merge method available through the <code class="literal">processing</code> module called <code class="literal">qgis:mergevectorlayers</code>, but it is limited <a id="id226" class="calibre1"/>because it only merges two files. The SAGA method allows any number of files to be merged.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Splitting a shapefile"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec51" class="calibre1"/>Splitting a shapefile</h1></div></div></div><p class="calibre9">Sometimes, you need to split a <a id="id227" class="calibre1"/>shapefile in order to break a larger dataset into more manageable sizes or to isolate a specific area of interest. There is a script in the Processing Toolbox that splits a shapefile by attribute. It is very useful, even though it is provided as an example of how to write processing scripts.</p></div>

<div class="book" title="Splitting a shapefile">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec140" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">We will split a census tract shapefile<a id="id228" class="calibre1"/> by county. You can download the sample zipped shapefile from <a class="calibre1" href="https://geospatialpython.googlecode.com/files/GIS_CensusTract.zip">https://geospatialpython.googlecode.com/files/GIS_CensusTract.zip</a>.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Extract the zipped shapefile to a directory named <code class="literal">/qgis_data/census</code>.</li><li class="listitem" value="2">You also need the following <a id="id229" class="calibre1"/>script for the Processing Toolbox:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">https://geospatialpython.googlecode.com/svn/Split_vector_layer_by_attribute.py</strong></span>
</pre></div></li><li class="listitem" value="3">Next, use the following steps to add the script to the Processing Toolbox:</li><li class="listitem" value="4">Download the script to your <code class="literal">/qgis_data/</code> directory.</li><li class="listitem" value="5">In the QGIS <span class="strong"><strong class="calibre2">Processing Toolbox</strong></span>, open the <span class="strong"><strong class="calibre2">Scripts</strong></span> tree menu and then go to the <span class="strong"><strong class="calibre2">Tools</strong></span> submenu.</li><li class="listitem" value="6">Then, double-click on the <span class="strong"><strong class="calibre2">Add script from file</strong></span> command.</li><li class="listitem" value="7">In the <span class="strong"><strong class="calibre2">File</strong></span> dialog, navigate to the script. Select the <span class="strong"><strong class="calibre2">Script</strong></span> and click on the <span class="strong"><strong class="calibre2">Open</strong></span> button.</li></ol><div class="calibre14"/></div><p class="calibre9">The stage is set now. Perform the steps in the next section to split the shapefile.</p></div></div>

<div class="book" title="Splitting a shapefile">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec141" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">This recipe is as simple as running the algorithm and specifying the filename and data attribute. Perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">Import the <code class="literal">processing</code> module:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="4">Define your data directory as a variable to shorten the processing command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">pth = "/qgis_data/census/"</strong></span>
</pre></div></li><li class="listitem" value="5">Finally, run the algorithm:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runalg("script:splitvectorlayerbyattribute",pth + "GIS_CensusTract_poly.shp","COUNTY_8",pth + "split")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Splitting a shapefile">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec142" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The algorithm will <a id="id230" class="calibre1"/>dump the split files in the data directory, numbered sequentially.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Generalizing a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec52" class="calibre1"/>Generalizing a vector layer</h1></div></div></div><p class="calibre9">Generalizing the geometry, also <a id="id231" class="calibre1"/>known as simplifying, removes points from a vector layer to reduce the space required to store the data on disk, the bandwidth needed to move it over a network, and the processing power required to perform analysis with it or display it in QGIS. In many cases, the geometry of a layer contains redundant points along with straight lines that can be removed without changing the spatial properties of a layer, with the exception of topology constraints.</p></div>

<div class="book" title="Generalizing a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec143" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">For this recipe, we will use a boundary file for the state of Mississippi, which you can download from <a class="calibre1" href="https://geospatialpython.googlecode.com/files/Mississippi.zip">https://geospatialpython.googlecode.com/files/Mississippi.zip</a>.</p><p class="calibre9">Extract the zipped shapefile to a directory named <code class="literal">/qgis_data/ms</code>.</p></div></div>

<div class="book" title="Generalizing a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec144" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">Generalizing is native to QGIS, but we will access it in PyQGIS through the Processing Toolbox using the <code class="literal">qgis:simplifygeometries</code> algorithm, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">Import the <code class="literal">processing</code> module:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="4">Now, run the <code class="literal">processing</code> algorithm, specifying the algorithm name, input data, tolerance value, spacing between points — which defines how close two points are in map units before one is deleted — and the output dataset's name:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runandload("qgis:simplifygeometries","/qgis_data/ms/mississippi.shp",0.3,"/qgis_data/ms/generalize.shp")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Generalizing a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec145" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">The simplicity of the <code class="literal">simplifygeometries</code> command makes the operation look simple. However, the simplification is itself quite complex. The same settings rarely produce desirable results across multiple datasets.</p><p class="calibre9">The shapefile in this recipe<a id="id232" class="calibre1"/> starts out quite complex with hundreds of points, as seen in the following visualization:</p><div class="mediaobject"><img src="../images/00022.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The simplified version has <a id="id233" class="calibre1"/>only <code class="literal">10</code> points, as seen in the following image:</p><div class="mediaobject"><img src="../images/00023.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Dissolving vector shapes"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec53" class="calibre1"/>Dissolving vector shapes</h1></div></div></div><p class="calibre9">Dissolving shapes can take <a id="id234" class="calibre1"/>two different forms. You can combine a group of adjoining shapes by the outermost boundary of the entire dataset, or you can also group the adjoining shapes with the same attribute value.</p></div>

<div class="book" title="Dissolving vector shapes">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec146" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">Download the <a id="id235" class="calibre1"/>GIS census tract shapefile, which contains tracts for several counties from <a class="calibre1" href="https://geospatialpython.googlecode.com/files/GIS_CensusTract.zip">https://geospatialpython.googlecode.com/files/GIS_CensusTract.zip</a>.</p><p class="calibre9">Extract it to your <code class="literal">/qgis_data</code> directory, in a directory called <code class="literal">census</code>.</p></div></div>

<div class="book" title="Dissolving vector shapes">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec147" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will use the Processing Toolbox for this recipe and specifically a native QGIS algorithm called <code class="literal">dissolve</code>, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">Import the <code class="literal">processing</code> module:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="4">Next, run the <code class="literal">dissolve</code> algorithm, specifying the input data—<code class="literal">False</code> to specify that we don't want to dissolve all the shapes into one but to use an attribute instead—the attribute we want to use, and the output filename:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runandload("qgis:dissolve","/qgis_data/census/GIS_CensusTract_poly.shp",False,"COUNTY_8","/qgis_data/census/dissovle.shp")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Dissolving vector shapes">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec148" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">By only changing the <a id="id236" class="calibre1"/>boolean in the statement to <code class="literal">True</code>, we can dissolve all adjoining shapes into one. It is also important to note that QGIS will assign the fields of the first shape it encounters in each group to the final shape. In most cases, this will make the attributes virtually useless. This operation is primarily a spatial task.</p><p class="calibre9">You can see that each county boundary has a number of census tracts in the original layer, as shown in the following image:</p><div class="mediaobject"><img src="../images/00024.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Once the shapes are dissolved, you<a id="id237" class="calibre1"/> are left with only the county boundaries, as shown in this image:</p><div class="mediaobject"><img src="../images/00025.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Performing a union on vector shapes"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec54" class="calibre1"/>Performing a union on vector shapes</h1></div></div></div><p class="calibre9">A union turns two overlapping<a id="id238" class="calibre1"/> shapes into one. This task can be easily <a id="id239" class="calibre1"/>accomplished with the Processing Toolbox. In this recipe, we'll merge the outline of a covered building with the footprint of the main building.</p></div>

<div class="book" title="Performing a union on vector shapes">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec149" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">You can download the building files from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/union.zip">https://geospatialpython.googlecode.com/svn/union.zip</a> and extract them to a directory named <code class="literal">/qgis_data/union</code>.</p></div></div>

<div class="book" title="Performing a union on vector shapes">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec150" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">All we need to do is run the <code class="literal">qgis:union</code> algorithm, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">Import the <code class="literal">processing</code> module:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="4">Now, run the algorithm by specifying the two input shapes and a single output file:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runandload("qgis:union","/qgis_data/union/building.shp","/qgis_data/union/walkway.shp","/qgis_data/union/union.shp")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Performing a union on vector shapes">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec151" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">As you can tell from the structure of the command, this tool can only combine two shapes at once. It finds where the two shapes meet and then removes the overlap, joining them at the meeting point.</p><p class="calibre9">In the original data, the shapefile starts out as two distinct shapes, as shown in this image:</p><div class="mediaobject"><img src="../images/00026.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Once the <a id="id240" class="calibre1"/>union is complete, the shapes are now one shapefile, with <a id="id241" class="calibre1"/>the overlap being a separate feature, as shown in this image:</p><div class="mediaobject"><img src="../images/00027.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Rasterizing a vector layer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec55" class="calibre1"/>Rasterizing a vector layer</h1></div></div></div><p class="calibre9">Sometimes, a raster dataset is <a id="id242" class="calibre1"/>the most efficient way to display a complex vector that is merely a backdrop in a map. In these cases, you can rasterize a vector layer to turn it into an image.</p></div>

<div class="book" title="Rasterizing a vector layer">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec152" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre9">We will demonstrate how to rasterize a vector layer using the following <a id="id243" class="calibre1"/>contour shapefile, which you can download from <a class="calibre1" href="https://geospatialpython.googlecode.com/svn/contour.zip">https://geospatialpython.googlecode.com/svn/contour.zip</a>.</p><p class="calibre9">Extract it to your <code class="literal">/qgis_data/rasters</code> directory.</p></div></div>

<div class="book" title="Rasterizing a vector layer">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec153" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre9">We will run the <code class="literal">gdalogr:rasterize</code> algorithm to convert this vector data to a raster, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start QGIS.</li><li class="listitem" value="2">From the <span class="strong"><strong class="calibre2">Plugins</strong></span> menu, select <span class="strong"><strong class="calibre2">Python Console</strong></span>.</li><li class="listitem" value="3">Import the <code class="literal">processing</code> module:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">import processing</strong></span>
</pre></div></li><li class="listitem" value="4">Run the algorithm, specifying the input data, the attribute from which raster values need to be drawn, <code class="literal">0</code> in order to specify pixel dimensions for the output instead of map dimensions, width and height, and finally the output raster name:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">processing.runalg("gdalogr:rasterize","/qgis_data/rasters/contour.shp","ELEV",0,1000,1000,"/qgis_data/rasters/contour.tif")</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Rasterizing a vector layer">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec154" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre9">If you want to specify the output dimensions in map units, use <code class="literal">1</code> instead of <code class="literal">0</code>. Note that the symbology of the layer becomes frozen once you convert it to a raster. The raster is also no longer dynamically scalable.</p><p class="calibre9">The following image shows the rasterized output of the elevation contour shapefile:</p><div class="mediaobject"><img src="../images/00028.jpeg" alt="How it works..." class="calibre11"/></div><p class="calibre12"> </p></div></div></body></html>